/* minified by terser */
function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function(){return e};var t,e={},i=Object.prototype,o=i.hasOwnProperty,n=Object.defineProperty||function(t,e,i){t[e]=i.value},s="function"==typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",r=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function c(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,i){return t[e]=i}}function h(t,e,i,o){var s=e&&e.prototype instanceof b?e:b,a=Object.create(s.prototype),r=new P(o||[]);return n(a,"_invoke",{value:k(t,i,r)}),a}function d(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var m="suspendedStart",p="suspendedYield",u="executing",g="completed",f={};function b(){}function C(){}function v(){}var _={};c(_,a,(function(){return this}));var w=Object.getPrototypeOf,A=w&&w(w(D([])));A&&A!==i&&o.call(A,a)&&(_=A);var y=v.prototype=b.prototype=Object.create(_);function S(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function i(n,s,a,r){var l=d(t[n],t,s);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==_typeof(h)&&o.call(h,"__await")?e.resolve(h.__await).then((function(t){i("next",t,a,r)}),(function(t){i("throw",t,a,r)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return i("throw",t,a,r)}))}r(l.arg)}var s;n(this,"_invoke",{value:function(t,o){function n(){return new e((function(e,n){i(t,o,e,n)}))}return s=s?s.then(n,n):n()}})}function k(e,i,o){var n=m;return function(s,a){if(n===u)throw Error("Generator is already running");if(n===g){if("throw"===s)throw a;return{value:t,done:!0}}for(o.method=s,o.arg=a;;){var r=o.delegate;if(r){var l=T(r,o);if(l){if(l===f)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(n===m)throw n=g,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);n=u;var c=d(e,i,o);if("normal"===c.type){if(n=o.done?g:p,c.arg===f)continue;return{value:c.arg,done:o.done}}"throw"===c.type&&(n=g,o.method="throw",o.arg=c.arg)}}}function T(e,i){var o=i.method,n=e.iterator[o];if(n===t)return i.delegate=null,"throw"===o&&e.iterator.return&&(i.method="return",i.arg=t,T(e,i),"throw"===i.method)||"return"!==o&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+o+"' method")),f;var s=d(n,e.iterator,i.arg);if("throw"===s.type)return i.method="throw",i.arg=s.arg,i.delegate=null,f;var a=s.arg;return a?a.done?(i[e.resultName]=a.value,i.next=e.nextLoc,"return"!==i.method&&(i.method="next",i.arg=t),i.delegate=null,f):a:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,f)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function D(e){if(e||""===e){var i=e[a];if(i)return i.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,s=function i(){for(;++n<e.length;)if(o.call(e,n))return i.value=e[n],i.done=!1,i;return i.value=t,i.done=!0,i};return s.next=s}}throw new TypeError(_typeof(e)+" is not iterable")}return C.prototype=v,n(y,"constructor",{value:v,configurable:!0}),n(v,"constructor",{value:C,configurable:!0}),C.displayName=c(v,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===C||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,c(t,l,"GeneratorFunction")),t.prototype=Object.create(y),t},e.awrap=function(t){return{__await:t}},S(x.prototype),c(x.prototype,r,(function(){return this})),e.AsyncIterator=x,e.async=function(t,i,o,n,s){void 0===s&&(s=Promise);var a=new x(h(t,i,o,n),s);return e.isGeneratorFunction(i)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(y),c(y,l,"Generator"),c(y,a,(function(){return this})),c(y,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),i=[];for(var o in e)i.push(o);return i.reverse(),function t(){for(;i.length;){var o=i.pop();if(o in e)return t.value=o,t.done=!1,t}return t.done=!0,t}},e.values=D,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var i in this)"t"===i.charAt(0)&&o.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function n(o,n){return r.type="throw",r.arg=e,i.next=o,n&&(i.method="next",i.arg=t),!!n}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],r=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=t,a.arg=e,s?(this.method="next",this.next=s.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),E(i),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var o=i.completion;if("throw"===o.type){var n=o.arg;E(i)}return n}}throw Error("illegal catch attempt")},delegateYield:function(e,i,o){return this.delegate={iterator:D(e),resultName:i,nextLoc:o},"next"===this.method&&(this.arg=t),f}},e}function asyncGeneratorStep(t,e,i,o,n,s,a){try{var r=t[s](a),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(o,n)}function _asyncToGenerator(t){return function(){var e=this,i=arguments;return new Promise((function(o,n){var s=t.apply(e,i);function a(t){asyncGeneratorStep(s,o,n,a,r,"next",t)}function r(t){asyncGeneratorStep(s,o,n,a,r,"throw",t)}a(void 0)}))}}function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}if(function(t,e){"use strict";"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,(function(t,e){var i=[],o=Object.getPrototypeOf,n=i.slice,s=i.flat?function(t){return i.flat.call(t)}:function(t){return i.concat.apply([],t)},a=i.push,r=i.indexOf,l={},c=l.toString,h=l.hasOwnProperty,d=h.toString,m=d.call(Object),p={},u=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType&&"function"!=typeof t.item},g=function(t){return null!=t&&t===t.window},f=t.document,b={type:!0,src:!0,nonce:!0,noModule:!0};function C(t,e,i){var o,n,s=(i=i||f).createElement("script");if(s.text=t,e)for(o in b)(n=e[o]||e.getAttribute&&e.getAttribute(o))&&s.setAttribute(o,n);i.head.appendChild(s).parentNode.removeChild(s)}function v(t){return null==t?t+"":"object"===_typeof(t)||"function"==typeof t?l[c.call(t)]||"object":_typeof(t)}var _="3.7.1",w=/HTML$/i,A=function(t){function e(e,i){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){return new A.fn.init(t,e)}));function y(t){var e=!!t&&"length"in t&&t.length,i=v(t);return!u(t)&&!g(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}function S(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}A.fn=A.prototype={jquery:_,constructor:A,length:0,toArray:function(){return n.call(this)},get:function(t){return null==t?n.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=A.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return A.each(this,t)},map:function(t){return this.pushStack(A.map(this,(function(e,i){return t.call(e,i,e)})))},slice:function(){return this.pushStack(n.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(A.grep(this,(function(t,e){return(e+1)%2})))},odd:function(){return this.pushStack(A.grep(this,(function(t,e){return e%2})))},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:a,sort:i.sort,splice:i.splice},A.extend=A.fn.extend=function(){var t,e,i,o,n,s,a=arguments[0]||{},r=1,l=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[r]||{},r++),"object"===_typeof(a)||u(a)||(a={}),r===l&&(a=this,r--);r<l;r++)if(null!=(t=arguments[r]))for(e in t)o=t[e],"__proto__"!==e&&a!==o&&(c&&o&&(A.isPlainObject(o)||(n=Array.isArray(o)))?(i=a[e],s=n&&!Array.isArray(i)?[]:n||A.isPlainObject(i)?i:{},n=!1,a[e]=A.extend(c,s,o)):void 0!==o&&(a[e]=o));return a},A.extend({expando:"jQuery"+(_+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,i;return!(!t||"[object Object]"!==c.call(t))&&(!(e=o(t))||"function"==typeof(i=h.call(e,"constructor")&&e.constructor)&&d.call(i)===m)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t,e,i){C(t,{nonce:e&&e.nonce},i)},each:function(t,e){var i,o=0;if(y(t))for(i=t.length;o<i&&!1!==e.call(t[o],o,t[o]);o++);else for(o in t)if(!1===e.call(t[o],o,t[o]))break;return t},text:function(t){var e,i="",o=0,n=t.nodeType;if(!n)for(;e=t[o++];)i+=A.text(e);return 1===n||11===n?t.textContent:9===n?t.documentElement.textContent:3===n||4===n?t.nodeValue:i},makeArray:function(t,e){var i=e||[];return null!=t&&(y(Object(t))?A.merge(i,"string"==typeof t?[t]:t):a.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:r.call(e,t,i)},isXMLDoc:function(t){var e=t&&t.namespaceURI,i=t&&(t.ownerDocument||t).documentElement;return!w.test(e||i&&i.nodeName||"HTML")},merge:function(t,e){for(var i=+e.length,o=0,n=t.length;o<i;o++)t[n++]=e[o];return t.length=n,t},grep:function(t,e,i){for(var o=[],n=0,s=t.length,a=!i;n<s;n++)!e(t[n],n)!==a&&o.push(t[n]);return o},map:function(t,e,i){var o,n,a=0,r=[];if(y(t))for(o=t.length;a<o;a++)null!=(n=e(t[a],a,i))&&r.push(n);else for(a in t)null!=(n=e(t[a],a,i))&&r.push(n);return s(r)},guid:1,support:p}),"function"==typeof Symbol&&(A.fn[Symbol.iterator]=i[Symbol.iterator]),A.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){l["[object "+e+"]"]=e.toLowerCase()}));var x=i.pop,k=i.sort,T=i.splice,I="[\\x20\\t\\r\\n\\f]",E=new RegExp("^"+I+"+|((?:^|[^\\\\])(?:\\\\.)*)"+I+"+$","g");A.contains=function(t,e){var i=e&&e.parentNode;return t===i||!(!i||1!==i.nodeType||!(t.contains?t.contains(i):t.compareDocumentPosition&&16&t.compareDocumentPosition(i)))};var P=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function D(t,e){return e?"\0"===t?"�":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t}A.escapeSelector=function(t){return(t+"").replace(P,D)};var M=f,U=a;!function(){var e,o,s,a,l,c,d,m,u,g,f=U,b=A.expando,C=0,v=0,_=tt(),w=tt(),y=tt(),P=tt(),D=function(t,e){return t===e&&(l=!0),0},F="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",R="(?:\\\\[\\da-fA-F]{1,6}"+I+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",L="\\["+I+"*("+R+")(?:"+I+"*([*^$|!~]?=)"+I+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+R+"))|)"+I+"*\\]",B=":("+R+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+L+")*)|.*)\\)|)",V=new RegExp(I+"+","g"),O=new RegExp("^"+I+"*,"+I+"*"),H=new RegExp("^"+I+"*([>+~]|"+I+")"+I+"*"),N=new RegExp(I+"|>"),G=new RegExp(B),$=new RegExp("^"+R+"$"),z={ID:new RegExp("^#("+R+")"),CLASS:new RegExp("^\\.("+R+")"),TAG:new RegExp("^("+R+"|[*])"),ATTR:new RegExp("^"+L),PSEUDO:new RegExp("^"+B),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+I+"*(even|odd|(([+-]|)(\\d*)n|)"+I+"*(?:([+-]|)"+I+"*(\\d+)|))"+I+"*\\)|)","i"),bool:new RegExp("^(?:"+F+")$","i"),needsContext:new RegExp("^"+I+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+I+"*((?:-\\d)?\\d*)"+I+"*\\)|)(?=[^-]|$)","i")},W=/^(?:input|select|textarea|button)$/i,j=/^h\d$/i,K=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,q=/[+~]/,Y=new RegExp("\\\\[\\da-fA-F]{1,6}"+I+"?|\\\\([^\\r\\n\\f])","g"),Q=function(t,e){var i="0x"+t.slice(1)-65536;return e||(i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320))},X=function(){lt()},Z=mt((function(t){return!0===t.disabled&&S(t,"fieldset")}),{dir:"parentNode",next:"legend"});try{f.apply(i=n.call(M.childNodes),M.childNodes),i[M.childNodes.length].nodeType}catch(t){f={apply:function(t,e){U.apply(t,n.call(e))},call:function(t){U.apply(t,n.call(arguments,1))}}}function J(t,e,i,o){var n,s,a,r,l,h,d,g=e&&e.ownerDocument,C=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==C&&9!==C&&11!==C)return i;if(!o&&(lt(e),e=e||c,m)){if(11!==C&&(l=K.exec(t)))if(n=l[1]){if(9===C){if(!(a=e.getElementById(n)))return i;if(a.id===n)return f.call(i,a),i}else if(g&&(a=g.getElementById(n))&&J.contains(e,a)&&a.id===n)return f.call(i,a),i}else{if(l[2])return f.apply(i,e.getElementsByTagName(t)),i;if((n=l[3])&&e.getElementsByClassName)return f.apply(i,e.getElementsByClassName(n)),i}if(!(P[t+" "]||u&&u.test(t))){if(d=t,g=e,1===C&&(N.test(t)||H.test(t))){for((g=q.test(t)&&rt(e.parentNode)||e)==e&&p.scope||((r=e.getAttribute("id"))?r=A.escapeSelector(r):e.setAttribute("id",r=b)),s=(h=ht(t)).length;s--;)h[s]=(r?"#"+r:":scope")+" "+dt(h[s]);d=h.join(",")}try{return f.apply(i,g.querySelectorAll(d)),i}catch(e){P(t,!0)}finally{r===b&&e.removeAttribute("id")}}}return Ct(t.replace(E,"$1"),e,i,o)}function tt(){var t=[];return function e(i,n){return t.push(i+" ")>o.cacheLength&&delete e[t.shift()],e[i+" "]=n}}function et(t){return t[b]=!0,t}function it(t){var e=c.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function ot(t){return function(e){return S(e,"input")&&e.type===t}}function nt(t){return function(e){return(S(e,"input")||S(e,"button"))&&e.type===t}}function st(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&Z(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function at(t){return et((function(e){return e=+e,et((function(i,o){for(var n,s=t([],i.length,e),a=s.length;a--;)i[n=s[a]]&&(i[n]=!(o[n]=i[n]))}))}))}function rt(t){return t&&void 0!==t.getElementsByTagName&&t}function lt(t){var e,i=t?t.ownerDocument||t:M;return i!=c&&9===i.nodeType&&i.documentElement?(d=(c=i).documentElement,m=!A.isXMLDoc(c),g=d.matches||d.webkitMatchesSelector||d.msMatchesSelector,d.msMatchesSelector&&M!=c&&(e=c.defaultView)&&e.top!==e&&e.addEventListener("unload",X),p.getById=it((function(t){return d.appendChild(t).id=A.expando,!c.getElementsByName||!c.getElementsByName(A.expando).length})),p.disconnectedMatch=it((function(t){return g.call(t,"*")})),p.scope=it((function(){return c.querySelectorAll(":scope")})),p.cssHas=it((function(){try{return c.querySelector(":has(*,:jqfake)"),!1}catch(t){return!0}})),p.getById?(o.filter.ID=function(t){var e=t.replace(Y,Q);return function(t){return t.getAttribute("id")===e}},o.find.ID=function(t,e){if(void 0!==e.getElementById&&m){var i=e.getElementById(t);return i?[i]:[]}}):(o.filter.ID=function(t){var e=t.replace(Y,Q);return function(t){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}},o.find.ID=function(t,e){if(void 0!==e.getElementById&&m){var i,o,n,s=e.getElementById(t);if(s){if((i=s.getAttributeNode("id"))&&i.value===t)return[s];for(n=e.getElementsByName(t),o=0;s=n[o++];)if((i=s.getAttributeNode("id"))&&i.value===t)return[s]}return[]}}),o.find.TAG=function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):e.querySelectorAll(t)},o.find.CLASS=function(t,e){if(void 0!==e.getElementsByClassName&&m)return e.getElementsByClassName(t)},u=[],it((function(t){var e;d.appendChild(t).innerHTML="<a id='"+b+"' href='' disabled='disabled'></a><select id='"+b+"-\r\\' disabled='disabled'><option selected=''></option></select>",t.querySelectorAll("[selected]").length||u.push("\\["+I+"*(?:value|"+F+")"),t.querySelectorAll("[id~="+b+"-]").length||u.push("~="),t.querySelectorAll("a#"+b+"+*").length||u.push(".#.+[+~]"),t.querySelectorAll(":checked").length||u.push(":checked"),(e=c.createElement("input")).setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),d.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&u.push(":enabled",":disabled"),(e=c.createElement("input")).setAttribute("name",""),t.appendChild(e),t.querySelectorAll("[name='']").length||u.push("\\["+I+"*name"+I+"*="+I+"*(?:''|\"\")")})),p.cssHas||u.push(":has"),u=u.length&&new RegExp(u.join("|")),D=function(t,e){if(t===e)return l=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i||(1&(i=(t.ownerDocument||t)==(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!p.sortDetached&&e.compareDocumentPosition(t)===i?t===c||t.ownerDocument==M&&J.contains(M,t)?-1:e===c||e.ownerDocument==M&&J.contains(M,e)?1:a?r.call(a,t)-r.call(a,e):0:4&i?-1:1)},c):c}for(e in J.matches=function(t,e){return J(t,null,null,e)},J.matchesSelector=function(t,e){if(lt(t),m&&!P[e+" "]&&(!u||!u.test(e)))try{var i=g.call(t,e);if(i||p.disconnectedMatch||t.document&&11!==t.document.nodeType)return i}catch(t){P(e,!0)}return J(e,c,null,[t]).length>0},J.contains=function(t,e){return(t.ownerDocument||t)!=c&&lt(t),A.contains(t,e)},J.attr=function(t,e){(t.ownerDocument||t)!=c&&lt(t);var i=o.attrHandle[e.toLowerCase()],n=i&&h.call(o.attrHandle,e.toLowerCase())?i(t,e,!m):void 0;return void 0!==n?n:t.getAttribute(e)},J.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},A.uniqueSort=function(t){var e,i=[],o=0,s=0;if(l=!p.sortStable,a=!p.sortStable&&n.call(t,0),k.call(t,D),l){for(;e=t[s++];)e===t[s]&&(o=i.push(s));for(;o--;)T.call(t,i[o],1)}return a=null,t},A.fn.uniqueSort=function(){return this.pushStack(A.uniqueSort(n.apply(this)))},o=A.expr={cacheLength:50,createPseudo:et,match:z,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(Y,Q),t[3]=(t[3]||t[4]||t[5]||"").replace(Y,Q),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||J.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&J.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return z.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&G.test(i)&&(e=ht(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(Y,Q).toLowerCase();return"*"===t?function(){return!0}:function(t){return S(t,e)}},CLASS:function(t){var e=_[t+" "];return e||(e=new RegExp("(^|"+I+")"+t+"("+I+"|$)"))&&_(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,i){return function(o){var n=J.attr(o,t);return null==n?"!="===e:!e||(n+="","="===e?n===i:"!="===e?n!==i:"^="===e?i&&0===n.indexOf(i):"*="===e?i&&n.indexOf(i)>-1:"$="===e?i&&n.slice(-i.length)===i:"~="===e?(" "+n.replace(V," ")+" ").indexOf(i)>-1:"|="===e&&(n===i||n.slice(0,i.length+1)===i+"-"))}},CHILD:function(t,e,i,o,n){var s="nth"!==t.slice(0,3),a="last"!==t.slice(-4),r="of-type"===e;return 1===o&&0===n?function(t){return!!t.parentNode}:function(e,i,l){var c,h,d,m,p,u=s!==a?"nextSibling":"previousSibling",g=e.parentNode,f=r&&e.nodeName.toLowerCase(),v=!l&&!r,_=!1;if(g){if(s){for(;u;){for(d=e;d=d[u];)if(r?S(d,f):1===d.nodeType)return!1;p=u="only"===t&&!p&&"nextSibling"}return!0}if(p=[a?g.firstChild:g.lastChild],a&&v){for(_=(m=(c=(h=g[b]||(g[b]={}))[t]||[])[0]===C&&c[1])&&c[2],d=m&&g.childNodes[m];d=++m&&d&&d[u]||(_=m=0)||p.pop();)if(1===d.nodeType&&++_&&d===e){h[t]=[C,m,_];break}}else if(v&&(_=m=(c=(h=e[b]||(e[b]={}))[t]||[])[0]===C&&c[1]),!1===_)for(;(d=++m&&d&&d[u]||(_=m=0)||p.pop())&&(!(r?S(d,f):1===d.nodeType)||!++_||(v&&((h=d[b]||(d[b]={}))[t]=[C,_]),d!==e)););return(_-=n)===o||_%o==0&&_/o>=0}}},PSEUDO:function(t,e){var i,n=o.pseudos[t]||o.setFilters[t.toLowerCase()]||J.error("unsupported pseudo: "+t);return n[b]?n(e):n.length>1?(i=[t,t,"",e],o.setFilters.hasOwnProperty(t.toLowerCase())?et((function(t,i){for(var o,s=n(t,e),a=s.length;a--;)t[o=r.call(t,s[a])]=!(i[o]=s[a])})):function(t){return n(t,0,i)}):n}},pseudos:{not:et((function(t){var e=[],i=[],o=bt(t.replace(E,"$1"));return o[b]?et((function(t,e,i,n){for(var s,a=o(t,null,n,[]),r=t.length;r--;)(s=a[r])&&(t[r]=!(e[r]=s))})):function(t,n,s){return e[0]=t,o(e,null,s,i),e[0]=null,!i.pop()}})),has:et((function(t){return function(e){return J(t,e).length>0}})),contains:et((function(t){return t=t.replace(Y,Q),function(e){return(e.textContent||A.text(e)).indexOf(t)>-1}})),lang:et((function(t){return $.test(t||"")||J.error("unsupported lang: "+t),t=t.replace(Y,Q).toLowerCase(),function(e){var i;do{if(i=m?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===d},focus:function(t){return t===function(){try{return c.activeElement}catch(t){}}()&&c.hasFocus()&&!!(t.type||t.href||~t.tabIndex)},enabled:st(!1),disabled:st(!0),checked:function(t){return S(t,"input")&&!!t.checked||S(t,"option")&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!o.pseudos.empty(t)},header:function(t){return j.test(t.nodeName)},input:function(t){return W.test(t.nodeName)},button:function(t){return S(t,"input")&&"button"===t.type||S(t,"button")},text:function(t){var e;return S(t,"input")&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:at((function(){return[0]})),last:at((function(t,e){return[e-1]})),eq:at((function(t,e,i){return[i<0?i+e:i]})),even:at((function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t})),odd:at((function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t})),lt:at((function(t,e,i){var o;for(o=i<0?i+e:i>e?e:i;--o>=0;)t.push(o);return t})),gt:at((function(t,e,i){for(var o=i<0?i+e:i;++o<e;)t.push(o);return t}))}},o.pseudos.nth=o.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})o.pseudos[e]=ot(e);for(e in{submit:!0,reset:!0})o.pseudos[e]=nt(e);function ct(){}function ht(t,e){var i,n,s,a,r,l,c,h=w[t+" "];if(h)return e?0:h.slice(0);for(r=t,l=[],c=o.preFilter;r;){for(a in i&&!(n=O.exec(r))||(n&&(r=r.slice(n[0].length)||r),l.push(s=[])),i=!1,(n=H.exec(r))&&(i=n.shift(),s.push({value:i,type:n[0].replace(E," ")}),r=r.slice(i.length)),o.filter)!(n=z[a].exec(r))||c[a]&&!(n=c[a](n))||(i=n.shift(),s.push({value:i,type:a,matches:n}),r=r.slice(i.length));if(!i)break}return e?r.length:r?J.error(t):w(t,l).slice(0)}function dt(t){for(var e=0,i=t.length,o="";e<i;e++)o+=t[e].value;return o}function mt(t,e,i){var o=e.dir,n=e.next,s=n||o,a=i&&"parentNode"===s,r=v++;return e.first?function(e,i,n){for(;e=e[o];)if(1===e.nodeType||a)return t(e,i,n);return!1}:function(e,i,l){var c,h,d=[C,r];if(l){for(;e=e[o];)if((1===e.nodeType||a)&&t(e,i,l))return!0}else for(;e=e[o];)if(1===e.nodeType||a)if(h=e[b]||(e[b]={}),n&&S(e,n))e=e[o]||e;else{if((c=h[s])&&c[0]===C&&c[1]===r)return d[2]=c[2];if(h[s]=d,d[2]=t(e,i,l))return!0}return!1}}function pt(t){return t.length>1?function(e,i,o){for(var n=t.length;n--;)if(!t[n](e,i,o))return!1;return!0}:t[0]}function ut(t,e,i,o,n){for(var s,a=[],r=0,l=t.length,c=null!=e;r<l;r++)(s=t[r])&&(i&&!i(s,o,n)||(a.push(s),c&&e.push(r)));return a}function gt(t,e,i,o,n,s){return o&&!o[b]&&(o=gt(o)),n&&!n[b]&&(n=gt(n,s)),et((function(s,a,l,c){var h,d,m,p,u=[],g=[],b=a.length,C=s||function(t,e,i){for(var o=0,n=e.length;o<n;o++)J(t,e[o],i);return i}(e||"*",l.nodeType?[l]:l,[]),v=!t||!s&&e?C:ut(C,u,t,l,c);if(i?i(v,p=n||(s?t:b||o)?[]:a,l,c):p=v,o)for(h=ut(p,g),o(h,[],l,c),d=h.length;d--;)(m=h[d])&&(p[g[d]]=!(v[g[d]]=m));if(s){if(n||t){if(n){for(h=[],d=p.length;d--;)(m=p[d])&&h.push(v[d]=m);n(null,p=[],h,c)}for(d=p.length;d--;)(m=p[d])&&(h=n?r.call(s,m):u[d])>-1&&(s[h]=!(a[h]=m))}}else p=ut(p===a?p.splice(b,p.length):p),n?n(null,a,p,c):f.apply(a,p)}))}function ft(t){for(var e,i,n,a=t.length,l=o.relative[t[0].type],c=l||o.relative[" "],h=l?1:0,d=mt((function(t){return t===e}),c,!0),m=mt((function(t){return r.call(e,t)>-1}),c,!0),p=[function(t,i,o){var n=!l&&(o||i!=s)||((e=i).nodeType?d(t,i,o):m(t,i,o));return e=null,n}];h<a;h++)if(i=o.relative[t[h].type])p=[mt(pt(p),i)];else{if((i=o.filter[t[h].type].apply(null,t[h].matches))[b]){for(n=++h;n<a&&!o.relative[t[n].type];n++);return gt(h>1&&pt(p),h>1&&dt(t.slice(0,h-1).concat({value:" "===t[h-2].type?"*":""})).replace(E,"$1"),i,h<n&&ft(t.slice(h,n)),n<a&&ft(t=t.slice(n)),n<a&&dt(t))}p.push(i)}return pt(p)}function bt(t,e){var i,n=[],a=[],r=y[t+" "];if(!r){for(e||(e=ht(t)),i=e.length;i--;)(r=ft(e[i]))[b]?n.push(r):a.push(r);r=y(t,function(t,e){var i=e.length>0,n=t.length>0,a=function(a,r,l,h,d){var p,u,g,b=0,v="0",_=a&&[],w=[],y=s,S=a||n&&o.find.TAG("*",d),k=C+=null==y?1:Math.random()||.1,T=S.length;for(d&&(s=r==c||r||d);v!==T&&null!=(p=S[v]);v++){if(n&&p){for(u=0,r||p.ownerDocument==c||(lt(p),l=!m);g=t[u++];)if(g(p,r||c,l)){f.call(h,p);break}d&&(C=k)}i&&((p=!g&&p)&&b--,a&&_.push(p))}if(b+=v,i&&v!==b){for(u=0;g=e[u++];)g(_,w,r,l);if(a){if(b>0)for(;v--;)_[v]||w[v]||(w[v]=x.call(h));w=ut(w)}f.apply(h,w),d&&!a&&w.length>0&&b+e.length>1&&A.uniqueSort(h)}return d&&(C=k,s=y),_};return i?et(a):a}(a,n)),r.selector=t}return r}function Ct(t,e,i,n){var s,a,r,l,c,h="function"==typeof t&&t,d=!n&&ht(t=h.selector||t);if(i=i||[],1===d.length){if((a=d[0]=d[0].slice(0)).length>2&&"ID"===(r=a[0]).type&&9===e.nodeType&&m&&o.relative[a[1].type]){if(!(e=(o.find.ID(r.matches[0].replace(Y,Q),e)||[])[0]))return i;h&&(e=e.parentNode),t=t.slice(a.shift().value.length)}for(s=z.needsContext.test(t)?0:a.length;s--&&(r=a[s],!o.relative[l=r.type]);)if((c=o.find[l])&&(n=c(r.matches[0].replace(Y,Q),q.test(a[0].type)&&rt(e.parentNode)||e))){if(a.splice(s,1),!(t=n.length&&dt(a)))return f.apply(i,n),i;break}}return(h||bt(t,d))(n,e,!m,i,!e||q.test(t)&&rt(e.parentNode)||e),i}ct.prototype=o.filters=o.pseudos,o.setFilters=new ct,p.sortStable=b.split("").sort(D).join("")===b,lt(),p.sortDetached=it((function(t){return 1&t.compareDocumentPosition(c.createElement("fieldset"))})),A.find=J,A.expr[":"]=A.expr.pseudos,A.unique=A.uniqueSort,J.compile=bt,J.select=Ct,J.setDocument=lt,J.tokenize=ht,J.escape=A.escapeSelector,J.getText=A.text,J.isXML=A.isXMLDoc,J.selectors=A.expr,J.support=A.support,J.uniqueSort=A.uniqueSort}();var F=function(t,e,i){for(var o=[],n=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(n&&A(t).is(i))break;o.push(t)}return o},R=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},L=A.expr.match.needsContext,B=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function V(t,e,i){return u(e)?A.grep(t,(function(t,o){return!!e.call(t,o,t)!==i})):e.nodeType?A.grep(t,(function(t){return t===e!==i})):"string"!=typeof e?A.grep(t,(function(t){return r.call(e,t)>-1!==i})):A.filter(e,t,i)}A.filter=function(t,e,i){var o=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===o.nodeType?A.find.matchesSelector(o,t)?[o]:[]:A.find.matches(t,A.grep(e,(function(t){return 1===t.nodeType})))},A.fn.extend({find:function(t){var e,i,o=this.length,n=this;if("string"!=typeof t)return this.pushStack(A(t).filter((function(){for(e=0;e<o;e++)if(A.contains(n[e],this))return!0})));for(i=this.pushStack([]),e=0;e<o;e++)A.find(t,n[e],i);return o>1?A.uniqueSort(i):i},filter:function(t){return this.pushStack(V(this,t||[],!1))},not:function(t){return this.pushStack(V(this,t||[],!0))},is:function(t){return!!V(this,"string"==typeof t&&L.test(t)?A(t):t||[],!1).length}});var O,H=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(A.fn.init=function(t,e,i){var o,n;if(!t)return this;if(i=i||O,"string"==typeof t){if(!(o="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:H.exec(t))||!o[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(o[1]){if(e=e instanceof A?e[0]:e,A.merge(this,A.parseHTML(o[1],e&&e.nodeType?e.ownerDocument||e:f,!0)),B.test(o[1])&&A.isPlainObject(e))for(o in e)u(this[o])?this[o](e[o]):this.attr(o,e[o]);return this}return(n=f.getElementById(o[2]))&&(this[0]=n,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):u(t)?void 0!==i.ready?i.ready(t):t(A):A.makeArray(t,this)}).prototype=A.fn,O=A(f);var N=/^(?:parents|prev(?:Until|All))/,G={children:!0,contents:!0,next:!0,prev:!0};function $(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}A.fn.extend({has:function(t){var e=A(t,this),i=e.length;return this.filter((function(){for(var t=0;t<i;t++)if(A.contains(this,e[t]))return!0}))},closest:function(t,e){var i,o=0,n=this.length,s=[],a="string"!=typeof t&&A(t);if(!L.test(t))for(;o<n;o++)for(i=this[o];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(a?a.index(i)>-1:1===i.nodeType&&A.find.matchesSelector(i,t))){s.push(i);break}return this.pushStack(s.length>1?A.uniqueSort(s):s)},index:function(t){return t?"string"==typeof t?r.call(A(t),this[0]):r.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(A.uniqueSort(A.merge(this.get(),A(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),A.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return F(t,"parentNode")},parentsUntil:function(t,e,i){return F(t,"parentNode",i)},next:function(t){return $(t,"nextSibling")},prev:function(t){return $(t,"previousSibling")},nextAll:function(t){return F(t,"nextSibling")},prevAll:function(t){return F(t,"previousSibling")},nextUntil:function(t,e,i){return F(t,"nextSibling",i)},prevUntil:function(t,e,i){return F(t,"previousSibling",i)},siblings:function(t){return R((t.parentNode||{}).firstChild,t)},children:function(t){return R(t.firstChild)},contents:function(t){return null!=t.contentDocument&&o(t.contentDocument)?t.contentDocument:(S(t,"template")&&(t=t.content||t),A.merge([],t.childNodes))}},(function(t,e){A.fn[t]=function(i,o){var n=A.map(this,e,i);return"Until"!==t.slice(-5)&&(o=i),o&&"string"==typeof o&&(n=A.filter(o,n)),this.length>1&&(G[t]||A.uniqueSort(n),N.test(t)&&n.reverse()),this.pushStack(n)}}));var z=/[^\x20\t\r\n\f]+/g;function W(t){return t}function j(t){throw t}function K(t,e,i,o){var n;try{t&&u(n=t.promise)?n.call(t).done(e).fail(i):t&&u(n=t.then)?n.call(t,e,i):e.apply(void 0,[t].slice(o))}catch(t){i.apply(void 0,[t])}}A.Callbacks=function(t){t="string"==typeof t?function(t){var e={};return A.each(t.match(z)||[],(function(t,i){e[i]=!0})),e}(t):A.extend({},t);var e,i,o,n,s=[],a=[],r=-1,l=function(){for(n=n||t.once,o=e=!0;a.length;r=-1)for(i=a.shift();++r<s.length;)!1===s[r].apply(i[0],i[1])&&t.stopOnFalse&&(r=s.length,i=!1);t.memory||(i=!1),e=!1,n&&(s=i?[]:"")},c={add:function(){return s&&(i&&!e&&(r=s.length-1,a.push(i)),function e(i){A.each(i,(function(i,o){u(o)?t.unique&&c.has(o)||s.push(o):o&&o.length&&"string"!==v(o)&&e(o)}))}(arguments),i&&!e&&l()),this},remove:function(){return A.each(arguments,(function(t,e){for(var i;(i=A.inArray(e,s,i))>-1;)s.splice(i,1),i<=r&&r--})),this},has:function(t){return t?A.inArray(t,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return n=a=[],s=i="",this},disabled:function(){return!s},lock:function(){return n=a=[],i||e||(s=i=""),this},locked:function(){return!!n},fireWith:function(t,i){return n||(i=[t,(i=i||[]).slice?i.slice():i],a.push(i),e||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!o}};return c},A.extend({Deferred:function(e){var i=[["notify","progress",A.Callbacks("memory"),A.Callbacks("memory"),2],["resolve","done",A.Callbacks("once memory"),A.Callbacks("once memory"),0,"resolved"],["reject","fail",A.Callbacks("once memory"),A.Callbacks("once memory"),1,"rejected"]],o="pending",n={state:function(){return o},always:function(){return s.done(arguments).fail(arguments),this},catch:function(t){return n.then(null,t)},pipe:function(){var t=arguments;return A.Deferred((function(e){A.each(i,(function(i,o){var n=u(t[o[4]])&&t[o[4]];s[o[1]]((function(){var t=n&&n.apply(this,arguments);t&&u(t.promise)?t.promise().progress(e.notify).done(e.resolve).fail(e.reject):e[o[0]+"With"](this,n?[t]:arguments)}))})),t=null})).promise()},then:function(e,o,n){var s=0;function a(e,i,o,n){return function(){var r=this,l=arguments,c=function(){var t,c;if(!(e<s)){if((t=o.apply(r,l))===i.promise())throw new TypeError("Thenable self-resolution");c=t&&("object"===_typeof(t)||"function"==typeof t)&&t.then,u(c)?n?c.call(t,a(s,i,W,n),a(s,i,j,n)):(s++,c.call(t,a(s,i,W,n),a(s,i,j,n),a(s,i,W,i.notifyWith))):(o!==W&&(r=void 0,l=[t]),(n||i.resolveWith)(r,l))}},h=n?c:function(){try{c()}catch(t){A.Deferred.exceptionHook&&A.Deferred.exceptionHook(t,h.error),e+1>=s&&(o!==j&&(r=void 0,l=[t]),i.rejectWith(r,l))}};e?h():(A.Deferred.getErrorHook?h.error=A.Deferred.getErrorHook():A.Deferred.getStackHook&&(h.error=A.Deferred.getStackHook()),t.setTimeout(h))}}return A.Deferred((function(t){i[0][3].add(a(0,t,u(n)?n:W,t.notifyWith)),i[1][3].add(a(0,t,u(e)?e:W)),i[2][3].add(a(0,t,u(o)?o:j))})).promise()},promise:function(t){return null!=t?A.extend(t,n):n}},s={};return A.each(i,(function(t,e){var a=e[2],r=e[5];n[e[1]]=a.add,r&&a.add((function(){o=r}),i[3-t][2].disable,i[3-t][3].disable,i[0][2].lock,i[0][3].lock),a.add(e[3].fire),s[e[0]]=function(){return s[e[0]+"With"](this===s?void 0:this,arguments),this},s[e[0]+"With"]=a.fireWith})),n.promise(s),e&&e.call(s,s),s},when:function(t){var e=arguments.length,i=e,o=Array(i),s=n.call(arguments),a=A.Deferred(),r=function(t){return function(i){o[t]=this,s[t]=arguments.length>1?n.call(arguments):i,--e||a.resolveWith(o,s)}};if(e<=1&&(K(t,a.done(r(i)).resolve,a.reject,!e),"pending"===a.state()||u(s[i]&&s[i].then)))return a.then();for(;i--;)K(s[i],r(i),a.reject);return a.promise()}});var q=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;A.Deferred.exceptionHook=function(e,i){t.console&&t.console.warn&&e&&q.test(e.name)&&t.console.warn("jQuery.Deferred exception: "+e.message,e.stack,i)},A.readyException=function(e){t.setTimeout((function(){throw e}))};var Y=A.Deferred();function Q(){f.removeEventListener("DOMContentLoaded",Q),t.removeEventListener("load",Q),A.ready()}A.fn.ready=function(t){return Y.then(t).catch((function(t){A.readyException(t)})),this},A.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--A.readyWait:A.isReady)||(A.isReady=!0,!0!==t&&--A.readyWait>0||Y.resolveWith(f,[A]))}}),A.ready.then=Y.then,"complete"===f.readyState||"loading"!==f.readyState&&!f.documentElement.doScroll?t.setTimeout(A.ready):(f.addEventListener("DOMContentLoaded",Q),t.addEventListener("load",Q));var X=function(t,e,i,o,n,s,a){var r=0,l=t.length,c=null==i;if("object"===v(i))for(r in n=!0,i)X(t,e,r,i[r],!0,s,a);else if(void 0!==o&&(n=!0,u(o)||(a=!0),c&&(a?(e.call(t,o),e=null):(c=e,e=function(t,e,i){return c.call(A(t),i)})),e))for(;r<l;r++)e(t[r],i,a?o:o.call(t[r],r,e(t[r],i)));return n?t:c?e.call(t):l?e(t[0],i):s},Z=/^-ms-/,J=/-([a-z])/g;function tt(t,e){return e.toUpperCase()}function et(t){return t.replace(Z,"ms-").replace(J,tt)}var it=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function ot(){this.expando=A.expando+ot.uid++}ot.uid=1,ot.prototype={cache:function(t){var e=t[this.expando];return e||(e={},it(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var o,n=this.cache(t);if("string"==typeof e)n[et(e)]=i;else for(o in e)n[et(o)]=e[o];return n},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][et(e)]},access:function(t,e,i){return void 0===e||e&&"string"==typeof e&&void 0===i?this.get(t,e):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,o=t[this.expando];if(void 0!==o){if(void 0!==e){i=(e=Array.isArray(e)?e.map(et):(e=et(e))in o?[e]:e.match(z)||[]).length;for(;i--;)delete o[e[i]]}(void 0===e||A.isEmptyObject(o))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!A.isEmptyObject(e)}};var nt=new ot,st=new ot,at=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rt=/[A-Z]/g;function lt(t,e,i){var o;if(void 0===i&&1===t.nodeType)if(o="data-"+e.replace(rt,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(o))){try{i=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:at.test(t)?JSON.parse(t):t)}(i)}catch(t){}st.set(t,e,i)}else i=void 0;return i}A.extend({hasData:function(t){return st.hasData(t)||nt.hasData(t)},data:function(t,e,i){return st.access(t,e,i)},removeData:function(t,e){st.remove(t,e)},_data:function(t,e,i){return nt.access(t,e,i)},_removeData:function(t,e){nt.remove(t,e)}}),A.fn.extend({data:function(t,e){var i,o,n,s=this[0],a=s&&s.attributes;if(void 0===t){if(this.length&&(n=st.get(s),1===s.nodeType&&!nt.get(s,"hasDataAttrs"))){for(i=a.length;i--;)a[i]&&0===(o=a[i].name).indexOf("data-")&&(o=et(o.slice(5)),lt(s,o,n[o]));nt.set(s,"hasDataAttrs",!0)}return n}return"object"===_typeof(t)?this.each((function(){st.set(this,t)})):X(this,(function(e){var i;if(s&&void 0===e)return void 0!==(i=st.get(s,t))||void 0!==(i=lt(s,t))?i:void 0;this.each((function(){st.set(this,t,e)}))}),null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){st.remove(this,t)}))}}),A.extend({queue:function(t,e,i){var o;if(t)return e=(e||"fx")+"queue",o=nt.get(t,e),i&&(!o||Array.isArray(i)?o=nt.access(t,e,A.makeArray(i)):o.push(i)),o||[]},dequeue:function(t,e){e=e||"fx";var i=A.queue(t,e),o=i.length,n=i.shift(),s=A._queueHooks(t,e);"inprogress"===n&&(n=i.shift(),o--),n&&("fx"===e&&i.unshift("inprogress"),delete s.stop,n.call(t,(function(){A.dequeue(t,e)}),s)),!o&&s&&s.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return nt.get(t,i)||nt.access(t,i,{empty:A.Callbacks("once memory").add((function(){nt.remove(t,[e+"queue",i])}))})}}),A.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?A.queue(this[0],t):void 0===e?this:this.each((function(){var i=A.queue(this,t,e);A._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&A.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){A.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,o=1,n=A.Deferred(),s=this,a=this.length,r=function(){--o||n.resolveWith(s,[s])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";a--;)(i=nt.get(s[a],t+"queueHooks"))&&i.empty&&(o++,i.empty.add(r));return r(),n.promise(e)}});var ct=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ht=new RegExp("^(?:([+-])=|)("+ct+")([a-z%]*)$","i"),dt=["Top","Right","Bottom","Left"],mt=f.documentElement,pt=function(t){return A.contains(t.ownerDocument,t)},ut={composed:!0};mt.getRootNode&&(pt=function(t){return A.contains(t.ownerDocument,t)||t.getRootNode(ut)===t.ownerDocument});var gt=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&pt(t)&&"none"===A.css(t,"display")};function ft(t,e,i,o){var n,s,a=20,r=o?function(){return o.cur()}:function(){return A.css(t,e,"")},l=r(),c=i&&i[3]||(A.cssNumber[e]?"":"px"),h=t.nodeType&&(A.cssNumber[e]||"px"!==c&&+l)&&ht.exec(A.css(t,e));if(h&&h[3]!==c){for(l/=2,c=c||h[3],h=+l||1;a--;)A.style(t,e,h+c),(1-s)*(1-(s=r()/l||.5))<=0&&(a=0),h/=s;h*=2,A.style(t,e,h+c),i=i||[]}return i&&(h=+h||+l||0,n=i[1]?h+(i[1]+1)*i[2]:+i[2],o&&(o.unit=c,o.start=h,o.end=n)),n}var bt={};function Ct(t){var e,i=t.ownerDocument,o=t.nodeName,n=bt[o];return n||(e=i.body.appendChild(i.createElement(o)),n=A.css(e,"display"),e.parentNode.removeChild(e),"none"===n&&(n="block"),bt[o]=n,n)}function vt(t,e){for(var i,o,n=[],s=0,a=t.length;s<a;s++)(o=t[s]).style&&(i=o.style.display,e?("none"===i&&(n[s]=nt.get(o,"display")||null,n[s]||(o.style.display="")),""===o.style.display&&gt(o)&&(n[s]=Ct(o))):"none"!==i&&(n[s]="none",nt.set(o,"display",i)));for(s=0;s<a;s++)null!=n[s]&&(t[s].style.display=n[s]);return t}A.fn.extend({show:function(){return vt(this,!0)},hide:function(){return vt(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){gt(this)?A(this).show():A(this).hide()}))}});var _t,wt,At=/^(?:checkbox|radio)$/i,yt=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,St=/^$|^module$|\/(?:java|ecma)script/i;_t=f.createDocumentFragment().appendChild(f.createElement("div")),(wt=f.createElement("input")).setAttribute("type","radio"),wt.setAttribute("checked","checked"),wt.setAttribute("name","t"),_t.appendChild(wt),p.checkClone=_t.cloneNode(!0).cloneNode(!0).lastChild.checked,_t.innerHTML="<textarea>x</textarea>",p.noCloneChecked=!!_t.cloneNode(!0).lastChild.defaultValue,_t.innerHTML="<option></option>",p.option=!!_t.lastChild;var xt={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function kt(t,e){var i;return i=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&S(t,e)?A.merge([t],i):i}function Tt(t,e){for(var i=0,o=t.length;i<o;i++)nt.set(t[i],"globalEval",!e||nt.get(e[i],"globalEval"))}xt.tbody=xt.tfoot=xt.colgroup=xt.caption=xt.thead,xt.th=xt.td,p.option||(xt.optgroup=xt.option=[1,"<select multiple='multiple'>","</select>"]);var It=/<|&#?\w+;/;function Et(t,e,i,o,n){for(var s,a,r,l,c,h,d=e.createDocumentFragment(),m=[],p=0,u=t.length;p<u;p++)if((s=t[p])||0===s)if("object"===v(s))A.merge(m,s.nodeType?[s]:s);else if(It.test(s)){for(a=a||d.appendChild(e.createElement("div")),r=(yt.exec(s)||["",""])[1].toLowerCase(),l=xt[r]||xt._default,a.innerHTML=l[1]+A.htmlPrefilter(s)+l[2],h=l[0];h--;)a=a.lastChild;A.merge(m,a.childNodes),(a=d.firstChild).textContent=""}else m.push(e.createTextNode(s));for(d.textContent="",p=0;s=m[p++];)if(o&&A.inArray(s,o)>-1)n&&n.push(s);else if(c=pt(s),a=kt(d.appendChild(s),"script"),c&&Tt(a),i)for(h=0;s=a[h++];)St.test(s.type||"")&&i.push(s);return d}var Pt=/^([^.]*)(?:\.(.+)|)/;function Dt(){return!0}function Mt(){return!1}function Ut(t,e,i,o,n,s){var a,r;if("object"===_typeof(e)){for(r in"string"!=typeof i&&(o=o||i,i=void 0),e)Ut(t,r,i,o,e[r],s);return t}if(null==o&&null==n?(n=i,o=i=void 0):null==n&&("string"==typeof i?(n=o,o=void 0):(n=o,o=i,i=void 0)),!1===n)n=Mt;else if(!n)return t;return 1===s&&(a=n,n=function(t){return A().off(t),a.apply(this,arguments)},n.guid=a.guid||(a.guid=A.guid++)),t.each((function(){A.event.add(this,e,n,o,i)}))}function Ft(t,e,i){i?(nt.set(t,e,!1),A.event.add(t,e,{namespace:!1,handler:function(t){var i,o=nt.get(this,e);if(1&t.isTrigger&&this[e]){if(o)(A.event.special[e]||{}).delegateType&&t.stopPropagation();else if(o=n.call(arguments),nt.set(this,e,o),this[e](),i=nt.get(this,e),nt.set(this,e,!1),o!==i)return t.stopImmediatePropagation(),t.preventDefault(),i}else o&&(nt.set(this,e,A.event.trigger(o[0],o.slice(1),this)),t.stopPropagation(),t.isImmediatePropagationStopped=Dt)}})):void 0===nt.get(t,e)&&A.event.add(t,e,Dt)}A.event={global:{},add:function(t,e,i,o,n){var s,a,r,l,c,h,d,m,p,u,g,f=nt.get(t);if(it(t))for(i.handler&&(i=(s=i).handler,n=s.selector),n&&A.find.matchesSelector(mt,n),i.guid||(i.guid=A.guid++),(l=f.events)||(l=f.events=Object.create(null)),(a=f.handle)||(a=f.handle=function(e){return void 0!==A&&A.event.triggered!==e.type?A.event.dispatch.apply(t,arguments):void 0}),c=(e=(e||"").match(z)||[""]).length;c--;)p=g=(r=Pt.exec(e[c])||[])[1],u=(r[2]||"").split(".").sort(),p&&(d=A.event.special[p]||{},p=(n?d.delegateType:d.bindType)||p,d=A.event.special[p]||{},h=A.extend({type:p,origType:g,data:o,handler:i,guid:i.guid,selector:n,needsContext:n&&A.expr.match.needsContext.test(n),namespace:u.join(".")},s),(m=l[p])||((m=l[p]=[]).delegateCount=0,d.setup&&!1!==d.setup.call(t,o,u,a)||t.addEventListener&&t.addEventListener(p,a)),d.add&&(d.add.call(t,h),h.handler.guid||(h.handler.guid=i.guid)),n?m.splice(m.delegateCount++,0,h):m.push(h),A.event.global[p]=!0)},remove:function(t,e,i,o,n){var s,a,r,l,c,h,d,m,p,u,g,f=nt.hasData(t)&&nt.get(t);if(f&&(l=f.events)){for(c=(e=(e||"").match(z)||[""]).length;c--;)if(p=g=(r=Pt.exec(e[c])||[])[1],u=(r[2]||"").split(".").sort(),p){for(d=A.event.special[p]||{},m=l[p=(o?d.delegateType:d.bindType)||p]||[],r=r[2]&&new RegExp("(^|\\.)"+u.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=m.length;s--;)h=m[s],!n&&g!==h.origType||i&&i.guid!==h.guid||r&&!r.test(h.namespace)||o&&o!==h.selector&&("**"!==o||!h.selector)||(m.splice(s,1),h.selector&&m.delegateCount--,d.remove&&d.remove.call(t,h));a&&!m.length&&(d.teardown&&!1!==d.teardown.call(t,u,f.handle)||A.removeEvent(t,p,f.handle),delete l[p])}else for(p in l)A.event.remove(t,p+e[c],i,o,!0);A.isEmptyObject(l)&&nt.remove(t,"handle events")}},dispatch:function(t){var e,i,o,n,s,a,r=new Array(arguments.length),l=A.event.fix(t),c=(nt.get(this,"events")||Object.create(null))[l.type]||[],h=A.event.special[l.type]||{};for(r[0]=l,e=1;e<arguments.length;e++)r[e]=arguments[e];if(l.delegateTarget=this,!h.preDispatch||!1!==h.preDispatch.call(this,l)){for(a=A.event.handlers.call(this,l,c),e=0;(n=a[e++])&&!l.isPropagationStopped();)for(l.currentTarget=n.elem,i=0;(s=n.handlers[i++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==s.namespace&&!l.rnamespace.test(s.namespace)||(l.handleObj=s,l.data=s.data,void 0!==(o=((A.event.special[s.origType]||{}).handle||s.handler).apply(n.elem,r))&&!1===(l.result=o)&&(l.preventDefault(),l.stopPropagation()));return h.postDispatch&&h.postDispatch.call(this,l),l.result}},handlers:function(t,e){var i,o,n,s,a,r=[],l=e.delegateCount,c=t.target;if(l&&c.nodeType&&!("click"===t.type&&t.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==t.type||!0!==c.disabled)){for(s=[],a={},i=0;i<l;i++)void 0===a[n=(o=e[i]).selector+" "]&&(a[n]=o.needsContext?A(n,this).index(c)>-1:A.find(n,this,null,[c]).length),a[n]&&s.push(o);s.length&&r.push({elem:c,handlers:s})}return c=this,l<e.length&&r.push({elem:c,handlers:e.slice(l)}),r},addProp:function(t,e){Object.defineProperty(A.Event.prototype,t,{enumerable:!0,configurable:!0,get:u(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[A.expando]?t:new A.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var e=this||t;return At.test(e.type)&&e.click&&S(e,"input")&&Ft(e,"click",!0),!1},trigger:function(t){var e=this||t;return At.test(e.type)&&e.click&&S(e,"input")&&Ft(e,"click"),!0},_default:function(t){var e=t.target;return At.test(e.type)&&e.click&&S(e,"input")&&nt.get(e,"click")||S(e,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},A.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},A.Event=function(t,e){if(!(this instanceof A.Event))return new A.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?Dt:Mt,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&A.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[A.expando]=!0},A.Event.prototype={constructor:A.Event,isDefaultPrevented:Mt,isPropagationStopped:Mt,isImmediatePropagationStopped:Mt,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Dt,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Dt,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Dt,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},A.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},A.event.addProp),A.each({focus:"focusin",blur:"focusout"},(function(t,e){function i(t){if(f.documentMode){var i=nt.get(this,"handle"),o=A.event.fix(t);o.type="focusin"===t.type?"focus":"blur",o.isSimulated=!0,i(t),o.target===o.currentTarget&&i(o)}else A.event.simulate(e,t.target,A.event.fix(t))}A.event.special[t]={setup:function(){var o;if(Ft(this,t,!0),!f.documentMode)return!1;(o=nt.get(this,e))||this.addEventListener(e,i),nt.set(this,e,(o||0)+1)},trigger:function(){return Ft(this,t),!0},teardown:function(){var t;if(!f.documentMode)return!1;(t=nt.get(this,e)-1)?nt.set(this,e,t):(this.removeEventListener(e,i),nt.remove(this,e))},_default:function(e){return nt.get(e.target,t)},delegateType:e},A.event.special[e]={setup:function(){var o=this.ownerDocument||this.document||this,n=f.documentMode?this:o,s=nt.get(n,e);s||(f.documentMode?this.addEventListener(e,i):o.addEventListener(t,i,!0)),nt.set(n,e,(s||0)+1)},teardown:function(){var o=this.ownerDocument||this.document||this,n=f.documentMode?this:o,s=nt.get(n,e)-1;s?nt.set(n,e,s):(f.documentMode?this.removeEventListener(e,i):o.removeEventListener(t,i,!0),nt.remove(n,e))}}})),A.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){A.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,o=t.relatedTarget,n=t.handleObj;return o&&(o===this||A.contains(this,o))||(t.type=n.origType,i=n.handler.apply(this,arguments),t.type=e),i}}})),A.fn.extend({on:function(t,e,i,o){return Ut(this,t,e,i,o)},one:function(t,e,i,o){return Ut(this,t,e,i,o,1)},off:function(t,e,i){var o,n;if(t&&t.preventDefault&&t.handleObj)return o=t.handleObj,A(t.delegateTarget).off(o.namespace?o.origType+"."+o.namespace:o.origType,o.selector,o.handler),this;if("object"===_typeof(t)){for(n in t)this.off(n,e,t[n]);return this}return!1!==e&&"function"!=typeof e||(i=e,e=void 0),!1===i&&(i=Mt),this.each((function(){A.event.remove(this,t,i,e)}))}});var Rt=/<script|<style|<link/i,Lt=/checked\s*(?:[^=]|=\s*.checked.)/i,Bt=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Vt(t,e){return S(t,"table")&&S(11!==e.nodeType?e:e.firstChild,"tr")&&A(t).children("tbody")[0]||t}function Ot(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function Ht(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function Nt(t,e){var i,o,n,s,a,r;if(1===e.nodeType){if(nt.hasData(t)&&(r=nt.get(t).events))for(n in nt.remove(e,"handle events"),r)for(i=0,o=r[n].length;i<o;i++)A.event.add(e,n,r[n][i]);st.hasData(t)&&(s=st.access(t),a=A.extend({},s),st.set(e,a))}}function Gt(t,e){var i=e.nodeName.toLowerCase();"input"===i&&At.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function $t(t,e,i,o){e=s(e);var n,a,r,l,c,h,d=0,m=t.length,g=m-1,f=e[0],b=u(f);if(b||m>1&&"string"==typeof f&&!p.checkClone&&Lt.test(f))return t.each((function(n){var s=t.eq(n);b&&(e[0]=f.call(this,n,s.html())),$t(s,e,i,o)}));if(m&&(a=(n=Et(e,t[0].ownerDocument,!1,t,o)).firstChild,1===n.childNodes.length&&(n=a),a||o)){for(l=(r=A.map(kt(n,"script"),Ot)).length;d<m;d++)c=n,d!==g&&(c=A.clone(c,!0,!0),l&&A.merge(r,kt(c,"script"))),i.call(t[d],c,d);if(l)for(h=r[r.length-1].ownerDocument,A.map(r,Ht),d=0;d<l;d++)c=r[d],St.test(c.type||"")&&!nt.access(c,"globalEval")&&A.contains(h,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?A._evalUrl&&!c.noModule&&A._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},h):C(c.textContent.replace(Bt,""),c,h))}return t}function zt(t,e,i){for(var o,n=e?A.filter(e,t):t,s=0;null!=(o=n[s]);s++)i||1!==o.nodeType||A.cleanData(kt(o)),o.parentNode&&(i&&pt(o)&&Tt(kt(o,"script")),o.parentNode.removeChild(o));return t}A.extend({htmlPrefilter:function(t){return t},clone:function(t,e,i){var o,n,s,a,r=t.cloneNode(!0),l=pt(t);if(!(p.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||A.isXMLDoc(t)))for(a=kt(r),o=0,n=(s=kt(t)).length;o<n;o++)Gt(s[o],a[o]);if(e)if(i)for(s=s||kt(t),a=a||kt(r),o=0,n=s.length;o<n;o++)Nt(s[o],a[o]);else Nt(t,r);return(a=kt(r,"script")).length>0&&Tt(a,!l&&kt(t,"script")),r},cleanData:function(t){for(var e,i,o,n=A.event.special,s=0;void 0!==(i=t[s]);s++)if(it(i)){if(e=i[nt.expando]){if(e.events)for(o in e.events)n[o]?A.event.remove(i,o):A.removeEvent(i,o,e.handle);i[nt.expando]=void 0}i[st.expando]&&(i[st.expando]=void 0)}}}),A.fn.extend({detach:function(t){return zt(this,t,!0)},remove:function(t){return zt(this,t)},text:function(t){return X(this,(function(t){return void 0===t?A.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return $t(this,arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Vt(this,t).appendChild(t)}))},prepend:function(){return $t(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=Vt(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return $t(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return $t(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(A.cleanData(kt(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return A.clone(this,t,e)}))},html:function(t){return X(this,(function(t){var e=this[0]||{},i=0,o=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Rt.test(t)&&!xt[(yt.exec(t)||["",""])[1].toLowerCase()]){t=A.htmlPrefilter(t);try{for(;i<o;i++)1===(e=this[i]||{}).nodeType&&(A.cleanData(kt(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return $t(this,arguments,(function(e){var i=this.parentNode;A.inArray(this,t)<0&&(A.cleanData(kt(this)),i&&i.replaceChild(e,this))}),t)}}),A.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){A.fn[t]=function(t){for(var i,o=[],n=A(t),s=n.length-1,r=0;r<=s;r++)i=r===s?this:this.clone(!0),A(n[r])[e](i),a.apply(o,i.get());return this.pushStack(o)}}));var Wt=new RegExp("^("+ct+")(?!px)[a-z%]+$","i"),jt=/^--/,Kt=function(e){var i=e.ownerDocument.defaultView;return i&&i.opener||(i=t),i.getComputedStyle(e)},qt=function(t,e,i){var o,n,s={};for(n in e)s[n]=t.style[n],t.style[n]=e[n];for(n in o=i.call(t),e)t.style[n]=s[n];return o},Yt=new RegExp(dt.join("|"),"i");function Qt(t,e,i){var o,n,s,a,r=jt.test(e),l=t.style;return(i=i||Kt(t))&&(a=i.getPropertyValue(e)||i[e],r&&a&&(a=a.replace(E,"$1")||void 0),""!==a||pt(t)||(a=A.style(t,e)),!p.pixelBoxStyles()&&Wt.test(a)&&Yt.test(e)&&(o=l.width,n=l.minWidth,s=l.maxWidth,l.minWidth=l.maxWidth=l.width=a,a=i.width,l.width=o,l.minWidth=n,l.maxWidth=s)),void 0!==a?a+"":a}function Xt(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){function e(){if(h){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",h.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",mt.appendChild(c).appendChild(h);var e=t.getComputedStyle(h);o="1%"!==e.top,l=12===i(e.marginLeft),h.style.right="60%",a=36===i(e.right),n=36===i(e.width),h.style.position="absolute",s=12===i(h.offsetWidth/3),mt.removeChild(c),h=null}}function i(t){return Math.round(parseFloat(t))}var o,n,s,a,r,l,c=f.createElement("div"),h=f.createElement("div");h.style&&(h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",p.clearCloneStyle="content-box"===h.style.backgroundClip,A.extend(p,{boxSizingReliable:function(){return e(),n},pixelBoxStyles:function(){return e(),a},pixelPosition:function(){return e(),o},reliableMarginLeft:function(){return e(),l},scrollboxSize:function(){return e(),s},reliableTrDimensions:function(){var e,i,o,n;return null==r&&(e=f.createElement("table"),i=f.createElement("tr"),o=f.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",i.style.cssText="box-sizing:content-box;border:1px solid",i.style.height="1px",o.style.height="9px",o.style.display="block",mt.appendChild(e).appendChild(i).appendChild(o),n=t.getComputedStyle(i),r=parseInt(n.height,10)+parseInt(n.borderTopWidth,10)+parseInt(n.borderBottomWidth,10)===i.offsetHeight,mt.removeChild(e)),r},forceStyleTests:function(){h=f.createElement("div"),e()}}))}();var Zt=["Webkit","Moz","ms"],Jt=f.createElement("div").style,te={};function ee(t){var e=A.cssProps[t]||te[t];return e||(t in Jt?t:te[t]=function(t){for(var e=t[0].toUpperCase()+t.slice(1),i=Zt.length;i--;)if((t=Zt[i]+e)in Jt)return t}(t)||t)}var ie=/^(none|table(?!-c[ea]).+)/,oe={position:"absolute",visibility:"hidden",display:"block"},ne={letterSpacing:"0",fontWeight:"400"};function se(t,e,i){var o=ht.exec(e);return o?Math.max(0,o[2]-(i||0))+(o[3]||"px"):e}function ae(t,e,i,o,n,s){var a="width"===e?1:0,r=0,l=0,c=0;if(i===(o?"border":"content"))return 0;for(;a<4;a+=2)"margin"===i&&(c+=A.css(t,i+dt[a],!0,n)),o?("content"===i&&(l-=A.css(t,"padding"+dt[a],!0,n)),"margin"!==i&&(l-=A.css(t,"border"+dt[a]+"Width",!0,n))):(l+=A.css(t,"padding"+dt[a],!0,n),"padding"!==i?l+=A.css(t,"border"+dt[a]+"Width",!0,n):r+=A.css(t,"border"+dt[a]+"Width",!0,n));return!o&&s>=0&&(l+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-s-l-r-.5))||0),l+c}function re(t,e,i){var o=Kt(t),n=(!p.boxSizingReliable()||i)&&"border-box"===A.css(t,"boxSizing",!1,o),s=n,a=Qt(t,e,o),r="offset"+e[0].toUpperCase()+e.slice(1);if(Wt.test(a)){if(!i)return a;a="auto"}return(!p.boxSizingReliable()&&n||!p.reliableTrDimensions()&&S(t,"tr")||"auto"===a||!parseFloat(a)&&"inline"===A.css(t,"display",!1,o))&&t.getClientRects().length&&(n="border-box"===A.css(t,"boxSizing",!1,o),(s=r in t)&&(a=t[r])),(a=parseFloat(a)||0)+ae(t,e,i||(n?"border":"content"),s,o,a)+"px"}function le(t,e,i,o,n){return new le.prototype.init(t,e,i,o,n)}A.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=Qt(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(t,e,i,o){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var n,s,a,r=et(e),l=jt.test(e),c=t.style;if(l||(e=ee(r)),a=A.cssHooks[e]||A.cssHooks[r],void 0===i)return a&&"get"in a&&void 0!==(n=a.get(t,!1,o))?n:c[e];"string"===(s=_typeof(i))&&(n=ht.exec(i))&&n[1]&&(i=ft(t,e,n),s="number"),null!=i&&i==i&&("number"!==s||l||(i+=n&&n[3]||(A.cssNumber[r]?"":"px")),p.clearCloneStyle||""!==i||0!==e.indexOf("background")||(c[e]="inherit"),a&&"set"in a&&void 0===(i=a.set(t,i,o))||(l?c.setProperty(e,i):c[e]=i))}},css:function(t,e,i,o){var n,s,a,r=et(e);return jt.test(e)||(e=ee(r)),(a=A.cssHooks[e]||A.cssHooks[r])&&"get"in a&&(n=a.get(t,!0,i)),void 0===n&&(n=Qt(t,e,o)),"normal"===n&&e in ne&&(n=ne[e]),""===i||i?(s=parseFloat(n),!0===i||isFinite(s)?s||0:n):n}}),A.each(["height","width"],(function(t,e){A.cssHooks[e]={get:function(t,i,o){if(i)return!ie.test(A.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?re(t,e,o):qt(t,oe,(function(){return re(t,e,o)}))},set:function(t,i,o){var n,s=Kt(t),a=!p.scrollboxSize()&&"absolute"===s.position,r=(a||o)&&"border-box"===A.css(t,"boxSizing",!1,s),l=o?ae(t,e,o,r,s):0;return r&&a&&(l-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(s[e])-ae(t,e,"border",!1,s)-.5)),l&&(n=ht.exec(i))&&"px"!==(n[3]||"px")&&(t.style[e]=i,i=A.css(t,e)),se(0,i,l)}}})),A.cssHooks.marginLeft=Xt(p.reliableMarginLeft,(function(t,e){if(e)return(parseFloat(Qt(t,"marginLeft"))||t.getBoundingClientRect().left-qt(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),A.each({margin:"",padding:"",border:"Width"},(function(t,e){A.cssHooks[t+e]={expand:function(i){for(var o=0,n={},s="string"==typeof i?i.split(" "):[i];o<4;o++)n[t+dt[o]+e]=s[o]||s[o-2]||s[0];return n}},"margin"!==t&&(A.cssHooks[t+e].set=se)})),A.fn.extend({css:function(t,e){return X(this,(function(t,e,i){var o,n,s={},a=0;if(Array.isArray(e)){for(o=Kt(t),n=e.length;a<n;a++)s[e[a]]=A.css(t,e[a],!1,o);return s}return void 0!==i?A.style(t,e,i):A.css(t,e)}),t,e,arguments.length>1)}}),A.Tween=le,le.prototype={constructor:le,init:function(t,e,i,o,n,s){this.elem=t,this.prop=i,this.easing=n||A.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=o,this.unit=s||(A.cssNumber[i]?"":"px")},cur:function(){var t=le.propHooks[this.prop];return t&&t.get?t.get(this):le.propHooks._default.get(this)},run:function(t){var e,i=le.propHooks[this.prop];return this.options.duration?this.pos=e=A.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):le.propHooks._default.set(this),this}},le.prototype.init.prototype=le.prototype,le.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=A.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){A.fx.step[t.prop]?A.fx.step[t.prop](t):1!==t.elem.nodeType||!A.cssHooks[t.prop]&&null==t.elem.style[ee(t.prop)]?t.elem[t.prop]=t.now:A.style(t.elem,t.prop,t.now+t.unit)}}},le.propHooks.scrollTop=le.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},A.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},A.fx=le.prototype.init,A.fx.step={};var ce,he,de=/^(?:toggle|show|hide)$/,me=/queueHooks$/;function pe(){he&&(!1===f.hidden&&t.requestAnimationFrame?t.requestAnimationFrame(pe):t.setTimeout(pe,A.fx.interval),A.fx.tick())}function ue(){return t.setTimeout((function(){ce=void 0})),ce=Date.now()}function ge(t,e){var i,o=0,n={height:t};for(e=e?1:0;o<4;o+=2-e)n["margin"+(i=dt[o])]=n["padding"+i]=t;return e&&(n.opacity=n.width=t),n}function fe(t,e,i){for(var o,n=(be.tweeners[e]||[]).concat(be.tweeners["*"]),s=0,a=n.length;s<a;s++)if(o=n[s].call(i,e,t))return o}function be(t,e,i){var o,n,s=0,a=be.prefilters.length,r=A.Deferred().always((function(){delete l.elem})),l=function(){if(n)return!1;for(var e=ce||ue(),i=Math.max(0,c.startTime+c.duration-e),o=1-(i/c.duration||0),s=0,a=c.tweens.length;s<a;s++)c.tweens[s].run(o);return r.notifyWith(t,[c,o,i]),o<1&&a?i:(a||r.notifyWith(t,[c,1,0]),r.resolveWith(t,[c]),!1)},c=r.promise({elem:t,props:A.extend({},e),opts:A.extend(!0,{specialEasing:{},easing:A.easing._default},i),originalProperties:e,originalOptions:i,startTime:ce||ue(),duration:i.duration,tweens:[],createTween:function(e,i){var o=A.Tween(t,c.opts,e,i,c.opts.specialEasing[e]||c.opts.easing);return c.tweens.push(o),o},stop:function(e){var i=0,o=e?c.tweens.length:0;if(n)return this;for(n=!0;i<o;i++)c.tweens[i].run(1);return e?(r.notifyWith(t,[c,1,0]),r.resolveWith(t,[c,e])):r.rejectWith(t,[c,e]),this}}),h=c.props;for(!function(t,e){var i,o,n,s,a;for(i in t)if(n=e[o=et(i)],s=t[i],Array.isArray(s)&&(n=s[1],s=t[i]=s[0]),i!==o&&(t[o]=s,delete t[i]),(a=A.cssHooks[o])&&"expand"in a)for(i in s=a.expand(s),delete t[o],s)i in t||(t[i]=s[i],e[i]=n);else e[o]=n}(h,c.opts.specialEasing);s<a;s++)if(o=be.prefilters[s].call(c,t,h,c.opts))return u(o.stop)&&(A._queueHooks(c.elem,c.opts.queue).stop=o.stop.bind(o)),o;return A.map(h,fe,c),u(c.opts.start)&&c.opts.start.call(t,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),A.fx.timer(A.extend(l,{elem:t,anim:c,queue:c.opts.queue})),c}A.Animation=A.extend(be,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return ft(i.elem,t,ht.exec(e),i),i}]},tweener:function(t,e){u(t)?(e=t,t=["*"]):t=t.match(z);for(var i,o=0,n=t.length;o<n;o++)i=t[o],be.tweeners[i]=be.tweeners[i]||[],be.tweeners[i].unshift(e)},prefilters:[function(t,e,i){var o,n,s,a,r,l,c,h,d="width"in e||"height"in e,m=this,p={},u=t.style,g=t.nodeType&&gt(t),f=nt.get(t,"fxshow");for(o in i.queue||(null==(a=A._queueHooks(t,"fx")).unqueued&&(a.unqueued=0,r=a.empty.fire,a.empty.fire=function(){a.unqueued||r()}),a.unqueued++,m.always((function(){m.always((function(){a.unqueued--,A.queue(t,"fx").length||a.empty.fire()}))}))),e)if(n=e[o],de.test(n)){if(delete e[o],s=s||"toggle"===n,n===(g?"hide":"show")){if("show"!==n||!f||void 0===f[o])continue;g=!0}p[o]=f&&f[o]||A.style(t,o)}if((l=!A.isEmptyObject(e))||!A.isEmptyObject(p))for(o in d&&1===t.nodeType&&(i.overflow=[u.overflow,u.overflowX,u.overflowY],null==(c=f&&f.display)&&(c=nt.get(t,"display")),"none"===(h=A.css(t,"display"))&&(c?h=c:(vt([t],!0),c=t.style.display||c,h=A.css(t,"display"),vt([t]))),("inline"===h||"inline-block"===h&&null!=c)&&"none"===A.css(t,"float")&&(l||(m.done((function(){u.display=c})),null==c&&(h=u.display,c="none"===h?"":h)),u.display="inline-block")),i.overflow&&(u.overflow="hidden",m.always((function(){u.overflow=i.overflow[0],u.overflowX=i.overflow[1],u.overflowY=i.overflow[2]}))),l=!1,p)l||(f?"hidden"in f&&(g=f.hidden):f=nt.access(t,"fxshow",{display:c}),s&&(f.hidden=!g),g&&vt([t],!0),m.done((function(){for(o in g||vt([t]),nt.remove(t,"fxshow"),p)A.style(t,o,p[o])}))),l=fe(g?f[o]:0,o,m),o in f||(f[o]=l.start,g&&(l.end=l.start,l.start=0))}],prefilter:function(t,e){e?be.prefilters.unshift(t):be.prefilters.push(t)}}),A.speed=function(t,e,i){var o=t&&"object"===_typeof(t)?A.extend({},t):{complete:i||!i&&e||u(t)&&t,duration:t,easing:i&&e||e&&!u(e)&&e};return A.fx.off?o.duration=0:"number"!=typeof o.duration&&(o.duration in A.fx.speeds?o.duration=A.fx.speeds[o.duration]:o.duration=A.fx.speeds._default),null!=o.queue&&!0!==o.queue||(o.queue="fx"),o.old=o.complete,o.complete=function(){u(o.old)&&o.old.call(this),o.queue&&A.dequeue(this,o.queue)},o},A.fn.extend({fadeTo:function(t,e,i,o){return this.filter(gt).css("opacity",0).show().end().animate({opacity:e},t,i,o)},animate:function(t,e,i,o){var n=A.isEmptyObject(t),s=A.speed(e,i,o),a=function(){var e=be(this,A.extend({},t),s);(n||nt.get(this,"finish"))&&e.stop(!0)};return a.finish=a,n||!1===s.queue?this.each(a):this.queue(s.queue,a)},stop:function(t,e,i){var o=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&this.queue(t||"fx",[]),this.each((function(){var e=!0,n=null!=t&&t+"queueHooks",s=A.timers,a=nt.get(this);if(n)a[n]&&a[n].stop&&o(a[n]);else for(n in a)a[n]&&a[n].stop&&me.test(n)&&o(a[n]);for(n=s.length;n--;)s[n].elem!==this||null!=t&&s[n].queue!==t||(s[n].anim.stop(i),e=!1,s.splice(n,1));!e&&i||A.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,i=nt.get(this),o=i[t+"queue"],n=i[t+"queueHooks"],s=A.timers,a=o?o.length:0;for(i.finish=!0,A.queue(this,t,[]),n&&n.stop&&n.stop.call(this,!0),e=s.length;e--;)s[e].elem===this&&s[e].queue===t&&(s[e].anim.stop(!0),s.splice(e,1));for(e=0;e<a;e++)o[e]&&o[e].finish&&o[e].finish.call(this);delete i.finish}))}}),A.each(["toggle","show","hide"],(function(t,e){var i=A.fn[e];A.fn[e]=function(t,o,n){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(ge(e,!0),t,o,n)}})),A.each({slideDown:ge("show"),slideUp:ge("hide"),slideToggle:ge("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){A.fn[t]=function(t,i,o){return this.animate(e,t,i,o)}})),A.timers=[],A.fx.tick=function(){var t,e=0,i=A.timers;for(ce=Date.now();e<i.length;e++)(t=i[e])()||i[e]!==t||i.splice(e--,1);i.length||A.fx.stop(),ce=void 0},A.fx.timer=function(t){A.timers.push(t),A.fx.start()},A.fx.interval=13,A.fx.start=function(){he||(he=!0,pe())},A.fx.stop=function(){he=null},A.fx.speeds={slow:600,fast:200,_default:400},A.fn.delay=function(e,i){return e=A.fx&&A.fx.speeds[e]||e,i=i||"fx",this.queue(i,(function(i,o){var n=t.setTimeout(i,e);o.stop=function(){t.clearTimeout(n)}}))},function(){var t=f.createElement("input"),e=f.createElement("select").appendChild(f.createElement("option"));t.type="checkbox",p.checkOn=""!==t.value,p.optSelected=e.selected,(t=f.createElement("input")).value="t",t.type="radio",p.radioValue="t"===t.value}();var Ce,ve=A.expr.attrHandle;A.fn.extend({attr:function(t,e){return X(this,A.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){A.removeAttr(this,t)}))}}),A.extend({attr:function(t,e,i){var o,n,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===t.getAttribute?A.prop(t,e,i):(1===s&&A.isXMLDoc(t)||(n=A.attrHooks[e.toLowerCase()]||(A.expr.match.bool.test(e)?Ce:void 0)),void 0!==i?null===i?void A.removeAttr(t,e):n&&"set"in n&&void 0!==(o=n.set(t,i,e))?o:(t.setAttribute(e,i+""),i):n&&"get"in n&&null!==(o=n.get(t,e))?o:null==(o=A.find.attr(t,e))?void 0:o)},attrHooks:{type:{set:function(t,e){if(!p.radioValue&&"radio"===e&&S(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,o=0,n=e&&e.match(z);if(n&&1===t.nodeType)for(;i=n[o++];)t.removeAttribute(i)}}),Ce={set:function(t,e,i){return!1===e?A.removeAttr(t,i):t.setAttribute(i,i),i}},A.each(A.expr.match.bool.source.match(/\w+/g),(function(t,e){var i=ve[e]||A.find.attr;ve[e]=function(t,e,o){var n,s,a=e.toLowerCase();return o||(s=ve[a],ve[a]=n,n=null!=i(t,e,o)?a:null,ve[a]=s),n}}));var _e=/^(?:input|select|textarea|button)$/i,we=/^(?:a|area)$/i;function Ae(t){return(t.match(z)||[]).join(" ")}function ye(t){return t.getAttribute&&t.getAttribute("class")||""}function Se(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(z)||[]}A.fn.extend({prop:function(t,e){return X(this,A.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[A.propFix[t]||t]}))}}),A.extend({prop:function(t,e,i){var o,n,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&A.isXMLDoc(t)||(e=A.propFix[e]||e,n=A.propHooks[e]),void 0!==i?n&&"set"in n&&void 0!==(o=n.set(t,i,e))?o:t[e]=i:n&&"get"in n&&null!==(o=n.get(t,e))?o:t[e]},propHooks:{tabIndex:{get:function(t){var e=A.find.attr(t,"tabindex");return e?parseInt(e,10):_e.test(t.nodeName)||we.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),p.optSelected||(A.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),A.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){A.propFix[this.toLowerCase()]=this})),A.fn.extend({addClass:function(t){var e,i,o,n,s,a;return u(t)?this.each((function(e){A(this).addClass(t.call(this,e,ye(this)))})):(e=Se(t)).length?this.each((function(){if(o=ye(this),i=1===this.nodeType&&" "+Ae(o)+" "){for(s=0;s<e.length;s++)n=e[s],i.indexOf(" "+n+" ")<0&&(i+=n+" ");a=Ae(i),o!==a&&this.setAttribute("class",a)}})):this},removeClass:function(t){var e,i,o,n,s,a;return u(t)?this.each((function(e){A(this).removeClass(t.call(this,e,ye(this)))})):arguments.length?(e=Se(t)).length?this.each((function(){if(o=ye(this),i=1===this.nodeType&&" "+Ae(o)+" "){for(s=0;s<e.length;s++)for(n=e[s];i.indexOf(" "+n+" ")>-1;)i=i.replace(" "+n+" "," ");a=Ae(i),o!==a&&this.setAttribute("class",a)}})):this:this.attr("class","")},toggleClass:function(t,e){var i,o,n,s,a=_typeof(t),r="string"===a||Array.isArray(t);return u(t)?this.each((function(i){A(this).toggleClass(t.call(this,i,ye(this),e),e)})):"boolean"==typeof e&&r?e?this.addClass(t):this.removeClass(t):(i=Se(t),this.each((function(){if(r)for(s=A(this),n=0;n<i.length;n++)o=i[n],s.hasClass(o)?s.removeClass(o):s.addClass(o);else void 0!==t&&"boolean"!==a||((o=ye(this))&&nt.set(this,"__className__",o),this.setAttribute&&this.setAttribute("class",o||!1===t?"":nt.get(this,"__className__")||""))})))},hasClass:function(t){var e,i,o=0;for(e=" "+t+" ";i=this[o++];)if(1===i.nodeType&&(" "+Ae(ye(i))+" ").indexOf(e)>-1)return!0;return!1}});var xe=/\r/g;A.fn.extend({val:function(t){var e,i,o,n=this[0];return arguments.length?(o=u(t),this.each((function(i){var n;1===this.nodeType&&(null==(n=o?t.call(this,i,A(this).val()):t)?n="":"number"==typeof n?n+="":Array.isArray(n)&&(n=A.map(n,(function(t){return null==t?"":t+""}))),(e=A.valHooks[this.type]||A.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,n,"value")||(this.value=n))}))):n?(e=A.valHooks[n.type]||A.valHooks[n.nodeName.toLowerCase()])&&"get"in e&&void 0!==(i=e.get(n,"value"))?i:"string"==typeof(i=n.value)?i.replace(xe,""):null==i?"":i:void 0}}),A.extend({valHooks:{option:{get:function(t){var e=A.find.attr(t,"value");return null!=e?e:Ae(A.text(t))}},select:{get:function(t){var e,i,o,n=t.options,s=t.selectedIndex,a="select-one"===t.type,r=a?null:[],l=a?s+1:n.length;for(o=s<0?l:a?s:0;o<l;o++)if(((i=n[o]).selected||o===s)&&!i.disabled&&(!i.parentNode.disabled||!S(i.parentNode,"optgroup"))){if(e=A(i).val(),a)return e;r.push(e)}return r},set:function(t,e){for(var i,o,n=t.options,s=A.makeArray(e),a=n.length;a--;)((o=n[a]).selected=A.inArray(A.valHooks.option.get(o),s)>-1)&&(i=!0);return i||(t.selectedIndex=-1),s}}}}),A.each(["radio","checkbox"],(function(){A.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=A.inArray(A(t).val(),e)>-1}},p.checkOn||(A.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}));var ke=t.location,Te={guid:Date.now()},Ie=/\?/;A.parseXML=function(e){var i,o;if(!e||"string"!=typeof e)return null;try{i=(new t.DOMParser).parseFromString(e,"text/xml")}catch(t){}return o=i&&i.getElementsByTagName("parsererror")[0],i&&!o||A.error("Invalid XML: "+(o?A.map(o.childNodes,(function(t){return t.textContent})).join("\n"):e)),i};var Ee=/^(?:focusinfocus|focusoutblur)$/,Pe=function(t){t.stopPropagation()};A.extend(A.event,{trigger:function(e,i,o,n){var s,a,r,l,c,d,m,p,b=[o||f],C=h.call(e,"type")?e.type:e,v=h.call(e,"namespace")?e.namespace.split("."):[];if(a=p=r=o=o||f,3!==o.nodeType&&8!==o.nodeType&&!Ee.test(C+A.event.triggered)&&(C.indexOf(".")>-1&&(v=C.split("."),C=v.shift(),v.sort()),c=C.indexOf(":")<0&&"on"+C,(e=e[A.expando]?e:new A.Event(C,"object"===_typeof(e)&&e)).isTrigger=n?2:3,e.namespace=v.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=o),i=null==i?[e]:A.makeArray(i,[e]),m=A.event.special[C]||{},n||!m.trigger||!1!==m.trigger.apply(o,i))){if(!n&&!m.noBubble&&!g(o)){for(l=m.delegateType||C,Ee.test(l+C)||(a=a.parentNode);a;a=a.parentNode)b.push(a),r=a;r===(o.ownerDocument||f)&&b.push(r.defaultView||r.parentWindow||t)}for(s=0;(a=b[s++])&&!e.isPropagationStopped();)p=a,e.type=s>1?l:m.bindType||C,(d=(nt.get(a,"events")||Object.create(null))[e.type]&&nt.get(a,"handle"))&&d.apply(a,i),(d=c&&a[c])&&d.apply&&it(a)&&(e.result=d.apply(a,i),!1===e.result&&e.preventDefault());return e.type=C,n||e.isDefaultPrevented()||m._default&&!1!==m._default.apply(b.pop(),i)||!it(o)||c&&u(o[C])&&!g(o)&&((r=o[c])&&(o[c]=null),A.event.triggered=C,e.isPropagationStopped()&&p.addEventListener(C,Pe),o[C](),e.isPropagationStopped()&&p.removeEventListener(C,Pe),A.event.triggered=void 0,r&&(o[c]=r)),e.result}},simulate:function(t,e,i){var o=A.extend(new A.Event,i,{type:t,isSimulated:!0});A.event.trigger(o,null,e)}}),A.fn.extend({trigger:function(t,e){return this.each((function(){A.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var i=this[0];if(i)return A.event.trigger(t,e,i,!0)}});var De=/\[\]$/,Me=/\r?\n/g,Ue=/^(?:submit|button|image|reset|file)$/i,Fe=/^(?:input|select|textarea|keygen)/i;function Re(t,e,i,o){var n;if(Array.isArray(e))A.each(e,(function(e,n){i||De.test(t)?o(t,n):Re(t+"["+("object"===_typeof(n)&&null!=n?e:"")+"]",n,i,o)}));else if(i||"object"!==v(e))o(t,e);else for(n in e)Re(t+"["+n+"]",e[n],i,o)}A.param=function(t,e){var i,o=[],n=function(t,e){var i=u(e)?e():e;o[o.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==i?"":i)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!A.isPlainObject(t))A.each(t,(function(){n(this.name,this.value)}));else for(i in t)Re(i,t[i],e,n);return o.join("&")},A.fn.extend({serialize:function(){return A.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=A.prop(this,"elements");return t?A.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!A(this).is(":disabled")&&Fe.test(this.nodeName)&&!Ue.test(t)&&(this.checked||!At.test(t))})).map((function(t,e){var i=A(this).val();return null==i?null:Array.isArray(i)?A.map(i,(function(t){return{name:e.name,value:t.replace(Me,"\r\n")}})):{name:e.name,value:i.replace(Me,"\r\n")}})).get()}});var Le=/%20/g,Be=/#.*$/,Ve=/([?&])_=[^&]*/,Oe=/^(.*?):[ \t]*([^\r\n]*)$/gm,He=/^(?:GET|HEAD)$/,Ne=/^\/\//,Ge={},$e={},ze="*/".concat("*"),We=f.createElement("a");function je(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var o,n=0,s=e.toLowerCase().match(z)||[];if(u(i))for(;o=s[n++];)"+"===o[0]?(o=o.slice(1)||"*",(t[o]=t[o]||[]).unshift(i)):(t[o]=t[o]||[]).push(i)}}function Ke(t,e,i,o){var n={},s=t===$e;function a(r){var l;return n[r]=!0,A.each(t[r]||[],(function(t,r){var c=r(e,i,o);return"string"!=typeof c||s||n[c]?s?!(l=c):void 0:(e.dataTypes.unshift(c),a(c),!1)})),l}return a(e.dataTypes[0])||!n["*"]&&a("*")}function qe(t,e){var i,o,n=A.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((n[i]?t:o||(o={}))[i]=e[i]);return o&&A.extend(!0,t,o),t}We.href=ke.href,A.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ke.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(ke.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ze,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":A.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?qe(qe(t,A.ajaxSettings),e):qe(A.ajaxSettings,t)},ajaxPrefilter:je(Ge),ajaxTransport:je($e),ajax:function(e,i){"object"===_typeof(e)&&(i=e,e=void 0),i=i||{};var o,n,s,a,r,l,c,h,d,m,p=A.ajaxSetup({},i),u=p.context||p,g=p.context&&(u.nodeType||u.jquery)?A(u):A.event,b=A.Deferred(),C=A.Callbacks("once memory"),v=p.statusCode||{},_={},w={},y="canceled",S={readyState:0,getResponseHeader:function(t){var e;if(c){if(!a)for(a={};e=Oe.exec(s);)a[e[1].toLowerCase()+" "]=(a[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=a[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return c?s:null},setRequestHeader:function(t,e){return null==c&&(t=w[t.toLowerCase()]=w[t.toLowerCase()]||t,_[t]=e),this},overrideMimeType:function(t){return null==c&&(p.mimeType=t),this},statusCode:function(t){var e;if(t)if(c)S.always(t[S.status]);else for(e in t)v[e]=[v[e],t[e]];return this},abort:function(t){var e=t||y;return o&&o.abort(e),x(0,e),this}};if(b.promise(S),p.url=((e||p.url||ke.href)+"").replace(Ne,ke.protocol+"//"),p.type=i.method||i.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(z)||[""],null==p.crossDomain){l=f.createElement("a");try{l.href=p.url,l.href=l.href,p.crossDomain=We.protocol+"//"+We.host!=l.protocol+"//"+l.host}catch(t){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=A.param(p.data,p.traditional)),Ke(Ge,p,i,S),c)return S;for(d in(h=A.event&&p.global)&&0==A.active++&&A.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!He.test(p.type),n=p.url.replace(Be,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(Le,"+")):(m=p.url.slice(n.length),p.data&&(p.processData||"string"==typeof p.data)&&(n+=(Ie.test(n)?"&":"?")+p.data,delete p.data),!1===p.cache&&(n=n.replace(Ve,"$1"),m=(Ie.test(n)?"&":"?")+"_="+Te.guid+++m),p.url=n+m),p.ifModified&&(A.lastModified[n]&&S.setRequestHeader("If-Modified-Since",A.lastModified[n]),A.etag[n]&&S.setRequestHeader("If-None-Match",A.etag[n])),(p.data&&p.hasContent&&!1!==p.contentType||i.contentType)&&S.setRequestHeader("Content-Type",p.contentType),S.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+ze+"; q=0.01":""):p.accepts["*"]),p.headers)S.setRequestHeader(d,p.headers[d]);if(p.beforeSend&&(!1===p.beforeSend.call(u,S,p)||c))return S.abort();if(y="abort",C.add(p.complete),S.done(p.success),S.fail(p.error),o=Ke($e,p,i,S)){if(S.readyState=1,h&&g.trigger("ajaxSend",[S,p]),c)return S;p.async&&p.timeout>0&&(r=t.setTimeout((function(){S.abort("timeout")}),p.timeout));try{c=!1,o.send(_,x)}catch(t){if(c)throw t;x(-1,t)}}else x(-1,"No Transport");function x(e,i,a,l){var d,m,f,_,w,y=i;c||(c=!0,r&&t.clearTimeout(r),o=void 0,s=l||"",S.readyState=e>0?4:0,d=e>=200&&e<300||304===e,a&&(_=function(t,e,i){for(var o,n,s,a,r=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===o&&(o=t.mimeType||e.getResponseHeader("Content-Type"));if(o)for(n in r)if(r[n]&&r[n].test(o)){l.unshift(n);break}if(l[0]in i)s=l[0];else{for(n in i){if(!l[0]||t.converters[n+" "+l[0]]){s=n;break}a||(a=n)}s=s||a}if(s)return s!==l[0]&&l.unshift(s),i[s]}(p,S,a)),!d&&A.inArray("script",p.dataTypes)>-1&&A.inArray("json",p.dataTypes)<0&&(p.converters["text script"]=function(){}),_=function(t,e,i,o){var n,s,a,r,l,c={},h=t.dataTypes.slice();if(h[1])for(a in t.converters)c[a.toLowerCase()]=t.converters[a];for(s=h.shift();s;)if(t.responseFields[s]&&(i[t.responseFields[s]]=e),!l&&o&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=s,s=h.shift())if("*"===s)s=l;else if("*"!==l&&l!==s){if(!(a=c[l+" "+s]||c["* "+s]))for(n in c)if((r=n.split(" "))[1]===s&&(a=c[l+" "+r[0]]||c["* "+r[0]])){!0===a?a=c[n]:!0!==c[n]&&(s=r[0],h.unshift(r[1]));break}if(!0!==a)if(a&&t.throws)e=a(e);else try{e=a(e)}catch(t){return{state:"parsererror",error:a?t:"No conversion from "+l+" to "+s}}}return{state:"success",data:e}}(p,_,S,d),d?(p.ifModified&&((w=S.getResponseHeader("Last-Modified"))&&(A.lastModified[n]=w),(w=S.getResponseHeader("etag"))&&(A.etag[n]=w)),204===e||"HEAD"===p.type?y="nocontent":304===e?y="notmodified":(y=_.state,m=_.data,d=!(f=_.error))):(f=y,!e&&y||(y="error",e<0&&(e=0))),S.status=e,S.statusText=(i||y)+"",d?b.resolveWith(u,[m,y,S]):b.rejectWith(u,[S,y,f]),S.statusCode(v),v=void 0,h&&g.trigger(d?"ajaxSuccess":"ajaxError",[S,p,d?m:f]),C.fireWith(u,[S,y]),h&&(g.trigger("ajaxComplete",[S,p]),--A.active||A.event.trigger("ajaxStop")))}return S},getJSON:function(t,e,i){return A.get(t,e,i,"json")},getScript:function(t,e){return A.get(t,void 0,e,"script")}}),A.each(["get","post"],(function(t,e){A[e]=function(t,i,o,n){return u(i)&&(n=n||o,o=i,i=void 0),A.ajax(A.extend({url:t,type:e,dataType:n,data:i,success:o},A.isPlainObject(t)&&t))}})),A.ajaxPrefilter((function(t){var e;for(e in t.headers)"content-type"===e.toLowerCase()&&(t.contentType=t.headers[e]||"")})),A._evalUrl=function(t,e,i){return A.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){A.globalEval(t,e,i)}})},A.fn.extend({wrapAll:function(t){var e;return this[0]&&(u(t)&&(t=t.call(this[0])),e=A(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this},wrapInner:function(t){return u(t)?this.each((function(e){A(this).wrapInner(t.call(this,e))})):this.each((function(){var e=A(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)}))},wrap:function(t){var e=u(t);return this.each((function(i){A(this).wrapAll(e?t.call(this,i):t)}))},unwrap:function(t){return this.parent(t).not("body").each((function(){A(this).replaceWith(this.childNodes)})),this}}),A.expr.pseudos.hidden=function(t){return!A.expr.pseudos.visible(t)},A.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},A.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(t){}};var Ye={0:200,1223:204},Qe=A.ajaxSettings.xhr();p.cors=!!Qe&&"withCredentials"in Qe,p.ajax=Qe=!!Qe,A.ajaxTransport((function(e){var i,o;if(p.cors||Qe&&!e.crossDomain)return{send:function(n,s){var a,r=e.xhr();if(r.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(a in e.xhrFields)r[a]=e.xhrFields[a];for(a in e.mimeType&&r.overrideMimeType&&r.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest"),n)r.setRequestHeader(a,n[a]);i=function(t){return function(){i&&(i=o=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===t?r.abort():"error"===t?"number"!=typeof r.status?s(0,"error"):s(r.status,r.statusText):s(Ye[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=i(),o=r.onerror=r.ontimeout=i("error"),void 0!==r.onabort?r.onabort=o:r.onreadystatechange=function(){4===r.readyState&&t.setTimeout((function(){i&&o()}))},i=i("abort");try{r.send(e.hasContent&&e.data||null)}catch(t){if(i)throw t}},abort:function(){i&&i()}}})),A.ajaxPrefilter((function(t){t.crossDomain&&(t.contents.script=!1)})),A.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return A.globalEval(t),t}}}),A.ajaxPrefilter("script",(function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")})),A.ajaxTransport("script",(function(t){var e,i;if(t.crossDomain||t.scriptAttrs)return{send:function(o,n){e=A("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&n("error"===t.type?404:200,t.type)}),f.head.appendChild(e[0])},abort:function(){i&&i()}}}));var Xe,Ze=[],Je=/(=)\?(?=&|$)|\?\?/;A.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Ze.pop()||A.expando+"_"+Te.guid++;return this[t]=!0,t}}),A.ajaxPrefilter("json jsonp",(function(e,i,o){var n,s,a,r=!1!==e.jsonp&&(Je.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Je.test(e.data)&&"data");if(r||"jsonp"===e.dataTypes[0])return n=e.jsonpCallback=u(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,r?e[r]=e[r].replace(Je,"$1"+n):!1!==e.jsonp&&(e.url+=(Ie.test(e.url)?"&":"?")+e.jsonp+"="+n),e.converters["script json"]=function(){return a||A.error(n+" was not called"),a[0]},e.dataTypes[0]="json",s=t[n],t[n]=function(){a=arguments},o.always((function(){void 0===s?A(t).removeProp(n):t[n]=s,e[n]&&(e.jsonpCallback=i.jsonpCallback,Ze.push(n)),a&&u(s)&&s(a[0]),a=s=void 0})),"script"})),p.createHTMLDocument=((Xe=f.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Xe.childNodes.length),A.parseHTML=function(t,e,i){return"string"!=typeof t?[]:("boolean"==typeof e&&(i=e,e=!1),e||(p.createHTMLDocument?((o=(e=f.implementation.createHTMLDocument("")).createElement("base")).href=f.location.href,e.head.appendChild(o)):e=f),s=!i&&[],(n=B.exec(t))?[e.createElement(n[1])]:(n=Et([t],e,s),s&&s.length&&A(s).remove(),A.merge([],n.childNodes)));var o,n,s},A.fn.load=function(t,e,i){var o,n,s,a=this,r=t.indexOf(" ");return r>-1&&(o=Ae(t.slice(r)),t=t.slice(0,r)),u(e)?(i=e,e=void 0):e&&"object"===_typeof(e)&&(n="POST"),a.length>0&&A.ajax({url:t,type:n||"GET",dataType:"html",data:e}).done((function(t){s=arguments,a.html(o?A("<div>").append(A.parseHTML(t)).find(o):t)})).always(i&&function(t,e){a.each((function(){i.apply(this,s||[t.responseText,e,t])}))}),this},A.expr.pseudos.animated=function(t){return A.grep(A.timers,(function(e){return t===e.elem})).length},A.offset={setOffset:function(t,e,i){var o,n,s,a,r,l,c=A.css(t,"position"),h=A(t),d={};"static"===c&&(t.style.position="relative"),r=h.offset(),s=A.css(t,"top"),l=A.css(t,"left"),("absolute"===c||"fixed"===c)&&(s+l).indexOf("auto")>-1?(a=(o=h.position()).top,n=o.left):(a=parseFloat(s)||0,n=parseFloat(l)||0),u(e)&&(e=e.call(t,i,A.extend({},r))),null!=e.top&&(d.top=e.top-r.top+a),null!=e.left&&(d.left=e.left-r.left+n),"using"in e?e.using.call(t,d):h.css(d)}},A.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each((function(e){A.offset.setOffset(this,t,e)}));var e,i,o=this[0];return o?o.getClientRects().length?(e=o.getBoundingClientRect(),i=o.ownerDocument.defaultView,{top:e.top+i.pageYOffset,left:e.left+i.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,i,o=this[0],n={top:0,left:0};if("fixed"===A.css(o,"position"))e=o.getBoundingClientRect();else{for(e=this.offset(),i=o.ownerDocument,t=o.offsetParent||i.documentElement;t&&(t===i.body||t===i.documentElement)&&"static"===A.css(t,"position");)t=t.parentNode;t&&t!==o&&1===t.nodeType&&((n=A(t).offset()).top+=A.css(t,"borderTopWidth",!0),n.left+=A.css(t,"borderLeftWidth",!0))}return{top:e.top-n.top-A.css(o,"marginTop",!0),left:e.left-n.left-A.css(o,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===A.css(t,"position");)t=t.offsetParent;return t||mt}))}}),A.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var i="pageYOffset"===e;A.fn[t]=function(o){return X(this,(function(t,o,n){var s;if(g(t)?s=t:9===t.nodeType&&(s=t.defaultView),void 0===n)return s?s[e]:t[o];s?s.scrollTo(i?s.pageXOffset:n,i?n:s.pageYOffset):t[o]=n}),t,o,arguments.length)}})),A.each(["top","left"],(function(t,e){A.cssHooks[e]=Xt(p.pixelPosition,(function(t,i){if(i)return i=Qt(t,e),Wt.test(i)?A(t).position()[e]+"px":i}))})),A.each({Height:"height",Width:"width"},(function(t,e){A.each({padding:"inner"+t,content:e,"":"outer"+t},(function(i,o){A.fn[o]=function(n,s){var a=arguments.length&&(i||"boolean"!=typeof n),r=i||(!0===n||!0===s?"margin":"border");return X(this,(function(e,i,n){var s;return g(e)?0===o.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(s=e.documentElement,Math.max(e.body["scroll"+t],s["scroll"+t],e.body["offset"+t],s["offset"+t],s["client"+t])):void 0===n?A.css(e,i,r):A.style(e,i,n,r)}),e,a?n:void 0,a)}}))})),A.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(t,e){A.fn[e]=function(t){return this.on(e,t)}})),A.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,o){return this.on(e,t,i,o)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)},hover:function(t,e){return this.on("mouseenter",t).on("mouseleave",e||t)}}),A.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(t,e){A.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}));var ti=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;A.proxy=function(t,e){var i,o,s;if("string"==typeof e&&(i=t[e],e=t,t=i),u(t))return o=n.call(arguments,2),s=function(){return t.apply(e||this,o.concat(n.call(arguments)))},s.guid=t.guid=t.guid||A.guid++,s},A.holdReady=function(t){t?A.readyWait++:A.ready(!0)},A.isArray=Array.isArray,A.parseJSON=JSON.parse,A.nodeName=S,A.isFunction=u,A.isWindow=g,A.camelCase=et,A.type=v,A.now=Date.now,A.isNumeric=function(t){var e=A.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},A.trim=function(t){return null==t?"":(t+"").replace(ti,"$1")},"function"==typeof define&&define.amd&&define("jquery",[],(function(){return A}));var ei=t.jQuery,ii=t.$;return A.noConflict=function(e){return t.$===A&&(t.$=ii),e&&t.jQuery===A&&(t.jQuery=ei),A},void 0===e&&(t.jQuery=t.$=A),A})),function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("underscore",e):(t="undefined"!=typeof globalThis?globalThis:t||self,function(){var i=t._,o=t._=e();o.noConflict=function(){return t._=i,o}}())}(this,(function(){var t="1.13.6",e="object"==("undefined"==typeof self?"undefined":_typeof(self))&&self.self===self&&self||"object"==("undefined"==typeof global?"undefined":_typeof(global))&&global.global===global&&global||Function("return this")()||{},i=Array.prototype,o=Object.prototype,n="undefined"!=typeof Symbol?Symbol.prototype:null,s=i.push,a=i.slice,r=o.toString,l=o.hasOwnProperty,c="undefined"!=typeof ArrayBuffer,h="undefined"!=typeof DataView,d=Array.isArray,m=Object.keys,p=Object.create,u=c&&ArrayBuffer.isView,g=isNaN,f=isFinite,b=!{toString:null}.propertyIsEnumerable("toString"),C=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],v=Math.pow(2,53)-1;function _(t,e){return e=null==e?t.length-1:+e,function(){for(var i=Math.max(arguments.length-e,0),o=Array(i),n=0;n<i;n++)o[n]=arguments[n+e];switch(e){case 0:return t.call(this,o);case 1:return t.call(this,arguments[0],o);case 2:return t.call(this,arguments[0],arguments[1],o)}var s=Array(e+1);for(n=0;n<e;n++)s[n]=arguments[n];return s[e]=o,t.apply(this,s)}}function w(t){var e=_typeof(t);return"function"===e||"object"===e&&!!t}function A(t){return void 0===t}function y(t){return!0===t||!1===t||"[object Boolean]"===r.call(t)}function S(t){var e="[object "+t+"]";return function(t){return r.call(t)===e}}var x=S("String"),k=S("Number"),T=S("Date"),I=S("RegExp"),E=S("Error"),P=S("Symbol"),D=S("ArrayBuffer"),M=S("Function"),U=e.document&&e.document.childNodes;"function"!=typeof/./&&"object"!=("undefined"==typeof Int8Array?"undefined":_typeof(Int8Array))&&"function"!=typeof U&&(M=function(t){return"function"==typeof t||!1});var F=M,R=S("Object"),L=h&&(!/\[native code\]/.test(String(DataView))||R(new DataView(new ArrayBuffer(8)))),B="undefined"!=typeof Map&&R(new Map),V=S("DataView");var O=L?function(t){return null!=t&&F(t.getInt8)&&D(t.buffer)}:V,H=d||S("Array");function N(t,e){return null!=t&&l.call(t,e)}var G=S("Arguments");!function(){G(arguments)||(G=function(t){return N(t,"callee")})}();var $=G;function z(t){return k(t)&&g(t)}function W(t){return function(){return t}}function j(t){return function(e){var i=t(e);return"number"==typeof i&&i>=0&&i<=v}}function K(t){return function(e){return null==e?void 0:e[t]}}var q=K("byteLength"),Y=j(q),Q=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var X=c?function(t){return u?u(t)&&!O(t):Y(t)&&Q.test(r.call(t))}:W(!1),Z=K("length");function J(t,e){e=function(t){for(var e={},i=t.length,o=0;o<i;++o)e[t[o]]=!0;return{contains:function(t){return!0===e[t]},push:function(i){return e[i]=!0,t.push(i)}}}(e);var i=C.length,n=t.constructor,s=F(n)&&n.prototype||o,a="constructor";for(N(t,a)&&!e.contains(a)&&e.push(a);i--;)(a=C[i])in t&&t[a]!==s[a]&&!e.contains(a)&&e.push(a)}function tt(t){if(!w(t))return[];if(m)return m(t);var e=[];for(var i in t)N(t,i)&&e.push(i);return b&&J(t,e),e}function et(t,e){var i=tt(e),o=i.length;if(null==t)return!o;for(var n=Object(t),s=0;s<o;s++){var a=i[s];if(e[a]!==n[a]||!(a in n))return!1}return!0}function it(t){return t instanceof it?t:this instanceof it?void(this._wrapped=t):new it(t)}function ot(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,q(t))}it.VERSION=t,it.prototype.value=function(){return this._wrapped},it.prototype.valueOf=it.prototype.toJSON=it.prototype.value,it.prototype.toString=function(){return String(this._wrapped)};var nt="[object DataView]";function st(t,e,i,o){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var n=_typeof(t);return("function"===n||"object"===n||"object"==_typeof(e))&&at(t,e,i,o)}function at(t,e,i,o){t instanceof it&&(t=t._wrapped),e instanceof it&&(e=e._wrapped);var s=r.call(t);if(s!==r.call(e))return!1;if(L&&"[object Object]"==s&&O(t)){if(!O(e))return!1;s=nt}switch(s){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return n.valueOf.call(t)===n.valueOf.call(e);case"[object ArrayBuffer]":case nt:return at(ot(t),ot(e),i,o)}var a="[object Array]"===s;if(!a&&X(t)){if(q(t)!==q(e))return!1;if(t.buffer===e.buffer&&t.byteOffset===e.byteOffset)return!0;a=!0}if(!a){if("object"!=_typeof(t)||"object"!=_typeof(e))return!1;var l=t.constructor,c=e.constructor;if(l!==c&&!(F(l)&&l instanceof l&&F(c)&&c instanceof c)&&"constructor"in t&&"constructor"in e)return!1}o=o||[];for(var h=(i=i||[]).length;h--;)if(i[h]===t)return o[h]===e;if(i.push(t),o.push(e),a){if((h=t.length)!==e.length)return!1;for(;h--;)if(!st(t[h],e[h],i,o))return!1}else{var d,m=tt(t);if(h=m.length,tt(e).length!==h)return!1;for(;h--;)if(!N(e,d=m[h])||!st(t[d],e[d],i,o))return!1}return i.pop(),o.pop(),!0}function rt(t){if(!w(t))return[];var e=[];for(var i in t)e.push(i);return b&&J(t,e),e}function lt(t){var e=Z(t);return function(i){if(null==i)return!1;var o=rt(i);if(Z(o))return!1;for(var n=0;n<e;n++)if(!F(i[t[n]]))return!1;return t!==pt||!F(i[ct])}}var ct="forEach",ht=["clear","delete"],dt=["get","has","set"],mt=ht.concat(ct,dt),pt=ht.concat(dt),ut=["add"].concat(ht,ct,"has"),gt=B?lt(mt):S("Map"),ft=B?lt(pt):S("WeakMap"),bt=B?lt(ut):S("Set"),Ct=S("WeakSet");function vt(t){for(var e=tt(t),i=e.length,o=Array(i),n=0;n<i;n++)o[n]=t[e[n]];return o}function _t(t){for(var e={},i=tt(t),o=0,n=i.length;o<n;o++)e[t[i[o]]]=i[o];return e}function wt(t){var e=[];for(var i in t)F(t[i])&&e.push(i);return e.sort()}function At(t,e){return function(i){var o=arguments.length;if(e&&(i=Object(i)),o<2||null==i)return i;for(var n=1;n<o;n++)for(var s=arguments[n],a=t(s),r=a.length,l=0;l<r;l++){var c=a[l];e&&void 0!==i[c]||(i[c]=s[c])}return i}}var yt=At(rt),St=At(tt),xt=At(rt,!0);function kt(t){if(!w(t))return{};if(p)return p(t);var e=function(){};e.prototype=t;var i=new e;return e.prototype=null,i}function Tt(t){return H(t)?t:[t]}function It(t){return it.toPath(t)}function Et(t,e){for(var i=e.length,o=0;o<i;o++){if(null==t)return;t=t[e[o]]}return i?t:void 0}function Pt(t,e,i){var o=Et(t,It(e));return A(o)?i:o}function Dt(t){return t}function Mt(t){return t=St({},t),function(e){return et(e,t)}}function Ut(t){return t=It(t),function(e){return Et(e,t)}}function Ft(t,e,i){if(void 0===e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 3:return function(i,o,n){return t.call(e,i,o,n)};case 4:return function(i,o,n,s){return t.call(e,i,o,n,s)}}return function(){return t.apply(e,arguments)}}function Rt(t,e,i){return null==t?Dt:F(t)?Ft(t,e,i):w(t)&&!H(t)?Mt(t):Ut(t)}function Lt(t,e){return Rt(t,e,1/0)}function Bt(t,e,i){return it.iteratee!==Lt?it.iteratee(t,e):Rt(t,e,i)}function Vt(){}function Ot(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}it.toPath=Tt,it.iteratee=Lt;var Ht=Date.now||function(){return(new Date).getTime()};function Nt(t){var e=function(e){return t[e]},i="(?:"+tt(t).join("|")+")",o=RegExp(i),n=RegExp(i,"g");return function(t){return t=null==t?"":""+t,o.test(t)?t.replace(n,e):t}}var Gt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},$t=Nt(Gt),zt=Nt(_t(Gt)),Wt=it.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},jt=/(.)^/,Kt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},qt=/\\|'|\r|\n|\u2028|\u2029/g;function Yt(t){return"\\"+Kt[t]}var Qt=/^\s*(\w|\$)+\s*$/;var Xt=0;function Zt(t,e,i,o,n){if(!(o instanceof e))return t.apply(i,n);var s=kt(t.prototype),a=t.apply(s,n);return w(a)?a:s}var Jt=_((function(t,e){var i=Jt.placeholder,o=function(){for(var n=0,s=e.length,a=Array(s),r=0;r<s;r++)a[r]=e[r]===i?arguments[n++]:e[r];for(;n<arguments.length;)a.push(arguments[n++]);return Zt(t,o,this,this,a)};return o}));Jt.placeholder=it;var te=_((function(t,e,i){if(!F(t))throw new TypeError("Bind must be called on a function");var o=_((function(n){return Zt(t,o,e,this,i.concat(n))}));return o})),ee=j(Z);function ie(t,e,i,o){if(o=o||[],e||0===e){if(e<=0)return o.concat(t)}else e=1/0;for(var n=o.length,s=0,a=Z(t);s<a;s++){var r=t[s];if(ee(r)&&(H(r)||$(r)))if(e>1)ie(r,e-1,i,o),n=o.length;else for(var l=0,c=r.length;l<c;)o[n++]=r[l++];else i||(o[n++]=r)}return o}var oe=_((function(t,e){var i=(e=ie(e,!1,!1)).length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var o=e[i];t[o]=te(t[o],t)}return t}));var ne=_((function(t,e,i){return setTimeout((function(){return t.apply(null,i)}),e)})),se=Jt(ne,it,1);function ae(t){return function(){return!t.apply(this,arguments)}}function re(t,e){var i;return function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=null),i}}var le=Jt(re,2);function ce(t,e,i){e=Bt(e,i);for(var o,n=tt(t),s=0,a=n.length;s<a;s++)if(e(t[o=n[s]],o,t))return o}function he(t){return function(e,i,o){i=Bt(i,o);for(var n=Z(e),s=t>0?0:n-1;s>=0&&s<n;s+=t)if(i(e[s],s,e))return s;return-1}}var de=he(1),me=he(-1);function pe(t,e,i,o){for(var n=(i=Bt(i,o,1))(e),s=0,a=Z(t);s<a;){var r=Math.floor((s+a)/2);i(t[r])<n?s=r+1:a=r}return s}function ue(t,e,i){return function(o,n,s){var r=0,l=Z(o);if("number"==typeof s)t>0?r=s>=0?s:Math.max(s+l,r):l=s>=0?Math.min(s+1,l):s+l+1;else if(i&&s&&l)return o[s=i(o,n)]===n?s:-1;if(n!=n)return(s=e(a.call(o,r,l),z))>=0?s+r:-1;for(s=t>0?r:l-1;s>=0&&s<l;s+=t)if(o[s]===n)return s;return-1}}var ge=ue(1,de,pe),fe=ue(-1,me);function be(t,e,i){var o=(ee(t)?de:ce)(t,e,i);if(void 0!==o&&-1!==o)return t[o]}function Ce(t,e,i){var o,n;if(e=Ft(e,i),ee(t))for(o=0,n=t.length;o<n;o++)e(t[o],o,t);else{var s=tt(t);for(o=0,n=s.length;o<n;o++)e(t[s[o]],s[o],t)}return t}function ve(t,e,i){e=Bt(e,i);for(var o=!ee(t)&&tt(t),n=(o||t).length,s=Array(n),a=0;a<n;a++){var r=o?o[a]:a;s[a]=e(t[r],r,t)}return s}function _e(t){return function(e,i,o,n){var s=arguments.length>=3;return function(e,i,o,n){var s=!ee(e)&&tt(e),a=(s||e).length,r=t>0?0:a-1;for(n||(o=e[s?s[r]:r],r+=t);r>=0&&r<a;r+=t){var l=s?s[r]:r;o=i(o,e[l],l,e)}return o}(e,Ft(i,n,4),o,s)}}var we=_e(1),Ae=_e(-1);function ye(t,e,i){var o=[];return e=Bt(e,i),Ce(t,(function(t,i,n){e(t,i,n)&&o.push(t)})),o}function Se(t,e,i){e=Bt(e,i);for(var o=!ee(t)&&tt(t),n=(o||t).length,s=0;s<n;s++){var a=o?o[s]:s;if(!e(t[a],a,t))return!1}return!0}function xe(t,e,i){e=Bt(e,i);for(var o=!ee(t)&&tt(t),n=(o||t).length,s=0;s<n;s++){var a=o?o[s]:s;if(e(t[a],a,t))return!0}return!1}function ke(t,e,i,o){return ee(t)||(t=vt(t)),("number"!=typeof i||o)&&(i=0),ge(t,e,i)>=0}var Te=_((function(t,e,i){var o,n;return F(e)?n=e:(e=It(e),o=e.slice(0,-1),e=e[e.length-1]),ve(t,(function(t){var s=n;if(!s){if(o&&o.length&&(t=Et(t,o)),null==t)return;s=t[e]}return null==s?s:s.apply(t,i)}))}));function Ie(t,e){return ve(t,Ut(e))}function Ee(t,e,i){var o,n,s=-1/0,a=-1/0;if(null==e||"number"==typeof e&&"object"!=_typeof(t[0])&&null!=t)for(var r=0,l=(t=ee(t)?t:vt(t)).length;r<l;r++)null!=(o=t[r])&&o>s&&(s=o);else e=Bt(e,i),Ce(t,(function(t,i,o){((n=e(t,i,o))>a||n===-1/0&&s===-1/0)&&(s=t,a=n)}));return s}var Pe=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function De(t){return t?H(t)?a.call(t):x(t)?t.match(Pe):ee(t)?ve(t,Dt):vt(t):[]}function Me(t,e,i){if(null==e||i)return ee(t)||(t=vt(t)),t[Ot(t.length-1)];var o=De(t),n=Z(o);e=Math.max(Math.min(e,n),0);for(var s=n-1,a=0;a<e;a++){var r=Ot(a,s),l=o[a];o[a]=o[r],o[r]=l}return o.slice(0,e)}function Ue(t,e){return function(i,o,n){var s=e?[[],[]]:{};return o=Bt(o,n),Ce(i,(function(e,n){var a=o(e,n,i);t(s,e,a)})),s}}var Fe=Ue((function(t,e,i){N(t,i)?t[i].push(e):t[i]=[e]})),Re=Ue((function(t,e,i){t[i]=e})),Le=Ue((function(t,e,i){N(t,i)?t[i]++:t[i]=1})),Be=Ue((function(t,e,i){t[i?0:1].push(e)}),!0);function Ve(t,e,i){return e in i}var Oe=_((function(t,e){var i={},o=e[0];if(null==t)return i;F(o)?(e.length>1&&(o=Ft(o,e[1])),e=rt(t)):(o=Ve,e=ie(e,!1,!1),t=Object(t));for(var n=0,s=e.length;n<s;n++){var a=e[n],r=t[a];o(r,a,t)&&(i[a]=r)}return i})),He=_((function(t,e){var i,o=e[0];return F(o)?(o=ae(o),e.length>1&&(i=e[1])):(e=ve(ie(e,!1,!1),String),o=function(t,i){return!ke(e,i)}),Oe(t,o,i)}));function Ne(t,e,i){return a.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))}function Ge(t,e,i){return null==t||t.length<1?null==e||i?void 0:[]:null==e||i?t[0]:Ne(t,t.length-e)}function $e(t,e,i){return a.call(t,null==e||i?1:e)}var ze=_((function(t,e){return e=ie(e,!0,!0),ye(t,(function(t){return!ke(e,t)}))})),We=_((function(t,e){return ze(t,e)}));function je(t,e,i,o){y(e)||(o=i,i=e,e=!1),null!=i&&(i=Bt(i,o));for(var n=[],s=[],a=0,r=Z(t);a<r;a++){var l=t[a],c=i?i(l,a,t):l;e&&!i?(a&&s===c||n.push(l),s=c):i?ke(s,c)||(s.push(c),n.push(l)):ke(n,l)||n.push(l)}return n}var Ke=_((function(t){return je(ie(t,!0,!0))}));function qe(t){for(var e=t&&Ee(t,Z).length||0,i=Array(e),o=0;o<e;o++)i[o]=Ie(t,o);return i}var Ye=_(qe);function Qe(t,e){return t._chain?it(e).chain():e}function Xe(t){return Ce(wt(t),(function(e){var i=it[e]=t[e];it.prototype[e]=function(){var t=[this._wrapped];return s.apply(t,arguments),Qe(this,i.apply(it,t))}})),it}Ce(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=i[t];it.prototype[t]=function(){var i=this._wrapped;return null!=i&&(e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0]),Qe(this,i)}})),Ce(["concat","join","slice"],(function(t){var e=i[t];it.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=e.apply(t,arguments)),Qe(this,t)}}));var Ze={__proto__:null,VERSION:t,restArguments:_,isObject:w,isNull:function(t){return null===t},isUndefined:A,isBoolean:y,isElement:function(t){return!(!t||1!==t.nodeType)},isString:x,isNumber:k,isDate:T,isRegExp:I,isError:E,isSymbol:P,isArrayBuffer:D,isDataView:O,isArray:H,isFunction:F,isArguments:$,isFinite:function(t){return!P(t)&&f(t)&&!isNaN(parseFloat(t))},isNaN:z,isTypedArray:X,isEmpty:function(t){if(null==t)return!0;var e=Z(t);return"number"==typeof e&&(H(t)||x(t)||$(t))?0===e:0===Z(tt(t))},isMatch:et,isEqual:function(t,e){return st(t,e)},isMap:gt,isWeakMap:ft,isSet:bt,isWeakSet:Ct,keys:tt,allKeys:rt,values:vt,pairs:function(t){for(var e=tt(t),i=e.length,o=Array(i),n=0;n<i;n++)o[n]=[e[n],t[e[n]]];return o},invert:_t,functions:wt,methods:wt,extend:yt,extendOwn:St,assign:St,defaults:xt,create:function(t,e){var i=kt(t);return e&&St(i,e),i},clone:function(t){return w(t)?H(t)?t.slice():yt({},t):t},tap:function(t,e){return e(t),t},get:Pt,has:function(t,e){for(var i=(e=It(e)).length,o=0;o<i;o++){var n=e[o];if(!N(t,n))return!1;t=t[n]}return!!i},mapObject:function(t,e,i){e=Bt(e,i);for(var o=tt(t),n=o.length,s={},a=0;a<n;a++){var r=o[a];s[r]=e(t[r],r,t)}return s},identity:Dt,constant:W,noop:Vt,toPath:Tt,property:Ut,propertyOf:function(t){return null==t?Vt:function(e){return Pt(t,e)}},matcher:Mt,matches:Mt,times:function(t,e,i){var o=Array(Math.max(0,t));e=Ft(e,i,1);for(var n=0;n<t;n++)o[n]=e(n);return o},random:Ot,now:Ht,escape:$t,unescape:zt,templateSettings:Wt,template:function(t,e,i){!e&&i&&(e=i),e=xt({},e,it.templateSettings);var o=RegExp([(e.escape||jt).source,(e.interpolate||jt).source,(e.evaluate||jt).source].join("|")+"|$","g"),n=0,s="__p+='";t.replace(o,(function(e,i,o,a,r){return s+=t.slice(n,r).replace(qt,Yt),n=r+e.length,i?s+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":o?s+="'+\n((__t=("+o+"))==null?'':__t)+\n'":a&&(s+="';\n"+a+"\n__p+='"),e})),s+="';\n";var a,r=e.variable;if(r){if(!Qt.test(r))throw new Error("variable is not a bare identifier: "+r)}else s="with(obj||{}){\n"+s+"}\n",r="obj";s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{a=new Function(r,"_",s)}catch(t){throw t.source=s,t}var l=function(t){return a.call(this,t,it)};return l.source="function("+r+"){\n"+s+"}",l},result:function(t,e,i){var o=(e=It(e)).length;if(!o)return F(i)?i.call(t):i;for(var n=0;n<o;n++){var s=null==t?void 0:t[e[n]];void 0===s&&(s=i,n=o),t=F(s)?s.call(t):s}return t},uniqueId:function(t){var e=++Xt+"";return t?t+e:e},chain:function(t){var e=it(t);return e._chain=!0,e},iteratee:Lt,partial:Jt,bind:te,bindAll:oe,memoize:function(t,e){var i=function(o){var n=i.cache,s=""+(e?e.apply(this,arguments):o);return N(n,s)||(n[s]=t.apply(this,arguments)),n[s]};return i.cache={},i},delay:ne,defer:se,throttle:function(t,e,i){var o,n,s,a,r=0;i||(i={});var l=function(){r=!1===i.leading?0:Ht(),o=null,a=t.apply(n,s),o||(n=s=null)},c=function(){var c=Ht();r||!1!==i.leading||(r=c);var h=e-(c-r);return n=this,s=arguments,h<=0||h>e?(o&&(clearTimeout(o),o=null),r=c,a=t.apply(n,s),o||(n=s=null)):o||!1===i.trailing||(o=setTimeout(l,h)),a};return c.cancel=function(){clearTimeout(o),r=0,o=n=s=null},c},debounce:function(t,e,i){var o,n,s,a,r,l=function(){var c=Ht()-n;e>c?o=setTimeout(l,e-c):(o=null,i||(a=t.apply(r,s)),o||(s=r=null))},c=_((function(c){return r=this,s=c,n=Ht(),o||(o=setTimeout(l,e),i&&(a=t.apply(r,s))),a}));return c.cancel=function(){clearTimeout(o),o=s=r=null},c},wrap:function(t,e){return Jt(e,t)},negate:ae,compose:function(){var t=arguments,e=t.length-1;return function(){for(var i=e,o=t[e].apply(this,arguments);i--;)o=t[i].call(this,o);return o}},after:function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},before:re,once:le,findKey:ce,findIndex:de,findLastIndex:me,sortedIndex:pe,indexOf:ge,lastIndexOf:fe,find:be,detect:be,findWhere:function(t,e){return be(t,Mt(e))},each:Ce,forEach:Ce,map:ve,collect:ve,reduce:we,foldl:we,inject:we,reduceRight:Ae,foldr:Ae,filter:ye,select:ye,reject:function(t,e,i){return ye(t,ae(Bt(e)),i)},every:Se,all:Se,some:xe,any:xe,contains:ke,includes:ke,include:ke,invoke:Te,pluck:Ie,where:function(t,e){return ye(t,Mt(e))},max:Ee,min:function(t,e,i){var o,n,s=1/0,a=1/0;if(null==e||"number"==typeof e&&"object"!=_typeof(t[0])&&null!=t)for(var r=0,l=(t=ee(t)?t:vt(t)).length;r<l;r++)null!=(o=t[r])&&o<s&&(s=o);else e=Bt(e,i),Ce(t,(function(t,i,o){((n=e(t,i,o))<a||n===1/0&&s===1/0)&&(s=t,a=n)}));return s},shuffle:function(t){return Me(t,1/0)},sample:Me,sortBy:function(t,e,i){var o=0;return e=Bt(e,i),Ie(ve(t,(function(t,i,n){return{value:t,index:o++,criteria:e(t,i,n)}})).sort((function(t,e){var i=t.criteria,o=e.criteria;if(i!==o){if(i>o||void 0===i)return 1;if(i<o||void 0===o)return-1}return t.index-e.index})),"value")},groupBy:Fe,indexBy:Re,countBy:Le,partition:Be,toArray:De,size:function(t){return null==t?0:ee(t)?t.length:tt(t).length},pick:Oe,omit:He,first:Ge,head:Ge,take:Ge,initial:Ne,last:function(t,e,i){return null==t||t.length<1?null==e||i?void 0:[]:null==e||i?t[t.length-1]:$e(t,Math.max(0,t.length-e))},rest:$e,tail:$e,drop:$e,compact:function(t){return ye(t,Boolean)},flatten:function(t,e){return ie(t,e,!1)},without:We,uniq:je,unique:je,union:Ke,intersection:function(t){for(var e=[],i=arguments.length,o=0,n=Z(t);o<n;o++){var s=t[o];if(!ke(e,s)){var a;for(a=1;a<i&&ke(arguments[a],s);a++);a===i&&e.push(s)}}return e},difference:ze,unzip:qe,transpose:qe,zip:Ye,object:function(t,e){for(var i={},o=0,n=Z(t);o<n;o++)e?i[t[o]]=e[o]:i[t[o][0]]=t[o][1];return i},range:function(t,e,i){null==e&&(e=t||0,t=0),i||(i=e<t?-1:1);for(var o=Math.max(Math.ceil((e-t)/i),0),n=Array(o),s=0;s<o;s++,t+=i)n[s]=t;return n},chunk:function(t,e){if(null==e||e<1)return[];for(var i=[],o=0,n=t.length;o<n;)i.push(a.call(t,o,o+=e));return i},mixin:Xe,default:it},Je=Xe(Ze);return Je._=Je,Je})),function(t){var e="object"==("undefined"==typeof self?"undefined":_typeof(self))&&self.self===self&&self||"object"==("undefined"==typeof global?"undefined":_typeof(global))&&global.global===global&&global;if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],(function(i,o,n){e.Backbone=t(e,n,i,o)}));else if("undefined"!=typeof exports){var i,o=require("underscore");try{i=require("jquery")}catch(t){}t(e,exports,o,i)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}((function(t,e,i,o){var n=t.Backbone,s=Array.prototype.slice;e.VERSION="1.6.0",e.$=o,e.noConflict=function(){return t.Backbone=n,this},e.emulateHTTP=!1,e.emulateJSON=!1;var a,r=e.Events={},l=/\s+/,c=function(t,e,o,n,s){var a,r=0;if(o&&"object"===_typeof(o)){void 0!==n&&"context"in s&&void 0===s.context&&(s.context=n);for(a=i.keys(o);r<a.length;r++)e=c(t,e,a[r],o[a[r]],s)}else if(o&&l.test(o))for(a=o.split(l);r<a.length;r++)e=t(e,a[r],n,s);else e=t(e,o,n,s);return e};r.on=function(t,e,i){(this._events=c(h,this._events||{},t,e,{context:i,ctx:this,listening:a}),a)&&((this._listeners||(this._listeners={}))[a.id]=a,a.interop=!1);return this},r.listenTo=function(t,e,o){if(!t)return this;var n=t._listenId||(t._listenId=i.uniqueId("l")),s=this._listeningTo||(this._listeningTo={}),r=a=s[n];r||(this._listenId||(this._listenId=i.uniqueId("l")),r=a=s[n]=new f(this,t));var l=d(t,e,o,this);if(a=void 0,l)throw l;return r.interop&&r.on(e,o),this};var h=function(t,e,i,o){if(i){var n=t[e]||(t[e]=[]),s=o.context,a=o.ctx,r=o.listening;r&&r.count++,n.push({callback:i,context:s,ctx:s||a,listening:r})}return t},d=function(t,e,i,o){try{t.on(e,i,o)}catch(t){return t}};r.off=function(t,e,i){return this._events?(this._events=c(m,this._events,t,e,{context:i,listeners:this._listeners}),this):this},r.stopListening=function(t,e,o){var n=this._listeningTo;if(!n)return this;for(var s=t?[t._listenId]:i.keys(n),a=0;a<s.length;a++){var r=n[s[a]];if(!r)break;r.obj.off(e,o,this),r.interop&&r.off(e,o)}return i.isEmpty(n)&&(this._listeningTo=void 0),this};var m=function(t,e,o,n){if(t){var s,a=n.context,r=n.listeners,l=0;if(e||a||o){for(s=e?[e]:i.keys(t);l<s.length;l++){var c=t[e=s[l]];if(!c)break;for(var h=[],d=0;d<c.length;d++){var m=c[d];if(o&&o!==m.callback&&o!==m.callback._callback||a&&a!==m.context)h.push(m);else{var p=m.listening;p&&p.off(e,o)}}h.length?t[e]=h:delete t[e]}return t}for(s=i.keys(r);l<s.length;l++)r[s[l]].cleanup()}};r.once=function(t,e,i){var o=c(p,{},t,e,this.off.bind(this));return"string"==typeof t&&null==i&&(e=void 0),this.on(o,e,i)},r.listenToOnce=function(t,e,i){var o=c(p,{},e,i,this.stopListening.bind(this,t));return this.listenTo(t,o)};var p=function(t,e,o,n){if(o){var s=t[e]=i.once((function(){n(e,s),o.apply(this,arguments)}));s._callback=o}return t};r.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),i=Array(e),o=0;o<e;o++)i[o]=arguments[o+1];return c(u,this._events,t,void 0,i),this};var u=function(t,e,i,o){if(t){var n=t[e],s=t.all;n&&s&&(s=s.slice()),n&&g(n,o),s&&g(s,[e].concat(o))}return t},g=function(t,e){var i,o=-1,n=t.length,s=e[0],a=e[1],r=e[2];switch(e.length){case 0:for(;++o<n;)(i=t[o]).callback.call(i.ctx);return;case 1:for(;++o<n;)(i=t[o]).callback.call(i.ctx,s);return;case 2:for(;++o<n;)(i=t[o]).callback.call(i.ctx,s,a);return;case 3:for(;++o<n;)(i=t[o]).callback.call(i.ctx,s,a,r);return;default:for(;++o<n;)(i=t[o]).callback.apply(i.ctx,e);return}},f=function(t,e){this.id=t._listenId,this.listener=t,this.obj=e,this.interop=!0,this.count=0,this._events=void 0};f.prototype.on=r.on,f.prototype.off=function(t,e){var i;this.interop?(this._events=c(m,this._events,t,e,{context:void 0,listeners:void 0}),i=!this._events):(this.count--,i=0===this.count),i&&this.cleanup()},f.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},r.bind=r.on,r.unbind=r.off,i.extend(e,r);var b=e.Model=function(t,e){var o=t||{};e||(e={}),this.preinitialize.apply(this,arguments),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(o=this.parse(o,e)||{});var n=i.result(this,"defaults");o=i.defaults(i.extend({},n,o),n),this.set(o,e),this.changed={},this.initialize.apply(this,arguments)};i.extend(b.prototype,r,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(t){return i.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!i.iteratee(t,this)(this.attributes)},set:function(t,e,o){if(null==t)return this;var n;if("object"===_typeof(t)?(n=t,o=e):(n={})[t]=e,o||(o={}),!this._validate(n,o))return!1;var s=o.unset,a=o.silent,r=[],l=this._changing;this._changing=!0,l||(this._previousAttributes=i.clone(this.attributes),this.changed={});var c=this.attributes,h=this.changed,d=this._previousAttributes;for(var m in n)e=n[m],i.isEqual(c[m],e)||r.push(m),i.isEqual(d[m],e)?delete h[m]:h[m]=e,s?delete c[m]:c[m]=e;if(this.idAttribute in n){var p=this.id;this.id=this.get(this.idAttribute),this.trigger("changeId",this,p,o)}if(!a){r.length&&(this._pending=o);for(var u=0;u<r.length;u++)this.trigger("change:"+r[u],this,c[r[u]],o)}if(l)return this;if(!a)for(;this._pending;)o=this._pending,this._pending=!1,this.trigger("change",this,o);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var o in this.attributes)e[o]=void 0;return this.set(e,i.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!i.isEmpty(this.changed):i.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&i.clone(this.changed);var e,o=this._changing?this._previousAttributes:this.attributes,n={};for(var s in t){var a=t[s];i.isEqual(o[s],a)||(n[s]=a,e=!0)}return!!e&&n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(t){t=i.extend({parse:!0},t);var e=this,o=t.success;return t.success=function(i){var n=t.parse?e.parse(i,t):i;if(!e.set(n,t))return!1;o&&o.call(t.context,e,i,t),e.trigger("sync",e,i,t)},z(this,t),this.sync("read",this,t)},save:function(t,e,o){var n;null==t||"object"===_typeof(t)?(n=t,o=e):(n={})[t]=e;var s=(o=i.extend({validate:!0,parse:!0},o)).wait;if(n&&!s){if(!this.set(n,o))return!1}else if(!this._validate(n,o))return!1;var a=this,r=o.success,l=this.attributes;o.success=function(t){a.attributes=l;var e=o.parse?a.parse(t,o):t;if(s&&(e=i.extend({},n,e)),e&&!a.set(e,o))return!1;r&&r.call(o.context,a,t,o),a.trigger("sync",a,t,o)},z(this,o),n&&s&&(this.attributes=i.extend({},l,n));var c=this.isNew()?"create":o.patch?"patch":"update";"patch"!==c||o.attrs||(o.attrs=n);var h=this.sync(c,this,o);return this.attributes=l,h},destroy:function(t){t=t?i.clone(t):{};var e=this,o=t.success,n=t.wait,s=function(){e.stopListening(),e.trigger("destroy",e,e.collection,t)};t.success=function(i){n&&s(),o&&o.call(t.context,e,i,t),e.isNew()||e.trigger("sync",e,i,t)};var a=!1;return this.isNew()?i.defer(t.success):(z(this,t),a=this.sync("delete",this,t)),n||s(),a},url:function(){var t=i.result(this,"urlRoot")||i.result(this.collection,"url")||$();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.extend({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=i.extend({},this.attributes,t);var o=this.validationError=this.validate(t,e)||null;return!o||(this.trigger("invalid",this,o,i.extend(e,{validationError:o})),!1)}});var C=e.Collection=function(t,e){e||(e={}),this.preinitialize.apply(this,arguments),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,i.extend({silent:!0},e))},v={add:!0,remove:!0,merge:!0},_={add:!0,remove:!1},w=function(t,e,i){i=Math.min(Math.max(i,0),t.length);var o,n=Array(t.length-i),s=e.length;for(o=0;o<n.length;o++)n[o]=t[o+i];for(o=0;o<s;o++)t[o+i]=e[o];for(o=0;o<n.length;o++)t[o+s+i]=n[o]};i.extend(C.prototype,r,{model:b,preinitialize:function(){},initialize:function(){},toJSON:function(t){return this.map((function(e){return e.toJSON(t)}))},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:!1},e,_))},remove:function(t,e){e=i.extend({},e);var o=!i.isArray(t);t=o?[t]:t.slice();var n=this._removeModels(t,e);return!e.silent&&n.length&&(e.changes={added:[],merged:[],removed:n},this.trigger("update",this,e)),o?n[0]:n},set:function(t,e){if(null!=t){(e=i.extend({},v,e)).parse&&!this._isModel(t)&&(t=this.parse(t,e)||[]);var o=!i.isArray(t);t=o?[t]:t.slice();var n=e.at;null!=n&&(n=+n),n>this.length&&(n=this.length),n<0&&(n+=this.length+1);var s,a,r=[],l=[],c=[],h=[],d={},m=e.add,p=e.merge,u=e.remove,g=!1,f=this.comparator&&null==n&&!1!==e.sort,b=i.isString(this.comparator)?this.comparator:null;for(a=0;a<t.length;a++){s=t[a];var C=this.get(s);if(C){if(p&&s!==C){var _=this._isModel(s)?s.attributes:s;e.parse&&(_=C.parse(_,e)),C.set(_,e),c.push(C),f&&!g&&(g=C.hasChanged(b))}d[C.cid]||(d[C.cid]=!0,r.push(C)),t[a]=C}else m&&(s=t[a]=this._prepareModel(s,e))&&(l.push(s),this._addReference(s,e),d[s.cid]=!0,r.push(s))}if(u){for(a=0;a<this.length;a++)d[(s=this.models[a]).cid]||h.push(s);h.length&&this._removeModels(h,e)}var A=!1,y=!f&&m&&u;if(r.length&&y?(A=this.length!==r.length||i.some(this.models,(function(t,e){return t!==r[e]})),this.models.length=0,w(this.models,r,0),this.length=this.models.length):l.length&&(f&&(g=!0),w(this.models,l,null==n?this.length:n),this.length=this.models.length),g&&this.sort({silent:!0}),!e.silent){for(a=0;a<l.length;a++)null!=n&&(e.index=n+a),(s=l[a]).trigger("add",s,this,e);(g||A)&&this.trigger("sort",this,e),(l.length||h.length||c.length)&&(e.changes={added:l,removed:h,merged:c},this.trigger("update",this,e))}return o?t[0]:t}},reset:function(t,e){e=e?i.clone(e):{};for(var o=0;o<this.models.length;o++)this._removeReference(this.models[o],e);return e.previousModels=this.models,this._reset(),t=this.add(t,i.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return s.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[this.modelId(this._isModel(t)?t.attributes:t,t.idAttribute)]||t.cid&&this._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var o=e.length;return i.isFunction(e)&&(e=e.bind(this)),1===o||i.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return this.map(t+"")},fetch:function(t){var e=(t=i.extend({parse:!0},t)).success,o=this;return t.success=function(i){var n=t.reset?"reset":"set";o[n](i,t),e&&e.call(t.context,o,i,t),o.trigger("sync",o,i,t)},z(this,t),this.sync("read",this,t)},create:function(t,e){var o=(e=e?i.clone(e):{}).wait;if(!(t=this._prepareModel(t,e)))return!1;o||this.add(t,e);var n=this,s=e.success;return e.success=function(t,e,i){o&&(t.off("error",n._forwardPristineError,n),n.add(t,i)),s&&s.call(i.context,t,e,i)},o&&t.once("error",this._forwardPristineError,this),t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t,e){return t[e||this.model.prototype.idAttribute||"id"]},values:function(){return new y(this,S)},keys:function(){return new y(this,x)},entries:function(){return new y(this,k)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){return this._isModel(t)?(t.collection||(t.collection=this),t):((e=e?i.clone(e):{}).collection=this,(o=this.model.prototype?new this.model(t,e):this.model(t,e)).validationError?(this.trigger("invalid",this,o.validationError,e),!1):o);var o},_removeModels:function(t,e){for(var i=[],o=0;o<t.length;o++){var n=this.get(t[o]);if(n){var s=this.indexOf(n);this.models.splice(s,1),this.length--,delete this._byId[n.cid];var a=this.modelId(n.attributes,n.idAttribute);null!=a&&delete this._byId[a],e.silent||(e.index=s,n.trigger("remove",n,this,e)),i.push(n),this._removeReference(n,e)}}return t.length>0&&!e.silent&&delete e.index,i},_isModel:function(t){return t instanceof b},_addReference:function(t,e){this._byId[t.cid]=t;var i=this.modelId(t.attributes,t.idAttribute);null!=i&&(this._byId[i]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var i=this.modelId(t.attributes,t.idAttribute);null!=i&&delete this._byId[i],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,o){if(e){if(("add"===t||"remove"===t)&&i!==this)return;if("destroy"===t&&this.remove(e,o),"changeId"===t){var n=this.modelId(e.previousAttributes(),e.idAttribute),s=this.modelId(e.attributes,e.idAttribute);null!=n&&delete this._byId[n],null!=s&&(this._byId[s]=e)}}this.trigger.apply(this,arguments)},_forwardPristineError:function(t,e,i){this.has(t)||this._onModelEvent("error",t,e,i)}});var A="function"==typeof Symbol&&Symbol.iterator;A&&(C.prototype[A]=C.prototype.values);var y=function(t,e){this._collection=t,this._kind=e,this._index=0},S=1,x=2,k=3;A&&(y.prototype[A]=function(){return this}),y.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var t,e=this._collection.at(this._index);if(this._index++,this._kind===S)t=e;else{var i=this._collection.modelId(e.attributes,e.idAttribute);t=this._kind===x?i:[i,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var T=e.View=function(t){this.cid=i.uniqueId("view"),this.preinitialize.apply(this,arguments),i.extend(this,i.pick(t,E)),this._ensureElement(),this.initialize.apply(this,arguments)},I=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName","events"];i.extend(T.prototype,r,{tagName:"div",$:function(t){return this.$el.find(t)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=i.result(this,"events")),!t)return this;for(var e in this.undelegateEvents(),t){var o=t[e];if(i.isFunction(o)||(o=this[o]),o){var n=e.match(I);this.delegate(n[1],n[2],o.bind(this))}}return this},delegate:function(t,e,i){return this.$el.on(t+".delegateEvents"+this.cid,e,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,i){return this.$el.off(t+".delegateEvents"+this.cid,e,i),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var t=i.extend({},i.result(this,"attributes"));this.id&&(t.id=i.result(this,"id")),this.className&&(t.class=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}});var P=function(t,e,o,n){i.each(o,(function(i,o){e[o]&&(t.prototype[o]=function(t,e,i,o){switch(e){case 1:return function(){return t[i](this[o])};case 2:return function(e){return t[i](this[o],e)};case 3:return function(e,n){return t[i](this[o],D(e,this),n)};case 4:return function(e,n,s){return t[i](this[o],D(e,this),n,s)};default:return function(){var e=s.call(arguments);return e.unshift(this[o]),t[i].apply(t,e)}}}(e,i,o,n))}))},D=function(t,e){return i.isFunction(t)?t:i.isObject(t)&&!e._isModel(t)?M(t):i.isString(t)?function(e){return e.get(t)}:t},M=function(t){var e=i.matches(t);return function(t){return e(t.attributes)}};i.each([[C,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models"],[b,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],(function(t){var e=t[0],o=t[1],n=t[2];e.mixin=function(t){var o=i.reduce(i.functions(t),(function(t,e){return t[e]=0,t}),{});P(e,t,o,n)},P(e,i,o,n)})),e.sync=function(t,o,n){var s=U[t];i.defaults(n||(n={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var a={type:s,dataType:"json"};if(n.url||(a.url=i.result(o,"url")||$()),null!=n.data||!o||"create"!==t&&"update"!==t&&"patch"!==t||(a.contentType="application/json",a.data=JSON.stringify(n.attrs||o.toJSON(n))),n.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),n.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){a.type="POST",n.emulateJSON&&(a.data._method=s);var r=n.beforeSend;n.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",s),r)return r.apply(this,arguments)}}"GET"===a.type||n.emulateJSON||(a.processData=!1);var l=n.error;n.error=function(t,e,i){n.textStatus=e,n.errorThrown=i,l&&l.call(n.context,t,e,i)};var c=n.xhr=e.ajax(i.extend(a,n));return o.trigger("request",o,c,n),c};var U={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var F=e.Router=function(t){t||(t={}),this.preinitialize.apply(this,arguments),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},R=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,B=/\*\w+/g,V=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(F.prototype,r,{preinitialize:function(){},initialize:function(){},route:function(t,o,n){i.isRegExp(t)||(t=this._routeToRegExp(t)),i.isFunction(o)&&(n=o,o=""),n||(n=this[o]);var s=this;return e.history.route(t,(function(i){var a=s._extractParameters(t,i);!1!==s.execute(n,a,o)&&(s.trigger.apply(s,["route:"+o].concat(a)),s.trigger("route",o,a),e.history.trigger("route",s,o,a))})),this},execute:function(t,e,i){t&&t.apply(this,e)},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var t,e=i.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(V,"\\$&").replace(R,"(?:$1)?").replace(L,(function(t,e){return e?t:"([^/?]+)"})).replace(B,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var o=t.exec(e).slice(1);return i.map(o,(function(t,e){return e===o.length-1?t||null:t?decodeURIComponent(t):null}))}});var O=e.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},H=/^[#\/]|\s+$/g,N=/^\/+|\/+$/g,G=/#.*$/;O.started=!1,i.extend(O.prototype,r,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(H,"")},start:function(t){if(O.started)throw new Error("Backbone.history has already been started");if(O.started=!0,this.options=i.extend({root:"/"},this.options,t),this.root=this.options.root,this._trailingSlash=this.options.trailingSlash,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(N,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var o=document.body,n=o.insertBefore(this.iframe,o.firstChild).contentWindow;n.document.open(),n.document.close(),n.location.hash="#"+this.fragment}var s=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?s("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?s("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),O.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e===this.fragment)return!this.matchRoot()&&this.notfound();this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(t){return this.matchRoot()?(t=this.fragment=this.getFragment(t),i.some(this.handlers,(function(e){if(e.route.test(t))return e.callback(t),!0}))||this.notfound()):this.notfound()},notfound:function(){return this.trigger("notfound"),!1},navigate:function(t,e){if(!O.started)return!1;e&&!0!==e||(e={trigger:!!e}),t=this.getFragment(t||"");var i=this.root;this._trailingSlash||""!==t&&"?"!==t.charAt(0)||(i=i.slice(0,-1)||"/");var o=i+t;t=t.replace(G,"");var n=this.decodeFragment(t);if(this.fragment!==n){if(this.fragment=n,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,o);else{if(!this._wantsHashChange)return this.location.assign(o);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var s=this.iframe.contentWindow;e.replace||(s.document.open(),s.document.close()),this._updateHash(s.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var o=t.href.replace(/(javascript:|#).*$/,"");t.replace(o+"#"+e)}else t.hash="#"+e}}),e.history=new O;b.extend=C.extend=F.extend=T.extend=O.extend=function(t,e){var o,n=this;return o=t&&i.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},i.extend(o,n,e),o.prototype=i.create(n.prototype,t),o.prototype.constructor=o,o.__super__=n.prototype,o};var $=function(){throw new Error('A "url" property or function must be specified')},z=function(t,e){var i=e.error;e.error=function(o){i&&i.call(e.context,t,o,e),t.trigger("error",t,o,e)}};return e._debug=function(){return{root:t,_:i}},e})),void 0===Common)var Common={};if(define("notification",["backbone","underscore"],(function(t,e){"use strict";var i=function(){};if(e.extend(i.prototype,t.Events),void 0!==Common.NotificationCenter)throw"Native Common.NotificationCenter instance already defined.";i.extend=t.Model.extend,Common.NotificationCenter=new i})),define("core",["underscore"],(function(t){var e=function(t,e){for(var i=t.split("."),o=e||window,n=0,s=i.length;n<s;n++)o=o[i[n]]||{};return o},i=function(e){t.extend(this,e||{}),this.eventbus=new n({application:this}),this.createApplicationNamespace(),this.initialize.apply(this,arguments),!1!==this.autoCreate&&$($.proxy(this.onReady,this))};if(t.extend(i.prototype,{nameSpace:"Application",models:{},collections:{},controllers:{},allocationMap:{model:"Models",collection:"Collections",controller:"Controllers",view:"Views"},createApplicationNamespace:function(){var e=window;this.nameSpace&&void 0===e[this.nameSpace]&&(e[this.nameSpace]={}),e[this.nameSpace]=this,t.each(this.allocationMap,(function(t,e){this[t]=this[t]||{}}),this)},initialize:function(){},onReady:function(){this.start()},start:function(){this.initializeControllers(this.controllers||{}),this.launchControllers(),this.launch.call(this)},getClasseRefs:function(i,o){var n={},s=this[this.allocationMap[i]];return t.each(o,(function(t){n[t]=e(t,t.indexOf(".")>-1?window:s)}),this),n},initializeControllers:function(i){this.controllers={},t.each(i,(function(i){var o=i.indexOf(".")>-1?window:this[this.allocationMap.controller],n=e(i,o),s=(i.split(".").pop(),new n({id:i,application:this}));s.views=this.getClasseRefs("view",s.views||[]),t.extend(this.models,this.getClasseRefs("model",s.models||[])),t.extend(this.collections,this.getClasseRefs("collection",s.collections||{})),this.buildCollections(),this.controllers[i]=s}),this)},launchControllers:function(){t.each(this.controllers,(function(t,e){t.onLaunch(this)}),this)},launch:function(){},addListeners:function(t,e){this.eventbus.addListeners(t,e)},getController:function(t){return this.controllers[t]},getModel:function(t){this._modelsCache=this._modelsCache||{};var e=this._modelsCache[t],i=this.getModelConstructor(t);return!e&&i&&(e=this.createModel(t),this._modelsCache[t]=e),e||null},getModelConstructor:function(t){return this.models[t]},createModel:function(e,i){var o=this.getModelConstructor(e),n=null;return o&&(n=new o(t.extend(i||{}))),n},getCollection:function(t){this._collectionsCache=this._collectionsCache||{};var e=this._collectionsCache[t],i=this.getCollectionConstructor(t);return!e&&i&&(e=this.createCollection(t),this._collectionsCache[t]=e),e||null},getCollectionConstructor:function(t){return this.collections[t]},createCollection:function(t){var e=this.getCollectionConstructor(t),i=null;return e&&(i=new e),i},buildCollections:function(){t.each(this.collections,(function(t,e){this.getCollection(e)}),this)}}),void 0!==Backbone.Application)throw"Native Backbone.Application instance already defined.";Backbone.Application=i,Backbone.Application.extend=Backbone.Model.extend;var o=function(e){t.extend(this,e||{}),this.initialize.apply(this,arguments)};if(t.extend(o.prototype,{name:null,views:{},models:{},collections:{},initialize:function(t){},addListeners:function(t){this.getApplication().addListeners(t,this)},onLaunch:function(t){},getApplication:function(){return this.application},getView:function(t){return this._viewsCache[t]},getViewConstructor:function(t){return this.views[t]},createView:function(e,i){var o=this.getViewConstructor(e),n=t.extend(i||{},{alias:e});return this._viewsCache=this._viewsCache||{},this._viewsCache[e]=new o(n),this._viewsCache[e].options=t.extend({},n),this._viewsCache[e]},getModel:function(t){return this.application.getModel(t)},getModelConstructor:function(t){return this.application.getModelConstructor(t)},createModel:function(t,e){return this.application.createModel(t)},getCollection:function(t){return this.application.getCollection(t)},getCollectionConstructor:function(t){return this.application.getCollectionConstructor(t)},createCollection:function(t){return this.application.createCollection(t)},fireEvent:function(t,e,i){this.application.eventbus.fireEvent(t,e,i)},bindViewEvents:function(e,i){for(var o in this.unbindViewEvents(e),i=t.isFunction(i)?i.call(this):i){var n=i[o];t.isFunction(n)||(n=this[i[o]]);var s=o.match(/^(\S+)\s*(.*)$/),a=s[1],r=s[2];n=t.bind(n,this),a+=".bindViewEvents"+e.cid,e.$el.on(a,r,n)}return this},unbindViewEvents:function(t){return t.$el.off(".bindViewEvents"+t.cid),this}}),void 0!==Backbone.Controller)throw"Native Backbone.Controller instance already defined.";Backbone.Controller=o,Backbone.Controller.extend=Backbone.Model.extend;var n=function(e){var i=this;t.extend(this,e||{}),t.extend(Backbone.View.prototype,{alias:null,hidden:!1,getAlias:function(){return this.options.alias},fireEvent:function(t,e){this.trigger.apply(this,arguments),i.fireEvent(this.getAlias(),t,e)},hide:function(){this.$el.hide(),this.hidden=!0},show:function(){this.$el.show(),this.hidden=!1}})};if(t.extend(n.prototype,{pool:{},addListeners:function(e,i){this.pool[i.id]=this.pool[i.id]||{};var o=this.pool[i.id];t.isArray(e)?t.each(e,(function(t){this.addListeners(t,i)}),this):t.isObject(e)&&t.each(e,(function(e,i){t.each(e,(function(t,e){o[i]=o[i]||{},o[i][e]=o[i][e]||[],o[i][e].push(t)}),this)}),this)},fireEvent:function(e,i,o){var n=this.getApplication();t.each(this.pool,(function(s,a){var r=s[e];if(r){var l=r[i],c=n.getController(a);t.each(l,(function(t){t.apply(c,o)}))}}),this)},getApplication:function(){return this.application}}),void 0!==Backbone.EventBus)throw"Native Backbone.Application instance already defined.";Backbone.EventBus=n})),void 0===window.Common&&(window.Common={}),Common.component=Common.component||{},Common.Analytics=Common.component.Analytics=new function(){var t;return{initialize:function(e,i){if(void 0===e)throw"Analytics: invalid id.";if(void 0===i||"[object String]"!==Object.prototype.toString.apply(i))throw"Analytics: invalid category type.";t=i,$("head").append('<script type="text/javascript">var _gaq = _gaq || [];_gaq.push(["_setAccount", "'+e+'"]);_gaq.push(["_trackPageview"]);(function() {var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);})();<\/script>')},trackEvent:function(e,i,o){if(void 0!==e&&"[object String]"!==Object.prototype.toString.apply(e))throw"Analytics: invalid action type.";if(void 0!==i&&"[object String]"!==Object.prototype.toString.apply(i))throw"Analytics: invalid label type.";if(void 0!==o&&("[object Number]"!==Object.prototype.toString.apply(o)||!isFinite(o)))throw"Analytics: invalid value type.";if("undefined"!=typeof _gaq){if("undefined"===t)throw"Analytics is not initialized.";_gaq.push(["_trackEvent",t,e,i,o])}}}},define("analytics",["jquery"],(function(){})),void 0===window.Common&&(window.Common={}),Common.Gateway=new function(){var t=this,e=$(t),i={init:function(t){e.trigger("init",t)},openDocument:function(t){e.trigger("opendocument",t)},openDocumentFromBinary:function(t){e.trigger("opendocumentfrombinary",t)},showMessage:function(t){e.trigger("showmessage",t)},applyEditRights:function(t){e.trigger("applyeditrights",t)},processSaveResult:function(t){e.trigger("processsaveresult",t)},processRightsChange:function(t){e.trigger("processrightschange",t)},refreshHistory:function(t){e.trigger("refreshhistory",t)},setHistoryData:function(t){e.trigger("sethistorydata",t)},setEmailAddresses:function(t){e.trigger("setemailaddresses",t)},setActionLink:function(t){e.trigger("setactionlink",t.url)},processMailMerge:function(t){e.trigger("processmailmerge",t)},downloadAs:function(t){e.trigger("downloadas",t)},processMouse:function(t){e.trigger("processmouse",t)},internalCommand:function(t){e.trigger("internalcommand",t)},resetFocus:function(t){e.trigger("resetfocus",t)},setUsers:function(t){e.trigger("setusers",t)},showSharingSettings:function(t){e.trigger("showsharingsettings",t)},setSharingSettings:function(t){e.trigger("setsharingsettings",t)},insertImage:function(t){e.trigger("insertimage",t)},setMailMergeRecipients:function(t){e.trigger("setmailmergerecipients",t)},setRevisedFile:function(t){e.trigger("setrevisedfile",t)},setFavorite:function(t){e.trigger("setfavorite",t)},requestClose:function(t){e.trigger("requestclose",t)},blurFocus:function(t){e.trigger("blurfocus",t)},grabFocus:function(t){e.trigger("grabfocus",t)},setReferenceData:function(t){e.trigger("setreferencedata",t)},refreshFile:function(t){e.trigger("refreshfile",t)},setRequestedDocument:function(t){e.trigger("setrequesteddocument",t)},setRequestedSpreadsheet:function(t){e.trigger("setrequestedspreadsheet",t)},setReferenceSource:function(t){e.trigger("setreferencesource",t)},startFilling:function(t){e.trigger("startfilling",t)},requestRoles:function(t){e.trigger("requestroles",t)}},o=function(t,e){window.parent&&window.JSON&&(t.frameEditorId=window.frameEditorId,e?window.parent.postMessage(t,"*",[e]):window.parent.postMessage(window.JSON.stringify(t),"*"))},n=function(t){!function(t){if(t.origin===window.parentOrigin||t.origin===window.location.origin||"null"===t.origin&&("file://"===window.parentOrigin||"file://"===window.location.origin)){var e=t.data;if(e&&"openDocumentFromBinary"===e.command)(n=i[e.command])&&n.call(this,e.data);else if("[object String]"===Object.prototype.toString.apply(e)&&window.JSON){var o,n;try{o=window.JSON.parse(e)}catch(t){o=""}o&&(n=i[o.command])&&n.call(this,o.data)}}}(t)};return window.attachEvent?window.attachEvent("onmessage",n):window.addEventListener("message",n,!1),{appReady:function(){o({event:"onAppReady"})},requestEditRights:function(){o({event:"onRequestEditRights"})},requestHistory:function(){o({event:"onRequestHistory"})},requestHistoryData:function(t){o({event:"onRequestHistoryData",data:t})},requestRestore:function(t,e,i){o({event:"onRequestRestore",data:{version:t,url:e,fileType:i}})},requestEmailAddresses:function(){o({event:"onRequestEmailAddresses"})},requestStartMailMerge:function(){o({event:"onRequestStartMailMerge"})},requestHistoryClose:function(t){o({event:"onRequestHistoryClose"})},reportError:function(t,e){o({event:"onError",data:{errorCode:t,errorDescription:e}})},reportWarning:function(t,e){o({event:"onWarning",data:{warningCode:t,warningDescription:e}})},sendInfo:function(t){o({event:"onInfo",data:t})},setDocumentModified:function(t){o({event:"onDocumentStateChange",data:t})},internalMessage:function(t,e){o({event:"onInternalMessage",data:{type:t,data:e}})},updateVersion:function(){o({event:"onOutdatedVersion"})},downloadAs:function(t,e){o({event:"onDownloadAs",data:{url:t,fileType:e}})},requestSaveAs:function(t,e,i){o({event:"onRequestSaveAs",data:{url:t,title:e,fileType:i}})},collaborativeChanges:function(){o({event:"onCollaborativeChanges"})},requestRename:function(t){o({event:"onRequestRename",data:t})},metaChange:function(t){o({event:"onMetaChange",data:t})},documentReady:function(){o({event:"onDocumentReady"})},requestClose:function(){o({event:"onRequestClose"})},requestMakeActionLink:function(t){o({event:"onMakeActionLink",data:t})},requestUsers:function(t,e,i,n,s){o({event:"onRequestUsers",data:{c:t,id:e,from:i,count:n,search:s}})},requestSendNotify:function(t){o({event:"onRequestSendNotify",data:t})},requestInsertImage:function(t){o({event:"onRequestInsertImage",data:{c:t}})},requestMailMergeRecipients:function(){o({event:"onRequestMailMergeRecipients"})},requestCompareFile:function(){o({event:"onRequestCompareFile"})},requestSharingSettings:function(){o({event:"onRequestSharingSettings"})},requestCreateNew:function(){o({event:"onRequestCreateNew"})},requestReferenceData:function(t){o({event:"onRequestReferenceData",data:t})},requestOpen:function(t){o({event:"onRequestOpen",data:t})},requestSelectDocument:function(t){o({event:"onRequestSelectDocument",data:{c:t}})},requestSelectSpreadsheet:function(t){o({event:"onRequestSelectSpreadsheet",data:{c:t}})},requestReferenceSource:function(){o({event:"onRequestReferenceSource"})},requestStartFilling:function(t){o({event:"onRequestStartFilling",data:t})},switchEditorType:function(t,e){o({event:"onSwitchEditorType",data:{type:t,restart:e}})},startFilling:function(){o({event:"onStartFilling"})},requestFillingStatus:function(t){o({event:"onRequestFillingStatus",data:t})},pluginsReady:function(){o({event:"onPluginsReady"})},requestRefreshFile:function(){o({event:"onRequestRefreshFile"})},userActionRequired:function(){o({event:"onUserActionRequired"})},saveDocument:function(t){t&&o({event:"onSaveDocument",data:t.buffer},t.buffer)},submitForm:function(){o({event:"onSubmit"})},on:function(i,o){e.on(i,(function(e,i){o.call(t,i)}))}}},define("gateway",["jquery"],(function(){})),function(t,e){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("../vendor/es6-promise/es6-promise.auto.min",e):t.ES6Promise=e()}(this,(function(){"use strict";function t(t){return"function"==typeof t}function e(){var t=setTimeout;return function(){return t(i,1)}}function i(){for(var t=0;t<b;t+=2){(0,k[t])(k[t+1]),k[t]=void 0,k[t+1]=void 0}b=0}function o(t,e){var i=this,o=new this.constructor(s);void 0===o[I]&&u(o);var n=i._state;if(n){var a=arguments[n-1];_((function(){return p(n,o,a,i._result)}))}else d(i,o,t,e);return o}function n(t){if(t&&"object"==_typeof(t)&&t.constructor===this)return t;var e=new this(s);return r(e,t),e}function s(){}function a(e,i,s){i.constructor===e.constructor&&s===o&&i.constructor.resolve===n?function(t,e){e._state===P?c(t,e._result):e._state===D?h(t,e._result):d(e,void 0,(function(e){return r(t,e)}),(function(e){return h(t,e)}))}(e,i):void 0===s?c(e,i):t(s)?function(t,e,i){_((function(t){var o=!1,n=function(t,e,i,o){try{t.call(e,i,o)}catch(t){return t}}(i,e,(function(i){o||(o=!0,e!==i?r(t,i):c(t,i))}),(function(e){o||(o=!0,h(t,e))}),t._label);!o&&n&&(o=!0,h(t,n))}),t)}(e,i,s):c(e,i)}function r(t,e){if(t===e)h(t,new TypeError("You cannot resolve a promise with itself"));else if(function(t){var e=_typeof(t);return null!==t&&("object"===e||"function"===e)}(e)){var i=void 0;try{i=e.then}catch(e){return void h(t,e)}a(t,e,i)}else c(t,e)}function l(t){t._onerror&&t._onerror(t._result),m(t)}function c(t,e){t._state===E&&(t._result=e,t._state=P,0!==t._subscribers.length&&_(m,t))}function h(t,e){t._state===E&&(t._state=D,t._result=e,_(l,t))}function d(t,e,i,o){var n=t._subscribers,s=n.length;t._onerror=null,n[s]=e,n[s+P]=i,n[s+D]=o,0===s&&t._state&&_(m,t)}function m(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var o=void 0,n=void 0,s=t._result,a=0;a<e.length;a+=3)o=e[a],n=e[a+i],o?p(i,o,n,s):n(s);t._subscribers.length=0}}function p(e,i,o,n){var s=t(o),a=void 0,l=void 0,d=!0;if(s){try{a=o(n)}catch(t){d=!1,l=t}if(i===a)return void h(i,new TypeError("A promises callback cannot return that same promise."))}else a=n;i._state!==E||(s&&d?r(i,a):!1===d?h(i,l):e===P?c(i,a):e===D&&h(i,a))}function u(t){t[I]=M++,t._state=void 0,t._result=void 0,t._subscribers=[]}var g;g=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var f=g,b=0,C=void 0,v=void 0,_=function(t,e){k[b]=t,k[b+1]=e,2===(b+=2)&&(v?v(i):T())},w="undefined"!=typeof window?window:void 0,A=w||{},y=A.MutationObserver||A.WebKitMutationObserver,S="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),x="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,k=new Array(1e3),T=void 0;T=S?function(){return process.nextTick(i)}:y?function(){var t=0,e=new y(i),o=document.createTextNode("");return e.observe(o,{characterData:!0}),function(){o.data=t=++t%2}}():x?function(){var t=new MessageChannel;return t.port1.onmessage=i,function(){return t.port2.postMessage(0)}}():void 0===w&&"function"==typeof require?function(){try{var t=Function("return this")().require("vertx");return void 0!==(C=t.runOnLoop||t.runOnContext)?function(){C(i)}:e()}catch(t){return e()}}():e();var I=Math.random().toString(36).substring(2),E=void 0,P=1,D=2,M=0,U=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(s),this.promise[I]||u(this.promise),f(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?c(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&c(this.promise,this._result))):h(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===E&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,r=i.resolve;if(r===n){var l=void 0,c=void 0,d=!1;try{l=t.then}catch(t){d=!0,c=t}if(l===o&&t._state!==E)this._settledAt(t._state,e,t._result);else if("function"!=typeof l)this._remaining--,this._result[e]=t;else if(i===F){var m=new i(s);d?h(m,c):a(m,t,l),this._willSettleAt(m,e)}else this._willSettleAt(new i((function(e){return e(t)})),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,i){var o=this.promise;o._state===E&&(this._remaining--,t===D?h(o,i):this._result[e]=i),0===this._remaining&&c(o,this._result)},t.prototype._willSettleAt=function(t,e){var i=this;d(t,void 0,(function(t){return i._settledAt(P,e,t)}),(function(t){return i._settledAt(D,e,t)}))},t}(),F=function(){function e(t){this[I]=M++,this._result=this._state=void 0,this._subscribers=[],s!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e((function(e){r(t,e)}),(function(e){h(t,e)}))}catch(e){h(t,e)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var i=this,o=i.constructor;return t(e)?i.then((function(t){return o.resolve(e()).then((function(){return t}))}),(function(t){return o.resolve(e()).then((function(){throw t}))})):i.then(e,e)},e}();return F.prototype.then=o,F.all=function(t){return new U(this,t).promise},F.race=function(t){var e=this;return new e(f(t)?function(i,o){for(var n=t.length,s=0;s<n;s++)e.resolve(t[s]).then(i,o)}:function(t,e){return e(new TypeError("You must pass an array to race."))})},F.resolve=n,F.reject=function(t){var e=new this(s);return h(e,t),e},F._setScheduler=function(t){v=t},F._setAsap=function(t){_=t},F._asap=_,F.polyfill=function(){var t=void 0;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=F},F.Promise=F,F.polyfill(),F})),void 0===Common)var Common={};if(Common.Locale=new function(){"use strict";var l10n=null,loadcallback,apply=!1,defLang="en",currentLang=defLang,_4letterLangs=["pt-pt","zh-tw","sr-cyrl"],_applyLocalization=function(t){_clearRtl();try{if(t&&(loadcallback=t),l10n){for(var e in l10n){var i=e.split(".");if(i&&i.length>2){for(var o=window,n=0;n<i.length-1;++n)void 0===o[i[n]]&&(o[i[n]]=new Object),o=o[i[n]];o&&(o[i[i.length-1]]=l10n[e])}}loadcallback&&loadcallback()}else apply=!0}catch(t){}},_get=function _get(prop,scope){var res="";return l10n&&scope&&scope.name&&(res=l10n[scope.name+"."+prop],!res&&scope.default&&(res=scope.default)),res||(scope?eval(scope.name).prototype[prop]:"")},_getCurrentLanguage=function(){return currentLang},_getDefaultLanguage=function(){return defLang},_getLoadedLanguage=function(){return loadedLang},_getUrlParameterByName=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null==e?"":decodeURIComponent(e[1].replace(/\+/g," "))},_requireLang2=function(t){"string"!=typeof t&&(t=null);var e=(t||_getUrlParameterByName("lang")||defLang).toLowerCase().split(/[\-_]/);e=e[0]+(e.length>1?"-"+e[1]:"");var i=_4letterLangs.indexOf(e);e=i<0?e.split(/[\-]/)[0]:_4letterLangs[i],currentLang=e,fetch("locale/"+e+".json").then((function(t){if(!t.ok){if(i>=0)throw new Error("4letters error");if(currentLang=defLang,e!=defLang)return fetch("locale/"+defLang+".json");throw new Error("server error")}return t.json()})).then((function(t){if(t.json){if(!t.ok)throw new Error("server error");return t.json()}throw l10n=t,new Error("loaded")})).then((function(t){l10n=t||{},apply&&_applyLocalization()})).catch((function(t){return/4letters/.test(t)?setTimeout((function(){_requireLang2(e.split(/[\-_]/)[0])}),0):!/loaded/.test(t)&&currentLang!=defLang&&defLang&&defLang.length<3?setTimeout((function(){_requireLang2(defLang)}),0):(l10n=l10n||{},apply&&_applyLocalization(),void("loaded"==t.message||(currentLang=null,console.log("fetch error: "+t))))}))},_clearRtl=function(){!_isCurrentRtl()&&document.body.classList.contains("rtl")&&(document.body.removeAttribute("dir"),document.body.classList.remove("rtl"),document.body.classList.remove("rtl-font"),document.body.setAttribute("applang",currentLang),window.isrtl=!1)};if(window.fetch)_requireLang2();else{var polyfills=["../vendor/fetch/fetch.umd"];window.Promise?require(polyfills,_requireLang2):require(["../vendor/es6-promise/es6-promise.auto.min"],(function(){require(polyfills,_requireLang2)}))}var _isCurrentRtl=function(){return currentLang&&/^(ar|he|ur)$/i.test(currentLang)};return{apply:_applyLocalization,get:_get,getCurrentLanguage:_getCurrentLanguage,isCurrentLanguageRtl:_isCurrentRtl,getDefaultLanguage:_getDefaultLanguage}},define("locale",(function(){})),function(t){"use strict";var e='[data-toggle="dropdown"]',i=function(e){t(e).on("click.bs.dropdown",this.toggle)};function o(e){var i=e.attr("data-target");i||(i=(i=e.attr("href"))&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""));var o="#"!==i?t(document).find(i):null;return o&&o.length?o:e.parent()}function n(i){i&&3===i.which||(t(".dropdown-backdrop").remove(),t(e).each((function(){var e=t(this),n=o(e),s={relatedTarget:this};n.hasClass("open")&&(i&&"click"==i.type&&/input|textarea/i.test(i.target.tagName)&&t.contains(n[0],i.target)||(n.trigger(i=t.Event("hide.bs.dropdown",s)),i.isDefaultPrevented()||(e.attr("aria-expanded","false"),n.removeClass("open").trigger(t.Event("hidden.bs.dropdown",s)))))})))}i.VERSION="3.4.1",i.prototype.toggle=function(e){var i=t(this);if(!i.is(".disabled, :disabled")){var s=o(i),a=s.hasClass("open");if(n(),!a){var r={relatedTarget:this};if(s.trigger(e=t.Event("show.bs.dropdown",r)),e.isDefaultPrevented())return;i.trigger("focus").attr("aria-expanded","true"),s.toggleClass("open").trigger(t.Event("shown.bs.dropdown",r))}return!1}},i.prototype.keydown=function(i){if(/(38|40|27|32)/.test(i.which)&&!/input|textarea/i.test(i.target.tagName)){var n=t(this);if(i.preventDefault(),i.stopPropagation(),!n.is(".disabled, :disabled")){var s=o(n),a=s.hasClass("open");if(!a&&27!=i.which||a&&27==i.which)return 27==i.which&&s.find(e).trigger("focus"),n.trigger("click");var r=s.find(".dropdown-menu li:not(.disabled):visible a");if(r.length){var l=r.index(i.target);38==i.which&&l>0&&l--,40==i.which&&l<r.length-1&&l++,~l||(l=0),r.eq(l).trigger("focus")}}}};var s=t.fn.dropdown;t.fn.dropdown=function(e){return this.each((function(){var o=t(this),n=o.data("bs.dropdown");n||o.data("bs.dropdown",n=new i(this)),"string"==typeof e&&n[e].call(o)}))},t.fn.dropdown.Constructor=i,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=s,this},t(document).on("click.bs.dropdown.data-api",n).on("click.bs.dropdown.data-api",".dropdown form",(function(t){t.stopPropagation()})).on("click.bs.dropdown.data-api",e,i.prototype.toggle).on("keydown.bs.dropdown.data-api",e,i.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",i.prototype.keydown)}(jQuery),define("common/main/lib/mods/dropdown",(function(){})),function(t){"use strict";var e=["sanitize","whiteList","sanitizeFn"],i=["background","cite","href","itemtype","longdesc","poster","src","xlink:href"],o={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},n=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,s=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+/]+=*$/i;function a(e,o){var a=e.nodeName.toLowerCase();if(-1!==t.inArray(a,o))return-1===t.inArray(a,i)||Boolean(e.nodeValue.match(n)||e.nodeValue.match(s));for(var r=t(o).filter((function(t,e){return e instanceof RegExp})),l=0,c=r.length;l<c;l++)if(a.match(r[l]))return!0;return!1}function r(e,i,o){if(0===e.length)return e;if(o&&"function"==typeof o)return o(e);if(!document.implementation||!document.implementation.createHTMLDocument)return e;var n=document.implementation.createHTMLDocument("sanitization");n.body.innerHTML=e;for(var s=t.map(i,(function(t,e){return e})),r=t(n.body).find("*"),l=0,c=r.length;l<c;l++){var h=r[l],d=h.nodeName.toLowerCase();if(-1!==t.inArray(d,s))for(var m=t.map(h.attributes,(function(t){return t})),p=[].concat(i["*"]||[],i[d]||[]),u=0,g=m.length;u<g;u++)a(m[u],p)||h.removeAttribute(m[u].nodeName);else h.parentNode.removeChild(h)}return n.body.innerHTML}var l=function(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)};l.VERSION="3.4.1",l.TRANSITION_DURATION=150,l.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0},sanitize:!0,sanitizeFn:null,whiteList:o},l.prototype.init=function(e,i,o){if(this.enabled=!0,this.type=e,this.$element=t(i),this.options=this.getOptions(o),this.$viewport=this.options.viewport&&t(document).find(t.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var n=this.options.trigger.split(" "),s=n.length;s--;){var a=n[s];if("click"==a)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=a){var r="hover"==a?"mouseenter":"focusin",l="hover"==a?"mouseleave":"focusout";this.$element.on(r+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},l.prototype.getDefaults=function(){return l.DEFAULTS},l.prototype.getOptions=function(i){var o=this.$element.data();for(var n in o)o.hasOwnProperty(n)&&-1!==t.inArray(n,e)&&delete o[n];return(i=t.extend({},this.getDefaults(),o,i)).delay&&"number"==typeof i.delay&&(i.delay={show:i.delay,hide:i.delay}),i.sanitize&&(i.template=r(i.template,i.whiteList,i.sanitizeFn)),i},l.prototype.getDelegateOptions=function(){var e={},i=this.getDefaults();return this._options&&t.each(this._options,(function(t,o){i[t]!=o&&(e[t]=o)})),e},l.prototype.enter=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);if(i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusin"==e.type?"focus":"hover"]=!0),i.tip().hasClass("in")||"in"==i.hoverState)i.hoverState="in";else{if(clearTimeout(i.timeout),i.hoverState="in",!i.options.delay||!i.options.delay.show)return i.show();i.timeout=setTimeout((function(){"in"==i.hoverState&&i.show()}),i.options.delay.show)}},l.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},l.prototype.leave=function(e){var i=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);if(i||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i)),e instanceof t.Event&&(i.inState["focusout"==e.type?"focus":"hover"]=!1),!i.isInStateTrue()){if(clearTimeout(i.timeout),i.hoverState="out",!i.options.delay||!i.options.delay.hide)return i.hide();i.timeout=setTimeout((function(){"out"==i.hoverState&&i.hide()}),i.options.delay.hide)}},l.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var i=t.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!i)return;var o=this,n=this.tip(),s=this.getUID(this.type);this.setContent(),n.attr("id",s),this.$element.attr("aria-describedby",s),this.options.animation&&n.addClass("fade");var a="function"==typeof this.options.placement?this.options.placement.call(this,n[0],this.$element[0]):this.options.placement,r=/\s?auto?\s?/i,c=r.test(a);c&&(a=a.replace(r,"")||"top"),n.detach().css({top:0,left:0,display:"block"}).addClass(a).data("bs."+this.type,this),this.options.container?n.appendTo(t(document).find(this.options.container)):n.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var h=this.getPosition(),d=n[0].offsetWidth,m=n[0].offsetHeight;if(c){var p=a,u=this.getPosition(this.$viewport);a="bottom"==a&&h.bottom+m>u.bottom?"top":"top"==a&&h.top-m<u.top?"bottom":"right"==a&&h.right+d>u.width?"left":"left"==a&&h.left-d<u.left?"right":a,n.removeClass(p).addClass(a)}var g=this.getCalculatedOffset(a,h,d,m);this.applyPlacement(g,a);var f=function(){var t=o.hoverState;o.$element.trigger("shown.bs."+o.type),o.hoverState=null,"out"==t&&o.leave(o)};t.support.transition&&this.$tip.hasClass("fade")?n.one("bsTransitionEnd",f).emulateTransitionEnd(l.TRANSITION_DURATION):f()}},l.prototype.applyPlacement=function(t,e){var i=this.tip(),o=i[0].offsetWidth,n=i[0].offsetHeight,s=parseInt(i.css("margin-top"),10),a=parseInt(i.css("margin-left"),10);isNaN(s)&&(s=0),isNaN(a)&&(a=0),t.top+=s,t.left+=a,(Common.Utils||common.utils).setOffset(i,t),i.addClass("in");var r=i[0].offsetWidth,l=i[0].offsetHeight;"top"==e&&l!=n&&(t.top=t.top+n-l);var c=this.getViewportAdjustedDelta(e,t,r,l);c.left?t.left+=c.left:t.top+=c.top;var h=/top|bottom/.test(e),d=h?2*c.left-o+r:2*c.top-n+l,m=h?"offsetWidth":"offsetHeight";(Common.Utils||common.utils).setOffset(i,t),this.replaceArrow(d,i[0][m],h)},l.prototype.replaceArrow=function(t,e,i){this.arrow().css(i?"left":"top",50*(1-t/e)+"%").css(i?"top":"left","")},l.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();this.options.html?(this.options.sanitize&&(e=r(e,this.options.whiteList,this.options.sanitizeFn)),t.find(".tooltip-inner").html(e)):t.find(".tooltip-inner").text(e),t.removeClass("fade in top bottom left right")},l.prototype.hide=function(e){var i=this,o=t(this.$tip),n=t.Event("hide.bs."+this.type);function s(){"in"!=i.hoverState&&o.detach(),i.$element&&i.$element.removeAttr("aria-describedby").trigger("hidden.bs."+i.type),e&&e()}if(this.$element.trigger(n),!n.isDefaultPrevented())return o.removeClass("in"),t.support.transition&&o.hasClass("fade")?o.one("bsTransitionEnd",s).emulateTransitionEnd(l.TRANSITION_DURATION):s(),this.hoverState=null,this},l.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},l.prototype.hasContent=function(){return this.getTitle()},l.prototype.getPosition=function(e){var i=(e=e||this.$element)[0],o="BODY"==i.tagName,n=(Common.Utils||common.utils).getBoundingClientRect(i);null==n.width&&(n=t.extend({},n,{width:n.right-n.left,height:n.bottom-n.top}));var s=window.SVGElement&&i instanceof window.SVGElement,a=o?{top:0,left:0}:s?null:(Common.Utils||common.utils).getOffset(e),r={scroll:o?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop()},l=o?{width:t(window).width(),height:t(window).height()}:null;return t.extend({},n,r,l,a)},l.prototype.getCalculatedOffset=function(t,e,i,o){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-o,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-o/2,left:e.left-i}:{top:e.top+e.height/2-o/2,left:e.left+e.width}},l.prototype.getViewportAdjustedDelta=function(t,e,i,o){var n={top:0,left:0};if(!this.$viewport)return n;var s=this.options.viewport&&this.options.viewport.padding||0,a=this.getPosition(this.$viewport);if(/right|left/.test(t)){var r=e.top-s-a.scroll,l=e.top+s-a.scroll+o;r<a.top?n.top=a.top-r:l>a.top+a.height&&(n.top=a.top+a.height-l)}else{var c=e.left-s,h=e.left+s+i;c<a.left?n.left=a.left-c:h>a.right&&(n.left=a.left+a.width-h)}return n},l.prototype.getTitle=function(){var t=this.$element,e=this.options;return t.attr("data-original-title")||("function"==typeof e.title?e.title.call(t[0]):e.title)},l.prototype.getUID=function(t){do{t+=~~(1e6*Math.random())}while(document.getElementById(t));return t},l.prototype.tip=function(){if(!this.$tip&&(this.$tip=t(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},l.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},l.prototype.enable=function(){this.enabled=!0},l.prototype.disable=function(){this.enabled=!1},l.prototype.toggleEnabled=function(){this.enabled=!this.enabled},l.prototype.toggle=function(e){var i=this;e&&((i=t(e.currentTarget).data("bs."+this.type))||(i=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,i))),e?(i.inState.click=!i.inState.click,i.isInStateTrue()?i.enter(i):i.leave(i)):i.tip().hasClass("in")?i.leave(i):i.enter(i)},l.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide((function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,t.$viewport=null,t.$element=null}))},l.prototype.sanitizeHtml=function(t){return r(t,this.options.whiteList,this.options.sanitizeFn)};var c=t.fn.tooltip;t.fn.tooltip=function(e){return this.each((function(){var i=t(this),o=i.data("bs.tooltip"),n="object"==_typeof(e)&&e;!o&&/destroy|hide/.test(e)||(o||i.data("bs.tooltip",o=new l(this,n)),"string"==typeof e&&o[e]())}))},t.fn.tooltip.Constructor=l,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=c,this}}(jQuery),define("common/main/lib/mods/tooltip",(function(){})),define("common/main/lib/util/LocalStorage",["gateway"],(function(){Common.localStorage=new function(){var t,e,i={};Common.Gateway.on("internalcommand",(function(t){"localstorage"==t.type&&(i=t.keys)}));var o=function(t,e,o){if(s)try{localStorage.setItem(t,e)}catch(t){}else i[t]=e},n=function(t){return s?localStorage.getItem(t):void 0===i[t]?null:i[t]};try{var s=!!window.localStorage}catch(t){s=!1}return{getId:function(){return t},setId:function(e){t=e},getItem:n,getItemAsInt:function(t,e){var i=n(t);return null!==i?parseInt(i):e||0},getBool:function(t,e){var i=n(t);return e=e||!1,null!==i?0!=parseInt(i):e},setBool:function(t,e,i){o(t,e?1:0)},setItem:o,removeItem:function(t){s?localStorage.removeItem(t):delete i[t]},setKeysFilter:function(t){e=t},getKeysFilter:function(){return e},itemExists:function(t){return null!==n(t)},sync:function(){},save:function(){}}}})),define("common/main/lib/controller/Scaling",["core"],(function(){"use strict";!Common.UI&&(Common.UI={}),Common.UI.Scaling=new function(){var t={"pixel-ratio__1":1,"pixel-ratio__1_25":1.25,"pixel-ratio__1_5":1.5,"pixel-ratio__1_75":1.75,"pixel-ratio__2":2,"pixel-ratio__2_5":2.25},e=document.body.className,i=function(e){var i=/(pixel-ratio__[\w-]+)/.exec(e);return i&&i[1]in t?i[1]:"pixel-ratio__1"},o=i(e);return new MutationObserver(function(e,n){var s=i(document.body.className);s!=o&&($("[ratio]").trigger("app:scaling",{ratio:t[s]}),o=s)}.bind(this)).observe(document.body,{attributes:!0,attributeFilter:["class"]}),{currentRatio:function(){return t[o]},currentRatioSelector:function(){return o}}}})),define("common/main/lib/controller/Themes",["core"],(function(){"use strict";!Common.UI&&(Common.UI={}),Common.UI.Themes=new function(t){!t&&(t={});var e="light",i="dark",o="system",n={"theme-system":{text:t.txtThemeSystem||"Same as system",type:o,source:"static"},"theme-light":{text:t.txtThemeLight||"Light",type:"light",source:"static",skeleton:{css:".loadmask {--sk-height-toolbar-controls: 66px; --sk-layout-padding-toolbar: 0;\n                                    --sk-shadow-toolbar: inset 0 -1px #cbcbcb; --sk-border-radius-toolbar: 0;\n                                    --sk-background-toolbar: #f7f7f7; --sk-background-toolbar-controls: #f7f7f7;\n                                    --sk-background-toolbar-header-word: #446995; --sk-background-toolbar-header-pdf: #aa5252;\n                                    --sk-background-toolbar-header-slide: #BE664F; --sk-background-toolbar-header-cell: #40865c; \n                                    --sk-background-toolbar-header-visio: #444796; \n                                    --sk-background-toolbar-tab: rgba(0,0,0,.15); --sk-background-toolbar-button: #d8dadc;\n                                    --sk-layout-padding-toolbar-controls: 0 7px; --sk-layout-padding-header: 0 8px;\n                                    --sk-canvas-background: #eee; --sk-canvas-content-background: #fff;\n                                    --sk-canvas-page-border: #dde0e5; --sk-canvas-line: rgba(0,0,0,.05);\n                                    --sk-height-formula: 24px; --sk-padding-formula: 0 0 4px 0;\n                                    --sk-border-style-formula: solid; --sk-gap-formula-field: 20px;\n                                    --sk-border-radius-formula-field: 0px;\n                                }"}},"theme-classic-light":{text:t.txtThemeClassicLight||"Classic Light",type:"light",source:"static",skeleton:{css:".loadmask {--sk-height-toolbar-controls: 66px; --sk-layout-padding-toolbar: 0;\n                                    --sk-shadow-toolbar: inset 0 -1px #cbcbcb; --sk-border-radius-toolbar: 0;\n                                    --sk-background-toolbar-header-word: #446995; --sk-background-toolbar-header-pdf: #aa5252;\n                                    --sk-background-toolbar-header-slide: #BE664F;; --sk-background-toolbar-header-cell: #40865c;\n                                    --sk-background-toolbar-header-visio: #444796; \n                                    --sk-background-toolbar: #f7f7f7; --sk-background-toolbar-controls: #f1f1f1;\n                                    --sk-background-toolbar-tab: rgba(255,255,255,.15); --sk-background-toolbar-button: #d8dadc;\n                                    --sk-layout-padding-toolbar-controls: 0 7px; --sk-layout-padding-header: 0 8px;\n                                    --sk-canvas-background: #eee; --sk-canvas-content-background: #fff;\n                                    --sk-canvas-page-border: #dde0e5; --sk-canvas-line: rgba(0,0,0,.05);\n                                    --sk-height-formula: 24px; --sk-padding-formula: 0 0 4px 0;\n                                    --sk-border-style-formula: solid; --sk-gap-formula-field: 20px;\n                                    --sk-border-radius-formula-field: 0px;\n                                }"}},"theme-dark":{text:t.txtThemeDark||"Dark",type:"dark",source:"static",skeleton:{css:".theme-dark .loadmask, .theme-type-dark .loadmask {\n                                --sk-height-toolbar-controls: 66px; --sk-layout-padding-toolbar: 0;\n                                --sk-shadow-toolbar: inset 0 -1px #616161; --sk-border-radius-toolbar: 0;\n                                --sk-background-toolbar-header-word: #2a2a2a; --sk-background-toolbar-header-pdf: #2a2a2a;\n                                --sk-background-toolbar-header-slide: #2a2a2a;--sk-background-toolbar-header-cell: #2a2a2a;\n                                --sk-background-toolbar-header-visio: #2a2a2a; \n                                --sk-background-toolbar: #404040; --sk-background-toolbar-controls: #404040;\n                                --sk-background-toolbar-tab: rgba(255,255,255,.15); --sk-background-toolbar-button: #555;\n                                --sk-layout-padding-toolbar-controls: 0 7px; --sk-layout-padding-header: 0 8px;\n                                --sk-canvas-background: #555; --sk-canvas-content-background: #fff;\n                                --sk-canvas-page-border: #555; --sk-canvas-line: rgba(0,0,0,.05);\n                                --sk-height-formula: 24px; --sk-padding-formula: 0 0 4px 0;\n                                --sk-border-style-formula: solid; --sk-gap-formula-field: 20px;\n                                --sk-border-radius-formula-field: 0px;\n                            }\n                            .content-theme-dark {\n                                --sk-canvas-content-background: #3a3a3a; --sk-canvas-page-border: #616161;\n                                --sk-canvas-line: rgba(255,255,255,.05);\n                            }"}},"theme-contrast-dark":{text:t.txtThemeContrastDark||"Dark Contrast",type:"dark",source:"static",skeleton:{css:".theme-dark .loadmask, .theme-type-dark .loadmask {\n                                --sk-height-toolbar-controls: 66px; --sk-layout-padding-toolbar: 0;\n                                --sk-shadow-toolbar: inset 0 -1px #616161; --sk-border-radius-toolbar: 0;\n                                --sk-background-toolbar-header-word: #2a2a2a; --sk-background-toolbar-header-pdf: #2a2a2a;\n                                --sk-background-toolbar-header-slide: #2a2a2a;--sk-background-toolbar-header-cell: #2a2a2a;\n                                --sk-background-toolbar-header-visio: #2a2a2a; \n                                --sk-background-toolbar: #404040; --sk-background-toolbar-controls: #404040;\n                                --sk-background-toolbar-tab: rgba(255,255,255,.15); --sk-background-toolbar-button: #555;\n                                --sk-layout-padding-toolbar-controls: 0 7px; --sk-layout-padding-header: 0 8px;\n                                --sk-canvas-background: #555; --sk-canvas-content-background: #fff;\n                                --sk-canvas-page-border: #555; --sk-canvas-line: rgba(0,0,0,.05);\n                                --sk-height-formula: 24px; --sk-padding-formula: 0 0 4px 0;\n                                --sk-border-style-formula: solid; --sk-gap-formula-field: 20px;\n                                --sk-border-radius-formula-field: 0px;\n                            }\n                            .content-theme-dark {\n                                --sk-canvas-content-background: #3a3a3a;\n                                --sk-canvas-page-border: #616161; --sk-canvas-line: rgba(255,255,255,.05);\n                            }"}},"theme-gray":{text:t.txtThemeGray||"Gray",type:"light",source:"static",skeleton:{css:".loadmask {--sk-height-toolbar-controls: 66px;--sk-layout-padding-toolbar: 0;\n                                    --sk-shadow-toolbar: inset 0 -1px #cbcbcb; --sk-border-radius-toolbar: 0;\n                                    --sk-background-toolbar-header-word: #f7f7f7; --sk-background-toolbar-header-pdf: #f7f7f7;\n                                    --sk-background-toolbar-header-slide: #f7f7f7;--sk-background-toolbar-header-cell: #f7f7f7;\n                                    --sk-background-toolbar-header-visio: #f7f7f7; \n                                    --sk-background-toolbar: #f7f7f7; --sk-background-toolbar-controls: #f1f1f1;\n                                    --sk-background-toolbar-tab: #e0e0e0; --sk-background-toolbar-button: #e0e0e0;\n                                    --sk-layout-padding-toolbar-controls: 0 7px; --sk-layout-padding-header: 0 8px;\n                                    --sk-canvas-background: #eee; --sk-canvas-content-background: #fff;\n                                    --sk-canvas-page-border: #ccc; --sk-canvas-line: rgba(0,0,0,.05);\n                                    --sk-height-formula: 24px; --sk-padding-formula: 0 0 4px 0;\n                                    --sk-border-style-formula: solid; --sk-gap-formula-field: 20px;\n                                    --sk-border-radius-formula-field: 0px;\n                                }"}},"theme-white":{text:t.txtThemeModernLight||"White",type:"light",source:"static",icons:{cls:"mod2"}},"theme-night":{text:t.txtThemeModernDark||"Night",type:"dark",source:"static",icons:{cls:"mod2"}}},s=["toolbar-header-document","toolbar-header-spreadsheet","toolbar-header-presentation","toolbar-header-pdf","toolbar-header-visio","text-toolbar-header-on-background-document","text-toolbar-header-on-background-spreadsheet","text-toolbar-header-on-background-presentation","text-toolbar-header-on-background-pdf","text-toolbar-header-on-background-visio","background-normal","background-toolbar","background-toolbar-additional","background-primary-dialog-button","background-notification-popover","background-notification-badge","background-scrim","background-loader","background-accent-button","background-contrast-popover","shadow-contrast-popover","highlight-button-hover","highlight-button-pressed","highlight-button-pressed-hover","highlight-primary-dialog-button-hover","highlight-header-button-hover","highlight-header-button-pressed","highlight-text-select","highlight-accent-button-hover","highlight-accent-button-pressed","highlight-toolbar-tab-underline-document","highlight-toolbar-tab-underline-spreadsheet","highlight-toolbar-tab-underline-presentation","highlight-toolbar-tab-underline-pdf","highlight-toolbar-tab-underline-visio","highlight-header-tab-underline-document","highlight-header-tab-underline-spreadsheet","highlight-header-tab-underline-presentation","highlight-header-tab-underline-pdf","highlight-header-tab-underline-visio","border-toolbar","border-divider","border-regular-control","border-toolbar-button-hover","border-preview-hover","border-preview-select","border-control-focus","border-color-shading","border-error","border-contrast-popover","text-normal","text-normal-pressed","text-secondary","text-tertiary","text-link","text-link-hover","text-link-active","text-link-visited","text-inverse","text-toolbar-header","text-contrast-background","text-alt-key-hint","icon-normal","icon-normal-pressed","icon-inverse","icon-toolbar-header","icon-notification-badge","icon-contrast-popover","icon-success","canvas-background","canvas-content-background","canvas-page-border","canvas-ruler-background","canvas-ruler-border","canvas-ruler-margins-background","canvas-ruler-mark","canvas-ruler-handle-border","canvas-ruler-handle-border-disabled","canvas-high-contrast","canvas-high-contrast-disabled","canvas-cell-border","canvas-cell-title-background","canvas-cell-title-background-hover","canvas-cell-title-background-selected","canvas-cell-title-border","canvas-cell-title-border-hover","canvas-cell-title-border-selected","canvas-cell-title-text","canvas-dark-cell-title","canvas-dark-cell-title-hover","canvas-dark-cell-title-selected","canvas-dark-cell-title-border","canvas-dark-cell-title-border-hover","canvas-dark-cell-title-border-selected","canvas-dark-content-background","canvas-dark-page-border","canvas-scroll-thumb","canvas-scroll-thumb-hover","canvas-scroll-thumb-pressed","canvas-scroll-thumb-border","canvas-scroll-thumb-border-hover","canvas-scroll-thumb-border-pressed","canvas-scroll-arrow","canvas-scroll-arrow-hover","canvas-scroll-arrow-pressed","canvas-scroll-thumb-target","canvas-scroll-thumb-target-hover","canvas-scroll-thumb-target-pressed","canvas-sheet-view-cell-background","canvas-sheet-view-cell-background-hover","canvas-sheet-view-cell-background-pressed","canvas-sheet-view-cell-title-label","canvas-freeze-line-1px","canvas-freeze-line-2px","canvas-select-all-icon","canvas-anim-pane-background","canvas-anim-pane-item-fill-selected","canvas-anim-pane-item-fill-hovered","canvas-anim-pane-button-fill","canvas-anim-pane-button-fill-hovered","canvas-anim-pane-button-fill-disabled","canvas-anim-pane-play-button-fill","canvas-anim-pane-play-button-outline","canvas-anim-pane-effect-bar-entrance-fill","canvas-anim-pane-effect-bar-entrance-outline","canvas-anim-pane-effect-bar-emphasis-fill","canvas-anim-pane-effect-bar-emphasis-outline","canvas-anim-pane-effect-bar-exit-fill","canvas-anim-pane-effect-bar-exit-outline","canvas-anim-pane-effect-bar-path-fill","canvas-anim-pane-effect-bar-path-outline","canvas-anim-pane-timeline-ruler-outline","canvas-anim-pane-timeline-ruler-tick","canvas-anim-pane-timeline-scroller-fill","canvas-anim-pane-timeline-scroller-outline","canvas-anim-pane-timeline-scroller-opacity","canvas-anim-pane-timeline-scroller-opacity-hovered","canvas-anim-pane-timeline-scroller-opacity-active","toolbar-height-controls","sprite-button-icons-uid"],a={},r=function(t){var e=t||s,i={};if(!Common.Utils.isIE10&&!Common.Utils.isIE11){var o=getComputedStyle(document.body);e.forEach((function(t,e){i[t]=o.getPropertyValue("--"+t).trim()}))}return i},l=function(t){var e,i=Common.Locale.getCurrentLanguage();t.themes&&t.themes instanceof Array?t.themes.forEach((function(t){t.id?(e=t.l10n&&t.l10n[i]?t.l10n[i]:t.name,n[t.id]={text:e,type:t.type,src:t}):"string"==typeof t&&h(t)})):t.id&&(e=t.l10n&&t.l10n[i]?t.l10n[i]:t.name,n[t.id]={text:e,type:t.type,src:t}),Common.NotificationCenter.trigger("uitheme:countchanged")},c=function(){var t=window.uitheme.id;if(n[t]){if("static"!=n[t].source){var e=document.body.className.match("theme-type-"+n[t].type);e?e.length&&(document.body.className=document.body.className.replace(/theme-type-(?:dark|ligth)/i,"theme-type-"+n[t].type)):document.body.classList.add("theme-type-"+n[t].type)}}else t=u().id,document.body.className=document.body.className.replace(/theme-[\w-]+\s?/gi,"").trim(),document.body.classList.add(t,"theme-type-"+n[t].type);var i=Common.localStorage.getItem("ui-theme");if(!i||m(i)!==t){var o={id:t,type:n[t].type,text:n[t].text,colors:r()};n[t].icons&&(o.icons=n[t].icons),Common.localStorage.setItem("ui-theme",JSON.stringify(o))}},h=function(t){Common.Utils.loadConfig(t,(function(t){"error"!=t?(l(t),c()):console.warn("failed to load/parse themes.json")}))},d=function(t){Common.Controllers.Desktop.isActive()?Common.Controllers.Desktop.localThemes()&&(l({themes:Common.Controllers.Desktop.localThemes()}),c()):h.call(this,"../../../../themes.json")},m=function(t){return"string"==typeof t&&t.startsWith("{")&&t.endsWith("}")&&(t=JSON.parse(t)),t&&"object"==_typeof(t)?t.id:t},p=function(t){},u=function(){var t=(Common.Controllers.Desktop&&Common.Controllers.Desktop.isActive()?Common.Controllers.Desktop.systemThemeType():window.matchMedia("(prefers-color-scheme: dark)").matches?i:e)==i?window.uitheme.DEFAULT_DARK_THEME_ID:window.uitheme.DEFAULT_LIGHT_THEME_ID;return{id:t,info:n[t]}},g=function(t){window.uitheme.is_theme_system()&&b.call(this,!0)},f=function(t){window.uitheme.set_id(t);var e=window.uitheme.relevant_theme_id();if(n[e].src){var i=n[e];!function(t,e){if(e){var i=document.createElement("style");i.id=t,i.type="text/css",i.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(i)}}(i.src.id,function(t,e){if(e&&t){var i=[":root .",t,"{"];for(var o in e)"highlight-toolbar-tab-underline"===o?(i.push("--",o+"-document",":",e[o],";"),i.push("--",o+"-spreadsheet",":",e[o],";"),i.push("--",o+"-presentation",":",e[o],";"),i.push("--",o+"-pdf",":",e[o],";"),i.push("--",o+"-visio",":",e[o],";"),console.log("Obsolete: The 'highlight-toolbar-tab-underline' color for interface themes is deprecated. Please use 'highlight-toolbar-tab-underline-document', 'highlight-toolbar-tab-underline-presentation', etc. instead.")):i.push("--",o,":",e[o],";");return i.push("}"),i.join("")}}(i.src.id,i.src.colors)),function(t){t.src&&t.src.icons&&(!t.icons&&(t.icons={}),t.src.icons["sprite-buttons-base-url"]&&(t.icons.basepath=t.src.icons["sprite-buttons-base-url"]),t.src.icons["style-class-selector"]&&(t.icons.src=t.src.icons["style-class-selector"]))}(i),delete i.src}document.body.className=document.body.className.replace(/theme-[\w-]+\s?/gi,"").trim(),document.body.classList.add(e,"theme-type-"+n[e].type);var o=getComputedStyle(document.body).getPropertyValue("--sprite-button-icons-base-url");n[e].icons&&(n[e].icons.basepath?o=n[e].icons.basepath:o&&(n[e].icons.basepath=o),n[e].icons.cls&&document.body.classList.add("theme-icons-cls-"+n[e].icons.cls)),o&&window.uitheme.apply_icons_from_url(e,o),this.api.asc_setContentDarkMode&&("dark"==n[e].type?(this.api.asc_setContentDarkMode(this.isContentThemeDark()),Common.NotificationCenter.trigger("contenttheme:dark",this.isContentThemeDark())):this.api.asc_setContentDarkMode(!1));var s=r();if(s.type=n[e].type,s.name=e,this.api.asc_setSkin(s),!Common.Utils.isIE10&&!Common.Utils.isIE11){var l=Object.assign({id:t,colors:s},n[t]);delete l.source,Common.localStorage.setItem("ui-theme",JSON.stringify(l))}a={}},b=function(t,e){if(t||Common.localStorage.getItem("ui-theme-id")!=window.uitheme.id){var i=Common.localStorage.getItem("ui-theme-id");i&&(f.call(this,i),Common.NotificationCenter.trigger("uitheme:changed",i,e))}};return{init:function(t){["toolbar-header-document","toolbar-header-spreadsheet","toolbar-header-presentation","toolbar-header-pdf","toolbar-header-visio"].forEach((function(t){document.documentElement.style.removeProperty("--"+t)})),Common.Gateway.on("opendocument",p.bind(this)),$(window).on("storage",function(t){"ui-theme-id"!=t.key||Common.Controllers.Desktop.isActive()?"content-theme"==t.key&&this.setContentTheme(t.originalEvent.newValue,!0,!1):t.originalEvent.newValue&&b.call(this)}.bind(this)),this.api=t;var i=window.uitheme.relevant_theme_id(),o=r(s);o.type=window.uitheme.type?window.uitheme.type:n[i]?n[i].type:e,o.name=i,t.asc_setSkin(o);var a=n[i]&&"dark"==n[i].type&&window.uitheme.iscontentdark;t.asc_setContentDarkMode&&t.asc_setContentDarkMode(a),document.body.classList.contains("theme-type-"+o.type)||document.body.classList.add("theme-type-"+o.type),!n[i]&&window.uitheme&&window.uitheme.id==i&&(n[i]=window.uitheme);var l=getComputedStyle(document.body);if(n[i]&&n[i].icons){if(!document.querySelector("style#"+i)){var c=n[i].icons.basepath?n[i].icons.basepath:l.getPropertyValue("--sprite-button-icons-base-url");c&&window.uitheme.apply_icons_from_url(i,c)}n[i].icons.cls&&document.body.classList.add("theme-icons-cls-"+n[i].icons.cls)}Common.Utils.isIE10||Common.Utils.isIE11||Common.Controllers.Desktop.isActive()||window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",g.bind(this)),Common.NotificationCenter.on("document:ready",d.bind(this))},available:function(){return!Common.Utils.isIE&&!this.locked},setAvailable:function(t){this.locked=!t},map:function(){if(Common.Controllers.Desktop.isActive()&&!Common.Controllers.Desktop.systemThemeSupported()){var t=Object.assign({},n);return delete t["theme-system"],t}return n},get:function(t){return n[t]},currentThemeId:function(){return n[window.uitheme.id]?window.uitheme.id:window.uitheme.DEFAULT_LIGHT_THEME_ID},currentThemeColor:function(t){return getComputedStyle(document.body).getPropertyValue(t)},defaultThemeId:function(t){return window.uitheme.DEFAULT_LIGHT_THEME_ID},defaultTheme:function(t){return n[this.defaultThemeId(t)]},isDarkTheme:function(t){return!t&&(t=this.currentThemeId()),(function(t){return n[t].type==o}(t)?u().info.type:n[t].type)==i},isContentThemeDark:function(){return window.uitheme.iscontentdark},setContentTheme:function(t,e,i){var o="dark"==t;(o!=window.uitheme.iscontentdark||e)&&(window.uitheme.iscontentdark=o,this.isDarkTheme()&&this.api.asc_setContentDarkMode(o),!1!==i&&Common.localStorage.getItem("content-theme")!=t&&Common.localStorage.setItem("content-theme",t),Common.NotificationCenter.trigger("contenttheme:dark",o))},toggleContentTheme:function(){window.uitheme.iscontentdark=!window.uitheme.iscontentdark,Common.localStorage.setItem("content-theme",window.uitheme.iscontentdark?"dark":"light"),this.isDarkTheme()&&this.api.asc_setContentDarkMode(window.uitheme.iscontentdark),Common.NotificationCenter.trigger("contenttheme:dark",window.uitheme.iscontentdark)},setTheme:function(t,e){if(t){var i=m(t);n[i]&&i!=window.uitheme.id&&(f.call(this,i),Common.localStorage.setItem("ui-theme-id",i),Common.NotificationCenter.trigger("uitheme:changed",i,e))}},refreshTheme:b,addTheme:function(t){l(t)},toggleTheme:function(){},getThemeColors:function(){var t=window.uitheme.relevant_theme_id(),e=r();return e.type=n[t]?n[t].type:"light",e.name=t,e},getThemeProps:function(t){if("font"===t)a[t]||(a[t]={size:document.documentElement.style.getPropertyValue("--font-size-base-app-custom")||window.getComputedStyle(document.body).getPropertyValue("--font-size-base")||"11px",name:document.documentElement.style.getPropertyValue("--font-family-base-custom")||'Arial, Helvetica, "Helvetica Neue", sans-serif'});else if("tab-style"===t)return Common.Utils.isIE||Common.Controllers.Desktop&&Common.Controllers.Desktop.isWinXp()?"fill":window.getComputedStyle(document.body).getPropertyValue("--toolbar-preferred-tab-style")||"line";return a[t]}}}(Common.UI.Themes)})),define("common/main/lib/controller/TabStyler",["core"],(function(){"use strict";!Common.UI&&(Common.UI={}),Common.UI.TabStyler=new function(){var t,e=!0,i=!0,o=function(){if(Common.localStorage.getItem("settings-tab-style")!==Common.Utils.InternalSettings.get("settings-tab-style")){var t=Common.localStorage.getItem("settings-tab-style");t&&(Common.Utils.InternalSettings.set("settings-tab-style",t),Common.NotificationCenter.trigger("tabstyle:changed",t))}},n=function(){if(Common.localStorage.getItem("settings-tab-background")!==Common.Utils.InternalSettings.get("settings-tab-background")){var t=Common.localStorage.getItem("settings-tab-background");t&&(Common.Utils.InternalSettings.set("settings-tab-background",t),Common.NotificationCenter.trigger("tabbackground:changed",t))}},s=function(i){i?(Common.localStorage.setItem("settings-tab-style",i),Common.Utils.InternalSettings.set("settings-tab-style",i)):(i=Common.UI.FeaturesManager.getInitValue("tabStyle",!0),e&&Common.localStorage.itemExists("settings-tab-style")?i=Common.localStorage.getItem("settings-tab-style"):void 0===i&&(i=t&&"object"===_typeof(t)&&t.toolbarNoTabs?"line":Common.UI.Themes.getThemeProps("tab-style")),Common.Utils.InternalSettings.set("settings-tab-style",i||"fill")),Common.NotificationCenter.trigger("tabstyle:changed",i)},a=function(){s()};return{init:function(s){t=s,e=Common.UI.FeaturesManager.canChange("tabStyle",!0),i=!Common.Utils.isIE&&Common.UI.FeaturesManager.canChange("tabBackground",!0);var r=Common.UI.FeaturesManager.getInitValue("tabStyle",!0);e&&Common.localStorage.itemExists("settings-tab-style")?r=Common.localStorage.getItem("settings-tab-style"):void 0===r&&(r=t&&"object"===_typeof(t)&&t.toolbarNoTabs?"line":Common.UI.Themes.getThemeProps("tab-style")),Common.Utils.InternalSettings.set("settings-tab-style",r||"fill"),r=Common.UI.FeaturesManager.getInitValue("tabBackground",!0),i&&Common.localStorage.itemExists("settings-tab-background")?r=Common.localStorage.getItem("settings-tab-background"):void 0===r&&t&&"object"===_typeof(t)&&t.toolbarNoTabs&&(r="toolbar"),Common.Utils.InternalSettings.set("settings-tab-background",r||"header"),t&&"object"===_typeof(t)&&t.toolbarNoTabs&&console.log("Obsolete: The 'toolbarNoTabs' parameter of the 'customization' section is deprecated. Please use 'tabStyle' and 'tabBackground' parameters in the 'customization.features' section instead."),$(window).on("storage",(function(t){"settings-tab-style"===t.key&&e?o(t.originalEvent.newValue):"settings-tab-background"===t.key&&i&&n(t.originalEvent.newValue)})),Common.NotificationCenter.on("uitheme:changed",a)},setStyle:s,setBackground:function(t){Common.localStorage.setItem("settings-tab-background",t),Common.Utils.InternalSettings.set("settings-tab-background",t),Common.NotificationCenter.trigger("tabbackground:changed",t)},refreshStyle:o,refreshBackground:n}}})),define("common/main/lib/controller/Desktop",["core"],(function(){"use strict";var t=window.DE||window.PE||window.SSE||window.PDFE||window.VE,e=Object.assign({version:"9.0.57.1",eventloading:!0,titlebuttons:!0,uithemes:!0,btnhome:!0,quickprint:!0,framesize:{width:window.innerWidth,height:window.innerHeight}},t.features),i=window.desktop||window.AscDesktopEditor;i&&i.execCommand("webapps:features",JSON.stringify(e));!Common.Controllers&&(Common.Controllers={}),Common.Controllers.Desktop=new function(){var o,n,s,a={version:"9.0.57.1"},r={"btn-save":"save","btn-save-coauth":"coauth","btn-synch":"synch"},c=[];if(i){if(i.features=i.features||{},n=window.RendererProcessVariable,window.on_native_message=function(e,s){if(/^style:change/.test(e)){if("toolbar"==(l=JSON.parse(s)).element)"off"==l.action&&"native-color"==l.style&&$(".toolbar").removeClass("editor-native-color");else if("body"==l.element&&"merge"==l.action){var r=document.createElement("style");r.innerHTML=l.style,document.body.appendChild(r)}}else if(/window:features/.test(e)){var l=JSON.parse(s);_.isNumber(l.skiptoparea)&&($(".asc-window.modal").length&&$(".asc-window.modal").position().top<l.skiptoparea&&$(".asc-window.modal").css("top",l.skiptoparea),Common.Utils.InternalSettings.set("window-inactive-area-top",l.skiptoparea)),void 0!==l.singlewindow&&(a.isFillFormApp?$("#title-doc-name")[l.singlewindow?"hide":"show"]():o&&o.home&&o.home.btn.setVisible(l.singlewindow),i.features.singlewindow=l.singlewindow,Common.NotificationCenter.trigger("desktop:window",{compositetitle:i.features.singlewindow}))}else if(/editor:config/.test(e)){if("request"==s){var c={user:a.user,title:{buttons:[]}};if(o){if(!$.isEmptyObject(o))if(t.getController("Viewport").getView("Common.Views.Header")){if(i.getViewportSettings)"window"==i.getViewportSettings().widgetType&&o.home&&o.home.btn.setVisible(!0);for(var h in o)c.title.buttons.push(m(h,o[h]))}i.execCommand("editor:config",JSON.stringify(c))}else a.callback_editorconfig||(a.callback_editorconfig=function(){setTimeout((function(){window.on_native_message(e,s)}),0)})}}else if(/button:click/.test(e)){(l=JSON.parse(s)).action&&o[l.action]&&o[l.action].btn.click()}else if(/theme:changed/.test(e))Common.UI.Themes.setTheme(s,"native");else if(/^uitheme:added/.test(e)){var d;n.localthemes||(n.localthemes=[]);try{d=JSON.parse(s)}catch(t){console.warn("local theme is broken")}d&&(d instanceof Array?(n.localthemes=[].concat(n.localthemes,d),Common.UI.Themes.addTheme({themes:d})):(n.localthemes.push(d),Common.UI.Themes.addTheme(d)))}else if(/renderervars:changed/.test(e)){var p=JSON.parse(s);p.theme&&p.theme.system&&(window.RendererProcessVariable.theme.system=p.theme.system,"theme-system"==Common.UI.Themes.currentThemeId()&&Common.UI.Themes.refreshTheme(!0,"native"))}else if(/element:show/.test(e)){var u=/title:(?:(true|show)|(false|hide))/.exec(s);u&&(u[1]?$("#app-title").show():u[2]&&$("#app-title").hide())}else if(/althints:show/.test(e))/false|hide/.test(s)&&Common.NotificationCenter&&Common.NotificationCenter.trigger("hints:clear");else if(/file:print/.test(e))t.getController("Main").onPrint();else if(/printer:config/.test(e)){var g,f=null,b=[];try{g=JSON.parse(s)}catch(t){console.warn("printers info is broken")}g&&(g.printers&&(b=g.printers),g.current_printer&&(f=g.current_printer));var C=t.getController("Print");C&&C.setPrinterInfo(f,b)}else/file:saveas/.test(e)?t.getController("Main").api.asc_DownloadAs():/file:save/.test(e)&&t.getController("Main").api.asc_Save()},window.on_native_message("editor:config","request"),window.native_message_cmd)for(var h in window.native_message_cmd)"uitheme:changed"!=h&&window.on_native_message(h,window.native_message_cmd[h]);i.execCommand("webapps:features",JSON.stringify(e)),window.onupdaterecents=function(t){c=S(t),Common.NotificationCenter.trigger("update:recents",c)};var d=document.createElement("style");d.appendChild(document.createTextNode(".modals-mask{opacity:0 !important;}")),document.getElementsByTagName("head")[0].appendChild(d)}var m=function(t,e){return{action:t,icon:e.icon||void 0,hint:e.btn.options.hint,disabled:e.btn.isDisabled(),visible:e.btn.isVisible()}},p=function(t,e,o){var n={};n[t]=o,i.execCommand("title:button",JSON.stringify({disabled:n}))},u=function(t,e){i.execCommand("title:button",JSON.stringify({"icon:changed":{save:r[e.next]}}))},g=function(t){if("open"==t)i.execCommand("title:button",JSON.stringify({disabled:{all:!0}}));else{var e={};for(var n in o)e[n]=o[n].btn.isDisabled();i.execCommand("title:button",JSON.stringify({disabled:e}))}},f=function(t,e){var n={visible:t&&!(e>0)};o&&(n.hints={},o.print&&(n.hints.print=o.print.btn.btnEl.attr("data-hint-title-lang")),o.quickprint&&(n.hints.quickprint=o.quickprint.btn.btnEl.attr("data-hint-title-lang")),o.undo&&(n.hints.undo=o.undo.btn.btnEl.attr("data-hint-title-lang")),o.redo&&(n.hints.redo=o.redo.btn.btnEl.attr("data-hint-title-lang")),o.save&&(n.hints.save=o.save.btn.btnEl.attr("data-hint-title-lang")),o.startover&&(n.hints.startover=o.startover.btn.btnEl.attr("data-hint-title-lang"))),i.execCommand("althints:show",JSON.stringify(n))},b=function(t){Common.UI.HintManager&&Common.UI.HintManager.isHintVisible()?(i.execCommand("althints:keydown",JSON.stringify({code:t.keyCode})),console.log("hint keydown",t.keyCode)):78==t.keyCode&&a.canCreateNew&&!t.shiftKey&&(Common.Utils.isWindows&&t.ctrlKey&&!t.metaKey||Common.Utils.isMac&&t.metaKey&&!t.ctrlKey)&&this.process("create:new")},C=function(t){if(o.quickprint){var e=window.SSE?"sse-settings-quick-print-button":window.PE?"pe-settings-quick-print-button":window.PDFE?"pdfe-settings-quick-print-button":window.VE?"ve-settings-quick-print-button":"de-settings-quick-print-button",n=Common.localStorage.getBool(e,!1);if(o.quickprint.visible!=n){o.quickprint.visible=n;var s={visible:{quickprint:n}};i.execCommand("title:button",JSON.stringify(s))}}},v=function(){var t=this,e=function(t,e,i){return(/\/$/.test(t)?t:t+"/")+e+i};fetch(e("resources/help/",Common.Locale.getDefaultLanguage(),"/Contents.json")).then((function(t){t.ok&&fetch(e("resources/help/",Common.Locale.getCurrentLanguage(),"/Contents.json")).then((function(t){t.ok&&(s=e("resources/help/",Common.Locale.getCurrentLanguage(),""))})).catch((function(t){s=e("resources/help/",Common.Locale.getDefaultLanguage(),"")}))})).catch((function(i){t.helpUrl()&&fetch(e(t.helpUrl(),Common.Locale.getDefaultLanguage(),"/Contents.json")).then((function(t){return t.json()})).then((function(i){fetch(e(t.helpUrl(),Common.Locale.getCurrentLanguage(),"/Contents.json")).then((function(t){return t.json()})).then((function(i){s=e(t.helpUrl(),Common.Locale.getCurrentLanguage(),"")})).catch((function(i){s=e(t.helpUrl(),Common.Locale.getDefaultLanguage(),"")}))})).catch((function(t){}))}))},w=function(t){_.extend(a,t),i&&i.execCommand("doc:onready",""),i&&i.LocalFileRecents(),$(".toolbar").addClass("editor-native-color")},A=function(){if(a.isEdit){var o=t.getController("Viewport").getView("Common.Views.Header"),n=t.getController("Main").api,s=n.asc_getLocalRestrictions?n.asc_getLocalRestrictions():Asc.c_oAscLocalRestrictionType.None;Asc.c_oAscLocalRestrictionType.None!==s&&(e.readonly=!0,o.setDocumentReadOnly(!0),n.asc_setLocalRestrictions(Asc.c_oAscLocalRestrictionType.None),new Common.UI.SynchronizeTip({extCls:"no-arrow",placement:"bottom",target:$(".toolbar"),text:(r=s,r===Asc.c_oAscLocalRestrictionType.ReadOnly?Common.Locale.get("tipFileReadOnly",{name:"Common.Translation",default:"Document is read only. You can make changes and save its local copy later."}):Common.Locale.get("tipFileLocked",{name:"Common.Translation",default:"Document is locked for editing. You can make changes and save its local copy later."})),showLink:!1}).on("closeclick",(function(){this.close()})).show(),i.execCommand("webapps:features",JSON.stringify(e)),n.asc_registerCallback("asc_onDocumentName",(function(){e.readonly&&n.asc_getLocalRestrictions()==Asc.c_oAscLocalRestrictionType.None&&(e.readonly=!1,o.setDocumentReadOnly(!1),i.execCommand("webapps:features",JSON.stringify(e)))})))}var r},y=function(n){if(e.viewmode=window.PDFE?!!n.isXpsViewer:!n.isEdit,e.viewmode&&(e.btnhome=!1),e.crypted=n.isCrypted,i.execCommand("webapps:features",JSON.stringify(e)),o={},!e.viewmode){var s,l=t.getController("Viewport").getView("Common.Views.Header");if(i.getViewportSettings&&(s=i.getViewportSettings()),l.btnHome=new Common.UI.Button({cls:"btn-header",iconCls:"toolbar__icon icon--inverse btn-home",visible:s&&"window"==s.widgetType,hint:Common.Locale.get("hintBtnHome",{name:"Common.Controllers.Desktop",default:"Show Main window"}),dataHint:"0",dataHintDirection:"right",dataHintOffset:"10, -18",dataHintTitle:"K"}).render($("#box-document-title #slot-btn-dt-home")),o.home={btn:l.btnHome},l.btnHome.on("click",(function(t){i.execCommand("title:button",JSON.stringify({click:"home"}))})),$("#id-box-doc-name").on({dblclick:function(t){i.execCommand("title:dblclick",JSON.stringify({x:t.originalEvent.screenX,y:t.originalEvent.screenY}))},mousedown:function(t){i.execCommand("title:mousedown",JSON.stringify({x:t.originalEvent.screenX,y:t.originalEvent.screenY}))},mousemove:function(t){i.execCommand("title:mousemove",JSON.stringify({x:t.originalEvent.screenX,y:t.originalEvent.screenY}))},mouseup:function(t){i.execCommand("title:mouseup",JSON.stringify({x:t.originalEvent.screenX,y:t.originalEvent.screenY}))}}),l.btnSave){o.save={btn:l.btnSave};var c=/\s?([^\s]+)$/.exec(o.save.btn.$icon.attr("class"));c&&c.length&&(o.save.icon=r[c])}for(var h in l.btnPrint&&(o.print={btn:l.btnPrint}),l.btnPrintQuick&&(o.quickprint={btn:l.btnPrintQuick,visible:l.btnPrintQuick.isVisible()}),l.btnUndo&&(o.undo={btn:l.btnUndo}),l.btnRedo&&(o.redo={btn:l.btnRedo}),l.btnStartOver&&(o.startover={btn:l.btnStartOver}),l.btnQuickAccess&&(o.quickaccess={btn:l.btnQuickAccess}),o)o[h].btn.options.signals=["disabled"],o[h].btn.on("disabled",p.bind(this,h));o.save&&(o.save.btn.options.signals.push("icon:changed"),o.save.btn.on("icon:changed",u.bind(this)))}a.callback_editorconfig&&(a.callback_editorconfig(),delete a.callback_editorconfig),void 0!==i.features.singlewindow&&(a.isFillFormApp&&$("#title-doc-name")[i.features.singlewindow?"hide":"show"](),o.home&&o.home.btn.setVisible(i.features.singlewindow))},S=function(t){var e=[],i=/Win/.test(navigator.platform)?/([^\\/]+\.[a-zA-Z0-9]{1,})$/:/([^/]+\.[a-zA-Z0-9]{1,})$/;for(var o in t){var n=t[o];if(l.matchFileFormat(n.type)&&i.test(n.path)){var s=i.exec(n.path)[1],a=n.path.slice(0,n.path.length-s.length-1);e.push({fileid:n.id,type:n.type,format:l.parseFileFormat(n.type),title:s,url:n.path,folder:a})}}return e},x=function(t,e,i){console.log("open recent")},k=function(t){i.execCommand("quickaccess:changed",JSON.stringify(t))},T=function(e){console.log("extend menu file");var i=t.getController("LeftMenu").leftMenu.getMenu("file"),o=t.getController("Main").appOptions.canCreateNew;if(i.miNew.visible&&o){var n=new Common.UI.MenuItem({el:$('<li id="fm-btn-create-fromtpl" class="fm-btn"></li>'),action:"create:fromtemplate",caption:I("itemCreateFromTemplate","Create from template"),canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]});n.$el.insertAfter(i.miNew.$el),i.items.push(n)}},I=function(t,e){return Common.Locale.get(t,{name:"Common.Controllers.Desktop",default:e})};return{init:function(o){if(_.extend(a,o),a.isDesktopApp){var s=n&&"winxp"===n.os;Common.UI.Themes.setAvailable(!s),Common.NotificationCenter.on({"app:ready":w,"document:ready":A.bind(this),"app:face":y.bind(this),"modal:show":g.bind(this,"open"),"modal:close":g.bind(this,"close"),"modal:hide":g.bind(this,"hide"),"uitheme:changed":function(t,e){if("native"!=e)if(window.uitheme.is_theme_system())i.execCommand("uitheme:changed",JSON.stringify({name:"theme-system"}));else{var o=Common.UI.Themes.get(t);o&&i.execCommand("uitheme:changed",JSON.stringify({name:t,type:o.type}))}},"hints:show":f.bind(this),"quickaccess:changed":k.bind(this)}),t.addListeners({FileMenu:{"item:click":function(t,e,o){"file:exit"==e?(i.execCommand("editor:event",JSON.stringify({action:"file:close"})),t.hide()):"file:open"==e?(i.execCommand("editor:event",JSON.stringify({action:"file:open"})),t.hide()):"create:fromtemplate"==e&&(i.execCommand("create:new","template:"+(window.SSE?"cell":window.PE?"slide":window.VE?"visio":window.PDFE||window.PDFE||a.isPDFForm?"form":"word")),t.hide())},"settings:apply":C.bind(this),"recent:open":x.bind(this),"render:after":T}},{id:"desktop"}),$(document).on("keydown",b.bind(this)),"fillform"==e.uitype&&(a.isFillFormApp=!0,$("#header-logo, .brand-logo").hide()),v.call(this)}},process:function(t){if(a.isDesktopApp&&i){if("goback"==t)return i.execCommand("go:folder",a.isOffline?"offline":a.customization.goback.url),!0;if("preloader:hide"==t)return i.execCommand("editor:onready",""),!0;if("create:new"==t&&"desktop://create.new"==a.createUrl)return i.execCommand("create:new",window.SSE?"cell":window.PE?"slide":window.VE?"visio":window.PDFE||a.isPDFForm?"form":"word"),!0}return!1},requestClose:function(){a.isDesktopApp&&i&&i.execCommand("editor:event",JSON.stringify({action:"file:close",url:a.customization.goback.url}))},removeRecent:function(){a.isDesktopApp&&i&&i.execCommand("recent:forget")},isActive:function(){return!!i},isOffline:function(){return a.isFillFormApp?t.getController("ApplicationController").appOptions.isOffline:t.getController("Main").appOptions.isOffline},isFeatureAvailable:function(t){return!!i&&!!i[t]},isWinXp:function(){return n&&"winxp"===n.os},call:function(t){if(i[t]){var e=[].slice.call(arguments,1);return i[t].apply(this,e)}},helpUrl:function(){if(s)return s;if(n&&n.helpUrl){var t=window.SSE?"spreadsheeteditor":window.PE?"presentationeditor":window.PDFE?"pdfeditor":window.VE?"visioeditor":"documenteditor";return n.helpUrl+"/"+t+"/main/resources/help"}},isHelpAvailable:function(){return!!s},getDefaultPrinterName:function(){return n?n.defaultPrinterName:""},systemThemeType:function(){return n.theme&&n.theme.system?n.theme.system:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},systemThemeSupported:function(){return n.theme&&"disabled"!==n.theme.system},localThemes:function(){return n?n.localthemes:void 0},recentFiles:function(){return c},openRecent:function(t){if(this.isActive()){var e={name:Common.Utils.String.htmlDecode(t.get("title")),path:Common.Utils.String.htmlDecode(t.get("url"))};return null!=t.get("fileid")&&null!=t.get("fileid")?(e.id=t.get("fileid"),e.type=t.type):e.id=-1,i.execCommand("open:recent",JSON.stringify(e)),!0}return!1},uiRtlSupported:function(){return n&&null!=n.rtl},systemLangs:function(){return n&&n.keyboard?n.keyboard.langs:void 0}}};var o=64,n=128,s=256,a=512,r=16384,l={defines:{}};l.defines.FileFormat={FILE_UNKNOWN:0,FILE_DOCUMENT:o,FILE_DOCUMENT_DOCX:65,FILE_DOCUMENT_DOC:66,FILE_DOCUMENT_ODT:67,FILE_DOCUMENT_RTF:68,FILE_DOCUMENT_TXT:69,FILE_DOCUMENT_HTML:70,FILE_DOCUMENT_MHT:71,FILE_DOCUMENT_EPUB:72,FILE_DOCUMENT_FB2:73,FILE_DOCUMENT_MOBI:74,FILE_DOCUMENT_DOCM:75,FILE_DOCUMENT_DOTX:76,FILE_DOCUMENT_DOTM:77,FILE_DOCUMENT_ODT_FLAT:78,FILE_DOCUMENT_OTT:79,FILE_DOCUMENT_DOC_FLAT:80,FILE_DOCUMENT_OFORM:85,FILE_DOCUMENT_DOCXF:86,FILE_DOCUMENT_OFORM_PDF:87,FILE_DOCUMENT_PAGES:88,FILE_DOCUMENT_HWP:89,FILE_DOCUMENT_HWPX:96,FILE_DOCUMENT_XML:112,FILE_PRESENTATION:n,FILE_PRESENTATION_PPTX:129,FILE_PRESENTATION_PPT:130,FILE_PRESENTATION_ODP:131,FILE_PRESENTATION_PPSX:132,FILE_PRESENTATION_PPTM:133,FILE_PRESENTATION_PPSM:134,FILE_PRESENTATION_POTX:135,FILE_PRESENTATION_POTM:136,FILE_PRESENTATION_ODP_FLAT:137,FILE_PRESENTATION_OTP:138,FILE_PRESENTATION_ODG:140,FILE_PRESENTATION_KEY:141,FILE_SPREADSHEET:s,FILE_SPREADSHEET_XLSX:257,FILE_SPREADSHEET_XLS:258,FILE_SPREADSHEET_ODS:259,FILE_SPREADSHEET_CSV:260,FILE_SPREADSHEET_XLSM:261,FILE_SPREADSHEET_XLTX:262,FILE_SPREADSHEET_XLTM:263,FILE_SPREADSHEET_XLSB:264,FILE_SPREADSHEET_ODS_FLAT:265,FILE_SPREADSHEET_OTS:266,FILE_SPREADSHEET_NUMBERS:269,FILE_CROSSPLATFORM:a,FILE_CROSSPLATFORM_PDF:513,FILE_CROSSPLATFORM_SWF:514,FILE_CROSSPLATFORM_DJVU:515,FILE_CROSSPLATFORM_XPS:516,FILE_CROSSPLATFORM_PDFA:521,FILE_DRAW:r,FILE_DRAW_VSDX:16385,FILE_DRAW_VSSX:16386,FILE_DRAW_VSTX:16387,FILE_DRAW_VSDM:16388,FILE_DRAW_VSSM:16389,FILE_DRAW_VSTM:16390},l.parseFileFormat=function(t){switch(t){case l.defines.FileFormat.FILE_DOCUMENT_DOC:return"doc";case l.defines.FileFormat.FILE_DOCUMENT_DOCX:return"docx";case l.defines.FileFormat.FILE_DOCUMENT_ODT:return"odt";case l.defines.FileFormat.FILE_DOCUMENT_RTF:return"rtf";case l.defines.FileFormat.FILE_DOCUMENT_TXT:return"txt";case l.defines.FileFormat.FILE_DOCUMENT_HTML:return"html";case l.defines.FileFormat.FILE_DOCUMENT_MHT:return"mht";case l.defines.FileFormat.FILE_DOCUMENT_EPUB:return"epub";case l.defines.FileFormat.FILE_DOCUMENT_FB2:return"fb2";case l.defines.FileFormat.FILE_DOCUMENT_DOCM:return"docm";case l.defines.FileFormat.FILE_DOCUMENT_DOTX:return"dotx";case l.defines.FileFormat.FILE_DOCUMENT_OTT:return"ott";case l.defines.FileFormat.FILE_DOCUMENT_OFORM:return"oform";case l.defines.FileFormat.FILE_DOCUMENT_OFORM_PDF:return"pdf";case l.defines.FileFormat.FILE_DOCUMENT_DOCXF:return"docxf";case l.defines.FileFormat.FILE_DOCUMENT_ODT_FLAT:return"fodt";case l.defines.FileFormat.FILE_DOCUMENT_DOTM:return"dotm";case l.defines.FileFormat.FILE_DOCUMENT_XML:return"xml";case l.defines.FileFormat.FILE_DOCUMENT_PAGES:return"pages";case l.defines.FileFormat.FILE_DOCUMENT_HWP:return"hwpx";case l.defines.FileFormat.FILE_DOCUMENT_HWPX:return"hwp";case l.defines.FileFormat.FILE_SPREADSHEET_XLS:return"xls";case l.defines.FileFormat.FILE_SPREADSHEET_XLTX:return"xltx";case l.defines.FileFormat.FILE_SPREADSHEET_XLSX:return"xlsx";case l.defines.FileFormat.FILE_SPREADSHEET_XLSB:return"xlsb";case l.defines.FileFormat.FILE_SPREADSHEET_ODS:return"ods";case l.defines.FileFormat.FILE_SPREADSHEET_CSV:return"csv";case l.defines.FileFormat.FILE_SPREADSHEET_OTS:return"ots";case l.defines.FileFormat.FILE_SPREADSHEET_XLTM:return"xltm";case l.defines.FileFormat.FILE_SPREADSHEET_XLSM:return"xlsm";case l.defines.FileFormat.FILE_SPREADSHEET_ODS_FLAT:return"fods";case l.defines.FileFormat.FILE_SPREADSHEET_NUMBERS:return"numbers";case l.defines.FileFormat.FILE_PRESENTATION_PPT:return"ppt";case l.defines.FileFormat.FILE_PRESENTATION_POTX:return"potx";case l.defines.FileFormat.FILE_PRESENTATION_PPTX:return"pptx";case l.defines.FileFormat.FILE_PRESENTATION_ODP:return"odp";case l.defines.FileFormat.FILE_PRESENTATION_PPSX:return"ppsx";case l.defines.FileFormat.FILE_PRESENTATION_OTP:return"otp";case l.defines.FileFormat.FILE_PRESENTATION_PPTM:return"pptm";case l.defines.FileFormat.FILE_PRESENTATION_PPSM:return"ppsm";case l.defines.FileFormat.FILE_PRESENTATION_POTM:return"potm";case l.defines.FileFormat.FILE_PRESENTATION_ODP_FLAT:return"fodp";case l.defines.FileFormat.FILE_PRESENTATION_ODG:return"odg";case l.defines.FileFormat.FILE_PRESENTATION_KEY:return"key";case l.defines.FileFormat.FILE_CROSSPLATFORM_PDFA:case l.defines.FileFormat.FILE_CROSSPLATFORM_PDF:return"pdf";case l.defines.FileFormat.FILE_CROSSPLATFORM_DJVU:return"djvu";case l.defines.FileFormat.FILE_CROSSPLATFORM_XPS:return"xps";case l.defines.FileFormat.FILE_DRAW_VSTX:case l.defines.FileFormat.FILE_DRAW_VSSX:case l.defines.FileFormat.FILE_DRAW_VSDM:case l.defines.FileFormat.FILE_DRAW_VSSM:case l.defines.FileFormat.FILE_DRAW_VSTM:case l.defines.FileFormat.FILE_DRAW_VSDX:return"vsdx"}return""},l.matchFileFormat=function(t){return window.PE?t>l.defines.FileFormat.FILE_PRESENTATION&&!(t>l.defines.FileFormat.FILE_SPREADSHEET):window.DE?t>l.defines.FileFormat.FILE_DOCUMENT&&!(t>l.defines.FileFormat.FILE_PRESENTATION)||t==l.defines.FileFormat.FILE_CROSSPLATFORM_PDF||t==l.defines.FileFormat.FILE_CROSSPLATFORM_PDFA||t==l.defines.FileFormat.FILE_CROSSPLATFORM_DJVU:window.SSE?t>l.defines.FileFormat.FILE_SPREADSHEET&&!(t>l.defines.FileFormat.FILE_CROSSPLATFORM)||t==l.defines.FileFormat.FILE_CROSSPLATFORM_XPS:window.PDFE?t==l.defines.FileFormat.FILE_CROSSPLATFORM_PDFA||t==l.defines.FileFormat.FILE_CROSSPLATFORM_PDF||t==l.defines.FileFormat.FILE_CROSSPLATFORM_DJVU||t==l.defines.FileFormat.FILE_CROSSPLATFORM_XPS:!!window.VE&&(t==l.defines.FileFormat.FILE_DRAW_VSDX||t==l.defines.FileFormat.FILE_DRAW_VSDM||t==l.defines.FileFormat.FILE_DRAW_VSTX||t==l.defines.FileFormat.FILE_DRAW_VSTM||t==l.defines.FileFormat.FILE_DRAW_VSSX||t==l.defines.FileFormat.FILE_DRAW_VSSM)}})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Header",["backbone","core"],(function(t){"use strict";Common.Views.Header=t.View.extend(_.extend(function(){var t,e,i,o,n,s,a,r=!1,l="",c=!!window.PDFE,h=!!window.DE,d=!!window.SSE,m=!!window.PE,p=!!window.VE,u='<li id="<%= user.get("iid") %>" class="<% if (!user.get("online")) { %> offline <% } if (user.get("view")) {%> viewmode <% } %>"><div class="user-name"><div class="color"<% if (user.get("avatar")) { %>style="background-image: url(<%=user.get("avatar")%>); <% if (user.get("color")!==null) { %> border-color:<%=user.get("color")%>; border-style: solid;<% }%>"<% } else { %>style="background-color: <% if (user.get("color")!==null) { %> <%=user.get("color")%> <% } else { %> #cfcfcf <% }%>;"<% } %>><% if (!user.get("avatar")) { %><%-user.get("initials")%><% } %></div><label><%= fnEncode(user.get("username")) %></label><% if (len>1) { %><label class="margin-left-3">(<%=len%>)</label><% } %></div></li>',g=_.template("<ul><% for (originalId in users) { %><%= usertpl({user: users[originalId][0], fnEncode: fnEncode, len: users[originalId].length}) %><% } %></ul>");function f(t,s){var a=t.getVisibleEditingCount();i&&(e&&(a>1&&(e.isEdit||e.isRestrictedEdit)||a>0&&e.canLiveView)?(i.html(g({users:t.chain().filter((function(t){return t.get("online")&&!t.get("view")&&!t.get("hidden")})).groupBy((function(t){return t.get("idOriginal")})).value(),usertpl:_.template(u),fnEncode:function(t){return Common.Utils.String.htmlEncode(AscCommon.UserInfoParser.getParsedName(t))}})),i.scroller=new Common.UI.Scroller({el:i.find("ul"),useKeyboard:!0,minScrollbarLength:40,alwaysVisibleY:!0}),i.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})):i.empty()),function(t,i){if(!n)return;e&&(t>1&&(e.isEdit||e.isRestrictedEdit)||t>0&&e.canLiveView)?(o.show(),n.find(".caption").html(i)):o.hide();w()}(a,t.getVisibleEditingOriginalCount())}function b(t){f(t.collection)}function C(){r=!0,this.btnShare&&this.btnShare.setVisible(!1),w()}function v(t){var e=n.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.hide())}function w(t){if(t=t||e,a&&t){var i=a.parent();if(t.twoLevelHeader){if(!t.compactHeader){s=Common.Utils.getPosition(i).left,r=i.next().outerWidth();var o=a.outerWidth(),n=a[0].style.width;(n=n?parseFloat(n):o)-o>.1?(i.css("padding-left",s<r?Math.max(2,i.outerWidth()-2-n):2),i.css("padding-right",s<r?2:Math.max(2,i.outerWidth()-2-n))):(i.css("padding-left",s<r?Math.max(2,Math.min(r-s+2,i.outerWidth()-2-n)):2),i.css("padding-right",s<r?2:Math.max(2,Math.min(s-r+2,i.outerWidth()-2-n))))}}else{var s=Common.Utils.getPosition(i).left,r=i.next().outerWidth();i.css("padding-left",s<r?Math.max(2,r-s):2),i.css("padding-right",s<r?2:Math.max(2,s-r))}if((!t.customization||!t.customization.toolbarHideFileName)&&(!t.twoLevelHeader||t.compactHeader)){var l=parseFloat(i.css("padding-left")||0)+parseFloat(i.css("padding-right")||0)+parseInt(a.css("min-width")||50);t.isCrypted&&(l+=20),i.css("flex-basis",Math.ceil(l)+"px"),i.closest(".extra.right").css("flex-basis",Math.ceil(l)+i.next().outerWidth()+"px"),Common.NotificationCenter.trigger("tab:resize")}}}function A(t){var i=this;if(t=t||e,i.btnPDFMode&&t){var o=t.isPDFEdit?"edit":t.isPDFAnnotate?"comment":"view",n=t.isPDFEdit,s=!n&&t.isPDFAnnotate;if(i.btnPDFMode.setIconCls("toolbar__icon icon--inverse "+(n?"btn-edit":s?"btn-menu-comments":"btn-sheet-view")),i.btnPDFMode.setCaption(n?i.textEdit:s?i.textComment:i.textView),i.btnPDFMode.updateHint(n?i.tipEdit:s?i.tipComment:i.tipView),i.btnPDFMode.options.value=o,i.btnPDFMode.menu&&"object"===_typeof(i.btnPDFMode.menu)){var a=_.find(i.btnPDFMode.menu.items,(function(t){return t.value==o}));a?a.setChecked(!0):this.btnPDFMode.menu.clearAll()}}}function y(t,i){if(this.btnDocMode&&e)if(void 0===i){var o=void 0!==t;if(void 0===t)if(e.isReviewOnly)t="review";else{var n=Common.Utils.InternalSettings.get(this.appPrefix+"track-changes");t=0===n||2===n?"review":"edit"}var s="edit"===t,a="review"===t,r="view-form"===t;if(this.btnDocMode.setIconCls("toolbar__icon icon--inverse "+(s?"btn-edit":a?"btn-ic-review":"btn-sheet-view")),this.btnDocMode.setCaption(s?this.textEdit:a?this.textReview:r?this.textViewForm:this.textView),this.btnDocMode.updateHint(s?this.tipDocEdit:a?this.tipReview:r?this.tipDocViewForm:this.tipDocView),this.btnDocMode.options.value=t,o&&!this.btnDocMode.isVisible()&&this.btnDocMode.setVisible(!0),this.btnDocMode.menu&&"object"===_typeof(this.btnDocMode.menu)){var l=_.find(this.btnDocMode.menu.items,(function(e){return e.value==t}));l?l.setChecked(!0):this.btnDocMode.menu.clearAll()}}else this.btnDocMode.menu&&this.btnDocMode.menu.items&&"edit"===this.btnDocMode.menu.items[0].value&&this.btnDocMode.menu.items[0].setDisabled(i)}function S(){e&&e.twoLevelHeader&&!e.compactHeader&&w()}function x(t){a&&(t.isCrypted&&(a.before('<div class="inner-box-icon crypted hidden"><svg class="icon"><use xlink:href="#svg-icon-crypted"></use></svg></div>'),this.imgCrypted=a.parent().find(".crypted"),this._showImgCrypted=!0),w(t))}function k(t,e){void 0!==e.save&&(this.btnSave[e.save?"show":"hide"](),Common.localStorage.setBool(this.appPrefix+"quick-access-save",e.save)),void 0!==e.print&&(this.btnPrint[e.print?"show":"hide"](),Common.localStorage.setBool(this.appPrefix+"quick-access-print",e.print)),void 0!==e.quickPrint&&(this.btnPrintQuick[e.quickPrint?"show":"hide"](),Common.localStorage.setBool(this.appPrefix+"quick-access-quick-print",e.quickPrint)),void 0!==e.undo&&(this.btnUndo[e.undo?"show":"hide"](),Common.localStorage.setBool(this.appPrefix+"quick-access-undo",e.undo)),void 0!==e.redo&&(this.btnRedo[e.redo?"show":"hide"](),Common.localStorage.setBool(this.appPrefix+"quick-access-redo",e.redo)),void 0!==e.startOver&&(this.btnStartOver[e.startOver?"show":"hide"](),Common.localStorage.setBool(this.appPrefix+"quick-access-start-over",e.startOver)),Common.NotificationCenter.trigger("edit:complete"),t&&"header"==t&&Common.NotificationCenter.trigger("quickaccess:changed",e),w()}function T(s){e=s;var a=this;if(a.btnGoBack.on("click",(function(t){Common.NotificationCenter.trigger("goback")})),a.btnClose&&(a.btnClose.on("click",(function(t){Common.NotificationCenter.trigger("close")})),a.btnClose.updateHint(e.customization.close.text||a.textClose)),a.btnFavorite.on("click",(function(t){Common.NotificationCenter.trigger("markfavorite",!a.options.favorite)})),a.btnShare&&(a.btnShare.on("click",(function(t){Common.NotificationCenter.trigger("collaboration:sharing")})),a.btnShare.updateHint(a.tipAccessRights),a.btnShare.setVisible(!r&&e&&(e.sharingSettingsUrl&&e.sharingSettingsUrl.length||e.canRequestSharingSettings)),w()),a.btnStartFill&&a.btnStartFill.on("click",(function(t){Common.NotificationCenter.trigger("forms:request-fill")})),a.btnFillStatus&&(a.btnFillStatus.updateHint(a.tipFillStatus),a.btnFillStatus&&a.btnFillStatus.on("click",(function(t){Common.UI.TooltipManager.closeTip("showFillStatus"),Common.Gateway.requestFillingStatus(e.user.roles&&e.user.roles.length>0?e.user.roles[0]:void 0)}))),a.logo&&a.logo.children(0).on("click",(function(t){var e=a.branding&&a.branding.logo&&void 0!==a.branding.logo.url?a.branding.logo.url:"https://www.onlyoffice.com";if(e){var i=window.open(e);i&&i.focus()}})),o){f(t),o.on("shown.bs.dropdown",(function(){i.scroller&&i.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})})),o.find(".cousers-menu").on("click",(function(t){return!1}));var l=t.getVisibleEditingCount();n.tooltip({title:a.tipUsers,placement:"bottom",html:!0}),n.on("click",v.bind(a)),o[e&&(l>1&&(e.isEdit||e.isRestrictedEdit)||l>0&&e.canLiveView)?"show":"hide"](),w()}if(e.user.guest&&e.canRenameAnonymous&&a.btnUserName&&a.btnUserName.on("click",(function(t){Common.NotificationCenter.trigger("user:rename")})),a.btnPrint&&(a.btnPrint.updateHint(a.tipPrint+Common.Utils.String.platformKey("Ctrl+P")),a.btnPrint.on("click",(function(t){a.fireEvent("print",a)}))),a.btnPrintQuick&&(a.btnPrintQuick.updateHint(a.tipPrintQuick),a.btnPrintQuick.on("click",(function(t){a.fireEvent("print-quick",a)}))),a.btnSave&&(a.btnSave.updateHint(e.canSaveToFile||e.isDesktopApp&&e.isOffline?a.tipSave+(c?"":Common.Utils.String.platformKey("Ctrl+S")):a.tipDownload),a.btnSave.on("click",(function(t){a.fireEvent("save",a)}))),a.btnUndo&&(a.btnUndo.updateHint(a.tipUndo+Common.Utils.String.platformKey("Ctrl+Z")),a.btnUndo.on("click",(function(t){a.fireEvent("undo",a)}))),a.btnRedo&&(a.btnRedo.updateHint(a.tipRedo+Common.Utils.String.platformKey("Ctrl+Y")),a.btnRedo.on("click",(function(t){a.fireEvent("redo",a)}))),a.btnStartOver&&(a.btnStartOver.updateHint(a.tipStartOver+Common.Utils.String.platformKey(Common.Utils.isMac?"Ctrl+Shift+enter":"Ctrl+F5")),a.btnStartOver.on("click",(function(t){a.fireEvent("startover",a)}))),a.btnQuickAccess){a.btnQuickAccess.updateHint(a.tipCustomizeQuickAccessToolbar);var h=[];a.btnSave&&Common.UI.LayoutManager.isElementVisible("header-save")&&h.push({caption:e.canSaveToFile||e.isDesktopApp&&e.isOffline?a.tipSave:a.textDownload,value:"save",checkable:!0}),a.btnPrint&&h.push({caption:a.textPrint,value:"print",checkable:!0}),a.btnPrintQuick&&h.push({caption:a.tipPrintQuick,value:"quick-print",checkable:!0}),a.btnUndo&&h.push({caption:a.tipUndo,value:"undo",checkable:!0}),a.btnRedo&&h.push({caption:a.tipRedo,value:"redo",checkable:!0}),a.btnStartOver&&h.push({caption:a.textStartOver,value:"startover",checkable:!0}),a.btnQuickAccess.setMenu(new Common.UI.Menu({cls:"ppm-toolbar",style:"min-width: 110px;",menuAlign:"tl-bl",items:h})),a.btnQuickAccess.menu.on("show:before",(function(t){t.items.forEach((function(t){"save"===t.value?t.setChecked(Common.localStorage.getBool(a.appPrefix+"quick-access-save",!0),!0):"print"===t.value?t.setChecked(Common.localStorage.getBool(a.appPrefix+"quick-access-print",!0),!0):"quick-print"===t.value?t.setChecked(Common.localStorage.getBool(a.appPrefix+"quick-access-quick-print",!0),!0):"undo"===t.value?t.setChecked(Common.localStorage.getBool(a.appPrefix+"quick-access-undo",!0),!0):"redo"===t.value&&t.setChecked(Common.localStorage.getBool(a.appPrefix+"quick-access-redo",!0),!0),"startover"===t.value&&t.setChecked(Common.localStorage.getBool(a.appPrefix+"quick-access-start-over",!0),!0)}))})),a.btnQuickAccess.menu.on("item:click",(function(t,e){var i={};switch(e.value){case"save":i.save=e.checked;break;case"print":i.print=e.checked;break;case"quick-print":i.quickPrint=e.checked;break;case"undo":i.undo=e.checked;break;case"redo":i.redo=e.checked;break;case"startover":i.startOver=e.checked}k.call(a,"header",i)})),Common.NotificationCenter.on("quickaccess:changed",k.bind(a,"settings"))}e.twoLevelHeader||a.btnDownload&&(a.btnDownload.updateHint(a.tipDownload),a.btnDownload.on("click",(function(t){a.fireEvent("downloadas",["original"])}))),a.btnEdit&&(a.btnEdit.updateHint(a.tipGoEdit),a.btnEdit.on("click",(function(t){a.fireEvent("go:editor",a)}))),a.btnSearch&&a.btnSearch.updateHint(a.tipSearch+Common.Utils.String.platformKey("Ctrl+F"));var d=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem" class="menu-item"><div><% if (!_.isEmpty(iconCls)) { %><span class="menu-item-icon <%= iconCls %>"></span><% } %><b><%= caption %></b></div><% if (options.description !== null) { %><label class="margin-left-10 description"><%= options.description %></label><% } %></a>');if(a.btnPDFMode){h=[];var m=a.btnPDFMode.options.value;e.canPDFEdit&&(h.push({caption:a.textComment,iconCls:"menu__icon btn-menu-comments",template:d,description:a.textAnnotateDesc,value:"comment",checkable:!0,toggleGroup:"docmode"}),h.push({caption:a.textEdit,iconCls:"menu__icon btn-edit",template:d,description:a.textEditDescNoCoedit,value:"edit",checkable:!0,toggleGroup:"docmode"})),a.btnPDFMode.setMenu(new Common.UI.Menu({cls:"ppm-toolbar select-checked-items",style:"width: 220px;",menuAlign:"tr-br",items:h})),a.btnPDFMode.menu.on("item:click",(function(t,e){Common.NotificationCenter.trigger("pdf:mode-apply",e.value)})),(p=_.find(a.btnPDFMode.menu.items,(function(t){return t.value==m})))&&p.setChecked(!0)}else if(a.btnDocMode){var p;h=[],m=a.btnDocMode.options.value;!e.isReviewOnly&&h.push({caption:a.textEdit,iconCls:"menu__icon btn-edit",template:d,description:a.textDocEditDesc,value:"edit",checkable:!0,toggleGroup:"docmode"}),e.canReview&&h.push({caption:a.textReview,iconCls:"menu__icon btn-ic-review",template:d,description:a.textReviewDesc,value:"review",checkable:!0,toggleGroup:"docmode"}),e.isPDFForm&&e.isFormCreator?h.push({caption:a.textViewForm,iconCls:"menu__icon btn-sheet-view",template:d,description:a.textDocViewFormDesc,value:"view-form",checkable:!0,toggleGroup:"docmode"}):h.push({caption:a.textView,iconCls:"menu__icon btn-sheet-view",template:d,description:a.textDocViewDesc,value:"view",checkable:!0,toggleGroup:"docmode"}),a.btnDocMode.setMenu(new Common.UI.Menu({cls:"ppm-toolbar select-checked-items",style:"width: 220px;",menuAlign:"tr-br",items:h})),a.btnDocMode.menu.on("item:click",(function(t,e){Common.NotificationCenter.trigger("doc:mode-apply",e.value,!0)})),(p=_.find(a.btnDocMode.menu.items,(function(t){return t.value==m})))&&p.setChecked(!0)}e.twoLevelHeader&&!e.compactHeader&&Common.NotificationCenter.on("window:resize",S)}function I(t){var e=this;if(e.imgCrypted&&e.imgCrypted.toggleClass("hidden",!0),e.isSaveDocName=!1,!e.withoutExt){var i=e.cutDocName(a.val());e.withoutExt=!0,_.delay((function(){e.setDocTitle(i),a.select()}),100)}}function E(t){var e=this,i=a.val();i=i.trim(),_.isEmpty(i)||e.cutDocName(e.documentCaption)===i?t&&Common.NotificationCenter.trigger("edit:complete",e):(e.isSaveDocName=!0,/[\t*\+:\"<>?|\\\\/]/gim.test(i)?_.defer((function(){Common.UI.error({msg:(new Common.Views.RenameDialog).txtInvalidName+'*+:"<>?|/',callback:function(){_.delay((function(){a.focus()}),50)}})})):e.withoutExt&&(i=e.cutDocName(i),e.fireEvent("rename",[i]),i+=e.fileExtention,e.withoutExt=!1,e.setDocTitle(i),t&&Common.NotificationCenter.trigger("edit:complete",e)))}function P(t){var e=this;t.keyCode===Common.UI.Keys.RETURN?E.call(e,!0):t.keyCode===Common.UI.Keys.ESC?(e.setDocTitle(e.cutDocName(e.documentCaption)),Common.NotificationCenter.trigger("edit:complete",this)):_.delay((function(){e.setDocTitle()}),10)}return{options:{branding:{},documentCaption:"",canBack:!1,wopi:!1},el:"#header",events:{},initialize:function(e){var i=this;this.options=this.options?_.extend(this.options,e):e,this.documentCaption=this.options.documentCaption,this.branding=this.options.customization,this.isModified=!1;var o=Common.localStorage.getKeysFilter();this.appPrefix=o&&o.length?o.split(",")[0]:"",i.btnGoBack=new Common.UI.Button({id:"btn-go-back",cls:"btn-header",iconCls:"toolbar__icon icon--inverse btn-goback",dataHint:"0",dataHintDirection:"bottom",dataHintOffset:"big"}),(t=this.options.storeUsers).bind({add:b,change:b,reset:f}),i.btnSearch=new Common.UI.Button({cls:"btn-header no-caret",iconCls:"toolbar__icon icon--inverse btn-menu-search",enableToggle:!0,dataHint:"0",dataHintDirection:"bottom",dataHintOffset:"big"}),i.btnFavorite=new Common.UI.Button({id:"id-btn-favorite",cls:"btn-header",iconCls:"toolbar__icon icon--inverse btn-favorite",dataHint:"0",dataHintDirection:"bottom",dataHintOffset:"big"}),Common.NotificationCenter.on({"app:ready":function(t){Common.Utils.asyncCall(T,i,t)},"app:face":function(t){Common.Utils.asyncCall(x,i,t)},"tab:visible":function(){Common.Utils.asyncCall(w,i)},"collaboration:sharingdeny":function(t){Common.Utils.asyncCall(C,i,t)}}),Common.NotificationCenter.on("uitheme:changed",this.onThemeChanged.bind(this)),Common.NotificationCenter.on("mentions:setusers",this.avatarsUpdate.bind(this)),Common.NotificationCenter.on("tabstyle:changed",this.changeLogo.bind(this)),Common.NotificationCenter.on("tabbackground:changed",this.changeLogo.bind(this))},render:function(t,e){return $(t).html(this.getPanel(e)),this},getPanel:function(t,d){!e&&(e=d);var p=this;function u(t,e,i,o,n,s,a){return new Common.UI.Button({cls:"btn-header",iconCls:t,disabled:!0===i,lock:a,dataHint:"0",dataHintDirection:o||(d.isDesktopApp?"right":"left"),dataHintOffset:n||(d.isDesktopApp?"10, -18":"10, 10"),dataHintTitle:s}).render(e)}if(!("left"!=t||d&&d.isDesktopApp)){f=$('<section class="logo"><div id="header-logo"><i></i></div></section>'),this.logo=f.find("#header-logo");var g=this.getSuitableLogo(this.branding,d);return this.logo.toggleClass("logo-light",g.isLight),this.branding&&this.branding.logo&&this.logo&&(!1===this.branding.logo.visible?this.logo.addClass("hidden"):(this.branding.logo.image||this.branding.logo.imageDark||this.branding.logo.imageLight)&&(l=g.image,this.logo.html('<img src="'+l+'" style="max-width:100px; max-height:20px; margin: 0;"/>'),this.logo.css({"background-image":"none",width:"auto"}),(this.branding.logo.url||void 0===this.branding.logo.url)&&this.logo.addClass("link"))),f}if("right"==t){var f=$(_.template('<section><section id="box-doc-name"><input id="rib-doc-name" autofill="off" autocomplete="off"/></input></section><section id="box-right-btn-group" style="display: inherit;"><div class="hedset"><div class="btn-slot margin-right-2" id="slot-btn-header-form-submit"></div><div class="btn-slot margin-right-2" id="slot-btn-start-fill"></div><div class="btn-slot margin-right-2 margin-left-5" id="slot-btn-fill-status"></div></div><div class="hedset"><div class="btn-slot" id="slot-hbtn-edit"></div><div class="btn-slot" id="slot-hbtn-print"></div><div class="btn-slot" id="slot-hbtn-print-quick"></div><div class="btn-slot" id="slot-hbtn-download"></div></div><div class="hedset" data-layout-name="header-editMode"><div class="btn-slot" id="slot-btn-edit-mode"></div></div><div class="hedset" data-layout-name="header-users"><section id="tlb-box-users" class="box-cousers dropdown"><div class="btn-users dropdown-toggle" data-toggle="dropdown" data-hint="0" data-hint-direction="bottom" data-hint-offset="big"><div class="inner-box-icon"><svg class=""><use xlink:href="#svg-icon-users"></use></svg></div><label class="caption"></label></div><div class="cousers-menu dropdown-menu"><label id="tlb-users-menu-descr"><%= tipUsers %></label><div class="cousers-list"></div></div></section></div><div class="hedset"><div class="btn-slot" id="slot-btn-share"></div></div><div class="hedset"><div class="btn-slot" id="slot-btn-mode"></div><div class="btn-slot" id="slot-btn-back"></div><div class="btn-slot" id="slot-btn-favorite"></div><div class="btn-slot" id="slot-btn-search"></div></div><div class="hedset"><div class="btn-slot" data-layout-name="header-user"><button type="button" class="btn btn-header slot-btn-user-name hidden"><div class="color-user-name"></div></button><div class="btn-current-user hidden"><div class="color-user-name"></div></div></div><div class="btn-slot" id="slot-btn-close"></div></div></section></section>')({tipUsers:this.labelCoUsersDescr,textShare:this.textShare}));return a?f.find("#rib-doc-name").hide():(a=f.find("#rib-doc-name"),p.documentCaption&&setTimeout((function(){p.setDocTitle(p.documentCaption)}),50)),this.setCanRename(!!this.options.canRename),!0===this.options.canBack?p.btnGoBack.render(f.find("#slot-btn-back")):f.find("#slot-btn-back").hide(),void 0!==this.options.favorite&&null!==this.options.favorite?(p.btnFavorite.render(f.find("#slot-btn-favorite")),p.btnFavorite.changeIcon(p.options.favorite?{next:"btn-in-favorite",curr:"btn-favorite"}:{next:"btn-favorite",curr:"btn-in-favorite"}),p.btnFavorite.updateHint(p.options.favorite?p.textRemoveFavorite:p.textAddFavorite)):f.find("#slot-btn-favorite").hide(),d.twoLevelHeader||(!d.canDownload&&!d.canDownloadOrigin||d.isOffline||(this.btnDownload=u("toolbar__icon icon--inverse btn-download",f.findById("#slot-hbtn-download"),void 0,"bottom","big")),d.canPrint&&(this.btnPrint=u("toolbar__icon icon--inverse btn-print",f.findById("#slot-hbtn-print"),void 0,"bottom","big","P")),d.canQuickPrint&&(this.btnPrintQuick=u("toolbar__icon icon--inverse btn-quick-print",f.findById("#slot-hbtn-print-quick"),void 0,"bottom","big","Q"))),d.canRequestEditRights&&(!d.twoLevelHeader&&d.canEdit&&!c||d.isPDFForm&&d.canFillForms&&d.isRestrictedEdit||c&&(d.canPDFEdit&&!d.isPDFEdit&&!d.isPDFAnnotate||d.isPDFFill))&&(this.btnEdit=u("toolbar__icon icon--inverse btn-edit",f.findById("#slot-hbtn-edit"),void 0,"bottom","big")),p.btnSearch.render(f.find("#slot-btn-search")),d.twoLevelHeader&&!d.compactHeader||(d.user.guest&&d.canRenameAnonymous?(p.btnUserName=new Common.UI.Button({el:f.findById(".slot-btn-user-name"),cls:"btn-header",dataHint:"0",dataHintDirection:"bottom",dataHintOffset:"big",visible:!0}),p.btnUserName.cmpEl.removeClass("hidden")):(p.elUserName=f.find(".btn-current-user"),p.elUserName.removeClass("hidden")),s=f.find(".color-user-name"),p.setUserName(p.options.userName),d.canCloseEditor&&(p.btnClose=u("toolbar__icon icon--inverse btn-close",f.findById("#slot-btn-close"),!1,"bottom","big"))),!r&&d&&(d.sharingSettingsUrl&&d.sharingSettingsUrl.length||d.canRequestSharingSettings)?(p.btnShare=new Common.UI.Button({cls:"btn-header btn-header-share",iconCls:"toolbar__icon icon--inverse btn-users-share",caption:p.textShare,dataHint:"0",dataHintDirection:"bottom",dataHintOffset:"big"}),p.btnShare.render(f.find("#slot-btn-share"))):f.find("#slot-btn-share").hide(),c&&d.isEdit&&d.canSwitchMode?(p.btnPDFMode=new Common.UI.Button({cls:"btn-header btn-header-pdf-mode",iconCls:"toolbar__icon icon--inverse btn-menu-comments",caption:p.textComment,menu:!0,value:"comment",lock:[Common.enumLock.lostConnect,Common.enumLock.fileMenuOpened,Common.enumLock.changeModeLock],dataHint:"0",dataHintDirection:"bottom",dataHintOffset:"big"}),p.btnPDFMode.render(f.find("#slot-btn-edit-mode")),A.call(p,d),Common.NotificationCenter.on("pdf:mode-changed",_.bind(A,p))):h&&d.isEdit&&d.canSwitchMode?(p.btnDocMode=new Common.UI.Button({cls:"btn-header btn-header-pdf-mode ",iconCls:"toolbar__icon icon--inverse "+(d.isReviewOnly?"btn-ic-review":"btn-edit"),caption:d.isReviewOnly?p.textReview:p.textEdit,menu:!0,visible:d.isReviewOnly||!d.canReview,lock:[Common.enumLock.previewReviewMode,Common.enumLock.lostConnect,Common.enumLock.disableOnStart,Common.enumLock.docLockView,Common.enumLock.docLockComments,Common.enumLock.docLockForms,Common.enumLock.fileMenuOpened,Common.enumLock.changeModeLock],value:d.isReviewOnly?"review":"edit",dataHint:"0",dataHintDirection:"bottom",dataHintOffset:"big"}),p.btnDocMode.render(f.find("#slot-btn-edit-mode")),y.call(p),Common.NotificationCenter.on("doc:mode-changed",_.bind(y,p))):f.find("#slot-btn-edit-mode").hide(),d.canStartFilling?(p.btnStartFill=new Common.UI.Button({cls:"btn-text-default auto yellow",caption:d.customization&&d.customization.startFillingForm&&d.customization.startFillingForm.text?d.customization.startFillingForm.text:p.textStartFill,dataHint:"0",dataHintDirection:"bottom",dataHintOffset:"big"}),p.btnStartFill.render(f.find("#slot-btn-start-fill"))):f.find("#slot-btn-start-fill").hide(),d.isPDFForm&&d.canRequestFillingStatus&&(p.btnFillStatus=new Common.UI.Button({cls:"btn-header",iconCls:"toolbar__icon icon--inverse  btn-filling-status"}),p.btnFillStatus.render(f.find("#slot-btn-fill-status"))),i=f.find(".cousers-list"),o=f.find(".box-cousers"),n=o.find("> .btn-users"),o.hide(),f}if("title"==t){f=$(_.template('<section id="box-document-title"><div class="extra"></div><div class="hedset" role="menubar" aria-label="<%= scope.ariaQuickAccessToolbar %>"><div class="btn-slot" id="slot-btn-dt-home"></div><div class="btn-slot" id="slot-btn-dt-save" data-layout-name="header-save"></div><div class="btn-slot" id="slot-btn-dt-print"></div><div class="btn-slot" id="slot-btn-dt-print-quick"></div><div class="btn-slot" id="slot-btn-dt-undo"></div><div class="btn-slot" id="slot-btn-dt-redo"></div><div class="btn-slot" id="slot-btn-dt-start-over"></div><div class="btn-slot" id="slot-btn-dt-quick-access"></div></div><div class="lr-separator" id="id-box-doc-name"><input id="title-doc-name" autofill="off" autocomplete="off"/></input></div><div class="hedset"><div class="btn-slot" data-layout-name="header-user"><button type="button" class="btn btn-header slot-btn-user-name hidden"><div class="color-user-name"></div></button><div class="btn-current-user hidden"><div class="color-user-name"></div></div></div><div class="btn-slot" id="slot-btn-close"></div></div></section>')({scope:p}));if(a&&a.hide().off(),a=f.find("#title-doc-name"),setTimeout((function(){p.setDocTitle(p.documentCaption)}),50),p.options.wopi&&a.attr("maxlength",p.options.wopi.FileNameMaxLength),d.user.guest&&d.canRenameAnonymous?(p.btnUserName=new Common.UI.Button({el:f.findById(".slot-btn-user-name"),cls:"btn-header",dataHint:"0",dataHintDirection:"bottom",dataHintOffset:"big",visible:!0}),p.btnUserName.cmpEl.removeClass("hidden")):(p.elUserName=f.find(".btn-current-user"),p.elUserName.removeClass("hidden")),s=f.find(".color-user-name"),p.setUserName(p.options.userName),d.canCloseEditor&&(p.btnClose=u("toolbar__icon icon--inverse btn-close",f.findById("#slot-btn-close"),!1,"left","10, 10")),d.canPrint&&d.twoLevelHeader&&(p.btnPrint=u("toolbar__icon icon--inverse btn-print",f.findById("#slot-btn-dt-print"),!0,void 0,void 0,"P"),!Common.localStorage.getBool(p.appPrefix+"quick-access-print",!0)&&p.btnPrint.hide()),d.canQuickPrint&&d.twoLevelHeader&&(p.btnPrintQuick=u("toolbar__icon icon--inverse btn-quick-print",f.findById("#slot-btn-dt-print-quick"),!0,void 0,void 0,"Q"),!Common.localStorage.getBool(p.appPrefix+"quick-access-quick-print",!0)&&p.btnPrintQuick.hide()),d.showSaveButton){var b=d.canSaveToFile||d.isDesktopApp&&d.isOffline?"btn-save":"btn-download";p.btnSave=u("toolbar__icon icon--inverse "+b,f.findById("#slot-btn-dt-save"),!0,void 0,void 0,"S"),!Common.localStorage.getBool(p.appPrefix+"quick-access-save",!0)&&p.btnSave.hide()}return p.btnUndo=u("toolbar__icon icon--inverse btn-undo icon-rtl",f.findById("#slot-btn-dt-undo"),!0,void 0,void 0,"Z",[Common.enumLock.undoLock,Common.enumLock.fileMenuOpened,Common.enumLock.lostConnect]),!Common.localStorage.getBool(p.appPrefix+"quick-access-undo",!0)&&p.btnUndo.hide(),p.btnRedo=u("toolbar__icon icon--inverse btn-redo icon-rtl",f.findById("#slot-btn-dt-redo"),!0,void 0,void 0,"Y",[Common.enumLock.redoLock,Common.enumLock.fileMenuOpened,Common.enumLock.lostConnect]),!Common.localStorage.getBool(p.appPrefix+"quick-access-redo",!0)&&p.btnRedo.hide(),m&&(p.btnStartOver=u("toolbar__icon icon--inverse btn-preview",f.findById("#slot-btn-dt-start-over"),!0,void 0,void 0,"O"),!Common.localStorage.getBool(p.appPrefix+"quick-access-start-over",!0)&&p.btnStartOver.hide()),p.btnQuickAccess=new Common.UI.Button({cls:"btn-header no-caret",iconCls:"toolbar__icon icon--inverse btn-more",menu:!0,dataHint:"0",dataHintDirection:d.isDesktopApp?"right":"left",dataHintOffset:d.isDesktopApp?"10, -18":"10, 10"}),p.btnQuickAccess.render(f.find("#slot-btn-dt-quick-access")),f}},setVisible:function(t){},setBranding:function(t,e){this.branding=t;var i=$("#header-logo"),o=this.getSuitableLogo(t,e);i.toggleClass("logo-light",o.isLight),t&&t.logo&&i&&(!1===t.logo.visible?i.addClass("hidden"):(t.logo.image||t.logo.imageDark||t.logo.imageLight)&&(l=o.image,i.html('<img src="'+l+'" style="max-width:100px; max-height:20px; margin: 0;"/>'),i.css({"background-image":"none",width:"auto"}),(t.logo.url||void 0===t.logo.url)&&i.addClass("link")))},getSuitableLogo:function(t,e,i,o){var n=(t=t||{}).logo?t.logo.image||t.logo.imageDark||t.logo.imageLight:null,s=!0;if(i=i||Common.Utils.InternalSettings.get("settings-tab-style")||"fill",o=o||Common.Utils.InternalSettings.get("settings-tab-background")||"header",!Common.Utils.isIE){var a=Common.UI.Themes.currentThemeColor(h&&e.isPDFForm||c?"--toolbar-header-pdf":h?"--toolbar-header-document":d?"--toolbar-header-spreadsheet":p?"--toolbar-header-visio":"--toolbar-header-presentation"),r=Common.UI.Themes.currentThemeColor("--background-toolbar"),l=e.twoLevelHeader&&!e.compactHeader||"toolbar"!==o?a:r;s=new Common.Utils.RGBColor(l).isDark(),n=t.logo?s?t.logo.imageDark||t.logo.image||t.logo.imageLight:t.logo.imageLight||t.logo.image||t.logo.imageDark:null}return{image:n,isLight:!s}},changeLogo:function(){if(e){var t=this.branding,i=this.getSuitableLogo(t,e,Common.Utils.InternalSettings.get("settings-tab-style"),Common.Utils.InternalSettings.get("settings-tab-background"));if($("#header-logo").toggleClass("logo-light",i.isLight),t&&t.logo&&!1!==t.logo.visible&&e&&(t.logo.image||t.logo.imageDark||t.logo.imageLight)){var o=i.image;o!==l&&(l=o,$("#header-logo img").attr("src",o))}}},setDocumentCaption:function(t){!t&&(t=""),this.documentCaption=t;var e=this.documentCaption.lastIndexOf(".");return this.fileExtention=e>0?this.documentCaption.substring(e):"",this.isModified&&(t+="*"),this.readOnly&&(t+=" ("+this.textReadOnly+")"),a&&this.setDocTitle(t),t},getDocumentCaption:function(){return this.documentCaption},setDocumentChanged:function(t){this.isModified=t;var e=this.documentCaption;t&&(e+="*"),this.setDocTitle(e)},setCanBack:function(t,e){return this.options.canBack=t,this.btnGoBack[t?"show":"hide"](),t&&this.btnGoBack.updateHint(e&&"string"==typeof e?e:this.textBack),w(),this},getCanBack:function(){return this.options.canBack},setFavorite:function(t){return this.options.favorite=t,this.btnFavorite[null!=t?"show":"hide"](),this.btnFavorite.changeIcon(t?{next:"btn-in-favorite",curr:"btn-favorite"}:{next:"btn-favorite",curr:"btn-in-favorite"}),this.btnFavorite.updateHint(t?this.textRemoveFavorite:this.textAddFavorite),w(),this},getFavorite:function(){return this.options.favorite},setWopi:function(t){this.options.wopi=t},setCanRename:function(t){var e=this;if(e.options.canRename=t,a){var i=a;if(t)i.removeAttr("disabled").tooltip({title:e.txtRename,placement:"cursor"}),i.on({keydown:P.bind(this),focus:I.bind(this),blur:function(t){!e.isSaveDocName&&E.call(e),e.imgCrypted&&e.imgCrypted.toggleClass("hidden",!1),Common.Utils.isGecko&&(i[0].selectionStart=i[0].selectionEnd=0),e.isSaveDocName||(e.withoutExt=!1,e.setDocTitle(e.documentCaption))},paste:function(t){setTimeout((function(){var t=e.cutDocName(a.val());e.setDocTitle(t)}))}});else{i.off(),i.attr("disabled",!0);var o=i.data("bs.tooltip");o&&(o.options.title="",o.setContent())}i.attr("data-can-copy",t)}},cutDocName:function(t){if(t.length<=this.fileExtention.length)return t;var e=t.length-this.fileExtention.length;return t.substring(e)==this.fileExtention?t.substring(0,e):t},setDocTitle:function(t){if(a){var e=this.getTextWidth(t||a.val());e>=0&&a.width(e),t&&e>=0&&a.val(t),this._showImgCrypted&&e>=0&&(this.imgCrypted.toggleClass("hidden",!1),this._showImgCrypted=!1),e>=0&&S()}},getTextWidth:function(t){if(!this._testCanvas){var e=(a.css("font-size")+" "+a.css("font-family")).trim();if(e){var i=document.createElement("canvas");this._testCanvas=i.getContext("2d"),this._testCanvas.font=e}}if(this._testCanvas){var o=this._testCanvas.measureText(t);return void 0!==o.actualBoundingBoxLeft?Math.ceil(Math.abs(o.actualBoundingBoxLeft)+Math.abs(o.actualBoundingBoxRight))+1:o.width?Math.ceil(o.width)+2:0}return-1},setUserName:function(t){return this.options.userName=t,this.btnUserName?this.btnUserName.updateHint(t):this.elUserName&&this.elUserName.tooltip({title:Common.Utils.String.htmlEncode(t),placement:"cursor",html:!0}),s&&this.updateAvatarEl(),this},setUserAvatar:function(t){this.options.userAvatar=t,s&&this.updateAvatarEl()},setUserId:function(t){this.options.currentUserId=t},updateAvatarEl:function(){this.options.userAvatar?(s.css({"background-image":"url("+this.options.userAvatar+")","background-color":"transparent"}),s.text("")):s.text(Common.Utils.getUserInitials(this.options.userName))},avatarsUpdate:function(t,e){"info"===t&&this.setUserAvatar(Common.UI.ExternalUsers.getImage(this.options.currentUserId))},getButton:function(t){return"save"==t?this.btnSave:"users"==t?o:"share"==t?this.btnShare:"mode"==t?this.btnDocMode:void 0},lockHeaderBtns:function(t,e,i){var o=this;if("users"==t)e?n.addClass("disabled").attr("disabled","disabled"):n.removeClass("disabled").removeAttr("disabled"),o.btnShare&&o.btnShare.setDisabled(e);else if("rename-user"==t)o.btnUserName&&o.btnUserName.setDisabled(e);else if("search"==t)o.btnSearch&&o.btnSearch.setDisabled(e);else{var s=function(t){t&&Common.Utils.lockControls(i,e,{array:[t]})};switch(t){case"undo":s(o.btnUndo);break;case"redo":s(o.btnRedo);break;case"mode":s(o.btnDocMode?o.btnDocMode:o.btnPDFMode)}}},setDocumentReadOnly:function(t){this.readOnly=t,this.setDocumentCaption(this.documentCaption)},onStartFilling:function(){this.btnStartFill&&this.btnStartFill.setVisible(!1),w()},onThemeChanged:function(){this.changeLogo(),this._testCanvas&&(this._testCanvas=void 0),this.setDocTitle()},textBack:"Go to Documents",txtRename:"Rename",txtAccessRights:"Change access rights",tipAccessRights:"Manage document access rights",labelCoUsersDescr:"Document is currently being edited by several users.",tipViewUsers:"View users and manage document access rights",tipUsers:"View users",tipDownload:"Download file",tipPrint:"Print file",tipGoEdit:"Edit current file",tipSave:"Save",tipUndo:"Undo",tipRedo:"Redo",textCompactView:"Hide Toolbar",textHideStatusBar:"Combine sheet and status bars",textHideLines:"Hide Rulers",textZoom:"Zoom",textAdvSettings:"Advanced Settings",tipViewSettings:"View Settings",textRemoveFavorite:"Remove from Favorites",textAddFavorite:"Mark as favorite",textHideNotes:"Hide Notes",tipSearch:"Search",textShare:"Share",tipPrintQuick:"Quick print",textReadOnly:"Read only",textView:"Viewing",textComment:"Commenting",textEdit:"Editing",textViewDesc:"All changes will be saved locally",textCommentDesc:"All changes will be saved to the file. Real time collaboration",textEditDesc:"All changes will be saved to the file. Real time collaboration",textViewDescNoCoedit:"View or annotate",textEditDescNoCoedit:"Add or edit text, shapes, images etc.",tipView:"Viewing",tipComment:"Commenting",tipEdit:"Editing",textDocViewDesc:"View the file, but make no changes",textDocEditDesc:"Make any changes",tipDocView:"Viewing",tipDocEdit:"Editing",textReview:"Reviewing",textReviewDesc:"Suggest changes",tipReview:"Reviewing",textClose:"Close file",textStartFill:"Start filling",tipCustomizeQuickAccessToolbar:"Customize Quick Access Toolbar",textPrint:"Print",textViewForm:"Viewing form",tipDocViewForm:"Viewing form",textDocViewFormDesc:"See how the form will look like when filling out",helpDocMode:"Easily change the way you work on a document: edit, review and track changes, or view only. This works individually for each user. So, you won’t affect or disturb other co-authors. ",helpDocModeHeader:"Switch between modes",helpQuickAccess:"Hide or show the functional buttons of your choice.",helpQuickAccessHeader:"Customize Quick Access",ariaQuickAccessToolbar:"Quick access toolbar",textAnnotateDesc:"Fill forms or annotate",textDownload:"Download",tipFillStatus:"Filling status"}}(),Common.Views.Header||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/BaseView",["backbone"],(function(t){"use strict";Common.UI=_.extend(Common.UI||{},{Keys:{BACKSPACE:8,TAB:9,RETURN:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,HOME:36,END:35,SPACE:32,PAGEUP:33,PAGEDOWN:34,INSERT:45,ZERO:48,EQUALITY_FF:61,NUM_ZERO:96,NUM_PLUS:107,NUM_MINUS:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,MINUS_FF:173,EQUALITY:187,MINUS:189},BaseView:t.View.extend({isSuspendEvents:!1,initialize:function(t){this.options=this.options?_({}).extend(this.options,t):t},setVisible:function(t){return this[t?"show":"hide"]()},isVisible:function(){return $(this.el).is(":visible")},suspendEvents:function(){this.isSuspendEvents=!0},resumeEvents:function(){this.isSuspendEvents=!1}}),getId:function(t){return _.uniqueId(t||"asc-gen")}})})),void 0===Common)var Common={};if(define("common/main/lib/component/CheckBox",["common/main/lib/component/BaseView","underscore"],(function(t,e){"use strict";Common.UI.CheckBoxTemplate='<label class="checkbox-indeterminate"><input id="<%= id %>" type="checkbox" class="checkbox__native"><label for="<%= id %>" class="checkbox__shape canfocused"><svg width="14" height="14" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" x="0" y="0"><path class="chb-check-mark" d="M10.767,4.201c0.3,0.29 0.31,0.76 0.03,1.07l-4.25,4.5c-0.14,0.14 -0.34,0.23 -0.54,0.23c-0.2,-0 -0.4,-0.08 -0.54,-0.22l-2.25,-2.25c-0.29,-0.29 -0.29,-0.77 0,-1.06c0.29,-0.29 0.77,-0.29 1.06,-0l1.7,1.7l3.72,-3.93c0.29,-0.31 0.76,-0.32 1.07,-0.04Z"/><rect class="chb-indeterminate" height="2" rx="0.5" transform="matrix(1 0 0 1 0 0)" width="8" x="3" y="6"/></svg></label></label>',Common.UI.CheckBox=Common.UI.BaseView.extend({options:{labelText:""},disabled:!1,rendered:!1,indeterminate:!1,checked:!1,value:"unchecked",template:e.template(['<label class="checkbox-indeterminate">','<input id="<%= id %>" type="checkbox" class="checkbox__native">','<label for="<%= id %>" class="checkbox__shape canfocused" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" role="checkbox" aria-checked="false" aria-labelledby="<%= id %>-description">','<svg width="14" height="14" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" x="0" y="0">','<path class="chb-check-mark" d="M10.767,4.201c0.3,0.29 0.31,0.76 0.03,1.07l-4.25,4.5c-0.14,0.14 -0.34,0.23 -0.54,0.23c-0.2,-0 -0.4,-0.08 -0.54,-0.22l-2.25,-2.25c-0.29,-0.29 -0.29,-0.77 0,-1.06c0.29,-0.29 0.77,-0.29 1.06,-0l1.7,1.7l3.72,-3.93c0.29,-0.31 0.76,-0.32 1.07,-0.04Z"/>','<rect class="chb-indeterminate" height="2" rx="0.5" transform="matrix(1 0 0 1 0 0)" width="8" x="3" y="6"/>',"</svg>","</label>",'<span id="<%= id %>-description"></span>',"</label>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.options.el&&this.render()},render:function(t){var e=this;if(!e.rendered){var i=this.template({id:Common.UI.getId("chb-"),dataHint:e.options.dataHint,dataHintDirection:e.options.dataHintDirection,dataHintOffset:e.options.dataHintOffset});t?(this.setElement(t,!1),t.html(i)):e.$el.html(i),this.$chk=e.$el.find("input[type=checkbox]"),this.$label=e.$el.find("label.checkbox-indeterminate"),this.$span=e.$label.find("span"),this.$chk.on("click",this.onItemCheck.bind(this)),this.$label.on("keydown",this.onKeyDown.bind(this)),this.rendered=!0}return this.options.disabled&&this.setDisabled(this.options.disabled),void 0!==this.options.value&&this.setValue(this.options.value,!0),this.setCaption(this.options.labelText),this},setDisabled:function(t){this.rendered&&((t=!0===t)!==this.disabled&&(this.$label.toggleClass("disabled",t),t?this.$chk.attr({disabled:t}):this.$chk.removeAttr("disabled"),void 0!==this.tabindex&&(t&&(this.tabindex=this.$label.attr("tabindex")),this.$label.attr("tabindex",t?"-1":this.tabindex))),this.disabled=t)},isDisabled:function(){return this.disabled},onItemCheck:function(t){this.disabled||(this.indeterminate?(this.indeterminate=!1,this.setValue(!1)):this.setValue(!this.checked))},setRawValue:function(t){this.checked=!0===t||"true"===t||"1"===t||1===t||"checked"===t,this.indeterminate="indeterminate"===t,this.value=this.indeterminate?"indeterminate":this.checked?"checked":"unchecked",this.$chk.prop({indeterminate:this.indeterminate,checked:this.checked}),$(this.$label.find("label")).attr("aria-checked",this.indeterminate?"mixed":this.checked)},setValue:function(t,e){this.rendered?t!=this.value&&(this.lastValue=this.value,this.setRawValue(t),!0!==e&&this.trigger("change",this,this.value,this.lastValue)):this.options.value=t},getValue:function(){return this.value},isChecked:function(){return this.checked},setCaption:function(t){this.$span.text(t),this.$span.css("visibility",t?"visible":"hidden")},onKeyDown:function(t){t.isDefaultPrevented()||t.keyCode===Common.UI.Keys.SPACE&&this.onItemCheck(t)},focus:function(){this.$label&&this.$label.focus()},setTabIndex:function(t){this.rendered&&(this.tabindex=t.toString(),!this.disabled&&this.$label.attr("tabindex",this.tabindex))}})})),void 0===Common)var Common={};if(void 0===Common.UI&&(Common.UI={}),Common.UI.FocusManager=new function(){var t=[],e=0,i=function(t){var e=[];return t.forEach||(t=[t]),t.forEach((function(t){if(t){var i={};t.cmp&&"string"==typeof t.selector?i=t:(i.cmp=t,Common.UI.ListView&&t instanceof Common.UI.ListView?i.selector=".listview":t instanceof Common.UI.CheckBox?i.selector=".checkbox-indeterminate":Common.UI.RadioBox&&t instanceof Common.UI.RadioBox?i.selector=".radiobox":Common.UI.TreeView&&t instanceof Common.UI.TreeView?i.selector=".treeview":t instanceof Common.UI.Button?i.selector=t.split?".btn-group":"button":i.selector=".form-control"),i.el=(i.cmp.$el||$(i.cmp.el||i.cmp)).find(i.selector).addBack().filter(i.selector),i.el&&i.el.attr&&(i.cmp.setTabIndex?i.cmp.setTabIndex(1):i.el.attr("tabindex",1..toString())),e.push(i)}})),e},o=function(t){if(t&&!t.traps&&t.fields&&!(t.fields.length<1)){var e=$('<span aria-hidden="true" tabindex="1"></span>');e.on("focus",(function(){if(!t.hidden)for(var e=t.fields,i=e.length-1;i>=0;i--){var o=e[i];if((o.cmp.isVisible?o.cmp.isVisible():o.cmp.is(":visible"))&&(!o.cmp.isDisabled||!o.cmp.isDisabled())){var n=o.selector?(o.cmp.$el||$(o.cmp.el||o.cmp)).find(o.selector).addBack().filter(o.selector):o.el;n&&setTimeout((function(){n.focus()}),10);break}}})),t.parent.$window.prepend(e);var i=$('<span aria-hidden="true" tabindex="2"></span>');i.on("focus",(function(){if(!t.hidden)for(var e=t.fields,i=0;i<e.length;i++){var o=e[i];if((o.cmp.isVisible?o.cmp.isVisible():o.cmp.is(":visible"))&&(!o.cmp.isDisabled||!o.cmp.isDisabled())){var n=o.selector?(o.cmp.$el||$(o.cmp.el||o.cmp)).find(o.selector).addBack().filter(o.selector):o.el;n&&setTimeout((function(){n.focus()}),10);break}}})),t.parent.$window.append(i),t.traps=[e,i]}},n=function(e,i){var o=e?1:-1;for(var n in t)if(t.hasOwnProperty(n)){var s=t[n];s&&s.index<i&&s.traps&&s.traps[1].attr("tabindex",(parseInt(s.traps[1].attr("tabindex"))+o).toString()),!e&&s&&s.index>i&&s.index--}},s=function(n,s,a){if(n&&n.cid){if(t[n.cid]){var r=t[n.cid].fields||[];a<0&&(a+=r.length),t[n.cid].fields=void 0===a?r.concat(i(s)):r.slice(0,a).concat(i(s)).concat(r.slice(a))}else t[n.cid]={parent:n,fields:i(s),hidden:!1,index:e++};return o(t[n.cid]),a||0}};return{init:function(){Common.NotificationCenter.on({"modal:show":function(i){i&&i.cid&&(t[i.cid]?t[i.cid].hidden=!1:(t[i.cid]={parent:i,hidden:!1,index:e++},n(!0,t[i.cid].index)))},"window:show":function(e){e&&e.cid&&t[e.cid]&&!t[e.cid].fields&&(t[e.cid].fields=i(e.getFocusedComponents()),o(t[e.cid]));var n=e?e.getDefaultFocusableComponent():null;n&&setTimeout((function(){n.focus()}),100)},"modal:close":function(i,o){i&&i.cid&&t[i.cid]&&(n(!1,t[i.cid].index),delete t[i.cid],e--)},"modal:hide":function(e,i){e&&e.cid&&t[e.cid]&&(t[e.cid].hidden=!0)}})},add:function(t,e){s(t,e)},insert:s,remove:function(e,i,o){if(e&&e.cid&&t[e.cid]&&t[e.cid].fields&&void 0!==i){var n=t[e.cid].fields.splice(i,o);n&&n.forEach((function(t){t.el&&t.el.attr&&(t.cmp.setTabIndex?t.cmp.setTabIndex(-1):t.el.attr("tabindex","-1"))}))}}}},define("common/main/lib/controller/FocusManager",(function(){})),void 0===Common)var Common={};if(define("common/main/lib/component/Window",["common/main/lib/component/BaseView","common/main/lib/component/CheckBox","common/main/lib/controller/FocusManager"],(function(){"use strict";Common.UI.Window=Common.UI.BaseView.extend(_.extend(function(){var t={closable:!0,header:!0,modal:!0,width:"auto",height:"auto",title:"Title",alias:"Window",cls:"",toolclose:"close",help:!1,maxwidth:void 0,maxheight:void 0,minwidth:0,minheight:0,enableKeyEvents:!0,automove:!0,role:"dialog"};function e(){var t=$(".modals-mask");return 0==t.length&&(t=$("<div class='modals-mask'>").appendTo(document.body).hide()).attr("counter",0),t}function i(t){if(!this.isLocked()&&this.isVisible()&&this.initConfig.enableKeyEvents&&!1!==this.pauseKeyEvents){if(this.initConfig.keydowncallback&&this.initConfig.keydowncallback.call(this,t))return!1;switch(t.keyCode){case Common.UI.Keys.ESC:if($(".asc-loadmask").length<1)return t.preventDefault(),t.stopPropagation(),!1!==this.initConfig.closable&&(this.initConfig.toolcallback?this.initConfig.toolcallback.call(this):"hide"==this.initConfig.toolclose?this.hide():this.close()),!1;break;case Common.UI.Keys.RETURN:var e=$(t.target);if(e.hasClass("dlg-btn")&&!e.hasClass("primary"))return;if(this.$window.find(".btn.primary").length&&$(".asc-loadmask").length<1&&!1===(this.initConfig.onprimary||this.onPrimary).call(this))return t.preventDefault(),!1}}}function o(){if(null==window.innerHeight)var t=document.documentElement.offsetWidth,e=document.documentElement.offsetHeight;else t=Common.Utils.innerWidth(),e=Common.Utils.innerHeight();return{width:t,height:e-=Common.Utils.InternalSettings.get("window-inactive-area-top"),top:Common.Utils.InternalSettings.get("window-inactive-area-top")}}function n(){if("auto"==this.initConfig.height){var t=Math.ceil(parseFloat(this.$window.find("> .body").css("height")));this.initConfig.header&&(t+=parseInt(this.$window.find("> .header").css("height"))),this.$window.height(t)}}function s(){var t=o(),e=t.width,i=t.height;if("auto"==this.initConfig.height){var n=parseInt(this.$window.find(".body").css("height"));this.initConfig.header&&(n+=parseInt(this.$window.find(".header").css("height")))}else(n=this.initConfig.height)>i&&(n=i);var s="auto"==this.initConfig.width?parseInt(this.$window.find(".body").css("width")):this.initConfig.width,a=t.top+Math.floor((parseInt(i)-parseInt(n))/2),r=Math.floor((parseInt(e)-parseInt(s))/2);this.$window.css({left:r<0?0:r,top:a<0?0:a})}function a(){var t=o(),e=t.width,i=t.height;this.getLeft()+this.getWidth()>e&&this.$window.css("left",e-this.getWidth()),this.getTop()<t.top?this.$window.css("top",t.top):this.getTop()+this.getHeight()>i&&(i-this.getHeight()<0?this.$window.css("top",t.top):this.$window.css("top",t.top+i-this.getHeight()))}function r(t){return{"-webkit-transition":"0.3s opacity","-moz-transition":"0.3s opacity","-ms-transition":"0.3s opacity","-o-transition":"0.3s opacity",opacity:t}}function l(t){if(!$(t.target).hasClass("close")&&!$(t.target).hasClass("help")){Common.UI.Menu.Manager.hideAll();var e=t instanceof jQuery.Event?Common.Utils.zoom():1;this.dragging.enabled=!0,this.dragging.initx=t.pageX*e-this.getLeft(),this.dragging.inity=t.pageY*e-this.getTop();var i=o(),n=i.width,s=i.height;this.dragging.maxx=n-this.getWidth(),this.dragging.maxy=s-this.getHeight(),this.dragging.maxy<0&&(this.dragging.maxy=0),this.dragging.maxy+=i.top,$(document).on("mousemove",this.binding.drag),$(document).on("mouseup",this.binding.dragStop),this.fireEvent("drag",[this,"start"])}}function c(){$(document).off("mousemove",this.binding.drag),$(document).off("mouseup",this.binding.dragStop),this.dragging.enabled=!1,this.fireEvent("drag",[this,"end"])}function h(t){if(this.dragging.enabled){var e=t instanceof jQuery.Event?Common.Utils.zoom():1,i=t.pageX*e-this.dragging.initx,o=t.pageY*e-this.dragging.inity,n=Common.Utils.InternalSettings.get("window-inactive-area-top");i<0?i=0:i>this.dragging.maxx&&(i=this.dragging.maxx),o<n?o=n:o>this.dragging.maxy&&(o=this.dragging.maxy),this.$window.css({left:i,top:o})}}function d(t){"mouseup"==t.type&&this.dragging.enabled&&c.call(this)}function m(){var t=o(),e=t.width,i=t.height,n=this.getHeight(),s=this.getWidth(),a=this.getTop(),r=this.getLeft();a=a+n>i?i-n:a,r=r+s>e?e-s:r,this.$window.css({left:r<0?0:r,top:a<0?0:a})}function p(t){Common.UI.Menu.Manager.hideAll();var e=$(t.target),i=this.getLeft(),n=this.getTop();this.resizing.enabled=!0,this.resizing.initpage_x=t.pageX*Common.Utils.zoom(),this.resizing.initpage_y=t.pageY*Common.Utils.zoom(),this.resizing.initx=this.resizing.initpage_x-i,this.resizing.inity=this.resizing.initpage_y-n,this.resizing.initw=this.getWidth(),this.resizing.inith=this.getHeight(),this.resizing.type=[e.hasClass("left")?-1:e.hasClass("right")?1:0,e.hasClass("top")?-1:e.hasClass("bottom")?1:0];var s=o(),a=s.width,r=s.height,l=this.initConfig.maxwidth?this.initConfig.maxwidth:a,c=this.initConfig.maxheight?this.initConfig.maxheight:r;this.resizing.minw=this.initConfig.minwidth,this.resizing.maxw=this.resizing.type[0]>0?Math.min(a-i,l):Math.min(i+this.resizing.initw,l),this.resizing.minh=this.initConfig.minheight,this.resizing.maxh=this.resizing.type[1]>0?Math.min(r-n,c):Math.min(n+this.resizing.inith,c),$(document.body).css("cursor",e.css("cursor")),this.$window.find(".resize-border").addClass("resizing"),this.$window.find(".header").addClass("resizing"),$(document).on("mousemove",this.binding.resize),$(document).on("mouseup",this.binding.resizeStop),this.fireEvent("resize",[this,"start"])}function u(t){if(this.resizing.enabled){var e=!1,i=t instanceof jQuery.Event?Common.Utils.zoom():1,o=t.pageX*i,n=t.pageY*i;if(this.resizing.type[0]){var s=this.resizing.initw+(o-this.resizing.initpage_x)*this.resizing.type[0];s>this.resizing.maxw?(o-=(s-this.resizing.maxw)*this.resizing.type[0],s=this.resizing.maxw):s<this.resizing.minw&&(o-=(s-this.resizing.minw)*this.resizing.type[0],s=this.resizing.minw),this.resizing.type[0]<0&&this.$window.css({left:o-this.resizing.initx}),this.setWidth(s),e=!0}if(this.resizing.type[1]){var a=this.resizing.inith+(n-this.resizing.initpage_y)*this.resizing.type[1];a>this.resizing.maxh?(n-=(a-this.resizing.maxh)*this.resizing.type[1],a=this.resizing.maxh):a<this.resizing.minh&&(n-=(a-this.resizing.minh)*this.resizing.type[1],a=this.resizing.minh),this.resizing.type[1]<0&&this.$window.css({top:n-this.resizing.inity}),this.setHeight(a),e=!0}e&&this.fireEvent("resizing")}}function g(){$(document).off("mousemove",this.binding.resize),$(document).off("mouseup",this.binding.resizeStop),$(document.body).css("cursor","auto"),this.$window.find(".resize-border").removeClass("resizing"),this.$window.find(".header").removeClass("resizing"),this.resizing.enabled=!1,this.fireEvent("resize",[this,"end"])}return Common.UI.alert=function(t){this.Window.prototype;t.buttons||(t.buttons=["ok"]),t.dontshow=t.dontshow||!1,t.width||(t.width="auto");var e='<div class="info-box"><% if (typeof iconCls !== "undefined") { %><div class="icon <%= iconCls %>"></div><% } %><div class="text" <% if (typeof iconCls == "undefined") { %> style="padding-'+(Common.UI.isRTL()?"right":"left")+':10px;"<% } %>><span><%= msg %></span><% if (dontshow) { %><div class="dont-show-checkbox"></div><% } %></div></div><% if (dontshow) { %><div class="separator horizontal" style="width: 100%;"></div><% } %>';_.extend(t,{cls:"alert",onprimary:function(t){return a({currentTarget:i.getChild(".footer .dlg-btn")[0]}),!1},getFocusedComponents:r,getDefaultFocusableComponent:l,tpl:_.template(e)(t),role:"alertdialog",repaintcallback:function(){n.call(this,this),s.call(this)}});var i=new Common.UI.Window(t),o=null;function n(e){var i=e.getChild(".info-box"),o=e.getChild(".info-box .text > span"),n=e.getChild(".footer"),s=e.getChild(".header"),a=e.getChild(".body"),r=e.getChild(".icon"),l=r.length>0?r.height():0,c=r.length>0?$(r).outerWidth(!0):0,h=e.getChild(".info-box .dont-show-checkbox");if(t.dontshow||a.css("padding-bottom","10px"),(t.maxwidth||t.minwidth)&&"auto"==t.width){var d=Common.UI.isRTL()?parseInt(i.css("padding-right"))+c+o.width()+parseInt(i.css("padding-left")):Common.Utils.getPosition(o).left+o.width()+parseInt(i.css("padding-right"));t.maxwidth&&d>t.maxwidth?t.width=t.maxwidth:t.minwidth&&d<t.minwidth&&(t.width=t.minwidth)}if("auto"==t.width){i.height(Math.max(o.height(),l)+(h.length>0?h.height()+parseInt(h.css("margin-top")):0)),a.height(parseInt(i.css("height"))+parseInt(n.css("height")));var m=h.find("span");d=Common.UI.isRTL()?parseInt(i.css("padding-right"))+c+parseInt(i.css("padding-left"))+Math.max(o.width(),h.length>0?$(h).find(".checkbox-indeterminate").outerWidth(!0):0):Math.max(o.width(),m.length>0?Common.Utils.getPosition(m).left+m.width():0)+Common.Utils.getPosition(o).left+parseInt(i.css("padding-right"));e.setSize(d,parseInt(a.css("height"))+parseInt(s.css("height")))}else o.css("white-space","normal"),e.setWidth(t.width),i.height(Math.max(o.height(),l)+(h.length>0?h.height()+parseInt(h.css("margin-top")):0)),a.height(parseInt(i.css("height"))+parseInt(n.css("height"))),e.setHeight(parseInt(a.css("height"))+parseInt(s.css("height")));o.height()>0&&o.height()<l/2&&o.css({"vertical-align":"baseline","line-height":l+"px"})}function a(e){t.callback&&t.callback.call(i,e.currentTarget.attributes.result.value,!!o&&"checked"==o.getValue()),i.close(!0)}function r(t){return i.getFooterButtons()}function l(){return _.find(i.getFooterButtons(),(function(t){return t.$el&&t.$el.find(".primary").addBack().filter(".primary").length>0}))}return i.getFocusedComponents=r,i.getDefaultFocusableComponent=l,i.on({"render:after":function(e){var s=e.getChild(".footer");t.dontshow&&s.addClass("dontshow"),s.find(".dlg-btn").on("click",a),o=new Common.UI.CheckBox({el:i.$window.find(".dont-show-checkbox"),labelText:t.textDontShow||i.textDontShow}),n(e)},close:function(){t.callback&&t.callback.call(i,"close")}}),i.show(),i},Common.UI.error=function(t){return!(t=t||{}).title&&(t.title=this.Window.prototype.textError),Common.UI.alert(_.extend(t,{iconCls:"error"}))},Common.UI.confirm=function(t){return!(t=t||{}).title&&(t.title=this.Window.prototype.textConfirmation),Common.UI.alert(_.extend(t,{iconCls:"confirm"}))},Common.UI.info=function(t){return!(t=t||{}).title&&(t.title=this.Window.prototype.textInformation),Common.UI.alert(_.extend(t,{iconCls:"info"}))},Common.UI.warning=function(t){return!(t=t||{}).title&&(t.title=this.Window.prototype.textWarning),Common.UI.alert(_.extend(t,{iconCls:"warn"}))},{$window:void 0,$lastmodal:void 0,dragging:{enabled:!1},resizing:{enabled:!1},initialize:function(e){this.initConfig={},this.binding={};var i={ok:this.okButtonText,cancel:this.cancelButtonText,yes:this.yesButtonText,no:this.noButtonText,close:this.closeButtonText};if(e.buttons&&_.isArray(e.buttons)){null==e.primary&&(e.primary="ok");var o=[];_.each(e.buttons,(function(t){if("object"==_typeof(t)){if(void 0!==t.value){var n={value:t.value,text:t.caption,cls:"auto"+(t.primary||e.primary==t.value?" primary":"")};t.id&&(n.id=t.id),o.push(n)}}else void 0!==t&&o.push({value:t,text:i[t],cls:e.primary==t||_.indexOf(e.primary,t)>-1?"primary":""})})),e.buttonsParsed=o,e.footerCls=e.footerCls||"center"}_.extend(this.initConfig,t,e||{}),!this.initConfig.id&&(this.initConfig.id="window-"+this.cid),!this.initConfig.tpl&&(this.initConfig.tpl=""),Common.UI.BaseView.prototype.initialize.call(this,this.initConfig)},render:function(){var t=this.initConfig.renderTo||document.body;if($(t).append(_.template('<div class="asc-window<%= modal?" modal":"" %><%= cls?" "+cls:"" %>" id="<%= id %>" style="width:<%= width %>px;" role="<%= role %>" aria-modal="<%= modal %>"><% if (header==true) { %><div class="header"><div class="tools"><% if (closable!==false) %><div class="tool close"></div><% %><% if (help===true) %><div class="tool help">?</div><% %></div><div class="title"><%= title %></div> </div><% } %><div class="body"><%= tpl %><% if (typeof (buttonsParsed) !== "undefined" && _.size(buttonsParsed) > 0) { %><div class="footer"><% _.each(buttonsParsed, function (item) { %><button class="btn normal dlg-btn <%= item.cls %>" result="<%= item.value %>" <% if (item.id) { %>id="<%=item.id%>" <% } %> ><%= item.text %></button><% }); %></div><% } %></div></div>')(this.initConfig)),this.$window=$("#"+this.initConfig.id),Common.Locale.getCurrentLanguage()&&"en"!==Common.Locale.getCurrentLanguage()&&this.$window.attr("applang",Common.Locale.getCurrentLanguage()),this.binding.keydown=_.bind(i,this),this.initConfig.header){this.binding.drag=_.bind(h,this),this.binding.dragStop=_.bind(c,this),this.binding.dragStart=_.bind(l,this);this.$window.find(".header").on("mousedown",this.binding.dragStart),this.$window.find(".tool.close").on("click",_.bind((function(){this.$window.find(".tool.close").hasClass("disabled")||(this.initConfig.toolcallback?this.initConfig.toolcallback.call(this):"hide"==this.initConfig.toolclose?this.hide():this.close())}),this)),this.$window.find(".tool.help").on("click",_.bind((function(){this.$window.find(".tool.help").hasClass("disabled")||this.fireEvent("help",this)}),this)),this.initConfig.modal||Common.Gateway.on("processmouse",_.bind(d,this));var e=this.$window.find(".tools .tool").length;e>0&&this.$window.find("> .header > .title").css({"padding-right":20*e+"px","padding-left":20*e+"px"}),this.$window.find(".body").css({"border-top-left-radius":"0px","border-top-right-radius":"0px"})}else this.$window.find(".body").css({top:0});"auto"!==this.initConfig.height&&this.$window.css("height",this.initConfig.height),this.initConfig.resizable&&this.setResizable(this.initConfig.resizable);var o=this;return this.binding.winclose=function(t){o.$window&&o.isVisible()&&o.$window==t.$window&&o.close()},this.binding.onAppRepaint=_.bind(this.onAppRepaint,this),this.binding.onThemeChanged=_.bind(this.onThemeChanged,this),Common.NotificationCenter.on("window:close",this.binding.winclose),Common.NotificationCenter.on("app:repaint",this.binding.onAppRepaint),Common.NotificationCenter.on("uitheme:changed",this.binding.onThemeChanged),this.initConfig.footerCls&&this.$window.find(".footer").addClass(this.initConfig.footerCls),this.menuAddAlign=function(t,e,i){var n=this;o.$window.hasClass("notransform")?(t.css({left:e,top:i}),n.options.additionalAlign=null):(o.$window.addClass("notransform"),t.addClass("hidden"),setTimeout((function(){t.removeClass("hidden"),t.css({left:e,top:i}),n.options.additionalAlign=null}),300))},this.fireEvent("render:after",this),this},show:function(t,i){if(this.initConfig.modal){var o=e();if(!1===this.options.animate||this.options.animate&&!1===this.options.animate.mask)o.attr("counter",parseInt(o.attr("counter"))+1),o.show();else{var l=$(":root").css("--modal-window-mask-opacity");o.css("opacity",0),o.attr("counter",parseInt(o.attr("counter"))+1),o.show(),setTimeout((function(){o.css(r(l))}),1)}Common.NotificationCenter.trigger("modal:show",this),this.$lastmodal=$(".asc-window.modal:not(.dethrone):visible").first().addClass("dethrone")}this.$window?this.$window.is(":visible")||(this.$window.css({opacity:0}),a.call(this),this.$window.show()):(this.render(),n.call(this),_.isNumber(t)&&_.isNumber(i)?(this.$window.css("left",Math.floor(t)),this.$window.css("top",Math.floor(i))):s.call(this)),$(document).on("keydown."+this.cid,this.binding.keydown),this.initConfig.automove&&(this.binding.windowresize=_.bind(m,this),$(window).on("resize",this.binding.windowresize));var c=this;setTimeout((function(){c.fireEvent("animate:before",c)}),10),!1!==this.options.animate?(this.$window.css({"-webkit-transform":"scale(0.8)","-moz-transform":"scale(0.8)","-ms-transform":"scale(0.8)","-o-transform":"scale(0.8)",opacity:0}),setTimeout((function(){c.$window.css({"-webkit-transition":"0.2s opacity, 0.2s -webkit-transform","-webkit-transform":"scale(1)","-moz-transition":"0.2s opacity, 0.2s -moz-transform","-moz-transform":"scale(1)","-ms-transition":"0.2s opacity, 0.2s -ms-transform","-ms-transform":"scale(1)","-o-transition":"0.2s opacity, 0.2s -o-transform","-o-transform":"scale(1)",opacity:"1"}),setTimeout((function(){c.fireEvent("animate:after",c)}),210)}),1),setTimeout((function(){c.$window.addClass("notransform"),c.fireEvent("show",c)}),this.initConfig.modal?1e3:350)):(this.$window.css({opacity:1}),this.$window.addClass("notransform"),this.fireEvent("show",this),setTimeout((function(){c.fireEvent("animate:after",c)}),10)),Common.NotificationCenter.trigger("window:show",this)},close:function(t){if($(document).off("keydown."+this.cid),this.initConfig.automove&&$(window).off("resize",this.binding.windowresize),this.initConfig.header&&this.$window.find(".header").off("mousedown",this.binding.dragStart),Common.NotificationCenter.off({"window:close":this.binding.winclose}),Common.NotificationCenter.off("app:repaint",this.binding.onAppRepaint),Common.NotificationCenter.off("uitheme:changed",this.binding.onThemeChanged),this.initConfig.modal){var i=e(),o=!0;if(i.attr("counter",parseInt(i.attr("counter"))-1),this.$lastmodal.length>0&&(this.$lastmodal.removeClass("dethrone"),o=!(this.$lastmodal.hasClass("modal")&&this.$lastmodal.is(":visible"))),o)if(!1!==this.options.animate){var n=$(":root").css("--modal-window-mask-opacity");i.css(r(0)),setTimeout((function(){parseInt(i.attr("counter"))<1&&(i.css("opacity",n),i.hide(),i.attr("counter",0))}),300)}else parseInt(i.attr("counter"))<1&&(i.hide(),i.attr("counter",0));Common.NotificationCenter.trigger("modal:close",this,o&&parseInt(i.attr("counter"))<1)}this.$window.remove(),!0!==t&&this.fireEvent("close",this)},hide:function(){if($(document).off("keydown."+this.cid),this.initConfig.automove&&$(window).off("resize",this.binding.windowresize),this.$window){if(this.initConfig.modal){var t=e(),i=!0;if(t.attr("counter",parseInt(t.attr("counter"))-1),this.$lastmodal.length>0&&(this.$lastmodal.removeClass("dethrone"),i=!(this.$lastmodal.hasClass("modal")&&this.$lastmodal.is(":visible"))),i)if(!1!==this.options.animate){var o=$(":root").css("--modal-window-mask-opacity");t.css(r(0)),setTimeout((function(){parseInt(t.attr("counter"))<1&&(t.css("opacity",o),t.hide(),t.attr("counter",0))}),300)}else parseInt(t.attr("counter"))<1&&(t.hide(),t.attr("counter",0));Common.NotificationCenter.trigger("modal:hide",this,i&&parseInt(t.attr("counter"))<1)}this.$window.hide(),this.$window.removeClass("notransform"),this.fireEvent("hide",this)}},isLocked:function(){return this.$window.hasClass("dethrone")||!this.initConfig.modal&&this.$window.parent().find(".asc-window.modal:visible").length},getChild:function(t){return t?this.$window.find(t):this.$window},setWidth:function(t){if(t>=0){var e=parseInt(this.$window.css("min-width"));t<e&&(t=e),t-=parseInt(this.$window.css("border-left-width"))+parseInt(this.$window.css("border-right-width")),this.$window.width(t)}},getWidth:function(){return parseInt(this.$window.css("width"))},setHeight:function(t){if(t>=0){var e=parseInt(this.$window.css("min-height"));t<e&&(t=e),t-=parseInt(this.$window.css("border-bottom-width"))+parseInt(this.$window.css("border-top-width")),this.$window.height(t),this.initConfig.header&&(t-=parseInt(this.$window.find("> .header").css("height"))),this.$window.find("> .body").css("height",t)}},getHeight:function(){return parseInt(this.$window.css("height"))},setSize:function(t,e){this.setWidth(t),this.setHeight(e)},getSize:function(){return[this.getWidth(),this.getHeight()]},setTitle:function(t){this.$window.find("> .header > .title").text(t)},getTitle:function(){return this.$window.find("> .header > .title").text()},getLeft:function(){return parseInt(this.$window.css("left"))},getTop:function(){return parseInt(this.$window.css("top"))},setPosition:function(t,e){this.$window&&(_.isNumber(t)&&_.isNumber(e)?(this.$window.css("left",Math.floor(t)),this.$window.css("top",Math.floor(e))):s.call(this))},isVisible:function(){return this.$window&&this.$window.is(":visible")},setResizable:function(t,e,i){if(t!==this.resizable){if(t){var o='<div class="resize-border left" style="top:'+(this.initConfig.header?"33":"5")+'px; bottom: 5px; height: auto; border-right-style: solid; cursor: w-resize;"></div><div class="resize-border left bottom" style="border-bottom-left-radius: 5px; cursor: sw-resize;"></div><div class="resize-border bottom" style="left: 4px; right: 4px; width: auto; z-index: 2; border-top-style: solid; cursor: s-resize;"></div><div class="resize-border right bottom" style="border-bottom-right-radius: 5px; cursor: se-resize;"></div><div class="resize-border right" style="top:'+(this.initConfig.header?"33":"5")+'px; bottom: 5px; height: auto; border-left-style: solid; cursor: e-resize;"></div><div class="resize-border left top" style="border-top-left-radius: 5px; cursor: nw-resize;"></div><div class="resize-border top" style="left: 4px; right: 4px; width: auto; z-index: 2; border-bottom-style:'+(this.initConfig.header?"none":"solid")+'; cursor: n-resize;"></div><div class="resize-border right top" style="border-top-right-radius: 5px; cursor: ne-resize;"></div>';this.initConfig.header&&(o+='<div class="resize-border left" style="top: 5px; height: 28px; cursor: w-resize;"></div><div class="resize-border right" style="top: 5px; height: 28px; cursor: e-resize;"></div>'),this.$window.append(_.template(o)),this.binding.resize=_.bind(u,this),this.binding.resizeStop=_.bind(g,this),this.binding.resizeStart=_.bind(p,this),e&&e.length>1&&(this.initConfig.minwidth=e[0]),e&&e.length>1&&(this.initConfig.minheight=e[1]),i&&i.length>1&&(this.initConfig.maxwidth=i[0]),i&&i.length>1&&(this.initConfig.maxheight=i[1]),this.$window.find(".resize-border").on("mousedown",this.binding.resizeStart)}else this.$window.find(".resize-border").remove();this.resizable=t}else t&&(e&&e.length>1&&(this.initConfig.minwidth=e[0]),e&&e.length>1&&(this.initConfig.minheight=e[1]),i&&i.length>1&&(this.initConfig.maxwidth=i[0]),i&&i.length>1&&(this.initConfig.maxheight=i[1]))},onAppRepaint:function(){this.$window&&this.isVisible()&&(n.call(this),this.initConfig.repaintcallback?this.initConfig.repaintcallback.call(this):!1!==this.initConfig.repaintcallback&&s.call(this))},onThemeChanged:function(){this.$window&&this.isVisible()&&n.call(this)},suspendKeyEvents:function(){this.pauseKeyEvents=!1},resumeKeyEvents:function(){this.initConfig.enableKeyEvents&&(this.pauseKeyEvents=!0)},onPrimary:function(){},getFocusedComponents:function(){return[]},getDefaultFocusableComponent:function(){},getFooterButtons:function(){if(!this.footerButtons){var t=[];this.$window.find(".dlg-btn").each((function(e,i){t.push(new Common.UI.Button({el:$(i)}))})),this.footerButtons=t}return this.footerButtons},cancelButtonText:"Cancel",okButtonText:"OK",yesButtonText:"Yes",noButtonText:"No",closeButtonText:"Close",textWarning:"Warning",textError:"Error",textConfirmation:"Confirmation",textInformation:"Information",textDontShow:"Don't show this message again"}}(),Common.UI.Window||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/ToggleManager",["common/main/lib/component/BaseView"],(function(){"use strict";var t={};function e(e,i){var o,n,s;if(i)for(n=0,s=(o=t[e.toggleGroup]).length;n<s;n++)o[n]!==e&&(o[n].isActive?o[n].isActive()&&o[n].toggle(!1):o[n].toggle(!1))}Common.UI.ToggleManager={register:function(i){if(i.toggleGroup){var o=t[i.toggleGroup];o||(o=t[i.toggleGroup]=[]),o.push(i),i.on("toggle",e)}},unregister:function(i){if(i.toggleGroup){var o=t[i.toggleGroup];o&&(_.without(o,i),i.off("toggle",e))}},getToggled:function(e){var i,o=t[e],n=0;if(o)for(i=o.length;n<i;n++)if(!0===o[n].pressed||!0===o[n].checked)return o[n];return null}}})),void 0===Common)var Common={};if(define("common/main/lib/component/Button",["common/main/lib/component/BaseView","common/main/lib/component/ToggleManager"],(function(){"use strict";window.createButtonSet=function(){function t(t){}t.prototype=new Array,t.prototype.constructor=t;var e=!1;t.prototype.add=function(t){t.setDisabled(e),this.push(t)},t.prototype.setDisabled=function(t){e=t,this.forEach((function(e){e.setDisabled(t)}))},t.prototype.toggle=function(t,e){this.forEach((function(i){i.toggle(t,e)}))},t.prototype.pressed=function(){return this.some((function(t){return t.pressed}))},t.prototype.contains=function(t){return this.some((function(e){return e.id==t}))},t.prototype.concat=function(){var t=Array.prototype.slice.call(arguments),e=Array.prototype.slice.call(this);return t.forEach((function(t){t instanceof Array?Array.prototype.push.apply(e,t):t&&e.push(t)})),e};var i=Object.create(t.prototype);for(var o in arguments)i.add(arguments[o]);return i};var t='<% if ( iconImg ) { %><img src="<%= iconImg %>"><% } else { %><% if (/svgicon/.test(iconCls)) {print(\'<svg class="icon uni-scale"><use class="zoom-int" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'"></use></svg>\');} else print(\'<i class="icon \' + iconCls + \'">&nbsp;</i>\'); %><% } %>',e='<%= caption %><i class="caret"></i>',i='<button type="button" class="btn <%= cls %>" id="<%= id %>" style="<%= style %>" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" <% if (dataHintTitle) { %> data-hint-title="<%= dataHintTitle %>" <% } %>> <div class="inner-box-icon">'+t+'</div><div class="inner-box-caption"><span class="caption"><%= caption %></span></div></button>',o='<div class="btn-group icon-top" id="<%= id %>" style="<%= style %>"><button type="button" class="btn dropdown-toggle <%= cls %>" data-toggle="dropdown" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" <% if (dataHintTitle) { %> data-hint-title="<%= dataHintTitle %>" <% } %>><div class="inner-box-icon">'+t+'</div><div class="inner-box-caption"><span class="caption">'+e+'</span><i class="caret compact-caret"></i></div></button></div>',n='<div class="btn-group x-huge split icon-top" id="<%= id %>" style="<%= style %>"><button type="button" class="btn <%= cls %> inner-box-icon"><span class="btn-fixflex-hcenter">'+t+'</span></button><button type="button" class="btn <%= cls %> inner-box-caption dropdown-toggle" data-toggle="dropdown" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" <% if (dataHintTitle) { %> data-hint-title="<%= dataHintTitle %>" <% } %>><span class="btn-fixflex-vcenter"><span class="caption">'+e+'</span><i class="caret compact-caret"></i></span></button></div>',s=function(t){var e=Common.UI.Themes.getThemeProps("font"),i=document.createElement("span");i.style.fontSize=e&&e.size?e.size:"11px",i.style.fontFamily=e&&e.name?e.name:'Arial, Helvetica, "Helvetica Neue", sans-serif',i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.innerHTML=t,document.body.appendChild(i);var o=i.offsetWidth;return document.body.removeChild(i),o},a=function(t,e){for(var i=t.length-1,o=t;s(o)>e;)o=t.slice(0,i).trim()+"...",i--;return o};Common.UI.Button=Common.UI.BaseView.extend({options:{id:null,hint:!1,delayRenderHint:!0,enableToggle:!1,allowDepress:!0,toggleGroup:null,cls:"",iconCls:"",caption:"",menu:null,disabled:!1,pressed:!1,split:!1,visible:!0,dataHint:"",dataHintDirection:"",dataHintOffset:"0, 0",scaling:!0,canFocused:!1,takeFocusOnClose:!1,action:""},template:_.template(["<% var applyicon = function() { %>","<% if (iconImg) { print('<img src=\"' + iconImg + '\">'); } else { %>",'<% if (iconCls != "") {  if (/svgicon/.test(iconCls)) {print(\'<svg class="icon uni-scale"><use class="zoom-int" xlink:href="#\' + /svgicon\\s(\\S+)/.exec(iconCls)[1] + \'"></use></svg>\');} else print(\'<i class="icon \' + iconCls + \'">&nbsp;</i>\'); }} %>',"<% } %>","<% if ( !menu && onlyIcon ) { %>",'<button type="button" class="btn <%= cls %>" id="<%= id %>" style="<%= style %>" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" <% if (dataHintTitle) { %> data-hint-title="<%= dataHintTitle %>" <% } %>>',"<% applyicon() %>","</button>","<% } else if ( !menu ) { %>",'<button type="button" class="btn <%= cls %>" id="<%= id %>" style="<%= style %>" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" <% if (dataHintTitle) { %> data-hint-title="<%= dataHintTitle %>" <% } %>>',"<% applyicon() %>",'<span class="caption"><%= caption %></span>',"</button>","<% } else if (onlyIcon) {%>",'<div class="btn-group" id="<%= id %>" style="<%= style %>">','<button type="button" class="btn dropdown-toggle <%= cls %>" data-toggle="dropdown" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" <% if (dataHintTitle) { %> data-hint-title="<%= dataHintTitle %>" <% } %>>',"<% applyicon() %>","</button>","</div>","<% } else if (split == false) {%>",'<div class="btn-group" id="<%= id %>" style="<%= style %>">','<button type="button" class="btn dropdown-toggle <%= cls %>" data-toggle="dropdown" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" <% if (dataHintTitle) { %> data-hint-title="<%= dataHintTitle %>" <% } %>>',"<% applyicon() %>",'<span class="caption"><%= caption %></span>','<span class="inner-box-caret"><i class="caret"></i></span>',"</button>","</div>","<% } else { %>",'<div class="btn-group split <%= groupCls %>" id="<%= id %>" style="<%= style %>">','<button type="button" class="btn <%= cls %>">',"<% applyicon() %>",'<span class="caption"><%= caption %></span>',"</button>",'<button type="button" class="btn <%= cls %> dropdown-toggle" data-toggle="dropdown" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" <% if (dataHintTitle) { %> data-hint-title="<%= dataHintTitle %>" <% } %>>','<i class="caret"></i>','<span class="sr-only"></span>',"</button>","</div>","<% } %>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.id=e.options.id||Common.UI.getId(),e.hint=e.options.hint,e.enableToggle=e.options.enableToggle,e.allowDepress=e.options.allowDepress,e.cls=e.options.cls,e.iconCls=e.options.iconCls,e.menu=e.options.menu,e.split=e.options.split,e.toggleGroup=e.options.toggleGroup,e.disabled=e.options.disabled,e.visible=e.options.visible,e.pressed=e.options.pressed,e.caption=e.options.caption,e.template=e.options.template||e.template,e.style=e.options.style,e.rendered=!1,e.stopPropagation=e.options.stopPropagation,e.delayRenderHint=e.options.delayRenderHint,e.action=e.options.action||"",!1===e.options.scaling&&e.options.iconCls&&(e.iconCls=e.options.iconCls+" scaling-off"),e.options.takeFocusOnClose&&(e.options.canFocused=!0),e.options.el?e.render():e.options.parentEl&&e.render(e.options.parentEl)},getCaptionWithBreaks:function(t){var e=t.split(" "),i=null,o=156,n=e.indexOf("&");if(n>-1&&(e[n-1]+=" &",e.splice(n,1)),e.length>1)if(o=this.menu||!0===this.split?o-10:o,e.length<3)e[0]=a(e[0],this.menu?o+10:o),e[1]=a(e[1],o),i=e[0]+"<br>"+e[1];else{var r="";if(s(e[0]+" "+e[1])<o){for(var l=2;l<e.length;l++)r+=e[l]+" ";2*s(r+(this.menu?10:0))<s(e[0]+" "+e[1])?(r=a((e[1]+" "+r).trim(),o),i=e[0]+"<br>"+r):(r=a(r.trim(),o),i=e[0]+" "+e[1]+"<br>"+r)}else{for(var c=1;c<e.length;c++)r+=e[c]+" ";r=a(r.trim(),o),i=e[0]+"<br>"+r}}else i=s(t)<o?t:a(t,o),(this.menu||!0===this.split)&&(i+="<br>");return i},render:function(t){var e=this;if(e.trigger("render:before",e),e.cmpEl=e.$el||$(e.el),t&&(e.setElement(t,!1),!e.rendered)){if(/icon-top/.test(e.cls)&&e.caption&&/huge/.test(e.cls)){!0===e.split?(e.cls&&(e.cls=e.cls.replace(/\s?(?:x-huge|icon-top)/g,"")),this.template=_.template(n)):e.menu?this.template=_.template(o):this.template=_.template(i);var s=this.getCaptionWithBreaks(this.caption);s&&(e.caption=s)}e.cmpEl=$(this.template({id:e.id,cls:e.cls,groupCls:e.split&&/btn-toolbar/.test(e.cls)?"no-borders":"",iconCls:e.iconCls,iconImg:e.options.iconImg,menu:e.menu,split:e.split,onlyIcon:e.options.onlyIcon,disabled:e.disabled,pressed:e.pressed,caption:e.caption,style:e.style,dataHint:e.options.dataHint,dataHintDirection:e.options.dataHintDirection,dataHintOffset:e.options.dataHintOffset,dataHintTitle:e.options.dataHintTitle})),e.menu&&_.isObject(e.menu)&&_.isFunction(e.menu.render)&&(e.menu.render(e.cmpEl),e.options.canFocused&&e.attachKeyEvents()),t.html(e.cmpEl),e.$icon=e.$el.find(".icon")}if(!e.rendered){var a=e.cmpEl,r=a.hasClass("btn-group"),l=a.hasClass("split");_.isString(e.toggleGroup)&&(e.enableToggle=!0);var c,h=function(t){if(!e.disabled&&(1===t.which||void 0===t.which)){if(e.doToggle(),e.options.hint){var i=e.btnEl.data("bs.tooltip");i&&(void 0===i.dontShow&&(i.dontShow=!0),i.hide())}e.split&&e.options.takeFocusOnClose&&e.focus(),e.trigger("click",e,t)}},d=function(t,i,o){if(!t){var n=!1;$("button",a).each((function(t,e){if($(e).is(":hover"))return n=!0,!1})),n||(a.removeClass("over"),$("button",a).removeClass("over"))}if("button"==i){if(!t&&e.enableToggle&&e.allowDepress&&e.pressed)return;if(t&&!l&&e.enableToggle&&e.allowDepress&&!e.pressed)return void o.preventDefault();$("button:first",a).toggleClass("active",t)}else $("[data-toggle^=dropdown]:first",a).toggleClass("active",t);a.toggleClass("active",t),e.stopPropagation&&o.stopPropagation()},m=function(t){d(!1,c,t),$(document).off("mouseup",m)};r?(l&&($("[data-toggle^=dropdown]",a).on("mousedown",_.bind((function(t){if(!e.disabled&&1==t.which&&l){if(e.options.hint){var i=(e.btnMenuEl?e.btnMenuEl:e.btnEl).data("bs.tooltip");i&&(void 0===i.dontShow&&(i.dontShow=!0),i.hide())}d(!e.isMenuOpen(),"arrow",t)}}),this)),$("button",a).on("mousedown",_.bind((function(t){c=t.currentTarget.className.match(/dropdown/)?"arrow":"button",d(!0,c,t),$(document).on("mouseup",m)}),this)),e.options.width>0&&$("button:first",a).css("width",e.options.width-$("[data-toggle^=dropdown]",a).outerWidth())),a.on("hide.bs.dropdown",_.bind(d,e,!1,"arrow")),a.on("show.bs.dropdown",_.bind(d,e,!0,"arrow")),a.on("hidden.bs.dropdown",_.bind((function(t,i){e.cmpEl.find(".dropdown-toggle").blur(),e.cmpEl.hasClass("active")!==e.pressed&&e.cmpEl.trigger("button.internal.active",[e.pressed])}),e)),$("button:first",a).on("click",h)):a.on("click",h),a.on("button.internal.active",_.bind((function(t,i){l?d(i,"button",t):(a.toggleClass("active",i),$("button",a).toggleClass("active",i)),e.stopPropagation&&t.stopPropagation()}),e)),a.on("mouseover",(function(t){e.disabled||(e.cmpEl.addClass("over"),e.trigger("mouseover",e,t))})),a.on("mouseout",(function(t){e.cmpEl.removeClass("over"),e.disabled||e.trigger("mouseout",e,t)})),Common.UI.ToggleManager.register(e),!1!==e.options.scaling&&(a.attr("ratio","ratio"),e.applyScaling(Common.UI.Scaling.currentRatio()),a.on("app:scaling",(function(t,i){e.options.scaling!=i.ratio&&e.applyScaling(i.ratio)})));var p=$("button",a).length>0?$("button",a):e.cmpEl;if(e.menu||p.addClass("canfocused"),e.enableToggle&&!e.menu&&p.attr("aria-pressed",!!e.pressed),e.menu&&($("[data-toggle^=dropdown]",a).attr("aria-haspopup","menu"),$("[data-toggle^=dropdown]",a).attr("aria-expanded",!1)),!e.caption&&e.options.hint||e.options.ariaLabel){var u=e.options.ariaLabel?e.options.ariaLabel:"string"==typeof e.options.hint?e.options.hint:e.options.hint[0];p.attr("aria-label",u)}Common.NotificationCenter.on("uitheme:changed",this.onThemeChanged.bind(this))}return e.rendered=!0,e.options.hint&&e.createHint(e.options.hint),e.pressed&&e.toggle(e.pressed,!0),e.disabled&&e.setDisabled(!(e.disabled=!1)),e.visible||e.setVisible(e.visible),e.trigger("render:after",e),this},doToggle:function(){var t=this;!t.enableToggle||!1===t.allowDepress&&t.pressed||t.toggle()},toggle:function(t,e){var i=void 0===t?!this.pressed:!!t;this.pressed=i,this.cmpEl&&(this.cmpEl.attr("aria-pressed",i),this.cmpEl.trigger("button.internal.active",[i])),e||this.trigger("toggle",this,i)},click:function(t){this.disabled||(this.doToggle(),this.trigger("click",this,t))},isActive:function(){return this.enableToggle?this.pressed:this.cmpEl.hasClass("active")},setDisabled:function(t){if(this.rendered&&this.disabled!=t){var e=(s=this.cmpEl).hasClass("btn-group"),i=this;if((t=!0===t)!==s.hasClass("disabled")){var o=function(e){e.toggleClass("disabled",t),i.options.allowMouseEventsOnDisabled||(t?e.attr({disabled:t}):e.removeAttr("disabled"))};o(s),e&&o(s.children("button"))}if((t||!Common.Utils.isGecko)&&this.options.hint){var n=this.btnEl.data("bs.tooltip");n&&(t&&n.hide(),!Common.Utils.isGecko&&(n.enabled=!t)),this.btnMenuEl&&(n=this.btnMenuEl.data("bs.tooltip"))&&(t&&n.hide(),!Common.Utils.isGecko&&(n.enabled=!t))}if(t&&this.menu&&_.isObject(this.menu)&&this.menu.rendered&&this.menu.isVisible()&&setTimeout((function(){i.menu.hide()}),1),i.options.signals)i.options.signals.indexOf("disabled")<0||i.trigger("disabled",i,t);if(void 0!==i.tabindex){var s=this.split?this.cmpEl:this.$el&&this.$el.find("button").addBack().filter("button");t&&(this.tabindex=s.attr("tabindex")),s.attr("tabindex",t?"-1":i.tabindex)}}this.disabled=t},isDisabled:function(){return this.disabled},setIconCls:function(t){var e=$(this.el).find("i.icon"),i=this.iconCls,o=$(this.el).find(".icon use.zoom-int");if(this.iconCls=t,/svgicon/.test(this.iconCls)){var n=/svgicon\s(\S+)/.exec(this.iconCls);o.attr("xlink:href",n&&n.length>1?"#"+n[1]:"")}else{if(o.length){n=/btn-[^\s]+/.exec(this.iconCls);o.attr("href",n?"#"+n[0]:"")}e.removeClass(i),e.addClass(t||""),!1===this.options.scaling&&e.addClass("scaling-off")}},changeIcon:function(t){var e=this,i=$(this.el).find("i.icon");if(i.length>1&&(i=$(i[0])),t&&(t.curr||t.next)&&i){var o=$(this.el).find(".icon use.zoom-int");t.curr&&(i.removeClass(t.curr),e.iconCls=e.iconCls.replace(t.curr,"").trim()),t.next&&(!i.hasClass(t.next)&&i.addClass(t.next),e.iconCls.indexOf(t.next)<0&&(e.iconCls+=" "+t.next)),o.length&&t.next&&o.attr("href","#"+t.next),e.options.signals&&(e.options.signals.indexOf("icon:changed")<0||e.trigger("icon:changed",e,t))}},hasIcon:function(t){return this.$icon.hasClass(t)},setVisible:function(t){this.cmpEl&&this.cmpEl.toggleClass("hidden",!t),this.visible=t,this.options.signals&&(this.options.signals.indexOf("visible")<0||this.trigger("visible",this,t))},isVisible:function(){return this.cmpEl?this.cmpEl.is(":visible"):$(this.el).is(":visible")},createHint:function(t,e){if(this.options.hint=t,this.rendered){var i=this,o=this.cmpEl,n=o.closest(".asc-window"),s=n.length>0?parseInt(n.css("z-index"))+10:void 0;if(!this.btnEl)if("object"==_typeof(this.options.hint)&&this.options.hint.length>1&&$("button",o).length>0){var a=$("button",o);this.btnEl=$(a[0]),this.btnMenuEl=$(a[1])}else this.btnEl=o;var r=this.btnEl.data("bs.tooltip");if(r&&r.updateTitle("string"==typeof t?t:t[0]),this.btnMenuEl&&(r=this.btnMenuEl.data("bs.tooltip"))&&r.updateTitle(t[1]),!this._isTooltipInited){if(this.delayRenderHint?(this.btnEl.one("mouseenter",(function(){i.btnEl.tooltip({html:!!e,title:"string"==typeof i.options.hint?i.options.hint:i.options.hint[0],placement:i.options.hintAnchor||"cursor",zIndex:s,container:i.options.hintContainer}),!Common.Utils.isGecko&&(i.btnEl.data("bs.tooltip").enabled=!i.disabled),i.btnEl.mouseenter()})),this.btnMenuEl&&this.btnMenuEl.one("mouseenter",(function(){i.btnMenuEl.tooltip({html:!!e,title:i.options.hint[1],placement:i.options.hintAnchor||"cursor",zIndex:s,container:i.options.hintContainer}),!Common.Utils.isGecko&&(i.btnMenuEl.data("bs.tooltip").enabled=!i.disabled),i.btnMenuEl.mouseenter()}))):(this.btnEl.tooltip({html:!!e,title:"string"==typeof this.options.hint?this.options.hint:this.options.hint[0],placement:this.options.hintAnchor||"cursor",zIndex:s,container:this.options.hintContainer}),this.btnMenuEl&&this.btnMenuEl.tooltip({html:!!e,title:this.options.hint[1],placement:this.options.hintAnchor||"cursor",zIndex:s,container:this.options.hintContainer})),n.length>0){var l=function(t){if(n[0]===t.$window[0]){var e=i.btnEl.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.hide()),i.btnMenuEl&&(e=i.btnMenuEl.data("bs.tooltip"))&&(void 0===e.dontShow&&(e.dontShow=!0),e.hide()),Common.NotificationCenter.off({"modal:close":l})}};Common.NotificationCenter.on({"modal:close":l})}this._isTooltipInited=!0}}},updateHint:function(t,e){if(this.options.hint=t,this.rendered){if(this.createHint(t,e),this.disabled||!Common.Utils.isGecko){var i=this.btnEl.data("bs.tooltip");i&&(this.disabled&&i.hide(),!Common.Utils.isGecko&&(i.enabled=!this.disabled)),this.btnMenuEl&&(i=this.btnMenuEl.data("bs.tooltip"))&&(this.disabled&&i.hide(),!Common.Utils.isGecko&&(i.enabled=!this.disabled))}if(!this.caption){var o=this.cmpEl;($("button",o).length>0?$("button",o):o).attr("aria-label","string"==typeof t?t:t[0])}}},setCaption:function(t){if(this.caption!=t){var i=!1;if(/icon-top/.test(this.options.cls)&&this.caption&&/huge/.test(this.options.cls)){var o=this.getCaptionWithBreaks(t);this.caption=o||t,i=!0}else this.caption=t;if(this.rendered){var n=this.cmpEl.find(".caption");n.length>0?n.html(i&&(this.split||this.menu)?_.template(e)({caption:this.caption}):this.caption):this.cmpEl.find("button:first").addBack().filter("button").html(this.caption)}}},setMenu:function(t){t&&_.isObject(t)&&_.isFunction(t.render)&&(this.menu=t,this.rendered&&(this.menu.render(this.cmpEl),this.options.canFocused&&this.attachKeyEvents()),this.trigger("menu:created",this))},attachKeyEvents:function(){var t=this;if(t.menu&&t.menu.rendered&&t.cmpEl){var e=$("button",t.cmpEl);!t.split&&e.addClass("move-focus"),t.menu.on("keydown:before",(function(i,o){if((o.keyCode===Common.UI.Keys.DOWN||o.keyCode===Common.UI.Keys.SPACE)&&!t.isMenuOpen())return $(e[t.split?1:0]).click(),o.preventDefault(),o.stopPropagation(),!1})),t.options.takeFocusOnClose&&t.menu.on("hide:after",(function(){setTimeout((function(){t.focus()}),1)}))}},applyScaling:function(t){var e=this;if(e.options.scaling!=t)if(e.options.scaling=t,t>2){var i=e.$el.is("button")?e.$el:e.$el.find("button:first");if(!i.find("svg.icon").length){var o=e.iconCls||i.find("i.icon").attr("class"),n=/btn-[^\s]+/.exec(o),s=n?n[0]:"null",a=(o?o.indexOf("icon-rtl"):-1)>-1?"icon-rtl":"",r='<svg class="icon %rtlCls"><use class="zoom-int" href="#%iconname"></use></svg>'.replace("%iconname",s).replace("%rtlCls",a);i.find("i.icon").after(r)}}else if(!e.$el.find("i.icon")){var l='<i class="icon %cls">&nbsp;</i>'.replace("%cls",e.iconCls);e.$el.find("svg.icon").after(l)}},isMenuOpen:function(){return this.cmpEl&&this.cmpEl.hasClass("open")},focus:function(){this.split?this.cmpEl.focus():this.$el&&this.$el.find("button").addBack().filter("button").focus()},setTabIndex:function(t){this.rendered&&(this.tabindex=t.toString(),this.disabled||(this.split?this.cmpEl.attr("tabindex",this.tabindex):this.$el&&this.$el.find("button").addBack().filter("button").attr("tabindex",this.tabindex)))},onThemeChanged:function(){if(this.rendered){var t=this.cmpEl;if(this.options.width>0)t&&t.hasClass("btn-group")&&t.hasClass("split")&&$("button:first",t).css("width",this.options.width-$("[data-toggle^=dropdown]",t).outerWidth());else if(t&&this.caption&&/icon-top/.test(this.options.cls)&&/huge/.test(this.options.cls)){var i=t.find(".caption");i.length>0&&i.html(this.split||this.menu?_.template(e)({caption:this.caption}):this.caption)}}}}),Common.UI.ButtonCustom=Common.UI.Button.extend(_.extend({initialize:function(t){t.iconCls="icon-custom "+(t.iconCls||""),Common.UI.Button.prototype.initialize.call(this,t),this.baseUrl=t.baseUrl||"",this.iconsSet=Common.UI.iconsStr2IconsObj(t.iconsSet||[""]);var e=Common.UI.getSuitableIcons(this.iconsSet);this.iconNormalImg=this.baseUrl+e.normal,this.iconActiveImg=this.baseUrl+e.active},render:function(t){Common.UI.Button.prototype.render.call(this,t);var e=!1,i=this;this.cmpButtonFirst=$("button:first",this.$el||$(this.el));var o=function(t,o){var n=i.cmpButtonFirst.hasClass("active")||i.cmpButtonFirst.is(":active");n!==e&&(i.updateIcon(),e=n)};this.cmpButtonFirst[0]&&new MutationObserver(o).observe(this.cmpButtonFirst[0],{attributes:!0,attributeFilter:["class"]});var n=function(t){o(),$(document).off("mouseup",n)};this.cmpButtonFirst.on("mousedown",_.bind((function(t){o(),$(document).on("mouseup",n)}),this)),this.updateIcon(),Common.NotificationCenter.on("uitheme:changed",this.updateIcons.bind(this))},updateIcons:function(){var t=Common.UI.getSuitableIcons(this.iconsSet);this.iconNormalImg=this.baseUrl+t.normal,this.iconActiveImg=this.baseUrl+t.active,this.updateIcon()},updateIcon:function(){this.$icon&&this.$icon.css({"background-image":"url("+(this.cmpButtonFirst&&(this.cmpButtonFirst.hasClass("active")||this.cmpButtonFirst.is(":active"))?this.iconActiveImg:this.iconNormalImg)+")"})},applyScaling:function(t){this.options.scaling!==t&&(this.options.scaling=t,this.updateIcons())}},Common.UI.ButtonCustom||{})),Common.UI.GroupedButtons=function(t,e){var i=t,o=t&&t.length>0&&t[0].cmpEl?t[0].cmpEl.parent():null;o.addClass("grouped-buttons"),e&&(e.underline&&o.addClass("underline"),e.flat&&o.addClass("flat"));var n=function(){var t,e;i&&i.forEach((function(i){!t&&i.isVisible()?(t=!0,i.cmpEl.addClass("first")):i.cmpEl.removeClass("first"),i.cmpEl.removeClass("last"),i.isVisible()&&(e=i)})),e&&e.cmpEl.addClass("last")};return i&&i.forEach((function(t){t.options.signals=t.options.signals||[],t.options.signals.push("visible"),t.on("visible",n)})),n(),{update:n}}})),define("common/main/lib/view/SearchBar",["common/main/lib/component/Window","common/main/lib/component/Button"],(function(){"use strict";Common.UI.SearchBar=Common.UI.Window.extend(_.extend({options:{modal:!1,height:54,header:!1,cls:"search-bar",alias:"SearchBar",showOpenPanel:!0,toolclose:"hide",automove:!1},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box" role="search">','<div class="search-input-group">','<input type="search" id="search-bar-text" class="input-field form-control" maxlength="255" placeholder="'+this.textFind+'" autocomplete="off" aria-label="'+this.textFind+'">','<div id="search-bar-results">0/0</div>',"</div>",'<div class="tools">','<div id="search-bar-back"></div>','<div id="search-bar-next"></div>',this.options.showOpenPanel?'<div id="search-bar-open-panel"></div>':"",'<div id="search-bar-close"></div>',"</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.iconType=this.options.iconType,Common.UI.Window.prototype.initialize.call(this,this.options),Common.NotificationCenter.on("layout:changed",_.bind(this.onLayoutChanged,this)),$(window).on("resize",_.bind(this.onLayoutChanged,this))},render:function(){Common.UI.Window.prototype.render.call(this),this.inputSearch=this.$window.find("#search-bar-text"),this.inputSearch.on("input",_.bind((function(){this.disableNavButtons(),this.fireEvent("search:input",[this.inputSearch.val()])}),this)).on("keydown",_.bind((function(t){this.fireEvent("search:keydown",[this.inputSearch.val(),t])}),this));var t="svg"===this.iconType;return this.btnBack=new Common.UI.Button({parentEl:$("#search-bar-back"),cls:"btn-toolbar",iconCls:t?"svg-icon search-arrow-up":"toolbar__icon btn-arrow-up",hint:this.tipPreviousResult,scaling:!t}),this.btnBack.on("click",_.bind(this.onBtnNextClick,this,"back")),this.btnNext=new Common.UI.Button({parentEl:$("#search-bar-next"),cls:"btn-toolbar",iconCls:t?"svg-icon search-arrow-down":"toolbar__icon btn-arrow-down",hint:this.tipNextResult,scaling:!t}),this.btnNext.on("click",_.bind(this.onBtnNextClick,this,"next")),this.options.showOpenPanel&&(this.btnOpenPanel=new Common.UI.Button({parentEl:$("#search-bar-open-panel"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-more-vertical",hint:this.tipOpenAdvancedSettings}),this.btnOpenPanel.on("click",_.bind(this.onOpenPanel,this))),this.btnClose=new Common.UI.Button({parentEl:$("#search-bar-close"),cls:"btn-toolbar",iconCls:t?"svg-icon search-close":"toolbar__icon btn-close",hint:this.tipCloseSearch,scaling:!t}),this.btnClose.on("click",_.bind((function(){this.hide()}),this)),this.searchResults=$("#search-bar-results"),this.on("animate:before",_.bind(this.focus,this)),Common.NotificationCenter.on("search:updateresults",_.bind((function(t,e){this.disableNavButtons(t,e),this.updateResultsNumber(t,e)}),this)),this},show:function(t){Common.UI.Window.prototype.show.call(this);var e=($("#app-title").length>0?$("#app-title").height():0)+$("#toolbar").height()+2,i=Common.UI.isRTL()?($("#right-menu").is(":visible")?$("#right-menu").width():0)+32:Common.Utils.innerWidth()-($("#right-menu").is(":visible")?$("#right-menu").width():0)-this.$window.width()-32;this.setPosition(i,e),this.disableNavButtons(),t?(this.inputSearch.val(t),this.fireEvent("search:input",[t])):(this.inputSearch.val(""),window.SSE&&this.fireEvent("search:input",["",!0])),this.focus()},focus:function(){var t=this;setTimeout((function(){t.inputSearch.focus(),t.inputSearch.select()}),10)},setText:function(t){this.inputSearch.val(t),this.fireEvent("search:input",[t])},getSettings:function(){return{}},onLayoutChanged:function(){var t=$("#app-title").height()+$("#toolbar").height()+2,e=Common.UI.isRTL()?($("#right-menu").is(":visible")?$("#right-menu").width():0)+32:Common.Utils.innerWidth()-($("#right-menu").is(":visible")?$("#right-menu").width():0)-this.$window.width()-32;this.$window.css({left:e,top:t})},onBtnNextClick:function(t){this.fireEvent("search:"+t,[this.inputSearch.val(),!1])},onOpenPanel:function(){this.hide(),this.fireEvent("search:show",[!0,this.inputSearch.val()])},disableNavButtons:function(t,e){var i=""===this.inputSearch.val()&&!window.SSE||!e;this.btnBack.setDisabled(i),this.btnNext.setDisabled(i)},updateResultsNumber:function(t,e){this.searchResults.text(!e||""===this.inputSearch.val()&&!window.SSE?"0/0":Common.UI.isRTL()?e+"/"+(t+1):t+1+"/"+e),this.inputSearch.css(Common.UI.isRTL()?"padding-left":"padding-right",this.searchResults.outerWidth()+"px")},textFind:"Find",tipPreviousResult:"Previous result",tipNextResult:"Next result",tipOpenAdvancedSettings:"Open advanced settings",tipCloseSearch:"Close search"},Common.UI.SearchBar||{}))})),define("text",["module"],(function(t){"use strict";var e,i,o,n,s,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,h=c&&location.protocol&&location.protocol.replace(/\:/,""),d=c&&location.hostname,m=c&&(location.port||void 0),p={},u=t.config&&t.config()||{};function g(t,e){return void 0===t||""===t?e:t}return e={version:"2.0.16",strip:function(t){if(t){var e=(t=t.replace(r,"")).match(l);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:u.createXhr||function(){var t,e,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(e=0;e<3;e+=1){i=a[e];try{t=new ActiveXObject(i)}catch(t){}if(t){a=[i];break}}return t},parseName:function(t){var e,i,o,n=!1,s=t.lastIndexOf("."),a=0===t.indexOf("./")||0===t.indexOf("../");return-1!==s&&(!a||s>1)?(e=t.substring(0,s),i=t.substring(s+1)):e=t,-1!==(s=(o=i||e).indexOf("!"))&&(n="strip"===o.substring(s+1),o=o.substring(0,s),i?i=o:e=o),{moduleName:e,ext:i,strip:n}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,i,o,n){var s,a,r,l=e.xdRegExp.exec(t);return!l||(s=l[2],r=(a=(a=l[3]).split(":"))[1],a=a[0],(!s||s===i)&&(!a||a.toLowerCase()===o.toLowerCase())&&(!r&&!a||function(t,e,i,o){if(e===o)return!0;if(t===i){if("http"===t)return g(e,"80")===g(o,"80");if("https"===t)return g(e,"443")===g(o,"443")}return!1}(s,r,i,n)))},finishLoad:function(t,i,o,n){o=i?e.strip(o):o,u.isBuild&&(p[t]=o),n(o)},load:function(t,i,o,n){if(n&&n.isBuild&&!n.inlineText)o();else{u.isBuild=n&&n.isBuild;var s=e.parseName(t),a=s.moduleName+(s.ext?"."+s.ext:""),r=i.toUrl(a),l=u.useXhr||e.useXhr;0!==r.indexOf("empty:")?!c||l(r,h,d,m)?e.get(r,(function(i){e.finishLoad(t,s.strip,i,o)}),(function(t){o.error&&o.error(t)})):i([a],(function(t){e.finishLoad(s.moduleName+"."+s.ext,s.strip,t,o)}),(function(t){o.error&&o.error(t)})):o()}},write:function(t,i,o,n){if(p.hasOwnProperty(i)){var s=e.jsEscape(p[i]);o.asModule(t+"!"+i,"define(function () { return '"+s+"';});\n")}},writeFile:function(t,i,o,n,s){var a=e.parseName(i),r=a.ext?"."+a.ext:"",l=a.moduleName+r,c=o.toUrl(a.moduleName+r)+".js";e.load(l,o,(function(i){var o=function(t){return n(c,t)};o.asModule=function(t,e){return n.asModule(t,c,e)},e.write(t,l,o,s)}),s)}},"node"===u.env||!u.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(i=require.nodeRequire("fs"),e.get=function(t,e,o){try{var n=i.readFileSync(t,"utf8");"\ufeff"===n[0]&&(n=n.substring(1)),e(n)}catch(t){o&&o(t)}}):"xhr"===u.env||!u.env&&e.createXhr()?e.get=function(t,i,o,n){var s,a=e.createXhr();if(a.open("GET",t,!0),n)for(s in n)n.hasOwnProperty(s)&&a.setRequestHeader(s.toLowerCase(),n[s]);u.onXhr&&u.onXhr(a,t),a.onreadystatechange=function(e){var n,s;4===a.readyState&&((n=a.status||0)>399&&n<600?((s=new Error(t+" HTTP status: "+n)).xhr=a,o&&o(s)):i(a.responseText),u.onXhrComplete&&u.onXhrComplete(a,t))},a.send(null)}:"rhino"===u.env||!u.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?e.get=function(t,e){var i,o,n=new java.io.File(t),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8")),r="";try{for(i=new java.lang.StringBuffer,(o=a.readLine())&&o.length()&&65279===o.charAt(0)&&(o=o.substring(1)),null!==o&&i.append(o);null!==(o=a.readLine());)i.append(s),i.append(o);r=String(i.toString())}finally{a.close()}e(r)}:("xpconnect"===u.env||!u.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(o=Components.classes,n=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in o,e.get=function(t,e){var i,a,r,l={};s&&(t=t.replace(/\//g,"\\")),r=new FileUtils.File(t);try{(i=o["@mozilla.org/network/file-input-stream;1"].createInstance(n.nsIFileInputStream)).init(r,1,0,!1),(a=o["@mozilla.org/intl/converter-input-stream;1"].createInstance(n.nsIConverterInputStream)).init(i,"utf-8",i.available(),n.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(i.available(),l),a.close(),i.close(),e(l.value)}catch(t){throw new Error((r&&r.path||"")+": "+t)}}),e})),define("text!spreadsheeteditor/main/app/template/Viewport.template",[],(function(){return'<div class="layout-region">\n    <div id="viewport-vbox-layout" class="layout-ct vbox">\n        <section class="layout-ct">\n            <div id="file-menu-panel" class="toolbar-fullview-panel hint-section" style="display:none;"></div>\n        </section>\n        <section id="app-title" class="layout-item"></section>\n        <div id="toolbar" class="layout-item hint-section" data-layout-name="toolbar" role="toolbar"></div>\n        <div class="layout-item middle">\n            <div id="viewport-hbox-layout" class="layout-ct hbox">\n                <div id="left-menu" class="layout-item hint-section" data-layout-name="leftMenu" style="width: 40px;"></div>\n                <div id="about-menu-panel" class="left-menu-full-ct" style="display:none;"></div>\n                <div class="layout-item">\n                    <div class="layout-ct vbox">\n                        <div id="cell-editing-box" class="layout-item" style="height:18px;"></div>\n                        <div id="editor_sdk" class="layout-item" style="min-height: 100px;"></div>\n                    </div>\n                </div>\n                <div id="right-menu" class="layout-item hint-section" data-layout-name="rightMenu"></div>\n                <div id="left-panel-history" class="layout-item hint-section"></div>\n            </div>\n        </div>\n        <div id="statusbar" class="layout-item" data-layout-name="statusBar"></div>\n    </div>\n</div>\n'})),void 0===Common)var Common={};if(define("common/main/lib/component/Layout",["backbone"],(function(){"use strict";var t=function(t){this.box=null,this.panels=[],this.splitters=[],_.extend(this,t||{})},e=function(){return{width:null,height:null,resize:!1,stretch:!1,rely:!1}};_.extend(t.prototype,Backbone.Events,{initialize:function(t){this.$parent=this.box.parent(),this.resize={eventMove:_.bind(this.resizeMove,this),eventStop:_.bind(this.resizeStop,this)};this.freeze=t.freeze,this.changeLayout(t.items)},doLayout:function(){},changeLayout:function(t){var i,o,n=!1;this.splitters&&this.splitters.forEach((function(t){t.resizer&&t.resizer.el.remove()}),this),this.splitters=[],this.panels=[],t.forEach((function(t){t.el instanceof HTMLElement&&(t.el=$(t.el)),(i=_.extend(new e,t)).stretch&&(n=!0,i.rely=!1,i.resize=!1),this.panels.push(i),i.resize&&(o={isresizer:!0,minpos:i.resize.min||0,maxpos:i.resize.max||0,fmin:i.resize.fmin,fmax:i.resize.fmax,behaviour:i.behaviour,index:this.splitters.length,offset:i.resize.offset||0,multiply:i.resize.multiply},n?(i.resize.el=o.el=i.el.before('<div class="layout-resizer before"></div>').prev(),this.panels.splice(this.panels.length-1,0,o)):(i.resize.el=o.el=i.el.after('<div class="layout-resizer after"></div>').next(),this.panels.push(o)),this.splitters.push({resizer:o}),i.resize.hidden&&o.el.hide(),Common.Gateway.on("processmouse",this.resize.eventStop))}),this),this.freezePanels(this.freeze)},getElementHeight:function(t){return parseInt(t.css("height"))},getElementWidth:function(t){return parseInt(t.css("width"))},getItem:function(t){for(var e in this.panels){var i=this.panels[e];if(i.alias==t)return i}},onSelectStart:function(t){return t.preventDefault&&t.preventDefault(),!1},addHandler:function(t,e,i){t.addEventListener?t.addEventListener(e,i):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i},removeHandler:function(t,e,i){t.removeEventListener?t.removeEventListener(e,i):t.detachEvent?t.detachEvent("on"+e,i):t["on"+e]=null},clearSelection:function(){if(window.getSelection){var t=window.getSelection();t.empty?t.empty():t.removeAllRanges&&t.removeAllRanges()}else document.selection&&document.selection.empty()},resizeStart:function(t){if(!this.freeze){this.clearSelection(),this.addHandler(window.document,"selectstart",this.onSelectStart),$(document).on({mousemove:this.resize.eventMove,mouseup:this.resize.eventStop});var e=t.data.panel;this.resize.type=t.data.type,this.resize.$el=e.el,this.resize.min=e.minpos>0?e.minpos:this.resize.$el.parent().width()+e.minpos,this.resize.fmin=e.fmin,this.resize.fmax=e.fmax,this.resize.behaviour=e.behaviour,this.resize.multiply=e.multiply,this.resize.$el.addClass("move"),"vertical"==t.data.type?(this.resize.height=parseInt(this.resize.$el.css("height")),this.resize.max=(e.maxpos>0?e.maxpos:this.resize.$el.parent().height()+e.maxpos)-this.resize.height,this.resize.inity=t.pageY*Common.Utils.zoom()-parseInt(t.currentTarget.style.top)):"horizontal"==t.data.type&&(this.resize.width=parseInt(this.resize.$el.css("width")),this.resize.max=(e.maxpos>0?e.maxpos:this.resize.$el.parent().width()+e.maxpos)-this.resize.width,this.resize.initx=t.pageX*Common.Utils.zoom()-parseInt(t.currentTarget.style.left)),this.resize.multiply&&this.resize.multiply.koeff&&(this.resize.max=Math.floor(this.resize.max/this.resize.multiply.koeff)*this.resize.multiply.koeff+(this.resize.multiply.offset||0)),Common.NotificationCenter.trigger("layout:resizestart")}},resizeMove:function(t){var e=t instanceof jQuery.Event?Common.Utils.zoom():1;if("vertical"==this.resize.type)var i="top",o=t.pageY*e-this.resize.inity;else"horizontal"==this.resize.type&&(i="left",o=t.pageX*e-this.resize.initx);if(this.resize.multiply&&this.resize.multiply.koeff){var n=this.resize.multiply.koeff,s=o/n,a=Math.floor(s)*n+(this.resize.multiply.offset||0),r=Math.ceil(s)*n+(this.resize.multiply.offset||0);o=o>a+n/2?r:a}this.resize.fmin&&this.resize.fmax?o<this.resize.fmin()||o>this.resize.fmax()||(this.resize.$el[0].style[i]=o+"px"):o<this.resize.min||o>this.resize.max||(this.resize.$el[0].style[i]=o+"px")},resizeStop:function(t){if(this.removeHandler(window.document,"selectstart",this.onSelectStart),$(document).off({mousemove:this.resize.eventMove,mouseup:this.resize.eventStop}),this.resize.$el){var e=t instanceof jQuery.Event?Common.Utils.zoom():1;if(t instanceof jQuery.Event||void 0!==t.pageY&&void 0!==t.pageX||(t.pageY=t.y,t.pageX=t.x),"vertical"==this.resize.type)var i="height",o=t.pageY*e-this.resize.inity;else"horizontal"==this.resize.type&&(i="width",o=t.pageX*e-this.resize.initx);if(this.resize.multiply&&this.resize.multiply.koeff){var n=this.resize.multiply.koeff,s=o/n,a=Math.floor(s)*n+(this.resize.multiply.offset||0),r=Math.ceil(s)*n+(this.resize.multiply.offset||0);o=o>a+n/2?r:a}this.resize.fmin&&this.resize.fmax?(o<this.resize.fmin()&&(o=this.resize.fmin()),o>this.resize.fmax()&&(o=this.resize.fmax())):(o<this.resize.min&&(o=this.resize.min),o>this.resize.max&&(o=this.resize.max));var l=null,c=null,h=0;this.resize.$el.hasClass("after")?(l=this.resize.$el.prev(),c=this.resize.$el.next(),h=parseInt(l.css(i))):(l=this.resize.$el.next(),c=this.resize.$el.prev(),h=parseInt(l.css(i)),o=l.parent()[i]()-(o+this.resize[i])),"vertical"==this.resize.type&&(o-=Common.Utils.getPosition(l).top),l.css(i,o+"px"),this.resize.behaviour&&c.css(i,parseInt(c.css(i))-(o-h)),this.resize.$el.removeClass("move"),delete this.resize.$el,this.resize.value!=o&&(this.doLayout(),this.trigger("layout:resizedrag",this)),Common.NotificationCenter.trigger("layout:resizestop")}},freezePanels:function(t){this.panels.forEach((function(e){!e.stretch&&e.resize&&$(e.resize.el).css("cursor",t?"default":"")})),this.freeze=t},setResizeValue:function(t,e){if(t>=this.splitters.length)return this.doLayout(),!1;var i=null,o=null,n=0,s=this.splitters[t].resizer,a="height";return e<s.fmin()&&(e=s.fmin()),e>s.fmax()&&(e=s.fmax()),s.el.hasClass("after")?(i=s.el.prev(),o=s.el.next(),n=parseInt(i.css(a))):(e=(i=s.el.next()).parent()[a]()-(e+s[a]),o=s.el.next(),n=parseInt(i.css(a))),e-=Common.Utils.getPosition(i).top,i.css(a,e+"px"),s.behaviour&&o.css(a,parseInt(o.css(a))-(e-n)),s.value!=e&&this.doLayout(),Math.abs(n-e)>.99}}),!Common.UI&&(Common.UI={}),Common.UI.VBoxLayout=function(e){t.apply(this,arguments),this.initialize.apply(this,arguments)},Common.UI.VBoxLayout.prototype=_.extend(new t,{initialize:function(e){t.prototype.initialize.call(this,e)},doLayout:function(){var t,e,i=0;this.panels.forEach((function(o){o.stretch?t=o:((e=o.el.is(":visible"))&&(i+=!0!==o.rely?o.height:this.getElementHeight(o.el)),o.resize&&!1!==o.resize.autohide&&o.resize.el&&(e?(o.resize.el.show(),t&&(i+=o.resize.height)):(o.resize.el.hide(),t&&(i-=o.resize.height))))}),this),t&&(t.height=this.$parent.height()-i),i=0,this.panels.forEach((function(t){t.el.is(":visible")&&(e={top:i},!0!==t.rely&&(e.height=t.height),t.el.css(e),i+=e.height||this.getElementHeight(t.el))}),this)},changeLayout:function(e){t.prototype.changeLayout.call(this,e),this.panels.forEach((function(t){!t.stretch&&!t.height&&(t.height=this.getElementHeight(t.el)),t.isresizer&&t.el.on("mousedown",{type:"vertical",panel:t},_.bind(this.resizeStart,this))}),this),this.doLayout.call(this)}}),Common.UI.HBoxLayout=function(e){t.apply(this,arguments),this.initialize.apply(this,arguments)},Common.UI.HBoxLayout.prototype=_.extend(new t,{initialize:function(e){t.prototype.initialize.call(this,e)},doLayout:function(t){var e,i,o=0;this.panels.forEach((function(t){t.stretch?e=t:((i=t.el.is(":visible"))&&(t.isresizer?o+=t.offset:o+=!0!==t.rely?t.width:this.getElementWidth(t.el)),t.resize&&!1!==t.resize.autohide&&t.resize.el&&(i?(t.resize.el.show(),e&&(o-=t.resize.width)):(t.resize.el.hide(),e&&(o-=t.resize.width))))}),this),e&&(e.width=this.$parent.width()-o),o=0,this.panels.forEach((function(t){t.el.is(":visible")&&(i={left:o-(t.isresizer?t.width:0)},!0!==t.rely&&(i.width=t.width),t.el.css(i),t.isresizer?o+=t.offset:o+=this.getElementWidth(t.el))}),this)},changeLayout:function(e){t.prototype.changeLayout.call(this,e),this.panels.forEach((function(t){!t.stretch&&!t.width&&(t.width=this.getElementWidth(t.el)),t.isresizer&&t.el.on("mousedown",{type:"horizontal",panel:t},_.bind(this.resizeStart,this))}),this),this.doLayout.call(this)}}),Common.UI.VBoxLayout.prototype.constructor=Common.UI.VBoxLayout,Common.UI.HBoxLayout.prototype.constructor=Common.UI.HBoxLayout})),define("spreadsheeteditor/main/app/view/Viewport",["text!spreadsheeteditor/main/app/template/Viewport.template","jquery","underscore","backbone","common/main/lib/component/BaseView","common/main/lib/component/Layout"],(function(t,e,i,o){"use strict";SSE.Views.Viewport=o.View.extend({el:"#viewport",template:i.template(t),events:{},initialize:function(){},render:function(){var t=e(this.el);t.html(this.template({})),Common.Utils.isSafari?(e("body").addClass("safari"),e("body").mousewheel((function(t){t.preventDefault(),t.stopPropagation()}))):Common.Utils.isChrome&&e("body").addClass("chrome");var i,o=e("#viewport-vbox-layout",t),n=o.find(" > .layout-item");this.vlayout=new Common.UI.VBoxLayout({box:o,items:[{el:o.find("> .layout-item#app-title").hide(),alias:"title",height:Common.Utils.InternalSettings.get("document-title-height")},{el:n[1],alias:"toolbar",height:Common.localStorage.getBool("sse-compact-toolbar")?Common.Utils.InternalSettings.get("toolbar-height-compact"):Common.Utils.InternalSettings.get("toolbar-height-normal")},{el:n[2],stretch:!0},{el:n[3],alias:"statusbar",height:(i=parseInt(getComputedStyle(document.body).getPropertyValue("--statusbar-height")||25),Common.localStorage.getBool("sse-compact-statusbar",!0)?i:2*i)}]});var s=[{el:(n=(o=e("#viewport-hbox-layout",t)).find(" > .layout-item"))[0],rely:!0,alias:"left",resize:{hidden:!0,autohide:!1,min:300,max:600,offset:4}},{el:n[3],rely:!0,alias:"history",resize:{hidden:!0,autohide:!1,min:300,max:600}},{el:n[1],stretch:!0},{el:e(n[2]).hide(),rely:!0}];if(Common.UI.isRTL()){var a=[-600,-300];s[0].resize.min=a[0],s[0].resize.max=a[1];var r=[-600,-300];s[1].resize.min=r[0],s[1].resize.max=r[1];var l=[s[3],s[0]];s[0]=l[0],s[3]=l[1];var c=[s[2],s[1]];s[1]=c[0],s[2]=c[1]}return this.hlayout=new Common.UI.HBoxLayout({box:o,items:s}),n=(o=o.find(".layout-ct.vbox")).find(" > .layout-item"),this.celayout=new Common.UI.VBoxLayout({box:o,items:[{el:n[0],rely:!0,alias:"celleditor",resize:this.getCelleditorResizeOptions()},{el:n[1],stretch:!0}]}),this},getCelleditorResizeOptions:function(){var t=window.getComputedStyle(document.body),e={min:(parseFloat(t.getPropertyValue("--celleditor-height"))||20)-1,max:-100,multiply:{}};return e.multiply.koeff=parseFloat(t.getPropertyValue("--celleditor-line-height"))||18,e.multiply.offset=(parseInt(t.getPropertyValue("--celleditor-height"))||20)-e.multiply.koeff,e},applyEditorMode:function(){var t=SSE.getController("RightMenu").getView("RightMenu");this._rightMenu=t.render(this.mode);var e=Common.UI.LayoutManager.getInitValue("rightMenu");e=void 0!==e&&!e,Common.localStorage.getBool("sse-hidden-rightmenu",e)&&this._rightMenu.hide()},applyCommonMode:function(){var t=Common.UI.LayoutManager.getInitValue("leftMenu");t=void 0!==t&&!t,Common.localStorage.getBool("sse-hidden-leftmenu",t)&&SSE.getController("LeftMenu").getView("LeftMenu").hide()},setMode:function(t,e){t.isDisconnected?(i.isUndefined(this.mode)&&(this.mode={}),this.mode.canCoAuthoring=!1):(this.mode=t,this.vlayout&&t.isDesktopApp&&!t.isEdit&&this.vlayout.items[1].el.css("display","block"))}})})),define("spreadsheeteditor/main/app/controller/Viewport",["core","common/main/lib/view/Header","common/main/lib/view/SearchBar","spreadsheeteditor/main/app/view/Viewport"],(function(t){"use strict";SSE.Controllers.Viewport=Backbone.Controller.extend(_.assign({models:[],collections:[],views:["Viewport","Common.Views.Header"],initialize:function(){var t=this;this.addListeners({FileMenu:{"menu:hide":t.onFileMenu.bind(t,"hide"),"menu:show":t.onFileMenu.bind(t,"show"),"settings:apply":t.applySettings.bind(t)},Statusbar:{"view:compact":function(e,i){var o=parseInt(window.getComputedStyle(document.body).getPropertyValue("--statusbar-height")||25);t.viewport.vlayout.getItem("statusbar").height=i?o:2*o}},Toolbar:{"render:before":function(e){var i=SSE.getController("Main").appOptions;i.isEditDiagram||i.isEditMailMerge||i.isEditOle||e.setExtra("right",t.header.getPanel("right",i)),i.twoLevelHeader&&!i.compactHeader||e.setExtra("left",t.header.getPanel("left",i)),t.appConfig&&t.appConfig.isEdit&&!i.compactHeader&&e.btnCollabChanges&&(e.btnCollabChanges=t.header.btnSave),t.toolbar=e},"view:compact":function(e,i){t.viewport.vlayout.getItem("toolbar").height=i?Common.Utils.InternalSettings.get("toolbar-height-compact"):Common.Utils.InternalSettings.get("toolbar-height-normal")},"undo:disabled":function(e){t.header.lockHeaderBtns("undo",e,Common.enumLock.undoLock)},"redo:disabled":function(e){t.header.lockHeaderBtns("redo",e,Common.enumLock.redoLock)},"print:disabled":function(e){t.header.btnPrint&&t.header.btnPrint.setDisabled(e),t.header.btnPrintQuick&&t.header.btnPrintQuick.setDisabled(e)},"save:disabled":function(e){t.header.btnSave&&t.header.btnSave.setDisabled(e)}}}),Common.NotificationCenter.on("app:face",this.onAppShowed.bind(this)),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),Common.NotificationCenter.on("tabstyle:changed",this.onTabStyleChange.bind(this)),Common.NotificationCenter.on("tabbackground:changed",this.onTabBackgroundChange.bind(this)),Common.NotificationCenter.on("uitheme:changed",this.onThemeChanged.bind(this))},setApi:function(t){this.api=t,this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",this.onApiCoAuthoringDisconnect.bind(this)),Common.NotificationCenter.on("api:disconnect",this.onApiCoAuthoringDisconnect.bind(this))},getApi:function(){return this.api},onAppShowed:function(t){var e=this;e.appConfig=t;var i=Common.Utils.InternalSettings,o=$(".toolbar-fullview-panel");if(o.css("top",Common.UI.LayoutManager.isElementVisible("toolbar")?i.get("toolbar-height-tabs"):0),!t.isEdit||!Common.localStorage.itemExists("sse-compact-toolbar")&&t.customization&&t.customization.compactToolbar?e.viewport.vlayout.getItem("toolbar").height=i.get("toolbar-height-compact"):(t.isEditDiagram||t.isEditMailMerge||t.isEditOle)&&(e.viewport.vlayout.getItem("toolbar").height=41,document.body.classList.add("inner-simple-editor")),t.twoLevelHeader&&!t.isEditDiagram&&!t.isEditMailMerge&&!t.isEditOle&&!t.compactHeader){var n=e.viewport.vlayout.getItem("title").el;n.html(e.header.getPanel("title",t)).show(),n.find(".extra").html(e.header.getPanel("left",t));var s=e.viewport.vlayout.getItem("toolbar");s.el.addClass("top-title"),s.height-=i.get("toolbar-height-tabs")-i.get("toolbar-height-tabs-top-title");var a=i.get("toolbar-height-tabs-top-title");i.set("toolbar-height-tabs",a),i.set("toolbar-height-compact",a),i.set("toolbar-height-normal",a+i.get("toolbar-height-controls")),o.css("top",(Common.UI.LayoutManager.isElementVisible("toolbar")?a:0)+i.get("document-title-height"))}e.onTabStyleChange(),e.onTabBackgroundChange(),t.customization&&t.customization.toolbarHideFileName&&e.viewport.vlayout.getItem("toolbar").el.addClass("style-skip-docname"),e.header.btnSearch.on("toggle",e.onSearchToggle.bind(this)),$("#toolbar, #app-title").on("mousewheel",(function(t){t.preventDefault()}))},onAppReady:function(t){},onLaunch:function(){this.viewport=this.createView("Viewport").render(),this.getApplication().getController("CellEditor").createView("CellEditor",{el:"#cell-editing-box"}).render(),this.api=new Asc.spreadsheet_api({"id-view":"editor_sdk","id-input":"ce-cell-content",translate:this.getApplication().getController("Main").translationTable,isRtlInterface:Common.UI.isRTL()}),this.header=this.createView("Common.Views.Header",{headerCaption:"Spreadsheet Editor",storeUsers:SSE.getCollection("Common.Collections.Users")}),Common.NotificationCenter.on("layout:changed",_.bind(this.onLayoutChanged,this)),$(window).on("resize",_.bind(this.onWindowResize,this)),this.viewport.celayout.on("layout:resizedrag",(function(){this.viewport.fireEvent("layout:resizedrag",[this,"cell:edit"]),this.api.asc_Resize()}),this);var t=$("#left-menu"),e=$("#left-panel-history");this.viewport.hlayout.on("layout:resizedrag",(function(){this.api.asc_Resize(),Common.localStorage.setItem("sse-mainmenu-width",e.is(":visible")?e.width()+SCALE_MIN:t.width())}),this),this.boxSdk=$("#editor_sdk"),this.boxFormula=$("#cell-editing-box"),this.boxSdk.css("border-left","none"),this.boxFormula.css("border-left","none"),Common.NotificationCenter.on("search:show",_.bind(this.onSearchShow,this))},onLayoutChanged:function(t){switch(t){default:this.viewport.vlayout.doLayout(),this.viewport.celayout.doLayout();case"rightmenu":this.viewport.hlayout.doLayout();break;case"history":(e=this.viewport.hlayout.getItem("history")).resize.el&&(this.boxSdk.css("border-left",""),e.resize.el.show()),this.viewport.hlayout.doLayout();break;case"leftmenu":var e;(e=this.viewport.hlayout.getItem("left")).resize.el&&(e.el.width()>40?(this.boxSdk.css("border-left",""),this.boxFormula.css("border-left",""),e.resize.el.show()):(e.resize.el.hide(),this.boxSdk.css("border-left","none"),this.boxFormula.css("border-left","none"))),this.viewport.hlayout.doLayout();break;case"header":case"toolbar":case"status":this.viewport.vlayout.doLayout(),this.viewport.celayout.doLayout();break;case"celleditor":arguments[1]&&this.boxSdk.css("border-top","hidden"==arguments[1]?"none":""),this.viewport.celayout.doLayout()}this.api.asc_Resize()},onWindowResize:function(t){this.onLayoutChanged("window"),Common.NotificationCenter.trigger("window:resize")},onFileMenu:function(t){var e=this,i="show"==t;e.header.lockHeaderBtns("undo",i,Common.enumLock.fileMenuOpened),e.header.lockHeaderBtns("redo",i,Common.enumLock.fileMenuOpened),e.header.lockHeaderBtns("users",i)},applySettings:function(){},onApiCoAuthoringDisconnect:function(t){this.header&&(this.header.btnDownload&&!t&&this.header.btnDownload.hide(),this.header.btnPrint&&!t&&this.header.btnPrint.hide(),this.header.btnEdit&&this.header.btnEdit.hide(),this.header.btnPrintQuick&&!t&&this.header.btnPrintQuick.hide())},SetDisabled:function(t){},onSearchShow:function(){this.header.btnSearch&&this.header.btnSearch.toggle(!0)},onSearchToggle:function(){var t=this.getApplication().getController("LeftMenu");if(t.isSearchPanelVisible())return this.header.btnSearch.toggle(!1,!0),void t.getView("LeftMenu").panelSearch.focus();if(!this.searchBar){var e=this.appConfig.canBrandingExt&&(!Common.UI.LayoutManager.isElementVisible("leftMenu")||this.appConfig.customization&&!1===this.appConfig.customization.leftMenu);this.searchBar=new Common.UI.SearchBar(e?{showOpenPanel:!1,width:303}:{}),this.searchBar.on("hide",_.bind((function(){this.header.btnSearch.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete")}),this))}if(this.header.btnSearch.pressed){var i=this.api.asc_GetSelectedText(),o=this.getApplication().getController("Search"),n=o.getResultsNumber();this.searchBar.show(i&&i.trim()||o.getSearchText()),this.searchBar.updateResultsNumber(n[0],n[1])}else this.searchBar.hide()},isSearchBarVisible:function(){return this.searchBar&&this.searchBar.isVisible()},onTabStyleChange:function(t){t=t||Common.Utils.InternalSettings.get("settings-tab-style"),this.viewport.vlayout.getItem("toolbar").el.toggleClass("lined-tabs","line"===t)},onTabBackgroundChange:function(t){t=t||Common.Utils.InternalSettings.get("settings-tab-background"),this.viewport.vlayout.getItem("toolbar").el.toggleClass("style-off-tabs","toolbar"===t)},onThemeChanged:function(){if(Common.UI.Themes.available()){var t=Common.Utils.InternalSettings,e=this.appConfig,i=window.getComputedStyle(document.body);if(e.twoLevelHeader&&!e.isEditDiagram&&!e.isEditMailMerge&&!e.isEditOle&&!e.compactHeader){var o=$(".toolbar-fullview-panel");t.set("toolbar-height-controls",parseInt(i.getPropertyValue("--toolbar-height-controls")||84)),t.set("toolbar-height-normal",t.get("toolbar-height-tabs")+t.get("toolbar-height-controls")),o.css("top",(Common.UI.LayoutManager.isElementVisible("toolbar")?t.get("toolbar-height-tabs"):0)+t.get("document-title-height")),this.viewport.vlayout.getItem("toolbar").height=this.toolbar&&this.toolbar.isCompact()?t.get("toolbar-height-compact"):t.get("toolbar-height-normal")}var n=parseInt(i.getPropertyValue("--statusbar-height")),s=$(".statusbar").hasClass("no-compact");this.viewport.vlayout.getItem("statusbar").height=s?2*n:n;var a=this.viewport.celayout.getItem("celleditor"),r=this.viewport.getCelleditorResizeOptions();a.resize.min=r.min,a.resize.multiply.koeff=r.multiply.koeff,a.resize.multiply.offset=r.multiply.offset,Common.NotificationCenter.trigger("layout:changed","toolbar")}},textHideFBar:"Hide Formula Bar",textHideHeadings:"Hide Headings",textHideGridlines:"Hide Gridlines",textFreezePanes:"Freeze Panes",textFreezePanesShadow:"Show Freezed Panes Shadow"},SSE.Controllers.Viewport))})),define("common/main/lib/util/utils",[],(function(){function _extend_object(t,e){return"undefined"!=typeof _?_.extend({},t,e):Object?Object.assign({},t,e):e}void 0===window.Common&&(window.Common={}),void 0===Common.Utils&&(Common.Utils={});var utils=new function(){var t=navigator.userAgent.toLowerCase(),e=function(e){return e.test(t)},i="CSS1Compat"==document.compatMode,o=function(e,i){var o;return e&&(o=i.exec(t))?parseFloat(o[1]):0},n=document.documentMode,s=(e(/edge/),e(/opera/)),a=s&&e(/version\/10\.5/),r=!s&&(e(/msie/)||e(/trident/)||e(/edge/)),l=r&&(e(/msie 7/)&&8!=n&&9!=n&&10!=n||7==n),c=r&&(e(/msie 8/)&&7!=n&&9!=n&&10!=n||8==n),h=r&&(e(/msie 9/)&&7!=n&&8!=n&&10!=n||9==n),d=r&&(e(/msie 10/)&&7!=n&&8!=n&&9!=n||10==n),m=r&&(e(/trident\/7\.0/)&&7!=n&&8!=n&&9!=n&&10!=n||11==n),p=r&&e(/msie 6/),u=!r&&e(/\bchrome\b/),g=!r&&e(/webkit/),f=!r&&!u&&e(/safari/),b=f&&e(/applewebkit\/4/),C=f&&e(/version\/3/),v=f&&e(/version\/4/),_=f&&e(/version\/5\.0/),w=f&&e(/version\/5/),A=!g&&!r&&e(/gecko/),y=A&&e(/rv:1\.9/),S=A&&e(/rv:2\.0/),x=A&&e(/rv:5\./),k=A&&e(/rv:10\./),T=y&&e(/rv:1\.9\.0/),I=y&&e(/rv:1\.9\.1/),E=y&&e(/rv:1\.9\.2/),P=e(/windows|win32/),D=e(/macintosh|mac os x/),M=e(/linux/),U=o(!0,/\bchrome\/(\d+\.\d+)/),F=o(!0,/\bfirefox\/(\d+\.\d+)/),R=o(r,/msie (\d+\.\d+)/),L=o(s,/version\/(\d+\.\d+)/),B=o(f,/version\/(\d+\.\d+)/),V=o(g,/webkit\/(\d+\.\d+)/),O=/^https/i.test(window.location.protocol),H=(/android|avantgo|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent||navigator.vendor||window.opera),void 0),N=this,G=function(){var t={};if(window.AscCommon&&window.AscCommon.checkDeviceScale)t=window.AscCommon.checkDeviceScale(),AscCommon.correctApplicationScale(t);else{window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.25) and (-webkit-max-device-pixel-ratio: 1.49), screen and (min-resolution: 1.25dppx) and (max-resolution: 1.49dppx)").matches?t.devicePixelRatio=1.25:window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5) and (-webkit-max-device-pixel-ratio: 1.74), screen and (min-resolution: 1.5dppx) and (max-resolution: 1.74dppx)").matches?t.devicePixelRatio=1.5:window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.75) and (-webkit-max-device-pixel-ratio: 1.99), screen and (min-resolution: 1.75dppx) and (max-resolution: 1.99dppx)").matches?t.devicePixelRatio=1.75:window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 2), screen and (min-resolution: 2dppx), screen and (min-resolution: 192dpi)").matches?t.devicePixelRatio=2:t.devicePixelRatio=1,window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 2.25), screen and (min-resolution: 2.25dppx), screen and (min-resolution: 216dpi)").matches&&(t.devicePixelRatio=2.25)}$(document.body);var e=document.body.className,i=e.replace(/pixel-ratio__[\w-]+/gi,"").trim();t.devicePixelRatio<1.25?/pixel-ratio__/.test(e)&&(document.body.className=i):t.devicePixelRatio<1.5?/pixel-ratio__1_25/.test(e)||(document.body.className=i+" pixel-ratio__1_25"):t.devicePixelRatio<1.75?/pixel-ratio__1_5/.test(e)||(document.body.className=i+" pixel-ratio__1_5"):!(t.devicePixelRatio<1.75)&&t.devicePixelRatio<2?/pixel-ratio__1_75/.test(e)||(document.body.className=i+" pixel-ratio__1_75"):!(t.devicePixelRatio<2)&&t.devicePixelRatio<2.25?/pixel-ratio__2\b/.test(e)||(document.body.className=i+" pixel-ratio__2"):/pixel-ratio__2_5/.test(e)||(document.body.className=i+" pixel-ratio__2_5"),N.zoom=t.correct?t.zoom:1,N.innerWidth=window.innerWidth*N.zoom,N.innerHeight=window.innerHeight*N.zoom,N.applicationPixelRatio=t.applicationPixelRatio||t.devicePixelRatio,N.innerWidth<1&&void 0===H?H=!0:H&&N.innerWidth>0&&(H=!1,jQuery.support&&jQuery.support.forceStyleTests(),Common.NotificationCenter.trigger("app:repaint"))},z=function(){return!!(u&&128<=U)&&1!==N.zoom},W=function(t){var e=t.offset();return z()?{left:e.left*N.zoom,top:e.top*N.zoom}:e},j=function(t){var e=t.position();return z()?{left:e.left*N.zoom,top:e.top*N.zoom}:e};return N.zoom=1,N.applicationPixelRatio=1,N.innerWidth=window.innerWidth,N.innerHeight=window.innerHeight,r?($(document.body).addClass("ie"),$(window).on("resize",(function(){N.innerWidth=window.innerWidth,N.innerHeight=window.innerHeight}))):(G(),$(window).on("resize",G)),{checkSize:G,userAgent:t,isStrict:i,isIEQuirks:r&&!i&&(p||l||c||h),isOpera:s,isOpera10_5:a,isWebKit:g,isChrome:u,isSafari:f,isSafari3:C,isSafari4:v,isSafari5:w,isSafari5_0:_,isSafari2:b,isIE:r,isIE6:p,isIE7:l,isIE7m:p||l,isIE7p:r&&!p,isIE8:c,isIE8m:p||l||c,isIE8p:r&&!(p||l),isIE9:h,isIE9m:p||l||c||h,isIE9p:r&&!(p||l||c),isIE10:d,isIE10m:p||l||c||h||d,isIE10p:r&&!(p||l||c||h),isIE11:m,isIE11m:p||l||c||h||d||m,isIE11p:r&&!(p||l||c||h||d),isGecko:A,isGecko3:y,isGecko4:S,isGecko5:x,isGecko10:k,isFF3_0:T,isFF3_5:I,isFF3_6:E,isFF4:4<=F&&F<5,isFF5:5<=F&&F<6,isFF10:10<=F&&F<11,isLinux:M,isWindows:P,isMac:D,chromeVersion:U,firefoxVersion:F,ieVersion:R,operaVersion:L,safariVersion:B,webKitVersion:V,isSecure:O,emailRe:/^(mailto:)?([a-z0-9'\._-]+@[a-z0-9\.-]+\.[a-z0-9]{2,4})([a-яё0-9\._%+-=\? :&]*)/i,ipRe:/^(((https?)|(ftps?)):\/\/)?([\-\wа-яё]*:?[\-\wа-яё]*@)?(((1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9])\.){3}(1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9]))(:\d+)?(\/[%\-\wа-яё]*(\.[\wа-яё]{2,})?(([\wа-яё\-\.\?\\\/+@&#;:`~=%!,\(\)]*)(\.[\wа-яё]{2,})?)*)*\/?/i,hostnameRe:/^(((https?)|(ftps?)):\/\/)?([\-\wа-яё]*:?[\-\wа-яё]*@)?(([\-\wа-яё]+\.)+[\wа-яё\-]{2,}(:\d+)?(\/[%\-\wа-яё]*(\.[\wа-яё]{2,})?(([\wа-яё\-\.\?\\\/\+@&#;:`'~=%!,\(\)]*)(\.[\wа-яё]{2,})?)*)*\/?)/i,localRe:/^(((https?)|(ftps?)):\/\/)([\-\wа-яё]*:?[\-\wа-яё]*@)?(([\-\wа-яё]+)(:\d+)?(\/[%\-\wа-яё]*(\.[\wа-яё]{2,})?(([\wа-яё\-\.\?\\\/\+@&#;:`'~=%!,\(\)]*)(\.[\wа-яё]{2,})?)*)*\/?)/i,emailStrongRe:/(mailto:)?([a-z0-9'\.\+_-]+@[a-z0-9\.-]+\.[a-z0-9]{2,4})([a-яё0-9\._%+-=\?:&]*)/gi,emailAddStrongRe:/(mailto:|\s[@]|\s[+])?([a-z0-9'\._-]+@[a-z0-9\.-]+\.[a-z0-9]{2,4})([a-яё0-9\._%\+-=\?:&]*)/gi,ipStrongRe:/(((https?)|(ftps?)):\/\/([\-\wа-яё]*:?[\-\wа-яё]*@)?)(((1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9])\.){3}(1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9]))(:\d+)?(\/[%\-\wа-яё]*(\.[\wа-яё]{2,})?(([\wа-яё\-\.\?\\\/\+@&#;:`~=%!,\(\)]*)(\.[\wа-яё]{2,})?)*)*\/?/gi,hostnameStrongRe:/((((https?)|(ftps?)):\/\/([\-\wа-яё]*:?[\-\wа-яё]*@)?)|(([\-\wа-яё]*:?[\-\wа-яё]*@)?www\.))((([\-\wа-яё]+\.)+[\wа-яё\-]{2,}|([\-\wа-яё]+))(:\d+)?(\/[%\-\wа-яё]*(\.[\wа-яё]{2,})?(([\wа-яё\-\.\?\\\/\+@&#;:`~=%!,\(\)]*)(\.[\wа-яё]{2,})?)*)*\/?)/gi,documentSettingsType:{Paragraph:0,Table:1,Header:2,TextArt:3,Shape:4,Image:5,Slide:6,Chart:7,MailMerge:8,Signature:9,Pivot:10,Cell:11,Slicer:12,Form:13},importTextType:{DRM:0,CSV:1,TXT:2,Paste:3,Columns:4,Data:5},zoom:function(){return N.zoom},applicationPixelRatio:function(){return N.applicationPixelRatio},topOffset:0,innerWidth:function(){return N.innerWidth},innerHeight:function(){return N.innerHeight},croppedGeometry:function(){return{left:0,top:Common.Utils.InternalSettings.get("window-inactive-area-top"),width:N.innerWidth,height:N.innerHeight-Common.Utils.InternalSettings.get("window-inactive-area-top")}},getBoundingClientRect:function(t){var e=t.getBoundingClientRect();if(!z())return e;var i=N.zoom,o={};return void 0!==e.x&&(o.x=e.x*i),void 0!==e.y&&(o.y=e.y*i),void 0!==e.width&&(o.width=e.width*i),void 0!==e.height&&(o.height=e.height*i),void 0!==e.left&&(o.left=e.left*i),void 0!==e.top&&(o.top=e.top*i),void 0!==e.right&&(o.right=e.right*i),void 0!==e.bottom&&(o.bottom=e.bottom*i),o},getOffset:W,setOffset:function(t,e){var i,o,n,s,a,r,l=t.css("position"),c={};return"static"===l&&(t[0].style.position="relative"),a=W(t),n=t.css("top"),r=t.css("left"),("absolute"===l||"fixed"===l)&&(n+r).indexOf("auto")>-1?(s=(i=j(t)).top,o=i.left):(s=parseFloat(n)||0,o=parseFloat(r)||0),null!=e.top&&(c.top=e.top-a.top+s),null!=e.left&&(c.left=e.left-a.left+o),t.css(c),t},getPosition:j}};Common.Utils=_extend_object(Common.Utils,utils);var themecolor=new function(){var t=!0;return{txtBlack:"Black",txtWhite:"White",txtRed:"Red",txtGreen:"Green",txtBlue:"Blue",txtYellow:"Yellow",txtPurple:"Purple",txtAqua:"Aqua",txtDarkRed:"Dark red",txtDarkGreen:"Dark green",txtDarkBlue:"Dark blue",txtDarkYellow:"Dark yellow",txtDarkPurple:"Dark purple",txtDarkTeal:"Dark teal",txtLightGray:"Light gray",txtGray:"Gray",txtLightBlue:"Light blue",txtPink:"Pink",txtLightYellow:"Light yellow",txtSkyBlue:"Sky blue",txtRose:"Rose",txtTurquosie:"Turquosie",txtLightGreen:"Light green",txtLavender:"Lavender",txtLightOrange:"Light orange",txtTeal:"Teal",txtGold:"Gold",txtOrange:"Orange",txtIndigo:"Indigo",txtBrown:"Brown",txtDarkGray:"Dark gray",txtbackground:"Background",txttext:"Text",txtaccent:"Accent",txtDarker:"Darker",txtLighter:"Lighter",txtBrightGreen:"Bright green",txtViolet:"Violet",ThemeValues:[6,15,7,16,0,1,2,3,4,5],getTranslation:function(t){return t?this["txt"+t.replace(" ","")]||t:""},getEffectTranslation:function(t){return 0!==(t=parseInt(100*t))?(t>0?this.txtLighter:this.txtDarker)+" "+Math.abs(t)+"%":""},setColors:function(e,i){if(t){for(var o=1;o<3;o++)this["txtbackground"+o]=this.txtbackground+" "+o,this["txttext"+o]=this.txttext+" "+o;for(o=1;o<7;o++)this["txtaccent"+o]=this.txtaccent+" "+o;t=!1}var n,s;if(i&&i.length>0){var a=[];for(o=0;o<i.length;o++)s={color:this.getHexColor(i[o].get_r(),i[o].get_g(),i[o].get_b()),tip:this.getTranslation(i[o].asc_getName())},a.push(s);this.standartcolors=a}var r=[];for(o=0;o<6;o++)for(n=0;n<10;n++){var l=o+6*n,c=this.getTranslation(e[l].asc_getName()),h=this.getTranslation(e[l].asc_getNameInColorScheme()),d=this.getEffectTranslation(e[l].asc_getEffectValue());c&&(h&&(c+=Common.Utils.String.textComma+" "+h),d&&(c+=Common.Utils.String.textComma+" "+d)),s={color:this.getHexColor(e[l].get_r(),e[l].get_g(),e[l].get_b()),effectId:l,effectValue:this.ThemeValues[n],tip:c},r.push(s)}this.effectcolors=r},getEffectColors:function(){return this.effectcolors},getStandartColors:function(){return this.standartcolors},getHexColor:function(t,e,i){return t=t.toString(16),e=e.toString(16),i=i.toString(16),1==t.length&&(t="0"+t),1==e.length&&(e="0"+e),1==i.length&&(i="0"+i),t+e+i},getRgbColor:function(t){var e="object"==_typeof(t)?t.color:t;3==(e=e.replace(/#/,"")).length&&(e=e.replace(/(.)/g,"$1$1")),e=parseInt(e,16);var i=new Asc.asc_CColor;return i.put_type("object"==_typeof(t)&&void 0!==t.effectId?Asc.c_oAscColor.COLOR_TYPE_SCHEME:Asc.c_oAscColor.COLOR_TYPE_SRGB),i.put_r(e>>16),i.put_g((65280&e)>>8),i.put_b(255&e),i.put_a(255),void 0!==t.effectId&&i.put_value(t.effectId),i},colorValue2EffectId:function(t){if("object"==_typeof(t)&&t&&void 0!==t.effectValue&&this.effectcolors)for(var e=0;e<this.effectcolors.length;e++)if(this.effectcolors[e].effectValue===t.effectValue&&t.color.toUpperCase()===this.effectcolors[e].color.toUpperCase()){t.effectId=this.effectcolors[e].effectId;break}return t},selectPickerColorByEffect:function(t,e){if(t)if("object"==_typeof(t)){for(var i=!1,o=0;o<10;o++)if(Common.Utils.ThemeColor.ThemeValues[o]==t.effectValue){e.select(t,!0),i=!0;break}i||e.clearSelection()}else e.select(t,!0);else e.clearSelection()}}};Common.Utils.ThemeColor=_extend_object(themecolor,Common.Utils.ThemeColor);var metrics=new function(){var t=this;return t.c_MetricUnits={cm:0,pt:1,inch:2},t.currentMetric=t.c_MetricUnits.pt,t.metricName=["Cm","Pt","Inch"],t.defaultMetric=t.c_MetricUnits.cm,{c_MetricUnits:t.c_MetricUnits,txtCm:"cm",txtPt:"pt",txtInch:'"',setCurrentMetric:function(e){t.currentMetric=e},getCurrentMetric:function(){return t.currentMetric},getCurrentMetricName:function(){return this["txt"+t.metricName[t.currentMetric]]},getMetricName:function(e){return this["txt"+t.metricName[void 0!==e?e:0]]},setDefaultMetric:function(e){t.defaultMetric=e},getDefaultMetric:function(){return t.defaultMetric},fnRecalcToMM:function(e){if(null!=e)switch(t.currentMetric){case t.c_MetricUnits.cm:return 10*e;case t.c_MetricUnits.pt:return 25.4*e/72;case t.c_MetricUnits.inch:return 25.4*e}return e},fnRecalcFromMM:function(e){switch(t.currentMetric){case t.c_MetricUnits.cm:return parseFloat((e/10).toFixed(4));case t.c_MetricUnits.pt:return parseFloat((72*e/25.4).toFixed(3));case t.c_MetricUnits.inch:return parseFloat((e/25.4).toFixed(3))}return e}}};Common.Utils.Metric=_extend_object(metrics,Common.Utils.Metric),Common.Utils.RGBColor=function(t){var e,i,o;"#"==t.charAt(0)&&(t=t.substr(1,6)),t=(t=t.replace(/ /g,"")).toLowerCase();for(var n=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,process:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},{re:/^hsb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,process:function(t){var e={},i=Math.round(t[1]),o=Math.round(255*t[2]/100),n=Math.round(255*t[3]/100);if(0==o)e.r=e.g=e.b=n;else{var s=n,a=(255-o)*n/255,r=i%60*(s-a)/60;360==i&&(i=0),i<60?(e.r=s,e.b=a,e.g=a+r):i<120?(e.g=s,e.b=a,e.r=s-r):i<180?(e.g=s,e.r=a,e.b=a+r):i<240?(e.b=s,e.r=a,e.g=s-r):i<300?(e.b=s,e.g=a,e.r=a+r):i<360?(e.r=s,e.g=a,e.b=s-r):(e.r=0,e.g=0,e.b=0)}return[Math.round(e.r),Math.round(e.g),Math.round(e.b)]}},{re:/^(\w{2})(\w{2})(\w{2})$/,process:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,process:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}}],s=0;s<n.length;s++){var a=n[s].re,r=n[s].process,l=a.exec(t);if(l){var c=r(l);e=c[0],i=c[1],o=c[2]}}e=e<0||isNaN(e)?0:e>255?255:e,i=i<0||isNaN(i)?0:i>255?255:i,o=o<0||isNaN(o)?0:o>255?255:o;return{r:e,g:i,b:o,isEqual:function(t){return e==t.r&&i==t.g&&o==t.b},toRGB:function(){return"rgb("+e+", "+i+", "+o+")"},toRGBA:function(t){return void 0===t&&(t=1),"rgba("+e+", "+i+", "+o+", "+t+")"},toHex:function(){var t=e.toString(16),n=i.toString(16),s=o.toString(16);return 1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),1==s.length&&(s="0"+s),"#"+t+n+s},toHSB:function(){var t={h:0,s:0,b:0},n=Math.min(e,i,o),s=Math.max(e,i,o),a=s-n;return t.b=s,t.s=0!=s?255*a/s:0,0!=t.s?t.h=e==s?0+(i-o)/a:i==s?2+(o-e)/a:4+(e-i)/a:t.h=0,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t.h=parseInt(t.h),t.s=parseInt(t.s),t.b=parseInt(t.b),t},isDark:function(){return Math.sqrt(e*e*.299+i*i*.587+o*o*.114)<140}}};var utilsString=new function(){return{textCtrl:"Ctrl",textShift:"Shift",textAlt:"Alt",textComma:",",format:function(t){var e=_.toArray(arguments).slice(1);return e.length&&"object"==_typeof(e[0])&&(e=e[0]),t.replace(/\{(\d+)\}/g,(function(t,i){return e[i]}))},htmlEncode:function(t){return"undefined"!=typeof _?_.escape(t):t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},htmlDecode:function(t){return _.unescape(t)},ellipsis:function(t,e,i){if(t&&t.length>e){if(i){var o=t.substr(0,e-2),n=Math.max(o.lastIndexOf(" "),o.lastIndexOf("."),o.lastIndexOf("!"),o.lastIndexOf("?"));if(-1!==n&&n>=e-15)return o.substr(0,n)+"..."}return t.substr(0,e-3)+"..."}return t},platformKey:function(t,e,i){return _.isEmpty(e)&&(e=" ({0})"),Common.Utils.isMac?(_.isFunction(i)&&(t=i.call(this,t)),Common.Utils.String.format(e,t.replace(/\+(?=\S)/g,"").replace(/Ctrl|ctrl/g,"⌘").replace(/Alt|alt/g,"⌥").replace(/Shift|shift/g,"⇧"))):Common.Utils.String.format(e,t.replace(/Ctrl|ctrl/g,this.textCtrl).replace(/Alt|alt/g,this.textAlt).replace(/Shift|shift/g,this.textShift))},parseFloat:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return"string"==typeof t&&(t=t.replace(",",".")),parseFloat(t)})),encodeSurrogateChar:function(t){if(t<65536)return String.fromCharCode(t);var e=55296|(t-=65536)>>10,i=56320|1023&t;return String.fromCharCode(e)+String.fromCharCode(i)},fixedDigits:function(t,e,i){void 0===i&&(i="0");for(var o="",n=t.toString(),s=n.length;s<e;s++)o+=i;return o+n}}};Common.Utils.String=_extend_object(utilsString,Common.Utils.String),Common.Utils.isBrowserSupported=function(){return!(0!=Common.Utils.ieVersion&&Common.Utils.ieVersion<10||0!=Common.Utils.safariVersion&&Common.Utils.safariVersion<5||0!=Common.Utils.firefoxVersion&&Common.Utils.firefoxVersion<4||0!=Common.Utils.chromeVersion&&Common.Utils.chromeVersion<7||0!=Common.Utils.operaVersion&&Common.Utils.operaVersion<10.5)},Common.Utils.showBrowserRestriction=function(){if(!(document.getElementsByClassName&&document.getElementsByClassName("app-error-panel").length>0)){var t=window.DE?"Document":window.SSE?"Spreadsheet":window.PE?"Presentation":window.PDFE?"PDF":window.VE?"Visio":"that",e=document.createElement("div");e.innerHTML='<div class="app-error-panel"><div class="message-block"><div class="message-inner"><div class="title">Your browser is not supported.</div><div class="text">Sorry, '+t+' Editor is currently only supported in the latest versions of the Chrome, Firefox, Safari or Internet Explorer web browsers.</div></div></div><div class="message-auxiliary"></div></div>',document.body.appendChild(e),$("#loading-mask").hide().remove(),$("#viewport").hide().remove()}},Common.Utils.applyCustomization=function(t,e){for(var i in t){var o;if(e[i]&&(o=$(e[i])).length){var n=t[i];!1===n||!1===n.visible?o.hide():(n.text&&o.text(n.text),!1===n.visible&&o.hide())}}},Common.Utils.applyCustomizationPlugins=function(plugins){if(plugins&&!(plugins.length<1)){var _createXMLHTTPObject=function(){var t;if("undefined"!=typeof XMLHttpRequest)t=new XMLHttpRequest;else try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}}return t},_getPluginCode=function _getPluginCode(url){if(!url)return"";try{var xhrObj=_createXMLHTTPObject();xhrObj&&url&&(xhrObj.open("GET",url,!1),xhrObj.send(""),200==xhrObj.status&&eval(xhrObj.responseText))}catch(t){}return null};plugins.forEach((function(t){t&&_getPluginCode(t)}))}},Common.Utils.fillUserInfo=function(t,e,i,o){var n=t||{};return n.anonymous=!n.id,!n.id&&(n.id=o),n.fullname=n.name?n.name:i,n.group&&(n.fullname=n.group.toString()+AscCommon.UserInfoParser.getSeparator()+n.fullname),n.guest=!n.name,n},Common.Utils.createXhr=function(){var t;if("undefined"!=typeof XMLHttpRequest)t=new XMLHttpRequest;else try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}}return t},Common.Utils.getConfigJson=function(t){if(t)try{var e=Common.Utils.createXhr();if(e)return e.open("GET",t,!1),e.send(""),JSON.parse(e.responseText)}catch(t){}return null},Common.Utils.loadConfig=function(t,e){fetch(t,{method:"get",headers:{Accept:"application/json"}}).then((function(t){return t.ok?t.json():"error"})).then((function(t){e(t)})).catch((function(t){e("error")}))},Common.Utils.asyncCall=function(t,e,i){new Promise((function(t,e){t()})).then((function(){t.call(e,i)}))},String.prototype.strongMatch=function(t){if(t&&t instanceof RegExp){var e=this.toString().match(t);return!!(e&&e.length>0&&e[0].length==this.length)}return!1},Common.Utils.InternalSettings=new function(){var t={};return{get:function(e){return t[e]},set:function(e,i){t[e]=i}}},Common.Utils.lockControls=function(t,e,i,o){!i&&(i={});var n=i.array||o;function s(t,i){if(t&&t.options&&_.contains(t.options.lock,i)){var o=t.keepState.indexOf(i);e?o<0&&t.keepState.push(i):o<0||t.keepState.splice(o,1)}}i.merge&&(n=_.union(o,n)),_.each(n,(function(e){e&&_.isFunction(e.setDisabled)&&(!e.keepState&&(e.keepState=[]),i.clear&&i.clear.length>0&&e.keepState.length>0&&(e.keepState=_.difference(e.keepState,i.clear)),_.isArray(t)?_.each(t,(function(t){s(e,t)})):s(e,t),e.keepState.length>0?!e.isDisabled()&&e.setDisabled(!0):e.isDisabled()&&e.setDisabled(!1))}))},Common.Utils.injectButtons=function(t,e,i,o,n,s,a,r,l,c,h,d,m){var p=createButtonSet();return p.setDisabled(!0),e=e||"id-toolbar-"+i,t.each((function(u,g){var f="btn-toolbar";/x-huge/.test(g.className)&&(f+=" x-huge icon-top");var b=new Common.UI.Button({parentEl:t.eq(u),id:e+u,cls:f,iconCls:i,caption:o,split:s||!1,menu:a||!1,enableToggle:r||!1,lock:n,disabled:!0,action:m,dataHint:l,dataHintDirection:c,dataHintOffset:h,dataHintTitle:d});p.add(b)})),p},Common.Utils.injectComponent=function(t,e){e&&t.length&&(e.rendered?t.append(e.$el):e.render(t))},Common.Utils.startFullscreenForElement=function(t){t&&(t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen())},Common.Utils.cancelFullscreen=function(){(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)&&(document.cancelFullScreen?document.cancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen())},Common.Utils.warningDocumentIsLocked=function(t){t.disablefunc&&t.disablefunc(!0);var e=window.DE||window.PE||window.SSE||window.PDFE||window.VE;Common.UI.warning({msg:Common.Locale.get("warnFileLocked",{name:"Common.Translation",default:"You can't edit this file. Document is in use by another application."}),buttons:[{value:"view",caption:Common.Locale.get("warnFileLockedBtnView",{name:"Common.Translation",default:"Open for viewing"})},{value:"edit",caption:Common.Locale.get("warnFileLockedBtnEdit",{name:"Common.Translation",default:"Create a copy"})}],primary:"view",callback:function(i){"edit"==i&&(t.disablefunc&&t.disablefunc(!1),e.getController("Main").api.asc_setLocalRestrictions(Asc.c_oAscLocalRestrictionType.None))}})},jQuery.fn.extend({elementById:function(t,e){var i=document.getElementById(t.substring(1));if(!i)if((e=e||this)&&e.length>0)e.each((function(e,o){if(o.querySelectorAll)if(0==(i=o.querySelectorAll(t)).length){if("#"+o.id==t)return i=o,!1}else if(i.length)return i=i[0],!1}));else if(e&&e.querySelectorAll&&(i=e.querySelectorAll(t))&&i.length)return i[0];return i},findById:function(t,e){var i=$.fn.elementById.apply(this,arguments);return i?$(i):$()}}),Common.Utils.InternalSettings.set("toolbar-height-tabs",32),Common.Utils.InternalSettings.set("toolbar-height-tabs-top-title",28),Common.Utils.InternalSettings.set("toolbar-height-controls",parseInt(window.getComputedStyle(document.body).getPropertyValue("--toolbar-height-controls")||(Common.Utils.isIE?66:84))),Common.Utils.InternalSettings.set("document-title-height",28),Common.Utils.InternalSettings.set("window-inactive-area-top",0),Common.Utils.InternalSettings.set("toolbar-height-compact",Common.Utils.InternalSettings.get("toolbar-height-tabs")),Common.Utils.InternalSettings.set("toolbar-height-normal",Common.Utils.InternalSettings.get("toolbar-height-tabs")+Common.Utils.InternalSettings.get("toolbar-height-controls")),Common.Utils.ModalWindow=new function(){var t=0;return{show:function(){t++},close:function(){t--},isVisible:function(){return t>0}}},Common.Utils.UserInfoParser=new function(){var t=!1,e=String.fromCharCode(160);return{setParser:function(e){t=!!e},getSeparator:function(){return e},getParsedName:function(i){return t&&i?i.substring(i.indexOf(e)+1):i},getParsedGroups:function(i){if(t&&i){for(var o=i.indexOf(e),n=o>-1?i.substring(0,o).split(","):[],s=0;s<n.length;s++)n[s]=n[s].trim();return n}}}},Common.Utils.getUserInitials=function(t){for(var e=t.split(" "),i=e[0].substring(0,1).toUpperCase(),o=e.length-1;o>0;o--)if("("!==e[o][0]&&")"!==e[o][0]){/[\u0600-\u06FF]/.test(i)&&(i+=" "),i+=e[o].substring(0,1).toUpperCase();break}return i},Common.Utils.getKeyByValue=function(t,e){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e)return i},Common.Utils.checkComponentLoaded=function(t){return"function"==typeof t},!Common.UI&&(Common.UI={}),Common.UI.isRTL=function(){return void 0===window.isrtl&&(window.nativeprocvars&&void 0!==window.nativeprocvars.rtl?window.isrtl=window.nativeprocvars.rtl:window.isrtl=!Common.Utils.isIE&&Common.Locale.isCurrentLanguageRtl()),window.isrtl},Common.UI.iconsStr2IconsObj=function(t){if("string"!=typeof t)return t;var e={"theme-name":{origin:"",values:[""]},"theme-type":{origin:"",values:[""]},state:{origin:"",values:["normal"]},scale:{origin:"",values:[]},extension:{origin:"",values:[]}},i="",o=function(o){var n=t.indexOf("%"+o+"%");if(-1!==n){var s=n+o.length+2,a=t.indexOf("(",s);if(a==s){var r=t.indexOf(")",a);e[o].origin=t.substring(n,r+1),e[o].values=t.substring(a+1,r).split("|"),"scale"===o&&n>0&&47==t.charCodeAt(n-1)&&(i="icon")}}};for(var n in e)o(n);for(var s=0,a=e.scale.values.length;s<a;s++)"default"===e.scale.values[s]&&e.scale.values.splice(s,1,"100","125","150","175","200");for(var r="",l=!1,c=0,h=e.extension.values.length;c<h;c++)"svg"===e.extension.values[c]?l=!0:r=e.extension.values[c];l&&""===r&&(r="svg");for(var d=[],m=0,p=e["theme-name"].values.length;m<p;m++)for(var u=e["theme-name"].values[m],g=0,f=e["theme-type"].values.length;g<f;g++){var b=t,C=e["theme-type"].values[g],v={};""!==u&&(v.theme=u),""!==C&&(v.style=C),""!=e["theme-name"].origin&&(b=b.replaceAll(e["theme-name"].origin,u)),""!=e["theme-type"].origin&&(b=b.replaceAll(e["theme-type"].origin,C));var _=e.scale.values.length;0==_&&(e.scale.values.push("100"),_++);for(var w=0;w<_;w++){var A=e.scale.values[w],y=!1;A.length>0?"*"===A?y=!0:"%"===A.charAt(A.length-1)&&(A=A.substring(0,A.length-1)):(y=!0,A="*");var S="";if(!y){var x=parseInt(A);if(100!==x){var k=x%100;S="@"+(x/100>>0),0!==k&&(0==k%10&&(k/=10),S+="."+k),S+="x"}A+="%"}var T=b;""!=e.scale.origin&&(T=T.replaceAll(e.scale.origin,i+S)),""!=e.extension.origin&&(T=T.replaceAll(e.extension.origin,y&&l?"svg":r)),v[A]={};for(var I=0,E=e.state.values.length;I<E;I++){var P=e.state.values[I];if(""!==e.state.origin)if("normal"===P){var D=T.indexOf(e.state.origin);v[A][P]=T.replace(e.state.origin,""),"/"==v[A][P].charAt(D)&&(v[A][P]=v[A][P].substring(0,D)+v[A][P].substring(D+1))}else v[A][P]=T.replace(e.state.origin,"_"+P);else v[A][P]=T}}d.push(v)}return d},Common.UI.getSuitableIcons=function(t){if(t){if((t=Common.UI.iconsStr2IconsObj(t)).length&&"string"!=typeof t[0]){for(var e=Common.UI.Themes.currentThemeId().toLowerCase(),i=Common.UI.Themes.isDarkTheme()?"dark":"light",o=-1,n=0;n<t.length;n++)if(t[n].theme&&t[n].theme.toLowerCase()==e){o=n;break}if(o<0)for(n=0;n<t.length;n++)if(t[n].style&&t[n].style.toLowerCase()==i){o=n;break}o<0&&(o=0);var s,a,r=100*Common.Utils.applicationPixelRatio(),l=t[o],c=1e4,h=0;for(var d in l)l.hasOwnProperty(d)&&("default"==d?s=l[d]:isNaN(parseInt(d))||(h=Math.abs(r-parseInt(d)))<c-.01&&(c=h,a=l[d]));return c>.01&&s&&(a=s),{normal:a?a.normal:"",hover:a?a.hover||a.normal:"",active:a?a.active||a.normal:""}}var m=t[(Common.Utils.applicationPixelRatio()>1&&t.length>1?1:0)+(t.length>2?2:0)];return{normal:m,hover:m,active:m}}},Common.UI.simpleColorsConfig={colors:["1755A0","D43230","F5C346","EA3368","12A489","552F8B","9D1F87","BB2765","479ED2","67C9FA","3D8A44","80CA3D","1C19B4","7F4B0F","FF7E07","FFFFFF","D3D3D4","879397","575757","000000"],dynamiccolors:5,themecolors:0,effects:0,columns:5,cls:"palette-large",paletteWidth:174},Common.UI.isValidNumber=function(t){var e=new RegExp("^s*[+-]?([0-9]+([.][0-9]*)?|[.][0-9]+)s*$");if("string"==typeof t){var i=t.match(/,/g);i&&1===i.length&&(t=t.replace(",","."))}return"number"==typeof t||!(""===t||!e.test(t.trim())||isNaN(parseFloat(t)))}})),function(t){var e,i,o,n={},s={16:!1,18:!1,17:!1,91:!1},a="all",r={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},l={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220,"ff-":173,"ff=":61,numplus:107,numminus:109,0:48},c=function(t){return l[t]||t.toUpperCase().charCodeAt(0)},h=[];for(e=1;e<20;e++)l["f"+e]=111+e;function d(t,e){for(var i=t.length;i--;)if(t[i]===e)return i;return-1}function m(t,e){if(t.length!=e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}var p={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function u(t){for(e in s)s[e]=t[p[e]]}function g(t,e,i){var o,s;o=b(t),void 0===i&&(i=e,e="all");for(var a=0;a<o.length;a++)s=[],(t=o[a].split("+")).length>1&&(s=C(t),t=[t[t.length-1]]),t=t[0],(t=c(t))in n||(n[t]=[]),n[t].push({shortcut:o[a],scope:e,method:i,key:o[a],mods:s})}for(e in r)g[e]=!1;function f(){return a||"all"}function b(t){var e;return""==(e=(t=t.replace(/\s/g,"")).split(","))[e.length-1]&&(e[e.length-2]+=","),e}function C(t){for(var e=t.slice(0,t.length-1),i=0;i<e.length;i++)e[i]=r[e[i]];return e}function v(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,(function(){i(window.event)}))}v(document,"keydown",(function(t){!function(t){var e,a,l,c,m,p;if(e=t.keyCode,Common.UI.HintManager&&Common.UI.HintManager.isHintVisible())if(112===e)Common.UI.HintManager.clearHints();else if(27!==e)return;if(-1==d(h,e)&&h.push(e),93!=e&&224!=e||(e=91),e in s)for(l in s[e]=!0,r)r[l]==e&&(g[l]=!0);else if(u(t),g.filter.call(this,t)&&e in n)for(p=f(),c=0;c<n[e].length;c++)if((a=n[e][c]).scope==p||"all"==a.scope){for(l in m=a.mods.length>0,s)(!s[l]&&d(a.mods,+l)>-1||s[l]&&-1==d(a.mods,+l))&&(m=!1);if((0==a.mods.length&&!s[16]&&!s[18]&&!s[17]&&!s[91]||m)&&(!0===i||a.locked||!1===a.method(t,a))){if(!0===i&&o||a.locked&&a.propagate)continue;t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)}}}(t)})),v(document,"keyup",(function(t){var e,i=t.keyCode,o=d(h,i);if(o>=0&&h.splice(o,1),93!=i&&224!=i||(i=91),i in s)for(e in s[i]=!1,r)r[e]==i&&(g[e]=!1)})),v(window,"focus",(function(){for(e in s)s[e]=!1;for(e in r)g[e]=!1}));var _=t.key;function w(t,e,i,o){for(var s,a,r,l=[],h=b(t),d=h.length;d--;)if((s=h[d].split("+")).length>1&&(l=C(s)),s.length>0&&(t=s[s.length-1]),t=c(t),void 0===e&&(e=f()),n[t])for(a in n[t])(r=n[t][a]).scope===e&&m(r.mods,l)&&(n[t][a][i]=o)}t.key=g,t.key.setScope=function(t){a=t||"all"},t.key.getScope=f,t.key.deleteScope=function(t){var e,i,o;for(e in n)for(i=n[e],o=0;o<i.length;)i[o].scope===t?i.splice(o,1):o++},t.key.filter=function(t){var e=(t.target||t.srcElement).tagName;return!("INPUT"==e||"SELECT"==e||"TEXTAREA"==e)},t.key.isPressed=function(t){return"string"==typeof t&&(t=c(t)),-1!=d(h,t)},t.key.getPressedKeyCodes=function(){return h.slice(0)},t.key.noConflict=function(){var e=t.key;return t.key=_,e},t.key.unbind=function(t,e){var i,o,s,a,r,l=[];for(i=b(t),a=0;a<i.length;a++){if((o=i[a].split("+")).length>1&&(l=C(o)),o.length>0&&(t=o[o.length-1]),t=c(t),void 0===e&&(e=f()),!n[t])return;for(s in n[t])(r=n[t][s]).scope===e&&m(r.mods,l)&&(n[t][s]={})}},t.key.suspend=function(t,e,n){t?(w(t,e,"locked",!0),n&&w(t,e,"propagate",!0)):(i=!0,n&&(o=!0))},t.key.resume=function(t,e){t?(w(t,e,"locked",!1),w(t,e,"propagate",!1)):i=o=!1},"undefined"!=typeof module&&(module.exports=key)}(this),define("keymaster",(function(){})),void 0===Common)var Common={};function onDropDownKeyDown(t){var e=$(this),i=e.parent(),o=jQuery.Event("keydown.before.bs.dropdown",{keyCode:t.keyCode}),n=jQuery.Event("keydown.after.bs.dropdown",{keyCode:t.keyCode});i.trigger(o),i.hasClass("no-stop-propagate")?(arguments.length>1&&arguments[1]instanceof KeyboardEvent&&(t=arguments[1]),!/^(38|40|27|13|9|37|39)$/.test(t.keyCode)||t.ctrlKey||t.altKey||(patchDropDownKeyDownAdditional.call(this,t),/(37|39)/.test(t.keyCode)||(t.preventDefault(),t.stopPropagation()))):e.hasClass("move-focus")?(!/^(13|9|32)/.test(t.keyCode)&&(27!==t.keyCode||i.hasClass("open"))||t.ctrlKey||t.altKey)&&(patchDropDownKeyDown.call(this,t),t.preventDefault(),t.stopPropagation()):(patchDropDownKeyDown.call(this,t),t.preventDefault(),t.stopPropagation()),i.trigger(n)}function checkFocusedItem(t,e){var i=t.innerHeight(),o=(i-t.height())/2,n=Common.Utils.getPosition(e).top,s=e.outerHeight();n<0?t.scrollTop(t.scrollTop()+n-o):n+s>i&&t.scrollTop(t.scrollTop()+n+s-i+o)}function patchDropDownKeyDown(t){if(/(38|40|27|37|39)/.test(t.keyCode)){var e=$(this);if(t.preventDefault(),t.stopPropagation(),!e.is(".disabled, :disabled")){var i=getParent(e),o=i.hasClass("open")||i.hasClass("over");if(!o||o&&27==t.keyCode){if(27==t.which){if((n=$("[role=menu] li.dropdown-submenu.over:visible",i)).length)return n.eq(n.length-1).removeClass("over"),!1;i.hasClass("dropdown-submenu")&&i.hasClass("over")?(i.removeClass("over"),i.find("> a").focus()):i.find("[data-toggle=dropdown]").focus()}return o?e.click():void 0}var n=$("> [role=menu] > li:not(.divider):not(.disabled):visible",i).find("> a");if(n.length){var s=n.index(n.filter(":focus"));if(39==t.keyCode){if(s<0)return;var a=n.eq(s).parent();a.hasClass("dropdown-submenu")&&!a.hasClass("over")&&(a.mouseenter(),a.addClass("focused-submenu"),_.delay((function(){var t=$("> [role=menu]",a),e=t.find("> li:not(.divider):not(.disabled):visible > a"),i=t.find("> li:not(.divider):not(.disabled):visible .dataview"),o=t.find("> li:not(.divider):not(.disabled):visible .theme-colorpalette.focused"),n=t.find("> li:not(.divider):not(.disabled):visible ul.internal-menu");e.length>0&&i.length<1&&n.length<1&&o.length<1&&e.index(e.filter(":focus"))<0&&e.eq(0).focus()}),250))}else 37==t.keyCode?i.hasClass("dropdown-submenu")&&i.hasClass("over")&&(i.removeClass("over"),i.find("> a").focus()):(38==t.keyCode?s>0?s--:s=e.hasClass("no-cyclic")?0:n.length-1:40==t.keyCode&&(s<n.length-1?s++:s=e.hasClass("no-cyclic")?n.length-1:0),~s||(s=0),i.hasClass("dropdown-submenu")&&i.hasClass("over")&&i.addClass("focused-submenu"),checkFocusedItem(e,n.eq(s)),n.eq(s).focus())}}}}function patchDropDownKeyDownAdditional(t){if(/(38|40|27|37|39)/.test(t.keyCode)){var e=$(this);if(/(37|39)/.test(t.keyCode)||(t.preventDefault(),t.stopPropagation()),!e.is(".disabled, :disabled")){var i=getParent(e),o=i.hasClass("open")||i.hasClass("over");if(!o||o&&(27==t.keyCode||37==t.keyCode||39==t.keyCode))return o?e.click():void 0;var n=$("> [role=menu] > li:not(.divider):not(.disabled):visible",i).find("> a");if(n.length){var s=n.index(n.filter(".focus")),a=s;if(38==t.keyCode?s>0?s--:s=e.hasClass("no-cyclic")?0:n.length-1:40==t.keyCode&&(s<n.length-1?s++:s=e.hasClass("no-cyclic")?n.length-1:0),~s||(s=0),n.removeClass("focus"),n.eq(s).addClass("focus"),a!==s){var r=n.eq(a).parent().data("bs.tooltip");r&&r.hide(),(r=n.eq(s).parent().data("bs.tooltip"))&&r.show()}}}}}function getParent(t){var e=t.attr("data-target");e||(e=(e=t.attr("href"))&&/#/.test(e)&&e.replace(/.*(?=#[^\s]*$)/,""));var i=e&&$(e);return i&&i.length?i:t.parent()}function clearMenus(t){$(".dropdown-toggle").each((function(e){var i=$(this).parent();i.hasClass("open")&&("prevent-canvas-click"!=i.attr("data-value")?(i.trigger(e=$.Event("hide.bs.dropdown")),e.isDefaultPrevented()||i.removeClass("open").trigger("hidden.bs.dropdown",t)):i.attr("data-value",""))}))}function toggle(){$(".dropdown-backdrop").remove()}if(Common.util=Common.util||{},define("common/main/lib/util/Shortcuts",["backbone","keymaster","notification"],(function(t){"use strict";var e=function(t){return this.cid=_.uniqueId("shortcuts"),this.initialize.apply(this,arguments),this};_.extend(e.prototype,t.Events,{initialize:function(){window.key.filter=function(t){return!0},Common.NotificationCenter.on({"modal:show":function(t){window.key.suspend()},"modal:close":function(t,e){e&&window.key.resume()},"modal:hide":function(t,e){e&&window.key.resume()}})},delegateShortcuts:function(t){if(t&&t.shortcuts){var e,i,o,n,s,a;this.removeShortcuts(t);var r=[];for(s in t.shortcuts){if(e=t.shortcuts[s],_.isFunction(e))o=e;else if(!(o=t[e]))throw new Error("Method "+e+" does not exist");a=(i=s.match(/^(\S+)\s*(.*)$/))[1],n=i[2].length?i[2]:"all",o=_.bind(o,this),r.push(window.key(a,n,o))}}},removeShortcuts:function(t){if(t&&t.shortcuts){var e,i,o,n;for(o in t.shortcuts)n=(e=o.match(/^(\S+)\s*(.*)$/))[1],i=e[2].length?e[2]:"all",window.key.unbind(n,i)}},suspendEvents:function(t,e,i){window.key.suspend(t,e,i)},resumeEvents:function(t,e){window.key.resume(t,e)}}),e.extend=t.View.extend,Common.util.Shortcuts=new e})),$(document).off("keydown.bs.dropdown.data-api").on("keydown.bs.dropdown.data-api","[data-toggle=dropdown], [role=menu]",onDropDownKeyDown),"ontouchstart"in document.documentElement&&$(document).on("click.bs.dropdown.data-api","[data-toggle=dropdown]",toggle),function(){var t,e=$._data($(document).get(0),"events");e&&e.click&&e.click.every((function(e,i,o){return/click/.test(e.type)&&!e.selector&&/bs\..+\.dropdown/.test(e.namespace)&&(t=e.handler),!t})),t&&$(document).off("click.bs.dropdown.data-api",t).on("click.bs.dropdown.data-api",(function(t){1!=t.which&&null!=t.which||clearMenus(/form-control/.test(t.target.className))}))}(),define("common/main/lib/extend/Bootstrap",(function(){})),void 0===Common)var Common={};if(define("common/main/lib/component/MenuItem",["common/main/lib/component/BaseView","common/main/lib/component/ToggleManager"],(function(){"use strict";Common.UI.MenuItem=Common.UI.BaseView.extend({options:{id:null,cls:"",style:"",hint:!1,checkable:!1,checked:!1,allowDepress:!1,disabled:!1,visible:!0,value:null,toggleGroup:null,iconCls:"",menu:null,canFocused:!0,dataHint:"",dataHintDirection:"",dataHintOffset:"",dataHintTitle:"",scaling:!0,header:""},tagName:"li",template:_.template(['<% if (header) { %><span class="menu-item-header"><%- header %></span><% } %><% if (caption) { %><a id="<%= id %>" class="menu-item" <% if (_.isEmpty(iconCls)) { %> data-no-icon <% } %> style="<%= style %>" <% if(options.canFocused) { %> tabindex="-1" type="menuitem" <% }; if(!_.isUndefined(options.stopPropagation)) { %> data-stopPropagation="true" <% }; if(!_.isUndefined(options.dataHint)) { %> data-hint="<%= options.dataHint %>" <% }; if(!_.isUndefined(options.dataHintDirection)) { %> data-hint-direction="<%= options.dataHintDirection %>" <% }; if(!_.isUndefined(options.dataHintOffset)) { %> data-hint-offset="<%= options.dataHintOffset %>" <% }; if(options.dataHintTitle) { %> data-hint-title="<%= options.dataHintTitle %>" <% }; %> >',"<% if (!_.isEmpty(iconCls)) { %>",'<span class="menu-item-icon <%= iconCls %>"></span>',"<% } else if (!_.isEmpty(iconImg)) { %>",'<img src="<%= iconImg %>" class="menu-item-icon">',"<% } %>","<%- caption %>","</a>","<% } %>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=e.options.id||Common.UI.getId(),this.cls=e.options.cls,this.style=e.options.style,this.caption=e.options.caption,this.menu=e.options.menu||null,this.checkable=e.options.checkable,this.checked=e.options.checked,e.allowDepress=e.options.allowDepress,this.disabled=e.options.disabled,this.visible=e.options.visible,this.value=e.options.value,this.toggleGroup=e.options.toggleGroup,this.template=e.options.template||this.template,this.iconCls=e.options.iconCls,this.iconImg=e.options.iconImg,this.hint=e.options.hint,this.rendered=!1,this.header=e.options.header,null===this.menu||this.menu instanceof Common.UI.Menu||this.menu instanceof Common.UI.MenuSimple||(this.menu=new Common.UI.Menu(_.extend({},e.options.menu))),e.options.el&&this.render()},render:function(){var t=this,e=t.$el||$(this.el);if(t.cmpEl=e,t.trigger("render:before",t),"--"===t.caption)e.addClass("divider");else if(!this.rendered){e.off("click"),Common.UI.ToggleManager.unregister(t),e.html(this.template({id:t.id,caption:t.caption,iconCls:t.iconCls,iconImg:t.iconImg,style:t.style,options:t.options,header:t.header})),t.menu&&(e.addClass("dropdown-submenu"),t.menu.render(e),e.mouseenter(_.bind(t.menu.alignPosition,t.menu)),e.focusout(_.bind(t.onBlurItem,t)),e.hover(_.bind(t.onHoverItem,t),_.bind(t.onUnHoverItem,t)));var i=e.children(":first");this.checkable&&i&&(i.toggleClass("checkable",this.checkable),i.toggleClass("no-checkmark",!1===this.options.checkmark),i.toggleClass("checked",this.checked),_.isEmpty(this.iconCls)||i.css("background-image","none")),t.options.hint&&(e.attr("data-toggle","tooltip"),e.tooltip({title:t.options.hint,placement:t.options.hintAnchor||function(t,e){var i=Common.Utils.getBoundingClientRect(e),o=t.offsetWidth,n=t.offsetHeight,s=Common.Utils.innerWidth(),a=Common.Utils.innerHeight(),r=i.top,l=i.left+i.width+2;r+n>a&&(r=a-n-2),l+o>s&&(l=i.left-o-2),Common.Utils.setOffset($(t),{top:r,left:l}).addClass("in")}})),this.cls&&e.addClass(this.cls),this.disabled&&e.toggleClass("disabled",this.disabled),e.on("click",_.bind(this.onItemClick,this)),e.on("mousedown",_.bind(this.onItemMouseDown,this)),Common.UI.ToggleManager.register(t),!1!==t.options.scaling&&t.iconCls&&(e.attr("ratio","ratio"),t.applyScaling(Common.UI.Scaling.currentRatio()),e.on("app:scaling",(function(e,i){t.options.scaling!=i.ratio&&t.applyScaling(i.ratio)})))}return this.visible||this.setVisible(this.visible),t.rendered=!0,t.trigger("render:after",t),this},setCaption:function(t){this.caption=t,this.rendered&&(this.cmpEl.find("> a").contents().last()[0].textContent=t)},setIconCls:function(t){if(this.rendered&&!_.isEmpty(this.iconCls)){var e=this.cmpEl.children(":first");if(e){e.find(".menu-item-icon").removeClass(this.iconCls).addClass(t);var i=e.find("use.zoom-int");if(i.length){var o=/btn-[^\s]+/.exec(t),n=o?o[0]:"null";i.attr("href","#"+n)}}}this.iconCls=t},setChecked:function(t,e){this.toggle(t,e)},isChecked:function(){return this.checked},setDisabled:function(t){this.disabled=!!t,this.rendered&&this.cmpEl.toggleClass("disabled",this.disabled)},isDisabled:function(){return this.disabled},toggle:function(t,e){var i=void 0===t?!this.checked:!!t;if(this.checkable){if(this.checked=i,this.rendered){var o=this.cmpEl.children(":first");o&&(o.toggleClass("checked",this.checked),_.isEmpty(this.iconCls)||o.css("background-image","none"))}e||this.trigger("toggle",this,i)}},onItemMouseDown:function(t){if(Common.UI.HintManager&&Common.UI.HintManager.isHintVisible()&&Common.UI.HintManager.clearHints(!1,!0),1!=t.which)return t.preventDefault(),t.stopPropagation(),!1;t.stopPropagation()},onItemClick:function(t){return(1==t.which||void 0===t.which&&!this.menu)&&(this.disabled||!this.allowDepress&&this.checked&&this.toggleGroup||this.menu||this.setChecked(!this.checked),this.menu?t.target.id==this.id?(this._doHover(t),!1):void(this.menu.isOver||this.cmpEl.removeClass("over")):!this.disabled&&void this.trigger("click",this,t))},onHoverItem:function(t){this._doHover(t)},onUnHoverItem:function(t){this._doUnHover(t)},onBlurItem:function(t){this._doUnHover(t)},_doHover:function(t){var e=this;e.menu&&!e.disabled&&(clearTimeout(e.hideMenuTimer),e.cmpEl.trigger("show.bs.dropdown"),e.expandMenuTimer=_.delay((function(){e.cmpEl.addClass("over"),e.cmpEl.trigger("shown.bs.dropdown")}),200))},_doUnHover:function(t){var e=this;if(e.cmpEl.hasClass("dropdown-submenu")&&e.cmpEl.hasClass("over")&&(t&&t.relatedTarget&&e.cmpEl.find(t.relatedTarget).length>0||e.cmpEl.hasClass("focused-submenu")))e.cmpEl.removeClass("focused-submenu");else if(e.menu&&!e.disabled&&(clearTimeout(e.expandMenuTimer),e.hideMenuTimer=_.delay((function(){e.menu.isOver||e.cmpEl.removeClass("over")}),200),t&&"focusout"!==t.type)){var i=e.cmpEl.children(":focus");i.length>0&&(i.blur(),e.cmpEl.closest("ul").focus())}},setMenu:function(t){if(t&&_.isObject(t)&&_.isFunction(t.render))if(this.rendered){this.menu&&(this.menu instanceof Common.UI.Menu||this.menu instanceof Common.UI.MenuSimple)&&(Common.UI.Menu.Manager.unregister(this.menu),this.menu.cmpEl&&this.menu.cmpEl.remove()),this.menu=t;var e=this.cmpEl;e.addClass("dropdown-submenu"),this.menu.render(e),e.mouseenter(_.bind(this.menu.alignPosition,this.menu)),e.focusout(_.bind(this.onBlurItem,this)),e.hover(_.bind(this.onHoverItem,this),_.bind(this.onUnHoverItem,this))}else this.menu=t},applyScaling:function(t){var e=this;if(e.options.scaling!=t){e.options.scaling=t;var i=this.cmpEl.children(":first");if(t>2&&!i.find("svg.menu-item-icon").length){var o=e.iconCls,n=/btn-[^\s]+/.exec(o),s=n?n[0]:"null",a=(o?o.indexOf("icon-rtl"):-1)>-1?"icon-rtl":"",r='<svg class="menu-item-icon %rtlCls"><use class="zoom-int" href="#%iconname"></use></svg>'.replace("%iconname",s).replace("%rtlCls",a);i.find("span.menu-item-icon").after(r)}}}}),Common.UI.MenuItemSeparator=function(t){return(t=t||{}).caption="--",new Common.UI.MenuItem(t)},Common.UI.MenuItemCustom=Common.UI.MenuItem.extend(_.extend({initialize:function(t){Common.UI.MenuItem.prototype.initialize.call(this,t),this.isCustomItem=!0,this.baseUrl=t.baseUrl||"",this.iconsSet=Common.UI.iconsStr2IconsObj(t.iconsSet||[""]);var e=Common.UI.getSuitableIcons(this.iconsSet);this.iconImg=this.baseUrl+e.normal},render:function(){return Common.UI.MenuItem.prototype.render.call(this),this.updateIcon(),Common.NotificationCenter.on("uitheme:changed",this.updateIcons.bind(this)),this},updateIcons:function(){var t=Common.UI.getSuitableIcons(this.iconsSet);this.iconImg=this.baseUrl+t.normal,this.updateIcon()},updateIcon:function(){this.cmpEl&&this.cmpEl.find("> a img").attr("src",this.iconImg).addClass("custom-icon")},applyScaling:function(t){this.options.scaling!==t&&(this.options.scaling=t,this.updateIcons())}},Common.UI.MenuItemCustom||{}))})),function(t){"function"==typeof define&&define.amd?define("jmousewheel",["jquery"],t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t:t(jQuery)}((function(t){var e,i,o=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],n="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],s=Array.prototype.slice;if(t.event.fixHooks)for(var a=o.length;a;)t.event.fixHooks[o[--a]]=t.event.mouseHooks;var r=t.event.special.mousewheel={version:"3.1.9",setup:function(){if(this.addEventListener)for(var e=n.length;e;)this.addEventListener(n[--e],l,!1);else this.onmousewheel=l;t.data(this,"mousewheel-line-height",r.getLineHeight(this)),t.data(this,"mousewheel-page-height",r.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=n.length;t;)this.removeEventListener(n[--t],l,!1);else this.onmousewheel=null},getLineHeight:function(e){return parseInt(t(e)["offsetParent"in t.fn?"offsetParent":"parent"]().css("fontSize"),10)},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0}};function l(o){var n,a=o||window.event,r=s.call(arguments,1),l=0,d=0,m=0;if((o=t.event.fix(a)).type="mousewheel","detail"in a&&(m=-1*a.detail),"wheelDelta"in a&&(m=a.wheelDelta),"wheelDeltaY"in a&&(m=a.wheelDeltaY),"wheelDeltaX"in a&&(d=-1*a.wheelDeltaX),"axis"in a&&a.axis===a.HORIZONTAL_AXIS&&(d=-1*m,m=0),l=0===m?d:m,"deltaY"in a&&(l=m=-1*a.deltaY),"deltaX"in a&&(d=a.deltaX,0===m&&(l=-1*d)),0!==m||0!==d){if(1===a.deltaMode){var p=t.data(this,"mousewheel-line-height");l*=p,m*=p,d*=p}else if(2===a.deltaMode){var u=t.data(this,"mousewheel-page-height");l*=u,m*=u,d*=u}return n=Math.max(Math.abs(m),Math.abs(d)),(!i||n<i)&&(i=n,h(a,n)&&(i/=40)),h(a,n)&&(l/=40,d/=40,m/=40),l=Math[l>=1?"floor":"ceil"](l/i),d=Math[d>=1?"floor":"ceil"](d/i),m=Math[m>=1?"floor":"ceil"](m/i),o.deltaX=d,o.deltaY=m,o.deltaFactor=i,o.deltaMode=0,r.unshift(o,l,d,m),e&&clearTimeout(e),e=setTimeout(c,200),(t.event.dispatch||t.event.handle).apply(this,r)}}function c(){i=null}function h(t,e){return r.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120==0}t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})})),function(t){"use strict";"function"==typeof define&&define.amd?define("perfectscrollbar",["jquery"],t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?t(require("jquery")):t(jQuery)}((function(t){"use strict";var e,i={wheelSpeed:10,wheelPropagation:!1,minScrollbarLength:null,useBothWheelAxes:!1,useKeyboard:!0,suppressScrollX:!1,suppressScrollY:!1,scrollXMarginOffset:0,scrollYMarginOffset:0,includePadding:!1,includeMargin:!0},o=(e=0,function(){var t=e;return e+=1,".perfect-scrollbar-"+t});t.fn.perfectScrollbar=function(e,n){return this.each((function(){var s=t.extend(!0,{},i),a=t(this);if("object"===_typeof(e)?t.extend(!0,s,e):n=e,"update"===n)return a.data("perfect-scrollbar-update")&&a.data("perfect-scrollbar-update")(),a;if("destroy"===n)return a.data("perfect-scrollbar-destroy")&&a.data("perfect-scrollbar-destroy")(),a;if(a.data("perfect-scrollbar"))return a.data("perfect-scrollbar");a.addClass("ps-container oo");var r,l,c,h,d,m,p,u,g,f,b,C,v,_,w,A,y,S,x,k,T,I,E,P,D=t("<div class='ps-scrollbar-x-rail'></div>").appendTo(a),M=t("<div class='ps-scrollbar-y-rail'></div>").appendTo(a),U=t("<div class='ps-scrollbar-x'><div></div></div>").appendTo(D),F=t("<div class='ps-scrollbar-y'><div></div></div>").appendTo(M),R=parseInt(D.css("bottom"),10),L=parseInt(M.css("right"),10),B=o(),V=!1,O=function(t){return s.minScrollbarLength&&(t=Math.max(t,s.minScrollbarLength)),t},H=function(){D.css({left:Common.UI.isRTL()?"auto":a.scrollLeft(),right:Common.UI.isRTL()?-a.scrollLeft():"auto",bottom:R-a.scrollTop(),width:g,display:r?"inherit":"none"}),M.hasClass("in-scrolling")?M.css({right:L-a.scrollLeft(),height:C,display:l?"inherit":"none"}):(M.css({top:a.scrollTop(),right:L-a.scrollLeft(),height:C,display:l?"inherit":"none"}),Common.UI.isRTL()&&V&&M.css({left:a.scrollLeft()+1})),U&&U.css({left:Common.UI.isRTL()?"auto":u,right:Common.UI.isRTL()?u:"auto",width:p}),F&&F.css({top:b,height:f})},N=function(){c=s.includePadding?a.innerWidth():a.width(),h=s.includePadding?a.innerHeight():a.height(),C=h-(s.includeMargin?parseInt(M.css("margin-top"))+parseInt(M.css("margin-bottom")):0),g=c-(s.includeMargin?parseInt(D.css("margin-left"))+parseInt(D.css("margin-right")):0),d=a.prop("scrollWidth"),m=a.prop("scrollHeight"),!s.suppressScrollX&&c+s.scrollXMarginOffset<d?(r=!0,p=O(parseInt(g*c/d,10)),u=parseInt(a.scrollLeft()*(Common.UI.isRTL()?-1:1)*(g-p)/(d-c),10)):(r=!1,p=0,u=0,a.scrollLeft(0)),!s.suppressScrollY&&h+s.scrollYMarginOffset<m?(l=!0,f=O(parseInt(C*h/m,10)),b=parseInt(a.scrollTop()*(C-f)/(m-h),10)):(l=!1,f=0,b=0,a.scrollTop(0)),b>=C-f&&(b=C-f),u>=g-p&&(u=g-p),H(),s.onChange&&s.onChange(this)},G=function(){var e,i;U.bind("mousedown"+B,(function(t){V=!0,Common.NotificationCenter.trigger("hints:clear"),i=t.pageX*Common.Utils.zoom(),e=Common.Utils.getPosition(U).left,D.addClass("in-scrolling"),t.stopPropagation(),t.preventDefault()})),t(document).bind("mousemove"+B,(function(t){D.hasClass("in-scrolling")&&(!function(t,e){var i=g-p;Common.UI.isRTL()&&(t=i-t,e*=-1);var o=t+e;u=o<0?0:o>i?i:o;var n=parseInt(u*(d-c)/(g-p),10);a.scrollLeft(n*(Common.UI.isRTL()?-1:1)),M.css({right:L-n}),Common.UI.isRTL()&&V&&M.css({left:a.scrollLeft()+1})}(e,t.pageX*Common.Utils.zoom()-i),t.stopPropagation(),t.preventDefault())})),t(document).bind("mouseup"+B,(function(t){D.hasClass("in-scrolling")&&D.removeClass("in-scrolling")})),e=i=null},$=function(){var e,i;F.bind("mousedown"+B,(function(t){Common.NotificationCenter.trigger("hints:clear"),i=t.pageY*Common.Utils.zoom(),e=Common.Utils.getPosition(F).top,M.addClass("in-scrolling");var o=parseInt(M.css("margin-top")),n=Common.Utils.getBoundingClientRect(M[0]);M.css({position:"fixed",left:n.left,top:n.top-o}),t.stopPropagation(),t.preventDefault()})),t(document).bind("mousemove"+B,(function(t){M.hasClass("in-scrolling")&&(!function(t,e){var i=t+e,o=C-f;b=i<0?0:i>o?o:i;var n=parseInt(b*(m-h)/(C-f),10);a.scrollTop(n),D.css({bottom:R-n})}(e,t.pageY*Common.Utils.zoom()-i),t.stopPropagation(),t.preventDefault())})),t(document).bind("mouseup"+B,(function(t){M.hasClass("in-scrolling")&&(M.removeClass("in-scrolling"),M.css({position:"",left:"",top:""}),H())})),e=i=null},z=function(t,e){var i=a.scrollTop();if(0===t){if(!l)return!1;if(0===i&&e>0||i>=m-h&&e<0)return!s.wheelPropagation}var o=a.scrollLeft();if(0===e){if(!r)return!1;if(0===o&&t<0||o>=d-c&&t>0)return!s.wheelPropagation}return!0},W=function(){a.unbind(B),t(window).unbind(B),t(document).unbind(B),a.data("perfect-scrollbar",null),a.data("perfect-scrollbar-update",null),a.data("perfect-scrollbar-destroy",null),U.remove(),F.remove(),D.remove(),M.remove(),U=F=c=h=d=m=p=u=R=f=b=L=null,V=!1},j="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch;return(P=navigator.userAgent.toLowerCase().match(/(msie) ([\w.]+)/))&&"msie"===P[1]&&(v=parseInt(P[2],10),a.addClass("ie").addClass("ie"+v),6===v&&(_=function(){t(this).addClass("hover")},w=function(){t(this).removeClass("hover")},a.bind("mouseenter"+B,_).bind("mouseleave"+B,w),D.bind("mouseenter"+B,_).bind("mouseleave"+B,w),M.bind("mouseenter"+B,_).bind("mouseleave"+B,w),U.bind("mouseenter"+B,_).bind("mouseleave"+B,w),F.bind("mouseenter"+B,_).bind("mouseleave"+B,w),H=function(){U.css({left:u+a.scrollLeft(),bottom:R,width:p}),F.css({top:b+a.scrollTop(),right:L,height:f}),U.hide().show(),F.hide().show()})),N(),a.bind("scroll"+B,(function(t){N()})),G(),$(),A=function(t){t.stopPropagation()},F.bind("click"+B,A),M.bind("click"+B,(function(t){var e=parseInt(f/2,10),i=(t.pageY*Common.Utils.zoom()-Common.Utils.getOffset(M).top-e)/(C-f);i<0?i=0:i>1&&(i=1),a.scrollTop((m-h)*i)})),U.bind("click"+B,A),D.bind("click"+B,(function(t){var e=parseInt(p/2,10),i=g-p,o=(Common.UI.isRTL()?i-(t.pageX*Common.Utils.zoom()-Common.Utils.getOffset(D).left)+e:t.pageX*Common.Utils.zoom()-Common.Utils.getOffset(D).left-e)/i;V=!0,o<0?o=0:o>1&&(o=1),a.scrollLeft((d-c)*o*(Common.UI.isRTL()?-1:1))})),j&&(y=function(t,e){a.scrollTop(a.scrollTop()-e),a.scrollLeft(a.scrollLeft()-t),N()},S={},x=0,k={},T=null,I=!1,t(window).bind("touchstart"+B,(function(t){I=!0})),t(window).bind("touchend"+B,(function(t){I=!1})),a.bind("touchstart"+B,(function(t){var e=t.originalEvent.targetTouches[0];S.pageX=e.pageX,S.pageY=e.pageY,x=(new Date).getTime(),null!==T&&clearInterval(T),t.stopPropagation()})),a.bind("touchmove"+B,(function(t){if(!I&&1===t.originalEvent.targetTouches.length){var e=t.originalEvent.targetTouches[0],i={};i.pageX=e.pageX,i.pageY=e.pageY;var o=i.pageX-S.pageX,n=i.pageY-S.pageY;y(o,n),S=i;var s=(new Date).getTime(),a=s-x;a>0&&(k.x=o/a,k.y=n/a,x=s),t.preventDefault()}})),a.bind("touchend"+B,(function(t){clearInterval(T),T=setInterval((function(){Math.abs(k.x)<.01&&Math.abs(k.y)<.01?clearInterval(T):(y(30*k.x,30*k.y),k.x*=.8,k.y*=.8)}),10)}))),a.mousewheel&&function(){s.wheelSpeed/=10;var e=!1;a.bind("mousewheel"+B,(function(i,o,n,c){Common.NotificationCenter.trigger("hints:clear");var h=i.deltaX*i.deltaFactor||n,d=i.deltaY*i.deltaFactor||c;if(i&&i.target&&("textarea"===i.target.type||"input"===i.target.type)){i.stopImmediatePropagation(),i.preventDefault();var m=t(i.target).scrollTop(),p=0;return i.originalEvent?i.originalEvent.wheelDelta?p=i.originalEvent.wheelDelta:i.originalEvent.deltaY?p=40*-i.originalEvent.deltaY:i.originalEvent.detail&&(p=i.originalEvent.detail):p=void 0!==i.wheelDelta?i.wheelDelta:i.deltaY,void t(i.target).scrollTop(m-p)}e=!1,s.useBothWheelAxes?l&&!r?(d?a.scrollTop(a.scrollTop()-d*s.wheelSpeed):a.scrollTop(a.scrollTop()+h*s.wheelSpeed),e=!0):r&&!l&&(h?(V=!0,a.scrollLeft(a.scrollLeft()+h*s.wheelSpeed)):a.scrollLeft(a.scrollLeft()-d*s.wheelSpeed),e=!0):(a.scrollTop(a.scrollTop()-d*s.wheelSpeed),a.scrollLeft(a.scrollLeft()+h*s.wheelSpeed)),N(),(e=e||z(h,d))&&(i.stopPropagation(),i.preventDefault())})),a.bind("MozMousePixelScroll"+B,(function(t){e&&t.preventDefault()}))}(),s.useKeyboard&&(E=!1,a.bind("mouseenter"+B,(function(t){E=!0})),a.bind("mouseleave"+B,(function(t){E=!1})),t(document).bind("keydown"+B,(function(e){if(E&&!t(document.activeElement).is(":input,[contenteditable]")){var i=0,o=0;switch(e.which){case 37:i=-30;break;case 38:o=30;break;case 39:i=30;break;case 40:o=-30;break;case 33:o=90;break;case 32:case 34:o=-90;break;case 35:o=-h;break;case 36:o=h;break;default:return}a.scrollTop(a.scrollTop()-o),a.scrollLeft(a.scrollLeft()+i),z(i,o)&&e.preventDefault()}}))),a.data("perfect-scrollbar",a),a.data("perfect-scrollbar-update",N),a.data("perfect-scrollbar-destroy",W),a}))}})),void 0===Common)var Common={};if(define("common/main/lib/component/Scroller",["jmousewheel","perfectscrollbar","common/main/lib/component/BaseView"],(function(){"use strict";var t;Common.UI.Scroller=_.extend(Common.UI.BaseView.extend({options:{wheelSpeed:20,wheelPropagation:!1,minScrollbarLength:null,useBothWheelAxes:!1,useKeyboard:!0,suppressScrollX:!1,suppressScrollY:!1,scrollXMarginOffset:5,scrollYMarginOffset:5,includePadding:!0,includeMargin:!0,alwaysVisibleX:!1,alwaysVisibleY:!1,scrollYStyle:null},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.options.el&&this.render()},render:function(){var t=this;return t.cmpEl=t.$el||$(this.el),t.rendered||(t.cmpEl.perfectScrollbar(_.extend({},t.options)),t.rendered=!0,this.setAlwaysVisibleX(t.options.alwaysVisibleX),this.setAlwaysVisibleY(t.options.alwaysVisibleY),this.options.scrollYStyle&&this.setOptionStyleY(this.options.scrollYStyle)),this},remove:function(){this.destroy(),Backbone.View.prototype.remove.call(this)},update:function(e){var i=this.options;e?(this.destroy(),i=_.extend(this.options,e),this.cmpEl.perfectScrollbar(i)):this.cmpEl.perfectScrollbar("update"),this.setAlwaysVisibleX(i.alwaysVisibleX),this.setAlwaysVisibleY(i.alwaysVisibleY),i.scrollYStyle&&this.setOptionStyleY(i.scrollYStyle);var o=function(e){t=!0;var i=function(e){$(document).unbind("mouseup",i),_.delay((function(){t=!1}),10)};$(document).mouseup(i)};$(".ps-scrollbar-x-rail, .ps-scrollbar-y-rail, .ps-scrollbar-x, .ps-scrollbar-y",this.cmpEl).off("mousedown",o).on("mousedown",o)},destroy:function(){this.cmpEl.perfectScrollbar("destroy")},scrollLeft:function(t){this.cmpEl.scrollLeft(t),this.update()},scrollTop:function(t){this.cmpEl.scrollTop(t),this.update()},getScrollTop:function(){return this.cmpEl.scrollTop()},getScrollLeft:function(){return this.cmpEl.scrollLeft()},setAlwaysVisibleX:function(t){t?($(this.el).find(".ps-scrollbar-x-rail").addClass("always-visible-x"),$(this.el).find(".ps-scrollbar-x").addClass("always-visible-x")):($(this.el).find(".ps-scrollbar-x-rail").removeClass("always-visible-x"),$(this.el).find(".ps-scrollbar-x").addClass("always-visible-x"))},setAlwaysVisibleY:function(t){t?($(this.el).find(".ps-scrollbar-y-rail").addClass("always-visible-y"),$(this.el).find(".ps-scrollbar-y").addClass("always-visible-y")):($(this.el).find(".ps-scrollbar-y-rail").removeClass("always-visible-y"),$(this.el).find(".ps-scrollbar-y").addClass("always-visible-y"))},setOptionStyleY:function(t){$(this.el).find(".ps-scrollbar-y-rail").css(t),this.cmpEl.perfectScrollbar("update")},isVisible:function(){return $(this.el).find(".ps-scrollbar-y-rail").is(":visible")}}),{isMouseCapture:function(){return t}})})),void 0===Common)var Common={};if(define("common/main/lib/component/Menu",["common/main/lib/extend/Bootstrap","common/main/lib/component/BaseView","common/main/lib/component/MenuItem","common/main/lib/component/Scroller"],(function(){"use strict";var t,e,i;Common.UI.Menu=(t=[],e={},i={register:function(i){e[i.id]=i,i.on("show:after",(function(e){t.push(e)})).on("hide:after",(function(e){var i=t.indexOf(e);i>-1&&t.splice(i,1)}))},unregister:function(i){var o=t.indexOf(i);delete e[i.id],o>-1&&t.splice(o,1),i.off("show:after").off("hide:after")},hideAll:function(){return Common.NotificationCenter.trigger("menumanager:hideall"),!!(t&&t.length>0)&&(_.each(t,(function(t){t&&t.hide()})),!0)}},_.extend(Common.UI.BaseView.extend({options:{cls:"",style:"",itemTemplate:null,items:[],menuAlign:"tl-bl",menuAlignEl:null,offset:[0,0],cyclic:!0,search:!1,scrollAlwaysVisible:!0,scrollToCheckedItem:!0,focusToCheckedItem:!1},template:_.template(['<ul class="dropdown-menu <%= options.cls %>" oo_editor_input="true" style="<%= options.style %>" role="menu"></ul>'].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=this.options.id||Common.UI.getId(),this.itemTemplate=this.options.itemTemplate||Common.UI.MenuItem.prototype.template,this.rendered=!1,this.items=[],this.offset=[0,0],this.menuAlign=this.options.menuAlign,this.menuAlignEl=this.options.menuAlignEl,this.scrollAlwaysVisible=this.options.scrollAlwaysVisible,this.search=this.options.search,this.outerMenu=this.options.outerMenu,Common.UI.isRTL()&&("tl-tr"===this.menuAlign?this.menuAlign="tr-tl":"tl-bl"===this.menuAlign?this.menuAlign="tr-br":"tr-br"===this.menuAlign?this.menuAlign="tl-bl":"bl-tl"===this.menuAlign&&(this.menuAlign="br-tr")),this.options.restoreHeight&&(this.options.restoreHeight="number"==typeof this.options.restoreHeight?this.options.restoreHeight:this.options.maxHeight?this.options.maxHeight:1e5,!this.options.maxHeight&&(this.options.maxHeight=this.options.restoreHeight)),Common.Utils.isIE&&(this.options.restoreHeightAndTop=!1),this.options.cyclic||(this.options.cls+=" no-cyclic"),_.each(this.options.items,(function(t){t instanceof Common.UI.MenuItem?e.items.push(t):e.items.push(new Common.UI.MenuItem(_.extend({tagName:"li",template:e.itemTemplate},t)))})),this.options.el&&this.render(),i.register(this)},remove:function(){i.unregister(this),Common.UI.BaseView.prototype.remove.call(this)},render:function(t){var e=this;this.trigger("render:before",this),this.cmpEl=e.$el||$(this.el),t?(this.setElement(t,!1),e.rendered||(this.cmpEl=$(this.template({options:e.options})),t.append(this.cmpEl))):e.rendered||(this.cmpEl=this.template({options:e.options}),this.$el.append(this.cmpEl));var i=this.cmpEl.parent(),o="menu"===i.attr("role")?i:i.find("[role=menu]");return this.menuRoot=o,o&&(e.rendered||(_.each(e.items||[],(function(t){o.append(t.render().el),t.on("click",_.bind(e.onItemClick,e)),t.on("toggle",_.bind(e.onItemToggle,e))})),o.on("click",(function(t){e.trigger("menu:click",this,t)}))),this.options.maxHeight&&(o.css({"max-height":e.options.maxHeight}),this.scroller=new Common.UI.Scroller({el:e.$el.find(".dropdown-menu "),minScrollbarLength:30,suppressScrollX:!0,alwaysVisibleY:this.scrollAlwaysVisible})),o.css({position:"fixed",right:"auto",left:-1e3,top:-1e3}),this.parentEl=o.parent(),this.parentEl.on("show.bs.dropdown",_.bind(e.onBeforeShowMenu,e)),this.parentEl.on("shown.bs.dropdown",_.bind(e.onAfterShowMenu,e)),this.parentEl.on("hide.bs.dropdown",_.bind(e.onBeforeHideMenu,e)),this.parentEl.on("hidden.bs.dropdown",_.bind(e.onAfterHideMenu,e)),this.parentEl.on("keydown.after.bs.dropdown",_.bind(e.onAfterKeydownMenu,e)),this.parentEl.on("keydown.before.bs.dropdown",_.bind(e.onBeforeKeydownMenu,e)),this.options.innerMenus&&this.on("keydown:before",_.bind(e.onBeforeKeyDown,e)),o.hover((function(t){e.isOver=!0}),(function(t){e.isOver=!1}))),this.rendered=!0,this.trigger("render:after",this),this},isVisible:function(){return this.rendered&&this.cmpEl.is(":visible")},show:function(){this.rendered&&this.parentEl&&!this.parentEl.hasClass("open")&&this.cmpEl.dropdown("toggle")},hide:function(){this.rendered&&this.parentEl&&(this.parentEl.hasClass("open")?this.cmpEl.dropdown("toggle"):this.parentEl.hasClass("over")&&this.parentEl.removeClass("over"))},insertItem:function(t,e){var i=this;if(this.cmpEl,e instanceof Common.UI.MenuItem||(e=new Common.UI.MenuItem(_.extend({tagName:"li",template:i.itemTemplate},e))),t<0||t>=i.items.length?i.items.push(e):i.items.splice(t,0,e),this.rendered){var o=this.menuRoot;o&&(t<0?o.append(e.render().el):0===t?o.prepend(e.render().el):o.children("li:nth-child("+t+")").after(e.render().el),e.on("click",_.bind(i.onItemClick,i)),e.on("toggle",_.bind(i.onItemToggle,i)))}},addItem:function(t,e){if(e){for(var i=-1,o=0;o<this.items.length;o++)if(this.items[o].isCustomItem){i=o;break}this.insertItem(i,t)}else this.insertItem(-1,t)},removeItem:function(t){var e=this.items.indexOf(t);e>-1&&(this.items.splice(e,1),t.off("click").off("toggle"),t.remove())},removeItems:function(t,e){if(!(t>this.items.length-1)){t+e>this.items.length&&(e=this.items.length-t);for(var i=t;i<t+e;i++)this.items[i].off("click").off("toggle"),this.items[i].remove();this.items.splice(t,e)}},removeAll:function(t){for(var e=0;e<this.items.length;e++)t&&this.items[e].isCustomItem||(this.items[e].off("click").off("toggle"),this.items[e].remove(),this.items.splice(e,1),e--)},onBeforeShowMenu:function(t){Common.NotificationCenter.trigger("menu:show"),this.trigger("show:before",this,t),t&&t.target===t.currentTarget&&this.alignPosition()},onAfterShowMenu:function(t){if(this.trigger("show:after",this,t),this.scroller&&t&&t.target===t.currentTarget){this.updateScroller();var e=this.menuRoot,i=e.find("> li .checked");if(i.length){var o=Common.Utils.getPosition(i).top,n=i.outerHeight(),s=e.outerHeight();if(this.options.scrollToCheckedItem&&(o<0||o+n>s)){var a=e.scrollTop()+o+(n-s)/2;a=Math.floor(a/n)*n,e.scrollTop(a)}this.options.focusToCheckedItem&&setTimeout((function(){i.focus()}),1)}}this._search={}},updateScroller:function(){if(this.scroller&&this.menuRoot){var t=this.menuRoot;if(void 0===this.wheelSpeed||0===this.wheelSpeed){var e=t.find("> li:first"),i=e.length?e.outerHeight():1;this.wheelSpeed=Math.min(Math.floor(t.height()/i)*i/10,20)}this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible,wheelSpeed:this.wheelSpeed})}},onBeforeHideMenu:function(t){this.trigger("hide:before",this,t),Common.UI.Scroller.isMouseCapture()&&t.preventDefault()},onAfterHideMenu:function(t,e){this.trigger("hide:after",this,t,e),Common.NotificationCenter.trigger("menu:hide",this,e)},onAfterKeydownMenu:function(t){if(this.trigger("keydown:before",this,t),!t.isDefaultPrevented())if(t.keyCode==Common.UI.Keys.RETURN){var e=$(t.target).closest("li");if(e.length<=0&&(e=$(t.target).parent().find("li .dataview")),e.length>0&&e.click(),e.hasClass("dropdown-submenu")||Common.UI.Menu.Manager.hideAll(),$(t.currentTarget).closest("li").hasClass("dropdown-submenu"))return t.stopPropagation(),!1}else if(t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN)this.fromKeyDown=!0;else if(t.keyCode==Common.UI.Keys.ESC);else if(this.search&&t.keyCode>64&&t.keyCode<91&&t.key){var i=this;if(clearTimeout(this._search.timer),this._search.timer=setTimeout((function(){i._search={}}),1e3),!this._search.text&&(this._search.text=""),!this._search.char&&(this._search.char=t.key),this._search.char!==t.key&&(this._search.full=!0),this._search.text+=t.key,void 0===this._search.index){var o=this.menuRoot.find("> li").find("> a");this._search.index=o.index(o.filter(":focus"))}this.selectCandidate()}},onBeforeKeydownMenu:function(t){if(!t.isDefaultPrevented()&&this.outerMenu&&this.outerMenu.menu&&(t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN)){var e=this.menuRoot.find("> li").find("> a"),i=e.index(e.filter(":focus"));(t.keyCode==Common.UI.Keys.UP&&0==i||t.keyCode==Common.UI.Keys.DOWN&&i==e.length-1)&&(this.outerMenu.menu.focusOuter(t,this.outerMenu.index),t.preventDefault(),t.stopPropagation())}},selectCandidate:function(){for(var t,e,i=this._search.index&&-1!=this._search.index?this._search.index:0,o=new RegExp("^"+(this._search.full?this._search.text:this._search.char),"i"),n=o.test(this.items[i].caption),s=0;s<this.items.length;s++){var a=this.items[s];if(o.test(a.caption)){if(!t&&(t=a,e=s,!n))break;if(this._search.full&&s==i||s>i){t=a,e=s;break}}}if(t){if(this._search.index=e,a=t.cmpEl.find("a"),this.scroller){this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible,wheelSpeed:this.wheelSpeed});var r=Common.Utils.getPosition(a).top,l=a.outerHeight(),c=this.menuRoot.outerHeight();if(r<0||r+l>c){var h=this.menuRoot.scrollTop()+r;h=Math.floor(h/l)*l,this.menuRoot.scrollTop(h)}}a.focus()}},onBeforeKeyDown:function(t,e){if(e.keyCode==Common.UI.Keys.RETURN){var i=$(e.target).closest("li");i.length>0&&(e.preventDefault(),e.stopPropagation(),i.click()),Common.UI.Menu.Manager.hideAll()}else if("after.bs.dropdown"!==e.namespace&&(e.keyCode==Common.UI.Keys.DOWN||e.keyCode==Common.UI.Keys.UP)){if(this.menuRoot.length<1||$(e.target).closest("ul[role=menu]").get(0)!==this.menuRoot.get(0))return;var o=this.findInnerMenu(e.keyCode);o&&o.focusInner&&(e.preventDefault(),e.stopPropagation(),_.delay((function(){o.focusInner(e)}),10))}},setInnerMenu:function(t){!this.options.innerMenus&&t&&(this.options.innerMenus=t,this.rendered&&this.on("keydown:before",_.bind(this.onBeforeKeyDown,this)))},findInnerMenu:function(t,e,i){if(this.options.innerMenus){var o=$("> li",this.menuRoot),n=$("> li:not(.divider):not(.disabled):visible",this.menuRoot),s=n.length;if(s)for(var a=0;a<s;){var r=void 0!==e?n.index(o.eq(e)):n.index(n.find("> a").filter(":focus").parent()),l=t==Common.UI.Keys.DOWN?r<s-1?r+1:0:r>0?r-1:s-1,c=n.eq(l);e=o.index(c);for(var h=0;h<this.options.innerMenus.length;h++){var d=this.options.innerMenus[h];if(d&&d.menu&&d.index==e)return d.menu}if(c.find("> a").length>0)return i?c:void 0;a++}}},focusInner:function(t){t.keyCode==Common.UI.Keys.UP?this.items[this.items.length-1].cmpEl.find("> a").focus():this.items[0].cmpEl.find("> a").focus()},focusOuter:function(t,e){var i=this.findInnerMenu(t.keyCode,e,!0);if(i&&i.focusInner)_.delay((function(){i.focusInner(t)}),10);else if(i)i.find("> a").focus();else{var o=$("> li:not(.divider):not(.disabled):visible",this.menuRoot).find("> a"),n=o.length;n&&o.eq(t.keyCode==Common.UI.Keys.UP?e<0?n-1:e:e>=n-1?0:e+1).focus()}},onItemClick:function(t,e){if(t.menu||(this.isOver=!1),t.options.stopPropagation){e.stopPropagation();var i=this;_.delay((function(){i.$el.parent().parent().find("[data-toggle=dropdown]").focus()}),10)}else this.trigger(t.isCustomItem?"item:custom-click":"item:click",this,t,e)},onItemToggle:function(t,e,i){this.trigger("item:toggle",this,t,e,i)},setOffset:function(t,e){this.offset[0]=_.isUndefined(t)?this.offset[0]:t,this.offset[1]=_.isUndefined(e)?this.offset[1]:e,this.alignPosition()},getOffset:function(){return this.offset},alignPosition:function(t,e){var i=this.menuRoot,o=this.menuAlignEl||i.parent(),n=this.menuAlign.match(/^([a-z]+)-([a-z]+)/),s=Common.Utils.getOffset(o),a=Common.Utils.innerWidth()-10,r=Common.Utils.innerHeight()-10,l=i.outerWidth(),c=i.outerHeight(),h=o.outerWidth(),d=o.outerHeight(),m={tl:[0,0],bl:[0,c],tr:[l,0],br:[l,c]},p={tl:[0,0],tr:[h,0],bl:[0,d],br:[h,d]},u=s.left-m[n[1]][0]+p[n[2]][0]+this.offset[0],g=s.top-m[n[1]][1]+p[n[2]][1]+this.offset[1];if(u+l>a?u=o.is("li.dropdown-submenu")?s.left-l+2:a-l:u<0&&(u=o.is("li.dropdown-submenu")?s.left+h-2:0),u<0&&(u=0),this.options.restoreHeightAndTop)r=(f=Common.Utils.croppedGeometry()).height-10,i.css("max-height","none"),g+(c=i.outerHeight())>r+f.top&&(g=r-c+f.top),g<f.top&&(g=f.top),g+c>r+f.top&&(i.css("max-height",r-g+f.top+"px"),!this.scroller&&(this.scroller=new Common.UI.Scroller({el:this.$el.find("> .dropdown-menu "),minScrollbarLength:30,suppressScrollX:!0,alwaysVisibleY:this.scrollAlwaysVisible})),this.wheelSpeed=void 0),this.scroller&&this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible});else if(this.options.restoreHeight)"number"==typeof this.options.restoreHeight&&(g+c>r?(i.css("max-height",r-g+"px"),!this.scroller&&(this.scroller=new Common.UI.Scroller({el:this.$el.find(".dropdown-menu "),minScrollbarLength:30,suppressScrollX:!0,alwaysVisibleY:this.scrollAlwaysVisible})),this.wheelSpeed=void 0):g+c<r&&i.height()<this.options.restoreHeight&&(i.css("max-height",Math.min(r-g,this.options.restoreHeight)+"px"),this.wheelSpeed=void 0));else{var f;g+c>(r=(f=Common.Utils.croppedGeometry()).height-10)+f.top&&(t&&"string"==typeof t?(n=t.match(/^([a-z]+)-([a-z]+)/),g=s.top-m[n[1]][1]+p[n[2]][1]+this.offset[1]+(e||0)):g=r-c+f.top),g<f.top&&(g=f.top)}if(this.options.additionalAlign)this.options.additionalAlign.call(this,i,u,g);else{var b={left:u,top:g};c<r||(b["margin-top"]=0),i.css(b)}},getChecked:function(t){for(var e=0;e<this.items.length;e++){var i=this.items[e];if(i.isChecked&&i.isChecked()&&(!t||!i.isCustomItem))return i}},clearAll:function(t){_.each(this.items,(function(e){!e.setChecked||t&&e.isCustomItem||e.setChecked(!1,!0)}))},getItems:function(t){return t?_.reject(this.items,(function(t){return!!t.isCustomItem})):this.items},getItemsLength:function(t){return t?_.reject(this.items,(function(t){return!!t.isCustomItem})).length:this.items.length}}),{Manager:i})),Common.UI.MenuSimple=Common.UI.BaseView.extend({options:{cls:"",style:"",itemTemplate:null,items:[],menuAlign:"tl-bl",menuAlignEl:null,offset:[0,0],cyclic:!0,search:!1,searchFields:["caption"],scrollAlwaysVisible:!0,scrollToCheckedItem:!0,focusToCheckedItem:!1},template:_.template(['<ul class="dropdown-menu <%= options.cls %>" oo_editor_input="true" style="<%= options.style %>" role="menu">',"<% _.each(items, function(item) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>","<% item.checked = item.checked || false;  %>","<li><%= itemTemplate(item) %></li>","<% }) %>","</ul>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);this.id=this.options.id||Common.UI.getId(),this.itemTemplate=this.options.itemTemplate||_.template(['<a id="<%= id %>" <% if(typeof style !== "undefined") { %> style="<%= style %>" <% } %>','<% if(typeof canFocused !== "undefined") { %> tabindex="-1" type="menuitem" <% } %>','<% if(typeof stopPropagation !== "undefined") { %> data-stopPropagation="true" <% } %>','class="<% if (checked) { %> checked <% } %>" >','<% if (typeof iconCls !== "undefined") { %>','<span class="menu-item-icon <%= iconCls %>"></span>',"<% } %>","<%= caption %>","</a>"].join("")),this.rendered=!1,this.items=this.options.items||[],this.offset=[0,0],this.menuAlign=this.options.menuAlign,this.menuAlignEl=this.options.menuAlignEl,this.scrollAlwaysVisible=this.options.scrollAlwaysVisible,this.search=this.options.search,this.setRecent(t.recent),Common.UI.isRTL()&&("tl-tr"===this.menuAlign?this.menuAlign="tr-tl":"tl-bl"===this.menuAlign?this.menuAlign="tr-br":"tr-br"===this.menuAlign?this.menuAlign="tl-bl":"bl-tl"===this.menuAlign&&(this.menuAlign="br-tr")),this.options.restoreHeight&&(this.options.restoreHeight="number"==typeof this.options.restoreHeight?this.options.restoreHeight:this.options.maxHeight?this.options.maxHeight:1e5,!this.options.maxHeight&&(this.options.maxHeight=this.options.restoreHeight)),this.options.cyclic||(this.options.cls+=" no-cyclic"),this.options.el&&this.render(),Common.UI.Menu.Manager.register(this)},remove:function(){Common.UI.Menu.Manager.unregister(this),Common.UI.BaseView.prototype.remove.call(this)},render:function(t){var e=this;this.trigger("render:before",this),this.cmpEl=e.$el||$(this.el),t&&this.setElement(t,!1),e.rendered||(this.cmpEl=$(this.template({items:e.items,itemTemplate:e.itemTemplate,options:e.options})),t?t.append(this.cmpEl):this.$el.append(this.cmpEl));var i=this.cmpEl.parent(),o="menu"===i.attr("role")?i:i.find("[role=menu]");return this.menuRoot=o,o&&(e.rendered||(o.on("click","li",_.bind(e.onItemClick,e)),o.on("mousedown","li",_.bind(e.onItemMouseDown,e))),this.options.maxHeight&&(o.css({"max-height":e.options.maxHeight}),this.scroller=new Common.UI.Scroller({el:e.$el.find(".dropdown-menu "),minScrollbarLength:30,suppressScrollX:!0,alwaysVisibleY:this.scrollAlwaysVisible})),o.css({position:"fixed",right:"auto",left:-1e3,top:-1e3}),this.parentEl=o.parent(),this.parentEl.on("show.bs.dropdown",_.bind(e.onBeforeShowMenu,e)),this.parentEl.on("shown.bs.dropdown",_.bind(e.onAfterShowMenu,e)),this.parentEl.on("hide.bs.dropdown",_.bind(e.onBeforeHideMenu,e)),this.parentEl.on("hidden.bs.dropdown",_.bind(e.onAfterHideMenu,e)),this.parentEl.on("keydown.after.bs.dropdown",_.bind(e.onAfterKeydownMenu,e)),o.hover((function(t){e.isOver=!0}),(function(t){e.isOver=!1}))),this.rendered=!0,this.trigger("render:after",this),this.recent&&this.menuRoot.find("> li:first").addClass("border-top"),this.loadRecent(),this},resetItems:function(t){this.items=t||[],this.$items=null;var e=_.template(["<% _.each(items, function(item) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>","<% item.checked = item.checked || false;  %>","<li><%= itemTemplate(item) %></li>","<% }) %>"].join(""));this.cmpEl&&this.cmpEl.html(e({items:this.items,itemTemplate:this.itemTemplate,options:this.options})),this.recent&&this.menuRoot&&this.menuRoot.find("> li:first").addClass("border-top"),this.loadRecent()},isVisible:function(){return this.rendered&&this.cmpEl.is(":visible")},show:function(){this.rendered&&this.parentEl&&!this.parentEl.hasClass("open")&&this.cmpEl.dropdown("toggle")},hide:function(){this.rendered&&this.parentEl&&(this.parentEl.hasClass("open")?this.cmpEl.dropdown("toggle"):this.parentEl.hasClass("over")&&this.parentEl.removeClass("over"))},onItemClick:function(t){if(1!=t.which&&void 0!==t.which)return!1;var e=$(t.currentTarget).closest("li").index(),i=e>=0?this.items[e]:null;if(i){if(i.disabled)return!1;if(i.checkable&&!i.checked&&this.setChecked(e,!i.checked),this.isOver=!1,i.stopPropagation){t.stopPropagation();var o=this;_.delay((function(){o.$el.parent().parent().find("[data-toggle=dropdown]").focus()}),10)}else this.addItemToRecent(i),this.trigger("item:click",this,i,t)}},onItemMouseDown:function(t){if(1!=t.which)return t.preventDefault(),t.stopPropagation(),!1;t.stopPropagation()},setChecked:function(t,e,i){this.toggle(t,e,i)},toggle:function(t,e,i){var o=!!e,n=this.items[t];if(this.clearAll(),n&&n.checkable){if(n.checked=o,this.rendered){var s=n.el||this.cmpEl.find("#"+n.id);s&&(s.toggleClass("checked",n.checked),_.isEmpty(n.iconCls)||s.css("background-image","none"))}i||this.trigger("item:toggle",this,n,o)}},setDisabled:function(t){this.disabled=!!t,this.rendered&&this.cmpEl.toggleClass("disabled",this.disabled)},isDisabled:function(){return this.disabled},onBeforeShowMenu:function(t){this.loadRecent(),Common.NotificationCenter.trigger("menu:show"),this.trigger("show:before",this,t),t&&t.target===t.currentTarget&&this.alignPosition()},onAfterShowMenu:function(t){if(this.trigger("show:after",this,t),this.scroller&&t&&t.target===t.currentTarget){this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible});var e=this.menuRoot;if(this.recent&&this.recentArr&&this.recentArr.length)e.scrollTop(0);else{var i=e.find("> li .checked");if(i.length){var o=Common.Utils.getPosition(i).top,n=i.outerHeight(),s=e.outerHeight();if(this.options.scrollToCheckedItem&&(o<0||o+n>s)){var a=e.scrollTop()+o+(n-s)/2;a=Math.floor(a/n)*n,e.scrollTop(a)}this.options.focusToCheckedItem&&setTimeout((function(){i.focus()}),1)}}}if(this._search={},this.search&&!this.$items){var r=this;this.$items=this.menuRoot.find("> li").find("> a"),_.each(this.$items,(function(t,e){r.items[e].el=$(t)}))}},onBeforeHideMenu:function(t){this.trigger("hide:before",this,t),Common.UI.Scroller.isMouseCapture()&&t.preventDefault()},onAfterHideMenu:function(t,e){this.trigger("hide:after",this,t,e),Common.NotificationCenter.trigger("menu:hide",this,e)},onAfterKeydownMenu:function(t){if(t.keyCode==Common.UI.Keys.RETURN){var e=$(t.target).closest("li");if(e.length<=0&&(e=$(t.target).parent().find("li .dataview")),e.length>0&&e.click(),e.hasClass("dropdown-submenu")||Common.UI.Menu.Manager.hideAll(),$(t.currentTarget).closest("li").hasClass("dropdown-submenu"))return t.stopPropagation(),!1}else if(t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN)this.fromKeyDown=!0;else if(t.keyCode==Common.UI.Keys.ESC);else if(this.search&&t.keyCode>64&&t.keyCode<91&&t.key){var i=this;clearTimeout(this._search.timer),this._search.timer=setTimeout((function(){i._search={}}),1e3),!this._search.text&&(this._search.text=""),!this._search.char&&(this._search.char=t.key),this._search.char!==t.key&&(this._search.full=!0),this._search.text+=t.key,void 0===this._search.index&&(this._search.index=this.$items.index(this.$items.filter(":focus"))),this.selectCandidate()}},selectCandidate:function(){for(var t,e,i=this,o=this._search.index&&-1!=this._search.index?this._search.index:0,n=new RegExp("^"+(this._search.full?this._search.text:this._search.char),"i"),s=this.options.searchFields.some((function(t){return n.test(i.items[o][t])})),a=0;a<this.items.length;a++){var r=this.items[a],l=!1;if(this.options.searchFields.forEach((function(c){if(r[c]&&n.test(r[c])){if(!t&&(t=r,e=a,!s))return void(l=!0);if(i._search.full&&a==o||a>o)return t=r,e=a,void(l=!0)}})),l)break}if(t){this._search.index=e;r=t.el;if(this.scroller){this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible});var c=Common.Utils.getPosition(r).top,h=r.outerHeight(),d=this.menuRoot.outerHeight();if(c<0||c+h>d){var m=this.menuRoot.scrollTop()+c;m=Math.floor(m/h)*h,this.menuRoot.scrollTop(m)}}r.focus()}},setOffset:function(t,e){this.offset[0]=_.isUndefined(t)?this.offset[0]:t,this.offset[1]=_.isUndefined(e)?this.offset[1]:e,this.alignPosition()},getOffset:function(){return this.offset},alignPosition:function(t,e){var i=this.menuRoot,o=this.menuAlignEl||i.parent(),n=this.menuAlign.match(/^([a-z]+)-([a-z]+)/),s=Common.Utils.getOffset(o),a=Common.Utils.innerWidth(),r=Common.Utils.innerHeight()-10,l=i.outerWidth(),c=i.outerHeight(),h=o.outerWidth(),d=o.outerHeight(),m={tl:[0,0],bl:[0,c],tr:[l,0],br:[l,c]},p={tl:[0,0],tr:[h,0],bl:[0,d],br:[h,d]},u=s.left-m[n[1]][0]+p[n[2]][0]+this.offset[0],g=s.top-m[n[1]][1]+p[n[2]][1]+this.offset[1];u+l>a?u=o.is("li.dropdown-submenu")?s.left-l+2:a-l:u<0&&(u=o.is("li.dropdown-submenu")?s.left+h-2:0),u<0&&(u=0),this.options.restoreHeight?"number"==typeof this.options.restoreHeight&&(g+c>r?(i.css("max-height",r-g+"px"),!this.scroller&&(this.scroller=new Common.UI.Scroller({el:this.$el.find(".dropdown-menu "),minScrollbarLength:30,suppressScrollX:!0,alwaysVisibleY:this.scrollAlwaysVisible}))):g+c<r&&i.height()<this.options.restoreHeight&&i.css("max-height",Math.min(r-g,this.options.restoreHeight)+"px")):(g+c>r&&(t&&"string"==typeof t?(n=t.match(/^([a-z]+)-([a-z]+)/),g=s.top-m[n[1]][1]+p[n[2]][1]+this.offset[1]+(e||0)):g=r-c),g<0&&(g=0)),this.options.additionalAlign?this.options.additionalAlign.call(this,i,u,g):i.css({left:Math.ceil(u),top:Math.ceil(g)})},clearAll:function(){this.cmpEl&&this.cmpEl.find("li > a.checked").removeClass("checked"),_.each(this.items,(function(t){t.checked=!1}))},setRecent:function(t){var e=Common.localStorage.getKeysFilter();this.recent=!!t&&{count:t.count||5,key:t.key||(e&&e.length?e.split(",")[0]:"")+this.id,offset:t.offset||0,valueField:t.valueField||"caption"}},loadRecent:function(){if(this.recent&&this.rendered){this.recentArr||(this.recentArr=[]);var t=_.findWhere(this.items,{checked:!0});this.clearRecent();var e=this,i=Common.localStorage.getItem(this.recent.key);if((i=i?i.split(";"):[]).reverse().forEach((function(t){var i=_.find(e.items,(function(i){return i[e.recent.valueField]===t}));i&&e.addItemToRecent(i,!0,0)})),this.recentArr=i,t){var o,n=_.findIndex(e.items,((o={})[e.recent.valueField]=t[e.recent.valueField],o));n>-1&&e.setChecked(n,!0,!0)}}},clearRecent:function(){for(var t=0;t<this.items.length&&this.items[t].isRecent;t++)this.onRemoveRecentItem(this.items[t]),this.items.splice(t,1),t--},addItemToRecent:function(t,e,i){if(t&&this.recent){for(var o=0;o<this.items.length&&this.items[o].isRecent;o++)if(this.items[o][this.recent.valueField]===t[this.recent.valueField]){if(o<this.recent.offset)return;this.onRemoveRecentItem(this.items[o]),this.items.splice(o,1);break}for(var n=0,s=0;s<this.items.length&&this.items[s].isRecent;s++)n++;n<this.recent.count||(this.onRemoveRecentItem(this.items[this.recent.count-1]),this.items.splice(this.recent.count-1,1));var a=Object.assign({},t);if(a.isRecent=!0,a.id=Common.UI.getId(),a.checked=!1,this.items.splice(void 0!==i?i:this.recent.offset,0,a),this.onInsertRecentItem(a,void 0!==i?i:this.recent.offset),!e){for(var r=[],l=0;l<this.items.length&&this.items[l].isRecent;l++)r.push(this.items[l][this.recent.valueField]);this.recentArr=r,Common.localStorage.setItem(this.recent.key,r.join(";"))}this.$items=null}},onInsertRecentItem:function(t,e){if(this.cmpEl){var i=$(_.template("<li><%= itemTemplate(item) %></li>")({itemTemplate:this.itemTemplate,item:t}));this.cmpEl.find("> li").eq(e||0).before(i),i&&(t.el=i.find("> a"))}},onRemoveRecentItem:function(t){this.cmpEl&&this.cmpEl.find("> li a#"+t.id).closest("li").remove()}})})),void 0===Common)var Common={};define("common/main/lib/component/Calendar",["common/main/lib/component/BaseView","common/main/lib/util/utils"],(function(){"use strict";Common.UI.Calendar=Common.UI.BaseView.extend(_.extend({template:_.template(['<div id="calendar" class="calendar-box">','<div class="calendar-header">','<div class="top-row">','<div id="prev-arrow"><button type="button"><i class="arrow-prev img-commonctrl"></i></button></div>','<div class="title"></div>','<div id="next-arrow"><button type="button"><i class="arrow-next img-commonctrl" /></button></div>',"</div>",'<div class="bottom-row"></div>',"</div>",'<div class="calendar-content"></div>',"</div>"].join("")),options:{date:void 0,firstday:0},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.monthNames=[this.textJanuary,this.textFebruary,this.textMarch,this.textApril,this.textMay,this.textJune,this.textJuly,this.textAugust,this.textSeptember,this.textOctober,this.textNovember,this.textDecember],this.dayNamesShort=[this.textShortSunday,this.textShortMonday,this.textShortTuesday,this.textShortWednesday,this.textShortThursday,this.textShortFriday,this.textShortSaturday],this.monthShortNames=[this.textShortJanuary,this.textShortFebruary,this.textShortMarch,this.textShortApril,this.textShortMay,this.textShortJune,this.textShortJuly,this.textShortAugust,this.textShortSeptember,this.textShortOctober,this.textShortNovember,this.textShortDecember],e.options.date=t.date,_.isUndefined(t.firstday)||0!==t.firstday&&1!==t.firstday||(e.options.firstday=t.firstday),e.enableKeyEvents=e.options.enableKeyEvents,e._state=void 0,e.render()},render:function(){var t=this;return t.cmpEl=t.$el||$(this.el),t.cmpEl.html(this.template()),t.currentDate=t.options.date||new Date,t.btnPrev=new Common.UI.Button({parentEl:t.cmpEl.find("#prev-arrow"),cls:"",scaling:!1,iconCls:"arrow-prev img-commonctrl"}),t.btnPrev.on("click",_.bind(t.onClickPrev,t)),t.btnNext=new Common.UI.Button({parentEl:t.cmpEl.find("#next-arrow"),cls:"",scaling:!1,iconCls:"arrow-next img-commonctrl"}),t.btnNext.on("click",_.bind(t.onClickNext,t)),t.cmpEl.on("keydown",(function(e){t.trigger("calendar:keydown",t,e)})),t.renderMonth(t.currentDate),this.trigger("render:after",this),this},onClickPrev:function(){var t=this;if(0===t._state)(e=new Date(t.currentDate)).setMonth(e.getMonth()-1),e.getFullYear()>0&&t.renderMonth(e);else if(1===t._state){var e;(e=new Date(t.currentDate)).setFullYear(e.getFullYear()-1),e.getFullYear()>0&&t.renderMonths(e)}else if(2===t._state){var i,o=t.currentDate.getFullYear();o%10!=0?(i=String(o),i=Number(i.slice(0,-1)+"0")-1):i=o-1,i>0&&(t.currentDate.setFullYear(i),t.renderYears(i))}},onClickNext:function(){var t=this;if(0===t._state)(e=new Date(t.currentDate)).setMonth(e.getMonth()+1),e.getFullYear()>0&&t.renderMonth(e);else if(1===t._state){var e;(e=new Date(t.currentDate)).setFullYear(e.getFullYear()+1),e.getFullYear()>0&&t.renderMonths(e)}else if(2===t._state){var i,o=t.currentDate.getFullYear();o%10!=9?(i=String(o),i=Number(i.slice(0,-1)+"9")+1):i=o+1,i>0&&(t.currentDate.setFullYear(i),t.renderYears(i))}},renderYears:function(t){var e=this;t=_.isNumber(t)?t:e.currentDate?e.currentDate.getFullYear():(new Date).getFullYear();e._state=2,e.$el.removeClass("view-days view-months").addClass("view-years");var i=t,o=t;if(i%10!=0){var n=String(t);i=Number(n.slice(0,-1)+"0")}if(o%10!=9){n=String(t);o=Number(n.slice(0,-1)+"9")}e.topTitle=_.template(["<label>"+i+"-"+o+"</label>"].join("")),e.cmpEl.find(".calendar-header .title").html(e.topTitle),e.bottomTitle=_.template(["<label>"+e.textYears+"</label>"].join("")),e.cmpEl.find(".calendar-header .bottom-row").html(e.bottomTitle);for(var s=[],a=i-3,r=0;r<16;r++)s.push({year:a>0?a:"",isCurrentDecade:a>=i&&a<=o,disabled:!(a>0),selected:_.isDate(e.selectedDate)?a===e.selectedDate.getFullYear():a===(new Date).getFullYear()}),a++;e.yearPicker?e.yearPicker.store.reset(s):(e.yearPicker=new Common.UI.DataView({el:e.cmpEl.find(".calendar-content"),store:new Common.UI.DataViewStore(s),itemTemplate:_.template('<div class="name-year <% if (!isCurrentDecade) { %> no-current-decade <% } %>" data-year="<%= year %>"><%= year %></div>')}),e.yearPicker.on("item:click",(function(t,i,o,n){var s=o.get("year"),a=new Date;a.setFullYear(s),e.renderMonths(a)})),e.enableKeyEvents&&this.yearPicker.on("item:keydown",(function(t,e,i){i.keyCode==Common.UI.Keys.ESC&&Common.NotificationCenter.trigger("dataview:blur")}))),e.enableKeyEvents&&_.delay((function(){e.monthPicker.focus()}),10)},renderMonths:function(t){var e=this,i=_.isDate(t)?t:e.currentDate?e.currentDate:new Date,o=i.getFullYear();e._state=1,e.currentDate=i,e.$el.removeClass("view-years view-days").addClass("view-months"),e.topTitle=_.template(['<div class="button"><label>'+o+"</label></div>"].join("")),e.cmpEl.find(".calendar-header .title").html(e.topTitle),e.cmpEl.find(".calendar-header .title").off(),e.cmpEl.find(".calendar-header .title").on("click",_.bind(e.renderYears,e)),e.bottomTitle=_.template(["<label>"+e.textMonths+"</label>"].join("")),e.cmpEl.find(".calendar-header .bottom-row").html(e.bottomTitle);for(var n=[],s=new Date,a=0;a<12;a++)n.push({indexMonth:a,nameMonth:e.monthShortNames[a],year:o,curYear:!0,isCurrentMonth:a===i.getMonth(),selected:_.isDate(e.selectedDate)?a===e.selectedDate.getMonth()&&o===e.selectedDate.getFullYear():a===s.getMonth()&&o===s.getFullYear()});o+=1;for(a=0;a<4;a++)n.push({indexMonth:a,nameMonth:e.monthShortNames[a],year:o,curYear:!1,selected:_.isDate(e.selectedDate)?a===e.selectedDate.getMonth()&&o===e.selectedDate.getFullYear():a===s.getMonth()&&o===s.getFullYear()});e.monthsPicker?e.monthsPicker.store.reset(n):(e.monthsPicker=new Common.UI.DataView({el:e.cmpEl.find(".calendar-content"),store:new Common.UI.DataViewStore(n),itemTemplate:_.template('<div class="name-month <% if (!curYear) { %> no-cur-year <% } %>" data-month="<%= indexMonth %>" data-year="<%= year %>"><%= nameMonth %></div>')}),e.monthsPicker.on("item:click",(function(t,i,o,n){var s=o.get("indexMonth"),a=o.get("year"),r=new Date;r.setFullYear(a,s),e.renderMonth(r)})),e.enableKeyEvents&&this.monthsPicker.on("item:keydown",(function(t,e,i){i.keyCode==Common.UI.Keys.ESC&&Common.NotificationCenter.trigger("dataview:blur")}))),e.enableKeyEvents&&_.delay((function(){e.monthPicker.focus()}),10)},renderMonth:function(t){var e=this;e._state=0;var i=e.options.firstday,o=t||new Date,n=o.getMonth(),s=(o.getDay(),o.getDate(),o.getFullYear());e.currentDate=o,e.$el.removeClass("view-years view-months").addClass("view-days"),e.topTitle=_.template(['<div class="button">',"<label>"+e.monthNames[n]+" "+s+"</label>","</div>"].join("")),e.cmpEl.find(".calendar-header .title").html(e.topTitle),e.cmpEl.find(".calendar-header .title").off(),e.cmpEl.find(".calendar-header .title").on("click",_.bind(e.renderMonths,e));for(var a="",r=i;r<7;r++)a+="<label>"+e.dayNamesShort[r]+"</label>";i>0&&(a+="<label>"+e.dayNamesShort[0]+"</label>"),e.cmpEl.find(".calendar-header .bottom-row").html(_.template(a));var l=[],c=new Date(o);c.setDate(1);var h,d,m,p=c.getDay(),u=e.daysInMonth(c.getTime()-864e6);h=0===i?p>0?u-(p-1):1:0===p?u-5:u-(p-2),p>0&&0===i||1===i?n-1>=0?(d=n-1,m=s):(d=11,m=s-1):(d=n,m=s);var g=new Date;g.setFullYear(m,d,h);for(var f=new Date,b=0;b<6;b++)for(var C=0;C<7;C++){var v=g.getDay(),w=g.getDate(),A=g.getMonth(),y=g.getFullYear();l.push({indexInWeek:v,dayNumber:w,month:A,year:y,isCurrentMonth:A===n,selected:_.isDate(e.selectedDate)?w===e.selectedDate.getDate()&&A===e.selectedDate.getMonth()&&y===e.selectedDate.getFullYear():w===f.getDate()&&A===f.getMonth()&&y===f.getFullYear()}),g.setDate(w+1)}e.monthPicker?e.monthPicker.store.reset(l):(e.monthPicker=new Common.UI.DataView({el:e.cmpEl.find(".calendar-content"),store:new Common.UI.DataViewStore(l),itemTemplate:_.template('<div class="number-day<% if (indexInWeek === 6 || indexInWeek === 0) { %> weekend<% } %><% if (!isCurrentMonth) { %> no-current-month<% } %>" data-number="<%= dayNumber %>" data-month="<%= month %>" data-year="<%= year %>"><%= dayNumber %></div>')}),e.monthPicker.on("item:click",(function(t,i,o,n){var s=o.get("dayNumber"),a=o.get("month"),r=o.get("year");_.isUndefined(e.selectedDate)&&(e.selectedDate=new Date),e.selectedDate.setFullYear(r,a,s),e.trigger("date:click",e,e.selectedDate)})),e.enableKeyEvents&&this.monthPicker.on("item:keydown",(function(t,e,i){i.keyCode==Common.UI.Keys.ESC&&Common.NotificationCenter.trigger("dataview:blur")}))),e.enableKeyEvents&&_.delay((function(){e.monthPicker.focus()}),10)},daysInMonth:function(t){var e;e=t?new Date(t):new Date;var i=new Date;return i.setFullYear(e.getFullYear(),e.getMonth()+1,0),i.getDate()},setDate:function(t){_.isDate(t)&&(this.selectedDate=new Date(t),this.renderMonth(this.selectedDate))},focus:function(){var t=this;t.enableKeyEvents&&t.monthPicker&&_.delay((function(){t.monthPicker.focus()}),10)},textJanuary:"January",textFebruary:"February",textMarch:"March",textApril:"April",textMay:"May",textJune:"June",textJuly:"July",textAugust:"August",textSeptember:"September",textOctober:"October",textNovember:"November",textDecember:"December",textShortJanuary:"Jan",textShortFebruary:"Feb",textShortMarch:"Mar",textShortApril:"Apr",textShortMay:"May",textShortJune:"Jun",textShortJuly:"Jul",textShortAugust:"Aug",textShortSeptember:"Sep",textShortOctober:"Oct",textShortNovember:"Nov",textShortDecember:"Dec",textShortSunday:"Su",textShortMonday:"Mo",textShortTuesday:"Tu",textShortWednesday:"We",textShortThursday:"Th",textShortFriday:"Fr",textShortSaturday:"Sa",textMonths:"Months",textYears:"Years"},Common.UI.Calendar||{}))})),define("common/main/lib/view/OpenDialog",["common/main/lib/component/Window"],(function(){"use strict";Common.Views.OpenDialog=Common.UI.Window.extend(_.extend({applyFunction:void 0,initialize:function(t){var e=this,i={};_.extend(i,{closable:!1,preview:t.preview,warning:t.warning,codepages:t.codepages,warningMsg:t.warningMsg,width:t.preview?414:t.type!==Common.Utils.importTextType.DRM?340:t.warning?420:280,header:!0,cls:"modal-dlg open-dlg",contentTemplate:"",toolcallback:_.bind(e.onToolClose,e),closeFile:!1,buttons:["ok"].concat(t.closeFile?[{value:"cancel",caption:this.closeButtonText}]:[]).concat(t.closable?["cancel"]:[])},t),this.txtOpenFile=t.txtOpenFile||this.txtOpenFile,this.template=t.template||['<div class="box">','<div class="content-panel" >',"<% if (type == Common.Utils.importTextType.DRM) { %>","<% if (warning) { %>","<div>",'<div class="icon warn"></div>','<div class="padding-left-50"><div style="font-size: 12px;word-break:break-word;">'+("string"==typeof i.warningMsg?i.warningMsg:e.txtProtected)+"</div>",'<label class="header" style="margin-top: 15px;">'+e.txtPassword+"</label>",'<div id="id-password-txt" style="width: 290px;"></div></div>',"</div>","<% } else { %>","<div>",'<label class="">'+e.txtOpenFile+"</label>",'<div id="id-password-txt"></div>',"</div>","<% } %>","<% } else { %>","<% if (codepages && codepages.length>0) { %>",'<div <% if (!!preview && (type == Common.Utils.importTextType.CSV || type == Common.Utils.importTextType.Paste || type == Common.Utils.importTextType.Columns)) { %> class="margin-right-10" style="width: 230px;display: inline-block;" <% } else { %> style="width: 100%;"<% } %> >','<label class="header">'+e.txtEncoding+"</label>","<div>",'<div id="id-codepages-combo" class="input-group-nr" style="width: 100%; display: inline-block; vertical-align: middle;"></div>',"</div>","</div>","<% } %>","<% if (type == Common.Utils.importTextType.CSV) { %>",'<div style="display: inline-block; <% if (!preview) { %> margin-top:15px;<% } %>">','<label class="header">'+e.txtDelimiter+"</label>","<div>",'<div id="id-delimiters-combo" class="input-group-nr" style="max-width: 100px;display: inline-block; vertical-align: middle;"></div>','<div id="id-delimiter-other" class="input-row margin-left-10" style="display: inline-block; vertical-align: middle;"></div>',"</div>","</div>","<% } %>","<% if (type == Common.Utils.importTextType.Paste || type == Common.Utils.importTextType.Columns || type == Common.Utils.importTextType.Data) { %>",'<div style="display: inline-block; <% if (codepages && codepages.length>0) { %>margin-top:15px;<% } %>width: 100%;">','<label class="header">'+e.txtDelimiter+"</label>","<div>",'<div id="id-delimiters-combo" class="input-group-nr" style="max-width: 100px;display: inline-block; vertical-align: middle;"></div>','<div id="id-delimiter-other" class="input-row margin-left-10" style="display: inline-block; vertical-align: middle;"></div>','<button type="button" class="btn auto btn-text-default float-right" id="id-delimiters-advanced" style="min-width:100px; display: inline-block;">'+e.txtAdvanced+"</button>","</div>","</div>","<% } %>","<% if (!!preview) { %>",'<div style="margin-top:15px;">','<label class="header">'+e.txtPreview+"</label>",'<div style="position: relative;">','<div style="width: 100%;">','<div id="id-preview">',"<div>",'<div style="position: absolute; top: 0;"><div id="id-preview-data"></div></div>',"</div>","</div>","</div>","</div>","</div>","<% } %>","<% if (type == Common.Utils.importTextType.Data) { %>",'<label class="header" style="margin-top:15px;">'+e.txtDestData+"</label>",'<div id="id-open-data-range" class="input-row" style="width: 100%;"></div>',"<% } %>","<% } %>","</div>","</div>"].join(""),this.handler=i.handler,this.type=i.type,this.preview=i.preview,this.previewData=i.previewData,this.warning=i.warning||!1,this.closable=i.closable,this.codepages=i.codepages,this.settings=i.settings,this.api=i.api,this.validatePwd=i.validatePwd||!1,this.detectedDelimiter=!1,i.tpl=_.template(this.template)(i),this._previewTdWidth=[],this._previewTdMaxLength=0,Common.UI.Window.prototype.initialize.call(this,i)},render:function(){if(Common.UI.Window.prototype.render.call(this),this.$window){var t=this;this.closable||this.$window.find(".tool").hide(),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.previewPanel=this.$window.find("#id-preview-data"),this.previewParent=this.previewPanel.parent(),this.previewScrolled=this.$window.find("#id-preview"),this.previewInner=this.previewScrolled.find("> div:first-child"),this.type==Common.Utils.importTextType.DRM?this.inputPwd=new Common.UI.InputFieldBtnPassword({el:$("#id-password-txt"),type:"password",showCls:("svg"===this.options.iconType?"svg-icon":"toolbar__icon")+" btn-sheet-view",hideCls:"svg"===this.options.iconType?"svg-icon hide-password":"toolbar__icon btn-hide-password",maxLength:this.options.maxPasswordLength,validateOnBlur:!1,showPwdOnClick:!1,validation:function(e){return t.txtIncorrectPwd}}):(this.initCodePages(),this.preview&&(this.previewData?this.textCallback(this.previewData):this.updatePreview())),this.type==Common.Utils.importTextType.Data&&(this.txtDestRange=new Common.UI.InputFieldBtn({el:$("#id-open-data-range"),name:"range",style:"width: 100%;",btnHint:this.textSelectData,allowBlank:!0,validateOnChange:!0,validateOnBlur:!1}),this.txtDestRange.on("button:click",_.bind(this.onSelectData,this)),this.dataDestValid=this.api.asc_getActiveRangeStr(Asc.referenceType.A,!0),this.txtDestRange.setValue(this.dataDestValid)),this.onPrimary=function(){return t._handleInput("ok"),!1}}},getFocusedComponents:function(){var t=[];return this.inputPwd&&t.push(this.inputPwd),this.cmbEncoding&&t.push(this.cmbEncoding),this.cmbDelimiter&&t.push(this.cmbDelimiter),this.inputDelimiter&&t.push(this.inputDelimiter),this.btnAdvanced&&t.push(this.btnAdvanced),this.txtDestRange&&t.push(this.txtDestRange),t.concat(this.getFooterButtons())},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var t=this;if(this.type==Common.Utils.importTextType.DRM)setTimeout((function(){t.inputPwd.focus(),t.validatePwd&&t.inputPwd.checkValidate()}),500);else{var e=t.txtDestRange?t.txtDestRange:t.cmbEncoding?t.cmbEncoding:t.cmbDelimiter;e&&setTimeout((function(){e.focus()}),500)}},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onToolClose:function(){this._handleInput("cancel")},_handleInput:function(t){if(this.handler)if(this.type==Common.Utils.importTextType.DRM)this.handler.call(this,t,{drmOptions:new Asc.asc_CDRMAdvancedOptions(this.inputPwd.getValue())});else{if(this.type==Common.Utils.importTextType.Data&&"ok"==t&&!this.isRangeValid())return;var e=this.cmbEncoding&&!this.cmbEncoding.isDisabled()?this.cmbEncoding.getValue():this.settings&&this.settings.asc_getCodePage()?this.settings.asc_getCodePage():0,i=this.cmbDelimiter?this.cmbDelimiter.getValue():null,o=-1==i?this.inputDelimiter.getValue():null;-1==i&&(i=null),this.type===Common.Utils.importTextType.TXT?this._isEncodingChanged&&Common.localStorage.setItem("de-settings-open-encoding",e):this.type===Common.Utils.importTextType.CSV?(this._isDelimChanged&&Common.localStorage.setItem("sse-settings-csv-delimiter",null===i?-1:i),this._isDelimCharChanged&&Common.localStorage.setItem("sse-settings-csv-delimiter-char",o||""),this._isEncodingChanged&&Common.localStorage.setItem("sse-settings-csv-encoding",e)):this.type!==Common.Utils.importTextType.Paste&&this.type!==Common.Utils.importTextType.Columns&&this.type!==Common.Utils.importTextType.Data||(this._isDelimChanged&&Common.localStorage.setItem("sse-settings-data-delimiter",null===i?-1:i),this._isDelimCharChanged&&Common.localStorage.setItem("sse-settings-data-delimiter-char",o||""),this._isEncodingChanged&&Common.localStorage.setItem("sse-settings-data-encoding",e));var n=this.separatorOptions?this.separatorOptions.decimal:void 0,s=this.separatorOptions?this.separatorOptions.thousands:void 0,a=this.separatorOptions?this.separatorOptions.qualifier:'"',r=new Asc.asc_CTextOptions(e,i,o);n&&r.asc_setNumberDecimalSeparator(n),s&&r.asc_setNumberGroupSeparator(s),a&&r.asc_setTextQualifier(a),this.handler.call(this,t,{textOptions:r,range:this.txtDestRange?this.txtDestRange.getValue():"",data:this.data})}this.close()},initCodePages:function(){var t,e,i,o,n=[],s=[],a=0,r=0;if(this.codepages){for(n=[],t=0;t<this.codepages.length;++t)i=this.codepages[t],(e=[])[0]=i.asc_getCodePage(),e[1]=i.asc_getCodePageName(),e[2]=i.asc_getLcid(),65001===e[2]&&(r=t),n.push(e);a=50}if(o=n.length){for(t=0;t<o;++t)s.push({value:n[t][0],displayValue:Common.Utils.String.htmlEncode(n[t][1]),lcid:n[t][2]||""});var l=_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">','<div style="display: inline-block;"><%= item.displayValue %></div>','<label class="text-align-right" style="width:'+a+'px;"><%= item.lcid %></label>',"</a></li>","<% }); %>"].join(""));this.cmbEncoding=new Common.UI.ComboBox({el:$("#id-codepages-combo",this.$window),style:"width: 100%;",menuStyle:"min-width: 100%; max-height: 200px;",cls:"input-group-nr",menuCls:"scrollable-menu",data:s,editable:!1,disabled:!0,search:!0,itemsTemplate:l,takeFocusOnClose:!0}),this.cmbEncoding.setDisabled(!1);var c=this.settings&&this.settings.asc_getCodePage()?this.settings.asc_getCodePage():n[r][0];if(-1===c){if(this.type==Common.Utils.importTextType.TXT)(p=Common.localStorage.getItem("de-settings-open-encoding"))&&(c=parseInt(p));else if(this.type===Common.Utils.importTextType.CSV){(p=Common.localStorage.getItem("sse-settings-csv-encoding"))&&(c=parseInt(p))}else if(this.type===Common.Utils.importTextType.Data){(p=Common.localStorage.getItem("sse-settings-data-encoding"))&&(c=parseInt(p))}-1===c&&(c=n[r][0])}this.cmbEncoding.setValue(c),this.cmbEncoding.on("selected",_.bind(this.onCmbEncodingSelect,this));var h=this.cmbEncoding.cmpEl.find("ul"),d=h.find("li:nth(0) a"),m=h.width()-parseInt(d.css("padding-left"))-parseInt(d.css("padding-right"))-50;h.find("li div").width(m)}if(this.type==Common.Utils.importTextType.CSV||this.type==Common.Utils.importTextType.Paste||this.type==Common.Utils.importTextType.Columns||this.type==Common.Utils.importTextType.Data){var p,u="",g="";if(!this.preview)u=this.settings&&this.settings.asc_getDelimiter()?this.settings.asc_getDelimiter():4,g=this.settings&&this.settings.asc_getDelimiterChar()?this.settings.asc_getDelimiterChar():"",(p=Common.localStorage.getItem(this.type==Common.Utils.importTextType.CSV?"sse-settings-csv-delimiter":"sse-settings-data-delimiter"))&&(p=parseInt(p),isNaN(p)||-1===(u=p)&&(g=Common.localStorage.getItem(this.type==Common.Utils.importTextType.CSV?"sse-settings-csv-delimiter-char":"sse-settings-data-delimiter-char")||""));this.cmbDelimiter=new Common.UI.ComboBox({el:$("#id-delimiters-combo",this.$window),style:"width: 100px;",menuStyle:"min-width: 100px;",cls:"input-group-nr",data:[{value:4,displayValue:this.txtComma},{value:2,displayValue:this.txtSemicolon},{value:3,displayValue:this.txtColon},{value:1,displayValue:this.txtTab},{value:5,displayValue:this.txtSpace},{value:-1,displayValue:this.txtOther}],editable:!1,takeFocusOnClose:!0}),this.cmbDelimiter.setValue(u),this.cmbDelimiter.on("selected",_.bind(this.onCmbDelimiterSelect,this)),this.inputDelimiter=new Common.UI.InputField({el:$("#id-delimiter-other"),style:"width: 30px;",maxLength:1,validateOnChange:!0,validateOnBlur:!1,value:g}),this.inputDelimiter.setVisible(-1===u),this.inputDelimiter.on("changing",_.bind(this.onInputCharChanging,this)),this.type!=Common.Utils.importTextType.Paste&&this.type!=Common.Utils.importTextType.Columns&&this.type!=Common.Utils.importTextType.Data||(this.btnAdvanced=new Common.UI.Button({el:$("#id-delimiters-advanced")}),this.btnAdvanced.on("click",_.bind(this.onAdvancedClick,this)))}},updatePreview:function(){this._previewTdWidth=[],this._previewTdMaxLength=0;var t=this.cmbEncoding&&!this.cmbEncoding.isDisabled()?this.cmbEncoding.getValue():this.settings&&this.settings.asc_getCodePage()?this.settings.asc_getCodePage():0;switch(this.type){case Common.Utils.importTextType.CSV:case Common.Utils.importTextType.TXT:case Common.Utils.importTextType.Data:this.api.asc_decodeBuffer(this.preview,t,_.bind(this.textCallback,this));break;case Common.Utils.importTextType.Paste:case Common.Utils.importTextType.Columns:this.api.asc_TextImport(t,_.bind(this.textCallback,this),this.type==Common.Utils.importTextType.Paste)}},textCallback:function(t){var e,i,o=this.cmbEncoding&&!this.cmbEncoding.isDisabled()?this.cmbEncoding.getValue():this.settings&&this.settings.asc_getCodePage()?this.settings.asc_getCodePage():0;if(this.detectedDelimiter||this.type===Common.Utils.importTextType.TXT)i=-1==(e=this.cmbDelimiter?this.cmbDelimiter.getValue():null)?this.inputDelimiter.getValue():null;else{var n=this.api.asc_getCSVDelimiter(t);t=n.text,i=-1===(e=n.delimiter||-1)&&n.delimiterChar||"",this.cmbDelimiter.setValue(e),this.inputDelimiter.setVisible(-1===e),this.inputDelimiter.setValue(i),this.detectedDelimiter=!0}var s=new Asc.asc_CTextOptions(o,e,i);this.separatorOptions&&(s.asc_setNumberDecimalSeparator(this.separatorOptions.decimal),s.asc_setNumberGroupSeparator(this.separatorOptions.thousands),s.asc_setTextQualifier(this.separatorOptions.qualifier)),this.previewCallback(this.api.asc_parseText(t,s))},previewCallback:function(t){t&&t.length&&(this.data=t,this.previewInner.height(17*t.length),this.scrollerY||(this.scrollerY=new Common.UI.Scroller({el:this.previewScrolled,minScrollbarLength:20,alwaysVisibleY:!0,alwaysVisibleX:!0,onChange:_.bind((function(){if(this.scrollerY){var t=this.scrollerY.getScrollTop(),e=Math.floor(t/17+.5),i=e+Math.min(6,this.data.length);i>this.data.length&&(i=this.data.length,t=17*(e=this.data.length-6)),this.previewParent.height(108),this.previewParent.css({top:t}),this.previewDataBlock(this.data.slice(e,i))}}),this)})),this.scrollerY.update(),this.scrollerY.scrollTop(0))},previewDataBlock:function(t){if(_.isUndefined(this.scrollerX)||(this.scrollerX.destroy(),delete this.scrollerX),this.type==Common.Utils.importTextType.CSV||this.type==Common.Utils.importTextType.Paste||this.type==Common.Utils.importTextType.Columns||this.type==Common.Utils.importTextType.Data){for(var e=0,i=0;i<t.length;i++){(n=t[i]||"").length>e&&(e=n.length)}this._previewTdMaxLength=Math.max(this._previewTdMaxLength,e);var o="<table>";for(i=0;i<t.length;i++){var n=t[i]||"";o+='<tr style="vertical-align: top;">';for(var s=0;s<n.length;s++){var a="";0==i&&this._previewTdWidth[s]&&(a='style="min-width:'+this._previewTdWidth[s]+'px;"'),o+="<td "+a+">"+Common.Utils.String.htmlEncode(n[s])+"</td>"}for(s=n.length;s<this._previewTdMaxLength;s++){a="";0==i&&this._previewTdWidth[s]&&(a='style="min-width:'+this._previewTdWidth[s]+'px;"'),o+="<td "+a+"></td>"}o+="</tr>"}o+="</table>"}else{for(o="<table>",i=0;i<t.length;i++){n=t[i]||"";o+='<tr style="vertical-align: top;"><td>'+Common.Utils.String.htmlEncode(n)+"</td></tr>"}o+="</table>"}if(this.previewPanel.html(o),t.length>0){var r=this;0===this._previewTdWidth.length&&this.previewScrolled.scrollLeft(0),this.previewPanel.find("tr:first td").each((function(t,e){r._previewTdWidth[t]=Math.max(Math.max(Math.ceil($(e).outerWidth()),30),r._previewTdWidth[t]||0)}))}this.scrollerX=new Common.UI.Scroller({el:this.previewPanel,suppressScrollY:!0,alwaysVisibleX:!0,minScrollbarLength:20})},onCmbDelimiterSelect:function(t,e){this.inputDelimiter.setVisible(-1==e.value);var i=this;-1==e.value&&setTimeout((function(){i.inputDelimiter.focus()}),10),this.preview&&this.updatePreview(),this._isDelimChanged=!0},onInputCharChanging:function(){this.preview&&this.updatePreview(),this._isDelimCharChanged=!0},onCmbEncodingSelect:function(t,e){this.preview&&this.updatePreview(),this._isEncodingChanged=!0},onAdvancedClick:function(){if(SSE){var t=this,e=this.separatorOptions?this.separatorOptions.decimal:this.api.asc_getDecimalSeparator(),i=this.separatorOptions?this.separatorOptions.thousands:this.api.asc_getGroupSeparator(),o=this.separatorOptions?this.separatorOptions.qualifier:(this.settings||new Asc.asc_CTextOptions).asc_getTextQualifier();new SSE.Views.AdvancedSeparatorDialog({props:{decimal:e,thousands:i,qualifier:o},handler:function(o,n){"ok"==o&&(t.separatorOptions={decimal:n.decimal.length>0?n.decimal:e,thousands:n.thousands.length>0?n.thousands:i,qualifier:n.qualifier},t.preview&&t.updatePreview())}}).on("close",(function(){t.btnAdvanced.focus()})).show()}},onSelectData:function(t){var e=this,i=e.txtDestRange;if(e.api){var o=new SSE.Views.CellRangeDialog({handler:function(t,o){if("ok"==o){var n=t.getSettings();e.dataDestValid=n,i.setValue(n),i.checkValidate()}}}).on("close",(function(){e.show(),_.delay((function(){i.focus()}),1)})),n=Common.Utils.getOffset(e.$window);e.hide(),o.show(e.$window,n),o.setSettings({api:e.api,range:_.isEmpty(i.getValue())||1!=i.checkValidate()?e.dataDestValid:i.getValue(),type:Asc.c_oAscSelectionDialogType.Chart})}},isRangeValid:function(){var t=!0,e="";return _.isEmpty(this.txtDestRange.getValue())?(t=!1,e=this.txtEmpty):!(t=(t=this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.Chart,this.txtDestRange.getValue()))==Asc.c_oAscError.ID.No)&&(e=this.textInvalidRange),t||(this.txtDestRange.showError([e]),this.txtDestRange.focus(),t)},txtDelimiter:"Delimiter",txtEncoding:"Encoding ",txtSpace:"Space",txtTab:"Tab",txtTitle:"Choose %1 options",txtPassword:"Password",txtTitleProtected:"Protected File",txtOther:"Other",txtIncorrectPwd:"Password is incorrect.",closeButtonText:"Close File",txtPreview:"Preview",txtComma:"Comma",txtColon:"Colon",txtSemicolon:"Semicolon",txtProtected:"Once you enter the password and open the file, the current password to the file will be reset.",txtAdvanced:"Advanced",txtOpenFile:"Enter a password to open the file",textSelectData:"Select data",txtDestData:"Choose where to put the data",txtEmpty:"This field is required",textInvalidRange:"Invalid cells range"},Common.Views.OpenDialog||{}))})),define("spreadsheeteditor/main/app/view/DocumentHolder",["jquery","underscore","backbone","gateway","common/main/lib/component/Menu","common/main/lib/component/Calendar","common/main/lib/view/OpenDialog"],(function(t,e,i,o){"use strict";SSE.Views.DocumentHolder=i.View.extend(e.extend({el:"#editor_sdk",template:null,events:{},initialize:function(){var t=this;t._preventCustomClick=null,t._hasCustomItems=!1,t._currentTranslateObj=void 0,this.setApi=function(e){return t.api=e,t}},render:function(){return this.fireEvent("render:before",this),this.cmpEl=t(this.el),this.fireEvent("render:after",this),this},setMode:function(t){return this.mode=t,this},focus:function(){var t=this;e.defer((function(){t.cmpEl&&t.cmpEl.focus()}),50)},createDelayedElementsViewer:function(){},createDelayedElements:function(){},setMenuItemCommentCaptionMode:function(t,e,i){t.setCaption(e?this.txtAddComment:i?this.txtEditComment:this.txtShowComment,!0)},createEquationMenu:function(t,e){return new Common.UI.Menu({cls:"ppm-toolbar shifted-right",menuAlign:e,items:[new Common.UI.MenuItem({caption:this.currProfText,iconCls:"menu__icon btn-professional-equation",type:"view",value:{all:!1,linear:!1}}),new Common.UI.MenuItem({caption:this.currLinearText,iconCls:"menu__icon btn-linear-equation",type:"view",value:{all:!1,linear:!0}}),new Common.UI.MenuItem({caption:this.allProfText,iconCls:"menu__icon btn-professional-equation",type:"view",value:{all:!0,linear:!1}}),new Common.UI.MenuItem({caption:this.allLinearText,iconCls:"menu__icon btn-linear-equation",type:"view",value:{all:!0,linear:!0}}),{caption:"--"},new Common.UI.MenuItem({caption:this.unicodeText,checkable:!0,checked:!1,toggleGroup:t,type:"input",value:Asc.c_oAscMathInputType.Unicode}),new Common.UI.MenuItem({caption:this.latexText,checkable:!0,checked:!1,toggleGroup:t,type:"input",value:Asc.c_oAscMathInputType.LaTeX}),{caption:"--"},new Common.UI.MenuItem({caption:this.hideEqToolbar,isToolbarHide:!1,type:"hide"})]})},addEquationMenu:function(){},clearEquationMenu:function(){},equationCallback:function(){},initEquationMenu:function(){},updateCustomItems:function(){},clearCustomItems:function(){},parseIcons:function(){},tipNumCapitalLetters:"A. B. C.",tipNumLettersParentheses:"a) b) c)",tipNumLettersPoints:"a. b. c.",tipNumNumbersPoint:"1. 2. 3.",tipNumNumbersParentheses:"1) 2) 3)",tipNumRoman:"I. II. III.",tipNumRomanSmall:"i. ii. iii."},SSE.Views.DocumentHolder||{}))}));var c_paragraphLinerule={LINERULE_AUTO:1,LINERULE_EXACT:2},c_paragraphTextAlignment={RIGHT:0,LEFT:1,CENTERED:2,JUSTIFIED:3},c_paragraphSpecial={NONE_SPECIAL:0,FIRST_LINE:1,HANGING:2};if(define("spreadsheeteditor/main/app/controller/DocumentHolder",["core","common/main/lib/util/utils","common/main/lib/util/Shortcuts","spreadsheeteditor/main/app/view/DocumentHolder"],(function(){"use strict";SSE.Controllers.DocumentHolder=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["DocumentHolder"],initialize:function(){var t=this;t.tooltips={hyperlink:{},comment:{},coauth:{ttHeight:20},row_column:{ttHeight:20},slicer:{ttHeight:20},filter:{ttHeight:40},func_arg:{},input_msg:{},foreignSelect:{ttHeight:20},eyedropper:{isHidden:!0},placeholder:{}},t.mouse={},t.popupmenu=!1,t.rangeSelectionMode=!1,t.namedrange_locked=!1,t._currentMathObj=void 0,t._currentParaObjDisabled=!1,t._isDisabled=!1,t._state={wsLock:!1,wsProps:[]},t.fastcoauthtips=[],t._TtHeight=20,t.lastMathTrackBounds=[],t.showMathTrackOnLoad=!1,this.wrapEvents={apiHideComment:_.bind(this.onApiHideComment,this),onKeyUp:_.bind(this.onKeyUp,this)};var e={};this.hkComments=Common.Utils.isMac?"command+alt+a":"alt+h",e[this.hkComments]=function(){return t.onAddComment(),!1},Common.util.Shortcuts.delegateShortcuts({shortcuts:e}),Common.Utils.InternalSettings.set("sse-equation-toolbar-hide",Common.localStorage.getBool("sse-equation-toolbar-hide"))},onLaunch:function(){var t=this;t.documentHolder=this.createView("DocumentHolder"),t.documentHolder._currentTranslateObj=this,t.documentHolder.render(),t.documentHolder.el.tabIndex=-1,$(document).on("mousedown",_.bind(t.onDocumentRightDown,t)),$(document).on("mouseup",_.bind(t.onDocumentRightUp,t)),$(document).on("keydown",_.bind(t.onDocumentKeyDown,t)),$(document).on("mousemove",_.bind(t.onDocumentMouseMove,t)),$(window).on("resize",_.bind(t.onDocumentResize,t)),SSE.getController("Viewport").getView("Viewport").hlayout.on("layout:resizedrag",_.bind(t.onDocumentResize,t)),Common.NotificationCenter.on({"window:show":function(e){t.hideHyperlinkTip(),t.permissions&&t.permissions.isDesktopApp&&t.api&&t.api.asc_onShowPopupWindow()},"modal:show":function(e){t.hideCoAuthTips(),t.hideForeignSelectTips()},"layout:changed":function(e){t.hideHyperlinkTip(),t.hideCoAuthTips(),t.hideForeignSelectTips(),t.onDocumentResize(),t.api&&!t.tooltips.input_msg.isHidden&&t.tooltips.input_msg.text&&t.changeInputMessagePosition(t.tooltips.input_msg)},"cells:range":function(e){t.onCellsRange(e)},"protect:wslock":_.bind(t.onChangeProtectSheet,t)}),Common.Gateway.on("processmouse",_.bind(t.onProcessMouse,t)),Common.NotificationCenter.on("script:loaded",_.bind(t.createPostLoadElements,t))},onCreateDelayedElements:function(t,e){},createPostLoadElements:function(){var t=this;t.setEvents(),t.permissions.isEdit?t.documentHolder.createDelayedElements():t.documentHolder.createDelayedElementsViewer(),"edit"===t.type&&(t.initExternalEditors(),t.showMathTrackOnLoad&&t.onShowMathTrack(t.lastMathTrackBounds))},loadConfig:function(t){this.editorConfig=t.config},setMode:function(t){this.permissions=t,this.permissions.canCoAuthoring&&this.permissions.canComments?Common.util.Shortcuts.resumeEvents(this.hkComments):Common.util.Shortcuts.suspendEvents(this.hkComments),this.documentHolder.setMode(t)},setApi:function(t){return this.api=t,this.api&&(this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onApiCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiCoAuthoringDisconnect,this)),this.permissions&&!0===this.permissions.isEdit&&this.api.asc_registerCallback("asc_onLockDefNameManager",_.bind(this.onLockDefNameManager,this))),this},onAddComment:function(t){if(!this._state.wsProps.Objects&&this.api&&this.permissions.canCoAuthoring&&this.permissions.canComments){var e=SSE.getController("Common.Controllers.Comments"),i=this.api.asc_getCellInfo();if(e){var o=i.asc_getComments();o&&!o.length&&this.permissions.canCoAuthoring&&e.addDummyComment()}}},onApiCoAuthoringDisconnect:function(){this.permissions.isEdit=!1},onLockDefNameManager:function(t){this.namedrange_locked=t==Asc.c_oAscDefinedNameReason.LockDefNameManager},hideCoAuthTips:function(){this.tooltips.coauth.ref&&($(this.tooltips.coauth.ref).remove(),this.tooltips.coauth.ref=void 0,this.tooltips.coauth.x_point=void 0,this.tooltips.coauth.y_point=void 0)},hideForeignSelectTips:function(){this.tooltips.foreignSelect.ref&&($(this.tooltips.foreignSelect.ref).remove(),this.tooltips.foreignSelect.ref=void 0,this.tooltips.foreignSelect.userId=void 0,this.tooltips.foreignSelect.x_point=void 0,this.tooltips.foreignSelect.y_point=void 0)},hideHyperlinkTip:function(){!this.tooltips.hyperlink.isHidden&&this.tooltips.hyperlink.ref&&(this.tooltips.hyperlink.ref.hide(),this.tooltips.hyperlink.ref=void 0,this.tooltips.hyperlink.text="",this.tooltips.hyperlink.isHidden=!0)},hideEyedropperTip:function(){!this.tooltips.eyedropper.isHidden&&this.tooltips.eyedropper.color&&(this.tooltips.eyedropper.color.css({left:"-1000px",top:"-1000px"}),this.tooltips.eyedropper.ref&&(this.tooltips.eyedropper.ref.hide(),this.tooltips.eyedropper.ref=void 0),this.tooltips.eyedropper.isHidden=!0)},hidePlaceholderTip:function(){!this.tooltips.placeholder.isHidden&&this.tooltips.placeholder.ref&&(this.tooltips.placeholder.ref.hide(),this.tooltips.placeholder.ref=void 0,this.tooltips.placeholder.text="",this.tooltips.placeholder.isHidden=!0)},onApiHideComment:function(){this.tooltips.comment.viewCommentId=this.tooltips.comment.editCommentId=this.tooltips.comment.moveCommentId=void 0},onApiContextMenu:function(t,e){Common.UI.HintManager.isHintVisible()&&Common.UI.HintManager.clearHints();var i=this;_.delay((function(){i.showObjectMenu.call(i,t,e)}),10)},onAfterRender:function(t){},onDocumentResize:function(t){var e=this;if(e.documentHolder){e.tooltips.coauth.XY=[Common.Utils.getOffset(e.documentHolder.cmpEl).left-$(window).scrollLeft(),Common.Utils.getOffset(e.documentHolder.cmpEl).top-$(window).scrollTop()],e.tooltips.coauth.apiHeight=e.documentHolder.cmpEl.height(),e.tooltips.coauth.apiWidth=e.documentHolder.cmpEl.width();var i=$("#right-menu");e.tooltips.coauth.rightMenuWidth=i.is(":visible")?i.width():0,e.tooltips.coauth.bodyWidth=$(window).width(),e.tooltips.coauth.bodyHeight=$(window).height()}},onDocumentWheel:function(t){if(this.api&&!this.isEditCell){var e=_.isUndefined(t.originalEvent)?t.wheelDelta:t.originalEvent.wheelDelta;if(_.isUndefined(e)&&(e=t.deltaY),t.ctrlKey&&!t.altKey){var i=this.api.asc_getZoom();e<0?(i=Math.ceil(10*i)/10,(i-=.1)<.1||(this.api.asc_setZoom(i),this._handleZoomWheel=!0)):e>0&&(i=Math.floor(10*i)/10,(i+=.1)>0&&!(i>5)&&(this.api.asc_setZoom(i),this._handleZoomWheel=!0)),t.preventDefault(),t.stopPropagation()}}},onDocumentKeyDown:function(t){if(this.api){var e=t.keyCode;if(this.hkSpecPaste&&(this._needShowSpecPasteMenu=!t.shiftKey&&!t.altKey&&t.keyCode==Common.UI.Keys.CTRL),!t.ctrlKey&&!t.metaKey||t.shiftKey||t.altKey){if(e==Common.UI.Keys.F10&&t.shiftKey)return this.showObjectMenu(t),t.preventDefault(),t.stopPropagation(),!1;e==Common.UI.Keys.ESC&&!this.tooltips.input_msg.isHidden&&this.tooltips.input_msg.text&&this.onInputMessage()}else if(e===Common.UI.Keys.NUM_PLUS||e===Common.UI.Keys.EQUALITY||Common.Utils.isGecko&&e===Common.UI.Keys.EQUALITY_FF||Common.Utils.isOpera&&43==e){if(!this.api.isCellEdited){var i=Math.floor(10*this.api.asc_getZoom())/10;return(i+=.1)>0&&!(i>5)&&this.api.asc_setZoom(i),t.preventDefault(),t.stopPropagation(),!1}if(this.permissions.isEditMailMerge||this.permissions.isEditDiagram||this.permissions.isEditOle)return t.preventDefault(),t.stopPropagation(),!1}else if(e===Common.UI.Keys.NUM_MINUS||e===Common.UI.Keys.MINUS||Common.Utils.isGecko&&e===Common.UI.Keys.MINUS_FF||Common.Utils.isOpera&&45==e){if(!this.api.isCellEdited)return i=Math.ceil(10*this.api.asc_getZoom())/10,(i-=.1)<.1||this.api.asc_setZoom(i),t.preventDefault(),t.stopPropagation(),!1;if(this.permissions.isEditMailMerge||this.permissions.isEditDiagram||this.permissions.isEditOle)return t.preventDefault(),t.stopPropagation(),!1}else if((e===Common.UI.Keys.ZERO||e===Common.UI.Keys.NUM_ZERO)&&!this.api.isCellEdited)return this.api.asc_setZoom(1),t.preventDefault(),t.stopPropagation(),!1}},onDocumentRightDown:function(t){0==t.button&&(this.mouse.isLeftButtonDown=!0)},onDocumentRightUp:function(t){0==t.button&&(this.mouse.isLeftButtonDown=!1)},onProcessMouse:function(t){"mouseup"==t.type&&(this.mouse.isLeftButtonDown=!1)},onDragEndMouseUp:function(){this.mouse.isLeftButtonDown=!1},onDocumentMouseMove:function(t){t&&"canvas"!==t.target.localName&&this.hideHyperlinkTip()},showObjectMenu:function(t,e){if(this.api&&!this.mouse.isLeftButtonDown&&!this.rangeSelectionMode){if(e===Asc.c_oAscContextMenuTypes.changeSeries&&this.permissions.isEdit&&!this._isDisabled)return void this.fillSeriesMenuProps(this.api.asc_GetSeriesSettings(),t,e);this.permissions.isEdit&&!this._isDisabled?this.fillMenuProps(this.api.asc_getCellInfo(),!0,t):this.fillViewMenuProps(this.api.asc_getCellInfo(),!0,t)}},onApiMouseMove:function(t){},fillMenuProps:function(t,e,i){},fillViewMenuProps:function(t,e,i){},showPopupMenu:function(t,e,i,o){if(!_.isUndefined(t)&&null!==t&&i){Common.UI.Menu.Manager.hideAll();var n=this,s=n.documentHolder,a=[i.pageX*Common.Utils.zoom()-Common.Utils.getOffset(s.cmpEl).left,i.pageY*Common.Utils.zoom()-Common.Utils.getOffset(s.cmpEl).top],r=s.cmpEl.find(Common.Utils.String.format("#menu-container-{0}",t.id));if(t.rendered||(r.length<1&&(r=$(Common.Utils.String.format('<div id="menu-container-{0}" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',t.id)),s.cmpEl.append(r)),t.render(r),t.cmpEl.attr({tabindex:"-1"})),2!==i.button){var l=n.api.asc_getActiveCellCoord(),c={left:0,top:0};a[0]=l.asc_getX()+l.asc_getWidth()+c.left,a[1]=(l.asc_getY()<0?0:l.asc_getY())+l.asc_getHeight()+c.top}r.css({left:a[0],top:a[1]}),_.isFunction(t.options.initMenu)&&(t.options.initMenu(e),t.alignPosition()),_.delay((function(){t.cmpEl.focus()}),10),t.show(),n.currentMenu=t,o!==Asc.c_oAscContextMenuTypes.changeSeries&&n.api.onPluginContextMenuShow&&n.api.onPluginContextMenuShow(i)}},onHideSpecialPasteOptions:function(){if(this.documentHolder&&this.documentHolder.cmpEl){var t=this.documentHolder.cmpEl.find("#special-paste-container");t.is(":visible")&&(t.hide(),$(document).off("keyup",this.wrapEvents.onKeyUp))}},disableSpecialPaste:function(){var t=this.documentHolder.cmpEl.find("#special-paste-container");t.length>0&&t.is(":visible")&&this.btnSpecialPaste.setDisabled(!!this._isDisabled)},onKeyUp:function(t){t.keyCode==Common.UI.Keys.CTRL&&this._needShowSpecPasteMenu&&!this._handleZoomWheel&&!this.btnSpecialPaste.menu.isVisible()&&/area_id/.test(t.target.id)&&($("button",this.btnSpecialPaste.cmpEl).click(),t.preventDefault()),this._handleZoomWheel=!1,this._needShowSpecPasteMenu=!1},onChangeProtectSheet:function(t){if(!t){var e=this.getApplication().getController("WBProtection");t=e?e.getWSProps():null}t&&(this._state.wsProps=t.wsProps,this._state.wsLock=t.wsLock)},onHideMathTrack:function(){if(this.documentHolder&&this.documentHolder.cmpEl)if(Common.Controllers.LaunchController.isScriptLoaded()){var t=this.documentHolder.cmpEl.find("#equation-container");t.is(":visible")&&t.hide()}else this.showMathTrackOnLoad=!1},disableEquationBar:function(){var t=this.documentHolder.cmpEl.find("#equation-container"),e=this._isDisabled||this._state.equationLocked;t.length>0&&t.is(":visible")&&(this.equationBtns.forEach((function(t){t&&t.setDisabled(!!e)})),this.equationSettingsBtn.setDisabled(!!e))},getUserName:function(t){var e=SSE.getCollection("Common.Collections.Users");if(e){var i=e.findUser(t);if(i)return AscCommon.UserInfoParser.getParsedName(i.get("username"))}return this.guestText},isUserVisible:function(t){var e=SSE.getCollection("Common.Collections.Users");if(e){var i=e.findUser(t);if(i)return!i.get("hidden")}return!0},SetDisabled:function(t,e){this._isDisabled=t,this._canProtect=!t||e,this.disableEquationBar(),this.disableSpecialPaste()},clearSelection:function(){this.onHideMathTrack(),this.onHideSpecialPasteOptions()},onPluginContextMenu:function(t){t&&t.length>0&&this.documentHolder&&this.currentMenu&&this.currentMenu!==this.documentHolder.copyPasteMenu&&this.currentMenu!==this.documentHolder.fillMenu&&this.currentMenu.isVisible()&&this.documentHolder.updateCustomItems(this.currentMenu,t)}},SSE.Controllers.DocumentHolder||{}))})),define("text!spreadsheeteditor/main/app/template/CellEditor.template",[],(function(){return'<div class="ce-group-name float-left">\r\n    <input id="ce-cell-name" class="aslabel form-control" type="text" autocomplete="off">\r\n    <div id="ce-cell-name-menu"></div>\r\n    <button id="ce-func-label" type="button" class="btn tiny btn-toolbar"><i class="icon toolbar__icon btn-function"></i></button>\r\n</div>\r\n<div class="ce-group-expand float-right">\r\n    <button id="ce-btn-expand" type="button" class="btn"><span class="caret">&nbsp;</span></button>\r\n</div>\r\n<div class="ce-group-content">\r\n    <textarea id="ce-cell-content" class="form-control" spellcheck="false" rows="1" cols="20"></textarea>\r\n</div>\r\n'})),define("spreadsheeteditor/main/app/view/CellEditor",["text!spreadsheeteditor/main/app/template/CellEditor.template","common/main/lib/component/BaseView"],(function(t){"use strict";SSE.Views.CellEditor=Common.UI.BaseView.extend(_.extend({template:_.template(t),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t)},render:function(){$(this.el).html(this.template()),this.btnNamedRanges=new Common.UI.Button({parentEl:$("#ce-cell-name-menu"),menu:new Common.UI.Menu({style:"min-width: 70px;max-width:400px;",maxHeight:250,items:[{caption:this.textManager,value:"manager"},{caption:"--"}]})}),this.btnNamedRanges.setVisible(!1),this.btnNamedRanges.menu.setOffset(Common.UI.isRTL()?84:-84),this.$cellname=$("#ce-cell-name",this.el),this.$btnexpand=$("#ce-btn-expand",this.el),this.$btnfunc=$("#ce-func-label",this.el),this.$cellcontent=$("#ce-cell-content",this.el),this.$cellgroupname=this.$btnexpand.parent();var t=this;return this.$cellname.on("focus",(function(e){var i=t.$cellname[0];i.selectionStart=0,i.selectionEnd=i.value.length,i.scrollLeft=i.scrollWidth})),this.$btnfunc.addClass("disabled"),this.$btnfunc.tooltip({title:this.tipFormula,placement:"cursor"}),this.$btnfunc.attr("ratio","ratio"),this.applyScaling(Common.UI.Scaling.currentRatio()),this.$btnfunc.on("app:scaling",(function(e,i){t.applyScaling(i.ratio)})),this},updateCellInfo:function(t){t&&this.$cellname.val("string"==typeof t?t:t.asc_getName())},cellNameDisabled:function(t){t?this.$cellname.attr("disabled","disabled"):this.$cellname.removeAttr("disabled"),this.btnNamedRanges.setDisabled(t)},applyScaling:function(t){if(t>2&&!this.$btnfunc.find("svg.icon").length){var e='<svg class="icon"><use class="zoom-int" href="#%iconname"></use></svg>'.replace("%iconname","btn-function");this.$btnfunc.find("i.icon").after(e)}},cellEditorTextChange:function(){if(this.$cellcontent){var t=this.$cellcontent[0];if(t.clientHeight!=t.scrollHeight){if(!this._isScrollShow){this._isScrollShow=!0;var e=t.offsetWidth-t.clientWidth;this.$cellgroupname.css({right:Common.UI.isRTL()?"":e+"px",left:Common.UI.isRTL()?e+"px":""})}}else this._isScrollShow&&(this._isScrollShow=!1,this.$cellgroupname.css({right:"",left:""}))}},tipFormula:"Insert Function",textManager:"Manager"},SSE.Views.CellEditor||{}))})),define("spreadsheeteditor/main/app/controller/CellEditor",["core","spreadsheeteditor/main/app/view/CellEditor"],(function(t){"use strict";SSE.Controllers.CellEditor=Backbone.Controller.extend({views:["CellEditor"],events:function(){return{"keyup input#ce-cell-name":_.bind(this.onCellName,this),"keyup textarea#ce-cell-content":_.bind(this.onKeyupCellEditor,this),"blur textarea#ce-cell-content":_.bind(this.onBlurCellEditor,this),"click button#ce-btn-expand":_.bind(this.expandEditorField,this),"click button#ce-func-label":_.bind(this.onInsertFunction,this)}},initialize:function(){this.addListeners({CellEditor:{},Viewport:{"layout:resizedrag":_.bind(this.onLayoutResize,this)},ViewTab:{"viewtab:formula":function(t,e){this.editor.setVisible(e),Common.localStorage.setBool("sse-hidden-formula",!e),Common.NotificationCenter.trigger("layout:changed","celleditor",e?"showed":"hidden")}.bind(this)}}),Common.NotificationCenter.on("external:reshow",this.onExternalReshow.bind(this)),Common.NotificationCenter.on("uitheme:changed",this.onThemeChanged.bind(this))},setApi:function(t){return this.api=t,this.api.isCEditorFocused=!1,this.api.asc_registerCallback("asc_onSelectionNameChanged",_.bind(this.onApiCellSelection,this)),this.api.asc_registerCallback("asc_onEditCell",_.bind(this.onApiEditCell,this)),this.api.asc_registerCallback("asc_onEditorSelectionChanged",_.bind(this.onCellEditorTextChange,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onApiDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiDisconnect,this)),Common.NotificationCenter.on("cells:range",_.bind(this.onCellsRange,this)),this.api.asc_registerCallback("asc_onLockDefNameManager",_.bind(this.onLockDefNameManager,this)),this.api.asc_registerCallback("asc_onInputKeyDown",_.bind(this.onInputKeyDown,this)),this},setMode:function(t){this.mode=t,this.editor.$btnfunc[this.mode.isEdit?"removeClass":"addClass"]("disabled"),this.editor.btnNamedRanges.setVisible(this.mode.isEdit&&!this.mode.isEditDiagram&&!this.mode.isEditMailMerge&&!this.mode.isEditOle),this.mode.isEdit&&this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onApiSelectionChanged,this))},onInputKeyDown:function(t){if(Common.UI.Keys.UP===t.keyCode||Common.UI.Keys.DOWN===t.keyCode||Common.UI.Keys.TAB===t.keyCode||Common.UI.Keys.RETURN===t.keyCode||Common.UI.Keys.ESC===t.keyCode||Common.UI.Keys.LEFT===t.keyCode||Common.UI.Keys.RIGHT===t.keyCode){var e=$("#menu-formula-selection");e.hasClass("open")&&e.find(".dropdown-menu").trigger("keydown",t)}},onLaunch:function(){this.editor=this.getView("CellEditor"),this.bindViewEvents(this.editor,this.events),this.editor.$el.parent().find(".after").css({zIndex:"4"});var t=Common.localStorage.getItem("sse-celleditor-height");this.editor.keep_height=null!==t&&parseInt(t)>0?parseInt(t):74,Common.localStorage.getBool("sse-celleditor-expand")&&(this.editor.$el.height(this.editor.keep_height),this.onLayoutResize(void 0,"cell:edit")),this.editor.btnNamedRanges.menu.on("item:click",_.bind(this.onNamedRangesMenu,this)).on("show:before",_.bind(this.onNameBeforeShow,this)),$(window).on("resize",_.bind(this.onCellEditorTextChange,this)),this.namedrange_locked=!1,this.isUserProtected=!1},onCellEditorTextChange:function(){this.editor.cellEditorTextChange()},onApiEditCell:function(t){this.viewmode||(t==Asc.c_oAscCellEditorState.editStart?(this.api.isCellEdited=!0,this.editor.cellNameDisabled(!0)):t==Asc.c_oAscCellEditorState.editInCell?this.api.isCEditorFocused="clear":t==Asc.c_oAscCellEditorState.editEnd&&(this.api.isCellEdited=!1,this.api.isCEditorFocused=!1,this.editor.cellNameDisabled(!1)),this.editor.$btnfunc.toggleClass("disabled",t==Asc.c_oAscCellEditorState.editText||this.isUserProtected))},onApiCellSelection:function(t){this.editor.updateCellInfo(t)},onApiSelectionChanged:function(t){if(!this.viewmode&&t){this.onCellEditorTextChange();var e=t.asc_getSelectionType(),i=!(this.mode.isEditMailMerge||this.mode.isEditDiagram||this.mode.isEditOle)&&(!0===t.asc_getLocked()||!0===t.asc_getLockedTable()||!0===t.asc_getLockedPivotTable()),o=e==Asc.c_oAscSelectionType.RangeChartText,n=e==Asc.c_oAscSelectionType.RangeChart,s=e==Asc.c_oAscSelectionType.RangeShapeText,a=e==Asc.c_oAscSelectionType.RangeShape,r=e==Asc.c_oAscSelectionType.RangeImage||e==Asc.c_oAscSelectionType.RangeSlicer,l=s||a||o||n;this.isUserProtected=!!t.asc_getUserProtected(),this.editor.$btnfunc.toggleClass("disabled",r||l||i||this.isUserProtected)}},onApiDisconnect:function(){if(this.mode){this.mode.isEdit=!1;var t=this.getApplication().getController("FormulaDialog");t&&t.hideDialog(),this.mode.isEdit||($("#ce-func-label",this.editor.el).addClass("disabled"),this.editor.btnNamedRanges.setVisible(!1))}},onCellsRange:function(t){this.editor.cellNameDisabled(t!=Asc.c_oAscSelectionDialogType.None),this.editor.$btnfunc.toggleClass("disabled",t!=Asc.c_oAscSelectionDialogType.None||this.isUserProtected)},onLayoutResize:function(t,e){"cell:edit"==e&&(Math.floor(this.editor.$el.height())>19?(this.editor.$btnexpand.hasClass("btn-collapse")||(this.editor.$el.addClass("expanded"),this.editor.$btnexpand.addClass("btn-collapse")),t&&Common.localStorage.setItem("sse-celleditor-height",this.editor.$el.height()),t&&Common.localStorage.setBool("sse-celleditor-expand",!0)):(this.editor.$el.removeClass("expanded"),this.editor.$btnexpand.removeClass("btn-collapse"),t&&Common.localStorage.setBool("sse-celleditor-expand",!1)),this.onCellEditorTextChange())},onCellName:function(t){if(t.keyCode==Common.UI.Keys.RETURN){var e=this.editor.$cellname.val();e&&e.length&&this.api.asc_findCell(e),Common.NotificationCenter.trigger("edit:complete",this.editor)}},onBlurCellEditor:function(){"clear"==this.api.isCEditorFocused?this.api.isCEditorFocused=void 0:this.api.isCellEdited&&(this.api.isCEditorFocused=!0)},onKeyupCellEditor:function(t){t.keyCode!=Common.UI.Keys.RETURN||t.altKey||(this.api.isCEditorFocused="clear")},expandEditorField:function(){var t=parseFloat(this.editor.$el.css("min-height"))||20;t-=parseFloat(this.editor.$el.css("border-bottom-width"))||0,Math.floor(this.editor.$el.height())>t?(this.editor.keep_height=this.editor.$el.height(),this.editor.$el.height(t),this.editor.$el.removeClass("expanded"),this.editor.$btnexpand.removeClass("btn-collapse"),Common.localStorage.setBool("sse-celleditor-expand",!1)):(this.editor.$el.height(this.editor.keep_height),this.editor.$el.addClass("expanded"),this.editor.$btnexpand.addClass("btn-collapse"),Common.localStorage.setBool("sse-celleditor-expand",!0)),this.onCellEditorTextChange(),Common.NotificationCenter.trigger("layout:changed","celleditor"),Common.NotificationCenter.trigger("edit:complete",this.editor,{restorefocus:!0})},onExternalReshow:function(){this.changeCellEditorHeight()},onThemeChanged:function(){this.changeCellEditorHeight()},changeCellEditorHeight:function(){if(!Common.localStorage.getBool("sse-celleditor-expand")){var t=parseFloat(this.editor.$el.css("min-height"))||20;t-=parseFloat(this.editor.$el.css("border-bottom-width"))||0,this.editor.$el.height(t),Common.NotificationCenter.trigger("layout:changed","celleditor")}},onInsertFunction:function(){if(!this.viewmode&&this.mode.isEdit&&!this.editor.$btnfunc.hasClass("disabled")){var t=this.getApplication().getController("FormulaDialog");t&&($("#ce-func-label",this.editor.el).blur(),t.showDialog())}},onNamedRangesMenu:function(t,e){var i=this;if("manager"==e.options.value){for(var o=this.api.asc_getWorksheetsCount(),n=-1,s=[],a=[];++n<o;)this.api.asc_isWorksheetHidden(n)||(a[n]=this.api.asc_getWorksheetName(n),s.push({displayValue:a[n],value:n}));new SSE.Views.NameManagerDlg({api:this.api,handler:function(t){Common.NotificationCenter.trigger("edit:complete",i.editor)},locked:this.namedrange_locked,sheets:s,sheetNames:a,ranges:this.api.asc_getDefinedNames(Asc.c_oAscGetDefinedNamesList.All),props:this.api.asc_getDefaultDefinedName(),sort:this.rangeListSort}).on("close",(function(t){i.rangeListSort=t.getSettings()})).show()}else this.api.asc_findCell(e.caption),Common.NotificationCenter.trigger("edit:complete",this.editor)},onNameBeforeShow:function(){var t=this.api.asc_getDefinedNames(Asc.c_oAscGetDefinedNamesList.WorksheetWorkbook,!0),e=this.editor.btnNamedRanges.menu,i="";e.removeItems(2,e.items.length-1),t.sort((function(t,e){var i=t.asc_getName(!0).toLowerCase(),o=e.asc_getName(!0).toLowerCase();return i==o?0:i<o?-1:1})),_.each(t,(function(t,o){var n=t.asc_getName(!0);i!==n&&e.addItem(new Common.UI.MenuItem({caption:n})),i=n})),this.editor.btnNamedRanges.menu.items[0].setDisabled(!!this.api.asc_isProtectedSheet()),this.editor.btnNamedRanges.menu.items[1].setVisible(e.items.length>2)},onLockDefNameManager:function(t){this.namedrange_locked=t==Asc.c_oAscDefinedNameReason.LockDefNameManager},SetDisabled:function(t){this.editor.$btnfunc[!t&&this.mode&&this.mode.isEdit&&!this.isUserProtected?"removeClass":"addClass"]("disabled"),this.editor.btnNamedRanges.setVisible(!t&&this.mode&&this.mode.isEdit&&!this.mode.isEditDiagram&&!this.mode.isEditMailMerge&&!this.mode.isEditOle)},setPreviewMode:function(t){this.viewmode!==t&&(this.viewmode=t,this.editor.$btnfunc[!t&&this.mode&&this.mode.isEdit&&!this.isUserProtected?"removeClass":"addClass"]("disabled"),this.editor.cellNameDisabled(t&&!(this.mode&&this.mode.isEdit&&!this.mode.isEditDiagram&&!this.mode.isEditMailMerge&&!this.mode.isEditOle)))}})})),void 0===Common)var Common={};if(void 0===Common.define&&(Common.define={}),define("spreadsheeteditor/main/app/view/define",[],(function(){"use strict";Common.define.conditionalData=_.extend(new function(){return{textDate:"Date",textYesterday:"Yesterday",textToday:"Today",textTomorrow:"Tomorrow",textLast7days:"In the last 7 days",textLastWeek:"Last week",textThisWeek:"This week",textNextWeek:"Next week",textLastMonth:"Last month",textThisMonth:"This month",textNextMonth:"Next month",textText:"Text",textContains:"Contains",textNotContains:"Does not contain",textBegins:"Begins with",textEnds:"Ends with",textAverage:"Average",textAbove:"Above",textBelow:"Below",textEqAbove:"Equal to or above",textEqBelow:"Equal to or below",text1Above:"1 std dev above",text1Below:"1 std dev below",text2Above:"2 std dev above",text2Below:"2 std dev below",text3Above:"3 std dev above",text3Below:"3 std dev below",textGreater:"Greater than",textGreaterEq:"Greater than or equal to",textLess:"Less than",textLessEq:"Less than or equal to",textEqual:"Equal to",textNotEqual:"Not equal to",textBetween:"Between",textNotBetween:"Not between",textTop:"Top",textBottom:"Bottom",textBlank:"Blank",textError:"Error",textBlanks:"Contains blanks",textNotBlanks:"Does not contain blanks",textErrors:"Contains errors",textNotErrors:"Does not contain errors",textDuplicate:"Duplicate",textUnique:"Unique",textDataBar:"Data bar",textIconSets:"Icon sets",textFormula:"Formula",exampleText:"AaBbCcYyZz",noFormatText:"No format set",textValue:"Value is"}},Common.define.conditionalData||{})})),define("text!spreadsheeteditor/main/app/template/Toolbar.template",[],(function(){return'<section class="toolbar">\n    <section class="box-tabs">\n        <div class="extra left"></div>\n        <%= tabsmarkup %>\n        <div class="extra right"></div>\n    </section>\n    <section class="box-controls" role="tabpanel">\n        <section class="panel static">\n            <div class="group no-mask small">\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-save" data-layout-name="toolbar-save"></span>\n                </div>\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-print"></span>\n                </div>\n            </div>\n            <div class="separator long"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-copy"></span>\n                    <span class="btn-slot" id="slot-btn-paste"></span>\n                </div>\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-undo"></span>\n                    <span class="btn-slot" id="slot-btn-redo"></span>\n                </div>\n            </div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-cut"></span>\n                </div>\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-copystyle"></span>\n                </div>\n            </div>\n            <div class="separator long"></div>\n        </section>\n        <section class="box-panels">\n            <section class="panel" data-tab="home" role="tabpanel" aria-labelledby="home">\n                <div class="group small">\n                    <div class="elset font-attr-top display-flex-row-center">\n                        <span class="btn-slot float-left" id="slot-field-fontname"></span>\n                        <span class="btn-slot float-left" id="slot-field-fontsize"></span>\n                        <span class="btn-slot float-left" id="slot-btn-incfont"></span>\n                        <span class="btn-slot float-left" id="slot-btn-decfont"></span>\n                        <span class="btn-slot float-left split" id="slot-btn-changecase"></span>\n                    </div>\n                    <div class="elset font-attr">\n                        <span class="btn-slot" id="slot-btn-bold"></span>\n                        <span class="btn-slot" id="slot-btn-italic"></span>\n                        <span class="btn-slot" id="slot-btn-underline"></span>\n                        <span class="btn-slot" id="slot-btn-strikeout"></span>\n                        <span class="btn-slot split" id="slot-btn-subscript"></span>\n                        <span class="btn-slot split" id="slot-btn-fontcolor"></span>\n                        <span class="btn-slot split" id="slot-btn-fillparag"></span>\n                        <span class="btn-slot split" id="slot-btn-borders"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot split-small" id="slot-btn-top"></span>\n                        <span class="btn-slot split-small" id="slot-btn-middle"></span>\n                        <span class="btn-slot split-small" id="slot-btn-bottom"></span>\n                        <span class="btn-slot split-small" id="slot-btn-wrap"></span>\n                        <span class="btn-slot split" id="slot-btn-text-orient"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split-small" id="<% if (!isRTL) { %>slot-btn-align-left<% } else { %>slot-btn-align-right<% } %>"></span>\n                        <span class="btn-slot split-small" id="slot-btn-align-center"></span>\n                        <span class="btn-slot split-small" id="<% if (!isRTL) { %>slot-btn-align-right<% } else { %>slot-btn-align-left<% } %>"></span>\n                        <span class="btn-slot split-small" id="slot-btn-align-just"></span>\n                        <span class="btn-slot split" id="slot-btn-merge"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-formula"></span>\n                        <span class="btn-slot split" id="slot-btn-fill-num"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-named-range"></span>\n                        <span class="btn-slot split" id="slot-btn-clear"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot split slot-sortdesc"></span>\n                        <span class="btn-slot slot-sortasc"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split slot-btn-setfilter"></span>\n                        <span class="btn-slot slot-btn-clear-filter"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset display-flex-row-center">\n                        <span class="btn-slot" id="slot-btn-format" style="min-width: 135px; flex-grow: 1;"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split-large" id="slot-btn-currency"></span>\n                        <span class="btn-slot split-small" id="slot-btn-percents"></span>\n                        <span class="btn-slot split-small" id="slot-btn-comma"></span>\n                        <span class="btn-slot split-small" id="slot-btn-digit-dec"></span>\n                        <span class="btn-slot" id="slot-btn-digit-inc"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-cell-ins"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-cell-del"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-condformat"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split" id="slot-btn-table-tpl"></span>\n                    </div>\n                </div>\n                <div class="separator long invisible"></div>\n                <div class="group small flex field-styles" id="slot-field-styles" style="width: 670px; min-width: 148px;" data-group-width="670px"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot" id="slot-btn-replace"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot" id="slot-btn-select-all"></span>\n                    </div>\n                </div>\n            </section>\n            <section class="panel" data-tab="ins" role="tabpanel" aria-labelledby="ins">\n                <div class="group">\n                    <span class="btn-slot text x-huge slot-add-pivot"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-instable"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-insimage"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-insshape"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-inssmartart"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-insrecommend"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-inschart"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-inssparkline"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge slot-comment"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-inshyperlink"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-insslicer"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-instext"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-instextart"></span>\n                    <span class="btn-slot text x-huge slot-editheader"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-insequation"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-inssymbol"></span>\n                </div>\n            </section>\n            <section class="panel" data-tab="layout" role="tabpanel" aria-labelledby="layout">\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-pagemargins"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-pageorient"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-pagesize"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-printarea"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-pagebreak"></span>\n                    <span class="btn-slot text x-huge slot-editheader"></span>\n                    <span class="btn-slot text" id="slot-btn-scale"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-printtitles"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-rtl-sheet"></span>\n                </div>\n                <div class="separator long invisible"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot text" id="slot-chk-print-gridlines"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot text" id="slot-chk-print-headings"></span>\n                    </div>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-img-movefrwd"></span>\n                    <span class="btn-slot text x-huge" id="slot-img-movebkwd"></span>\n                    <span class="btn-slot text x-huge" id="slot-img-align"></span>\n                    <span class="btn-slot text x-huge" id="slot-img-group"></span>\n                    <span class="btn-slot text x-huge" id="slot-shapes-merge"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-colorschemas"></span>\n                </div>\n            </section>\n            <section class="panel" data-tab="formula" role="tabpanel" aria-labelledby="formula">\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-additional-formula"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-autosum"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-recent"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-financial"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-logical"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-text"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-datetime"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-lookup"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-math"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-more"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-named-range-huge"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot text" id="slot-btn-trace-prec"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot text" id="slot-btn-trace-dep"></span>\n                    </div>\n                </div>\n                <div class="group small">\n                    <div class="elset">\n                        <span class="btn-slot text" id="slot-btn-remove-arrows"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot text" id="slot-btn-show-formulas"></span>\n                    </div>\n                </div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-watch-window"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-calculate"></span>\n                </div>\n            </section>\n            <section class="panel" data-tab="data" role="tabpanel" aria-labelledby="data">\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-data-from-text"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-data-external-links"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <div class="elset">\n                        <span class="btn-slot split slot-btn-setfilter"></span>\n                        <span class="btn-slot slot-sortdesc"></span>\n                    </div>\n                    <div class="elset">\n                        <span class="btn-slot split slot-btn-clear-filter"></span>\n                        <span class="btn-slot slot-sortasc"></span>\n                    </div>\n                </div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-custom-sort"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-text-column"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-rem-duplicates"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-data-validation"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-goal-seek"></span>\n                </div>\n                <div class="separator long"></div>\n                <div class="group">\n                    <span class="btn-slot text x-huge" id="slot-btn-group"></span>\n                    <span class="btn-slot text x-huge" id="slot-btn-ungroup"></span>\n                </div>\n                \x3c!--<div class="group">--\x3e\n                    \x3c!--<div class="elset">--\x3e\n                        \x3c!--<span class="btn-slot" id="slot-btn-show-details" style="width:auto;"></span>--\x3e\n                    \x3c!--</div>--\x3e\n                    \x3c!--<div class="elset">--\x3e\n                        \x3c!--<span class="btn-slot" id="slot-btn-hide-details" style="width:auto;"></span>--\x3e\n                    \x3c!--</div>--\x3e\n                \x3c!--</div>--\x3e\n            </section>\n        </section>\n    </section>\n</section>'})),define("text!spreadsheeteditor/main/app/template/ToolbarAnother.template",[],(function(){return'<div class="toolbar">\n    <% if ( isEditDiagram ) { %>\n        \x3c!-----------------------\x3e\n        \x3c!-- Edit diagram mode --\x3e\n        \x3c!-----------------------\x3e\n        <section class="simple-bar">\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-copy"></span>\n                    <span class="btn-slot split" id="slot-btn-paste"></span>\n                    <span class="btn-slot split" id="slot-btn-undo"></span>\n                    <span class="btn-slot" id="slot-btn-redo"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-formula"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-digit-dec"></span>\n                    <span class="btn-slot split" id="slot-btn-digit-inc"></span>\n                    <span class="btn-slot" id="slot-btn-format" style="width: 80px; vertical-align: middle;"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot text" id="slot-btn-chart-data"></span>\n                    <span class="btn-slot text margin-left-12" id="slot-btn-chart-type"></span>\n                    <span class="btn-slot margin-left-12" id="slot-btn-chart" style="width: auto;"></span>\n                </div>\n            </div>\n            <div class="group" style="width: 100%;"></div>\n        </section>\n    <% } else if ( isEditMailMerge ) { %>\n        \x3c!-----------------------\x3e\n        \x3c!-- Edit mail merge mode --\x3e\n        \x3c!-----------------------\x3e\n        <section class="simple-bar">\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-copy"></span>\n                    <span class="btn-slot split" id="slot-btn-paste"></span>\n                    <span class="btn-slot split" id="slot-btn-undo"></span>\n                    <span class="btn-slot" id="slot-btn-redo"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-sortdesc"></span>\n                    <span class="btn-slot" id="slot-btn-sortasc"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-setfilter"></span>\n                    <span class="btn-slot" id="slot-btn-clear-filter"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-search"></span>\n                </div>\n            </div>\n            <div class="group" style="width: 100%;"></div>\n        </section>\n    <% } else if ( isEditOle ) { %>\n        \x3c!-----------------------\x3e\n        \x3c!-- Edit ole object --\x3e\n        \x3c!-----------------------\x3e\n        <section class="simple-bar">\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split-small" id="slot-btn-copy"></span>\n                    <span class="btn-slot split-small" id="slot-btn-paste"></span>\n                    <span class="btn-slot split-small" id="slot-btn-undo"></span>\n                    <span class="btn-slot" id="slot-btn-redo"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset display-flex-row-center" style="width: 172px;">\n                    <span class="btn-slot float-left" id="slot-field-fontname"></span>\n                    <span class="btn-slot float-left margin-left-2" id="slot-field-fontsize" style="width:40px;"></span>\n                    <span class="btn-slot split float-left margin-left-2" id="slot-btn-fontcolor"></span>\n                    <span class="btn-slot float-left margin-left-2" id="slot-btn-formatting"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset font-attr">\n                    <span class="btn-slot split" id="slot-btn-halign"></span>\n                    <span class="btn-slot split" id="slot-btn-valign"></span>\n                    <span class="btn-slot split-small" id="slot-btn-wrap"></span>\n                    <span class="btn-slot split" id="slot-btn-merge"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset font-attr">\n                    <span class="btn-slot split" id="slot-btn-borders"></span>\n                    <span class="btn-slot split" id="slot-btn-fillparag"></span>\n                    <span class="btn-slot split" id="slot-btn-table-tpl"></span>\n                    <span class="btn-slot split" id="slot-btn-cell-style"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot float-left" id="slot-btn-format" style="width: 80px;"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot split" id="slot-btn-formula"></span>\n                </div>\n            </div>\n            <div class="separator short"></div>\n            <div class="group small">\n                <div class="elset">\n                    <span class="btn-slot" id="slot-btn-search"></span>\n                </div>\n            </div>\n            <div class="group" style="width: 100%;padding-left: 0;"></div>\n            <div class="group small padding-right-10">\n                <div class="elset">\n                    <span class="btn-slot float-left" id="slot-btn-visible-area" style="width: auto;"></span>\n                    <span class="btn-slot float-left" id="slot-btn-visible-area-close" style="width: auto;"></span>\n                </div>\n            </div>\n        </section>\n    <% } %>\n</div>'})),define("text!spreadsheeteditor/main/app/template/ToolbarView.template",[],(function(){return'<section class="toolbar toolbar-view">\n    <section class="box-tabs">\n        <div class="extra left"></div>\n        <%= tabsmarkup %>\n        <div class="extra right">\n        </div>\n    </section>\n    <section class="box-controls">\n        <section class="box-panels">\n        </section>\n    </section>\n</section>'})),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/Font",["backbone"],(function(t){"use strict";Common.Models.Font=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),name:null,cloneid:null,imgidx:0,type:0}}})})),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/Fonts",["backbone","common/main/lib/model/Font"],(function(t){"use strict";Common.Collections.Fonts=t.Collection.extend({model:Common.Models.Font})})),void 0===Common)var Common={};if(define("common/main/lib/component/ComboBox",["common/main/lib/component/BaseView","common/main/lib/component/Scroller"],(function(){"use strict";Common.UI.ComboBoxModel=Backbone.Model.extend({defaults:function(){return{id:Common.UI.getId(),value:null,displayValue:null}}}),Common.UI.ComboBoxStore=Backbone.Collection.extend({model:Common.UI.ComboBoxModel}),Common.UI.ComboBox=Common.UI.BaseView.extend({options:{id:null,cls:"",style:"",hint:!1,editable:!0,disabled:!1,menuCls:"",menuStyle:"",menuAlignEl:null,restoreMenuHeight:!0,displayField:"displayValue",valueField:"value",search:!1,searchFields:["displayValue"],placeHolder:"",scrollAlwaysVisible:!1,takeFocusOnClose:!1,dataHint:"",dataHintDirection:"",dataHintOffset:""},template:_.template(['<span class="input-group combobox <%= cls %>" id="<%= id %>" style="<%= style %>">','<input type="text" class="form-control" spellcheck="false" placeholder="<%= placeHolder %>" role="combobox" aria-controls="<%= id %>-menu" aria-expanded="false" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" data-move-focus-only-tab="true">','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul id="<%= id %>-menu" class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%- item.value %>"><a tabindex="-1" type="menuitem" role="menuitemcheckbox" aria-checked="false"><%= scope.getDisplayValue(item) %></a></li>',"<% }); %>","</ul>","</span>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=e.options.id||Common.UI.getId(),this.cls=e.options.cls,this.style=e.options.style,this.menuCls=e.options.menuCls,this.menuStyle=e.options.menuStyle,this.template=e.options.template||e.template,this.itemsTemplate=e.options.itemsTemplate,this.itemTemplate=e.options.itemTemplate,this.hint=e.options.hint,this.editable=e.options.editable,this.disabled=e.options.disabled,this.store=e.options.store||new Common.UI.ComboBoxStore,this.displayField=e.options.displayField,this.valueField=e.options.valueField,this.placeHolder=e.options.placeHolder,this.search=e.options.search,this.searchFields=e.options.searchFields,this.scrollAlwaysVisible=e.options.scrollAlwaysVisible,this.focusWhenNoSelection=!1!==e.options.focusWhenNoSelection,this.restoreMenuHeight=e.options.restoreMenuHeight,e.rendered=e.options.rendered||!1,this.lastValue=null,e.store.add(e.options.data),e.options.el&&e.render()},render:function(t){var e=this;if(e.rendered)this.cmpEl=e.$el||$(this.el);else{var i=this.store.toJSON();this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,menuCls:this.menuCls,menuStyle:this.menuStyle,items:i,scope:e,placeHolder:this.placeHolder,dataHint:this.options.dataHint,dataHintDirection:this.options.dataHintDirection,dataHintOffset:this.options.dataHintOffset,isRTL:Common.UI.isRTL()})),this.itemsTemplate?this.cmpEl.find("ul").html($(this.itemsTemplate({items:i,scope:e}))):this.itemTemplate&&this.cmpEl.find("ul").html($(_.template(["<% _.each(items, function(item) { %>","<%= itemTemplate(item) %>","<% }); %>"].join(""))({items:i,itemTemplate:this.itemTemplate,scope:this}))),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl)}if(!e.rendered){var o=this.cmpEl;if(this._input=o.find("input"),this._button=o.find(".btn"),o.on("click","a",_.bind(this.itemClicked,this)),o.on("mousedown","a",_.bind(this.itemMouseDown,this)),this.editable?(o.on("change","input",_.bind(this.onInputChanged,this)),o.on("input","input",_.bind(this.onInputChanging,this)),o.on("keydown","input",_.bind(this.onInputKeyDown,this)),o.on("focusin","input",_.bind(this.onInputFocusIn,this)),o.on("click",".form-control",_.bind(this.onEditableInputClick,this))):(o.on("click",".form-control",_.bind(this.onInputClick,this)),this._input.attr("readonly","readonly"),this._input.attr("data-can-copy",!1),this._input.on("mousedown",(function(t){t.preventDefault()}))),e.options.hint){o.attr("data-toggle","tooltip"),o.tooltip({title:e.options.hint,placement:e.options.hintAnchor||"cursor"});var n=o.closest(".asc-window");if(n.length>0){o.data("bs.tooltip").tip().css("z-index",parseInt(n.css("z-index"))+10);var s=function(t){if(n[0]===t.$window[0]){var e=o.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.hide()),Common.NotificationCenter.off({"modal:close":s})}};Common.NotificationCenter.on({"modal:close":s})}o.find(".dropdown-menu").on("mouseenter",(function(){var t=o.data("bs.tooltip");t&&(void 0===t.dontShow&&(t.dontShow=!0),t.hide())}))}var a=o.find(".dropdown-menu");a.hasClass("menu-absolute")&&a.css("min-width",o.outerWidth()),o.on("show.bs.dropdown",_.bind(e.onBeforeShowMenu,e)),o.on("shown.bs.dropdown",_.bind(e.onAfterShowMenu,e)),o.on("hide.bs.dropdown",_.bind(e.onBeforeHideMenu,e)),o.on("hidden.bs.dropdown",_.bind(e.onAfterHideMenu,e)),o.on("keydown.after.bs.dropdown",_.bind(e.onAfterKeydownMenu,e)),Common.NotificationCenter.on("menumanager:hideall",_.bind(e.closeMenu,e)),this.setDefaultSelection(),this.listenTo(this.store,"reset",this.onResetItems);var r=this.options.ariaLabel?this.options.ariaLabel:this.options.hint;r&&this.cmpEl.find(".form-control").attr("aria-label",r)}return e.rendered=!0,e.disabled&&e.setDisabled(e.disabled),this},setData:function(t){this.store.reset([]),this.store.add(t),this.setRawValue(""),this.onResetItems()},openMenu:function(t,e){if(!(this.store.length<1)){var i=this;this.scroller||(this.scroller=new Common.UI.Scroller(_.extend({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,includePadding:!0,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible},this.options.scroller))),_.delay((function(){i.cmpEl.addClass("open"),e&&e()}),t||0)}},closeMenu:function(){this.cmpEl.removeClass("open"),this.cmpEl.find(".form-control").attr("aria-expanded","false")},isMenuOpen:function(){return this.cmpEl.hasClass("open")},onBeforeShowMenu:function(t){if(this.scroller||(this.scroller=new Common.UI.Scroller(_.extend({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,includePadding:!0,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible},this.options.scroller))),Common.NotificationCenter.trigger("menu:show"),this.trigger("show:before",this,t),this.options.hint){var e=this.cmpEl.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.hide())}var i=this.cmpEl.find("ul"),o=i.hasClass("menu-absolute");if(this.options.restoreMenuHeightAndTop||o){var n=Common.Utils.getOffset(this.cmpEl),s=this.options.menuAlignEl?Common.Utils.getOffset(this.options.menuAlignEl).top:0,a=parseInt(i.css("margin-top")),r=n.top-s+this.cmpEl.outerHeight()+a,l=n.left;if(this.options.restoreMenuHeightAndTop){var c=this.options.menuAlignEl?this.options.menuAlignEl.outerHeight():Common.Utils.innerHeight()-10,h="number"==typeof this.options.restoreMenuHeightAndTop?this.options.restoreMenuHeightAndTop:1e5,d=r+i.outerHeight()>c&&r+h>c&&.9*(n.top-s)>c-r;o?d&&(r=n.top-s-i.outerHeight()):i.toggleClass("show-top",d)}o&&(l+i.outerWidth()>Common.Utils.innerWidth()&&(l+=this.cmpEl.outerWidth()-i.outerWidth()),i.css({left:l,top:r+s}))}},onAfterShowMenu:function(t){this.alignMenuPosition();var e=$(this.el).find("ul"),i=e.find("> li.selected");if(i.length){var o=Common.Utils.getPosition(i).top,n=i.outerHeight(),s=e.outerHeight();if(o<0||o+n>s){var a=e.scrollTop()+o+(n-s)/2;a=Math.floor(a/n)*n,e.scrollTop(a)}setTimeout((function(){i.find("a").focus()}),1)}else if(this.focusWhenNoSelection){var r=this;setTimeout((function(){r.cmpEl.find("ul li:first a").focus()}),1)}this.scroller&&this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible}),this.cmpEl.find(".form-control").attr("aria-expanded","true"),this.trigger("show:after",this,t,{fromKeyDown:void 0===t}),this._search={}},alignMenuPosition:function(){if(this.restoreMenuHeight){var t=$(this.el).find("ul");if("number"!=typeof this.restoreMenuHeight){var e=parseFloat(t.css("max-height"));t.hasClass("scrollable-menu")||e?this.restoreMenuHeight=e||1e5:this.restoreMenuHeight=1e5}var i=Common.Utils.croppedGeometry(),o=this.options.menuAlignEl?Common.Utils.getOffset(this.options.menuAlignEl).top:i.top,n=this.options.menuAlignEl?this.options.menuAlignEl.outerHeight():i.height-10,s=t.outerHeight(),a=Common.Utils.getBoundingClientRect(t.get(0)).top,r=s;s<this.restoreMenuHeight&&(r=this.restoreMenuHeight);var l=Common.Utils.getOffset(this.cmpEl);a<l.top?l.top-o<r&&(r=l.top-o):a+r>n+o&&(r=n+o-a),r!==s&&(t.css("max-height",r+"px"),t.hasClass("menu-absolute")&&a<l.top&&t.css({top:l.top-t.outerHeight()}))}},onBeforeHideMenu:function(t){this.trigger("hide:before",this,t),Common.UI.Scroller.isMouseCapture()&&t.preventDefault()},onAfterHideMenu:function(t,e){if(this.cmpEl.find(".dropdown-toggle").blur(),this.cmpEl.find(".form-control").attr("aria-expanded","false"),this.trigger("hide:after",this,t,e),Common.NotificationCenter.trigger("menu:hide",this,e),this.options.takeFocusOnClose){var i=this;i._input&&i._input.length>0&&!i.editable&&i._input[0].selectionStart===i._input[0].selectionEnd&&setTimeout((function(){i._input[0].selectionStart=i._input[0].selectionEnd=0}),1),setTimeout((function(){i.focus()}),1)}},onAfterKeydownMenu:function(t){var e=this;if(t.keyCode==Common.UI.Keys.DOWN&&!this.editable&&!this.isMenuOpen())return this.onBeforeShowMenu(),this.openMenu(0,(function(){e.onAfterShowMenu()})),!1;if(this.focusWhenNoSelection||t.keyCode!=Common.UI.Keys.DOWN&&t.keyCode!=Common.UI.Keys.UP){if(t.keyCode==Common.UI.Keys.RETURN&&(this.editable||this.isMenuOpen())){var i=this.isMenuOpen();return $(t.target).click(),this.rendered&&(Common.Utils.isIE?this._input.trigger("change",{onkeydown:!0}):this._input.blur()),!i}if(t.keyCode==Common.UI.Keys.ESC&&this.isMenuOpen())return this._input.val(this.lastValue),this.closeMenu(),this.onAfterHideMenu(t),!1;if(this.search&&t.keyCode>64&&t.keyCode<91&&t.key){if("object"!==_typeof(this._search))return;clearTimeout(this._search.timer),this._search.timer=setTimeout((function(){e._search={}}),1e3),!this._search.text&&(this._search.text=""),!this._search.char&&(this._search.char=t.key),this._search.char!==t.key&&(this._search.full=!0),this._search.text+=t.key,void 0===this._search.index&&(o=this.cmpEl.find("ul > li").find("> a"),this._search.index=o.index(o.filter(":focus"))),this.selectCandidate()}}else{var o;0===(o=this.cmpEl.find("ul > li a")).filter(":focus").length&&o.length>0&&setTimeout((function(){o[t.keyCode==Common.UI.Keys.DOWN?0:o.length-1].focus()}),1)}},selectCandidate:function(){for(var t,e,i=this,o=this._search.index&&-1!=this._search.index?this._search.index:0,n=new RegExp("^"+(this._search.full?this._search.text:this._search.char),"i"),s=this.searchFields.some((function(t){return n.test(i.store.at(o).get(t))})),a=0;a<this.store.length;a++){var r=this.store.at(a),l=!1;if(this.searchFields.forEach((function(c){if(r.get(c)&&n.test(r.get(c))){if(!t&&(t=r,e=a,!s))return void(l=!0);if(i._search.full&&a==o||a>o)return t=r,e=a,void(l=!0)}})),l)break}if(t){if(this._search.index=e,r=$("#"+t.get("id")+" a",$(this.el)),this.scroller){this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible});var c=$(this.el).find("ul"),h=Common.Utils.getPosition(r).top,d=r.outerHeight(),m=c.outerHeight();if(h<0||h+d>m){var p=c.scrollTop()+h;p=Math.floor(p/d)*d,c.scrollTop(p)}}r.focus()}},onInputKeyDown:function(t){var e=this;t.keyCode==Common.UI.Keys.ESC?(this._input.val(this.lastValue),this.closeMenu(),this.onAfterHideMenu(t)):t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN?(this.isMenuOpen()||this.openMenu(0,(function(){e.onAfterShowMenu()})),_.delay((function(){e._skipInputChange=!0,e.cmpEl.find("ul li:first a").focus()}),10)):t.keyCode==Common.UI.Keys.RETURN&&$(t.target).val()===e.lastValue?this._input.trigger("change",{reapply:!0}):e._skipInputChange=!1},onInputFocusIn:function(t){this.trigger("combo:focusin",this,t)},onInputChanged:function(t,e){if(!e||!e.synthetic)if(this._skipInputChange)this._skipInputChange=!1;else{var i=$(t.target).val(),o={};if(this.lastValue!==i||e&&e.reapply){if(o[this.valueField]=i,this.trigger("changed:before",this,o,t),!t.isDefaultPrevented()){var n;if(this._selectedItem=this.store.findWhere(((n={})[this.displayField]=i,n)),this._selectedItem){o=this._selectedItem.toJSON();var s=$(".selected",$(this.el));s.removeClass("selected"),s.find("a").attr("aria-checked",!1);var a=$("#"+this._selectedItem.get("id"),$(this.el));a.addClass("selected"),a.find("a").attr("aria-checked",!0)}this.trigger("changed:after",this,o,t)}}else e&&e.onkeydown&&this.trigger("combo:blur",this,t)}},onInputChanging:function(t,e){var i=$(t.target).val();t.isDefaultPrevented()||this.trigger("changing",this,i,t)},onInputClick:function(t){this._button&&this._button.dropdown("toggle"),t.preventDefault(),t.stopPropagation()},onEditableInputClick:function(t){if(this.options.hint){var e=this.cmpEl.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.hide())}this.isMenuOpen()&&1==t.which&&t.stopPropagation()},setDefaultSelection:function(){if(this.rendered){var t,e=this._input.val();if(e&&(this._selectedItem=this.store.findWhere(((t={})[this.displayField]=e,t)),this._selectedItem)){var i=$(".selected",$(this.el)),o=$("#"+this._selectedItem.get("id"),$(this.el));i.removeClass("selected"),i.find("a").attr("aria-checked",!1),o.addClass("selected"),o.find("a").attr("aria-checked",!0)}}},setDisabled:function(t){t=!!t,this.disabled=t,this.rendered&&(t?this._input.attr("disabled",!0):this._input.removeAttr("disabled"),this.cmpEl.toggleClass("disabled",t),this._button.toggleClass("disabled",t))},isDisabled:function(){return this.disabled},setRawValue:function(t){this.rendered&&(this._input.val(t).trigger("change",{synthetic:!0}),this.lastValue=null!=t?t.toString():t)},getRawValue:function(){return this.rendered?this._input.val():null},setValue:function(t,e){if(this.rendered){var i;this._selectedItem=this.store.findWhere(((i={})[this.valueField]=t,i));var o=$(".selected",$(this.el));if(o.removeClass("selected"),o.find("a").attr("aria-checked",!1),this._selectedItem){this.setRawValue(this._selectedItem.get(this.displayField));var n=$("#"+this._selectedItem.get("id"),$(this.el));n.addClass("selected"),n.find("a").attr("aria-checked",!0)}else this.setRawValue(void 0!==e?e:t)}},getValue:function(){return this.rendered?this._selectedItem&&!_.isUndefined(this._selectedItem.get(this.valueField))?this._selectedItem.get(this.valueField):this._input.val():null},getDisplayValue:function(t){return Common.Utils.String.htmlEncode(t[this.displayField])},getSelectedRecord:function(){return this.rendered&&this._selectedItem&&!_.isUndefined(this._selectedItem.get(this.valueField))?_.extend({},this._selectedItem.toJSON()):null},selectRecord:function(t){if(this.rendered&&t){this._selectedItem=t;var e=$(".selected",$(this.el));e.removeClass("selected"),e.find("a").attr("aria-checked",!1),this.setRawValue(this._selectedItem.get(this.displayField));var i=$("#"+this._selectedItem.get("id"),$(this.el));i.addClass("selected"),i.find("a").attr("aria-checked",!0)}},clearSelection:function(){var t=$(".selected",$(this.el));t.removeClass("selected"),t.find("a").attr("aria-checked",!1),this._selectedItem=null},itemClicked:function(t){var e=$(t.target).closest("li");if(this._selectedItem=this.store.findWhere({id:e.attr("id")}),this._selectedItem){this.lastValue=this._selectedItem.get(this.displayField),this._input.val(this.lastValue).trigger("change",{synthetic:!0});var i=$(".selected",$(this.el));i.removeClass("selected"),i.find("a").attr("aria-checked",!1),e.addClass("selected"),e.find("a").attr("aria-checked",!0),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),t),t.preventDefault()}this._isMouseDownMenu=!1},itemMouseDown:function(t){if(1!=t.which)return t.preventDefault(),t.stopPropagation(),!1;this._isMouseDownMenu=!0},onResetItems:function(){this.itemsTemplate?$(this.el).find("ul").html($(this.itemsTemplate({items:this.store.toJSON(),scope:this}))):this.itemTemplate?$(this.el).find("ul").html($(_.template(["<% _.each(items, function(item) { %>","<%= itemTemplate(item) %>","<% }); %>"].join(""))({items:this.store.toJSON(),itemTemplate:this.itemTemplate,scope:this}))):$(this.el).find("ul").html(_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%- item.value %>"><a tabindex="-1" type="menuitem" role="menuitemcheckbox" aria-checked="false"><%= scope.getDisplayValue(item) %></a></li>',"<% }); %>"].join(""))({items:this.store.toJSON(),scope:this})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.scroller=new Common.UI.Scroller(_.extend({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,includePadding:!0,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible},this.options.scroller))},focus:function(){this._input&&this._input.focus()}}),Common.UI.ComboBoxCustom=Common.UI.ComboBox.extend(_.extend({itemClicked:function(t){Common.UI.ComboBox.prototype.itemClicked.call(this,t),this.options.updateFormControl&&this.options.updateFormControl.call(this,this._selectedItem)},setValue:function(t,e){Common.UI.ComboBox.prototype.setValue.call(this,t,e),this.options.updateFormControl&&this.options.updateFormControl.call(this,this._selectedItem,e)},selectRecord:function(t){Common.UI.ComboBox.prototype.selectRecord.call(this,t),this.options.updateFormControl&&this.options.updateFormControl.call(this,this._selectedItem)},setWidth:function(t){this.cmpEl&&this.cmpEl.width(t)},focus:function(){this.cmpEl&&this.cmpEl.find(".form-control").focus()}},Common.UI.ComboBoxCustom||{})),Common.UI.ComboBoxRecent=Common.UI.ComboBox.extend(_.extend({initialize:function(t){this.setRecent(t.recent),Common.UI.ComboBox.prototype.initialize.call(this,t)},render:function(t){return Common.UI.ComboBox.prototype.render.call(this,t),$(this.el).find("ul").prepend($('<li class="divider">')),this.loadRecent(),this},setData:function(t){Common.UI.ComboBox.prototype.setData.call(this,t),$(this.el).find("ul").prepend($('<li class="divider">')),this.loadRecent()},itemClicked:function(t){Common.UI.ComboBox.prototype.itemClicked.call(this,t),this._selectedItem&&this.addItemToRecent(this._selectedItem)},onAfterShowMenu:function(t){this.recent&&this.recentArr&&this.recentArr.length?(this.alignMenuPosition(),$(this.el).find("ul").scrollTop(0),this.scroller&&this.scroller.update({alwaysVisibleY:this.scrollAlwaysVisible}),this.cmpEl.find(".form-control").attr("aria-expanded","true"),this.trigger("show:after",this,t,{fromKeyDown:void 0===t}),this._search={}):Common.UI.ComboBox.prototype.onAfterShowMenu.apply(this,arguments)},onBeforeShowMenu:function(t){if(this.loadRecent(),Common.UI.ComboBox.prototype.onBeforeShowMenu.apply(this,arguments),this._selectedItem){var e,i=this.store.findWhere(((e={})[this.valueField]=this._selectedItem.get(this.valueField),e));i&&this.selectRecord(i)}},setRecent:function(t){var e=Common.localStorage.getKeysFilter();this.recent=!!t&&{count:t.count||5,key:t.key||(e&&e.length?e.split(",")[0]:"")+this.id,offset:t.offset||0,valueField:t.valueField||"value"}},loadRecent:function(){if(this.recent){this.recentArr||(this.recentArr=[],this.store.on("add",this.onInsertRecentItem,this),this.store.on("remove",this.onRemoveRecentItem,this)),this.store.remove(this.store.where({isRecent:!0}));var t=this,e=Common.localStorage.getItem(this.recent.key);(e=e?e.split(";"):[]).reverse().forEach((function(e){var i;e&&t.addItemToRecent(t.store.findWhere(((i={})[t.recent.valueField]=e,i)),!0,0)})),this.recentArr=e}},addItemToRecent:function(t,e,i){if(t&&this.recent){var o,n=this,s=this.store.findWhere(((o={isRecent:!0})[this.recent.valueField]=t.get(this.recent.valueField),o));if(!(s&&this.store.indexOf(s)<this.recent.offset)){s&&this.store.remove(s);var a=this.store.where({isRecent:!0});a.length<this.recent.count||this.store.remove(a[this.recent.count-1]);var r=t.clone();if(r.set({isRecent:!0,id:Common.UI.getId(),cloneid:t.id}),this.store.add(r,{at:void 0!==i?i:this.recent.offset}),!e){var l=[];this.store.where({isRecent:!0}).forEach((function(t){l.push(t.get(n.recent.valueField))})),this.recentArr=l,Common.localStorage.setItem(this.recent.key,l.join(";"))}}}},onInsertRecentItem:function(t,e,i){var o=$(this.el).find("ul > li").eq(i&&i.at||0);this.itemTemplate?o.before($(this.itemTemplate(t.attributes))):o.before(_.template(['<li id="<%= item.id %>" data-value="<%- item.value %>"><a tabindex="-1" type="menuitem" role="menuitemcheckbox" aria-checked="false"><%= scope.getDisplayValue(item) %></a></li>'].join(""))({item:t.attributes,scope:this}))},onRemoveRecentItem:function(t,e,i){$(this.el).find("ul > li#"+t.id).remove()}},Common.UI.ComboBoxRecent||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/DataView",["common/main/lib/component/BaseView","common/main/lib/component/Scroller"],(function(){"use strict";Common.UI.DataViewGroupModel=Backbone.Model.extend({defaults:function(){return{id:Common.UI.getId(),caption:"",inline:!1,headername:void 0}}}),Common.UI.DataViewGroupStore=Backbone.Collection.extend({model:Common.UI.DataViewGroupModel}),Common.UI.DataViewModel=Backbone.Model.extend({defaults:function(){return{id:Common.UI.getId(),selected:!1,allowSelected:!0,value:null,disabled:!1}}}),Common.UI.DataViewStore=Backbone.Collection.extend({model:Common.UI.DataViewModel}),Common.UI.DataViewItem=Common.UI.BaseView.extend({options:{},template:_.template(['<div id="<%= id %>"><%= value %></div>'].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.template=e.options.template||e.template,e.dataHint=e.options.dataHint||"",e.dataHintDirection=e.options.dataHintDirection||"",e.dataHintOffset=e.options.dataHintOffset||"",e.scaling=e.options.scaling,e.listenTo(e.model,"change",this.model.get("skipRenderOnChange")?e.onChange:e.render),e.listenTo(e.model,"change:selected",e.onSelectChange),e.listenTo(e.model,"change:tip",e.onTipChange),e.listenTo(e.model,"remove",e.remove)},render:function(){if(_.isUndefined(this.model.id))return this;var t=this.$el||$(this.el);t.html(this.template(this.model.toJSON())),t.addClass("item canfocused"),t.toggleClass("selected",this.model.get("selected")&&this.model.get("allowSelected")),t.attr("tabindex",this.options.tabindex||0),t.attr("role",this.options.role?this.options.role:"listitem"),""!==this.dataHint&&(t.attr("data-hint",this.dataHint),t.attr("data-hint-direction",this.dataHintDirection),t.attr("data-hint-offset",this.dataHintOffset)),_.isUndefined(this.model.get("contentTarget"))||t.attr("content-target",this.model.get("contentTarget")),t.off("click dblclick contextmenu"),t.on({click:_.bind(this.onClick,this),dblclick:_.bind(this.onDblClick,this),contextmenu:_.bind(this.onContextMenu,this)}),t.toggleClass("disabled",!!this.model.get("disabled")),_.isUndefined(this.model.get("cls"))||t.addClass(this.model.get("cls"));var e=t.data("bs.tooltip");return e&&void 0===e.dontShow&&t.is(":hover")&&(e.dontShow=!0),!1!==this.scaling&&t.find(".options__icon").length&&(t.attr("ratio","ratio"),this.applyScaling(Common.UI.Scaling.currentRatio()),t.on("app:scaling",_.bind((function(t,e){this.scaling!=e.ratio&&this.applyScaling(e.ratio)}),this))),this.trigger("change",this,this.model),this},remove:function(){this.stopListening(this.model),this.trigger("remove",this,this.model),Common.UI.BaseView.prototype.remove.call(this)},onClick:function(t){if(this.model.get("disabled"))return!1;this.trigger("click",this,this.model,t)},onDblClick:function(t){if(this.model.get("disabled"))return!1;this.trigger("dblclick",this,this.model,t)},onContextMenu:function(t){this.trigger("contextmenu",this,this.model,t)},onSelectChange:function(t,e){this.trigger("select",this,t,e)},onTipChange:function(t,e){this.trigger("tipchange",this,t)},onChange:function(){if(_.isUndefined(this.model.id))return this;var t=this.$el||$(this.el);return t.toggleClass("selected",this.model.get("selected")&&this.model.get("allowSelected")),t.toggleClass("disabled",!!this.model.get("disabled")),this.trigger("change",this,this.model),this},applyScaling:function(t){if(this.scaling=t,t>2){var e=this.$el||$(this.el),i=e.find(".options__icon");if(i.length>0&&!e.find("svg.icon").length){var o=i.attr("class"),n=/btn-[^\s]+/.exec(o),s=n?n[0]:"null",a='<svg class="icon"><use class="zoom-int" href="#%iconname"></use></svg>'.replace("%iconname",s);i.after(a)}}}}),Common.UI.DataView=Common.UI.BaseView.extend({options:{multiSelect:!1,handleSelect:!0,enableKeyEvents:!0,keyMoveDirection:"both",restoreHeight:0,emptyText:"",listenStoreEvents:!0,allowScrollbar:!0,scrollAlwaysVisible:!1,minScrollbarLength:40,scrollYStyle:null,showLast:!0,useBSKeydown:!1,cls:"",role:"list"},template:_.template(['<div class="dataview inner <%= cls %>" style="<%= style %>" role="<%= options.role %>">',"<% _.each(groups, function(group) { %>","<% if (group.headername !== undefined) { %>",'<div class="header-name"><%= group.headername %></div>',"<% } %>",'<div class="grouped-data <% if (group.inline) { %> inline <% } %> <% if (!_.isEmpty(group.caption)) { %> margin <% } %>" id="<%= group.id %>">',"<% if (!_.isEmpty(group.caption)) { %>",'<div class="group-description">',"<span><%= group.caption %></span>","</div>","<% } %>",'<div class="group-items-container">',"</div>","</div>","<% }); %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.template=e.options.template||e.template,e.store=e.options.store||new Common.UI.DataViewStore,e.groups=e.options.groups||null,e.itemTemplate=e.options.itemTemplate||null,e.itemDataHint=e.options.itemDataHint||"",e.itemDataHintDirection=e.options.itemDataHintDirection||"",e.itemDataHintOffset=e.options.itemDataHintOffset||"",e.multiSelect=e.options.multiSelect,e.handleSelect=e.options.handleSelect,e.parentMenu=e.options.parentMenu,e.outerMenu=e.options.outerMenu,e.enableKeyEvents=e.options.enableKeyEvents,e.useBSKeydown=e.options.useBSKeydown,e.showLast=e.options.showLast,e.style=e.options.style||"",e.cls=e.options.cls||"",e.emptyText=e.options.emptyText||"",e.listenStoreEvents=void 0===e.options.listenStoreEvents||e.options.listenStoreEvents,e.allowScrollbar=void 0===e.options.allowScrollbar||e.options.allowScrollbar,e.scrollAlwaysVisible=e.options.scrollAlwaysVisible||!1,e.minScrollbarLength=e.options.minScrollbarLength||40,e.scrollYStyle=e.options.scrollYStyle,e.tabindex=e.options.tabindex||0,e.itemTabindex=void 0!==e.options.itemTabindex?e.options.itemTabindex:e.tabindex>0?-1:0,e.delayRenderTips=e.options.delayRenderTips||!1,e.parentMenu&&(e.parentMenu.options.restoreHeight=e.options.restoreHeight>0),e.delaySelect=e.options.delaySelect||!1,e.rendered=!1,e.dataViewItems=[],"vertical"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN]:"horizontal"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT]:e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN,Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT],!1===e.options.scaling&&(e.cls=e.options.cls+" scaling-off"),e.options.el&&e.render()},render:function(t){var e=this;this.trigger("render:before",this),t?(this.setElement(t,!1),this.cmpEl=$(this.template({groups:e.groups?e.groups.toJSON():null,style:e.style,cls:e.cls,options:e.options})),t.html(this.cmpEl)):(this.cmpEl=e.$el||$(this.el),this.cmpEl.html(this.template({groups:e.groups?e.groups.toJSON():null,style:e.style,cls:e.cls,options:e.options})));var i=this.cmpEl.closest(".asc-window");return i.length<1&&(i=this.cmpEl.closest('[id^="menu-container-"]')),i.length>0&&(this.tipZIndex=parseInt(i.css("z-index"))+10),this.rendered||(this.listenStoreEvents&&(this.listenTo(this.store,"add",this.onAddItem),this.listenTo(this.store,"reset",this.onResetItems),this.groups&&(this.listenTo(this.groups,"add",this.onAddGroup),this.listenTo(this.groups,"remove",this.onRemoveGroup))),this.onResetItems(),this.parentMenu&&(this.cmpEl.closest("li").css("height","100%"),this.cmpEl.css("height","100%"),this.parentMenu.on("show:after",_.bind(this.alignPosition,this))),this.enableKeyEvents&&this.parentMenu&&this.handleSelect&&(e.showLast||this.parentMenu.on("show:before",(function(t){e.deselectAll()})),this.parentMenu.on("show:after",(function(t,i){i&&t.el!==i.target||(e.showLast&&e.showLastSelected(),e.outerMenu&&!1===e.outerMenu.focusOnShow||(Common.NotificationCenter.trigger("dataview:focus"),_.delay((function(){t.cmpEl.find(".dataview").focus()}),10)))})).on("hide:after",(function(){Common.NotificationCenter.trigger("dataview:blur")})))),_.isUndefined(this.scroller)&&this.allowScrollbar&&(this.scroller=new Common.UI.Scroller({el:$(this.el).find(".inner").addBack().filter(".inner"),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:this.minScrollbarLength,scrollYStyle:this.scrollYStyle,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible})),this.rendered=!0,(this.$el||$(this.el)).on("click",(function(t){if(/dataview|grouped-data|group-items-container/.test(t.target.className)||$(t.target).closest(".group-description").length>0)return!1})),this.trigger("render:after",this),this},setStore:function(t){t&&(this.stopListening(this.store),this.store=t,this.listenStoreEvents&&(this.listenTo(this.store,"add",this.onAddItem),this.listenTo(this.store,"reset",this.onResetItems)))},selectRecord:function(t,e){if(this.handleSelect){if(e&&this.suspendEvents(),this.extremeSeletedRec=t,!this.multiSelect||!this.pressedShift&&!this.pressedCtrl||!this.currentSelectedRec||this.pressedShift&&this.currentSelectedRec==t)_.each(this.store.where({selected:!0}),(function(t){t.set({selected:!1})})),t&&(t.set({selected:!0}),this.currentSelectedRec=t);else if(t)if(this.pressedCtrl)t.set({selected:!t.get("selected")}),this.currentSelectedRec=t;else if(this.pressedShift){var i=this,o=!1;_.each(i.store.models,(function(e){i.currentSelectedRec==e||t==e?(o=!o,e.set({selected:!0})):e.set({selected:o})}))}return e&&this.resumeEvents(),t}},selectByIndex:function(t,e){if(this.store.length>0&&t>-1&&t<this.store.length)return this.selectRecord(this.store.at(t),e)},deselectAll:function(t){t&&this.suspendEvents(),_.each(this.store.where({selected:!0}),(function(t){t.set({selected:!1})})),this.lastSelectedRec=null,t&&this.resumeEvents()},getSelectedRec:function(){return this.multiSelect?this.store.where({selected:!0}):this.store.findWhere({selected:!0})},onAddItem:function(t,e,i){var o=new Common.UI.DataViewItem({template:this.itemTemplate,model:t,scaling:this.options.scaling,dataHint:this.itemDataHint,dataHintDirection:this.itemDataHintDirection,dataHintOffset:this.itemDataHintOffset,tabindex:this.itemTabindex});if(o){var n=$(this.el).find(".inner").addBack().filter(".inner");if(this.groups&&this.groups.length>0){var s=this.groups.findWhere({id:t.get("group")});s&&(n=n.find("#"+s.id+" .group-items-container"))}var a=_.indexOf(this.store.models,t);if(n){if(i&&"number"==typeof i.at&&i.at>=0)if(0==i.at)n.prepend(o.render().el);else if(this.groups&&this.groups.length>0)n.append(o.render().el);else{var r=n.find("> div");a>0?$(r.get(a-1)).after(o.render().el):r.length>0?$(r[a]).before(o.render().el):n.append(o.render().el)}else n.append(o.render().el);this.dataViewItems.length<1&&n.find(".empty-text").remove(),this.dataViewItems=this.dataViewItems.slice(0,a).concat(o).concat(this.dataViewItems.slice(a));var l=this,c=$(o.el),h=t.get("tip");null!=h&&(this.delayRenderTips?(c.one("mouseenter",(function(){c.attr("data-toggle","tooltip"),c.tooltip({title:t.get("tip"),placement:"cursor",zIndex:l.tipZIndex}),c.mouseenter()})),c.attr("aria-label",t.get("tip"))):(c.attr("data-toggle","tooltip"),c.tooltip({title:t.get("tip"),placement:"cursor",zIndex:l.tipZIndex}),c.attr("aria-label",t.get("tip")))),this.listenTo(o,"change",this.onChangeItem),this.listenTo(o,"remove",this.onRemoveItem),this.listenTo(o,"click",this.onClickItem),this.listenTo(o,"dblclick",this.onDblClickItem),this.listenTo(o,"select",this.onSelectItem),this.listenTo(o,"contextmenu",this.onContextMenuItem),null==h&&this.listenTo(o,"tipchange",this.onInitItemTip),this.isSuspendEvents||this.trigger("item:add",this,o,t)}}this._layoutParams=void 0},onAddGroup:function(t){var e=$(_.template(["<% if (group.headername !== undefined) { %>",'<div class="header-name"><%= group.headername %></div>',"<% } %>",'<div class="grouped-data <% if (group.inline) { %> group.inline <% } %> <% if (!_.isEmpty(group.caption)) { %> margin <% } %>" id="<%= group.id %>">',"<% if (!_.isEmpty(group.caption)) { %>",'<div class="group-description">',"<span><%= group.caption %></span>","</div>","<% } %>",'<div class="group-items-container">',"</div>","</div>"].join(""))({group:t.toJSON()})),i=$(this.el).find(".inner").addBack().filter(".inner");if(i){var o=_.indexOf(this.groups.models,t),n=i.find(".grouped-data");o>0?$(n.get(o-1)).after(e):n.length>0?$(n[o]).before(e):i.append(e)}},onRemoveGroup:function(t){var e=$(this.el).find(".inner").addBack().filter(".inner");if(e){var i=e.find("#"+t.get("id")+".grouped-data");i&&i.remove()}this._layoutParams=void 0},onResetItems:function(){this.trigger("reset:before",this),_.each(this.dataViewItems,(function(t){var e=t.$el.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.tip().remove())}),this),$(this.el).html(this.template({groups:this.groups?this.groups.toJSON():null,style:this.style,cls:this.cls,options:this.options})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.store.length<1&&this.emptyText.length>0&&$(this.el).find(".inner").addBack().filter(".inner").append('<table cellpadding="10" class="empty-text"><tr><td>'+this.emptyText+"</td></tr></table>"),_.each(this.dataViewItems,(function(t){this.stopListening(t),t.stopListening(t.model)}),this),this.dataViewItems=[];var t=this;this.store.each((function(e){t.onAddItem(e,t.store)}),this),this.allowScrollbar&&(this.scroller=new Common.UI.Scroller({el:$(this.el).find(".inner").addBack().filter(".inner"),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:this.minScrollbarLength,scrollYStyle:this.scrollYStyle,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible})),this.disabled&&this.setDisabled(this.disabled),this.attachKeyEvents(),this.lastSelectedRec=null,this._layoutParams=void 0},onChangeItem:function(t,e){this.isSuspendEvents||this.trigger("item:change",this,t,e)},onInitItemTip:function(t,e){var i=this,o=$(t.el),n=o.data("bs.tooltip");null!=n&&o.removeData("bs.tooltip"),this.delayRenderTips?(o.one("mouseenter",(function(){o.attr("data-toggle","tooltip"),o.tooltip({title:e.get("tip"),placement:"cursor",zIndex:i.tipZIndex}),o.mouseenter()})),o.attr("aria-label",e.get("tip"))):(o.attr("data-toggle","tooltip"),o.tooltip({title:e.get("tip"),placement:"cursor",zIndex:i.tipZIndex}),o.attr("aria-label",e.get("tip")))},onRemoveItem:function(t,e){var i=t.$el.data("bs.tooltip");if(i&&(void 0===i.dontShow&&(i.dontShow=!0),i.tip().remove()),this.stopListening(t),t.stopListening(),this.store.length<1&&this.emptyText.length>0){var o=$(this.el).find(".inner").addBack().filter(".inner");o.find(".empty-text").length<=0&&o.append('<table cellpadding="10" class="empty-text"><tr><td>'+this.emptyText+"</td></tr></table>")}for(var n=0;n<this.dataViewItems.length;n++)if(_.isEqual(t,this.dataViewItems[n])){this.dataViewItems.splice(n,1);break}this.isSuspendEvents||this.trigger("item:remove",this,t,e),this._layoutParams=void 0},onClickItem:function(t,e,i){if(!this.disabled){window._event=i,this.multiSelect&&(i&&i.ctrlKey?this.pressedCtrl=!0:i&&i.shiftKey&&(this.pressedShift=!0)),this.showLast&&(this.delaySelect?(_.each(this.store.where({selected:!0}),(function(t){t.set({selected:!1})})),e&&setTimeout(_.bind((function(){e.set({selected:!0}),this.trigger("item:click",this,t,e,i)}),this),300)):this.selectRecord(e)),this.lastSelectedRec=null;var o=t.$el.data("bs.tooltip");o&&o.tip().remove(),this.isSuspendEvents||this.delaySelect||this.trigger("item:click",this,t,e,i)}},onDblClickItem:function(t,e,i){this.disabled||(window._event=i,this.showLast&&this.selectRecord(e),this.lastSelectedRec=null,this.isSuspendEvents||this.trigger("item:dblclick",this,t,e,i))},onSelectItem:function(t,e,i){this.isSuspendEvents||this.trigger(i?"item:select":"item:deselect",this,t,e,this._fromKeyDown)},onContextMenuItem:function(t,e,i){this.isSuspendEvents||this.trigger("item:contextmenu",this,t,e,i)},scrollToRecord:function(t,e,i){if(t){var o=$(this.el).find(".inner"),n=Common.Utils.getOffset(o).top+(i||0),s=_.indexOf(this.store.models,t),a=s>=0&&this.dataViewItems.length>s?$(this.dataViewItems[s].el):o.find("#"+t.get("id"));if(!(a.length<=0)){var r=Common.Utils.getOffset(a).top,l=$(this.dataViewItems[0].el),c=l.length>0?l[0].clientTop:0;(e||r<n+c||r+.9*a.outerHeight()>n+c+o.height())&&(this.scroller&&this.allowScrollbar?this.scroller.scrollTop(o.scrollTop()+r-n-c,0):o.scrollTop(o.scrollTop()+r-n-c))}}},onKeyDown:function(t,e){if(!this.disabled&&(void 0===e&&(e=t),!e.isDefaultPrevented()&&this.enableKeyEvents))if(this.multiSelect&&(e.keyCode==Common.UI.Keys.CTRL?this.pressedCtrl=!0:e.keyCode==Common.UI.Keys.SHIFT&&(this.pressedShift=!0)),_.indexOf(this.moveKeys,e.keyCode)>-1||e.keyCode==Common.UI.Keys.RETURN){e.preventDefault(),e.stopPropagation();var i=this.multiSelect?this.extremeSeletedRec:this.getSelectedRec();if(null===this.lastSelectedRec&&(this.lastSelectedRec=i),e.keyCode==Common.UI.Keys.RETURN)this.lastSelectedRec=null,this.selectedBeforeHideRec&&(i=this.selectedBeforeHideRec),this.trigger("item:click",this,this,i,t),this.trigger("item:select",this,this,i,t),this.trigger("entervalue",this,i,t),this.parentMenu&&this.parentMenu.hide();else{var o=function(){if(0===this.dataViewItems.length)return 0;for(var t=0;!this.dataViewItems[t]||!this.dataViewItems[t].$el||this.dataViewItems[t].$el.hasClass("disabled");)t++;return t};this.pressedCtrl=!1;var n=_.indexOf(this.store.models,i);if(n<0)if(e.keyCode==Common.UI.Keys.LEFT)(l=$(t.target).closest(".dropdown-submenu.over")).length>0?(l.removeClass("over"),l.find("> a").focus()):n=o.call(this);else n=o.call(this);else if("both"==this.options.keyMoveDirection){var s=function(){var t=this.dataViewItems[this._layoutParams.itemsIndexes[a][r]];if(t&&t.$el&&!t.$el.hasClass("disabled"))return this._layoutParams.itemsIndexes[a][r]};void 0===this._layoutParams&&this.fillIndexesArray();var a=this.dataViewItems[n].topIdx,r=this.dataViewItems[n].leftIdx;if(n=void 0,e.keyCode==Common.UI.Keys.LEFT)for(;void 0===n;){if(--r<0){var l;if((l=$(t.target).closest(".dropdown-submenu.over")).length>0){l.removeClass("over"),l.find("> a").focus();break}r=this._layoutParams.columns-1}n=s.call(this)}else if(e.keyCode==Common.UI.Keys.RIGHT)for(;void 0===n;)++r>this._layoutParams.columns-1&&(r=0),n=s.call(this);else if(e.keyCode==Common.UI.Keys.UP){if(0==a&&this.outerMenu&&this.outerMenu.menu)return this.deselectAll(!0),void(this.outerMenu.menu.focusOuter&&this.outerMenu.menu.focusOuter(e,this.outerMenu.index));for(;void 0===n;)--a<0&&(a=this._layoutParams.rows-1),n=s.call(this)}else{if(a==this._layoutParams.rows-1&&this.outerMenu&&this.outerMenu.menu)return this.deselectAll(!0),void(this.outerMenu.menu.focusOuter&&this.outerMenu.menu.focusOuter(e,this.outerMenu.index));for(;void 0===n;)++a>this._layoutParams.rows-1&&(a=0),n=s.call(this)}}else{var c=function(){var t=this.dataViewItems[a];if(t&&t.$el&&!t.$el.hasClass("disabled"))return a},h=(a=n,o.call(this)),d=function(){if(0===this.dataViewItems.length)return 0;for(var t=this.dataViewItems.length-1;!this.dataViewItems[t]||!this.dataViewItems[t].$el||this.dataViewItems[t].$el.hasClass("disabled");)t--;return t}.call(this);for(n=void 0;void 0===n;)a=e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.LEFT?Math.max(h,a-1):Math.min(d,a+1),n=c.call(this)}void 0!==n&&n>=0&&(i=this.store.at(n)),i&&(this._fromKeyDown=!0,this.selectRecord(i),this.scrollToRecord(i),-1!==this.itemTabindex&&this.dataViewItems[n]&&this.dataViewItems[n].$el.focus(),this._fromKeyDown=!1)}}else this.trigger("item:keydown",this,i,t)},onKeyUp:function(t){this.enableKeyEvents&&(t.keyCode==Common.UI.Keys.SHIFT&&(this.pressedShift=!1),t.keyCode==Common.UI.Keys.CTRL&&(this.pressedCtrl=!1),this.trigger("item:keyup",this,t))},attachKeyEvents:function(){if(this.enableKeyEvents&&this.handleSelect){var t=$(this.el).find(".inner").addBack().filter(".inner");t.addClass("canfocused"),t.attr("tabindex",this.tabindex.toString()),t.on(this.parentMenu&&this.useBSKeydown?"dataview:keydown":"keydown",_.bind(this.onKeyDown,this)),t.on(this.parentMenu&&this.useBSKeydown?"dataview:keyup":"keyup",_.bind(this.onKeyUp,this))}},showLastSelected:function(){if(this.lastSelectedRec)this.selectRecord(this.lastSelectedRec,!0),this.scrollToRecord(this.lastSelectedRec),this.lastSelectedRec=null;else{var t=this.getSelectedRec();this.multiSelect?t&&t.length>0&&this.scrollToRecord(t[t.length-1]):this.scrollToRecord(t)}},setDisabled:function(t){t=!!t,this.disabled=t,$(this.el).find(".inner").addBack().filter(".inner").toggleClass("disabled",t)},isDisabled:function(){return this.disabled},setEmptyText:function(t){if(this.emptyText=t,this.store.length<1){var e=$(this.el).find(".inner").addBack().filter(".inner").find(".empty-text td");e.length>0&&e.text(this.emptyText)}},alignPosition:function(){var t="menu"===this.parentMenu.cmpEl.attr("role")?this.parentMenu.cmpEl:this.parentMenu.cmpEl.find("[role=menu]"),e=Common.Utils.innerHeight()-10,i=$(this.el).find(".inner").addBack().filter(".inner"),o=t.outerHeight(),n=i.height(),s=Math.max(o-n,0),a=parseInt(t.css("top")),r={minScrollbarLength:this.minScrollbarLength};this.scrollAlwaysVisible&&(r.alwaysVisibleY=this.scrollAlwaysVisible),a+o>e?(i.css("max-height",e-a-s+"px"),this.allowScrollbar&&this.scroller.update(r)):a+o<e&&n<this.options.restoreHeight&&(i.css("max-height",Math.min(e-a-s,this.options.restoreHeight)+"px"),this.allowScrollbar&&this.scroller.update(r))},fillIndexesArray:function(){if(!(this.dataViewItems.length<=0)){this._layoutParams={itemsIndexes:[],columns:0,rows:0};for(var t=$(this.dataViewItems[0].el),e=t.outerWidth()+parseFloat(t.css("margin-left"))+parseFloat(t.css("margin-right")),i=Common.Utils.getOffset(this.$el).left,o=Common.Utils.getOffset(t).top,n=-1,s=0,a=0,r=0;r<this.dataViewItems.length;r++){var l=Common.Utils.getOffset($(this.dataViewItems[r].el)).top-o;a=Math.floor((Common.Utils.getOffset($(this.dataViewItems[r].el)).left-i)/e+.01),l>n&&(n=l,this._layoutParams.itemsIndexes.push([]),s=this._layoutParams.itemsIndexes.length-1),this._layoutParams.itemsIndexes[s][a]=r,this.dataViewItems[r].topIdx=s,this.dataViewItems[r].leftIdx=a,this._layoutParams.columns<a&&(this._layoutParams.columns=a)}this._layoutParams.rows=this._layoutParams.itemsIndexes.length,this._layoutParams.columns++}},setMultiselectMode:function(t){this.pressedCtrl=!!t},onResize:function(){this._layoutParams=void 0},focus:function(t){var e;$(this.el).find(".inner").addBack().filter(".inner").focus(),"string"==typeof t?"first"==t?e=this.selectByIndex(0,!0):"last"==t&&(void 0===this._layoutParams&&this.fillIndexesArray(),e=this.selectByIndex(this._layoutParams.itemsIndexes[this._layoutParams.rows-1][0],!0)):void 0!==t&&(e=this.selectByIndex(t,!0)),this.scrollToRecord(e)},focusInner:function(t){this.focus(t.keyCode==Common.UI.Keys.DOWN?"first":"last")}}),Common.UI.DataViewSimple=Common.UI.BaseView.extend({options:{handleSelect:!0,enableKeyEvents:!0,keyMoveDirection:"both",restoreHeight:0,scrollAlwaysVisible:!1,useBSKeydown:!1},template:_.template(['<div class="dataview inner" style="<%= style %>" role="list">',"<% _.each(items, function(item) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>",'<div class="item" role="listitem" <% if(typeof itemTabindex !== undefined) { %> tabindex="<%= itemTabindex %>" <% } %> <% if(!!item.tip) { %> data-toggle="tooltip" <% } %> data-hint="<%= item.dataHint %>" data-hint-direction="<%= item.dataHintDirection %>" data-hint-offset="<%= item.dataHintOffset %>"><%= itemTemplate(item) %></div>',"<% }) %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.template=e.options.template||e.template,e.store=e.options.store||new Common.UI.DataViewStore,e.itemTemplate=e.options.itemTemplate||null,e.handleSelect=e.options.handleSelect,e.parentMenu=e.options.parentMenu,e.outerMenu=e.options.outerMenu,e.enableKeyEvents=e.options.enableKeyEvents,e.useBSKeydown=e.options.useBSKeydown,e.style=e.options.style||"",e.scrollAlwaysVisible=e.options.scrollAlwaysVisible||!1,e.tabindex=e.options.tabindex||0,e.itemTabindex=void 0!==e.options.itemTabindex?e.options.itemTabindex:e.tabindex>0?-1:0,e.parentMenu&&(e.parentMenu.options.restoreHeight=e.options.restoreHeight>0),e.rendered=!1,"vertical"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN]:"horizontal"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT]:e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN,Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT],e.options.el&&e.render()},render:function(t){var e=this;this.trigger("render:before",this),t?(this.setElement(t,!1),this.cmpEl=$(this.template({items:e.store.toJSON(),itemTemplate:e.itemTemplate,style:e.style,itemTabindex:e.itemTabindex||0})),t.html(this.cmpEl)):(this.cmpEl=e.$el||$(this.el),this.cmpEl.html(this.template({items:e.store.toJSON(),itemTemplate:e.itemTemplate,style:e.style,options:e.options,itemTabindex:e.itemTabindex||0})));var i=this.cmpEl.closest(".asc-window");return i.length<1&&(i=this.cmpEl.closest('[id^="menu-container-"]')),i.length>0&&(this.tipZIndex=parseInt(i.css("z-index"))+10),this.rendered||(this.parentMenu?(this.cmpEl.closest("li").css("height","100%"),this.cmpEl.css("height","100%"),this.parentMenu.on("show:after",_.bind(this.alignPosition,this)),this.parentMenu.on("show:after",_.bind(this.onAfterShowMenu,this))):this.store.length>0&&this.onAfterShowMenu(),this.enableKeyEvents&&this.parentMenu&&this.handleSelect&&(this.parentMenu.on("show:before",(function(t){e.deselectAll()})),this.parentMenu.on("show:after",(function(t){Common.NotificationCenter.trigger("dataview:focus"),_.delay((function(){t.cmpEl.find(".dataview").focus()}),10)})).on("hide:after",(function(){Common.NotificationCenter.trigger("dataview:blur")}))),this.attachKeyEvents(),this.cmpEl.on("click","div.item",_.bind(e.onClickItem,e))),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:$(this.el).find(".inner").addBack().filter(".inner"),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:this.minScrollbarLength,scrollYStyle:this.scrollYStyle,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible})),this.rendered=!0,(this.$el||$(this.el)).on("click",(function(t){if(/dataview|grouped-data|group-items-container/.test(t.target.className)||$(t.target).closest(".group-description").length>0)return!1})),this.trigger("render:after",this),this},selectRecord:function(t,e){if(this.handleSelect){if(e&&this.suspendEvents(),this.deselectAll(e),t){t.set({selected:!0});var i=_.indexOf(this.store.models,t);i>=0&&this.dataViewItems&&this.dataViewItems.length>i&&this.dataViewItems[i].el.addClass("selected")}return e&&this.resumeEvents(),t}},selectByIndex:function(t,e){if(this.store.length>0&&t>-1&&t<this.store.length)return this.selectRecord(this.store.at(t),e)},deselectAll:function(t){t&&this.suspendEvents(),_.each(this.store.where({selected:!0}),(function(t){t.set({selected:!1})})),this.cmpEl.find(".item.selected").removeClass("selected"),this.lastSelectedRec=null,t&&this.resumeEvents()},getSelectedRec:function(){return this.store.findWhere({selected:!0})},onResetItems:function(){this.dataViewItems&&_.each(this.dataViewItems,(function(t){var e=t.el.data("bs.tooltip");e&&(void 0===e.dontShow&&(e.dontShow=!0),e.tip().remove())}),this),this.dataViewItems=null;var t=_.template(["<% _.each(items, function(item) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>",'<div class="item" role="listitem" <% if(typeof itemTabindex !== undefined) { %> tabindex="<%= itemTabindex %>" <% } %> <% if(!!item.tip) { %> data-toggle="tooltip" <% } %> data-hint="<%= item.dataHint %>" data-hint-direction="<%= item.dataHintDirection %>" data-hint-offset="<%= item.dataHintOffset %>"><%= itemTemplate(item) %></div>',"<% }) %>"].join(""));this.cmpEl&&this.cmpEl.find(".inner").html(t({items:this.store.toJSON(),itemTemplate:this.itemTemplate,style:this.style,itemTabindex:this.itemTabindex||0})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.scroller=new Common.UI.Scroller({el:$(this.el).find(".inner").addBack().filter(".inner"),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:this.minScrollbarLength,scrollYStyle:this.scrollYStyle,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible}),!this.parentMenu&&this.store.length>0&&this.onAfterShowMenu(),this._layoutParams=void 0},setStore:function(t){t&&(this.store=t,this.onResetItems())},onClickItem:function(t){if(!this.disabled){window._event=t;var e=$(t.currentTarget).closest("div.item").index(),i=e>=0?this.store.at(e):null,o=e>=0?this.dataViewItems[e]:null;if(i&&o){i.set({selected:!0});var n=o.el.data("bs.tooltip");n&&n.tip().remove(),this.isSuspendEvents||this.trigger("item:click",this,o.el,i,t)}}},onAfterShowMenu:function(t){if(!this.dataViewItems){var e=this;this.dataViewItems=[],_.each(this.cmpEl.find("div.item"),(function(t,i){var o=$(t),n=e.store.at(i);e.dataViewItems.push({el:o});var s=n.get("tip");s&&(o.tooltip({title:s,placement:"cursor",zIndex:e.tipZIndex}),o.attr("aria-label",s))}))}},scrollToRecord:function(t){if(t){var e=$(this.el).find(".inner"),i=Common.Utils.getOffset(e).top,o=_.indexOf(this.store.models,t),n=o>=0&&this.dataViewItems.length>o?this.dataViewItems[o].el:e.find("#"+t.get("id"));if(!(n.length<=0)){var s=Common.Utils.getOffset(n).top,a=this.dataViewItems[0].el,r=a.length>0?a[0].offsetTop:0;(s<i+r||s+n.outerHeight()>i+e.height())&&(this.scroller?this.scroller.scrollTop(e.scrollTop()+s-i-r,0):e.scrollTop(e.scrollTop()+s-i-r))}}},onKeyDown:function(t,e){if(!this.disabled)if(void 0===e&&(e=t),_.indexOf(this.moveKeys,e.keyCode)>-1||e.keyCode==Common.UI.Keys.RETURN){e.preventDefault(),e.stopPropagation();var i=this.getSelectedRec();if(e.keyCode==Common.UI.Keys.RETURN)this.selectedBeforeHideRec&&(i=this.selectedBeforeHideRec),this.canAddRecents&&this.addRecentItem(i),this.trigger("item:click",this,this,i,t),this.parentMenu&&this.parentMenu.hide();else{var o=_.indexOf(this.store.models,i);if(o<0){var n=function(){if(0===this.dataViewItems.length)return 0;for(var t=0;!this.dataViewItems[t].el.is(":visible");)t++;return t};if(e.keyCode==Common.UI.Keys.LEFT)(r=$(t.target).closest(".dropdown-submenu.over")).length>0?(r.removeClass("over"),r.find("> a").focus()):o=n.call(this);else o=n.call(this)}else if("both"==this.options.keyMoveDirection){void 0===this._layoutParams&&this.fillIndexesArray();var s=this.dataViewItems[o].topIdx,a=this.dataViewItems[o].leftIdx;if(o=void 0,e.keyCode==Common.UI.Keys.LEFT)for(;void 0===o;){if(--a<0){var r;if((r=$(t.target).closest(".dropdown-submenu.over")).length>0){r.removeClass("over"),r.find("> a").focus();break}a=this._layoutParams.columns-1}o=this._layoutParams.itemsIndexes[s][a]}else if(e.keyCode==Common.UI.Keys.RIGHT)for(;void 0===o;)++a>this._layoutParams.columns-1&&(a=0),o=this._layoutParams.itemsIndexes[s][a];else if(e.keyCode==Common.UI.Keys.UP){if(0==s&&this.outerMenu&&this.outerMenu.menu)return this.deselectAll(!0),void(this.outerMenu.menu.focusOuter&&this.outerMenu.menu.focusOuter(e,this.outerMenu.index));for(;void 0===o;)--s<0&&(s=this._layoutParams.rows-1),o=this._layoutParams.itemsIndexes[s][a]}else{if(s==this._layoutParams.rows-1&&this.outerMenu&&this.outerMenu.menu)return this.deselectAll(!0),void(this.outerMenu.menu.focusOuter&&this.outerMenu.menu.focusOuter(e,this.outerMenu.index));for(;void 0===o;)++s>this._layoutParams.rows-1&&(s=0),o=this._layoutParams.itemsIndexes[s][a]}}else o=e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.LEFT?Math.max(0,o-1):Math.min(this.store.length-1,o+1);void 0!==o&&o>=0&&(i=this.store.at(o)),i&&(this._fromKeyDown=!0,this.selectRecord(i),this.scrollToRecord(i),-1!==this.itemTabindex&&this.dataViewItems[o]&&$(this.dataViewItems[o].el).focus(),this._fromKeyDown=!1)}}else this.trigger("item:keydown",this,i,t)},attachKeyEvents:function(){if(this.enableKeyEvents&&this.handleSelect){var t=$(this.el).find(".inner").addBack().filter(".inner");t.addClass("canfocused"),t.attr("tabindex",this.tabindex.toString()),t.on(this.parentMenu&&this.useBSKeydown?"dataview:keydown":"keydown",_.bind(this.onKeyDown,this))}},setDisabled:function(t){t=!!t,this.disabled=t,$(this.el).find(".inner").addBack().filter(".inner").toggleClass("disabled",t)},isDisabled:function(){return this.disabled},alignPosition:function(){var t="menu"===this.parentMenu.cmpEl.attr("role")?this.parentMenu.cmpEl:this.parentMenu.cmpEl.find("[role=menu]"),e=Common.Utils.innerHeight()-10,i=$(this.el).find(".inner").addBack().filter(".inner"),o=i.parent(),n=parseInt(o.css("margin-top"))+parseInt(o.css("margin-bottom"))+parseInt(t.css("margin-top")),s=parseInt(t.css("padding-top"))+parseInt(t.css("padding-bottom")),a=t.outerHeight(),r=parseInt(t.css("top")),l={minScrollbarLength:this.minScrollbarLength};this.scrollAlwaysVisible&&(l.alwaysVisibleY=this.scrollAlwaysVisible);var c=!1;if(this.parentMenu.menuAlign){var h=this.parentMenu.menuAlign.match(/^([a-z]+)-([a-z]+)/);c="bl"===h[1]||"br"===h[1]}if(c){var d=r+a;r<0?(i.css("max-height",d-s-n+"px"),t.css("top",0),this.scroller.update(l)):r>0&&i.height()<this.options.restoreHeight&&(i.css("max-height",Math.min(d-s-n,this.options.restoreHeight)+"px"),t.css("top",d-t.outerHeight()),this.scroller.update(l))}else r+a>e?(i.css("max-height",e-r-s-n+"px"),this.scroller.update(l)):r+a<e&&i.height()<this.options.restoreHeight&&(i.css("max-height",Math.min(e-r-s-n,this.options.restoreHeight)+"px"),this.scroller.update(l))},fillIndexesArray:function(){if(!(this.dataViewItems.length<=0)){this._layoutParams={itemsIndexes:[],columns:0,rows:0};for(var t=this.dataViewItems[0].el,e=t.outerWidth()+parseFloat(t.css("margin-left"))+parseFloat(t.css("margin-right")),i=Common.Utils.getOffset(this.$el).left,o=Common.Utils.getOffset(t).top,n=-1,s=0,a=0,r=0;r<this.dataViewItems.length;r++){var l=this.dataViewItems[r],c=Common.Utils.getOffset(l.el).top-o;a=Math.floor((Common.Utils.getOffset(l.el).left-i)/e),c>n&&(n=c,this._layoutParams.itemsIndexes.push([]),s=this._layoutParams.itemsIndexes.length-1),this._layoutParams.itemsIndexes[s][a]=r,l.topIdx=s,l.leftIdx=a,this._layoutParams.columns<a&&(this._layoutParams.columns=a)}this._layoutParams.rows=this._layoutParams.itemsIndexes.length,this._layoutParams.columns++}},onResize:function(){this._layoutParams=void 0},focus:function(t){var e;this.cmpEl&&this.cmpEl.find(".dataview").focus(),"string"==typeof t?"first"==t?e=this.selectByIndex(0,!0):"last"==t&&(void 0===this._layoutParams&&this.fillIndexesArray(),e=this.selectByIndex(this._layoutParams.itemsIndexes[this._layoutParams.rows-1][0],!0)):void 0!==t&&(e=this.selectByIndex(t,!0)),this.scrollToRecord(e)},focusInner:function(t){this.focus(t.keyCode==Common.UI.Keys.DOWN?"first":"last")}}),$(document).on("keydown.dataview","[data-toggle=dropdown], [role=menu]",(function(t){t.keyCode!==Common.UI.Keys.UP&&t.keyCode!==Common.UI.Keys.DOWN&&t.keyCode!==Common.UI.Keys.LEFT&&t.keyCode!==Common.UI.Keys.RIGHT&&t.keyCode!==Common.UI.Keys.RETURN||_.defer((function(){var e=$(t.target).closest(".dropdown-toggle");e.length?e.parent().find(".inner.canfocused").trigger("dataview:keydown",t):$(t.target).closest(".dropdown-submenu").find(".inner.canfocused").trigger("dataview:keydown",t)}),100)})),Common.UI.DataViewShape=Common.UI.DataViewSimple.extend(_.extend({template:_.template(['<div class="dataview inner" style="<%= style %>" role="list">',"<% _.each(options.groupsWithRecent, function(group, index) { %>",'<div class="grouped-data <% if (index === 0) { %> recent-group <% } %> " id="<%= group.id %>" >',"<% if (!_.isEmpty(group.groupName)) { %>",'<div class="group-description">',"<span><%= group.groupName %></span>","</div>","<% } %>",'<div class="group-items-container <% if (index === 0) { %> recent-items <% } %>">',"<% _.each(group.groupStore.toJSON(), function(item, index) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>",'<div class="item canfocused" role="listitem" <% if (typeof itemTabindex !== undefined) { %> tabindex="<%= itemTabindex %>" <% } %> data-index="<%= index %>"<% if(!!item.tip) { %> data-toggle="tooltip" <% } %> ><%= itemTemplate(item) %></div>',"<% }); %>","</div>","</div>","<% }); %>","</div>"].join("")),initialize:function(t){var e=this;this.canAddRecents=!0,this._state={hideTextRect:t.hideTextRect,hideLines:t.hideLines};var i=Common.localStorage.getKeysFilter();this.appPrefix=i&&i.length?i.split(",")[0]:"",e.groups=t.groups.toJSON();var o=new Common.UI.DataViewGroupStore,n=t.recentShapes||[],s=n.length>18?7:6,a=35*Math.ceil(n.length/s)+3,r=30*s;if((e.recentShapes=n,e.recentShapes.length>0)&&!_.findWhere(e.groups,{groupName:e.recentShapes[0].groupName})){for(var l=0;l<e.recentShapes.length;l++)for(var c,h=e.recentShapes[l].data.shapeType,d=0;d<e.groups.length;d++){for(var m=e.groups[d].groupStore,p=e.groups[d].groupName,u=0;u<m.length;u++)if(m.at(u).get("data").shapeType===h){c=m.at(u).toJSON(),e.recentShapes[l]={data:c.data,tip:c.tip,allowSelected:c.allowSelected,selected:!1,groupName:p};break}if(c){c=void 0;break}}Common.localStorage.setItem(this.appPrefix+"recent-shapes",JSON.stringify(e.recentShapes))}if(e.recentShapes.length<12){var g=12-e.recentShapes.length,f=[],b=function(t,e){var i=t.toJSON(),o={data:i.data,tip:i.tip,allowSelected:i.allowSelected,selected:!1,groupName:e};f.push(o)};for(u=0;u<e.groups.length&&g>0;u++){var C=e.groups[u].groupStore;p=e.groups[u].groupName;0===u?(b(C.at(1),p),--g>0&&(b(C.at(2),p),g--)):3!==u&&6!==u&&7!==u&&(b(C.at(0),p),--g>0&&(b(C.at(1),p),g--))}e.recentShapes=e.recentShapes.concat(f)}o.add(e.recentShapes),e.groups.unshift({groupName:t.textRecentlyUsed,groupStore:o,groupWidth:r,groupHeight:a}),e.options.groupsWithRecent=e.groups;m=new Common.UI.DataViewStore;_.each(e.groups,(function(t,e){var i=t.groupStore.models;if(e>0)for(var o=0;o<i.length;o++)i[o].set({groupName:t.groupName});m.add(i)})),t.store=m,Common.UI.DataViewSimple.prototype.initialize.call(this,t),e.parentMenu.on("show:before",(function(){e.updateRecents()})),e._state.hideLines&&e.hideLinesGroup()},onAfterShowMenu:function(t){var e=this,i=!1;if(e.dataViewItems||(e.dataViewItems=[],_.each(e.cmpEl.find("div.grouped-data"),(function(t,i){_.each($(t).find("div.item"),(function(t,o){var n=$(t),s=e.groups[i].groupStore.at(o);e.dataViewItems.push({el:n,groupIndex:i,index:o});var a=s.get("tip");a&&(n.one("mouseenter",(function(){n.attr("data-toggle","tooltip"),n.tooltip({title:a,placement:"cursor",zIndex:e.tipZIndex}),n.mouseenter()})),n.attr("aria-label",a))}))})),i=!0),e.updateDataViewItems&&e.cmpEl.is(":visible")){for(var o=_.where(e.dataViewItems,{groupIndex:0}),n=o?o.length:0,s=0;s<n;s++){var a=e.dataViewItems[s].el.data("bs.tooltip");a&&(void 0===a.dontShow&&(a.dontShow=!0),a.tip().remove())}e.dataViewItems=e.dataViewItems.slice(n);var r=[];_.each(e.cmpEl.find(".recent-group div.item"),(function(t,i){var o=$(t),n=e.recentShapes[i];r.push({el:o,groupIndex:0,index:i});var s=n.tip;s&&(o.one("mouseenter",(function(){o.attr("data-toggle","tooltip"),o.tooltip({title:s,placement:"cursor",zIndex:e.tipZIndex}),o.mouseenter()})),o.attr("aria-label",s))})),e.dataViewItems=r.concat(e.dataViewItems),1===e.recentShapes.length&&$(".recent-group").show(),e.updateDataViewItems=!1,i=!0}this._state.hideLines&&e.hideLines(),i&&e.hideTextRect(e._state.hideTextRect),e.fillIndexesArray()},onClickItem:function(t){if(!this.disabled){window._event=t;var e=$(t.currentTarget).closest("div.grouped-data").index(),i=$(t.currentTarget).closest("div.item").data("index"),o=_.findIndex(this.dataViewItems,(function(t){return t.groupIndex===e&&t.index===i})),n=o>=0?this.store.at(o):null,s=o>=0?this.dataViewItems[o]:null;if(n&&s){n.set({selected:!0});var a=s.el.data("bs.tooltip");a&&a.tip().remove(),this.isSuspendEvents||this.trigger("item:click",this,s.el,n,t),this.addRecentItem(n)}}},addRecentItem:function(t){for(var e=this,i=!1,o=t.get("data").shapeType,n=t.get("groupName"),s=0;s<e.recentShapes.length;s++)if(e.recentShapes[s].data.shapeType===o){i=!0;break}if(!i){var a=t.toJSON(),r=[{data:a.data,tip:a.tip,allowSelected:a.allowSelected,selected:!1,groupName:n}].concat(e.recentShapes.slice(0,11));Common.localStorage.setItem(this.appPrefix+"recent-shapes",JSON.stringify(r)),e.recentShapes=void 0}},updateRecents:function(){var t=this,e=Common.localStorage.getItem(this.appPrefix+"recent-shapes");e=e?JSON.parse(e):[];var i=!1;if(t.recentShapes)for(var o=0;o<e.length;o++)(!t.recentShapes[o]||t.recentShapes[o]&&e[o].tip!==t.recentShapes[o].tip)&&(i=!0);else i=!0;if(e.length>0&&i){t.recentShapes=e;var n=new Common.UI.DataViewStore;_.each(t.recentShapes,(function(t){var e={data:{shapeType:t.data.shapeType},tip:t.tip,allowSelected:t.allowSelected,selected:t.selected,groupName:t.groupName};n.push(e)})),t.groups[0].groupStore=n;var s=new Common.UI.DataViewStore;_.each(t.groups,(function(t){s.add(t.groupStore.models)})),t.store=s;var a=_.template(["<% _.each(items, function(item, index) { %>","<% if (!item.id) item.id = Common.UI.getId(); %>",'<div class="item canfocused" role="listitem" <% if (typeof itemTabindex !== undefined) { %> tabindex="<%= itemTabindex %>" <% } %> data-index="<%= index %>"<% if(!!item.tip) { %> data-toggle="tooltip" <% } %> ><%= itemTemplate(item) %></div>',"<% }) %>"].join(""));t.cmpEl&&t.cmpEl.find(".recent-items").html(a({items:t.recentShapes,itemTemplate:this.itemTemplate,style:this.style,itemTabindex:this.itemTabindex||0})),t.updateDataViewItems=!0}},fillIndexesArray:function(){if(!(this.dataViewItems.length<=0)){this._layoutParams={itemsIndexes:[],columns:0,rows:0};for(var t=this.dataViewItems[0].el,e=0;!this.dataViewItems[e].el.is(":visible");){if(e++,!this.dataViewItems[e])return;t=this.dataViewItems[e].el}for(var i=t.outerWidth()+parseInt(t.css("margin-left"))+parseInt(t.css("margin-right")),o=Common.Utils.getOffset(this.$el).left,n=Common.Utils.getOffset(t).top,s=-1,a=0,r=e,l=0;l<this.dataViewItems.length;l++){var c=this.dataViewItems[l];if(c.el.is(":visible")){var h=Common.Utils.getOffset(c.el).top-n;r=Math.floor((Common.Utils.getOffset(c.el).left-o)/i),h>s&&(s=h,this._layoutParams.itemsIndexes.push([]),a=this._layoutParams.itemsIndexes.length-1),this._layoutParams.itemsIndexes[a][r]=l,c.topIdx=a,c.leftIdx=r,this._layoutParams.columns<r&&(this._layoutParams.columns=r)}else c.topIdx=-1,c.leftIdx=-1}this._layoutParams.rows=this._layoutParams.itemsIndexes.length,this._layoutParams.columns++}},hideTextRect:function(t){var e=this;this.dataViewItems&&this.store.each((function(i,o){"textRect"===i.get("data").shapeType&&e.dataViewItems[o]&&e.dataViewItems[o].el&&e.dataViewItems[o].el[t?"addClass":"removeClass"]("hidden")}),this),this._state.hideTextRect=t},hideLinesGroup:function(){$(this.cmpEl.find("div.grouped-data")[9]).hide()},hideLines:function(){var t=this;this.store.each((function(e,i){if("Lines"===e.get("groupName")){var o=t.dataViewItems[i].el;o&&o.is(":visible")&&o.addClass("hidden")}}),this)}}))})),void 0===Common)var Common={};if(define("common/main/lib/component/ColorPalette",["common/main/lib/component/BaseView"],(function(){"use strict";Common.UI.ColorPalette=Common.UI.BaseView.extend({options:{allowReselect:!0,cls:"",style:""},template:_.template(['<div class="palette-color">',"<% _.each(colors, function(color, index) { %>",'<span class="color-item" data-color="<%= color %>" style="background-color: #<%= color %>;"></span>',"<% }) %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=e.options.id,this.cls=e.options.cls,this.style=e.options.style,this.colors=e.options.colors||[],this.value=e.options.value,e.options.el&&e.render()},render:function(t){var e=this;return e.rendered?this.cmpEl=e.$el||$(this.el):(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,colors:this.colors})),t?(this.setElement(t,!1),t.html(this.cmpEl)):e.$el.html(this.cmpEl)),e.rendered||e.cmpEl.on("click","span.color-item",e.itemClick.bind(e)),e.rendered=!0,this},itemClick:function(t){var e=$(t.target);this.select(e.attr("data-color"))},select:function(t,e){if(this.value!=t){$("span.color-item",this.cmpEl).removeClass("selected"),this.value=t,t&&/#?[a-fA-F0-9]{6}/.test(t)&&(t=/#?([a-fA-F0-9]{6})/.exec(t)[1].toUpperCase(),$("span[data-color="+t+"]",this.cmpEl).addClass("selected"),e||this.trigger("select",this,this.value))}}})})),define("text!common/main/lib/template/ExtendedColorDialog.template",[],(function(){return'<div class="box">\r\n    <div id="id-hsb-colorpicker">\r\n    </div>\r\n    <div class="color-info" style="">\r\n        <div class="margin-left-15">\r\n            <label class="color-label"><%= txtNew %></label>\r\n            <div class="color-field-wrapper">\r\n                <div id="field-new-color" class="color-cnt top"></div>\r\n                <div id="field-start-color" class="color-cnt bottom"></div>\r\n            </div>\r\n            <label class="color-label"><%= txtCurrent %></label>\r\n        </div>\r\n        <div style="padding:10px 0 2px 0;">\r\n            <label class="input-label">R</label>\r\n            <div id="extended-spin-r" class="display-inline-block-middle"></div>\r\n        </div>\r\n        <div style="padding:2px 0;">\r\n            <label class="input-label">G</label>\r\n            <div id="extended-spin-g" class="display-inline-block-middle"></div>\r\n        </div>\r\n        <div style="padding:2px 0;">\r\n            <label class="input-label">B</label>\r\n            <div id="extended-spin-b" class="display-inline-block-middle"></div>\r\n        </div>\r\n        <div style="padding:10px 0 0 0;">\r\n            <label class="input-label" style="width:12px;">#</label>\r\n            <input id="extended-text-color" type="text" role="textbox" style="width:67px;display:inline-block;" class="vertical-align-middle text-align-right">\r\n        </div>\r\n    </div>\r\n</div>\r\n'})),void 0===Common)var Common={};if(define("common/main/lib/component/HSBColorPicker",[],(function(){"use strict";Common.UI.HSBColorPicker=Common.UI.BaseView.extend({template:_.template('<div class="hsb-colorpicker"><% if (this.showCurrentColor) { %><div class="top-panel"><span class="color-value"><span class="transparent-color"></span></span><div class="color-text"></div></div><% } %><div><div class="cnt-hb"><div class="cnt-hb-arrow"></div></div><% if (this.changeSaturation) { %><div class="cnt-root"><div class="cnt-sat"><div class="cnt-sat-arrow"></div></div></div><% } %></div><% if (this.allowEmptyColor) { %><div class="empty-color"><%= this.textNoColor %></div><% } %></div>'),color:"#ff0000",options:{allowEmptyColor:!1,changeSaturation:!0,showCurrentColor:!0},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e,i,o,n,s,a,r,l,c=this,h=(c.$el||$(this.el),0),d=100,m=100;c.allowEmptyColor=c.options.allowEmptyColor,c.changeSaturation=c.options.changeSaturation,c.showCurrentColor=c.options.showCurrentColor;var p=function(t,e){var i=new Common.Utils.RGBColor("hsb("+t.h+","+t.s+","+t.b+")").toHex();c.color=e?"transparent":i,u(),c.trigger("changecolor",c,c.color)},u=function(){if(s.length>0&&a.length>0&&("transparent"==c.color?a.show():(s.css("background-color",c.color),a.hide())),o.length>0){var t=new Common.Utils.RGBColor("hsb("+h+", 100, 100)"),n="linear-gradient(rgba(255,255,255,0), #000), linear-gradient(-90deg,"+t.toRGB()+","+t.toRGBA(0)+"), #fff";o.css("background",n)}r.length>0&&(r[0].innerHTML="transparent"==c.color?c.textNoColor:c.color.toUpperCase()),e.length>0&&i.length>0&&(e.css({left:d+"%",top:100-m+"%","background-color":c.color}),i.css("top",parseInt(100*h/360)+"%"))},g=function(t,i,n){if(e.length>0&&o.length>0){var s=[Math.max(0,Math.min(100,parseInt((t.pageX*Common.Utils.zoom()-Common.Utils.getOffset(o).left)/o.width()*100))),Math.max(0,Math.min(100,parseInt((t.pageY*Common.Utils.zoom()-Common.Utils.getOffset(o).top)/o.height()*100)))];e.css("left",s[0]+"%"),e.css("top",s[1]+"%"),p({h:h,s:d=s[0],b:m=100-s[1]})}},f=function(t,e,o){if(i&&n){var s=Math.max(0,Math.min(100,parseInt((t.pageY*Common.Utils.zoom()-Common.Utils.getOffset(n).top)/n.height()*100)));i.css("top",s+"%"),h=parseInt(360*s/100),p({h:h,s:d,b:m})}},b=function(t,e,i){$(document).on("mouseup",C),$(document).on("mousemove",g)},C=function(t,e,i){$(document).off("mouseup",C),$(document).off("mousemove",g),g(t)},v=function(t,e,i){$(document).on("mouseup",_),$(document).on("mousemove",f),f(t)},_=function(t,e,i){$(document).off("mouseup",_),$(document).off("mousemove",f)},w=function(t){var e=new Common.util.RGBColor(c.color).toHSB();p(e,!0)};c.setColor=function(t){var e;c.color!=t&&(e="transparent"==t?{h:0,s:100,b:100}:new Common.Utils.RGBColor(t).toHSB(),h=e.h,d=e.s,m=e.b,h==d&&h==m&&0==h&&(d=100),c.color=t,u())},c.getColor=function(){return c.color},c.on("render:after",(function(t){var p,g=$(c.el);g&&(e=g.find(".cnt-hb-arrow"),i=g.find(".cnt-sat-arrow"),o=g.find(".cnt-hb"),n=g.find(".cnt-sat"),s=g.find(".color-value"),r=g.find(".color-text"),l=g.find(".empty-color"),s.length>0&&(a=s.find(".transparent-color")),o.length>0&&(o.off("mousedown"),o.on("mousedown",b)),n.length>0&&(n.off("mousedown"),n.on("mousedown",v)),l.length>0&&(l.off("click"),l.on("click",w)),p="transparent"==c.color?{h:0,s:100,b:100}:new Common.Utils.RGBColor(c.color).toHSB(),h=p.h,d=p.s,m=p.b,h==d&&h==m&&0==h&&(d=100),u())})),c.render()},render:function(){return(this.$el||$(this.el)).html(this.template()),this.trigger("render:after",this),this},textNoColor:"No Color"})})),void 0===Common)var Common={};if(define("common/main/lib/component/MaskedField",[],(function(){"use strict";Common.UI.MaskedField=Common.UI.BaseView.extend({options:{maskExp:"",maxLength:999},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this,i=e.$el||$(this.el);i.addClass("user-select form-control"),i.attr("maxlength",e.options.maxLength),i.on("keypress",(function(t){var o=String.fromCharCode(t.which);e.options.maskExp.test(o)||t.ctrlKey||(t.keyCode==Common.UI.Keys.RETURN&&e.trigger("changed",e,i.val()),t.preventDefault(),t.stopPropagation())})),i.on("input",(function(t){e.trigger("change",e,i.val())})),i.on("blur",(function(t){e.trigger("changed",e,i.val())}))},render:function(){return this},setValue:function(t){this.options.maskExp.test(t)&&t.length<=this.options.maxLength&&this.$el.val(t)},getValue:function(){this.$el.val()}})})),void 0===Common)var Common={};if(define("common/main/lib/view/ExtendedColorDialog",["text!common/main/lib/template/ExtendedColorDialog.template","common/main/lib/component/HSBColorPicker","common/main/lib/component/MaskedField"],(function(t){"use strict";Common.UI.ExtendedColorDialog=Common.UI.Window.extend(_.extend({tpl:_.template(t),options:{},rendered:!1,initialize:function(t){Common.UI.Window.prototype.initialize.call(this,{cls:"extended-color-dlg modal-dlg",tpl:this.tpl({txtNew:this.textNew,txtCurrent:this.textCurrent}),header:!1,buttons:[{value:"1",caption:this.addButtonText},{value:"0",caption:this.cancelButtonText}],primary:"1",width:356}),this.hexRe=/\s*#?([0-9a-fA-F][0-9a-fA-F]?)([0-9a-fA-F][0-9a-fA-F]?)([0-9a-fA-F][0-9a-fA-F]?)\s*/},render:function(){var t=this;return Common.UI.Window.prototype.render.call(this),this.colorsPicker=new Common.UI.HSBColorPicker({el:$("#id-hsb-colorpicker"),showCurrentColor:!1}),this.colorsPicker.on("changecolor",_.bind(this.onChangeColor,this)),this.colorNew=$("#field-new-color"),this.colorSaved=$("#field-start-color"),this.spinR=new Common.UI.MetricSpinner({el:$("#extended-spin-r"),step:1,width:67,value:"0",defaultUnit:"",maxValue:255,minValue:0,maskExp:/[0-9]/,allowDecimal:!1}),this.spinG=new Common.UI.MetricSpinner({el:$("#extended-spin-g"),step:1,width:67,value:"0",defaultUnit:"",maxValue:255,minValue:0,maskExp:/[0-9]/,allowDecimal:!1}),this.spinB=new Common.UI.MetricSpinner({el:$("#extended-spin-b"),step:1,width:67,value:"0",defaultUnit:"",maxValue:255,minValue:0,maskExp:/[0-9]/,allowDecimal:!1}),this.textColor=new Common.UI.MaskedField({el:$("#extended-text-color"),maskExp:/[a-fA-F0-9]/,maxLength:6}),this.spinR.on("change",_.bind(this.showColor,this,null,!0)).on("changing",_.bind(this.onChangingRGB,this,1)),this.spinG.on("change",_.bind(this.showColor,this,null,!0)).on("changing",_.bind(this.onChangingRGB,this,2)),this.spinB.on("change",_.bind(this.showColor,this,null,!0)).on("changing",_.bind(this.onChangingRGB,this,3)),this.textColor.on("change",_.bind(this.onChangeMaskedField,this)),this.textColor.on("changed",_.bind(this.onChangedMaskedField,this)),this.textColor.$el.on("focus",(function(){setTimeout((function(){t.textColor.$el&&t.textColor.$el.select()}),1)})),this.spinR.$el.find("input").attr("maxlength",3),this.spinG.$el.find("input").attr("maxlength",3),this.spinB.$el.find("input").attr("maxlength",3),this.on("close",(function(){t.trigger("onmodalresult",0)})),$(this)[0].getChild(".footer .dlg-btn").on("click",(function(e){t.trigger("onmodalresult",parseInt(e.currentTarget.attributes.result.value)),t.close(!0)})),this.rendered=!0,void 0!==this.color&&this.setColor(this.color),this},getFocusedComponents:function(){return[this.spinR,this.spinG,this.spinB,{cmp:this.textColor,selector:"input"}].concat(this.getFooterButtons())},getDefaultFocusableComponent:function(){return this.getChild("#extended-text-color")},onChangeColor:function(t,e){this.colorNew.css({"background-color":e}),this.stopevents=!0;var i=e.match(this.hexRe);this.spinR.setValue(parseInt(i[1],16)),this.spinG.setValue(parseInt(i[2],16)),this.spinB.setValue(parseInt(i[3],16)),this.textColor.setValue((i[1]+i[2]+i[3]).toUpperCase()),this.stopevents=!1},showColor:function(t,e){if(!this.stopevents){var i=this.spinR.getNumberValue(),o=null==i||i<0?0:i>255?255:i;e&&this.spinR.setValue(o,!0),o=o.toString(16);var n=null==(i=this.spinG.getNumberValue())||i<0?0:i>255?255:i;e&&this.spinG.setValue(n,!0),n=n.toString(16);var s=null==(i=this.spinB.getNumberValue())||i<0?0:i>255?255:i;e&&this.spinB.setValue(s,!0),s=s.toString(16);var a=(1==o.length?"0"+o:o)+(1==n.length?"0"+n:n)+(1==s.length?"0"+s:s);this.colorsPicker.setColor("#"+a),"hex"!=t&&this.textColor.setValue(a.toUpperCase()),this.colorNew.css("background-color","#"+a)}},onChangingRGB:function(t,e,i,o){if(!this.stopevents){var n,s,a,r;switch(i=_.isEmpty(i)||isNaN(parseInt(i))?parseInt(e.getValue()):parseInt(i),t){case 1:n=(null==i||isNaN(i)||i<0?0:i>255?255:i).toString(16),s=(null==(r=this.spinG.getNumberValue())||r<0?0:r>255?255:r).toString(16),a=(null==(r=this.spinB.getNumberValue())||r<0?0:r>255?255:r).toString(16);break;case 2:n=(null==(r=this.spinR.getNumberValue())||r<0?0:r>255?255:r).toString(16),s=(null==i||isNaN(i)||i<0?0:i>255?255:i).toString(16),a=(null==(r=this.spinB.getNumberValue())||r<0?0:r>255?255:r).toString(16);break;case 3:n=(null==(r=this.spinR.getNumberValue())||r<0?0:r>255?255:r).toString(16),s=(null==(r=this.spinG.getNumberValue())||r<0?0:r>255?255:r).toString(16),a=(null==i||isNaN(i)||i<0?0:i>255?255:i).toString(16)}var l=(1==n.length?"0"+n:n)+(1==s.length?"0"+s:s)+(1==a.length?"0"+a:a);this.colorsPicker.setColor("#"+l),this.textColor.setValue(l.toUpperCase()),this.colorNew.css("background-color","#"+l)}},onChangeMaskedField:function(t,e){var i=(e="000000"+(e=/^[a-fA-F0-9]{0,6}$/.test(e)?e:"000000")).match(/([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/i);this.stopevents=!0,this.spinR.setValue(parseInt(i[1],16)),this.spinG.setValue(parseInt(i[2],16)),this.spinB.setValue(parseInt(i[3],16)),this.stopevents=!1,this.rendered&&this.showColor("hex")},onChangedMaskedField:function(t,e){/^[a-fA-F0-9]{0,6}$/.test(e)&&!_.isEmpty(e)||t.setValue("000000"),this.rendered&&this.showColor("",!0)},getColor:function(){var t=/#?([a-fA-F0-9]{6})/.exec(this.colorsPicker.getColor());return t?t[1]:null},setColor:function(t){var e=this;if(!0===this.rendered){var i=/#?([a-fA-F0-9]{6})/.test(t)?t:"ff0000";e.colorsPicker.setColor("#"+i),"transparent"==t?e.colorSaved.addClass("color-transparent"):(e.colorSaved.removeClass("color-transparent"),e.colorSaved.css("background-color","#"+t)),e.colorNew.css("background-color","#"+i),e.stopevents=!0;var o=e.hexRe.exec(i);e.spinR.setValue(parseInt(o[1],16)),e.spinG.setValue(parseInt(o[2],16)),e.spinB.setValue(parseInt(o[3],16)),e.textColor.setValue((o[1]+o[2]+o[3]).toUpperCase()),e.stopevents=!1}else this.color=t},onPrimary:function(){return this.trigger("onmodalresult",1),this.close(!0),!1},addButtonText:"Add",textNew:"New",textCurrent:"Current",textRGBErr:"The entered value is incorrect.<br>Please enter a numeric value between 0 and 255.",textHexErr:"The entered value is incorrect.<br>Please enter a value between 000000 and FFFFFF."},Common.UI.ExtendedColorDialog||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/ThemeColorPalette",["common/main/lib/component/BaseView","common/main/lib/view/ExtendedColorDialog"],(function(){"use strict";Common.UI.ThemeColorPalette=Common.UI.BaseView.extend(_.extend({options:{dynamiccolors:10,standardcolors:10,themecolors:10,columns:10,effects:5,hideEmptyColors:!0,allowReselect:!0,transparent:!1,value:"000000",enableKeyEvents:!0,colorHints:!0,keyMoveDirection:"both",storageSuffix:""},template:_.template('<div class="palette-inner"><% var me = this; var idx = 0; %><% $(colors).each(function(num, item) { %><% if (me.isBlankSeparator(item)) { %> <div class="palette-color-spacer"></div><% } else if (me.isSeparator(item)) { %> </div><div class="divider"></div><div style="padding: 12px;"><% } else if (me.isColor(item)) { %> <a class="palette-color color-<%=item%>" data-toggle="tooltip" style="background:#<%=item%>" idx="<%=idx++%>"><em><span style="background:#<%=item%>;" unselectable="on">&#160;</span></em></a><% } else if (me.isTransparent(item)) { %><a class="color-<%=item%>" data-toggle="tooltip" idx="<%=idx++%>"><em><span unselectable="on">&#160;</span></em></a><% } else if (me.isEffect(item)) { %><% if (idx>0 && me.columns>0 && idx%me.columns===0) { %> <div class="color-divider"></div><% } %><a effectid="<%=item.effectId%>" effectvalue="<%=item.effectValue%>" data-toggle="tooltip" class="palette-color-effect color-<%=item.color%>" style="background:#<%=item.color%>" idx="<%=idx++%>"><em><span style="background:#<%=item.color%>;" unselectable="on">&#160;</span></em></a><% } else if (me.isCaption(item)) { %><div class="palette-color-caption"><%=item%></div><% } %><% }); %></div><% if (me.options.dynamiccolors!==undefined) { %><div class="palette-color-dynamiccolors"><div class="palette-color-spacer"></div><div class="palette-color-caption"><%=me.textRecentColors%></div><% for (var i=0; i<me.options.dynamiccolors; i++) { %><a class="color-dynamic-<%=i%> dynamic-empty-color <%= me.emptyColorsClass %>" data-toggle="tooltip" color="" idx="<%=idx++%>"><em><span unselectable="on">&#160;</span></em></a><% } %><% } %></div>'),colorRe:/(?:^|\s)color-(.{6})(?:\s|$)/,selectedCls:"selected",cls:"",initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this,i=e.$el||$(this.el);this.colors=e.options.colors||this.generateColorData(e.options.themecolors,e.options.effects,e.options.standardcolors,e.options.transparent),this.columns=e.options.columns||0,this.enableKeyEvents=e.options.enableKeyEvents,this.tabindex=e.options.tabindex||0,this.outerMenu=e.options.outerMenu,this.lastSelectedIdx=-1,this.emptyColorsClass=e.options.hideEmptyColors?"hidden":"",this.colorHints=e.options.colorHints,e.colorItems=[],"vertical"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN]:"horizontal"==e.options.keyMoveDirection?e.moveKeys=[Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT]:e.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN,Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT],i.addClass("theme-colorpalette"),e.options.cls&&i.addClass(e.options.cls),this.render(),this.options.updateColorsArr&&this.updateColors(this.options.updateColorsArr[0],this.options.updateColorsArr[1]),this.options.value&&this.select(this.options.value,!0),this.options.outerMenu&&this.options.outerMenu.focusOnShow&&this.options.outerMenu.menu&&(i.addClass("focused"),this.options.outerMenu.menu.on("show:after",(function(t){_.delay((function(){e.showLastSelected(),e.focus()}),10)}))),this.updateCustomColors(),i.closest(".btn-group").on("show.bs.dropdown",_.bind(this.updateCustomColors,this)),i.closest(".dropdown-submenu").on("show.bs.dropdown",_.bind(this.updateCustomColors,this)),i.on("click",_.bind(this.handleClick,this))},render:function(){this.$el.html(this.template({colors:this.colors}));var t=this;this.moveKeys&&this.$el.find("a").each((function(e,i){t.colorItems.push({el:i,index:e})})),this.attachKeyEvents();var e=this.$el.closest(".asc-window");return e.length>0&&(this.tipZIndex=parseInt(e.css("z-index"))+10),this.colorHints&&(this.options.transparent&&this.createTip(this.$el.find("a.color-transparent"),this.textTransparent),!this.options.themecolors&&!this.options.effects&&this.updateHints("object"===_typeof(this.colorHints)?this.colorHints:void 0),this.colorHints=!!this.colorHints),this},isBlankSeparator:function(t){return"string"==typeof t&&"-"==t},isSeparator:function(t){return"string"==typeof t&&"--"==t},isColor:function(t){return"string"==typeof t&&/[0-9A-F]{6}/.test(t)},isTransparent:function(t){return"string"==typeof t&&"transparent"==t},isCaption:function(t){return"string"==typeof t&&"-"!=t&&"--"!=t&&!/[0-9A-F]{6}|transparent/.test(t)},isEffect:function(t){return"object"==_typeof(t)&&void 0!==t.effectId},getColor:function(){return this.value},updateCustomColors:function(){var t=this.$el||$(this.el);if(t){var e=this.lastSelectedIdx>=0?$(this.colorItems[this.lastSelectedIdx].el):t.find("a."+this.selectedCls),i=e.length>0&&/color-dynamic/.test(e[0].className)?e.attr("color"):void 0;i&&(i=i.toUpperCase(),e.removeClass(this.selectedCls),this.lastSelectedIdx=-1);var o,n=Common.localStorage.getItem("asc."+Common.localStorage.getId()+".colors.custom"+this.options.storageSuffix),s=-1,a=(n=n?n.split(","):[]).length<this.options.dynamiccolors?n.length:this.options.dynamiccolors;for(this.options.hideEmptyColors&&this._layoutParams&&t.find(".dynamic-empty-color").length!==this.options.dynamiccolors-a&&(this._layoutParams=void 0);++s<a;)(o=t.find(".color-dynamic-"+s)).removeClass("dynamic-empty-color").removeClass(this.emptyColorsClass).attr("color",n[s]),o.find("span").css({"background-color":"#"+n[s]}),n[s]==i&&(o.addClass(this.selectedCls),this.lastSelectedIdx=parseInt(o.attr("idx")),i=void 0),this.colorHints&&this.createTip(o,Common.Utils.ThemeColor.getTranslation(Common.Utils.ThemeColor.getRgbColor(n[s]).asc_getName()));for(;s<this.options.dynamiccolors;)(o=t.find(".color-dynamic-"+s)).removeAttr("color"),o.addClass("dynamic-empty-color").addClass(this.emptyColorsClass),o.find("span").css({"background-color":"transparent"}),s++;t.find(".palette-color-dynamiccolors").toggleClass(this.emptyColorsClass,0===a)}},handleClick:function(t){var e,i=this,o=$(t.target).closest("a");if(0==o.length)return!1;if(o.hasClass("color-transparent"))i.clearSelection(!0),o.addClass(i.selectedCls),t.suppressEvent||(i.lastSelectedIdx=parseInt(o.attr("idx")),i.value="transparent",i.trigger("select",i,"transparent"));else if(o[0].className.search("color-dynamic")<0)if((!/^[a-fA-F0-9]{6}$/.test(i.value)||_.indexOf(i.colors,i.value)<0)&&(i.value=!1),i.clearSelection(!0),o.addClass(i.selectedCls),e=o[0].className.match(i.colorRe)[1],o.hasClass("palette-color-effect")){var n=parseInt(o.attr("effectid"));if(e&&!t.suppressEvent)if(i.value=e.toUpperCase(),i.trigger("select",i,{color:e,effectId:n}),i.lastSelectedIdx=parseInt(o.attr("idx")),i.colorHints)(s=o.data("bs.tooltip"))&&s.tip().remove()}else{if(/#?[a-fA-F0-9]{6}/.test(e))if((e=/#?([a-fA-F0-9]{6})/.exec(e)[1].toUpperCase())&&!t.suppressEvent)if(i.value=e,i.trigger("select",i,e),i.lastSelectedIdx=parseInt(o.attr("idx")),i.colorHints)(s=o.data("bs.tooltip"))&&s.tip().remove()}else{var s;if(/dynamic-empty-color/.test(o[0].className))t.suppressEvent?(i.clearSelection(!0),o.addClass(i.selectedCls)):setTimeout((function(){i.addNewColor()}),10);else if(i.clearSelection(!0),o.addClass(i.selectedCls),!t.suppressEvent)if(i.lastSelectedIdx=parseInt(o.attr("idx")),e=o.attr("color"),i.trigger("select",i,e),i.value=e.toUpperCase(),i.colorHints)(s=o.data("bs.tooltip"))&&s.tip().remove()}},setCustomColor:function(t){var e=this.$el||$(this.el);if(t=/#?([a-fA-F0-9]{6})/.exec(t)){var i=this.saveCustomColor(t[1]);this.clearSelection(!0);var o=e.find(".dynamic-empty-color");0==o.length?(this.updateCustomColors(),o=e.find(".color-dynamic-"+(this.options.dynamiccolors-1))):i&&this.options.hideEmptyColors&&this._layoutParams&&(this._layoutParams=void 0),i&&(o.first().removeClass("dynamic-empty-color").removeClass(this.emptyColorsClass).addClass(this.selectedCls).attr("color",t[1]),o.first().find("span").css({"background-color":"#"+t[1]})),e.find(".palette-color-dynamiccolors").removeClass(this.emptyColorsClass),this.select(t[1],!0)}},saveCustomColor:function(t){var e="asc."+Common.localStorage.getId()+".colors.custom"+this.options.storageSuffix,i=Common.localStorage.getItem(e);i=i?i.split(","):[];var o=_.indexOf(i,t.toUpperCase());return o<0&&(i.push(t)>this.options.dynamiccolors&&i.shift(),Common.localStorage.setItem(e,i.join().toUpperCase())),o<0},addNewColor:function(t){var e=this,i=new Common.UI.ExtendedColorDialog({});i.on("onmodalresult",(function(t){e._isdlgopen=!1,1==t&&(e.setCustomColor(i.getColor()),e.fireEvent("select",e,i.getColor())),e.fireEvent("close:extended",e,1==t)})),e._isdlgopen=!0,i.setColor(void 0!==e.value&&!1!==e.value?e.value:void 0!==t?t:"000000"),i.show()},isDialogOpen:function(){return 1==this._isdlgopen},select:function(t,e){var i,o=this.$el||$(this.el);if(this.clearSelection(),"object"==_typeof(t))void 0!==t.effectId?(i=o.find('a[effectid="'+t.effectId+'"]').first()).length>0?(i.addClass(this.selectedCls),this.lastSelectedIdx=parseInt(i.attr("idx")),this.value=i[0].className.match(this.colorRe)[1].toUpperCase()):this.value=!1:void 0!==t.effectValue&&((i=o.find('a[effectvalue="'+t.effectValue+'"].color-'+t.color.toUpperCase()).first()).length>0?(i.addClass(this.selectedCls),this.lastSelectedIdx=parseInt(i.attr("idx")),this.value=i[0].className.match(this.colorRe)[1].toUpperCase()):this.value=!1);else if(/#?[a-fA-F0-9]{6}/.test(t)&&(t=/#?([a-fA-F0-9]{6})/.exec(t)[1].toUpperCase(),this.value=t),/^[a-fA-F0-9]{6}|transparent$/.test(t)&&_.indexOf(this.colors,t)>=0){if(_.indexOf(this.colors,this.value)<0&&(this.value=!1),t!=this.value||this.options.allowReselect){var n="transparent"==t?o.find("a.color-transparent").addClass(this.selectedCls):o.find("a.palette-color.color-"+t).first().addClass(this.selectedCls);this.value=t,this.lastSelectedIdx=parseInt(n.attr("idx")),!0!==e&&this.fireEvent("select",this,t)}}else 0==(n=o.find("#"+t).first()).length&&(n=o.find('a[color="'+t+'"]').first()),n.length>0&&(n.addClass(this.selectedCls),this.lastSelectedIdx=parseInt(n.attr("idx")),this.value=t.toUpperCase())},selectByRGB:function(t,e){var i=this.$el||$(this.el);this.clearSelection(!0);var o="object"==_typeof(t)?t.color:t;if(/#?[a-fA-F0-9]{6}/.test(o)&&(o=/#?([a-fA-F0-9]{6})/.exec(o)[1].toUpperCase()),/^[a-fA-F0-9]{6}|transparent$/.test(o)&&(o!=this.value||this.options.allowReselect)){var n="transparent"==o?i.find("a.color-transparent"):i.find("a.color-"+o).first();0==n.length&&(n=i.find("#"+o).first()),0==n.length&&(n=i.find('a[color="'+o+'"]').first()),n.length>0&&(n.addClass(this.selectedCls),this.lastSelectedIdx=parseInt(n.attr("idx")),this.value=o),!0!==e&&this.fireEvent("select",this,o)}},updateColors:function(t,e,i){if(void 0!==t&&void 0!==e){var o,n=this,s=n.$el||$(this.el);void 0===n.aColorElements&&(n.aColorElements=s.find("a.palette-color")),void 0===n.aEffectElements&&(n.aEffectElements=s.find("a.palette-color-effect"));for(var a=0,r=0,l=0;l<n.colors.length;l++)if("string"==typeof n.colors[l]&&/[0-9A-F]{6}/.test(n.colors[l])){if(a>=e.length)continue;(o=$(n.aColorElements[a])).removeClass("color-"+n.colors[l]),n.colors[l]=e[a].color=e[a].color.toUpperCase(),o.addClass("color-"+n.colors[l]),o.css({background:"#"+n.colors[l]}),o.find("span").first().css({background:"#"+n.colors[l]}),n.colorHints&&n.createTip(o,e[a].tip),a++}else if("object"==_typeof(n.colors[l])&&void 0!==n.colors[l].effectId){if(r>=t.length)continue;o=$(n.aEffectElements[r]),t[r].color=t[r].color.toUpperCase(),n.colors[l].color!==t[r].color&&(o.removeClass("color-"+n.colors[l].color),o.addClass("color-"+t[r].color),o.css({background:"#"+t[r].color}),o.find("span").first().css({background:"#"+t[r].color})),n.colors[l].effectId!==t[r].effectId&&o.attr("effectid",""+t[r].effectId),n.colors[l].effectValue!==t[r].effectValue&&o.attr("effectvalue",""+t[r].effectValue),n.colors[l]=t[r],n.colorHints&&n.createTip(o,t[r].tip),r++}if(i)this.select(i,!0);else{var c=s.find("a."+this.selectedCls);c.length&&c.hasClass("palette-color-effect")&&(this.value=c[0].className.match(this.colorRe)[1].toUpperCase())}this.options.updateColorsArr=void 0}},createTip:function(t,e){var i=this.tipZIndex;void 0===t.attr("color-name")&&t.one("mouseenter",(function(t){var e=$(t.currentTarget);e.tooltip({title:e.attr("color-name"),placement:"cursor",zIndex:i}),e.mouseenter()}));var o=t.data("bs.tooltip");o&&o.updateTitle(e),t.attr("color-name",e||"")},clearSelection:function(t){this.$el.find("a."+this.selectedCls).removeClass(this.selectedCls),t||(this.value=void 0,this.lastSelectedIdx=-1)},showLastSelected:function(){this.selectByIndex(this.lastSelectedIdx,!0)},getSelectedColor:function(){var t=(this.$el||$(this.el)).find("a."+this.selectedCls).attr("idx");return void 0!==t?this.colorItems[parseInt(t)]:null},selectByIndex:function(t,e){this.clearSelection(!0),t>=0&&t<this.colorItems.length&&this.handleClick({target:this.colorItems[t].el,suppressEvent:e})},generateColorData:function(t,e,i,o){var n=[],s=t>0&&e>0?t*e:0;if(t>0){n=[this.textThemeColors];for(var a=0;a<t;a++)n.push({color:"FFFFFF",effectId:1});e>0&&n.push("-");for(a=0;a<s;a++)n.push({color:"FFFFFF",effectId:1});i&&n.push("-")}if(i){n.push(this.textStandartColors),o&&(n.push("transparent"),i--);for(a=0;a<i;a++)n.push("FFFFFF")}return n},onKeyDown:function(t,e){if(void 0===e&&(e=t),_.indexOf(this.moveKeys,e.keyCode)>-1||e.keyCode==Common.UI.Keys.RETURN){e.preventDefault(),e.stopPropagation();var i=this.getSelectedColor();if(e.keyCode==Common.UI.Keys.RETURN)i&&this.selectByIndex(i.index),this.outerMenu&&this.outerMenu.menu&&this.outerMenu.menu.hide();else{var o=i?i.index:-1;if(o<0)o=0;else if("both"==this.options.keyMoveDirection){void 0===this._layoutParams&&this.fillIndexesArray();var n=this.colorItems[o].topIdx,s=this.colorItems[o].leftIdx;if(o=void 0,e.keyCode==Common.UI.Keys.LEFT)for(;void 0===o;)--s<0&&(s=this._layoutParams.columns-1),o=this._layoutParams.itemsIndexes[n][s];else if(e.keyCode==Common.UI.Keys.RIGHT)for(;void 0===o;)++s>this._layoutParams.columns-1&&(s=0),o=this._layoutParams.itemsIndexes[n][s];else if(e.keyCode==Common.UI.Keys.UP)if(0==n&&this.outerMenu&&this.outerMenu.menu)this.clearSelection(!0),this.outerMenu.menu.focusOuter(e,this.outerMenu.index);else for(;void 0===o;)--n<0&&(n=this._layoutParams.rows-1),o=this._layoutParams.itemsIndexes[n][s];else if(n==this._layoutParams.rows-1&&this.outerMenu&&this.outerMenu.menu)this.clearSelection(!0),this.outerMenu.menu.focusOuter(e,this.outerMenu.index);else for(;void 0===o;)++n>this._layoutParams.rows-1&&(n=0),o=this._layoutParams.itemsIndexes[n][s]}else o=e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.LEFT?Math.max(0,o-1):Math.min(this.colorItems.length-1,o+1);void 0!==o&&o>=0&&(this._fromKeyDown=!0,this.selectByIndex(o,!0),this._fromKeyDown=!1)}}},fillIndexesArray:function(){if(!(this.colorItems.length<=0)){this._layoutParams={itemsIndexes:[],columns:0,rows:0};for(var t=$(this.colorItems[0].el),e=t.outerWidth()+parseInt(t.css("margin-left"))+parseInt(t.css("margin-right")),i=Common.Utils.getOffset(this.$el).left,o=Common.Utils.getOffset(t).top,n=-1,s=0,a=0,r=0;r<this.colorItems.length;r++){var l=Common.Utils.getOffset($(this.colorItems[r].el)).top-o;a=Math.floor((Common.Utils.getOffset($(this.colorItems[r].el)).left-i)/e),l>n&&(n=l,this._layoutParams.itemsIndexes.push([]),s=this._layoutParams.itemsIndexes.length-1),this._layoutParams.itemsIndexes[s][a]=r,this.colorItems[r].topIdx=s,this.colorItems[r].leftIdx=a,this._layoutParams.columns<a&&(this._layoutParams.columns=a)}this._layoutParams.rows=this._layoutParams.itemsIndexes.length,this._layoutParams.columns++}},attachKeyEvents:function(){if(this.enableKeyEvents){var t=this.$el||$(this.el);t.addClass("canfocused"),t.attr("tabindex",this.tabindex.toString()),t.on("keydown",_.bind(this.onKeyDown,this))}},focus:function(t){var e=this.$el||$(this.el);e&&e.focus(),"string"==typeof t?"first"==t?this.selectByIndex(0,!0):"last"==t&&(void 0===this._layoutParams&&this.fillIndexesArray(),this.selectByIndex(this._layoutParams.itemsIndexes[this._layoutParams.rows-1][0],!0)):void 0!==t&&this.selectByIndex(t,!0)},focusInner:function(t){this.focus(t.keyCode==Common.UI.Keys.DOWN?"first":"last")},updateHints:function(t){if(this.colorHints){var e=this;(e.$el||$(e.el)).find("a.palette-color").each((function(i,o){if(t&&t[i])e.createTip($(o),t[i]);else{var n=o.className.match(e.colorRe)[1];e.createTip($(o),Common.Utils.ThemeColor.getTranslation(Common.Utils.ThemeColor.getRgbColor(n).asc_getName()))}}))}},textThemeColors:"Theme Colors",textStandartColors:"Standard Colors",textRecentColors:"Recent Colors",textTransparent:"Transparent"},Common.UI.ThemeColorPalette||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/DimensionPicker",["common/main/lib/component/BaseView"],(function(){"use strict";Common.UI.DimensionPicker=Common.UI.BaseView.extend({options:{itemSize:20,minRows:5,minColumns:5,maxRows:20,maxColumns:20,width:100,height:400,scale:Common.Utils.applicationPixelRatio(),direction:void 0},template:_.template(['<div style="width: 100%; height: 100%;">','<div dir="ltr" class="dimension-picker-status">0x0</div>','<div class="dimension-picker-observecontainer">','<div class="dimension-picker-mousecatcher"></div>','<div class="dimension-picker-unhighlighted"><canvas id="dimension-picker--canvas" data-maxlength="<%=scope.maxColumns%>"  width ="<%=scope.maxColumns * scope.itemSize * scope.scale%>" height="<%=scope.maxRows * scope.itemSize * scope.scale%>" style="left: 0; top: 0; width: 100%; height: 100%;"></div>',"</div>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.render(),this.cmpEl=e.$el||$(this.el),e.options.width=e.options.itemSize*this.options.minColumns,e.options.height=e.options.itemSize*this.options.minRows;var i=this.cmpEl;e.borderColor=Common.Utils.isIE?"#888888":Common.UI.Themes.currentThemeColor("--border-preview-select"),e.fillColor=Common.Utils.isIE?"#fff":Common.UI.Themes.currentThemeColor("--background-normal"),e.borderColorHighlighted=Common.Utils.isIE?"#848484":Common.UI.Themes.currentThemeColor("--border-control-focus"),e.fillColorHighlighted=Common.Utils.isIE?"#7d858c":Common.UI.Themes.currentThemeColor("--highlight-button-pressed"),e.itemSize=e.options.itemSize,e.minRows=e.options.minRows,e.minColumns=e.options.minColumns,e.maxRows=e.options.maxRows,e.maxColumns=e.options.maxColumns,e.scale=e.options.scale>=1?e.options.scale:1,e.width=(e.options.width*e.scale>>0)/e.scale,e.height=(e.options.height*e.scale>>0)/e.scale,e.borderSize=1,e.direction=e.options.direction,Common.UI.isRTL()&&!e.direction&&(e.direction="right"),e.curColumns=0,e.curRows=0,i&&(e.areaMouseCatcher=i.find(".dimension-picker-mousecatcher"),e.areaUnHighLighted=i.find(".dimension-picker-unhighlighted"),e.areaStatus=i.find(".dimension-picker-status"),e.canv=i.find("#dimension-picker--canvas")[0],e.context=e.canv.getContext("2d"),i.css({width:e.minColumns+"em"}),e.areaMouseCatcher.css("z-index",1),e.areaMouseCatcher.width(e.maxColumns+"em").height(e.maxRows+"em"),e.areaMouseCatcher.on("mousemove",(function(t){var i;if("right"===e.direction&&e.areaMouseCatcher){var o=e.areaMouseCatcher.width();i=void 0===t.offsetX?o-t.originalEvent.layerX:(o-t.offsetX)*Common.Utils.zoom()}else i=void 0===t.offsetX?t.originalEvent.layerX:t.offsetX*Common.Utils.zoom();e.setTableSize(Math.ceil(i/e.itemSize),Math.ceil((void 0===t.offsetY?t.originalEvent.layerY:t.offsetY*Common.Utils.zoom())/e.itemSize),t)})),e.areaMouseCatcher.on("click",(function(t){e.trigger("select",e,e.curColumns,e.curRows,t)})),e.areaMouseCatcher.on("mouseleave",(function(i){t.customClear||e.setTableSize(0,0,i)})),e.areaStatus.html(Common.UI.isRTL()?this.curRows+" x "+this.curColumns:this.curColumns+" x "+this.curRows),e.resizeCanvas(),$(window).resize(_.bind(e.resizeCanvas,e)),!Common.Utils.isIE&&Common.NotificationCenter.on("uitheme:changed",e.changeColors.bind(e)),"right"===e.direction&&e.areaUnHighLighted.css({left:"auto",right:"0"}))},render:function(){return(this.$el||$(this.el)).html(this.template({scope:this.options})),this},changeColors:function(){this.borderColor=Common.UI.Themes.currentThemeColor("--border-preview-select"),this.fillColor=Common.UI.Themes.currentThemeColor("--background-normal"),this.borderColorHighlighted=Common.UI.Themes.currentThemeColor("--border-control-focus"),this.fillColorHighlighted=Common.UI.Themes.currentThemeColor("--highlight-button-pressed"),this.context.clearRect(0,0,this.width*this.scale,this.height*this.scale),this.drawTable(this.minColumns,this.minRows,this.fillColor,this.borderColor)},resizeCanvas:function(){this.context&&this.context.clearRect(0,0,this.width*this.scale,this.height*this.scale),this.scale=Common.Utils.applicationPixelRatio(),this.scale=this.scale>=1?this.scale:1,this.width=(this.options.width*this.scale>>0)/this.scale,this.height=(this.options.height*this.scale>>0)/this.scale,this.areaUnHighLighted.css({width:this.width,height:this.height}),this.canv.width=this.width*this.scale,this.canv.height=this.height*this.scale,this.drawTable(this.minColumns,this.minRows,this.fillColor,this.borderColor),this.cmpEl.width(this.areaUnHighLighted.width()),this.areaStatus.width(this.areaUnHighLighted.width())},drawTable:function(t,e,i,o){for(var n=Common.UI.isRTL()?this.areaUnHighLighted.width()/this.itemSize-1:0,s=Common.UI.isRTL()?-1:1,a=0;a<e;a++)for(var r=n;Common.UI.isRTL()?r>n-t:r<t;r+=s)this.drawCell(r,a,i,o)},drawCell:function(t,e,i,o){var n=((this.itemSize*t+1)*this.scale+.5>>0)+this.borderSize/2,s=((this.itemSize*(t+1)-1)*this.scale+.5>>0)-this.borderSize/2,a=((this.itemSize*e+1)*this.scale+.5>>0)+this.borderSize/2,r=((this.itemSize*(e+1)-1)*this.scale+.5>>0)-this.borderSize/2;this.context.beginPath(),this.context.moveTo(n,a),this.context.lineTo(s,a),this.context.lineTo(s,r),this.context.lineTo(n,r),this.context.closePath(),this.context.strokeStyle=o,this.context.stroke(),this.context.fillStyle=i,this.context.fill()},setTableSize:function(t,e,i){if(t>this.maxColumns&&(t=this.maxColumns),e>this.maxRows&&(e=this.maxRows),this.curColumns!=t||this.curRows!=e){var o=t-this.curColumns,n=e-this.curRows;this.curColumns=t,this.curRows=e;var s=this.curColumns<this.minColumns?this.minColumns:this.curColumns+1>this.maxColumns?this.maxColumns:this.curColumns+1,a=this.curRows<this.minRows?this.minRows:this.curRows+1>this.maxRows?this.maxRows:this.curRows+1,r=(s*this.itemSize*this.scale>>0)/this.scale,l=(a*this.itemSize*this.scale>>0)/this.scale;this.areaUnHighLighted.width()==r&&this.areaUnHighLighted.height()==l||(this.drawTable(this.curColumns,this.curRows,this.fillColorHighlighted,this.fillColorHighlighted),r<this.areaUnHighLighted.width()&&this.context.clearRect(Common.UI.isRTL()?0:r,0,this.areaUnHighLighted.width()-r,this.areaUnHighLighted.height()),l<this.areaUnHighLighted.height()&&this.context.clearRect(0,l,this.areaUnHighLighted.width(),this.areaUnHighLighted.height()-l),this.areaUnHighLighted.css({width:r,height:l}),this.canv.width=r*this.scale,this.canv.height=l*this.scale),this.drawTable(s,a,this.fillColor,this.borderColor);var c=Common.UI.isRTL()?s-this.curColumns:this.curColumns+1,h=Common.UI.isRTL()?-1:1;if(o<0)for(var d=c;Common.UI.isRTL()?d>this.curColumns-o:d<this.curColumns+o;d+=h)for(var m=0;m<a;m++)this.drawCell(d,m,this.fillColor,this.borderColor);if(n<0)for(d=c;Common.UI.isRTL()?d>0:d<s;d+=h)for(m=0;m<this.curRows+n;m++)this.drawCell(d,m,this.fillColor,this.borderColor);this.drawTable(this.curColumns,this.curRows,this.fillColorHighlighted,this.borderColorHighlighted),this.cmpEl.width(this.areaUnHighLighted.width()),this.areaStatus.html(Common.UI.isRTL()?this.curRows+" x "+this.curColumns:this.curColumns+" x "+this.curRows),this.areaStatus.width(this.areaUnHighLighted.width()),this.trigger("change",this,this.curColumns,this.curRows,i)}},getColumnsCount:function(){return this.curColumns},getRowsCount:function(){return this.curRows}})})),void 0===Common)var Common={};if(define("common/main/lib/component/UpDownPicker",["common/main/lib/component/BaseView"],(function(){"use strict";Common.UI.UpDownPicker=Common.UI.BaseView.extend({options:{caption:"",iconUpCls:"btn-zoomup",iconDownCls:"btn-zoomdown",minWidth:40},disabled:!1,template:_.template(['<label class="title float-left"><%= options.caption %></label>','<button type="button" class="btn small btn-toolbar updown-picker-button-up float-right"><i class="icon menu__icon <%= options.iconUpCls %>">&nbsp;</i></button>','<label class="updown-picker-value float-right" style="min-width: <%= options.minWidth %>px;"></label>','<button type="button" class="btn small btn-toolbar updown-picker-button-down float-right"><i class="icon menu__icon <%= options.iconDownCls %>">&nbsp;</i></button>'].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.render(),this.cmpEl=this.$el||$(this.el),this.btnUp=new Common.UI.Button({el:this.cmpEl.find(".updown-picker-button-up")}).on("click",_.bind((function(){this.trigger("click","up")}),this)),this.btnDown=new Common.UI.Button({el:this.cmpEl.find(".updown-picker-button-down")}).on("click",_.bind((function(){this.trigger("click","down")}),this)),this.displayValue=this.cmpEl.find(".updown-picker-value"),this.options.disabled&&this.setDisabled(this.options.disabled)},render:function(){return(this.$el||$(this.el)).html($(this.template({options:this.options}))),this.rendered=!0,this},setValue:function(t){this.displayValue.html(t||"")},setDisabled:function(t){this.rendered&&((t=!0===t)!==this.disabled&&(this.btnUp.setDisabled(t),this.btnDown.setDisabled(t)),this.disabled=t)}})})),void 0===Common)var Common={};var FONT_TYPE_RECENT=4;if(define("common/main/lib/component/ComboBoxFonts",["common/main/lib/component/ComboBox"],(function(){"use strict";Common.UI.ComboBoxFonts=Common.UI.ComboBox.extend(function(){var t=300,e=Asc.FONT_THUMBNAIL_HEIGHT||28,i=document.createElement("canvas"),o=i.getContext("2d"),n=/^(zh|ja|ko)$/i.test(Common.Locale.getCurrentLanguage())?"_ea":"",s=[{ratio:1,path:"../../../../sdkjs/common/Images/fonts_thumbnail"+n+".png",width:t,height:e},{ratio:1.25,path:"../../../../sdkjs/common/Images/fonts_thumbnail"+n+"@1.25x.png",width:375,height:1.25*e},{ratio:1.5,path:"../../../../sdkjs/common/Images/fonts_thumbnail"+n+"@1.5x.png",width:450,height:1.5*e},{ratio:1.75,path:"../../../../sdkjs/common/Images/fonts_thumbnail"+n+"@1.75x.png",width:525,height:1.75*e},{ratio:2,path:"../../../../sdkjs/common/Images/fonts_thumbnail"+n+"@2x.png",width:600,height:2*e}],a=0,r=1,l=Common.Utils.applicationPixelRatio();Common.Controllers.Desktop.isActive()&&(s[0].path=Common.Controllers.Desktop.call("getFontsSprite"),s[1].path=Common.Controllers.Desktop.call("getFontsSprite","@1.25x"),s[2].path=Common.Controllers.Desktop.call("getFontsSprite","@1.5x"),s[3].path=Common.Controllers.Desktop.call("getFontsSprite","@1.75x"),s[4].path=Common.Controllers.Desktop.call("getFontsSprite","@2x"));for(var c=Math.abs(l-s[0].ratio),h=0,d=1;d<s.length;d++)(h=Math.abs(l-s[d].ratio))<c-1e-4&&(c=h,a=d);function m(){this.supportBinaryFormat=!(Common.Controllers.Desktop.isActive()&&!Common.Controllers.Desktop.isFeatureAvailable("isSupportBinaryFontsSprite")),this.image=null,this.binaryFormat=null,this.data=null,this.width=0,this.height=0,this.heightOne=0,this.count=0,this.offsets=null,this.load=function(t,e){if(e)if(this.supportBinaryFormat){var i=this,o=new XMLHttpRequest;o.open("GET",t+".bin",!0),o.responseType="arraybuffer",o.overrideMimeType?o.overrideMimeType("text/plain; charset=x-user-defined"):o.setRequestHeader("Accept-Charset","x-user-defined"),o.onload=function(){i.binaryFormat=new Uint8Array(this.response),e()},o.send(null)}else this.width=s[a].width,this.heightOne=s[a].height,this.image=new Image,this.image.onload=e,this.image.src=s[a].path},this.openBinary=function(t){var e=this.binaryFormat;this.width=e[0]<<24|e[1]<<16|e[2]<<8|e[3]<<0,this.heightOne=e[4]<<24|e[5]<<16|e[6]<<8|e[7]<<0,this.count=e[8]<<24|e[9]<<16|e[10]<<8|e[11]<<0,this.height=this.count*this.heightOne;var i=4*this.width*this.height,o=i>5e7;o?this.offsets=new Array(this.count):this.data=new Uint8ClampedArray(i);var n=12,s=e.length,a=0,r=0,l=0;if(o)for(var c=this.width*this.heightOne,h=c-1;n<s;)if(0==(l=e[n++]))for(r=e[n++];r>0;)r--,++h===c&&(this.offsets[a++]={pos:n,len:r+1},h=0);else++h===c&&(this.offsets[a++]={pos:n-1,len:-1},h=0);else for(var d=this.data;n<s;)if(0==(l=e[n++]))for(r=e[n++];r>0;)r--,d[a]=d[a+1]=d[a+2]=255,d[a+3]=0,a+=4;else d[a]=d[a+1]=d[a+2]=255-l,d[a+3]=l,a+=4;this.offsets||delete this.binaryFormat},this.getImage=function(i,o,n){if(this.supportBinaryFormat){this.data||this.offsets||this.openBinary(this.binaryFormat),o||((o=document.createElement("canvas")).width=this.width,o.height=this.heightOne,o.style.width=t+"px",o.style.height=e+"px",n=o.getContext("2d"));var s=n.createImageData(this.width,this.heightOne),a=4*this.width*this.heightOne;if(this.offsets){var r=this.binaryFormat,l=this.offsets[i].pos,c=0,h=this.width*this.heightOne,d=0,m=0,p=s.data;for(-1!=this.offsets[i].len&&(c+=4*this.offsets[i].len);h>0;)if(0==(d=r[l++]))for((m=r[l++])>h&&(m=h);m>0;)m--,p[c]=p[c+1]=p[c+2]=255,p[c+3]=0,c+=4,h--;else p[c]=p[c+1]=p[c+2]=255-d,p[c+3]=d,c+=4,h--}else s.data.set(new Uint8ClampedArray(this.data.buffer,i*a,a));n.putImageData(s,0,0)}else o||((o=document.createElement("canvas")).width=this.width,o.height=this.heightOne,o.style.width=t+"px",o.style.height=e+"px",n=o.getContext("2d")),n.clearRect(0,0,this.width,this.heightOne),n.drawImage(this.image,0,-this.heightOne*i);return o}}return i.height=s[a].height,i.width=s[a].width,{template:_.template(['<div class="input-group combobox fonts <%= cls %>" id="<%= id %>" style="<%= style %>">','<input dir="ltr" type="text" class="form-control" spellcheck="false" role="combobox" aria-controls="<%= id %>-menu" aria-expanded="false" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-move-focus-only-tab="true"> ','<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>','<ul id="<%= id %>-menu" class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">','<li class="divider">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>">','<a class="font-item" tabindex="-1" type="menuitem" role="menuitemcheckbox" aria-checked="false" style="height:<%=scope.getListItemHeight()%>px;"></a>',"</li>","<% }); %>","</ul>","</div>"].join("")),initialize:function(t){Common.UI.ComboBox.prototype.initialize.call(this,_.extend(t,{displayField:"name",scroller:{wheelSpeed:20,alwaysVisibleY:!0,onChange:this.updateVisibleFontsTiles.bind(this)}})),this.recent=_.isNumber(t.recent)?t.recent:5;var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:"",Common.NotificationCenter.on("fonts:load",_.bind(this.fillFonts,this))},render:function(t){var e=null,i="";return _.isUndefined(this._input)||(e=this._input.val(),i=this._input.attr("tabindex")),Common.UI.ComboBox.prototype.render.call(this,t),this.setRawValue(e),this._input.attr("tabindex",i),this._input.on("keyup",_.bind(this.onInputKeyUp,this)),this._input.on("keydown",_.bind(this.onInputKeyDown,this)),this._input.on("focus",_.bind((function(){this.inFormControl=!0}),this)),this._input.on("blur",_.bind((function(){this.inFormControl=!1}),this)),this._input.on("compositionstart",_.bind((function(){this._isComposition=!0}),this)),this._input.on("compositionend",_.bind((function(){this._isComposition=!1}),this)),this},onAfterKeydownMenu:function(t){var e=this;if(t.keyCode==Common.UI.Keys.RETURN){if($(t.target).closest("input").length){if(this.lastValue===this._input.val())return!0;this._input.trigger("change")}else $(t.target).click(),this.rendered&&(Common.Utils.isIE?this._input.trigger("change",{onkeydown:!0}):this._input.blur());return!1}if(t.keyCode==Common.UI.Keys.ESC&&this.isMenuOpen())return this._input.val(this.lastValue),setTimeout((function(){e.closeMenu(),e.onAfterHideMenu(t)}),10),!1;(t.keyCode==Common.UI.Keys.HOME&&!t.shiftKey||t.keyCode==Common.UI.Keys.END&&!t.shiftKey||t.keyCode==Common.UI.Keys.BACKSPACE&&!e._input.is(":focus"))&&this.isMenuOpen()&&(e._input.focus(),setTimeout((function(){e._input[0].selectionStart=e._input[0].selectionEnd=t.keyCode==Common.UI.Keys.HOME?0:e._input[0].value.length}),10)),this.updateVisibleFontsTiles()},onInputKeyUp:function(t){if(this._isKeyDown){if(t.keyCode!=Common.UI.Keys.RETURN&&t.keyCode!==Common.UI.Keys.SHIFT&&t.keyCode!==Common.UI.Keys.CTRL&&t.keyCode!==Common.UI.Keys.ALT&&t.keyCode!==Common.UI.Keys.LEFT&&t.keyCode!==Common.UI.Keys.RIGHT&&t.keyCode!==Common.UI.Keys.HOME&&t.keyCode!==Common.UI.Keys.END&&t.keyCode!==Common.UI.Keys.ESC&&t.keyCode!==Common.UI.Keys.INSERT&&t.keyCode!==Common.UI.Keys.TAB&&(t.stopPropagation(),this.selectCandidate(t.keyCode==Common.UI.Keys.DELETE||t.keyCode==Common.UI.Keys.BACKSPACE),this._selectedItem&&!this._isComposition)){var e=this;void 0===e._timerSelection&&(e._timerSelection=setInterval((function(){if(!(new Date-e._inInputKeyDown<100)&&e._selectedItem){clearInterval(e._timerSelection),e._timerSelection=void 0;var t=e._input[0],i=e._selectedItem.get(e.displayField),o=t.value;e.rendered&&(document.selection?document.selection.createRange().text=i:(t.selectionStart||"0"==t.selectionStart)&&(t.value=i,t.selectionStart=o.length,t.selectionEnd=i.length))}}),10))}this._isKeyDown=!1}},onInputKeyDown:function(t){this._isKeyDown=!0,this._inInputKeyDown=new Date;var e=this;t.keyCode==Common.UI.Keys.ESC?(this._input.val(this.lastValue),setTimeout((function(){e.closeMenu(),e.onAfterHideMenu(t)}),10)):t.keyCode!=Common.UI.Keys.RETURN&&t.keyCode!=Common.UI.Keys.CTRL&&t.keyCode!=Common.UI.Keys.SHIFT&&t.keyCode!=Common.UI.Keys.ALT&&t.keyCode!=Common.UI.Keys.TAB?(this.isMenuOpen()||t.ctrlKey||(this.openMenu(),this.recent>0&&this.flushVisibleFontsTiles()),t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN?_.delay((function(){var i=t.keyCode==Common.UI.Keys.DOWN?e.cmpEl.find("ul li.selected").nextAll("li:not(.divider)"):e.cmpEl.find("ul li.selected").prevAll("li:not(.divider)");i=(i=i.length>0?i.eq(0):t.keyCode==Common.UI.Keys.DOWN?e.cmpEl.find("ul li:not(.divider):first"):e.cmpEl.find("ul li:not(.divider):last")).find("a"),e._skipInputChange=!0,i.focus(),e.updateVisibleFontsTiles()}),10):e._skipInputChange=!1):t.keyCode==Common.UI.Keys.RETURN&&this._input.val()===e.lastValue&&this._input.trigger("change",{reapply:!0})},onInputChanged:function(t,e){if(!e||!e.synthetic)if(this._skipInputChange)this._skipInputChange=!1;else if(this._isMouseDownMenu)this._isMouseDownMenu=!1;else{var i=$(t.target).val(),o={};this.lastValue!==i||e&&e.reapply?(o[this.valueField]=i,o[this.displayField]=i,this.trigger("changed:before",this,o,t),t.isDefaultPrevented()||(this._selectedItem?(o[this.valueField]=this._selectedItem.get(this.displayField),this.setRawValue(o[this.valueField]),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),t),this.addItemToRecent(this._selectedItem),this.closeMenu()):(this.setRawValue(o[this.valueField]),o.isNewFont=!0,this.trigger("selected",this,o,t),this.closeMenu()),this.trigger("changed:after",this,o,t))):e&&e.onkeydown&&this.trigger("combo:blur",this,t)}},getImageUri:function(t){if(t.cloneid){var e=$(this.el).find("ul > li#"+t.cloneid+" img");return null!=e?e[0].src:void 0}var n=Math.floor(t.imgidx/r);return this.spriteThumbs.getImage(n,i,o).toDataURL()},getImageWidth:function(){return t},getImageHeight:function(){return e},getListItemHeight:function(){return 28},loadSprite:function(t){this.spriteThumbs=new m,this.spriteThumbs.load(s[a].path,t)},fillFonts:function(t,e){var i=this;this.loadSprite((function(){if(r=Math.floor(i.spriteThumbs.width/s[a].width)||1,i.store.set(t.toJSON()),i.rendered=!1,_.isUndefined(i.scroller)||(i.scroller.destroy(),delete i.scroller),i._scrollerIsInited=!1,i.render($(i.el)),i._fontsArray=i.store.toJSON(),i.recent>0){i.store.on("add",i.onInsertItem,i),i.store.on("remove",i.onRemoveItem,i),Common.Utils.InternalSettings.set(i.appPrefix+"-settings-recent-fonts",Common.localStorage.getItem(i.appPrefix+"-settings-recent-fonts"));var e=Common.Utils.InternalSettings.get(i.appPrefix+"-settings-recent-fonts");(e=e?e.split(";"):[]).reverse().forEach((function(t){t&&i.addItemToRecent(i.store.findWhere({name:t}),!0)}))}}))},onApiChangeFont:function(t){var e=this,i=_.isFunction(t.get_Name)?t.get_Name():t.asc_getFontName();this.__name!==i&&(this.__name=i,this.__nameId||(this.__nameId=setTimeout((function(){e.onApiChangeFontInternal(e.__name),e.__nameId=null}),100)))},onApiChangeFontInternal:function(t){if(!this.inFormControl&&this.getRawValue()!==t){var e=this.store.findWhere({name:t}),i=$(".selected",$(this.el));if(i.removeClass("selected"),i.find("a").attr("aria-checked",!1),e){this.setRawValue(e.get(this.displayField));var o=$("#"+e.get("id"),$(this.el)),n=$("ul.dropdown-menu",this.cmpEl);o&&n&&(o.addClass("selected"),o.find("a").attr("aria-checked",!0),this.recent<=0&&n.scrollTop(o.offset().top-n.offset().top))}else this.setRawValue(t)}},itemClicked:function(t){this.__name=void 0,this.__nameId&&(clearTimeout(this.__nameId),this.__nameId=void 0),Common.UI.ComboBox.prototype.itemClicked.apply(this,arguments);var e=$(t.target).closest("li"),i=this.store.findWhere({id:e.attr("id")});this.addItemToRecent(i)},onInsertItem:function(t){$(this.el).find("ul").prepend(_.template(['<li id="<%= item.id %>">','<a class="font-item" tabindex="-1" type="menuitem" role="menuitemcheckbox" aria-checked="false" style="height:<%=scope.getListItemHeight()%>px;"></a>',"</li>"].join(""))({item:t.attributes,scope:this}))},onRemoveItem:function(t,e,i){$(this.el).find("ul > li#"+t.id).remove()},onBeforeShowMenu:function(t){if(this.store.length<1)t.preventDefault();else if(Common.UI.ComboBox.prototype.onBeforeShowMenu.apply(this,arguments),!this.getSelectedRecord()&&this.getRawValue()){var e=this.store.where({name:this.getRawValue()});e&&e.length&&this.selectRecord(e[e.length-1])}},onAfterShowMenu:function(t){this.alignMenuPosition(),this.recent>0?(this.scroller&&!this._scrollerIsInited&&(this.scroller.update(),this._scrollerIsInited=!0),$(this.el).find("ul").scrollTop(0),this.trigger("show:after",this,t),this.flushVisibleFontsTiles(),this.updateVisibleFontsTiles(null,0),Common.Utils.isGecko&&this.scroller&&this.scroller.update(),this._input.attr("aria-expanded","true")):Common.UI.ComboBox.prototype.onAfterShowMenu.apply(this,arguments)},onAfterHideMenu:function(t){this.lastValue!==this._input.val()&&this._input.val(this.lastValue),Common.UI.ComboBox.prototype.onAfterHideMenu.apply(this,arguments)},addItemToRecent:function(t,e){if(t&&!(this.recent<1)){var i=this.store.findWhere({name:t.get("name"),type:FONT_TYPE_RECENT});i&&this.store.remove(i);var o=this.store.where({type:FONT_TYPE_RECENT});o.length<this.recent||this.store.remove(o[this.recent-1]);var n=t.clone();if(n.set({type:FONT_TYPE_RECENT,id:Common.UI.getId(),cloneid:t.id}),this.store.add(n,{at:0}),!e){var s=[];this.store.where({type:FONT_TYPE_RECENT}).forEach((function(t){s.push(t.get("name"))})),s=s.join(";"),Common.localStorage.setItem(this.appPrefix+"-settings-recent-fonts",s),Common.Utils.InternalSettings.set(this.appPrefix+"-settings-recent-fonts",s)}}},selectCandidate:function(t){var e=this,i=this._input.val().toLowerCase();this._fontsArray||(this._fontsArray=this.store.toJSON());var o=_.find(this._fontsArray,(function(o){return t?o[e.displayField].toLowerCase()==i:0==o[e.displayField].toLowerCase().indexOf(i)}));this._selectedItem=o?this.store.findWhere({id:o.id}):null;var n=$(".selected",$(this.el));if(n.removeClass("selected"),n.find("a").attr("aria-checked",!1),this._selectedItem){var s=$("#"+this._selectedItem.get("id"),$(this.el)),a=$("ul[role=menu]",$(this.el));if(s.length>0&&a.length>0){s.addClass("selected"),s.find("a").attr("aria-checked",!0);var r=Common.Utils.getPosition(s).top,l=a.scrollTop();0!=r&&a.scrollTop(l+r)}}},updateVisibleFontsTiles:function(t,e){var i=this,o=0,n=i.store.length,s=0;if(i.tiles||(i.tiles=[]),n!==i.tiles.length)for(o=i.tiles.length;o<n;++o)i.tiles.unshift(null);_.isUndefined(e)&&(e=parseInt($(i.el).find(".ps-scrollbar-x-rail").css("bottom")));var a=$(i.el).find(".dropdown-menu").height(),l=Math.max(Math.floor(a/28)+3,0),c=Math.max(Math.floor(-e/28)-1,0),h=c+l,d=$(i.el).find("a");for(o=0;o<n;++o)if(c<=o&&o<h){if(null===i.tiles[o]){s=Math.floor(i.store.at(o).get("imgidx")/r);var m=i.spriteThumbs.getImage(s);i.tiles[o]=m,$(d[o]).get(0).appendChild(m)}}else i.tiles[o]&&(i.tiles[o].parentNode.removeChild(i.tiles[o]),i.tiles[o]=null)},flushVisibleFontsTiles:function(){for(var t=this.tiles.length-1;t>=0;--t)this.tiles[t]&&(this.tiles[t].parentNode.removeChild(this.tiles[t]),this.tiles[t]=null)}}}())})),void 0===Common)var Common={};if(define("common/main/lib/component/ComboDataView",["common/main/lib/component/BaseView","common/main/lib/component/DataView"],(function(){"use strict";Common.UI.ComboDataView=Common.UI.BaseView.extend({options:{id:null,cls:"",style:"",hint:!1,itemWidth:80,itemHeight:40,menuMaxHeight:300,autoWidth:!1,enableKeyEvents:!1,beforeOpenHandler:null,additionalMenuItems:null,fillOnChangeVisibility:!1,showLast:!0,minWidth:-1,dataHint:"",dataHintDirection:"",dataHintOffset:""},template:_.template(['<div id="<%= id %>" class="combo-dataview <%= cls %>" style="<%= style %>">','<div class="view"></div> ','<div class="button"></div> ',"</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.id=this.options.id||Common.UI.getId(),this.cls=this.options.cls,this.style=this.options.style,this.hint=this.options.hint,this.store=this.options.store||new Common.UI.DataViewStore,this.groups=this.options.groups,this.itemWidth=this.options.itemWidth,this.itemHeight=this.options.itemHeight,this.menuMaxHeight=this.options.menuMaxHeight,this.beforeOpenHandler=this.options.beforeOpenHandler,this.showLast=this.options.showLast,this.wrapWidth=0,this.rootWidth=0,this.rootHeight=0,this.rendered=!1,this.needFillComboView=!1,this.minWidth=this.options.minWidth,this.autoWidth=this.initAutoWidth=!Common.Utils.isIE10&&!Common.Utils.isIE11&&this.options.autoWidth,this.delayRenderTips=this.options.delayRenderTips||!1,this.fillOnChangeVisibility=this.options.fillOnChangeVisibility||!1,this.itemTemplate=this.options.itemTemplate||_.template(['<div class="style" id="<%= id %>">','<img src="<%= imageUrl %>" width="'+this.itemWidth+'" height="'+this.itemHeight+'" + <% if(typeof imageUrl === "undefined" || imageUrl===null || imageUrl==="") { %> style="visibility: hidden;" <% } %>/>','<% if (typeof title !== "undefined") {%>','<span class="title"><%= title %></span>',"<% } %>","</div>"].join("")),this.fieldPicker=new Common.UI.DataView({cls:"field-picker",allowScrollbar:!1,itemTemplate:this.itemTemplate,delayRenderTips:this.delayRenderTips}),this.openButton=new Common.UI.Button({cls:"open-menu",menu:new Common.UI.Menu({menuAlign:Common.UI.isRTL()?"tr-tr":"tl-tl",offset:[0,3],items:[{template:_.template('<div class="menu-picker-container"></div>')}].concat(null!=this.options.additionalMenuItems?this.options.additionalMenuItems:[])}),dataHint:this.options.dataHint,dataHintDirection:this.options.dataHintDirection,dataHintOffset:this.options.dataHintOffset,ariaLabel:this.options.ariaLabel}),this.menuPicker=new Common.UI.DataView({cls:"menu-picker",parentMenu:this.openButton.menu,outerMenu:this.options.additionalMenuItems?{menu:this.openButton.menu,index:0}:void 0,restoreHeight:this.menuMaxHeight,style:"max-height: "+this.menuMaxHeight+"px;",enableKeyEvents:this.options.enableKeyEvents,groups:this.groups,store:this.store,itemTemplate:this.itemTemplate,delayRenderTips:this.delayRenderTips}),null!=this.options.additionalMenuItems&&this.openButton.menu.setInnerMenu([{menu:this.menuPicker,index:0}]),this.options.el&&this.render()},render:function(t){if(!this.rendered){var e=this;e.trigger("render:before",e),e.cmpEl=e.$el||$(e.el);var i=e.template({id:e.id,cls:e.cls,style:e.style});t?(e.setElement(t,!1),e.cmpEl=$(i),t.html(e.cmpEl)):e.cmpEl.html(i),e.rootWidth=e.cmpEl.width(),e.rootHeight=e.cmpEl.height(),e.fieldPicker.render($(".view",e.cmpEl)),e.openButton.render($(".button",e.cmpEl)),e.menuPicker.render($(".menu-picker-container",e.cmpEl)),e.openButton.menu.cmpEl&&e.openButton.menu.cmpEl&&(e.openButton.menu.menuAlignEl=e.cmpEl,e.openButton.menu.cmpEl.css("min-width",e.itemWidth),e.openButton.menu.on("show:before",_.bind(e.onBeforeShowMenu,e)),e.openButton.menu.on("show:after",_.bind(e.onAfterShowMenu,e)),e.openButton.cmpEl.on("hide.bs.dropdown",_.bind(e.onBeforeHideMenu,e)),e.openButton.cmpEl.on("hidden.bs.dropdown",_.bind(e.onAfterHideMenu,e))),e.options.hint&&(e.cmpEl.attr("data-toggle","tooltip"),e.cmpEl.tooltip({title:e.options.hint,placement:e.options.hintAnchor||"cursor"})),e.autoWidth&&e.cmpEl.addClass("auto-width"),e.fieldPicker.on("item:select",_.bind(e.onFieldPickerSelect,e)),e.menuPicker.on("item:select",_.bind(e.onMenuPickerSelect,e)),e.fieldPicker.on("item:click",_.bind(e.onFieldPickerClick,e)),e.menuPicker.on("item:click",_.bind(e.onMenuPickerClick,e)),e.fieldPicker.on("item:contextmenu",_.bind(e.onPickerItemContextMenu,e)),e.menuPicker.on("item:contextmenu",_.bind(e.onPickerItemContextMenu,e)),e.fieldPicker.el.addEventListener("contextmenu",_.bind(e.onPickerComboContextMenu,e),!1),e.menuPicker.el.addEventListener("contextmenu",_.bind(e.onPickerComboContextMenu,e),!1),Common.NotificationCenter.on("more:toggle",_.bind(this.onMoreToggle,this)),Common.NotificationCenter.on("tab:active",_.bind(this.onTabActive,this)),Common.NotificationCenter.on("window:resize",_.bind(this.startCheckSize,this)),e.checkSize(),e.onResize(),e.rendered=!0,e.trigger("render:after",e)}return this.disabled&&this.setDisabled(!!this.disabled),this},onMoreToggle:function(t,e){e&&this.startCheckSize()},onTabActive:function(){this.startCheckSize()},checkVisibility:function(){var t=this;t._timer_visibility||(t._timer_visibility=setInterval((function(){if(t.isVisible()){clearInterval(t._timer_visibility),delete t._timer_visibility;var e=t.menuPicker.getSelectedRec();e&&t.fillComboView(e,!!e,!0)}}),500))},startCheckSize:function(){var t=this;t.checkSize(),t._timer_id?t._needCheckSize=0:(t._needCheckSize=0,t._timer_id=setInterval((function(){t._needCheckSize++<10?t.checkSize():(clearInterval(t._timer_id),delete t._timer_id)}),500))},checkSize:function(){if(this.cmpEl&&this.cmpEl.is(":visible")){if(this.autoWidth&&this.menuPicker.store.length>0){var t=this.$el.width();if(t!=this.wrapWidth||this.needFillComboView){(t=this.autoChangeWidth())&&(this.wrapWidth=t);var e=this.menuPicker,i=e.getSelectedRec();this.fillComboView(i||e.store.at(0),!!i,!0)}}var o=this,n=this.cmpEl.width(),s=this.cmpEl.height();if(n<this.minWidth)return;this.rootWidth==n&&this.rootHeight==s||(this.rootWidth=n,this.rootHeight=s,setTimeout((function(){o.openButton.menu.cmpEl.outerWidth(),o.rootWidth=o.cmpEl.width()}),10),this.onResize())}},onResize:function(){if(this.openButton){var t=$("button",this.openButton.cmpEl),e=$(".button",this.cmpEl);t&&e.width()>0&&t.css({height:e.height()}),this.openButton.menu.hide();var i=this.menuPicker;if(i){var o=i.getSelectedRec();this.itemMarginLeft=void 0,this.fillComboView(o||i.store.at(0),!!o,!0),i.onResize()}}this.isSuspendEvents||this.trigger("resize",this)},autoChangeWidth:function(){if(this.menuPicker.dataViewItems[0]){var t=this.$el,e=this.checkAutoWidth(t,t.width()),i=this.cmpEl;return e&&(i.css("width",e),t.css("width",e+parseFloat(t.css("padding-left"))+parseFloat(t.css("padding-right"))+"px")),this.initAutoWidth&&(this.initAutoWidth=!1,i.css("position","absolute"),i.css("top","50%"),i.css("bottom","50%"),i.css("margin","auto 0"),i.css("width",t.width()+"px")),e}},checkAutoWidth:function(t,e){var i=t.find(".menu-picker"),o=t.find(".field-picker").closest(".view"),n=t.find(".combo-dataview");if(i&&i.length>0){var s=i.find(".item"),a=s.length,r=o.find(".item");if(s.length>0){var l=(s=$(s[0])).width();if(l<1&&(l=r.length>0?$(r[0]).width():0),l<1)return;l+=parseFloat(s.css("padding-left"))+parseFloat(s.css("padding-right"))+2*parseFloat(s.css("border-width"));var c=parseFloat(s.css("margin-left"))+parseFloat(s.css("margin-right")),h=parseFloat(o.css(Common.UI.isRTL()?"padding-left":"padding-right")),d=parseFloat(o.css("border-width")),m=o.find(".dataview"),p=parseFloat(m.css("padding-left"))+parseFloat(m.css("padding-right")),u=parseFloat(n.css("padding-left"))+parseFloat(n.css("padding-right")),g=Math.floor((e-h-p-2*d-u)/(l+c));g>a&&(g=a);var f=Math.ceil(10*(g*(l+c)+h+p+2*d+u))/10,b=parseFloat(n.css("max-width"));return f>b&&(f=b),f}}},onBeforeShowMenu:function(t){var e=this;if(_.isFunction(e.beforeOpenHandler)?e.beforeOpenHandler(e,t):e.openButton.menu.cmpEl&&e.openButton.menu.cmpEl.css({width:e.cmpEl.width()-e.openButton.cmpEl.width(),"min-height":e.cmpEl.height()}),e.options.hint){var i=e.cmpEl.data("bs.tooltip");i&&(void 0===i.dontShow&&(i.dontShow=!0),i.hide())}this.menuPicker.selectedBeforeHideRec=null},onBeforeHideMenu:function(t){if(this.trigger("hide:before",this,t),Common.UI.Scroller.isMouseCapture()&&t.preventDefault(),this.isStylesNotClosable)return!1},onAfterShowMenu:function(t){this.menuPicker.scroller&&this.menuPicker.scroller.update({includePadding:!0,suppressScrollX:!0,alwaysVisibleY:!0})},onAfterHideMenu:function(t,e){this.menuPicker.selectedBeforeHideRec=this.menuPicker.getSelectedRec(),this.showLast?this.menuPicker.showLastSelected():this.menuPicker.deselectAll(),this.trigger("hide:after",this,t,e)},onFieldPickerSelect:function(t,e,i){},onMenuPickerSelect:function(t,e,i,o){this.needFillComboView=this.disabled,this.disabled||!0===o||(this.fillComboView(i,!1),i&&!this.isSuspendEvents&&this.trigger("select",this,i))},onFieldPickerClick:function(t,e,i){if(!this.disabled){if(this.isSuspendEvents||this.trigger("click",this,i),this.options.hint){var o=this.cmpEl.data("bs.tooltip");o&&(void 0===o.dontShow&&(o.dontShow=!0),o.hide())}this.showLast||this.fieldPicker.deselectAll()}},onMenuPickerClick:function(t,e,i){this.disabled||this.isSuspendEvents||this.trigger("click",this,i)},onPickerItemContextMenu:function(t,e,i,o){if(!this.disabled)return this.isSuspendEvents||this.trigger("contextmenu",this,i,o),o.preventDefault(),o.stopPropagation(),!1},onPickerComboContextMenu:function(t){this.disabled||this.isSuspendEvents||this.trigger("contextmenu",this,void 0,t)},setDisabled:function(t){if(t=!!t,this.disabled=t,this.rendered&&(this.cmpEl.toggleClass("disabled",t),$("button",this.openButton.cmpEl).toggleClass("disabled",t),this.fieldPicker.setDisabled(t),this.needFillComboView&&!t)){var e=this.menuPicker;if(e){var i=e.getSelectedRec();this.fillComboView(i||e.store.at(0),!1)}}},isDisabled:function(){return this.disabled},fillComboView:function(t,e,i){if(!_.isUndefined(t)&&t instanceof Backbone.Model){this.needFillComboView=!this.isVisible();var o=this,n=o.menuPicker.store,s=$(o.fieldPicker.el);if(n){if(i||!o.fieldPicker.store.findWhere({id:t.get("id")})){if(void 0===o.itemMarginLeft){var a=$($(this.menuPicker.el).find(".inner > div:not(.grouped-data):not(.ps-scrollbar-x-rail):not(.ps-scrollbar-y-rail)")[0]);(!a||a.length<1)&&(a=$($(this.menuPicker.el).find(".inner .group-items-container > div:not(.grouped-data):not(.ps-scrollbar-x-rail):not(.ps-scrollbar-y-rail)")[0])),a.length>0&&(o.itemMarginLeft=parseInt(a.css("margin-left")),o.itemMarginRight=parseInt(a.css("margin-right")),o.itemPaddingLeft=parseInt(a.css("padding-left")),o.itemPaddingRight=parseInt(a.css("padding-right")),o.itemBorderLeft=parseInt(a.css("border-left-width")),o.itemBorderRight=parseInt(a.css("border-right-width")))}var r=n.indexOf(t);if(r<0)return;var l=n.length,c=Math.floor(Math.max(s.width(),o.minWidth)/(o.itemWidth+(o.itemMarginLeft||0)+(o.itemMarginRight||0)+(o.itemPaddingLeft||0)+(o.itemPaddingRight||0)+(o.itemBorderLeft||0)+(o.itemBorderRight||0))),h=[];s.height()/o.itemHeight>2&&(c*=Math.floor(s.height()/o.itemHeight)),l-(r=Math.floor(r/c)*c)<c&&(r=Math.max(l-c,0));for(var d=r,m=0;d<l&&m<c;d++,m++)h.push(n.at(d));o.fieldPicker.store.reset(h)}if(e){var p=o.fieldPicker.store.findWhere({id:t.get("id")});p&&(o.suspendEvents(),o.fieldPicker.selectRecord(p,!0),o.resumeEvents())}return o.fillOnChangeVisibility&&!o.isVisible()&&o.checkVisibility(),o.fieldPicker.store.models}}},clearComboView:function(){this.fieldPicker.store.reset([])},selectByIndex:function(t){t<0&&this.fieldPicker.deselectAll(),this.menuPicker.selectByIndex(t)},selectRecord:function(t){t||this.fieldPicker.deselectAll(),this.menuPicker.selectRecord(t)},setItemWidth:function(t){this.itemWidth!=t&&(this.itemWidth=Common.Utils.applicationPixelRatio()>1?t/2:t)},setItemHeight:function(t){this.itemHeight!=t&&(this.itemHeight=Common.Utils.applicationPixelRatio()>1?t/2:t)},removeTips:function(){var t=this.menuPicker;_.each(t.dataViewItems,(function(t){var e=t.$el.data("bs.tooltip");e&&e.tip().remove()}),t)}})})),void 0===Common)var Common={};define("common/main/lib/component/SynchronizeTip",["common/main/lib/component/BaseView"],(function(){"use strict";Common.UI.SynchronizeTip=Common.UI.BaseView.extend(_.extend({options:{target:$(document.body),text:"",placement:"right-bottom",showLink:!0,showButton:!1,closable:!0,textHeader:""},template:_.template(['<div class="synch-tip-root <% if (!!scope.options.extCls) {print(scope.options.extCls + " ");} %><%= scope.placement %>" style="<%= scope.style %>">','<div class="asc-synchronizetip">','<div class="tip-arrow <%= scope.placement %>"></div>',"<div>",'<div class="tip-text">','<% if ( scope.textHeader !== "" ) { %>','<label class="tip-header"><%= scope.textHeader %></label><br>',"<% } %>","<%= scope.text %></div>","<% if ( scope.closable ) { %>",'<div class="close"></div>',"<% } %>","</div>","<% if ( scope.showLink ) { %>",'<div class="show-link"><label><%= scope.textLink %></label></div>',"<% } %>","<% if ( scope.showButton ) { %>",'<div class="btn-div"><%= scope.textButton %></div>',"<% } %>","</div>","</div>"].join("")),initialize:function(t){this.textSynchronize+=Common.Utils.String.platformKey("Ctrl+S"),Common.UI.BaseView.prototype.initialize.call(this,t),this.target=this.options.target,this.text=_.isEmpty(this.options.text)?this.textSynchronize:this.options.text,this.textLink=_.isEmpty(this.options.textLink)?this.textDontShow:this.options.textLink,this.placement=this.options.placement,this.showLink=this.options.showLink,this.showButton=this.options.showButton,this.closable=this.options.closable,this.textButton=this.options.textButton||this.textGotIt,this.textHeader=this.options.textHeader||"",this.position=this.options.position,this.offset=this.options.offset,this.style=this.options.style||"",this.automove=this.options.automove,this.binding={}},render:function(){return this.cmpEl||(this.cmpEl=$(this.template({scope:this})),$(document.body).append(this.cmpEl),this.cmpEl.find(".close").on("click",_.bind((function(){this.trigger("closeclick")}),this)),this.cmpEl.find(".show-link label").on("click",_.bind((function(){this.trigger("dontshowclick")}),this)),this.cmpEl.find(".btn-div").on("click",_.bind((function(){this.trigger("buttonclick")}),this)),this.closable&&this.cmpEl.addClass("closable"),this.binding.windowresize=_.bind(this.applyPlacement,this)),this.applyPlacement(),this},show:function(){this.cmpEl?(this.applyPlacement(),this.cmpEl.show()):this.render(),this.automove&&$(window).on("resize",this.binding.windowresize)},hide:function(){this.cmpEl&&this.cmpEl.hide(),this.trigger("hide"),this.automove&&$(window).off("resize",this.binding.windowresize)},close:function(){this.cmpEl&&this.cmpEl.remove(),this.trigger("close"),this.automove&&$(window).off("resize",this.binding.windowresize)},applyPlacement:function(){var t=this.target&&this.target.length>0?this.target:$(document.body),e=Common.Utils.getOffset(t),i=this.offset||{x:0,y:0};if("target"!=this.placement||this.position){if(this.position&&"object"==_typeof(this.position)){var o=this.position.top,n=this.position.left,s=this.position.bottom,a=this.position.right;return void 0!==s||void 0!==o?n=e.left+(t.width()-this.cmpEl.width())/2:o=e.top+(t.height()-this.cmpEl.height())/2,o=void 0!==o?o+"px":"auto",s=void 0!==s?s+"px":"auto",a=void 0!==a?a+"px":"auto",n=void 0!==n?n+"px":"auto",void this.cmpEl.css({top:o,left:n,right:a,bottom:s})}var r=this.placement.split("-");if(r.length>0){var l=r[0];if("top"==l?s=Common.Utils.innerHeight()-e.top+i.y:"bottom"==l?o=e.top+t.height()+i.y:"left"==l?a=Common.Utils.innerWidth()-e.left+i.x:"right"==l&&(n=e.left+t.width()+i.x),"top"==(l=r[1]))s=Common.Utils.innerHeight()-e.top-t.height()/2+i.y;else if("bottom"==l){o=e.top+t.height()/2+i.y;var c=this.cmpEl.height();o+c>Common.Utils.innerHeight()&&(o=Common.Utils.innerHeight()-c-10)}else"left"==l?a=Common.Utils.innerWidth()-e.left-t.width()/2+i.x:"right"==l?n=e.left+t.width()/2+i.x:void 0!==s||void 0!==o?n=e.left+(t.width()-this.cmpEl.width())/2+i.x:o=e.top+(t.height()-this.cmpEl.height())/2+i.y;if(o=void 0!==o?o+"px":"auto",s=void 0!==s?s+"px":"auto",a=void 0!==a?a+"px":"auto",void 0!==n){var h=this.cmpEl.width();n+h>Common.Utils.innerWidth()&&(n=Common.Utils.innerWidth()-h-10),n+="px"}else n="auto";this.cmpEl.css({top:o,left:n,right:a,bottom:s})}}else this.cmpEl.css({top:e.top+5+i.y+"px",left:e.left+5+i.x+"px"})},isVisible:function(){return this.cmpEl&&this.cmpEl.is(":visible")},setText:function(t){this.text!==t&&(this.text=t,this.cmpEl.find(".tip-text").text(t))},textDontShow:"Don't show this message again",textSynchronize:"The document has been changed by another user.<br>Please click to save your changes and reload the updates.",textGotIt:"Got it"},Common.UI.SynchronizeTip||{})),Common.UI.TooltipManager=new function(){var t={},e={},i=function(e){return t[e]&&!(t[e].name&&Common.localStorage.getItem(t[e].name))},o=function(n){if("object"===_typeof(n)&&n.step&&(t[n.step]?t[n.step].text=n.text:t[n.step]=n,n=n.step),t[n]){if(i(n)&&(!t[n].prev||!i(t[n].prev))){var s=t[n],a=s.target,r=function(t){if("string"==typeof t){e[t]||(e[t]=[]);for(var i=e[t].length-1;i>=0;i--){if(e[t][i])return e[t][i];e[t].pop()}return $(t)}return t}(a);if(s.tip&&s.tip.isVisible())return!0;if(!(r&&r.length&&r.is(":visible")))return!1;var l=s.placement||"bottom";Common.UI.isRTL()&&(l=l.indexOf("right")>-1?l.replace("right","left"):l.replace("left","right")),!s.noHighlight&&r.addClass("highlight-tip"),s.isNewFeature&&(s.header="<span>"+(Common.UI.SynchronizeTip.prototype.textNew||"New")+"</span>"+s.header),s.tip=new Common.UI.SynchronizeTip({extCls:"colored"+(s.extCls?" "+s.extCls:"")+(s.noHighlight?" no-arrow":""),style:"min-width:200px;max-width:"+(s.maxwidth?s.maxwidth+("number"==typeof s.maxwidth?"px;":";"):"250px;"),placement:l,position:s.position,offset:s.offset,target:r,text:s.text,textHeader:s.header,showLink:!!s.link,textLink:s.link?s.link.text:"",closable:!1!==s.closable,showButton:!1!==s.showButton,automove:!!s.automove}),s.tip.on({buttonclick:function(){s.tip&&s.tip.close(),s.tip=void 0},closeclick:function(){s.tip&&s.tip.close(),s.tip=void 0},dontshowclick:function(){s.link.url?window.open(s.link.url,"_blank"):Common.NotificationCenter.trigger("file:help",s.link.src)},close:function(){r.removeClass("highlight-tip"),s.name&&Common.localStorage.setItem(s.name,1),s.callback&&s.callback(),s.next&&o(s.next),!s.multiple&&delete t[n],"string"==typeof a&&s.stackIdx&&(e[a][s.stackIdx-1]=void 0,s.stackIdx=void 0)}}),s.tip.show(),"string"==typeof a&&(e[a].push(s.tip.cmpEl),s.stackIdx=e[a].length)}return!0}};return{showTip:o,closeTip:function(e,i,o){var n=t[e];n&&(o&&(n.next=void 0),n.tip&&n.tip.close(),n.tip=void 0,i&&n.name&&Common.localStorage.setItem(n.name,1))},removeTip:function(e){t[e]&&(delete t[e],t[e]=void 0)},addTips:function(e){for(var i in e)!e.hasOwnProperty(i)||Common.localStorage.getItem(e[i].name)||t[i]&&t[i].tip&&t[i].tip.isVisible()||(t[i]=e[i])},getNeedShow:i}}})),function(t){"use strict";t.fn.emulateTransitionEnd=function(e){var i=!1,o=this;t(this).one("bsTransitionEnd",(function(){i=!0}));return setTimeout((function(){i||t(o).trigger(t.support.transition.end)}),e),this},t((function(){t.support.transition=function(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return{end:e[i]};return!1}(),t.support.transition&&(t.event.special.bsTransitionEnd={bindType:t.support.transition.end,delegateType:t.support.transition.end,handle:function(e){if(t(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}})}))}(jQuery),define("common/main/lib/mods/transition",(function(){})),define("common/main/lib/component/Mixtbar",["backbone","common/main/lib/component/BaseView","common/main/lib/mods/transition"],(function(t){"use strict";Common.UI.Mixtbar=Common.UI.BaseView.extend(function(){var t,e,i,o={timeout:2e3},n={},s=[];function a(){var o=t.scrollLeft();(Common.UI.isRTL()?i:e).toggleClass("disabled",Math.abs(Math.floor(o))<=(Common.UI.isRTL()?1:0)),(Common.UI.isRTL()?e:i).toggleClass("disabled",Math.abs(Math.ceil(o))>=t[0].scrollWidth-t[0].clientWidth-(Common.UI.isRTL()?1:0))}var r=function(e,i){if(!$(i.target).hasClass("disabled")){var o=t.scrollLeft();(o||"right"==e||Common.UI.isRTL()&&"left"==e)&&t.animate({scrollLeft:"left"==e?o-100:o+100},200,a)}},l=function(e){e.preventDefault();var i=e.deltaX||e.detail||e.deltaY;t.scrollLeft(t.scrollLeft()+60*i),a()};function c(t){var e=$(t.currentTarget).find("> a[data-tab]").data("tab");this.dblclick_el==e&&(this.fireEvent("change:compact",[e]),this.dblclick_el=void 0)}function h(t){this.isFolded&&($(t.target).parents(".toolbar, #file-menu-panel").length||o.$bar&&o.$bar.hasClass("expanded")&&this.collapse())}return{$tabs:void 0,$panels:void 0,isFolded:!1,initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=Common.UI.isRTL()?'<section class="tabs"><a class="scroll right" data-hint="0" data-hint-direction="bottom" data-hint-offset="-7, 0" data-hint-title="R"></a><ul role="tablist"><% for(var i in items) { %><% if (typeof items[i] == "object") { %><li class="ribtab<% if (items[i].haspanel===false) print(" x-lone") %><% if (items[i].extcls) print(\' \' + items[i].extcls) %>"<% if (typeof items[i].layoutname == "string") print(" data-layout-name=" + \' \' +  items[i].layoutname) + \' \' %>><a role="tab" id="<%= items[i].action %>" data-tab="<%= items[i].action %>" data-title="<%= items[i].caption %>" data-hint="0" data-hint-direction="bottom" data-hint-offset="small" <% if (typeof items[i].dataHintTitle !== "undefined") { %> data-hint-title="<%= items[i].dataHintTitle %>" <% } %>><%= items[i].caption %></a></li><% } %><% } %></ul><a class="scroll left" data-hint="0" data-hint-direction="bottom" data-hint-offset="-7, 0" data-hint-title="V"></a></section>':'<section class="tabs"><a class="scroll left" data-hint="0" data-hint-direction="bottom" data-hint-offset="-7, 0" data-hint-title="V"></a><ul role="tablist"><% for(var i in items) { %><% if (typeof items[i] == "object") { %><li class="ribtab<% if (items[i].haspanel===false) print(" x-lone") %><% if (items[i].extcls) print(\' \' + items[i].extcls) %>"<% if (typeof items[i].layoutname == "string") print(" data-layout-name=" + \' \' +  items[i].layoutname) + \' \' %>><a role="tab" id="<%= items[i].action %>" data-tab="<%= items[i].action %>" data-title="<%= items[i].caption %>" data-hint="0" data-hint-direction="bottom" data-hint-offset="small" <% if (typeof items[i].dataHintTitle !== "undefined") { %> data-hint-title="<%= items[i].dataHintTitle %>" <% } %>><%= items[i].caption %></a></li><% } %><% } %></ul><a class="scroll right" data-hint="0" data-hint-direction="bottom" data-hint-offset="-7, 0" data-hint-title="R"></a></section>';this.$layout=$(t.template({tabsmarkup:_.template(e)({items:t.tabs}),isRTL:Common.UI.isRTL(),config:t.config})),n.tabs=t.tabs,$(document.body).on("click",h.bind(this)),Common.NotificationCenter.on("tab:visible",_.bind((function(t,e){this.setVisible(t,e)}),this)),Common.NotificationCenter.on("tab:resize",_.bind(this.onResizeTabs,this)),Common.NotificationCenter.on("app:repaint",_.bind((function(){this.repaintMoreBtns()}),this)),Common.NotificationCenter.on("uitheme:changed",_.bind((function(){this.clearActiveData(),this.processPanelVisible()}),this))},afterRender:function(){var n=this;t=n.$(".tabs > ul"),n.$tabs=t.find("> li"),n.$boxpanels=n.$(".box-panels"),n.$panels=n.$boxpanels.find("> .panel"),o.$bar=n.$(".toolbar"),i=n.$(".tabs .scroll.right"),(e=n.$(".tabs .scroll.left")).on("click",r.bind(this,"left")),i.on("click",r.bind(this,"right")),t.on("dblclick","> .ribtab",c.bind(this)),t.on("click","> .ribtab",n.onTabClick.bind(this)),t.on("mousewheel",l)},isTabActive:function(t){var e=this.$tabs.filter(".active").find("> a");return e.length&&e.data("tab")==t},setFolded:function(t){this.isFolded=t;var e=this;if(this.isFolded)o.$box||(o.$box=e.$el.find(".box-controls")),o.$bar.addClass("folded z-clear").toggleClass("expanded",!1),o.$bar.find(".tabs .ribtab").removeClass("active"),o.$bar.on($.support.transition.end,(function(t){o.$bar.hasClass("folded")&&!o.$bar.hasClass("expanded")&&o.$bar.toggleClass("z-clear",!0)})),o.$box.on({mouseleave:function(t){},mouseenter:function(t){}});else{o.$bar.removeClass("folded z-clear"),o.$box.off();var i=o.$box.find(".panel.active");if(i.length){var n=i.data("tab");e.$tabs.find("> a[data-tab="+n+"]").parent().toggleClass("active",!0)}else n=e.$tabs.siblings(":not(.x-lone):visible").first().find("> a[data-tab]").data("tab"),e.setTab(n)}},collapse:function(){Common.UI.Menu.Manager.hideAll(),this.isFolded&&o.$bar&&(o.$bar.removeClass("expanded"),o.$bar.find(".tabs .ribtab").removeClass("active")),this.fireEvent("tab:collapse")},expand:function(){o.$bar.removeClass("z-clear"),o.$bar.addClass("expanded")},onResizeTabs:function(e){this.hasTabInvisible()?t.parent().hasClass("short")||(t.parent().addClass("short"),a()):t.parent().hasClass("short")&&t.parent().removeClass("short")},onResize:function(t){this.onResizeTabs(),this.hideMoreBtns(),this.processPanelVisible()},onTabClick:function(t){var e=this,i=$(t.currentTarget),o=i.find("> a[data-tab]").data("tab");i.hasClass("x-lone")?e.isFolded&&e.collapse():i.hasClass("active")?e._timerSetTab||(e.dblclick_el=o,e.isFolded&&(e.collapse(),setTimeout((function(){e.dblclick_el=void 0}),500))):(e._timerSetTab=!0,setTimeout((function(){e._timerSetTab=!1}),500),e.setTab(o),e.fireEvent("tab:click",[o]),e.isFolded?e.dblclick_el=o:(e.dblclick_timer&&clearTimeout(e.dblclick_timer),e.dblclick_timer=setTimeout((function(){e.dblclick_el=o,delete e.dblclick_timer}),500)))},setTab:function(t){var e=this;if(t||(this.isFolded?this.collapse():t=this.lastPanel),t){this.fireEvent("tab:active:before",[t]),e.$tabs.removeClass("active"),e.$panels.removeClass("active"),e.hideMoreBtns();var i=this.$panels.filter("[data-tab="+t+"]");i.length&&(this.lastPanel=t,i.addClass("active"),e.setMoreButton(t,i),e.processPanelVisible(null,!0)),i.length?e.isFolded&&e.expand():e.isFolded&&e.collapse();var o=this.$tabs.find("> a[data-tab="+t+"]").parent();o.length&&o.addClass("active"),this.fireEvent("tab:active",[t]),Common.NotificationCenter.trigger("tab:active",[t])}},addTab:function(e,i,o){var s=_.template('<li class="ribtab" style="display: none;" <% if (typeof layoutname == "string") print(" data-layout-name=" + \' \' +  layoutname) + \' \' %>><a role="tab" id="<%= action %>" data-tab="<%= action %>" data-title="<%= caption %>" data-hint="0" data-hint-direction="bottom" data-hint-offset="small" <% if (typeof dataHintTitle !== "undefined") { %> data-hint-title="<%= dataHintTitle %>" <% } %> ><%= caption %></a></li>');n.tabs[o+1]=e;var a=function t(e){return n.tabs[e]?n.tabs[e].action:t(--e)}(o),r=this.$tabs||this.$layout.find(".tabs"),l=r.find("a[data-tab="+a+"]");l.length&&(l.parent().after(s(e)),i&&((l=(r=this.$panels||this.$layout.find(".box-panels > .panel")).filter("[data-tab="+a+"]")).length?l.after(i):i.appendTo(this.$layout.find(".box-panels"))),this.$tabs&&(this.$tabs=t.find("> li")),this.$panels&&(this.$panels=this.$el.find(".box-panels > .panel")))},getTab:function(t){if(t&&this.$panels){var e=this.$panels.filter("[data-tab="+t+"]");return e.length?e:void 0}},createTab:function(t,e){if(t.action&&t.caption){var i=$('<section id="'+t.action+'" class="panel" data-tab="'+t.action+'"></section>');return this.addTab(t,i,this.getLastTabIdx()),this.setVisible(t.action,!!e),i}},getMorePanel:function(t){return t&&s[t]?s[t].panel:null},getLastTabIdx:function(){return n.tabs.length},isCompact:function(){return this.isFolded},isExpanded:function(){return!this.isFolded||o.$bar&&o.$bar.hasClass("expanded")},hasTabInvisible:function(){if(t.length<1)return!1;var e=Math.round(Common.Utils.getOffset(t).left),i=Math.round(e+t.width()),o=this.$tabs.filter(Common.UI.isRTL()?":visible:last":":visible:first").get(0);if(!o)return!1;var n=Common.Utils.getBoundingClientRect(o);return Math.round(n.left)<e||(o=this.$tabs.filter(Common.UI.isRTL()?":visible:first":":visible:last").get(0),n=Common.Utils.getBoundingClientRect(o),Math.round(n.right)>i)},processPanelVisible:function(t,e){var i=this;function o(){var o=t||i.$panels.filter(".active");if(o&&o.length){var n=o.parents(".box-controls").width(),a=o.parents(".box-controls").find(".panel.static").outerWidth();a||(a=0);var r=o.data(),l=r.rightedge,c=r.buttons,h=r.flex,d=o.find(".more-box");if(0===d.length&&i.setMoreButton(o.attr("data-tab"),o),l||(l=o.outerWidth()+a),c||(c=[],_.each(o.find(".btn-slot .x-huge"),(function(t){c.push($(t).closest(".btn-slot"))})),s[r.tab]&&s[r.tab].panel&&_.each(s[r.tab].panel.find(".btn-slot .x-huge"),(function(t){c.push($(t).closest(".btn-slot"))})),r.buttons=c),h||(h=[],_.each(o.find(".group.flex"),(function(t){var e=$(t);h.push({el:e,width:e.attr("data-group-width")||e.attr("max-width")})})),r.flex=h),l>n){if(!d.is(":visible")){if(h.length>0)for(var m=0;m<h.length;m++){var p=h[m].el;if(l=o.outerWidth()+a,Math.floor(p.outerWidth())>parseInt(p.css("min-width")))return void(r.rightedge=l);p.css("width",p.css("min-width"))}for(m=c.length-1;m>=0;m--){if(!(u=c[m]).hasClass("compactwidth")&&!u.hasClass("slot-btn-more")&&(u.addClass("compactwidth"),(l=o.outerWidth()+a)<=n))break}r.rightedge=l}i.resizeToolbar(e)}else if(d.is(":visible")&&i.resizeToolbar(e),!d.is(":visible")){for(m=0;m<c.length;m++){var u;if((u=c[m]).hasClass("compactwidth")&&(u.removeClass("compactwidth"),(l=o.outerWidth()+a)>n)){u.addClass("compactwidth"),l=o.outerWidth()+a;break}}if(r.rightedge=l,h.length>0&&o.find(".btn-slot.compactwidth").length<1)for(m=0;m<h.length;m++){var g;(p=h[m]).el.find(".combo-dataview").hasClass("auto-width")&&(g=Common.UI.ComboDataView.prototype.checkAutoWidth(p.el,i.$boxpanels.width()-o.outerWidth()+p.el.width())),p.el.css("width",g?g+parseFloat(p.el.css("padding-left"))+parseFloat(p.el.css("padding-right"))+"px":p.width),r.rightedge=Common.Utils.getBoundingClientRect(o.get(0)).right}}}}i._timer_id?i._needProcessPanel=!0:(o(),i._needProcessPanel=!1,i._timer_id=setInterval((function(){i._needProcessPanel?(o(),i._needProcessPanel=!1):(clearInterval(i._timer_id),delete i._timer_id)}),100))},setExtra:function(t,e){e&&(this.$tabs||("right"==t?this.$layout.find(".extra.right").html(e):"left"==t&&this.$layout.find(".extra.left").html(e)))},setVisible:function(t,e){t&&this.$tabs&&(this.$tabs.find("> a[data-tab="+t+"]").parent().css("display",e?"":"none"),this.onResize())},setMoreButton:function(t,e){var i=this;if(!s[t]){var n=Common.Utils.getPosition(e).top,a=$('<div class="more-box" style="top:'+n+'px;"><div class="separator long" style="position: relative;display: table-cell;"></div><div class="group" style=""><span class="btn-slot text x-huge slot-btn-more"></span></div></div>');e.append(a),s[t]=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top dropdown-manual",caption:Common.Locale.get("textMoreButton",{name:"Common.Translation",default:"More"}),iconCls:"toolbar__icon btn-big-more",enableToggle:!0}),s[t].render(a.find(".slot-btn-more")),s[t].on("toggle",(function(t,e,o){e?i.onMoreShow(t,o):i.onMoreHide(t,o),Common.NotificationCenter.trigger("more:toggle",t,e)}));var r=$('<div class="dropdown-menu more-container" data-tab="'+t+'"><div style="display: inline;"></div></div>');o.$bar.append(r),s[t].panel=r.find("div")}this.$moreBar=s[t].panel},repaintMoreBtns:function(){for(var t in s)if(s[t]&&s[t].cmpEl){var e=s[t].cmpEl.closest(".more-box");e.css("top",Common.Utils.getPosition(e.parent()).top)}},clearMoreButton:function(t){var e=this.$panels.filter("[data-tab="+t+"]");if(e.length){var i=e.data();i.buttons=i.flex=i.rightedge=i.leftedge=void 0,e.find(".more-box").remove()}s[t]&&(o.$bar.find('.more-container[data-tab="'+t+'"]').remove(),s[t].remove(),delete s[t])},clearActiveData:function(t){var e=t?this.$panels.filter("[data-tab="+t+"]"):this.$panels.filter(".active");if(e.length){var i=e.data();i.buttons=i.flex=i.rightedge=i.leftedge=void 0}},addCustomControls:function(t,e,i){if(t.action){var o=t.action?this.getTab(t.action)||this.createTab(t,!0)||this.getTab("plugins"):null,n=this.getMorePanel(t.action),a=o?o.find(".more-box"):null,r="";a.length<1&&(a=null),o&&(i&&(i.forEach((function(e,i){if(e.cmpEl){var o=e.cmpEl.closest(".group");if(e.cmpEl.closest(".btn-slot").remove(),o.children().length<1){var r=o.closest(".more-container").length>0;r?o.next(".separator").remove():o.prev(".separator").remove(),o.remove(),r&&0===n.children().filter(".group").length&&(s[t.action]&&s[t.action].isActive()&&s[t.action].toggle(!1),a&&a.css("display","none"))}}})),o.find(".btn-slot:not(.slot-btn-more).x-huge").last().hasClass("compactwidth")&&(r="compactwidth")),e&&e.forEach((function(t,e){var i,s;if(n&&(i=n.children().filter(".group")).length>0&&(a=null,o=n,r="compactwidth"),(!i||i.length<1)&&(i=o.children().filter(".group")),i.length>0&&!t.options.separator&&e>0)s=$(i[i.length-1]);else{if(t.options.separator){var l=$('<div class="separator long"></div>');a?a.before(l):l.appendTo(o)}s=$('<div class="group"></div>'),a?a.before(s):s.appendTo(o)}var c=$('<span class="btn-slot text x-huge '+((t.options.caption||"").trim()?" ":"nocaption ")+r+'"></span>').appendTo(s);t.render(c)}))),this.clearActiveData(t.action),this.processPanelVisible(null,!0);var l=!this.isTabEmpty(t.action)&&Common.UI.LayoutManager.isElementVisible("toolbar-"+t.action);this.setVisible(t.action,l),!l&&this.isTabActive(t.action)&&this.isExpanded()&&(this.getTab("home")?this.setTab("home"):(t=this.$tabs.siblings(":not(.x-lone):visible").first().find("> a[data-tab]").data("tab"),this.setTab(t)))}},isTabEmpty:function(t){var e=this.getTab(t),i=this.getMorePanel(t),o=e?e.find(".more-box"):null;return o.length<1&&(o=null),!!e&&!(e.find("> .group").length>0||i&&i.find(".group").length>0)},resizeToolbar:function(t){var e=this.$panels.filter(".active"),i=e.find(".more-box");0===i.length&&this.setMoreButton(e.attr("data-tab"),e);var o=parseInt(i.css("width"))||0,n=e.parents(".box-controls").width(),s=e.parents(".box-controls").find(".panel.static").outerWidth(),a=n;s||(s=0);var r=e.outerWidth()+s,l=this._prevBoxWidth?a-this._prevBoxWidth:-1,c=!1;if(this._prevBoxWidth=a,i.is(":visible")&&(a-=o),this.$moreBar&&this.$moreBar.parent().is(":visible")&&this.$moreBar.parent().css("max-width",Common.Utils.innerWidth()),(t||l<0)&&r>a){i.is(":visible")||(i.css("display","block"),a-=parseInt(i.css("width")));var h=null,d=null;(A=this.$moreBar.children().filter("[data-hidden-tb-item!=true]")).length>0&&((A=$(A[0])).hasClass("separator")&&(h=A),A.hasClass("group")&&"open"==A.attr("group-state")&&(d=A));for(var m=!1,p=(y=e.find("> div:not(.more-box)")).length-1;p>=0;p--){if((x=$(y[p])).is(":visible")||x.attr("hidden-on-resize"))if(x.hasClass("group")){if((r=e.outerWidth()+s)<=a)break;var u=Common.Utils.getBoundingClientRect(x.get(0)),g=x.outerWidth(),f=x.children();if(!x.attr("inner-width")&&"open"!==x.attr("group-state")){x.attr("inner-width",g);for(var b=f.length-1;b>=0;b--){(T=$(f[b])).attr("inner-width",T.outerWidth())}}if((u.left>a||Common.UI.isRTL()&&n-u.right>a||1==f.length)&&"open"!=x.attr("group-state"))this.$moreBar.prepend(x),h&&(h.css("display",""),h.removeAttr("hidden-on-resize")),c=!0;else{if(!((Common.UI.isRTL()?n-u.right:u.left)+g>a))break;for(b=f.length-1;b>=0;b--){if((T=$(f[b])).hasClass("elset")){this.$moreBar.prepend(x),h&&(h.css("display",""),h.removeAttr("hidden-on-resize")),c=!0;break}var C=Common.Utils.getBoundingClientRect(T.get(0)),v=T.outerWidth();if(!((Common.UI.isRTL()?n-C.right:C.left)+v>a)){m=!0;break}if(!d){(d=$("<div></div>")).addClass(y[p].className);for(var _=y[p].attributes,w=0;w<_.length;w++)d.attr(_[w].name,_[w].value);this.$moreBar.prepend(d),h&&(h.css("display",""),h.removeAttr("hidden-on-resize"))}d.prepend(T),c=!0}if(x.children().length<1?(x.remove(),d&&d.removeAttr("group-state").attr("inner-width",x.attr("inner-width")),d=null):d&&d.attr("group-state","open")&&x.attr("group-state","open"),m)break}h=null}else x.hasClass("separator")&&(this.$moreBar.prepend(x),x.css("display","none"),x.attr("hidden-on-resize",!0),h=x,c=!0);else x.attr("data-hidden-tb-item",!0),this.$moreBar.prepend(x),c=!0}}else if((t||l>0)&&i.is(":visible")){h=null,d=null;var A,y,S=0;if((A=e.find("> div:not(.more-box)")).length>0&&((A=$(A[A.length-1])).hasClass("separator")&&(h=A,S=parseInt(h.css("margin-left"))+parseInt(h.css("margin-right"))+1),A.hasClass("group")&&"open"==A.attr("group-state")&&(d=A)),(y=this.$moreBar.children()).length>0)for(p=0;p<y.length;p++){var x=$(y[p]);if(r=e.outerWidth()+s,!x.is(":visible")&&x.attr("data-hidden-tb-item"))x.removeAttr("data-hidden-tb-item"),i.before(x),0==this.$moreBar.children().filter(".group").length&&(this.hideMoreBtns(),i.css("display","none"));else if(x.hasClass("group")){var k=!1;if(1==this.$moreBar.children().filter(".group").length&&(a=n,k=!0),r+S+(g=parseInt(x.attr("inner-width")||0))<a&&"open"!=x.attr("group-state"))i.before(x),h&&(h.css("display",""),h.removeAttr("hidden-on-resize")),0==this.$moreBar.children().filter(".group").length&&(this.hideMoreBtns(),i.css("display","none")),c=!0;else{if(!(r+S<a))break;f=x.children();a=n-o;for(b=0;b<f.length;b++){var T;if(k&&b==f.length-1&&(a=n),r=e.outerWidth()+s,(T=$(f[b])).hasClass("elset")){m=!0;break}if(!(r+S+(v=parseInt(T.attr("inner-width")||0)+(d?0:parseInt(x.css("padding-left"))))<a)){m=!0;break}if(!d){(d=$("<div></div>")).addClass(y[p].className);for(_=y[p].attributes,w=0;w<_.length;w++)d.attr(_[w].name,_[w].value);d.hasClass("flex")&&(e.data().flex=null),i.before(d),h&&(h.css("display",""),h.removeAttr("hidden-on-resize"))}d.append(T),c=!0}if(x.children().length<1?(x.remove(),d&&d.removeAttr("group-state").attr("inner-width",x.attr("inner-width")),d=null,0==this.$moreBar.children().filter(".group").length&&(this.hideMoreBtns(),i.css("display","none"))):d&&d.attr("group-state","open")&&x.attr("group-state","open"),m)break}h=null,S=0}else x.hasClass("separator")&&(i.before(x),x.css("display","none"),x.attr("hidden-on-resize",!0),h=x,S=parseInt(h.css("margin-left"))+parseInt(h.css("margin-right"))+1,c=!0)}else this.hideMoreBtns(),i.css("display","none")}c&&Common.UI.Menu.Manager.hideAll()},onMoreHide:function(t,e){var i=t.panel.parent();t.pressed&&t.toggle(!1,!0),i.is(":visible")&&(i.hide(),Common.NotificationCenter.trigger("edit:complete",this.toolbar,t))},onMoreShow:function(t,e){var i=t.panel.parent(),o=Common.Utils.getOffset(i.parent()),n=t.$el,s=Common.Utils.getOffset(n),a=Common.Utils.innerWidth()-(s.left-o.left+n.width()),r=s.top-o.top+n.height()+10,l=Common.UI.isRTL()?{left:"6px",right:"auto",top:r,"max-width":Common.Utils.innerWidth()+"px"}:{right:a,left:"auto",top:r,"max-width":Common.Utils.innerWidth()+"px"};i.css(l),i.show()},hideMoreBtns:function(){for(var t in s)s[t]&&s[t].isActive()&&s[t].toggle(!1)}}}())})),define("spreadsheeteditor/main/app/view/Toolbar",["backbone","text!spreadsheeteditor/main/app/template/Toolbar.template","text!spreadsheeteditor/main/app/template/ToolbarAnother.template","text!spreadsheeteditor/main/app/template/ToolbarView.template","common/main/lib/collection/Fonts","common/main/lib/component/Button","common/main/lib/component/ComboBox","common/main/lib/component/DataView","common/main/lib/component/ColorPalette","common/main/lib/component/ThemeColorPalette","common/main/lib/component/Menu","common/main/lib/component/DimensionPicker","common/main/lib/component/UpDownPicker","common/main/lib/component/Window","common/main/lib/component/ComboBoxFonts","common/main/lib/component/ComboDataView","common/main/lib/component/SynchronizeTip","common/main/lib/component/Mixtbar"],(function(t,e,i,o){"use strict";Common.enumLock||(Common.enumLock={});var n={editCell:"cell-editing",editFormula:"is-formula",editText:"is-text",editPivot:"is-pivot",selImage:"sel-image",selShape:"sel-shape",selShapeText:"sel-shape-txt",selChart:"sel-chart",selChartText:"sel-chart-txt",selRange:"sel-range",selRangeEdit:"sel-range-edit",lostConnect:"disconnect",coAuth:"co-auth",coAuthText:"co-auth-text",ruleMerge:"rule-btn-merge",ruleFilter:"rule-filter",ruleDelFilter:"rule-clear-filter",menuFileOpen:"menu-file-open",cantPrint:"cant-print",multiselect:"is-multiselect",cantHyperlink:"cant-hyperlink",commentLock:"can-comment",cantModifyFilter:"cant-filter",disableOnStart:"on-start",cantGroup:"cant-group",cantGroupUngroup:"cant-group-ungroup",docPropsLock:"doc-props-lock",printAreaLock:"print-area-lock",namedRangeLock:"named-range-lock",multiselectCols:"is-multiselect-cols",headerLock:"header-lock",sheetLock:"sheet-lock",noPivot:"no-pivot",noSubitems:"no-subitems",noSlicerSource:"no-slicer-source",selSlicer:"sel-slicer",cantSort:"cant-sort",pivotLock:"pivot-lock",pivotExpandLock:"pivot-expand-lock",pivotCalcItemsLock:"pivot-calculated-items-lock",tableHasSlicer:"table-has-slicer",sheetView:"sheet-view",wbLock:"workbook-lock",wsLock:"worksheet-lock",itemsDisabled:"all-items-disabled",wsLockText:"worksheet-lock-text",wsLockShape:"worksheet-lock-shape",wsLockFormat:"worksheet-lock-format",inSmartartInternal:"in-smartart-internal",wsLockFormatFill:"worksheet-lock-format-fill",editVisibleArea:"is-visible-area",userProtected:"cell-user-protected",pageBreakLock:"page-break-lock",fileMenuOpened:"file-menu-opened",cantMergeShape:"merge-shape-lock",cantSave:"cant-save"};for(var s in n)n.hasOwnProperty(s)&&(Common.enumLock[s]=n[s]);SSE.Views.Toolbar=Common.UI.Mixtbar.extend(_.extend({el:"#toolbar",template:_.template(e),events:{},initialize:function(){var t=this;return t._state={hasCollaborativeChanges:void 0},t.btnSaveCls="btn-save",t.btnSaveTip=this.tipSave+Common.Utils.String.platformKey("Ctrl+S"),t.ascFormatOptions={General:"General",Number:"0.00",Currency:"$#,##0.00",Accounting:'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)',DateShort:"m/d/yyyy",DateLong:"[$-F800]dddd, mmmm dd, yyyy",Time:"[$-F400]h:mm:ss AM/PM",Percentage:"0.00%",Percent:"0%",Fraction:"# ?/?",Scientific:"0.00E+00",Text:"@"},t.numFormatData=[{value:Asc.c_oAscNumFormatType.General,format:this.ascFormatOptions.General,displayValue:this.txtGeneral,exampleval:"100"},{value:Asc.c_oAscNumFormatType.Number,format:this.ascFormatOptions.Number,displayValue:this.txtNumber,exampleval:"100,00"},{value:Asc.c_oAscNumFormatType.Scientific,format:this.ascFormatOptions.Scientific,displayValue:this.txtScientific,exampleval:"1,00E+02"},{value:Asc.c_oAscNumFormatType.Accounting,format:this.ascFormatOptions.Accounting,displayValue:this.txtAccounting,exampleval:"100,00 $"},{value:Asc.c_oAscNumFormatType.Currency,format:this.ascFormatOptions.Currency,displayValue:this.txtCurrency,exampleval:"100,00 $"},{value:Asc.c_oAscNumFormatType.Date,format:"MM-dd-yyyy",displayValue:this.txtDateShort,exampleval:"04-09-1900",customDisplayValue:this.txtDate},{value:Asc.c_oAscNumFormatType.Date,format:"MMMM d yyyy",displayValue:this.txtDateLong,exampleval:"April 9 1900",customDisplayValue:this.txtDate},{value:Asc.c_oAscNumFormatType.Time,format:"HH:MM:ss",displayValue:this.txtTime,exampleval:"00:00:00"},{value:Asc.c_oAscNumFormatType.Percent,format:this.ascFormatOptions.Percentage,displayValue:this.txtPercentage,exampleval:"100,00%"},{value:Asc.c_oAscNumFormatType.Fraction,format:this.ascFormatOptions.Fraction,displayValue:this.txtFraction,exampleval:"100"},{value:Asc.c_oAscNumFormatType.Text,format:this.ascFormatOptions.Text,displayValue:this.txtText,exampleval:"100"}],Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),this},onUpdateLastCustomMargins:function(t){if(this.btnPageMargins){var e=t?t.asc_getTop():Common.localStorage.getItem("sse-pgmargins-top"),i=t?t.asc_getLeft():Common.localStorage.getItem("sse-pgmargins-left"),o=t?t.asc_getBottom():Common.localStorage.getItem("sse-pgmargins-bottom"),n=t?t.asc_getRight():Common.localStorage.getItem("sse-pgmargins-right");if(null!==e&&null!==i&&null!==o&&null!==n){var s=this.btnPageMargins.menu.items[0];s.options.value=s.value=[parseFloat(e),parseFloat(i),parseFloat(o),parseFloat(n)],s.setVisible(!0),$(s.el).html(s.template({id:Common.UI.getId(),caption:s.caption,options:s.options}))}else this.btnPageMargins.menu.items[0].setVisible(!1)}},lockToolbar:function(t,e,i){Common.Utils.lockControls(t,e,i,this.lockControls)},applyLayout:function(t){var n=this;var s=Common.enumLock;if(n.btnCopy=new Common.UI.Button({id:"id-toolbar-btn-copy",cls:"btn-toolbar",iconCls:"toolbar__icon btn-copy",dataHint:"1",dataHintDirection:t.isEditDiagram||t.isEditMailMerge||t.isEditOle?"bottom":"top",dataHintTitle:"C"}),n.btnPaste=new Common.UI.Button({id:"id-toolbar-btn-paste",cls:"btn-toolbar",iconCls:"toolbar__icon btn-paste",lock:[s.coAuth,s.lostConnect,s.editVisibleArea,s.userProtected],dataHint:"1",dataHintDirection:t.isEditDiagram||t.isEditMailMerge||t.isEditOle?"bottom":"top",dataHintTitle:"V"}),n.btnUndo=new Common.UI.Button({id:"id-toolbar-btn-undo",cls:"btn-toolbar",iconCls:"toolbar__icon btn-undo icon-rtl",disabled:!0,lock:[s.lostConnect],signals:["disabled"],dataHint:"1",dataHintDirection:"bottom",dataHintTitle:"Z"}),n.btnRedo=new Common.UI.Button({id:"id-toolbar-btn-redo",cls:"btn-toolbar",iconCls:"toolbar__icon btn-redo icon-rtl",disabled:!0,lock:[s.lostConnect],signals:["disabled"],dataHint:"1",dataHintDirection:"bottom",dataHintTitle:"Y"}),t.isEditDiagram||t.isEditMailMerge||t.isEditOle){if(n.$el.addClass("type-simple"),n.$layout=$(_.template(i)(t)),t.isEditDiagram||t.isEditOle){n.btnInsertFormula=new Common.UI.Button({id:"id-toolbar-btn-insertformula",cls:"btn-toolbar",iconCls:"toolbar__icon btn-formula",split:!0,lock:[s.editText,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selRangeEdit,s.lostConnect,s.coAuth,s.editVisibleArea],menu:new Common.UI.Menu({style:"min-width: 110px",items:[{caption:"SUM",value:"SUM"},{caption:"AVERAGE",value:"AVERAGE"},{caption:"MIN",value:"MIN"},{caption:"MAX",value:"MAX"},{caption:"COUNT",value:"COUNT"},{caption:"--"},{caption:n.txtAdditional,value:"more",hint:n.txtFormula+Common.Utils.String.platformKey("Shift+F3")}]}),dataHint:"1",dataHintDirection:"bottom"});var a=_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">','<div style="position: relative;"><div class="display-value"><%= scope.getDisplayValue(item) %></div>','<div class="example-val"><%= item.exampleval ? Common.Utils.String.htmlEncode(item.exampleval) : "" %></div>',"</div></a></li>","<% }); %>",'<li class="divider">','<li id="id-toolbar-mnu-item-more-formats" data-value="-1"><a tabindex="-1" type="menuitem">'+n.textMoreFormats+"</a></li>"].join(""));n.cmbNumberFormat=new Common.UI.ComboBoxCustom({cls:"input-group-nr",menuStyle:"min-width: 180px;",menuCls:"menu-absolute",hint:n.tipNumFormat,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selRangeEdit,s.lostConnect,s.coAuth,s.editVisibleArea],itemsTemplate:a,editable:!1,focusWhenNoSelection:!1,data:n.numFormatData,dataHint:"1",dataHintDirection:"bottom",updateFormControl:function(t){this.clearSelection(),t&&this.setRawValue(t.get("customDisplayValue")||t.get("displayValue"))}})}(t.isEditMailMerge||t.isEditOle)&&(n.btnSearch=new Common.UI.Button({id:"id-toolbar-btn-search",cls:"btn-toolbar",iconCls:"toolbar__icon btn-menu-search",lock:[s.lostConnect],enableToggle:!0,dataHint:"1",dataHintDirection:"bottom"})),t.isEditDiagram&&(n.btnDecDecimal=new Common.UI.Button({id:"id-toolbar-btn-decdecimal",cls:"btn-toolbar",iconCls:"toolbar__icon btn-decdecimal",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.editVisibleArea],dataHint:"1",dataHintDirection:"bottom"}),n.btnIncDecimal=new Common.UI.Button({id:"id-toolbar-btn-incdecimal",cls:"btn-toolbar",iconCls:"toolbar__icon btn-incdecimal",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.editVisibleArea],dataHint:"1",dataHintDirection:"bottom"}),n.btnEditChart=new Common.UI.Button({id:"id-toolbar-rtn-edit-chart",cls:"btn-toolbar btn-text-default auto",caption:n.tipEditChart,lock:[s.lostConnect],style:"min-width: 120px;",dataHint:"1",dataHintDirection:"bottom"}),n.btnEditChartData=new Common.UI.Button({id:"id-toolbar-rtn-edit-chart-data",cls:"btn-toolbar",iconCls:"toolbar__icon btn-select-range",caption:n.tipEditChartData,lock:[s.editCell,s.selRange,s.selRangeEdit,s.lostConnect],dataHint:"1",dataHintDirection:"left",dataHintOffset:"medium"}),n.btnEditChartType=new Common.UI.Button({id:"id-toolbar-rtn-edit-chart-type",cls:"btn-toolbar",iconCls:"toolbar__icon btn-menu-chart",caption:n.tipEditChartType,lock:[s.editCell,s.selRange,s.selRangeEdit,s.lostConnect],style:"min-width: 120px;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"medium"})),t.isEditMailMerge&&(n.btnSortDown=new Common.UI.Button({id:"id-toolbar-btn-sort-down",cls:"btn-toolbar",iconCls:"toolbar__icon btn-sort-down",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.ruleFilter,s.editPivot,s.editVisibleArea],dataHint:"1",dataHintDirection:"bottom"}),n.btnSortUp=new Common.UI.Button({id:"id-toolbar-btn-sort-up",cls:"btn-toolbar",iconCls:"toolbar__icon btn-sort-up",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.ruleFilter,s.editPivot,s.editVisibleArea],dataHint:"1",dataHintDirection:"bottom"}),n.btnSetAutofilter=new Common.UI.Button({id:"id-toolbar-btn-setautofilter",cls:"btn-toolbar",iconCls:"toolbar__icon btn-autofilter",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.ruleFilter,s.editPivot,s.editVisibleArea],enableToggle:!0,dataHint:"1",dataHintDirection:"bottom"}),n.btnClearAutofilter=new Common.UI.Button({id:"id-toolbar-btn-clearfilter",cls:"btn-toolbar",iconCls:"toolbar__icon btn-clear-filter",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.ruleDelFilter,s.editPivot,s.editVisibleArea],dataHint:"1",dataHintDirection:"bottom"})),t.isEditOle&&(n.cmbFontSize=new Common.UI.ComboBox({cls:"input-group-nr",menuStyle:"min-width: 55px;",menuCls:"menu-absolute",hint:n.tipFontSize,lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.editVisibleArea],data:[{value:8,displayValue:"8"},{value:9,displayValue:"9"},{value:10,displayValue:"10"},{value:11,displayValue:"11"},{value:12,displayValue:"12"},{value:14,displayValue:"14"},{value:16,displayValue:"16"},{value:18,displayValue:"18"},{value:20,displayValue:"20"},{value:22,displayValue:"22"},{value:24,displayValue:"24"},{value:26,displayValue:"26"},{value:28,displayValue:"28"},{value:36,displayValue:"36"},{value:48,displayValue:"48"},{value:72,displayValue:"72"},{value:96,displayValue:"96"}],dataHint:"1",dataHintDirection:"bottom"}),n.cmbFontName=new Common.UI.ComboBoxFonts({cls:"input-group-nr",menuCls:"scrollable-menu menu-absolute",menuStyle:"min-width: 325px;",hint:n.tipFontName,lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.editVisibleArea],store:new Common.Collections.Fonts,recent:0,dataHint:"1",dataHintDirection:"bottom"}),n.btnWrap=new Common.UI.Button({id:"id-toolbar-rtn-wrap",cls:"btn-toolbar",iconCls:"toolbar__icon btn-wrap",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells,s.editVisibleArea],enableToggle:!0,allowDepress:!0,dataHint:"1",dataHintDirection:"bottom"}),n.btnMerge=new Common.UI.Button({id:"id-toolbar-rtn-merge",cls:"btn-toolbar",iconCls:"toolbar__icon btn-merge-and-center",enableToggle:!0,allowDepress:!0,split:!0,lock:[s.editCell,s.selShape,s.selShapeText,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.ruleMerge,s.editPivot,s.wsLock,s.editVisibleArea],menu:new Common.UI.Menu({items:[{caption:n.txtMergeCenter,iconCls:"menu__icon btn-merge-and-center",value:Asc.c_oAscMergeOptions.MergeCenter},{caption:n.txtMergeAcross,iconCls:"menu__icon btn-merge-across",value:Asc.c_oAscMergeOptions.MergeAcross},{caption:n.txtMergeCells,iconCls:"menu__icon btn-merge-cells",value:Asc.c_oAscMergeOptions.Merge},{caption:n.txtUnmerge,iconCls:"menu__icon btn-unmerge-cells",value:Asc.c_oAscMergeOptions.None}]}),dataHint:"1",dataHintDirection:"bottom"}),n.mnuTextColorPicker={isDummy:!0,on:function(){}},n.btnTextColor=new Common.UI.ButtonColored({id:"id-toolbar-btn-fontcolor",cls:"btn-toolbar",iconCls:"toolbar__icon btn-fontcolor",split:!0,lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat,s.editVisibleArea],menu:!0,auto:!0,eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom"}),n.mnuBackColorPicker={isDummy:!0,on:function(){}},n.btnBackColor=new Common.UI.ButtonColored({id:"id-toolbar-btn-fillparag",cls:"btn-toolbar",iconCls:"toolbar__icon btn-paracolor",split:!0,lock:[s.selImage,s.editCell,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormatFill,s.editVisibleArea],transparent:!0,menu:!0,eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom"}),n.btnBorders=new Common.UI.Button({id:"id-toolbar-btn-borders",cls:"btn-toolbar",iconCls:"toolbar__icon btn-border-out",icls:"btn-border-out",borderId:"outer",borderswidth:Asc.c_oAscBorderStyles.Thin,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells,s.editVisibleArea],split:!0,menu:!0,dataHint:"1",dataHintDirection:"bottom"}),n.btnTableTemplate=new Common.UI.Button({id:"id-toolbar-btn-ttempl",cls:"btn-toolbar",iconCls:"toolbar__icon btn-menu-table",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.ruleFilter,s.multiselect,s.cantModifyFilter,s.wsLock,s.editVisibleArea],menu:new Common.UI.Menu({items:[{template:_.template('<div id="id-toolbar-menu-table-templates" style="width: 487px; height: 300px; margin: 0px 4px;"></div>')}]}),dataHint:"1",dataHintDirection:"bottom"}),n.btnCellStyle=new Common.UI.Button({id:"id-toolbar-btn-cstyle",cls:"btn-toolbar",iconCls:"toolbar__icon btn-menu-cell",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.ruleFilter,s.multiselect,s.cantModifyFilter,s.wsLock,s.editVisibleArea],menu:new Common.UI.Menu({items:[{template:_.template('<div id="id-toolbar-menu-cell-styles" style="width: 645px; height: 306px; margin: 0px 4px;"></div>')}]}),dataHint:"1",dataHintDirection:"bottom"}),n.btnTextFormatting=new Common.UI.Button({id:"id-toolbar-btn-formatting",cls:"btn-toolbar no-caret",iconCls:"toolbar__icon btn-more-vertical",lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat,s.editVisibleArea],menu:new Common.UI.Menu({items:[{caption:n.textBold,iconCls:"menu__icon btn-bold",value:"bold",checkable:!0,checkmark:!1,allowDepress:!0},{caption:n.textItalic,iconCls:"menu__icon btn-italic",value:"italic",checkable:!0,checkmark:!1,allowDepress:!0},{caption:n.textUnderline,iconCls:"menu__icon btn-underline",value:"underline",checkable:!0,checkmark:!1,allowDepress:!0},{caption:n.textStrikeout,iconCls:"menu__icon btn-strikeout",value:"strikeout",checkable:!0,checkmark:!1,allowDepress:!0},{caption:n.textSuperscript,iconCls:"menu__icon btn-superscript",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"textsubscriptgroup",value:"superscript"},{caption:n.textSubscript,iconCls:"menu__icon btn-subscript",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"textsubscriptgroup",value:"subscript"}]}),dataHint:"1",dataHintDirection:"bottom"}),n.btnHorizontalAlign=new Common.UI.Button({id:"id-toolbar-btn-halign",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-left",icls:"btn-align-left",lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat,s.editVisibleArea],menu:new Common.UI.Menu({items:[{caption:n.tipAlignLeft,iconCls:"menu__icon btn-align-left",icls:"btn-align-left",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"halignGroup",checked:!0,value:AscCommon.align_Left},{caption:n.tipAlignCenter,iconCls:"menu__icon btn-align-center",icls:"btn-align-center",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"halignGroup",value:AscCommon.align_Center},{caption:n.tipAlignRight,iconCls:"menu__icon btn-align-right",icls:"btn-align-right",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"halignGroup",value:AscCommon.align_Right},{caption:n.tipAlignJust,iconCls:"menu__icon btn-align-just",icls:"btn-align-just",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"halignGroup",value:AscCommon.align_Justify}]}),dataHint:"1",dataHintDirection:"bottom"}),n.btnVerticalAlign=new Common.UI.Button({id:"id-toolbar-btn-valign",cls:"btn-toolbar",lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat,s.editVisibleArea],iconCls:"toolbar__icon btn-align-middle",icls:"btn-align-middle",menu:new Common.UI.Menu({items:[{caption:n.textAlignTop,iconCls:"menu__icon btn-align-top",icls:"btn-align-top",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"valignGroup",value:Asc.c_oAscVAlign.Top},{caption:n.textAlignMiddle,iconCls:"menu__icon btn-align-middle",icls:"btn-align-middle",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"valignGroup",value:Asc.c_oAscVAlign.Center,checked:!0},{caption:n.textAlignBottom,iconCls:"menu__icon btn-align-bottom",icls:"btn-align-bottom",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"valignGroup",value:Asc.c_oAscVAlign.Bottom}]}),dataHint:"1",dataHintDirection:"bottom"}),n.btnVisibleArea=new Common.UI.Button({id:"id-toolbar-btn-visible-area",cls:"btn-toolbar btn-icon-default",iconCls:"toolbar__icon btn-sheet-view",menu:new Common.UI.Menu({items:[{caption:n.textShowVA,value:"show"},{caption:n.textHideVA,value:"hide",visible:!1},{caption:n.textEditVA,value:"edit"}]}),lock:[s.lostConnect],dataHint:"1",dataHintDirection:"bottom"}),n.btnVisibleAreaClose=new Common.UI.Button({id:"id-toolbar-btn-visible-area-close",cls:"btn-toolbar btn-text-default auto",caption:n.textDone,lock:[s.lostConnect],visible:!1,dataHint:"1",dataHintDirection:"bottom"}))}else if(t.isEdit){Common.UI.Mixtbar.prototype.initialize.call(this,{template:_.template(e),tabs:[{caption:n.textTabFile,action:"file",extcls:"canedit",layoutname:"toolbar-file",haspanel:!1,dataHintTitle:"F"},{caption:n.textTabHome,action:"home",extcls:"canedit",dataHintTitle:"H"},{caption:n.textTabInsert,action:"ins",extcls:"canedit",dataHintTitle:"I"},{caption:n.textTabLayout,action:"layout",extcls:"canedit",layoutname:"toolbar-layout",dataHintTitle:"L"},{caption:n.textTabFormula,action:"formula",extcls:"canedit",dataHintTitle:"O"},{caption:n.textTabData,action:"data",extcls:"canedit",dataHintTitle:"D"}]}),n.btnCut=new Common.UI.Button({id:"id-toolbar-btn-cut",cls:"btn-toolbar",iconCls:"toolbar__icon btn-cut",lock:[s.coAuth,s.lostConnect,s.disableOnStart,s.userProtected],dataHint:"1",dataHintDirection:"top",dataHintTitle:"X"}),n.btnSelectAll=new Common.UI.Button({id:"id-toolbar-btn-select-all",cls:"btn-toolbar",iconCls:"toolbar__icon btn-select-all",lock:[s.disableOnStart],dataHint:"1",dataHintDirection:"bottom"}),n.btnReplace=new Common.UI.Button({id:"id-toolbar-btn-replace",cls:"btn-toolbar",iconCls:"toolbar__icon btn-replace",lock:[s.disableOnStart],dataHint:"1",dataHintDirection:"top"}),n.cmbFontSize=new Common.UI.ComboBox({cls:"input-group-nr",menuStyle:"min-width: 55px;",hint:n.tipFontSize,lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.userProtected],data:[{value:8,displayValue:"8"},{value:9,displayValue:"9"},{value:10,displayValue:"10"},{value:11,displayValue:"11"},{value:12,displayValue:"12"},{value:14,displayValue:"14"},{value:16,displayValue:"16"},{value:18,displayValue:"18"},{value:20,displayValue:"20"},{value:22,displayValue:"22"},{value:24,displayValue:"24"},{value:26,displayValue:"26"},{value:28,displayValue:"28"},{value:36,displayValue:"36"},{value:48,displayValue:"48"},{value:72,displayValue:"72"},{value:96,displayValue:"96"}],dataHint:"1",dataHintDirection:"top"}),n.cmbFontName=new Common.UI.ComboBoxFonts({cls:"input-group-nr",menuCls:"scrollable-menu",menuStyle:"min-width: 325px;",hint:n.tipFontName,lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.userProtected],store:new Common.Collections.Fonts,dataHint:"1",dataHintDirection:"top"}),n.btnPrint=new Common.UI.Button({id:"id-toolbar-btn-print",cls:"btn-toolbar",iconCls:"toolbar__icon btn-print no-mask",lock:[s.editCell,s.cantPrint,s.disableOnStart],signals:["disabled"],split:t.canQuickPrint,menu:t.canQuickPrint,dataHint:"1",dataHintDirection:"bottom",dataHintTitle:"P",printType:"print"}),n.btnSave=new Common.UI.Button({id:"id-toolbar-btn-save",cls:"btn-toolbar",iconCls:"toolbar__icon no-mask "+n.btnSaveCls,lock:[s.cantSave,s.lostConnect],signals:["disabled"],dataHint:"1",dataHintDirection:"top",dataHintTitle:"S"}),n.btnCollabChanges=n.btnSave,n.btnIncFontSize=new Common.UI.Button({id:"id-toolbar-btn-incfont",cls:"btn-toolbar",iconCls:"toolbar__icon btn-incfont",lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat,s.userProtected],dataHint:"1",dataHintDirection:"top"}),n.btnDecFontSize=new Common.UI.Button({id:"id-toolbar-btn-decfont",cls:"btn-toolbar",iconCls:"toolbar__icon btn-decfont",lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat,s.userProtected],dataHint:"1",dataHintDirection:"top"}),n.btnChangeCase=new Common.UI.Button({id:"id-toolbar-btn-case",cls:"btn-toolbar",iconCls:"toolbar__icon btn-change-case",action:"change-case",lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat,s.userProtected],menu:new Common.UI.Menu({items:[{caption:n.mniSentenceCase,value:Asc.c_oAscChangeTextCaseType.SentenceCase},{caption:n.mniLowerCase,value:Asc.c_oAscChangeTextCaseType.LowerCase},{caption:n.mniUpperCase,value:Asc.c_oAscChangeTextCaseType.UpperCase},{caption:n.mniCapitalizeWords,value:Asc.c_oAscChangeTextCaseType.CapitalizeWords},{caption:n.mniToggleCase,value:Asc.c_oAscChangeTextCaseType.ToggleCase}]}),dataHint:"1",dataHintDirection:"top"}),n.mnuChangeCase=n.btnChangeCase.menu,n.btnBold=new Common.UI.Button({id:"id-toolbar-btn-bold",cls:"btn-toolbar",iconCls:"toolbar__icon btn-bold",lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat,s.userProtected],enableToggle:!0,dataHint:"1",dataHintDirection:"bottom"}),n.btnItalic=new Common.UI.Button({id:"id-toolbar-btn-italic",cls:"btn-toolbar",iconCls:"toolbar__icon btn-italic",lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat,s.userProtected],enableToggle:!0,dataHint:"1",dataHintDirection:"bottom"}),n.btnUnderline=new Common.UI.Button({id:"id-toolbar-btn-underline",cls:"btn-toolbar",iconCls:"toolbar__icon btn-underline",lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat,s.userProtected],enableToggle:!0,dataHint:"1",dataHintDirection:"bottom"}),n.btnStrikeout=new Common.UI.Button({id:"id-toolbar-btn-strikeout",cls:"btn-toolbar",iconCls:"toolbar__icon btn-strikeout",lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat,s.userProtected],enableToggle:!0,dataHint:"1",dataHintDirection:"bottom"}),n.btnSubscript=new Common.UI.Button({id:"id-toolbar-btn-subscript",cls:"btn-toolbar",iconCls:"toolbar__icon btn-subscript",icls:"btn-subscript",split:!0,enableToggle:!0,lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat,s.userProtected],menu:new Common.UI.Menu({items:[{caption:n.textSuperscript,iconCls:"menu__icon btn-superscript",icls:"btn-superscript",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"textsubscriptgroup",value:"super"},{caption:n.textSubscript,iconCls:"menu__icon btn-subscript",icls:"btn-subscript",checkable:!0,checkmark:!1,allowDepress:!0,toggleGroup:"textsubscriptgroup",value:"sub"}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -16"}),n.mnuTextColorPicker={isDummy:!0,on:function(){}},n.btnTextColor=new Common.UI.ButtonColored({id:"id-toolbar-btn-fontcolor",cls:"btn-toolbar",iconCls:"toolbar__icon btn-fontcolor",split:!0,lock:[s.selImage,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormat,s.userProtected],menu:!0,auto:!0,eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -16"}),n.mnuBackColorPicker={isDummy:!0,on:function(){}},n.btnBackColor=new Common.UI.ButtonColored({id:"id-toolbar-btn-fillparag",cls:"btn-toolbar",iconCls:"toolbar__icon btn-paracolor",split:!0,lock:[s.selImage,s.editCell,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect,s.wsLockFormatFill,s.userProtected],transparent:!0,menu:!0,eyeDropper:!0,additionalItemsAfter:t.canBrandingExt&&t.customization&&!1===t.customization.rightMenu||!Common.UI.LayoutManager.isElementVisible("rightMenu")?[]:[n.mnuFormatCellFill=new Common.UI.MenuItem({caption:n.textFormatCellFill})],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -16"}),n.btnBorders=new Common.UI.Button({id:"id-toolbar-btn-borders",cls:"btn-toolbar",iconCls:"toolbar__icon btn-border-out",icls:"btn-border-out",borderId:"outer",borderswidth:Asc.c_oAscBorderStyles.Thin,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells,s.userProtected],split:!0,menu:!0,action:"cell-borders",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -16"}),n.btnAlignLeft=new Common.UI.Button({id:"id-toolbar-btn-align-left",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-left",enableToggle:!0,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat,s.userProtected],toggleGroup:"alignGroup",dataHint:"1",dataHintDirection:"bottom"}),n.btnAlignCenter=new Common.UI.Button({id:"id-toolbar-btn-align-center",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-center",enableToggle:!0,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat,s.userProtected],toggleGroup:"alignGroup",dataHint:"1",dataHintDirection:"bottom"}),n.btnAlignRight=new Common.UI.Button({id:"id-toolbar-btn-align-right",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-right",enableToggle:!0,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat,s.userProtected],toggleGroup:"alignGroup",dataHint:"1",dataHintDirection:"bottom"}),n.btnAlignJust=new Common.UI.Button({id:"id-toolbar-btn-align-just",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-just",enableToggle:!0,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat,s.userProtected],toggleGroup:"alignGroup",dataHint:"1",dataHintDirection:"bottom"}),n.btnMerge=new Common.UI.Button({id:"id-toolbar-rtn-merge",cls:"btn-toolbar",iconCls:"toolbar__icon btn-merge-and-center",enableToggle:!0,allowDepress:!0,split:!0,lock:[s.editCell,s.selShape,s.selShapeText,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.ruleMerge,s.editPivot,s.wsLock,s.userProtected],menu:new Common.UI.Menu({items:[{caption:n.txtMergeCenter,iconCls:"menu__icon btn-merge-and-center",value:Asc.c_oAscMergeOptions.MergeCenter},{caption:n.txtMergeAcross,iconCls:"menu__icon btn-merge-across",value:Asc.c_oAscMergeOptions.MergeAcross},{caption:n.txtMergeCells,iconCls:"menu__icon btn-merge-cells",value:Asc.c_oAscMergeOptions.Merge},{caption:n.txtUnmerge,iconCls:"menu__icon btn-unmerge-cells",value:Asc.c_oAscMergeOptions.None}]}),action:"cell-merge",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -16"}),n.btnAlignTop=new Common.UI.Button({id:"id-toolbar-rtn-valign-top",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-top",lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat,s.userProtected],enableToggle:!0,toggleGroup:"vAlignGroup",dataHint:"1",dataHintDirection:"top"}),n.btnAlignMiddle=new Common.UI.Button({id:"id-toolbar-rtn-valign-middle",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-middle",enableToggle:!0,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat,s.userProtected],toggleGroup:"vAlignGroup",dataHint:"1",dataHintDirection:"top"}),n.btnAlignBottom=new Common.UI.Button({id:"id-toolbar-rtn-valign-bottom",cls:"btn-toolbar",iconCls:"toolbar__icon btn-align-bottom",lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat,s.userProtected],enableToggle:!0,toggleGroup:"vAlignGroup",dataHint:"1",dataHintDirection:"top"}),n.btnWrap=new Common.UI.Button({id:"id-toolbar-rtn-wrap",cls:"btn-toolbar",iconCls:"toolbar__icon btn-wrap",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells,s.userProtected],enableToggle:!0,allowDepress:!0,dataHint:"1",dataHintDirection:"top"}),n.btnTextOrient=new Common.UI.Button({id:"id-toolbar-rtn-textorient",cls:"btn-toolbar",iconCls:"toolbar__icon btn-text-orient-ccw",lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.coAuthText,s.wsLockFormat,s.userProtected],menu:new Common.UI.Menu({cls:"shifted-right",items:[{caption:n.textHorizontal,iconCls:"menu__icon btn-text-orient-hor",checkable:!0,checkmark:!1,toggleGroup:"textorientgroup",value:"horiz"},{caption:n.textCounterCw,iconCls:"menu__icon btn-text-orient-ccw",checkable:!0,checkmark:!1,toggleGroup:"textorientgroup",value:"countcw"},{caption:n.textClockwise,iconCls:"menu__icon btn-text-orient-cw",checkable:!0,checkmark:!1,toggleGroup:"textorientgroup",value:"clockwise"},{caption:n.textVertical,iconCls:"menu__icon btn-text-orient-vertical",checkable:!0,checkmark:!1,toggleGroup:"textorientgroup",value:"vertical"},{caption:n.textRotateUp,iconCls:"menu__icon btn-text-orient-rup",checkable:!0,checkmark:!1,toggleGroup:"textorientgroup",value:"rotateup"},{caption:n.textRotateDown,iconCls:"menu__icon btn-text-orient-rdown",checkable:!0,checkmark:!1,toggleGroup:"textorientgroup",value:"rotatedown"}].concat(t.canBrandingExt&&t.customization&&!1===t.customization.rightMenu||!Common.UI.LayoutManager.isElementVisible("rightMenu")?[]:[{caption:"--"},{caption:this.textCellAlign,value:"options"}])}),action:"text-orientation",dataHint:"1",dataHintDirection:"top"}),n.btnInsertImage=new Common.UI.Button({id:"tlbtn-insertimage",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-insertimage",caption:n.capInsertImage,lock:[s.editCell,s.lostConnect,s.coAuth,s.Objects],menu:new Common.UI.Menu({items:[{caption:n.mniImageFromFile,value:"file"},{caption:n.mniImageFromUrl,value:"url"},{caption:n.mniImageFromStorage,value:"storage"}]}),action:"insert-image",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnInsertHyperlink=new Common.UI.Button({id:"tlbtn-insertlink",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-big-inserthyperlink",caption:n.capInsertHyperlink,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selShape,s.cantHyperlink,s.selSlicer,s.multiselect,s.lostConnect,s.coAuth,s.editPivot,s.InsertHyperlinks,s.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnInsertChart=new Common.UI.Button({id:"tlbtn-insertchart",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-insertchart",lock:[s.editCell,s.lostConnect,s.coAuth,s.coAuthText,s.Objects],caption:n.capInsertChart,menu:!0,action:"insert-chart",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnInsertChartRecommend=new Common.UI.Button({id:"tlbtn-insertchartrecommend",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-recommended-chart",lock:[s.editCell,s.lostConnect,s.coAuth,s.coAuthText,s.Objects],caption:n.capInsertChartRecommend,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnInsertSparkline=new Common.UI.Button({id:"tlbtn-insertsparkline",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-sparkline",lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selShape,s.selSlicer,s.multiselect,s.lostConnect,s.coAuth,s.coAuthText,s.editPivot,s.wsLock,s.userProtected],caption:n.capInsertSpark,menu:!0,action:"insert-sparkline",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.btnInsertSmartArt=new Common.UI.Button({id:"tlbtn-insertsmartart",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-smart-art",lock:[s.editCell,s.lostConnect,s.coAuth,s.Objects],caption:n.capBtnInsSmartArt,menu:!0,action:"insert-smartart",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnInsertShape=new Common.UI.Button({id:"tlbtn-insertshape",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-insertshape",enableToggle:!0,caption:n.capInsertShape,lock:[s.editCell,s.lostConnect,s.coAuth,s.Objects],menu:new Common.UI.Menu({cls:"menu-shapes menu-insert-shape"}),action:"insert-shape",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnInsertText=new Common.UI.Button({id:"tlbtn-inserttext",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-big-text",caption:n.capInsertText,lock:[s.editCell,s.lostConnect,s.coAuth,s.Objects],enableToggle:!0,split:!0,action:"insert-text",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small",textboxType:"textRect"}),n.btnInsertTextArt=new Common.UI.Button({id:"tlbtn-inserttextart",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-textart",caption:n.capInsertTextart,lock:[s.editCell,s.lostConnect,s.coAuth,s.Objects],menu:new Common.UI.Menu({cls:"menu-shapes",items:[{template:_.template('<div id="id-toolbar-menu-insart" class="margin-left-5" style="width: 239px;"></div>')}]}),action:"insert-textart",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnInsertEquation=new Common.UI.Button({id:"tlbtn-insertequation",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-insertequation",caption:n.capInsertEquation,split:!0,lock:[s.editCell,s.lostConnect,s.coAuth],menu:new Common.UI.Menu,action:"insert-equation",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnInsertSymbol=new Common.UI.Button({id:"tlbtn-insertsymbol",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-symbol",caption:n.capBtnInsSymbol,lock:[s.selImage,s.selChart,s.selShape,s.editFormula,s.selRangeEdit,s.selSlicer,s.coAuth,s.coAuthText,s.lostConnect],menu:new Common.UI.Menu({style:"min-width: 100px;",items:[{template:_.template('<div id="id-toolbar-menu-symbols"></div>')},{caption:"--"},new Common.UI.MenuItem({caption:this.textMoreSymbols})]}),action:"insert-symbol",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnInsertSlicer=new Common.UI.Button({id:"tlbtn-insertslicer",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-big-slicer",caption:n.capBtnInsSlicer,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.multiselect,s.noSlicerSource,s.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnTableTemplate=new Common.UI.Button({id:"id-toolbar-btn-ttempl",cls:"btn-toolbar",iconCls:"toolbar__icon btn-menu-table",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.ruleFilter,s.multiselect,s.cantModifyFilter,s.wsLock,s.userProtected],menu:new Common.UI.Menu({items:[{template:_.template('<div id="id-toolbar-menu-table-templates" style="width: 487px; height: 300px; margin: 0px 4px;"></div>')}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -6"}),n.btnInsertTable=new Common.UI.Button({id:"tlbtn-inserttable",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-inserttable",caption:n.capInsertTable,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.ruleFilter,s.multiselect,s.cantModifyFilter,s.ruleMerge,s.editPivot,s.wsLock,s.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.listStyles=new Common.UI.ComboDataView({cls:"combo-cell-styles",enableKeyEvents:!0,itemWidth:100,itemHeight:20,style:"min-width:135px; max-width: 660px;",groups:new Common.UI.DataViewGroupStore,menuMaxHeight:380,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells,s.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"-16, -4",delayRenderTips:!0,autoWidth:!0,beforeOpenHandler:function(t){var e=this,i=e.openButton.menu;if(i.cmpEl){var o=$(i.menuRoot.find(".dataview .item").get(0)),n=$(i.menuRoot.find(".dataview .group-items-container").get(0)),s=parseFloat(o.css("margin-left"))+parseFloat(o.css("margin-right"));Common.Utils.applicationPixelRatio()>1&&Common.Utils.applicationPixelRatio()<2&&(s=-1/Common.Utils.applicationPixelRatio());var a=o.is(":visible")?parseFloat(o.css("width")):e.itemWidth+parseFloat(o.css("padding-left"))+parseFloat(o.css("padding-right"))+parseFloat(o.css("border-left-width"))+parseFloat(o.css("border-right-width"));i.menuAlignEl=e.cmpEl,i.menuAlign="tl-tl";var r=$(i.menuRoot.find(".menu-picker-container").get(0)),l=15+parseFloat(n.css("padding-left"))+parseFloat(n.css("padding-right"))+parseFloat(r.css("margin-left"))+parseFloat(r.css("margin-right")),c=Math.ceil(6*(a+s)+l),h=Common.Utils.getOffset(e.openButton.$el).left;c>Common.Utils.innerWidth()&&(c=Math.max(Math.floor((Common.Utils.innerWidth()-l)/(s+a)),2)*(s+a)+l);var d=e.cmpEl.width()-e.openButton.$el.width()-Math.min(c,h)-1;Common.UI.isRTL()&&(d=e.openButton.$el.width()),i.setOffset(Common.UI.isRTL()?d:Math.min(d,0)),i.cmpEl.css({width:c,"min-height":e.cmpEl.height()})}}});a=_.template(["<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">','<div style="position: relative;"><div class="display-value"><%= scope.getDisplayValue(item) %></div>','<div class="example-val"><%= item.exampleval ? Common.Utils.String.htmlEncode(item.exampleval) : "" %></div>',"</div></a></li>","<% }); %>",'<li class="divider">','<li id="id-toolbar-mnu-item-more-formats" data-value="-1"><a tabindex="-1" type="menuitem">'+n.textMoreFormats+"</a></li>"].join(""));n.cmbNumberFormat=new Common.UI.ComboBoxCustom({cls:"input-group-nr",menuStyle:"min-width: 180px;",hint:n.tipNumFormat,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.selRangeEdit,s.lostConnect,s.coAuth,s.FormatCells,s.userProtected],itemsTemplate:a,editable:!1,focusWhenNoSelection:!1,data:n.numFormatData,dataHint:"1",dataHintDirection:"top",updateFormControl:function(t){this.clearSelection(),t&&this.setRawValue(t.get("customDisplayValue")||t.get("displayValue"))}}),n.btnPercentStyle=new Common.UI.Button({id:"id-toolbar-btn-percent-style",cls:"btn-toolbar",iconCls:"toolbar__icon btn-percent-style",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells,s.userProtected],styleName:"Percent",dataHint:"1",dataHintDirection:"bottom"}),n.btnCommaStyle=new Common.UI.Button({id:"id-toolbar-btn-comma-style",cls:"btn-toolbar",iconCls:"toolbar__icon btn-comma",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells,s.userProtected],styleName:"Comma",dataHint:"1",dataHintDirection:"bottom"}),n.btnCurrencyStyle=new Common.UI.Button({id:"id-toolbar-btn-accounting-style",cls:"btn-toolbar",style:"width: 31px",iconCls:"toolbar__icon btn-currency-style",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells,s.userProtected],styleName:"Currency",split:!0,menu:new Common.UI.Menu({style:"min-width: 120px;",items:[{caption:n.txtDollar,value:1033},{caption:n.txtEuro,value:1031},{caption:n.txtPound,value:2057},{caption:n.txtRouble,value:1049},{caption:n.txtYen,value:1041},{caption:"--"},{caption:n.textMoreFormats,value:-1}]}),action:"accounting-style",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -16"}),n.btnDecDecimal=new Common.UI.Button({id:"id-toolbar-btn-decdecimal",cls:"btn-toolbar",iconCls:"toolbar__icon btn-decdecimal",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells,s.userProtected],dataHint:"1",dataHintDirection:"bottom"}),n.btnIncDecimal=new Common.UI.Button({id:"id-toolbar-btn-incdecimal",cls:"btn-toolbar",iconCls:"toolbar__icon btn-incdecimal",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.lostConnect,s.coAuth,s.FormatCells,s.userProtected],dataHint:"1",dataHintDirection:"bottom"}),n.btnInsertFormula=new Common.UI.Button({id:"id-toolbar-btn-insertformula",cls:"btn-toolbar",iconCls:"toolbar__icon btn-formula",split:!0,lock:[s.editText,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.selRangeEdit,s.lostConnect,s.coAuth,s.userProtected],menu:new Common.UI.Menu({style:"min-width: 110px",items:[{caption:"SUM",value:"SUM"},{caption:"AVERAGE",value:"AVERAGE"},{caption:"MIN",value:"MIN"},{caption:"MAX",value:"MAX"},{caption:"COUNT",value:"COUNT"},{caption:"--"},{caption:n.txtAdditional,value:"more",hint:n.txtFormula+Common.Utils.String.platformKey("Shift+F3")}]}),action:"autosum",dataHint:"1",dataHintDirection:"top",dataHintOffset:"0, -16"}),n.btnNamedRange=new Common.UI.Button({id:"id-toolbar-btn-insertrange",cls:"btn-toolbar",iconCls:"toolbar__icon btn-named-range",lock:[s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.selRangeEdit,s.wsLock],menu:new Common.UI.Menu({style:"min-width: 110px",items:[{caption:n.txtManageRange,lock:[s.editCell],value:"manage"},{caption:n.txtNewRange,lock:[s.editCell],value:"new"},{caption:n.txtPasteRange,lock:[s.userProtected],value:"paste"}]}),action:"named-ranges",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -6"}),n.btnFillNumbers=new Common.UI.Button({id:"id-toolbar-btn-fill-num",cls:"btn-toolbar",iconCls:"toolbar__icon btn-fill",lock:[s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.selRangeEdit,s.wsLock],menu:new Common.UI.Menu({style:"min-width: 110px",items:[{caption:n.textDown,value:Asc.c_oAscFillType.fillDown},{caption:n.textFillRight,value:Asc.c_oAscFillType.fillRight},{caption:n.textUp,value:Asc.c_oAscFillType.fillUp},{caption:n.textFillLeft,value:Asc.c_oAscFillType.fillLeft},{caption:"--"},{caption:n.textSeries,value:Asc.c_oAscFillType.series}]}),action:"number-fill",dataHint:"1",dataHintDirection:"top",dataHintOffset:"0, -6"}),n.btnClearStyle=new Common.UI.Button({id:"id-toolbar-btn-clear",cls:"btn-toolbar",iconCls:"toolbar__icon btn-clearstyle",lock:[s.lostConnect,s.coAuth,s.selRangeEdit,s.selSlicer,s.userProtected],menu:new Common.UI.Menu({style:"min-width: 110px",items:[{caption:n.txtClearAll,lock:[s.cantModifyFilter],value:Asc.c_oAscCleanOptions.All},{caption:n.txtClearText,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth],value:Asc.c_oAscCleanOptions.Text},{caption:n.txtClearFormat,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth,s.cantModifyFilter],value:Asc.c_oAscCleanOptions.Format},{caption:n.txtClearComments,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth],value:Asc.c_oAscCleanOptions.Comments},{caption:n.txtClearHyper,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth],value:Asc.c_oAscCleanOptions.Hyperlinks}]}),action:"clear-style",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -6"}),n.btnCopyStyle=new Common.UI.Button({id:"id-toolbar-btn-copystyle",cls:"btn-toolbar",iconCls:"toolbar__icon btn-copystyle",lock:[s.editCell,s.lostConnect,s.coAuth,s.selChart,s.selSlicer],enableToggle:!0,dataHint:"1",dataHintDirection:"bottom"}),n.btnAddCell=new Common.UI.Button({id:"id-toolbar-btn-addcell",cls:"btn-toolbar",iconCls:"toolbar__icon btn-addcell",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.itemsDisabled,s.lostConnect,s.coAuth,s.userProtected],menu:new Common.UI.Menu({items:[{caption:n.textInsRight,value:Asc.c_oAscInsertOptions.InsertCellsAndShiftRight,lock:[s.wsLock]},{caption:n.textInsDown,value:Asc.c_oAscInsertOptions.InsertCellsAndShiftDown,lock:[s.wsLock]},{caption:n.textEntireRow,value:Asc.c_oAscInsertOptions.InsertRows},{caption:n.textEntireCol,value:Asc.c_oAscInsertOptions.InsertColumns}]}),action:"add-cell",dataHint:"1",dataHintDirection:"top",dataHintOffset:"0, -6"}),n.btnDeleteCell=new Common.UI.Button({id:"id-toolbar-btn-delcell",cls:"btn-toolbar",iconCls:"toolbar__icon btn-delcell",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.itemsDisabled,s.lostConnect,s.coAuth,s.userProtected],menu:new Common.UI.Menu({items:[{caption:n.textDelLeft,value:Asc.c_oAscDeleteOptions.DeleteCellsAndShiftLeft,lock:[s.wsLock]},{caption:n.textDelUp,value:Asc.c_oAscDeleteOptions.DeleteCellsAndShiftTop,lock:[s.wsLock]},{caption:n.textEntireRow,value:Asc.c_oAscDeleteOptions.DeleteRows},{caption:n.textEntireCol,value:Asc.c_oAscDeleteOptions.DeleteColumns}]}),action:"delete-cell",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -6"}),n.btnCondFormat=new Common.UI.Button({id:"id-toolbar-btn-condformat",cls:"btn-toolbar",iconCls:"toolbar__icon btn-cond-format",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.FormatCells,s.userProtected],menu:!0,action:"conditional-format",dataHint:"1",dataHintDirection:"top",dataHintOffset:"0, -6"}),n.btnColorSchemas=new Common.UI.Button({id:"id-toolbar-btn-colorschemas",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-big-colorschemas",caption:n.capBtnColorSchemas,lock:[s.editCell,s.lostConnect,s.coAuth,s.wsLock],menu:new Common.UI.Menu({cls:"shifted-left",items:[],restoreHeight:!0}),action:"theme-colors",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"});var r=Common.localStorage.getItem("sse-hide-synch");n.showSynchTip=!(r&&1==parseInt(r)),n.btnPageOrient=new Common.UI.Button({id:"tlbtn-pageorient",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-pageorient",caption:n.capBtnPageOrient,lock:[s.docPropsLock,s.lostConnect,s.coAuth,s.editCell,s.selRangeEdit],menu:new Common.UI.Menu({cls:"ppm-toolbar",items:[{caption:n.textPortrait,iconCls:"menu__icon btn-page-portrait",checkable:!0,checkmark:!1,toggleGroup:"menuOrient",value:Asc.c_oAscPageOrientation.PagePortrait},{caption:n.textLandscape,iconCls:"menu__icon btn-page-landscape",checkable:!0,checkmark:!1,toggleGroup:"menuOrient",value:Asc.c_oAscPageOrientation.PageLandscape}]}),action:"page-orient",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"});var l=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div><b><%= caption %></b></div><% if (options.value !== null) { %><div class="margin-vertical"><label>'+this.textTop+"<%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[0]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %></label><label>"+this.textLeft+'<%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[1]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %></label></div><div class="margin-horizontal"><label>'+this.textBottom+"<%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[2]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %></label><label>"+this.textRight+"<%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[3]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %></label></div><% } %></a>");n.btnPageMargins=new Common.UI.Button({id:"tlbtn-pagemargins",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-pagemargins",caption:n.capBtnMargins,lock:[s.docPropsLock,s.lostConnect,s.coAuth,s.editCell,s.selRangeEdit],menu:new Common.UI.Menu({cls:"menu-margins",items:[{caption:n.textMarginsLast,checkable:!0,template:l,toggleGroup:"menuPageMargins"},{caption:n.textMarginsNormal,checkable:!0,template:l,toggleGroup:"menuPageMargins",value:[19.1,17.8,19.1,17.8]},{caption:n.textMarginsNarrow,checkable:!0,template:l,toggleGroup:"menuPageMargins",value:[19.1,6.4,19.1,6.4]},{caption:n.textMarginsWide,checkable:!0,template:l,toggleGroup:"menuPageMargins",value:[25.4,25.4,25.4,25.4]},{caption:"--"},{caption:n.textPageMarginsCustom,value:"advanced"}]}),action:"page-margins",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"});var c=Common.UI.isRTL()?_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div><b><%= caption %></b></div><div dir="ltr"><span dir="ltr"><%= Common.Utils.Metric.getCurrentMetricName() %> </span><span><%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[1]).toFixed(2)) %> x </span><span dir="ltr"><%= Common.Utils.Metric.getCurrentMetricName() %> </span><span dir="ltr"><%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[0]).toFixed(2)) %></span></div></a>'):_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div><b><%= caption %></b></div><div dir="ltr"><%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[0]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %> x <%= parseFloat(Common.Utils.Metric.fnRecalcFromMM(options.value[1]).toFixed(2)) %> <%= Common.Utils.Metric.getCurrentMetricName() %></div></a>');n.btnPageSize=new Common.UI.Button({id:"tlbtn-pagesize",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-pagesize",caption:n.capBtnPageSize,lock:[s.docPropsLock,s.lostConnect,s.coAuth,s.editCell,s.selRangeEdit],menu:new Common.UI.Menu({restoreHeight:!0,items:[{caption:"US Letter",subtitle:"21,59cm x 27,94cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[215.9,279.4]},{caption:"US Legal",subtitle:"21,59cm x 35,56cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[215.9,355.6]},{caption:"A4",subtitle:"21cm x 29,7cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[210,297],checked:!0},{caption:"A5",subtitle:"14,81cm x 20,99cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[148,210]},{caption:"B5",subtitle:"17,6cm x 25,01cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[176,250]},{caption:"Envelope #10",subtitle:"10,48cm x 24,13cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[104.8,241.3]},{caption:"Envelope DL",subtitle:"11,01cm x 22,01cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[110,220]},{caption:"Tabloid",subtitle:"27,94cm x 43,17cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[279.4,431.8]},{caption:"A3",subtitle:"29,7cm x 42,01cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[297,420]},{caption:"Tabloid Oversize",subtitle:"29,69cm x 45,72cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[296.9,457.2]},{caption:"ROC 16K",subtitle:"19,68cm x 27,3cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[196.8,273]},{caption:"Envelope Choukei 3",subtitle:"12cm x 23,5cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[120,235]},{caption:"Super B/A3",subtitle:"30,5cm x 48,7cm",template:c,checkable:!0,toggleGroup:"menuPageSize",value:[305,487]}]}),action:"page-size",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.mnuPageSize=n.btnPageSize.menu,n.btnPrintArea=new Common.UI.Button({id:"tlbtn-printarea",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-print-area",caption:n.capBtnPrintArea,lock:[s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.editCell,s.selRangeEdit,s.printAreaLock,s.lostConnect,s.coAuth],menu:new Common.UI.Menu({cls:"ppm-toolbar",items:[{caption:n.textSetPrintArea,lock:[s.namedRangeLock],value:Asc.c_oAscChangePrintAreaType.set},{caption:n.textClearPrintArea,value:Asc.c_oAscChangePrintAreaType.clear},{caption:n.textAddPrintArea,lock:[s.namedRangeLock],value:Asc.c_oAscChangePrintAreaType.add}]}),action:"print-area",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnPageBreak=new Common.UI.Button({id:"tlbtn-pagebreak",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-pagebreak",caption:n.capBtnPageBreak,lock:[s.docPropsLock,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selSlicer,s.editCell,s.selRangeEdit,s.pageBreakLock,s.lostConnect,s.coAuth],menu:!0,action:"page-break",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.mnuCustomScale=new Common.UI.MenuItem({template:_.template('<div id="id-toolbar-scale-updownpicker" class="custom-scale" data-stopPropagation="true"></div>'),stopPropagation:!0,value:4}),n.btnScale=new Common.UI.Button({id:"tlbtn-scale",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-scale",caption:n.capBtnScale,lock:[s.docPropsLock,s.lostConnect,s.coAuth,s.editCell,s.selRangeEdit],menu:new Common.UI.Menu({items:[],cls:"scale-menu"}),action:"page-scale",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"});var h=new Common.UI.MenuItem({caption:n.textWidth,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:this.textAuto,value:0,checkable:!0,toggleGroup:"scaleWidth"},{caption:"1 "+this.textOnePage,value:1,checkable:!0,toggleGroup:"scaleWidth"},{caption:"2 "+this.textFewPages,value:2,checkable:!0,toggleGroup:"scaleWidth"},{caption:"3 "+this.textFewPages,value:3,checkable:!0,toggleGroup:"scaleWidth"},{caption:"4 "+this.textFewPages,value:4,checkable:!0,toggleGroup:"scaleWidth"},{caption:"5 "+this.textManyPages,value:5,checkable:!0,toggleGroup:"scaleWidth"},{caption:"6 "+this.textManyPages,value:6,checkable:!0,toggleGroup:"scaleWidth"},{caption:"7 "+this.textManyPages,value:7,checkable:!0,toggleGroup:"scaleWidth"},{caption:"8 "+this.textManyPages,value:8,checkable:!0,toggleGroup:"scaleWidth"},{caption:"9 "+this.textManyPages,value:9,checkable:!0,toggleGroup:"scaleWidth"},{caption:"--"},{caption:this.textMorePages,value:"more",checkable:!0,toggleGroup:"scaleWidth"}]})}),d=new Common.UI.MenuItem({caption:n.textHeight,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:this.textAuto,value:0,checkable:!0,toggleGroup:"scaleHeight"},{caption:"1 "+this.textOnePage,value:1,checkable:!0,toggleGroup:"scaleHeight"},{caption:"2 "+this.textFewPages,value:2,checkable:!0,toggleGroup:"scaleHeight"},{caption:"3 "+this.textFewPages,value:3,checkable:!0,toggleGroup:"scaleHeight"},{caption:"4 "+this.textFewPages,value:4,checkable:!0,toggleGroup:"scaleHeight"},{caption:"5 "+this.textManyPages,value:5,checkable:!0,toggleGroup:"scaleHeight"},{caption:"6 "+this.textManyPages,value:6,checkable:!0,toggleGroup:"scaleHeight"},{caption:"7 "+this.textManyPages,value:7,checkable:!0,toggleGroup:"scaleHeight"},{caption:"8 "+this.textManyPages,value:8,checkable:!0,toggleGroup:"scaleHeight"},{caption:"9 "+this.textManyPages,value:9,checkable:!0,toggleGroup:"scaleHeight"},{caption:"--"},{caption:this.textMorePages,value:"more",checkable:!0,toggleGroup:"scaleHeight"}]})});n.btnScale.menu.addItem(h),n.btnScale.menu.addItem(d),n.btnScale.menu.addItem(n.mnuCustomScale),n.btnScale.menu.addItem({caption:"--"}),n.btnScale.menu.addItem({caption:n.textScaleCustom,value:"custom"}),n.menuWidthScale=n.btnScale.menu.items[0].menu,n.menuHeightScale=n.btnScale.menu.items[1].menu,n.mnuScale=n.btnScale.menu,n.mnuScale.on("show:after",_.bind(n.onAfterShowMenuScale,n)),n.btnPrintTitles=new Common.UI.Button({id:"tlbtn-printtitles",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-print-titles",caption:n.capBtnPrintTitles,lock:[s.docPropsLock,s.lostConnect,s.coAuth,s.editCell,s.selRangeEdit],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.chPrintGridlines=new Common.UI.CheckBox({labelText:this.textPrintGridlines,lock:[s.selRange,s.selRangeEdit,s.lostConnect,s.coAuth,s.coAuthText,s.Objects],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),n.chPrintHeadings=new Common.UI.CheckBox({labelText:this.textPrintHeadings,lock:[s.selRange,s.selRangeEdit,s.lostConnect,s.coAuth,s.coAuthText,s.Objects],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),n.btnRtlSheet=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-sheet-rtl",lock:[s.selRange,s.selRangeEdit,s.sheetLock,s.lostConnect,s.coAuth,s.editCell],caption:this.textRtlSheet,enableToggle:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnImgAlign=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-img-align",caption:n.capImgAlign,lock:[s.selRange,s.selRangeEdit,s.cantGroup,s.lostConnect,s.coAuth,s.coAuthText,s.Objects],menu:!0,action:"object-align",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnImgGroup=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-img-group",caption:n.capImgGroup,lock:[s.selRange,s.selRangeEdit,s.cantGroupUngroup,s.lostConnect,s.coAuth,s.coAuthText,s.Objects],menu:!0,action:"object-group",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnShapesMerge=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-merge-shapes",lock:[s.selRange,s.selRangeEdit,s.cantGroup,s.lostConnect,s.coAuth,s.coAuthText,s.cantMergeShape,s.Objects],caption:n.capShapesMerge,menu:!0,action:"shapes-merge",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnImgForward=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-img-frwd",caption:n.capImgForward,split:!0,lock:[s.selRange,s.selRangeEdit,s.lostConnect,s.coAuth,s.coAuthText,s.Objects,s.inSmartartInternal],menu:!0,action:"object-forward",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.btnImgBackward=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-img-bkwd",caption:n.capImgBackward,lock:[s.selRange,s.selRangeEdit,s.lostConnect,s.coAuth,s.coAuthText,s.Objects,s.inSmartartInternal],split:!0,menu:!0,action:"object-backward",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"})}else Common.UI.Mixtbar.prototype.initialize.call(this,{template:_.template(o),tabs:[{caption:n.textTabFile,action:"file",layoutname:"toolbar-file",haspanel:!1,dataHintTitle:"F"}]});return n.lockControls=[],t.isEdit&&(n.lockControls=[n.cmbFontName,n.cmbFontSize,n.btnIncFontSize,n.btnDecFontSize,n.btnChangeCase,n.btnBold,n.btnItalic,n.btnUnderline,n.btnStrikeout,n.btnSubscript,n.btnTextColor,n.btnAlignLeft,n.btnAlignCenter,n.btnAlignRight,n.btnAlignJust,n.btnAlignTop,n.btnAlignMiddle,n.btnAlignBottom,n.btnWrap,n.btnTextOrient,n.btnBackColor,n.btnInsertTable,n.btnMerge,n.btnInsertFormula,n.btnNamedRange,n.btnFillNumbers,n.btnIncDecimal,n.btnInsertShape,n.btnInsertSmartArt,n.btnInsertEquation,n.btnInsertSymbol,n.btnInsertSlicer,n.btnInsertText,n.btnInsertTextArt,n.btnSortUp,n.btnSortDown,n.btnSetAutofilter,n.btnClearAutofilter,n.btnTableTemplate,n.btnCellStyle,n.btnPercentStyle,n.btnCommaStyle,n.btnCurrencyStyle,n.btnDecDecimal,n.btnAddCell,n.btnDeleteCell,n.btnCondFormat,n.cmbNumberFormat,n.btnBorders,n.btnInsertImage,n.btnInsertHyperlink,n.btnInsertChart,n.btnInsertChartRecommend,n.btnColorSchemas,n.btnInsertSparkline,n.btnCopy,n.btnPaste,n.btnCut,n.btnSelectAll,n.btnReplace,n.listStyles,n.btnPrint,n.btnClearStyle,n.btnCopyStyle,n.btnPageMargins,n.btnPageSize,n.btnPageOrient,n.btnPrintArea,n.btnPageBreak,n.btnPrintTitles,n.btnImgAlign,n.btnImgBackward,n.btnImgForward,n.btnImgGroup,n.btnScale,n.chPrintGridlines,n.chPrintHeadings,n.btnRtlSheet,n.btnVisibleArea,n.btnVisibleAreaClose,n.btnTextFormatting,n.btnHorizontalAlign,n.btnVerticalAlign,n.btnShapesMerge],_.each(n.lockControls.concat([n.btnSave]),(function(t){t&&_.isFunction(t.setDisabled)&&t.setDisabled(!0)})),this.lockToolbar(Common.enumLock.disableOnStart,!0,{array:[n.btnPrint]}),Common.UI.LayoutManager.addControls(n.lockControls.concat([n.btnSave])),this.on("render:after",_.bind(this.onToolbarAfterRender,this))),this},onAfterShowMenuScale:function(){var t=this;t.mnuScalePicker||(t.mnuScalePicker=new Common.UI.UpDownPicker({el:$("#id-toolbar-scale-updownpicker"),caption:t.textScale}),t.mnuScalePicker.on("click",_.bind((function(e){t.fireEvent("change:scalespn",[e,t.valueCustomScale],t)}),t))),t.api&&(t.valueCustomScale=t.api.asc_getPageOptions().asc_getPageSetup().asc_getScale(),t.mnuScalePicker.setValue(t.valueCustomScale+"%")),t.itemCustomScale||(t.itemCustomScale=$(".custom-scale",t.mnuCustomScale.$el).on("click",_.bind((function(){t.fireEvent("click:customscale",["scale",void 0,void 0,void 0,t.valueCustomScale],t)}),t))),SSE.getController("Toolbar").onChangeScaleSettings()},setValueCustomScale:function(t){this.api&&null!=t&&(this.valueCustomScale=t,this.mnuScalePicker&&this.mnuScalePicker.setValue(this.valueCustomScale+"%"))},render:function(t){var e=this;return e.isCompactView=t.isCompactView,this.fireEvent("render:before",[this]),t.isEdit?e.$el.html(e.rendererComponents(e.$layout)):(e.$layout.find(".canedit").hide(),e.$layout.addClass("folded"),e.$el.html(e.$layout)),this.fireEvent("render:after",[this]),Common.UI.Mixtbar.prototype.afterRender.call(this),Common.NotificationCenter.on({"window:resize":function(){Common.UI.Mixtbar.prototype.onResize.apply(e,arguments)}}),t.isEdit&&(t.isEditDiagram||t.isEditMailMerge||t.isEditOle||(e.onUpdateLastCustomMargins(),Common.NotificationCenter.on("margins:update",_.bind(e.onUpdateLastCustomMargins,e)),this.btnInsertImage.menu.items[2].setVisible(t.canRequestInsertImage||t.fileChoiceUrl&&t.fileChoiceUrl.indexOf("{documentType}")>-1),Common.NotificationCenter.on("desktop:window",_.bind(e.onDesktopWindow,e))),e.setTab("home")),e.isCompactView&&e.setFolded(!0),this},onTabClick:function(t){var e=this,i=$(t.currentTarget).find("> a[data-tab]").data("tab"),o=e.isTabActive("file");if(e._isDocReady&&("file"!==i||Common.Controllers.LaunchController.isScriptLoaded())&&(Common.UI.Mixtbar.prototype.onTabClick.apply(e,arguments),o?e.fireEvent("file:close"):"file"==i&&(e.fireEvent("file:open"),e.setTab(i)),e.isTabActive("home")&&e.fireEvent("home:open"),e.isTabActive("pivot"))){var n=SSE.getController("PivotTable");n&&n.getView("PivotTable").fireEvent("pivot:open")}},rendererComponents:function(t){var e=$(t),i=function(t,i){Common.Utils.injectComponent(e.find(t),i)};return i("#slot-field-fontname",this.cmbFontName),i("#slot-field-fontsize",this.cmbFontSize),i("#slot-btn-print",this.btnPrint),i("#slot-btn-save",this.btnSave),i("#slot-btn-undo",this.btnUndo),i("#slot-btn-redo",this.btnRedo),i("#slot-btn-copy",this.btnCopy),i("#slot-btn-paste",this.btnPaste),i("#slot-btn-cut",this.btnCut),i("#slot-btn-select-all",this.btnSelectAll),i("#slot-btn-replace",this.btnReplace),i("#slot-btn-incfont",this.btnIncFontSize),i("#slot-btn-decfont",this.btnDecFontSize),i("#slot-btn-bold",this.btnBold),i("#slot-btn-italic",this.btnItalic),i("#slot-btn-underline",this.btnUnderline),i("#slot-btn-strikeout",this.btnStrikeout),i("#slot-btn-subscript",this.btnSubscript),i("#slot-btn-fontcolor",this.btnTextColor),i("#slot-btn-fillparag",this.btnBackColor),i("#slot-btn-borders",this.btnBorders),i("#slot-btn-align-left",this.btnAlignLeft),i("#slot-btn-align-center",this.btnAlignCenter),i("#slot-btn-align-right",this.btnAlignRight),i("#slot-btn-align-just",this.btnAlignJust),i("#slot-btn-merge",this.btnMerge),i("#slot-btn-top",this.btnAlignTop),i("#slot-btn-middle",this.btnAlignMiddle),i("#slot-btn-bottom",this.btnAlignBottom),i("#slot-btn-wrap",this.btnWrap),i("#slot-btn-text-orient",this.btnTextOrient),i("#slot-btn-insimage",this.btnInsertImage),i("#slot-btn-instable",this.btnInsertTable),i("#slot-btn-inshyperlink",this.btnInsertHyperlink),i("#slot-btn-insshape",this.btnInsertShape),i("#slot-btn-instext",this.btnInsertText),i("#slot-btn-instextart",this.btnInsertTextArt),i("#slot-btn-insequation",this.btnInsertEquation),i("#slot-btn-inssymbol",this.btnInsertSymbol),i("#slot-btn-insslicer",this.btnInsertSlicer),i("#slot-btn-sortdesc",this.btnSortDown),i("#slot-btn-sortasc",this.btnSortUp),i("#slot-btn-setfilter",this.btnSetAutofilter),i("#slot-btn-clear-filter",this.btnClearAutofilter),i("#slot-btn-table-tpl",this.btnTableTemplate),i("#slot-btn-cell-style",this.btnCellStyle),i("#slot-btn-format",this.cmbNumberFormat),i("#slot-btn-percents",this.btnPercentStyle),i("#slot-btn-comma",this.btnCommaStyle),i("#slot-btn-currency",this.btnCurrencyStyle),i("#slot-btn-digit-dec",this.btnDecDecimal),i("#slot-btn-digit-inc",this.btnIncDecimal),i("#slot-btn-formula",this.btnInsertFormula),i("#slot-btn-named-range",this.btnNamedRange),i("#slot-btn-fill-num",this.btnFillNumbers),i("#slot-btn-clear",this.btnClearStyle),i("#slot-btn-copystyle",this.btnCopyStyle),i("#slot-btn-cell-ins",this.btnAddCell),i("#slot-btn-cell-del",this.btnDeleteCell),i("#slot-btn-colorschemas",this.btnColorSchemas),i("#slot-btn-search",this.btnSearch),i("#slot-btn-inschart",this.btnInsertChart),i("#slot-btn-insrecommend",this.btnInsertChartRecommend),i("#slot-btn-inssparkline",this.btnInsertSparkline),i("#slot-btn-inssmartart",this.btnInsertSmartArt),i("#slot-field-styles",this.listStyles),i("#slot-btn-chart",this.btnEditChart),i("#slot-btn-chart-data",this.btnEditChartData),i("#slot-btn-chart-type",this.btnEditChartType),i("#slot-btn-pageorient",this.btnPageOrient),i("#slot-btn-pagemargins",this.btnPageMargins),i("#slot-btn-pagesize",this.btnPageSize),i("#slot-btn-printarea",this.btnPrintArea),i("#slot-btn-pagebreak",this.btnPageBreak),i("#slot-btn-printtitles",this.btnPrintTitles),i("#slot-chk-print-gridlines",this.chPrintGridlines),i("#slot-chk-print-headings",this.chPrintHeadings),i("#slot-btn-rtl-sheet",this.btnRtlSheet),i("#slot-img-align",this.btnImgAlign),i("#slot-img-group",this.btnImgGroup),i("#slot-img-movefrwd",this.btnImgForward),i("#slot-img-movebkwd",this.btnImgBackward),i("#slot-shapes-merge",this.btnShapesMerge),i("#slot-btn-scale",this.btnScale),i("#slot-btn-condformat",this.btnCondFormat),i("#slot-btn-visible-area",this.btnVisibleArea),i("#slot-btn-visible-area-close",this.btnVisibleAreaClose),i("#slot-btn-formatting",this.btnTextFormatting),i("#slot-btn-halign",this.btnHorizontalAlign),i("#slot-btn-valign",this.btnVerticalAlign),i("#slot-btn-changecase",this.btnChangeCase),this.btnsEditHeader=Common.Utils.injectButtons(e.find(".slot-editheader"),"tlbtn-editheader-","toolbar__icon btn-editheader",this.capBtnInsHeader,[Common.enumLock.editCell,Common.enumLock.selRangeEdit,Common.enumLock.headerLock,Common.enumLock.lostConnect,Common.enumLock.coAuth],void 0,void 0,void 0,"1","bottom","small"),Array.prototype.push.apply(this.lockControls,this.btnsEditHeader),Common.UI.LayoutManager.addControls(this.btnsEditHeader),this.btnPrint&&this.btnPrint.menu&&this.btnPrint.$el.addClass("split"),e},createDelayedElements:function(){var t,e=this;function i(t,e){t&&t.updateHint(e)}if(i(this.btnPrint,this.tipPrint+Common.Utils.String.platformKey("Ctrl+P")),i(this.btnSave,this.btnSaveTip),i(this.btnCopy,this.tipCopy+Common.Utils.String.platformKey("Ctrl+C")),i(this.btnPaste,this.tipPaste+Common.Utils.String.platformKey("Ctrl+V")),i(this.btnCut,this.tipCut+Common.Utils.String.platformKey("Ctrl+X")),i(this.btnSelectAll,this.tipSelectAll+Common.Utils.String.platformKey("Ctrl+A")),i(this.btnReplace,this.tipReplace+" ("+Common.Utils.String.textCtrl+"+H)"),i(this.btnUndo,this.tipUndo+Common.Utils.String.platformKey("Ctrl+Z")),i(this.btnRedo,this.tipRedo+Common.Utils.String.platformKey("Ctrl+Y")),i(this.btnIncFontSize,this.tipIncFont+Common.Utils.String.platformKey("Ctrl+]")),i(this.btnDecFontSize,this.tipDecFont+Common.Utils.String.platformKey("Ctrl+[")),i(this.btnChangeCase,this.tipChangeCase),i(this.btnBold,this.textBold+Common.Utils.String.platformKey("Ctrl+B")),i(this.btnItalic,this.textItalic+Common.Utils.String.platformKey("Ctrl+I")),i(this.btnUnderline,this.textUnderline+Common.Utils.String.platformKey("Ctrl+U")),i(this.btnStrikeout,this.textStrikeout),i(this.btnSubscript,this.textSubSuperscript),i(this.btnTextColor,this.tipFontColor),i(this.btnBackColor,this.tipPrColor),i(this.btnBorders,this.tipBorders),i(this.btnAlignLeft,this.tipAlignLeft),i(this.btnAlignCenter,this.tipAlignCenter),i(this.btnAlignRight,this.tipAlignRight),i(this.btnAlignJust,this.tipAlignJust),i(this.btnMerge,this.tipMerge),i(this.btnAlignTop,this.tipAlignTop),i(this.btnAlignMiddle,this.tipAlignMiddle),i(this.btnAlignBottom,this.tipAlignBottom),i(this.btnWrap,this.tipWrap),i(this.btnTextOrient,this.tipTextOrientation),i(this.btnInsertTable,this.tipInsertTable),i(this.btnInsertImage,this.tipInsertImage),i(this.btnInsertChart,this.tipInsertChartSpark),i(this.btnInsertChartRecommend,this.tipInsertChartRecommend),i(this.btnInsertSparkline,this.tipInsertSpark),i(this.btnInsertSmartArt,this.tipInsertSmartArt),i(this.btnInsertText,[this.tipInsertHorizontalText,this.tipInsertText]),i(this.btnInsertTextArt,this.tipInsertTextart),i(this.btnInsertHyperlink,this.tipInsertHyperlink+Common.Utils.String.platformKey("Ctrl+K")),i(this.btnInsertShape,this.tipInsertShape),i(this.btnInsertEquation,this.tipInsertEquation),i(this.btnInsertSymbol,this.tipInsertSymbol),i(this.btnInsertSlicer,this.tipInsertSlicer),i(this.btnSortDown,this.txtSortAZ),i(this.btnSortUp,this.txtSortZA),i(this.btnSetAutofilter,this.txtFilter+" (Ctrl+Shift+L)"),i(this.btnClearAutofilter,this.txtClearFilter),i(this.btnSearch,this.txtSearch),i(this.btnTableTemplate,this.txtTableTemplate),i(this.btnCellStyle,this.txtCellStyle),i(this.btnPercentStyle,this.tipDigStylePercent),i(this.btnCommaStyle,this.tipDigStyleComma),i(this.btnCurrencyStyle,this.tipDigStyleAccounting),i(this.btnDecDecimal,this.tipDecDecimal),i(this.btnIncDecimal,this.tipIncDecimal),i(this.btnInsertFormula,[this.txtAutosumTip+Common.Utils.String.platformKey("Alt+="),this.txtFormula+Common.Utils.String.platformKey("Shift+F3")]),i(this.btnNamedRange,this.txtNamedRange),i(this.btnFillNumbers,this.txtFillNum),i(this.btnClearStyle,this.tipClearStyle),i(this.btnCopyStyle,this.tipCopyStyle),i(this.btnAddCell,this.tipInsertOpt+Common.Utils.String.platformKey("Ctrl+Shift+=")),i(this.btnDeleteCell,this.tipDeleteOpt+Common.Utils.String.platformKey("Ctrl+Shift+-")),i(this.btnColorSchemas,this.tipColorSchemas),i(this.btnPageOrient,this.tipPageOrient),i(this.btnPageSize,this.tipPageSize),i(this.btnPageMargins,this.tipPageMargins),i(this.btnPrintArea,this.tipPrintArea),i(this.btnPrintTitles,this.tipPrintTitles),i(this.btnScale,this.tipScale),i(this.btnCondFormat,this.tipCondFormat),i(this.btnVisibleArea,this.tipVisibleArea),i(this.btnTextFormatting,this.tipTextFormatting),i(this.btnHorizontalAlign,this.tipHAlighOle),i(this.btnVerticalAlign,this.tipVAlighOle),i(this.btnRtlSheet,this.tipRtlSheet),this.btnsEditHeader.forEach((function(t){i(t,e.tipEditHeader)})),this.btnBorders&&this.btnBorders.rendered&&(this.btnBorders.setMenu(new Common.UI.Menu({cls:"shifted-right",items:[{caption:this.textBottomBorders,iconCls:"menu__icon btn-border-bottom",icls:"btn-border-bottom",borderId:Asc.c_oAscBorderOptions.Bottom},{caption:this.textTopBorders,iconCls:"menu__icon btn-border-top",icls:"btn-border-top",borderId:Asc.c_oAscBorderOptions.Top},{caption:this.textLeftBorders,iconCls:"menu__icon btn-border-left",icls:"btn-border-left",borderId:Asc.c_oAscBorderOptions.Left},{caption:this.textRightBorders,iconCls:"menu__icon btn-border-right",icls:"btn-border-right",borderId:Asc.c_oAscBorderOptions.Right},{caption:"--"},{caption:this.textNoBorders,iconCls:"menu__icon btn-border-no",icls:"btn-border-no",borderId:"none"},{caption:this.textAllBorders,iconCls:"menu__icon btn-border-all",icls:"btn-border-all",borderId:"all"},{caption:this.textOutBorders,iconCls:"menu__icon btn-border-out",icls:"btn-border-out",borderId:"outer"},{caption:this.textInsideBorders,iconCls:"menu__icon btn-border-inside",icls:"btn-border-inside",borderId:"inner"},{caption:"--"},{caption:this.textMiddleBorders,iconCls:"menu__icon btn-border-insidehor",icls:"btn-border-insidehor",borderId:Asc.c_oAscBorderOptions.InnerH},{caption:this.textCenterBorders,iconCls:"menu__icon btn-border-insidevert",icls:"btn-border-insidevert",borderId:Asc.c_oAscBorderOptions.InnerV},{caption:this.textDiagDownBorder,iconCls:"menu__icon btn-border-diagdown",icls:"btn-border-diagdown",borderId:Asc.c_oAscBorderOptions.DiagD},{caption:this.textDiagUpBorder,iconCls:"menu__icon btn-border-diagup",icls:"btn-border-diagup",borderId:Asc.c_oAscBorderOptions.DiagU},{caption:"--"},{id:"id-toolbar-mnu-item-border-width",caption:this.textBordersStyle,iconCls:"menu__icon btn-border-style",menu:(t=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div class="border-size-item"><svg><use xlink:href="#<%= options.imgId %>"></use></svg></div></a>'),e.mnuBorderWidth=new Common.UI.Menu({style:"min-width: 100px;",cls:"shifted-right",menuAlign:"tl-tr",id:"toolbar-menu-borders-width",items:[{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Thin,imgId:"solid-s",checked:!0},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Hair,imgId:"dots-s"},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Dotted,imgId:"dashes-s"},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Dashed,imgId:"dashes-m"},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.DashDot,imgId:"dash-dot-s"},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.DashDotDot,imgId:"dash-dot-dot-s"},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Medium,imgId:"solid-m"},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.MediumDashed,imgId:"dashes-l"},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.MediumDashDot,imgId:"dash-dot-m"},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.MediumDashDotDot,imgId:"dash-dot-dot-m"},{template:t,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:Asc.c_oAscBorderStyles.Thick,imgId:"solid-l"}]}),e.mnuBorderWidth)},this.mnuBorderColor=new Common.UI.MenuItem({id:"id-toolbar-mnu-item-border-color",caption:this.textBordersColor,iconCls:"mnu-icon-item mnu-border-color",template:_.template('<a id="<%= id %>"tabindex="-1" type="menuitem"><span class="menu-item-icon"></span><%= caption %></a>'),menu:new Common.UI.Menu({menuAlign:"tl-tr",cls:"shifted-left",items:[{id:"id-toolbar-menu-auto-bordercolor",caption:this.textAutoColor,template:_.template('<a tabindex="-1" type="menuitem"><span class="menu-item-icon color-auto"></span><%= caption %></a>'),stopPropagation:!0},{caption:"--"},{template:_.template('<div id="id-toolbar-menu-bordercolor" style="width: 164px;display: inline-block;"></div>'),stopPropagation:!0},{caption:"--"},{id:"id-toolbar-menu-new-bordercolor",template:_.template('<a tabindex="-1" type="menuitem">'+this.textNewColor+"</a>"),stopPropagation:!0}]})})].concat(this.mode.isEditOle||this.mode.canBrandingExt&&this.mode.customization&&!1===this.mode.customization.rightMenu||!Common.UI.LayoutManager.isElementVisible("rightMenu")?[]:[{caption:this.textMoreBorders,value:"options"}])})),this.mnuBorderColorPicker=new Common.UI.ThemeColorPalette({el:$("#id-toolbar-menu-bordercolor"),outerMenu:{menu:this.mnuBorderColor.menu,index:2}}),this.mnuBorderColor.menu.setInnerMenu([{menu:this.mnuBorderColorPicker,index:2}])),this.btnInsertChart){this.btnInsertChart.setMenu(new Common.UI.Menu({style:"width: 364px;padding-top: 12px;",items:[{template:_.template('<div id="id-toolbar-menu-insertchart" class="menu-insertchart"></div>')}]}));var o=function(t){var i=new Common.UI.DataView({el:$("#id-toolbar-menu-insertchart"),parentMenu:t,outerMenu:{menu:t,index:0},showLast:!1,restoreHeight:535,groups:new Common.UI.DataViewGroupStore(Common.define.chartData.getChartGroupData()),store:new Common.UI.DataViewStore(Common.define.chartData.getChartData()),itemTemplate:_.template('<div id="<%= id %>" class="item-chartlist"><svg width="40" height="40" class="icon uni-scale"><use xlink:href="#chart-<%= iconCls %>"></use></svg></div>')});i.on("item:click",(function(i,o,n,s){n&&e.fireEvent("add:chart",[n.get("group"),n.get("type")]),"click"!==s.type&&t.hide()})),t.off("show:before",o),t.setInnerMenu([{menu:i,index:0}])};this.btnInsertChart.menu.on("show:before",o)}if(this.btnInsertSmartArt){this.btnInsertSmartArt.setMenu(new Common.UI.Menu({cls:"shifted-right",items:[]}));var n=function(t){Common.define.smartArt.getSmartArtData().forEach((function(t,i){var o=t.items.length,n=399;o<5&&(n=78*o+9),e.btnInsertSmartArt.menu.addItem({caption:t.caption,value:t.sectionId,itemId:t.id,itemsLength:o,iconCls:t.icon?"menu__icon "+t.icon:void 0,menu:new Common.UI.Menu({items:[{template:_.template('<div id="'+t.id+'" class="menu-add-smart-art margin-left-5" style="width: '+n+'px; height: 500px;"></div>')}],menuAlign:"tl-tr"})},!0)}));var i=e.btnInsertSmartArt.menu.getItems(!0);i.forEach((function(t,o){for(var n=[],s=0;s<t.options.itemsLength;s++)n.push({isLoading:!0});t.menuPicker=new Common.UI.DataView({el:$("#"+t.options.itemId),parentMenu:i[o].menu,itemTemplate:_.template(["<% if (isLoading) { %>",'<div class="loading-item" style="width: 70px; height: 70px;">','<i class="loading-spinner"></i>',"</div>","<% } else { %>","<div>",'<img src="<%= imageUrl %>" width="70" height="70" />',"</div>","<% } %>"].join("")),store:new Common.UI.DataViewStore(n),delayRenderTips:!0,scrollAlwaysVisible:!0,showLast:!1}),t.menuPicker.on("item:click",(function(t,i,o,n){o&&null!==o.get("value")&&e.fireEvent("insert:smartart",[o.get("value")]),Common.NotificationCenter.trigger("edit:complete",e)})),t.menuPicker.loaded=!1,t.$el.on("mouseenter",(function(){t.menuPicker.loaded||e.fireEvent("smartart:mouseenter",[t.value])})),t.$el.on("mouseleave",(function(){e.fireEvent("smartart:mouseleave",[t.value])}))})),t.off("show:before",n)};this.btnInsertSmartArt.menu.on("show:before",n)}if(this.btnInsertSparkline){this.btnInsertSparkline.setMenu(new Common.UI.Menu({style:"width: 166px;padding: 5px 0 10px;",items:[{template:_.template('<div id="id-toolbar-menu-insertspark" class="menu-insertchart"></div>')}]}));var s=function(t){var i=new Common.UI.DataView({el:$("#id-toolbar-menu-insertspark"),parentMenu:t,outerMenu:{menu:t,index:0},showLast:!1,restoreHeight:50,store:new Common.UI.DataViewStore(Common.define.chartData.getSparkData()),itemTemplate:_.template('<div id="<%= id %>" class="item-chartlist"><svg width="40" height="40" class="icon uni-scale"><use xlink:href="#chart-<%= iconCls %>"></use></svg></div>')});i.on("item:click",(function(i,o,n,s){n&&e.fireEvent("add:spark",[n.get("type")]),"click"!==s.type&&t.hide()})),t.off("show:before",s),t.setInnerMenu([{menu:i,index:0}])};this.btnInsertSparkline.menu.on("show:before",s)}if(this.btnInsertText&&this.btnInsertText.setMenu(new Common.UI.Menu({items:[{caption:this.tipInsertHorizontalText,checkable:!0,checkmark:!1,iconCls:"menu__icon btn-text",toggleGroup:"textbox",value:"textRect",iconClsForMainBtn:"btn-big-text"},{caption:this.tipInsertVerticalText,checkable:!0,checkmark:!1,iconCls:"menu__icon btn-text-vertical",toggleGroup:"textbox",value:"textRectVertical",iconClsForMainBtn:"btn-big-text-vertical"}]})),this.btnInsertTextArt){var a=function(t){var i=SSE.getCollection("Common.Collections.TextArt");i.length<1&&SSE.getController("Main").fillTextArt(e.api.asc_getTextArtPreviews());var o=new Common.UI.DataView({el:$("#id-toolbar-menu-insart"),store:i,parentMenu:t,outerMenu:{menu:t,index:0},showLast:!1,itemTemplate:_.template('<div class="item-art"><img src="<%= imageUrl %>" id="<%= id %>" style="width:50px;height:50px;"></div>')});o.on("item:click",(function(i,o,n,s){n&&e.fireEvent("insert:textart",[n.get("data")]),"click"!==s.type&&t.hide()})),t.off("show:before",a),t.setInnerMenu([{menu:o,index:0}])};this.btnInsertTextArt.menu.on("show:before",a)}this.specSymbols=[{symbol:8226,description:this.textBullet},{symbol:8364,description:this.textEuro},{symbol:65284,description:this.textDollar},{symbol:165,description:this.textYen},{symbol:169,description:this.textCopyright},{symbol:174,description:this.textRegistered},{symbol:189,description:this.textOneHalf},{symbol:188,description:this.textOneQuarter},{symbol:8800,description:this.textNotEqualTo},{symbol:177,description:this.textPlusMinus},{symbol:247,description:this.textDivision},{symbol:8730,description:this.textSquareRoot},{symbol:8804,description:this.textLessEqual},{symbol:8805,description:this.textGreaterEqual},{symbol:8482,description:this.textTradeMark},{symbol:8734,description:this.textInfinity},{symbol:126,description:this.textTilde},{symbol:176,description:this.textDegree},{symbol:167,description:this.textSection},{symbol:945,description:this.textAlpha},{symbol:946,description:this.textBetta},{symbol:960,description:this.textLetterPi},{symbol:916,description:this.textDelta},{symbol:9786,description:this.textSmile},{symbol:9829,description:this.textBlackHeart}],this.btnInsertSymbol&&(this.mnuInsertSymbolsPicker=new Common.UI.DataView({el:$("#id-toolbar-menu-symbols"),cls:"no-borders-item",parentMenu:this.btnInsertSymbol.menu,outerMenu:{menu:this.btnInsertSymbol.menu,index:0},restoreHeight:290,delayRenderTips:!0,scrollAlwaysVisible:!0,store:new Common.UI.DataViewStore(this.loadRecentSymbolsFromStorage()),itemTemplate:_.template('<div class="item-symbol" dir="ltr" <% if (typeof font !== "undefined" && font !=="") { %> style ="font-family: <%= font %>"<% } %>>&#<%= symbol %></div>')}),this.btnInsertSymbol.menu.setInnerMenu([{menu:this.mnuInsertSymbolsPicker,index:0}]),this.btnInsertSymbol.menu.on("show:before",_.bind((function(){this.mnuInsertSymbolsPicker.deselectAll()}),this))),this.btnCondFormat&&this.btnCondFormat.rendered&&this.btnCondFormat.setMenu(new Common.UI.Menu({items:[{caption:Common.define.conditionalData.textValue,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textGreater,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.greaterThan},{caption:Common.define.conditionalData.textGreaterEq,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.greaterThanOrEqual},{caption:Common.define.conditionalData.textLess,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.lessThan},{caption:Common.define.conditionalData.textLessEq,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.lessThanOrEqual},{caption:Common.define.conditionalData.textEqual,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.equal},{caption:Common.define.conditionalData.textNotEqual,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.notEqual},{caption:Common.define.conditionalData.textBetween,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.between},{caption:Common.define.conditionalData.textNotBetween,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.notBetween}]})},{caption:Common.define.conditionalData.textTop+"/"+Common.define.conditionalData.textBottom,type:Asc.c_oAscCFType.top10,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textTop+" 10 "+this.textItems,type:Asc.c_oAscCFType.top10,value:0,percent:!1},{caption:Common.define.conditionalData.textTop+" 10%",type:Asc.c_oAscCFType.top10,value:0,percent:!0},{caption:Common.define.conditionalData.textBottom+" 10 "+this.textItems,type:Asc.c_oAscCFType.top10,value:1,percent:!1},{caption:Common.define.conditionalData.textBottom+" 10%",type:Asc.c_oAscCFType.top10,value:1,percent:!0}]})},{caption:Common.define.conditionalData.textAverage,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textAbove,type:Asc.c_oAscCFType.aboveAverage,value:0},{caption:Common.define.conditionalData.textBelow,type:Asc.c_oAscCFType.aboveAverage,value:1},{caption:Common.define.conditionalData.textEqAbove,type:Asc.c_oAscCFType.aboveAverage,value:2},{caption:Common.define.conditionalData.textEqBelow,type:Asc.c_oAscCFType.aboveAverage,value:3},{caption:Common.define.conditionalData.text1Above,type:Asc.c_oAscCFType.aboveAverage,value:4},{caption:Common.define.conditionalData.text1Below,type:Asc.c_oAscCFType.aboveAverage,value:5},{caption:Common.define.conditionalData.text2Above,type:Asc.c_oAscCFType.aboveAverage,value:6},{caption:Common.define.conditionalData.text2Below,type:Asc.c_oAscCFType.aboveAverage,value:7},{caption:Common.define.conditionalData.text3Above,type:Asc.c_oAscCFType.aboveAverage,value:8},{caption:Common.define.conditionalData.text3Below,type:Asc.c_oAscCFType.aboveAverage,value:9}]})},{caption:Common.define.conditionalData.textText,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textContains,type:Asc.c_oAscCFType.containsText},{caption:Common.define.conditionalData.textNotContains,type:Asc.c_oAscCFType.notContainsText},{caption:Common.define.conditionalData.textBegins,type:Asc.c_oAscCFType.beginsWith},{caption:Common.define.conditionalData.textEnds,type:Asc.c_oAscCFType.endsWith}]})},{caption:Common.define.conditionalData.textDate,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textYesterday,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.yesterday},{caption:Common.define.conditionalData.textToday,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.today},{caption:Common.define.conditionalData.textTomorrow,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.tomorrow},{caption:Common.define.conditionalData.textLast7days,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.last7Days},{caption:Common.define.conditionalData.textLastWeek,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.lastWeek},{caption:Common.define.conditionalData.textThisWeek,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.thisWeek},{caption:Common.define.conditionalData.textNextWeek,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.nextWeek},{caption:Common.define.conditionalData.textLastMonth,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.lastMonth},{caption:Common.define.conditionalData.textThisMonth,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.thisMonth},{caption:Common.define.conditionalData.textNextMonth,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.nextMonth}]})},{caption:Common.define.conditionalData.textBlank+"/"+Common.define.conditionalData.textError,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textBlanks,type:Asc.c_oAscCFType.containsBlanks},{caption:Common.define.conditionalData.textNotBlanks,type:Asc.c_oAscCFType.notContainsBlanks},{caption:Common.define.conditionalData.textErrors,type:Asc.c_oAscCFType.containsErrors},{caption:Common.define.conditionalData.textNotErrors,type:Asc.c_oAscCFType.notContainsErrors}]})},{caption:Common.define.conditionalData.textDuplicate+"/"+Common.define.conditionalData.textUnique,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textDuplicate,type:Asc.c_oAscCFType.duplicateValues},{caption:Common.define.conditionalData.textUnique,type:Asc.c_oAscCFType.uniqueValues}]})},{caption:"--"},this.mnuDataBars=new Common.UI.MenuItem({caption:this.textDataBars,type:Asc.c_oAscCFType.dataBar,menu:new Common.UI.Menu({menuAlign:"tl-tr",style:"min-width: auto;",items:[]})}),this.mnuColorScales=new Common.UI.MenuItem({caption:this.textColorScales,type:Asc.c_oAscCFType.colorScale,menu:new Common.UI.Menu({menuAlign:"tl-tr",style:"min-width: auto;",items:[]})}),this.mnuIconSets=new Common.UI.MenuItem({caption:Common.define.conditionalData.textIconSets,type:Asc.c_oAscCFType.iconSet,menu:new Common.UI.Menu({menuAlign:"tl-tr",style:"min-width: auto;",items:[]})}),{caption:"--"},{caption:Common.define.conditionalData.textFormula,type:Asc.c_oAscCFType.expression},{caption:"--"},{caption:this.textNewRule,value:"new"},{caption:this.textClearRule,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{value:"clear",type:Asc.c_oAscSelectionForCFType.selection,caption:this.textSelection},{value:"clear",type:Asc.c_oAscSelectionForCFType.worksheet,caption:this.textThisSheet},{value:"clear",type:Asc.c_oAscSelectionForCFType.table,caption:this.textThisTable},{value:"clear",type:Asc.c_oAscSelectionForCFType.pivot,caption:this.textThisPivot}]})},{caption:this.textManageRule,value:"manage"}]})),this.mode.isEditMailMerge||this.mode.isEditDiagram||this.mode.isEditOle||this.updateMetricUnit()},onToolbarAfterRender:function(t){this.btnTextColor&&this.btnTextColor.cmpEl&&(this.btnTextColor.setMenu(),this.mnuTextColorPicker=this.btnTextColor.getPicker(),this.btnTextColor.setColor(this.btnTextColor.currentColor||"transparent")),this.btnBackColor&&this.btnBackColor.cmpEl&&(this.btnBackColor.setMenu(),this.mnuBackColorPicker=this.btnBackColor.getPicker(),this.btnBackColor.setColor(this.btnBackColor.currentColor||"transparent"))},updateMetricUnit:function(){for(var t=this.btnPageMargins.menu.getItems(!0),e=0;e<t.length;e++){if((o=t[e]).checkable){var i=o.checked;$(o.el).html(o.template({id:Common.UI.getId(),caption:o.caption,options:o.options})),i&&o.setChecked(i)}}t=this.btnPageSize.menu.getItems(!0);for(e=0;e<t.length;e++){var o;if((o=t[e]).checkable){i=o.checked;$(o.el).html(o.template({id:Common.UI.getId(),caption:o.caption,options:o.options})),i&&o.setChecked(i)}}},setApi:function(t){return this.api=t,this.mode.isEditMailMerge||this.mode.isEditDiagram||this.mode.isEditOle||(this.api.asc_registerCallback("asc_onCollaborativeChanges",_.bind(this.onApiCollaborativeChanges,this)),this.api.asc_registerCallback("asc_onSendThemeColorSchemes",_.bind(this.onApiSendThemeColorSchemes,this)),this.api.asc_registerCallback("asc_onAuthParticipantsChanged",_.bind(this.onApiUsersChanged,this)),this.api.asc_registerCallback("asc_onParticipantsChanged",_.bind(this.onApiUsersChanged,this))),this},setMode:function(t){return t.isDisconnected?(this.lockToolbar(Common.enumLock.lostConnect,!0),this.lockToolbar(Common.enumLock.lostConnect,!0,{array:[this.btnEditChart,this.btnEditChartData,this.btnEditChartType,this.btnUndo,this.btnRedo,this.btnSave,this.btnVisibleArea,this.btnVisibleAreaClose]}),this.synchTooltip&&this.synchTooltip.hide(),t.enableDownload||this.lockToolbar(Common.enumLock.cantPrint,!0,{array:[this.btnPrint]})):(this.mode=t,!t.canPrint&&this.btnPrint&&this.btnPrint.hide(),this.lockToolbar(Common.enumLock.cantPrint,!t.canPrint,{array:[this.btnPrint]})),this},onApiSendThemeColorSchemes:function(t){this.mnuColorSchema=this.btnColorSchemas.menu,this.mnuColorSchema&&this.mnuColorSchema.removeAll(!0),null==this.mnuColorSchema&&(this.mnuColorSchema=new Common.UI.Menu({cls:"shifted-left",restoreHeight:!0}));var e=_.template(['<a id="<%= id %>" class="<%= options.cls %>" tabindex="-1" type="menuitem">','<span class="colors">',"<% _.each(options.colors, function(color) { %>",'<span class="color" style="background: <%= color %>;"></span>',"<% }) %>","</span>",'<span class="text"><%= caption %></span>',"</a>"].join(""));_.each(t,(function(t,i){for(var o=t.get_colors(),n=[],s=2;s<7;s++){var a="#"+Common.Utils.ThemeColor.getHexColor(o[s].get_r(),o[s].get_g(),o[s].get_b());n.push(a)}24==i&&this.mnuColorSchema.addItem({caption:"--"},!0),this.mnuColorSchema.addItem({template:e,cls:"color-schemas-menu",colors:n,caption:t.get_name(),value:i,checkable:!0,toggleGroup:"menuSchema"},!0)}),this)},onApiCollaborativeChanges:function(){this._state.hasCollaborativeChanges||this.btnCollabChanges.rendered&&(this._state.hasCollaborativeChanges=!0,this.btnCollabChanges.cmpEl.addClass("notify"),this.showSynchTip?(this.btnCollabChanges.updateHint(""),void 0===this.synchTooltip&&this.createSynchTip(),this.synchTooltip.target=this.btnCollabChanges.$el.is(":visible")?this.btnCollabChanges.$el:$("[data-layout-name=toolbar-file]",this.$el),this.synchTooltip.show()):this.btnCollabChanges.updateHint(this.tipSynchronize+Common.Utils.String.platformKey("Ctrl+S")),this.lockToolbar(Common.enumLock.cantSave,!1,{array:[this.btnSave]}),Common.Gateway.collaborativeChanges())},createSynchTip:function(){var t=Common.UI.isRTL()?"left":"right";this.synchTooltip=new Common.UI.SynchronizeTip({extCls:this.mode.compactHeader?void 0:"inc-index",placement:this.mode.isDesktopApp?"bottom-"+t:t+"-bottom"}),this.synchTooltip.on("dontshowclick",(function(){this.showSynchTip=!1,this.synchTooltip.hide(),this.btnCollabChanges.updateHint(this.tipSynchronize+Common.Utils.String.platformKey("Ctrl+S")),Common.localStorage.setItem("sse-hide-synch",1)}),this),this.synchTooltip.on("closeclick",(function(){this.synchTooltip.hide(),this.btnCollabChanges.updateHint(this.tipSynchronize+Common.Utils.String.platformKey("Ctrl+S"))}),this)},synchronizeChanges:function(){if(this.btnCollabChanges.rendered){var t=this;t.btnCollabChanges.cmpEl.hasClass("notify")&&(t.btnCollabChanges.cmpEl.removeClass("notify"),this.synchTooltip&&this.synchTooltip.hide(),this.btnCollabChanges.updateHint(this.btnSaveTip),this.lockToolbar(Common.enumLock.cantSave,!t.mode.forcesave&&!t.mode.canSaveDocumentToBinary,{array:[this.btnSave]}),this._state.hasCollaborativeChanges=!1)}},onApiUsersChanged:function(t){var e=[];_.each(t,(function(t){t.asc_getView()||e.push(t)}));var i=_.size(e),o=i>1?"btn-save-coauth":"btn-save";o!==this.btnSaveCls&&this.btnCollabChanges.rendered&&(this.btnSaveTip=(i>1?this.tipSaveCoauth:this.tipSave)+Common.Utils.String.platformKey("Ctrl+S"),this.btnCollabChanges.updateHint(this.btnSaveTip),this.btnCollabChanges.changeIcon({next:o,curr:this.btnSaveCls}),this.btnSaveCls=o)},onAppReady:function(t){if(this._isDocReady=!0,t.isEdit&&!t.isEditMailMerge&&!t.isEditDiagram&&!t.isEditOle){var e=this;e.btnPrint.menu&&e.btnPrint.setMenu(new Common.UI.Menu({items:[{caption:e.tipPrint,iconCls:"menu__icon btn-print",toggleGroup:"viewPrint",value:"print",iconClsForMainBtn:"btn-print",platformKey:Common.Utils.String.platformKey("Ctrl+P")},{caption:e.tipPrintQuick,iconCls:"menu__icon btn-quick-print",toggleGroup:"viewPrint",value:"print-quick",iconClsForMainBtn:"btn-quick-print",platformKey:""}]}));var i=SSE.getController("DocumentHolder").getView("DocumentHolder");e.btnImgForward.updateHint(e.tipSendForward),e.btnImgForward.setMenu(new Common.UI.Menu({items:[{caption:i.textArrangeFront,iconCls:"menu__icon btn-arrange-front",value:Asc.c_oAscDrawingLayerType.BringToFront},{caption:i.textArrangeForward,iconCls:"menu__icon btn-arrange-forward",value:Asc.c_oAscDrawingLayerType.BringForward}]})),e.btnImgBackward.updateHint(e.tipSendBackward),e.btnImgBackward.setMenu(new Common.UI.Menu({items:[{caption:i.textArrangeBack,iconCls:"menu__icon btn-arrange-back",value:Asc.c_oAscDrawingLayerType.SendToBack},{caption:i.textArrangeBackward,iconCls:"menu__icon btn-arrange-backward",value:Asc.c_oAscDrawingLayerType.SendBackward}]})),e.btnImgAlign.updateHint(e.tipImgAlign),e.btnImgAlign.setMenu(new Common.UI.Menu({items:[{caption:i.textShapeAlignLeft,iconCls:"menu__icon btn-shape-align-left",value:0},{caption:i.textShapeAlignCenter,iconCls:"menu__icon btn-shape-align-center",value:4},{caption:i.textShapeAlignRight,iconCls:"menu__icon btn-shape-align-right",value:1},{caption:i.textShapeAlignTop,iconCls:"menu__icon btn-shape-align-top",value:3},{caption:i.textShapeAlignMiddle,iconCls:"menu__icon btn-shape-align-middle",value:5},{caption:i.textShapeAlignBottom,iconCls:"menu__icon btn-shape-align-bottom",value:2},{caption:"--"},{caption:i.txtDistribHor,iconCls:"menu__icon btn-shape-distribute-hor",value:6},{caption:i.txtDistribVert,iconCls:"menu__icon btn-shape-distribute-vert",value:7}]})),e.btnShapesMerge.updateHint(e.tipShapesMerge),e.btnShapesMerge.setMenu(new Common.UI.Menu({cls:"shifted-right",items:[{caption:e.textShapesUnion,iconCls:"menu__icon btn-union-shapes",value:"unite"},{caption:e.textShapesCombine,iconCls:"menu__icon btn-combine-shapes",value:"exclude"},{caption:e.textShapesFragment,iconCls:"menu__icon btn-fragment-shapes",value:"divide"},{caption:e.textShapesIntersect,iconCls:"menu__icon btn-intersect-shapes",value:"intersect"},{caption:e.textShapesSubstract,iconCls:"menu__icon btn-substract-shapes",value:"subtract"}]})),e.btnImgGroup.updateHint(e.tipImgGroup),e.btnImgGroup.setMenu(new Common.UI.Menu({items:[{caption:i.txtGroup,iconCls:"menu__icon btn-shape-group",value:"grouping"},{caption:i.txtUngroup,iconCls:"menu__icon btn-shape-ungroup",value:"ungrouping"}]})),e.btnPageBreak.updateHint(e.tipPageBreak),e.btnPageBreak.setMenu(new Common.UI.Menu({items:[{caption:e.textInsPageBreak,value:"ins"},{caption:e.textDelPageBreak,value:"del"},{caption:e.textResetPageBreak,value:"reset"}]}))}},loadRecentSymbolsFromStorage:function(){var t=Common.localStorage.getItem("sse-fastRecentSymbols"),e=t?JSON.parse(t):[{symbol:8226,font:"Arial"},{symbol:8364,font:"Arial"},{symbol:65284,font:"Arial"},{symbol:165,font:"Arial"},{symbol:169,font:"Arial"},{symbol:174,font:"Arial"},{symbol:189,font:"Arial"},{symbol:188,font:"Arial"},{symbol:8800,font:"Arial"},{symbol:177,font:"Arial"},{symbol:247,font:"Arial"},{symbol:8730,font:"Arial"},{symbol:8804,font:"Arial"},{symbol:8805,font:"Arial"},{symbol:8482,font:"Arial"},{symbol:8734,font:"Arial"},{symbol:126,font:"Arial"},{symbol:176,font:"Arial"},{symbol:167,font:"Arial"},{symbol:945,font:"Arial"},{symbol:946,font:"Arial"},{symbol:960,font:"Arial"},{symbol:916,font:"Arial"},{symbol:9786,font:"Arial"},{symbol:9829,font:"Arial"}];return e.forEach(function(t){t.tip=this.getSymbolDescription(t.symbol)}.bind(this)),e},saveSymbol:function(t,e){var i=this.mnuInsertSymbolsPicker,o=i.store.find((function(i){return i.get("symbol")==t&&i.get("font")==e}));o&&i.store.remove(o),i.store.add({symbol:t,font:e,tip:this.getSymbolDescription(t)},{at:0}),i.store.length>25&&i.store.remove(i.store.last());var n=i.store.map((function(t){return{symbol:t.get("symbol"),font:t.get("font")}})),s=JSON.stringify(n);Common.localStorage.setItem("sse-fastRecentSymbols",s)},getSymbolDescription:function(t){var e=this.specSymbols.find((function(e){return e.symbol==t}));return e?e.description:this.capBtnInsSymbol+": "+t},onDesktopWindow:function(){this.synchTooltip&&this.synchTooltip.isVisible()&&this.synchTooltip.show()}},SSE.Views.Toolbar||{}))})),define("spreadsheeteditor/main/app/model/TableTemplate",["backbone"],(function(t){"use strict";SSE.Models=SSE.Models||{},SSE.Models.TableTemplate=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),name:null,caption:null,type:null,imageUrl:null}}})})),define("spreadsheeteditor/main/app/collection/TableTemplates",["backbone","spreadsheeteditor/main/app/model/TableTemplate"],(function(t){"use strict";if(void 0===e)var e={};e.Collections=e.Collections||{},SSE.Collections.TableTemplates=t.Collection.extend({model:SSE.Models.TableTemplate})})),define("spreadsheeteditor/main/app/view/PivotTable",["common/main/lib/util/utils","common/main/lib/component/Button","common/main/lib/component/ComboDataView","common/main/lib/component/Layout"],(function(t){"use strict";SSE.Views.PivotTable=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;this.btnsAddPivot.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("pivottable:create")}))})),this.btnPivotLayout.menu.on("item:click",(function(e,i,o){t.fireEvent("pivottable:layout",[i.value])})),this.btnPivotBlankRows.menu.on("item:click",(function(e,i,o){t.fireEvent("pivottable:blankrows",[i.value])})),this.btnPivotSubtotals.menu.on("item:click",(function(e,i,o){t.fireEvent("pivottable:subtotals",[i.value])})),this.btnPivotGrandTotals.menu.on("item:click",(function(e,i,o){t.fireEvent("pivottable:grandtotals",[i.value])})),this.btnRefreshPivot.on("click",(function(e){t.fireEvent("pivottable:refresh",["current"])})),this.btnRefreshPivot.menu.on("item:click",(function(e,i,o){t.fireEvent("pivottable:refresh",[i.value])})),this.btnSelectPivot.on("click",(function(e){t.fireEvent("pivottable:select")})),this.btnCalculatedItems.on("click",(function(e){t.fireEvent("pivottable:calculated")})),this.btnExpandField.on("click",(function(e){t.fireEvent("pivottable:expand")})),this.btnCollapseField.on("click",(function(e){t.fireEvent("pivottable:collapse")})),this.chRowHeader.on("change",(function(e,i){t.fireEvent("pivottable:rowscolumns",[0,i])})),this.chColHeader.on("change",(function(e,i){t.fireEvent("pivottable:rowscolumns",[1,i])})),this.chRowBanded.on("change",(function(e,i){t.fireEvent("pivottable:rowscolumns",[2,i])})),this.chColBanded.on("change",(function(e,i){t.fireEvent("pivottable:rowscolumns",[3,i])})),this.pivotStyles.on("click",(function(e,i){t.fireEvent("pivottable:style",[i])})),this.pivotStyles.openButton.menu.on("show:after",(function(){t.pivotStyles.menuPicker.scroller.update({alwaysVisibleY:!0})}))}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.toolbar=t.toolbar,this.lockedControls=[];var e=Common.enumLock;this.btnsAddPivot=Common.Utils.injectButtons(this.toolbar.$el.find(".btn-slot.slot-add-pivot"),"","toolbar__icon btn-big-pivot-sum",this.txtPivotTable,[e.lostConnect,e.coAuth,e.editPivot,e.selRangeEdit,e.selChart,e.selChartText,e.selShape,e.selShapeText,e.selImage,e.selSlicer,e.editCell,e.wsLock],void 0,void 0,void 0,"1","bottom","small"),this.chRowHeader=new Common.UI.CheckBox({labelText:this.textRowHeader,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.FormatCells,e.PivotTables],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chRowHeader),this.chColHeader=new Common.UI.CheckBox({labelText:this.textColHeader,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.FormatCells,e.PivotTables],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chColHeader),this.chRowBanded=new Common.UI.CheckBox({labelText:this.textRowBanded,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.FormatCells,e.PivotTables],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chRowBanded),this.chColBanded=new Common.UI.CheckBox({labelText:this.textColBanded,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.FormatCells,e.PivotTables],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chColBanded),this.btnPivotLayout=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-pivot-layout",caption:this.capLayout,disabled:!0,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.wsLock],menu:!0,action:"pivot-layout",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnPivotLayout),this.btnPivotBlankRows=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-blank-rows",caption:this.capBlankRows,disabled:!0,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.wsLock],menu:!0,action:"pivot-blank-rows",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnPivotBlankRows),this.btnPivotSubtotals=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-subtotals",caption:this.capSubtotals,disabled:!0,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.wsLock],menu:!0,action:"pivot-subtotals",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnPivotSubtotals),this.btnPivotGrandTotals=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-grand-totals",caption:this.capGrandTotals,disabled:!0,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.wsLock],menu:!0,action:"pivot-grand-totals",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnPivotGrandTotals),this.btnRefreshPivot=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-update",caption:this.txtRefresh,disabled:!0,split:!0,action:"pivot-refresh",lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnRefreshPivot),this.btnSelectPivot=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-select-pivot",caption:this.txtSelect,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.PivotTables],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnSelectPivot),this.btnCalculatedItems=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-calculated",caption:this.txtCalculatedItems,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.pivotCalcItemsLock,e.FormatCells,e.PivotTables],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnCalculatedItems),this.btnExpandField=new Common.UI.Button({cls:"btn-toolbar",iconCls:"toolbar__icon btn-expand-field",caption:this.txtExpandEntire,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.pivotExpandLock,e.FormatCells,e.PivotTables],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnExpandField),this.btnCollapseField=new Common.UI.Button({cls:"btn-toolbar",iconCls:"toolbar__icon btn-collapse-field",caption:this.txtCollapseEntire,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.pivotExpandLock,e.FormatCells,e.PivotTables],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnCollapseField),this.pivotStyles=new Common.UI.ComboDataView({cls:"combo-pivot-template",style:"min-width: 103px; max-width: 517px;",enableKeyEvents:!0,itemWidth:61,itemHeight:49,menuMaxHeight:300,groups:new Common.UI.DataViewGroupStore,autoWidth:!0,lock:[e.lostConnect,e.coAuth,e.noPivot,e.selRangeEdit,e.pivotLock,e.FormatCells,e.PivotTables],beforeOpenHandler:function(t){var e=this,i=e.openButton.menu;if(i.cmpEl){var o=$(e.cmpEl.find(".dataview.inner .style").get(0)).parent(),n=o.is(":visible")?parseFloat(o.css("width")):e.itemWidth+parseFloat(o.css("padding-left"))+parseFloat(o.css("padding-right"))+parseFloat(o.css("border-left-width"))+parseFloat(o.css("border-right-width"));i.menuAlignEl=e.cmpEl,i.menuAlign="tl-tl";var s=7*(8+n)+17,a=Common.Utils.getOffset(e.openButton.$el).left;s>Common.Utils.innerWidth()&&(s=Math.max(Math.floor((Common.Utils.innerWidth()-17)/(8+n)),2)*(8+n)+17);var r=e.cmpEl.width()-e.openButton.$el.width()-Math.min(s,a)-1;Common.UI.isRTL()&&(r=e.openButton.$el.width()+parseFloat($(e.$el.find(".combo-dataview").get(0)).css("padding-left"))),i.setOffset(Common.UI.isRTL()?r:Math.min(r,0)),i.cmpEl.css({width:s,"min-height":e.cmpEl.height()})}},dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"-16, 0"}),this.lockedControls.push(this.pivotStyles),Common.UI.LayoutManager.addControls(this.btnsAddPivot.concat(this.lockedControls)),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return this.boxSdk=$("#editor_sdk"),t&&t.html(this.getPanel()),this},onAppReady:function(e){var i=this;new Promise((function(t,e){t()})).then((function(){i.btnsAddPivot.forEach((function(t){t.updateHint(i.tipCreatePivot)})),i.btnSelectPivot.updateHint(i.tipSelect),i.btnCalculatedItems.updateHint(i.tipCalculatedItems),i.btnPivotLayout.updateHint(i.capLayout),i.btnPivotLayout.setMenu(new Common.UI.Menu({items:[{caption:i.mniLayoutCompact,value:0},{caption:i.mniLayoutOutline,value:1},{caption:i.mniLayoutTabular,value:2},{caption:"--"},{caption:i.mniLayoutRepeat,value:3},{caption:i.mniLayoutNoRepeat,value:4}]})),i.btnPivotBlankRows.updateHint(i.capBlankRows),i.btnPivotBlankRows.setMenu(new Common.UI.Menu({items:[{caption:i.mniInsertBlankLine,value:"insert"},{caption:i.mniRemoveBlankLine,value:"remove"}]})),i.btnPivotSubtotals.updateHint(i.tipSubtotals),i.btnPivotSubtotals.setMenu(new Common.UI.Menu({items:[{caption:i.mniNoSubtotals,value:0},{caption:i.mniBottomSubtotals,value:1},{caption:i.mniTopSubtotals,value:2}]})),i.btnPivotGrandTotals.updateHint(i.tipGrandTotals),i.btnPivotGrandTotals.setMenu(new Common.UI.Menu({items:[{caption:i.mniOffTotals,value:0},{caption:i.mniOnTotals,value:1},{caption:i.mniOnRowsTotals,value:2},{caption:i.mniOnColumnsTotals,value:3}]})),i.btnRefreshPivot.setMenu(new Common.UI.Menu({items:[{caption:i.txtRefresh,value:"current"},{caption:i.txtRefreshAll,value:"all"}]})),i.btnRefreshPivot.updateHint([i.tipRefreshCurrent,i.tipRefresh]),t.call(i)}))},getPanel:function(){this.$el=$(_.template('<section id="pivot-table-panel" class="panel" data-tab="pivot" role="tabpanel" aria-labelledby="pivot"><div class="group"><span id="slot-btn-pivot-report-layout" class="btn-slot text x-huge"></span><span id="slot-btn-pivot-blank-rows" class="btn-slot text x-huge"></span><span id="slot-btn-pivot-subtotals" class="btn-slot text x-huge"></span><span id="slot-btn-pivot-grand-totals" class="btn-slot text x-huge"></span></div><div class="separator long"></div><div class="group"><span id="slot-btn-refresh-pivot" class="btn-slot text x-huge"></span></div><div class="separator long"></div><div class="group"><span id="slot-btn-select-pivot" class="btn-slot text x-huge"></span></div><div class="separator long"></div><div class="group"><span id="slot-btn-calculated-items" class="btn-slot text x-huge"></span></div><div class="separator long"></div><div class="group small"><div class="elset"><span class="btn-slot text" id="slot-btn-expand-field"></span></div><div class="elset"><span class="btn-slot text" id="slot-btn-collapse-field"></span></div></div><div class="separator long"></div><div class="group small"><div class="elset"><span class="btn-slot text" id="slot-chk-header-row"></span></div><div class="elset"><span class="btn-slot text" id="slot-chk-header-column"></span></div></div><div class="separator long invisible"></div><div class="group small"><div class="elset"><span class="btn-slot text" id="slot-chk-banded-row"></span></div><div class="elset"><span class="btn-slot text" id="slot-chk-banded-column"></span></div></div><div class="separator long invisible"></div><div class="group flex small" id="slot-field-pivot-styles" style="width: 100%; min-width: 105px;" data-group-width="100%"></div></section>')({}));var t=Common.enumLock;return this.btnsAddPivot=this.btnsAddPivot.concat(Common.Utils.injectButtons(this.$el.find(".btn-slot.slot-add-pivot"),"","toolbar__icon btn-big-pivot-sum",this.txtCreate,[t.lostConnect,t.coAuth,t.editPivot,t.selRangeEdit,t.selChart,t.selChartText,t.selShape,t.selShapeText,t.selImage,t.selSlicer,t.editCell,t.wsLock],void 0,void 0,void 0,"1","bottom","small")),this.chRowHeader.render(this.$el.find("#slot-chk-header-row")),this.chColHeader.render(this.$el.find("#slot-chk-header-column")),this.chRowBanded.render(this.$el.find("#slot-chk-banded-row")),this.chColBanded.render(this.$el.find("#slot-chk-banded-column")),this.btnRefreshPivot.render(this.$el.find("#slot-btn-refresh-pivot")),this.btnSelectPivot.render(this.$el.find("#slot-btn-select-pivot")),this.btnCalculatedItems.render(this.$el.find("#slot-btn-calculated-items")),this.btnExpandField.render(this.$el.find("#slot-btn-expand-field")),this.btnCollapseField.render(this.$el.find("#slot-btn-collapse-field")),this.btnPivotLayout.render(this.$el.find("#slot-btn-pivot-report-layout")),this.btnPivotBlankRows.render(this.$el.find("#slot-btn-pivot-blank-rows")),this.btnPivotSubtotals.render(this.$el.find("#slot-btn-pivot-subtotals")),this.btnPivotGrandTotals.render(this.$el.find("#slot-btn-pivot-grand-totals")),this.pivotStyles.render(this.$el.find("#slot-field-pivot-styles")),this.$el},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButtons:function(t){return this.btnsAddPivot.concat(this.lockedControls)},SetDisabled:function(t){this.btnsAddPivot.concat(this.lockedControls).forEach((function(e){e&&e.setDisabled(t)}),this)},txtCreate:"Insert Table",tipCreatePivot:"Insert Pivot Table",textRowHeader:"Row Headers",textColHeader:"Column Headers",textRowBanded:"Banded Rows",textColBanded:"Banded Columns",capBlankRows:"Blank Rows",mniInsertBlankLine:"Insert Blank Line after Each Item",mniRemoveBlankLine:"Remove Blank Line after Each Item",capGrandTotals:"Grand Totals",mniOffTotals:"Off for Rows and Columns",mniOnTotals:"On for Rows and Columns",mniOnRowsTotals:"On for Rows Only",mniOnColumnsTotals:"On for Columns Only",capLayout:"Report Layout",capSubtotals:"Subtotals",mniLayoutCompact:"Show in Compact Form",mniLayoutOutline:"Show in Outline Form",mniLayoutTabular:"Show in Tabular Form",mniLayoutRepeat:"Repeat All Item Labels",mniLayoutNoRepeat:"Don't Repeat All Item Labels",mniNoSubtotals:"Don't Show Subtotals",mniBottomSubtotals:"Show all Subtotals at Bottom of Group",mniTopSubtotals:"Show all Subtotals at Top of Group",txtRefresh:"Refresh",txtRefreshAll:"Refresh All",tipRefreshCurrent:"Update the information from data source for the current table",tipRefresh:"Update the information from data source",tipGrandTotals:"Show or hide grand totals",tipSubtotals:"Show or hide subtotals",txtSelect:"Select",txtCalculatedItems:"Calculated Items",tipCalculatedItems:"Calculated items",txtExpandEntire:"Expand Entire Field",txtCollapseEntire:"Collapse Entire Field",tipSelect:"Select entire pivot table",txtPivotTable:"Pivot Table",txtTable_PivotStyleMedium:"Pivot Table Style Medium",txtTable_PivotStyleDark:"Pivot Table Style Dark",txtTable_PivotStyleLight:"Pivot Table Style Light",txtGroupPivot_Custom:"Custom",txtGroupPivot_Light:"Light",txtGroupPivot_Medium:"Medium",txtGroupPivot_Dark:"Dark"}}(),SSE.Views.PivotTable||{}))})),define("spreadsheeteditor/main/app/controller/PivotTable",["core","spreadsheeteditor/main/app/view/PivotTable"],(function(){"use strict";SSE.Controllers.PivotTable=Backbone.Controller.extend(_.extend({models:[],views:["PivotTable"],sdkViewName:"#id_main",initialize:function(){this.addListeners({PivotTable:{"pivottable:rowscolumns":_.bind(this.onCheckTemplateChange,this),"pivottable:create":_.bind(this.onCreateClick,this),"pivottable:refresh":_.bind(this.onRefreshClick,this),"pivottable:select":_.bind(this.onSelectClick,this),"pivottable:calculated":_.bind(this.onCalculatedClick,this),"pivottable:expand":_.bind(this.onExpandClick,this),"pivottable:collapse":_.bind(this.onCollapseClick,this),"pivottable:style":_.bind(this.onPivotStyleSelect,this),"pivottable:layout":_.bind(this.onPivotLayout,this),"pivottable:blankrows":_.bind(this.onPivotBlankRows,this),"pivottable:subtotals":_.bind(this.onPivotSubtotals,this),"pivottable:grandtotals":_.bind(this.onPivotGrandTotals,this),"pivot:open":_.bind(this.onPivotOpen,this)},TableSettings:{"pivottable:create":_.bind(this.onCreateClick,this)},Toolbar:{"tab:active":_.bind(this.onActiveTab,this)}})},onLaunch:function(){this._state={TableName:"",TemplateName:"",RowHeader:void 0,RowBanded:void 0,ColHeader:void 0,ColBanded:void 0,DisabledControls:!1},this._originalProps=null,Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.SetDisabled,this)),Common.NotificationCenter.on("more:toggle",_.bind(this.onMoreToggle,this))},setConfig:function(t){this.view=this.createView("PivotTable",{toolbar:t.toolbar.toolbar})},setApi:function(t){return t&&(this.api=t,this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.SetDisabled,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.SetDisabled,this)),this.api.asc_registerCallback("asc_onSendThemeColors",_.bind(this.onSendThemeColors,this)),this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onSelectionChanged,this)),Common.NotificationCenter.on("cells:range",_.bind(this.onCellsRange,this))),this},setMode:function(t){return this.appConfig=t,this},SetDisabled:function(){this.view&&this.view.SetDisabled(!0)},onCheckTemplateChange:function(t,e){switch(t){case 0:this._originalProps.asc_getStyleInfo().asc_setShowRowHeaders(this.api,this._originalProps,"checked"==e);break;case 1:this._originalProps.asc_getStyleInfo().asc_setShowColHeaders(this.api,this._originalProps,"checked"==e);break;case 2:this._originalProps.asc_getStyleInfo().asc_setShowRowStripes(this.api,this._originalProps,"checked"==e);break;case 3:this._originalProps.asc_getStyleInfo().asc_setShowColStripes(this.api,this._originalProps,"checked"==e)}Common.NotificationCenter.trigger("edit:complete",this)},createSheetName:function(){for(var t=[],e=this.api.asc_getWorksheetsCount();e--;)t.push(this.api.asc_getWorksheetName(e).toLowerCase());for(var i,o=0;++o<1e3&&(i=this.strSheet+o,!(t.indexOf(i.toLowerCase())<0)););return i},onCreateClick:function(t,e){if(this.api){var i=this.api.asc_getAddPivotTableOptions();if(i){var o=this;new SSE.Views.CreatePivotDialog({props:i,api:o.api,handler:function(t,e){"ok"==t&&e&&(o.view&&o.view.fireEvent("insertpivot",o.view),e.destination?o.api.asc_insertPivotExistingWorksheet(e.source,e.destination):o.api.asc_insertPivotNewWorksheet(e.source,o.createSheetName())),Common.NotificationCenter.trigger("edit:complete",o)}}).show()}}Common.NotificationCenter.trigger("edit:complete",this)},onRefreshClick:function(t){this.api&&("current"==t?this._originalProps.asc_refresh(this.api):"all"==t&&this.api.asc_refreshAllPivots()),Common.NotificationCenter.trigger("edit:complete",this)},onSelectClick:function(t,e){this.api&&this._originalProps.asc_select(this.api),Common.NotificationCenter.trigger("edit:complete",this)},onCalculatedClick:function(t,e){var i=this,o=this.api.asc_getCellInfo().asc_getPivotTableInfo(),n=o.asc_getFieldIndexByActiveCell(),s=o.asc_hasTablesErrorForCalculatedItems(n);function a(t){var e="";switch(t){case Asc.c_oAscError.ID.PivotItemNameNotFound:e=i.txtPivotItemNameNotFound;break;case Asc.c_oAscError.ID.CalculatedItemInPageField:e=i.txtCalculatedItemInPageField;break;case Asc.c_oAscError.ID.NotUniqueFieldWithCalculated:e=i.txtNotUniqueFieldWithCalculated;break;case Asc.c_oAscError.ID.WrongDataFieldSubtotalForCalculatedItems:e=i.txtWrongDataFieldSubtotalForCalculatedItems;break;case Asc.c_oAscError.ID.PivotFieldCustomSubtotalsWithCalculatedItems:e=i.txtPivotFieldCustomSubtotalsWithCalculatedItems;break;default:e=i.txtCalculatedItemWarningDefault}return e}function r(t){Common.UI.warning({msg:a(t),maxwidth:600})}if(s)r(s);else{var l=new SSE.Views.PivotCalculatedItemsDialog({api:this.api,handlerWarning:function(t){r(t)},getWarningMessage:a});l.show()}},onExpandClick:function(){this.api&&this._originalProps.asc_setExpandCollapseByActiveCell(this.api,!0,!0),Common.NotificationCenter.trigger("edit:complete",this)},onCollapseClick:function(){this.api&&this._originalProps.asc_setExpandCollapseByActiveCell(this.api,!0,!1),Common.NotificationCenter.trigger("edit:complete",this)},onPivotStyleSelect:function(t){this.api&&this._originalProps.asc_getStyleInfo().asc_setName(this.api,this._originalProps,t.get("name")),Common.NotificationCenter.trigger("edit:complete",this)},onPivotBlankRows:function(t){if(this.api){var e=new Asc.CT_pivotTableDefinition;e.asc_setInsertBlankRow("insert"===t),this._originalProps.asc_set(this.api,e)}Common.NotificationCenter.trigger("edit:complete",this)},onPivotLayout:function(t){if(this.api){var e=new Asc.CT_pivotTableDefinition;switch(t){case 0:e.asc_setCompact(!0),e.asc_setOutline(!0);break;case 1:e.asc_setCompact(!1),e.asc_setOutline(!0);break;case 2:e.asc_setCompact(!1),e.asc_setOutline(!1);break;case 3:e.asc_setFillDownLabelsDefault(!0);break;case 4:e.asc_setFillDownLabelsDefault(!1)}this._originalProps.asc_set(this.api,e)}Common.NotificationCenter.trigger("edit:complete",this)},onPivotGrandTotals:function(t){if(this.api){var e=new Asc.CT_pivotTableDefinition;e.asc_setColGrandTotals(1==t||2==t),e.asc_setRowGrandTotals(1==t||3==t),this._originalProps.asc_set(this.api,e)}Common.NotificationCenter.trigger("edit:complete",this)},onPivotSubtotals:function(t){if(this.api){var e=new Asc.CT_pivotTableDefinition;switch(t){case 0:e.asc_setDefaultSubtotal(!1);break;case 1:e.asc_setDefaultSubtotal(!0),e.asc_setSubtotalTop(!1);break;case 2:e.asc_setDefaultSubtotal(!0),e.asc_setSubtotalTop(!0)}this._originalProps.asc_set(this.api,e)}Common.NotificationCenter.trigger("edit:complete",this)},ChangeSettings:function(t){if(t){this._originalProps=t;var e=this.view,i=!1,o=t.asc_getStyleInfo(),n=o.asc_getShowRowHeaders();if(this._state.RowHeader!==n&&(e.chRowHeader.setValue(n,!0),this._state.RowHeader=n,i=!0),n=o.asc_getShowColHeaders(),this._state.ColHeader!==n&&(e.chColHeader.setValue(n,!0),this._state.ColHeader=n,i=!0),n=o.asc_getShowColStripes(),this._state.ColBanded!==n&&(e.chColBanded.setValue(n,!0),this._state.ColBanded=n,i=!0),n=o.asc_getShowRowStripes(),this._state.RowBanded!==n&&(e.chRowBanded.setValue(n,!0),this._state.RowBanded=n,i=!0),n=t.asc_getColGrandTotals(),this._state.ColGrandTotals!==n&&(this._state.ColGrandTotals=n,i=!0),n=t.asc_getRowGrandTotals(),this._state.RowGrandTotals!==n&&(this._state.RowGrandTotals=n,i=!0),i&&this.onApiInitPivotStyles(this.api.asc_getTablePictures(this._originalProps,!0)),n=o.asc_getName(),this._state.TemplateName!==n||this._isTemplatesChanged){e.pivotStyles.suspendEvents();var s=e.pivotStyles.menuPicker.store.findWhere({name:n});e.pivotStyles.menuPicker.selectRecord(s),e.pivotStyles.resumeEvents(),this._isTemplatesChanged&&(s?e.pivotStyles.fillComboView(e.pivotStyles.menuPicker.getSelectedRec(),!0):e.pivotStyles.fillComboView(e.pivotStyles.menuPicker.store.at(0),!0)),this._state.TemplateName=n}this._isTemplatesChanged=!1}},onSendThemeColors:function(){this.view.pivotStyles&&this._originalProps&&(this.onApiInitPivotStyles(this.api.asc_getTablePictures(this._originalProps,!0)),this.view.pivotStyles.menuPicker.scroller.update({alwaysVisibleY:!0}))},onApiInitPivotStyles:function(t){var e=this,i=this.view.pivotStyles;this._isTemplatesChanged=!0;var o=i.menuPicker.store.length;if(o>0&&o==t.length){var n=i.menuPicker.dataViewItems;n&&_.each(t,(function(t,e){var i=t.asc_getImage(),o=function(t){for(var e=0;e<n.length;e++){if(n[e].model.get("name")&&n[e].model.get("name")===t.asc_getName())return n[e];if(n[e].model.get("caption")===t.asc_getDisplayName())return n[e]}}(t);o&&o.model.set("imageUrl",i,{silent:!0}),o&&$(o.el).find("img").attr("src",i)})),i.fieldPicker.store.reset(i.fieldPicker.store.models)}else{i.menuPicker.store.reset([]);var s=[],a=[{id:"menu-table-group-custom",caption:e.view.txtGroupPivot_Custom,templates:[]},{id:"menu-table-group-light",caption:e.view.txtGroupPivot_Light,templates:[]},{id:"menu-table-group-medium",caption:e.view.txtGroupPivot_Medium,templates:[]},{id:"menu-table-group-dark",caption:e.view.txtGroupPivot_Dark,templates:[]},{id:"menu-table-group-no-name",caption:"&nbsp",templates:[]}];_.each(t,(function(t,i){var o=t.asc_getDisplayName(),n="",s=null;if(0==t.asc_getType()){var r=o.split(" ");s=r.pop(),null===t.asc_getName()?n="menu-table-group-light":(r.length>0&&(n="menu-table-group-"+r[r.length-1].toLowerCase()),0==a.some((function(t){return t.id===n}))&&(n="menu-table-group-no-name")),r="txtTable_"+r.join(""),o=e.view[r]?e.view[r]+" "+s:o,s=parseInt(s)}else n="menu-table-group-custom";a.filter((function(t){return t.id==n}))[0].templates.push({id:Common.UI.getId(),name:t.asc_getName(),caption:t.asc_getDisplayName(),type:t.asc_getType(),imageUrl:t.asc_getImage(),group:n,allowSelected:!0,selected:!1,tip:o,numInGroup:null==s||isNaN(s)?null:s})}));var r=function(t,e){return t.numInGroup-e.numInGroup};a[1].templates.sort(r),a[2].templates.sort(r),a[3].templates.sort(r),(a=a.filter((function(t,e){return t.templates.length>0}))).forEach((function(t){s=s.concat(t.templates),delete t.templates})),i.groups.reset(a),i.menuPicker.store.reset(s)}},onPivotOpen:function(){var t,e=this.view.pivotStyles;e&&e.needFillComboView&&e.menuPicker.store.length>0&&e.rendered&&(this._state.TemplateName&&(t=e.menuPicker.store.findWhere({name:this._state.TemplateName})),e.fillComboView(t||e.menuPicker.store.at(0),!0))},onSelectionChanged:function(t){if(!this.rangeSelectionMode&&this.appConfig.isEdit&&this.view){var e=t.asc_getPivotTableInfo();Common.Utils.lockControls(Common.enumLock.noPivot,!e,{array:this.view.lockedControls}),Common.Utils.lockControls(Common.enumLock.pivotLock,e&&!0===t.asc_getLockedPivotTable(),{array:this.view.lockedControls}),Common.Utils.lockControls(Common.enumLock.editPivot,!!e,{array:this.view.btnsAddPivot}),Common.Utils.lockControls(Common.enumLock.pivotExpandLock,!(e&&e.asc_canExpandCollapseByActiveCell(this.api)),{array:[this.view.btnExpandField,this.view.btnCollapseField]}),Common.Utils.lockControls(Common.enumLock.pivotCalcItemsLock,!(e&&e.asc_canChangeCalculatedItemByActiveCell()),{array:[this.view.btnCalculatedItems]}),e&&this.ChangeSettings(e)}},onCellsRange:function(t){this.rangeSelectionMode=t!=Asc.c_oAscSelectionDialogType.None},createToolbarPanel:function(){return this.view.getPanel()},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onAppReady:function(t){new Promise((function(t){t()})).then((function(){}))},onMoreToggle:function(t,e,i){if(this.view&&this.view.toolbar&&this.view.toolbar.isTabActive("pivot")&&e){var o,n=this.view.pivotStyles;if(n&&n.needFillComboView&&n.menuPicker.store.length>0&&n.rendered)this._state.TemplateName&&(o=n.menuPicker.store.findWhere({name:this._state.TemplateName})),n.fillComboView(o||n.menuPicker.store.at(0),!0)}},onActiveTab:function(t){},strSheet:"Sheet",txtPivotItemNameNotFound:"An item name cannot be found. Check that you've typed name correctly and the item is present in the PivotTable report.",txtCalculatedItemInPageField:"The item cannot be added or modified. PivotTable report has this field in Filters.",txtNotUniqueFieldWithCalculated:"If one or more PivotTable have calculated items, no fields can be used in data area two or more times, or in the data area and another area at the same time.",txtWrongDataFieldSubtotalForCalculatedItems:"Averages, standard deviations, and variances are not supported when a PivotTable report has calculated items.",txtPivotFieldCustomSubtotalsWithCalculatedItems:"Calculated items do not work with custom subtotals.",txtCalculatedItemWarningDefault:"No actions with calculated items are allowed for this active cell."},SSE.Controllers.PivotTable||{}))})),define("spreadsheeteditor/main/app/controller/Toolbar",["core","common/main/lib/component/Window","common/main/lib/view/SearchBar","spreadsheeteditor/main/app/view/define","spreadsheeteditor/main/app/view/Toolbar","spreadsheeteditor/main/app/collection/TableTemplates","spreadsheeteditor/main/app/controller/PivotTable"],(function(){"use strict";SSE.Controllers.Toolbar=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["Toolbar"],initialize:function(){var t=this;this.addListeners({Toolbar:{"change:compact":this.onClickChangeCompact.bind(t),"add:chart":this.onSelectChart,"add:spark":this.onSelectSpark,"insert:textart":this.onInsertTextart,"change:scalespn":this.onClickChangeScaleInMenu.bind(t),"click:customscale":this.onScaleClick.bind(t),"home:open":this.onHomeOpen,"insert:smartart":this.onInsertSmartArt,"smartart:mouseenter":this.mouseenterSmartArt,"smartart:mouseleave":this.mouseleaveSmartArt,"tab:active":this.onActiveTab,"tab:click":this.onClickTab,"tab:collapse":this.onTabCollapse},FileMenu:{"menu:hide":t.onFileMenu.bind(t,"hide"),"menu:show":t.onFileMenu.bind(t,"show")},Statusbar:{"sheet:changed":_.bind(this.onApiSheetChanged,this)},"Common.Views.Header":{print:function(t){this.getApplication().getController("Main").onPrint()},"print-quick":function(t){this.getApplication().getController("Main").onPrintQuick()},save:function(t){this.api.asc_Save()},undo:this.onUndo,redo:this.onRedo,downloadas:function(t){var e,i=this.getApplication().getController("Main"),o=i.appOptions.spreadsheet.fileType;o&&(e=Asc.c_oAscFileType[o.toUpperCase()]);var n=[Asc.c_oAscFileType.XLSX,Asc.c_oAscFileType.ODS,Asc.c_oAscFileType.CSV,Asc.c_oAscFileType.PDFA,Asc.c_oAscFileType.XLTX,Asc.c_oAscFileType.OTS,Asc.c_oAscFileType.XLSB,Asc.c_oAscFileType.XLSM];(!e||n.indexOf(e)<0)&&(e=Asc.c_oAscFileType.PDF),e==Asc.c_oAscFileType.PDF||e==Asc.c_oAscFileType.PDFA?Common.NotificationCenter.trigger("download:settings",this.toolbar,e):i.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(e))},"go:editor":function(){Common.Gateway.requestEditRights()}},DataTab:{"data:sort":this.onSortType,"data:setfilter":this.onAutoFilter,"data:clearfilter":this.onClearFilter},FormulaTab:{"function:namedrange":this.onNamedRangeMenu,"function:namedrange-open":this.onNamedRangeMenuOpen},CellSettings:{"cf:init":this.onShowBeforeCondFormat},ViewTab:{"viewtab:showtoolbar":this.onChangeViewMode.bind(this)},LeftMenu:{"search:show":this.searchShow.bind(this)},PivotTable:{insertpivot:this.onInsertPivot}}),Common.NotificationCenter.on("page:settings",_.bind(this.onApiSheetChanged,this)),Common.NotificationCenter.on("formula:settings",_.bind(this.applyFormulaSettings,this)),Common.NotificationCenter.on("toolbar:collapse",_.bind((function(){this.toolbar.collapse()}),this)),Common.NotificationCenter.on("oleedit:close",_.bind(this.onOleEditClose,this)),Common.NotificationCenter.on("tab:set-active",_.bind((function(t){this.toolbar.setTab(t),this.onChangeViewMode(null,!1,!0)}),this)),this.editMode=!0,this._isAddingShape=!1,this._state={activated:!1,prstyle:void 0,clrtext:void 0,pralign:void 0,clrback:void 0,valign:void 0,can_undo:void 0,can_redo:void 0,bold:void 0,italic:void 0,underline:void 0,strikeout:void 0,subscript:void 0,superscript:void 0,wrap:void 0,merge:void 0,angle:void 0,controlsdisabled:{filters:void 0},selection_type:void 0,filter:void 0,filterapplied:!1,tablestylename:void 0,tablename:void 0,namedrange_locked:!1,fontsize:void 0,multiselect:!1,sparklines_disabled:!1,numformatinfo:void 0,numformattype:void 0,numformat:void 0,langId:void 0,pgsize:[0,0],pgmargins:void 0,pgorient:void 0,lock_doc:void 0,cf_locked:[],selectedCells:0,wsLock:!1,wsProps:[],is_lockText:!1,is_lockShape:!1,isUserProtected:!1,showPivotTab:!1},this.binding={};var e=function(e,i){var o=$(e.target),n=o.closest("#editor_sdk"),s=o.closest("button").attr("id");void 0===s&&(s=o.closest(".btn-group").attr("id")),t.api&&t.api.asc_isAddAutoshape()&&(n.length<=0||"cancel"==i)&&(t.toolbar.btnInsertText.pressed&&s!=t.toolbar.btnInsertText.id||t.toolbar.btnInsertShape.pressed&&s!=t.toolbar.btnInsertShape.id?(t._isAddingShape=!1,t._addAutoshape(!1),t.toolbar.btnInsertShape.toggle(!1,!0),t.toolbar.btnInsertText.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete",t.toolbar)):t.toolbar.btnInsertShape.pressed&&s==t.toolbar.btnInsertShape.id&&_.defer((function(){t.api.asc_endAddShape(),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}),100))};this.checkInsertAutoshape=function(t){e({},t.action)},this._addAutoshape=function(t,i){this.api&&(t?(this.api.asc_startAddShape(i),$(document.body).on("mouseup",e)):(this.api.asc_endAddShape(),$(document.body).off("mouseup",e)))},this.onApiEndAddShape=function(){this.toolbar.btnInsertShape.pressed&&this.toolbar.btnInsertShape.toggle(!1,!0),this.toolbar.btnInsertText.pressed&&(this.toolbar.btnInsertText.toggle(!1,!0),this.toolbar.btnInsertText.menu.clearAll(!0)),$(document.body).off("mouseup",e)}},onLaunch:function(){this.toolbar=this.createView("Toolbar"),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),Common.NotificationCenter.on("app:face",this.onAppShowed.bind(this))},setMode:function(t){var e=this.getApplication().getController("Main");this.mode=t,this.toolbar.applyLayout(t);var i=Common.UI.Themes.currentThemeId(),o="theme-system"===i||"theme-white"===i||"theme-night"===i,n={es:"https://www.onlyoffice.com/blog/es/2025/06/disponible-onlyoffice-docs-9-0",pt:"https://www.onlyoffice.com/blog/pt-br/2025/06/disponivel-onlyoffice-docs-9-0",zh:"https://www.onlyoffice.com/blog/zh-hans/2025/06/onlyoffice-docs-9-0-released",fr:"https://www.onlyoffice.com/blog/fr/2025/06/onlyoffice-docs-9-0-disponible",de:"https://www.onlyoffice.com/blog/de/2025/06/onlyoffice-docs-9-0-veroeffentlicht",it:"https://www.onlyoffice.com/blog/it/2025/06/disponibile-onlyoffice-docs-9-0",ja:"https://www.onlyoffice.com/blog/ja/2025/06/onlyoffice-docs-9-0-released"}[(t.lang||"en").toLowerCase().split(/[\-_]/)[0]]||"https://www.onlyoffice.com/blog/2025/06/onlyoffice-docs-9-0-released";!Common.Utils.isIE&&!Common.Controllers.Desktop.isWinXp()&&Common.UI.FeaturesManager.isFeatureEnabled("featuresTips",!0)&&Common.UI.TooltipManager.addTips({modernTheme:{name:"help-tip-modern-theme",placement:"bottom",offset:{x:10,y:0},text:o?this.helpOldTheme:this.helpModernTheme,header:this.helpModernThemeHeader,target:"li.ribtab #view",automove:!0,maxwidth:270,closable:!1,isNewFeature:!0,link:{text:e.textLearnMore,url:n}}}),Common.UI.FeaturesManager.isFeatureEnabled("featuresTips",!0)&&Common.UI.TooltipManager.addTips({asyncFunction:{name:"help-tip-async-func",placement:"bottom-left",text:this.helpAsyncFunc,header:this.helpAsyncFuncHeader,target:"#slot-btn-macros",automove:!0,maxwidth:270,closable:!1,isNewFeature:!0,link:{text:e.textLearnMore,url:n}}}),Common.UI.TooltipManager.addTips({refreshFile:{text:e.textUpdateVersion,header:e.textUpdating,target:"#toolbar",maxwidth:"none",showButton:!1,automove:!0,noHighlight:!0,multiple:!0},disconnect:{text:e.textConnectionLost,header:e.textDisconnect,target:"#toolbar",maxwidth:"none",showButton:!1,automove:!0,noHighlight:!0,multiple:!0},updateVersion:{text:e.errorUpdateVersionOnDisconnect,header:e.titleUpdateVersion,target:"#toolbar",maxwidth:600,showButton:!1,automove:!0,noHighlight:!0,multiple:!0},sessionIdle:{text:e.errorSessionIdle,target:"#toolbar",maxwidth:600,showButton:!1,automove:!0,noHighlight:!0,multiple:!0},sessionToken:{text:e.errorSessionToken,target:"#toolbar",maxwidth:600,showButton:!1,automove:!0,noHighlight:!0,multiple:!0}})},attachUIEvents:function(t){var e=this;e.appConfig.isEditDiagram?(t.btnUndo.on("click",_.bind(this.onUndo,this)),t.btnRedo.on("click",_.bind(this.onRedo,this)),t.btnCopy.on("click",_.bind(this.onCopyPaste,this,"copy")),t.btnPaste.on("click",_.bind(this.onCopyPaste,this,"paste")),t.btnInsertFormula.on("click",_.bind(this.onInsertFormulaMenu,this)),t.btnInsertFormula.menu.on("item:click",_.bind(this.onInsertFormulaMenu,this)),t.btnDecDecimal.on("click",_.bind(this.onDecrement,this)),t.btnIncDecimal.on("click",_.bind(this.onIncrement,this)),t.cmbNumberFormat.on("selected",_.bind(this.onNumberFormatSelect,this)),t.cmbNumberFormat.on("show:before",_.bind(this.onNumberFormatOpenBefore,this,!0)),t.cmbNumberFormat.cmpEl&&t.cmbNumberFormat.cmpEl.on("click","#id-toolbar-mnu-item-more-formats a",_.bind(this.onNumberFormatSelect,this)),t.btnEditChart.on("click",_.bind(this.onEditChart,this)),t.btnEditChartData.on("click",_.bind(this.onEditChartData,this)),t.btnEditChartType.on("click",_.bind(this.onEditChartType,this))):e.appConfig.isEditMailMerge?(t.btnUndo.on("click",_.bind(this.onUndo,this)),t.btnRedo.on("click",_.bind(this.onRedo,this)),t.btnCopy.on("click",_.bind(this.onCopyPaste,this,"copy")),t.btnPaste.on("click",_.bind(this.onCopyPaste,this,"paste")),t.btnSearch.on("toggle",_.bind(this.onSearch,this)),t.btnSortDown.on("click",_.bind(this.onSortType,this,Asc.c_oAscSortOptions.Ascending)),t.btnSortUp.on("click",_.bind(this.onSortType,this,Asc.c_oAscSortOptions.Descending)),t.btnSetAutofilter.on("click",_.bind(this.onAutoFilter,this)),t.btnClearAutofilter.on("click",_.bind(this.onClearFilter,this))):e.appConfig.isEditOle?(t.btnUndo.on("click",_.bind(this.onUndo,this)),t.btnRedo.on("click",_.bind(this.onRedo,this)),t.btnCopy.on("click",_.bind(this.onCopyPaste,this,"copy")),t.btnPaste.on("click",_.bind(this.onCopyPaste,this,"paste")),t.btnSearch.on("toggle",_.bind(this.onSearch,this)),t.btnInsertFormula.on("click",_.bind(this.onInsertFormulaMenu,this)),t.btnInsertFormula.menu.on("item:click",_.bind(this.onInsertFormulaMenu,this)),t.cmbNumberFormat.on("selected",_.bind(this.onNumberFormatSelect,this)),t.cmbNumberFormat.on("show:before",_.bind(this.onNumberFormatOpenBefore,this,!0)),t.cmbNumberFormat.cmpEl&&t.cmbNumberFormat.cmpEl.on("click","#id-toolbar-mnu-item-more-formats a",_.bind(this.onNumberFormatSelect,this)),t.btnWrap.on("click",_.bind(this.onWrap,this)),t.btnTextColor.on("click",_.bind(this.onTextColor,this)),t.btnTextColor.on("color:select",_.bind(this.onTextColorSelect,this)),t.btnTextColor.on("auto:select",_.bind(this.onAutoFontColor,this)),t.btnTextColor.on("eyedropper:start",_.bind(this.onEyedropperStart,this)),t.btnTextColor.on("eyedropper:end",_.bind(this.onEyedropperEnd,this)),t.btnBackColor.on("click",_.bind(this.onBackColor,this)),t.btnBackColor.on("color:select",_.bind(this.onBackColorSelect,this)),t.btnBackColor.on("eyedropper:start",_.bind(this.onEyedropperStart,this)),t.btnBackColor.on("eyedropper:end",_.bind(this.onEyedropperEnd,this)),t.btnBorders.on("click",_.bind(this.onBorders,this)),t.btnBorders.rendered&&(t.btnBorders.menu.on("item:click",_.bind(this.onBordersMenu,this)),t.mnuBorderWidth.on("item:toggle",_.bind(this.onBordersWidth,this)),t.mnuBorderColorPicker.on("select",_.bind(this.onBordersColor,this)),$("#id-toolbar-menu-auto-bordercolor").on("click",_.bind(this.onAutoBorderColor,this))),t.btnMerge.on("click",_.bind(this.onMergeCellsMenu,this,t.btnMerge.menu,t.btnMerge.menu.items[0])),t.btnMerge.menu.on("item:click",_.bind(this.onMergeCellsMenu,this)),t.btnTableTemplate.menu.on("show:after",_.bind(this.onTableTplMenuOpen,this)),t.btnCellStyle.menu.on("show:after",_.bind(this.onCellStyleMenuOpen,this)),t.btnVisibleArea.menu.on("item:click",_.bind(this.onVisibleAreaMenu,this)),t.btnVisibleAreaClose.on("click",_.bind(this.onVisibleAreaClose,this)),t.cmbFontName.on("selected",_.bind(this.onFontNameSelect,this)),t.cmbFontName.on("show:after",_.bind(this.onComboOpen,this,!0)),t.cmbFontName.on("hide:after",_.bind(this.onHideMenus,this)),t.cmbFontName.on("combo:blur",_.bind(this.onComboBlur,this)),t.cmbFontName.on("combo:focusin",_.bind(this.onComboOpen,this,!1)),t.cmbFontSize.on("selected",_.bind(this.onFontSizeSelect,this)),t.cmbFontSize.on("changed:before",_.bind(this.onFontSizeChanged,this,!0)),t.cmbFontSize.on("changed:after",_.bind(this.onFontSizeChanged,this,!1)),t.cmbFontSize.on("show:after",_.bind(this.onComboOpen,this,!0)),t.cmbFontSize.on("hide:after",_.bind(this.onHideMenus,this)),t.cmbFontSize.on("combo:blur",_.bind(this.onComboBlur,this)),t.cmbFontSize.on("combo:focusin",_.bind(this.onComboOpen,this,!1)),t.btnTextFormatting.menu.on("item:click",_.bind(this.onTextFormattingMenu,this)),t.btnHorizontalAlign.menu.on("item:click",_.bind(this.onHorizontalAlignMenu,this)),t.btnVerticalAlign.menu.on("item:click",_.bind(this.onVerticalAlignMenu,this))):(t.btnPrint.on("click",_.bind(this.onPrint,this)),t.btnPrint.on("disabled",_.bind(this.onBtnChangeState,this,"print:disabled")),t.btnPrint.menu&&t.btnPrint.menu.on("item:click",_.bind(this.onPrintMenu,this)),t.btnSave.on("click",_.bind(this.onSave,this)),t.btnSave.on("disabled",_.bind(this.onBtnChangeState,this,"save:disabled")),t.btnUndo.on("click",_.bind(this.onUndo,this)),t.btnUndo.on("disabled",_.bind(this.onBtnChangeState,this,"undo:disabled")),t.btnRedo.on("click",_.bind(this.onRedo,this)),t.btnRedo.on("disabled",_.bind(this.onBtnChangeState,this,"redo:disabled")),t.btnCopy.on("click",_.bind(this.onCopyPaste,this,"copy")),t.btnPaste.on("click",_.bind(this.onCopyPaste,this,"paste")),t.btnCut.on("click",_.bind(this.onCopyPaste,this,"cut")),t.btnSelectAll.on("click",_.bind(this.onSelectAll,this)),t.btnReplace.on("click",_.bind(this.onReplace,this)),t.btnIncFontSize.on("click",_.bind(this.onIncreaseFontSize,this)),t.btnDecFontSize.on("click",_.bind(this.onDecreaseFontSize,this)),t.mnuChangeCase.on("item:click",_.bind(this.onChangeCase,this)),t.btnBold.on("click",_.bind(this.onBold,this)),t.btnItalic.on("click",_.bind(this.onItalic,this)),t.btnUnderline.on("click",_.bind(this.onUnderline,this)),t.btnStrikeout.on("click",_.bind(this.onStrikeout,this)),t.btnSubscript.on("click",_.bind(this.onSubscript,this)),t.btnSubscript.menu.on("item:click",_.bind(this.onSubscriptMenu,this)),t.btnTextColor.on("click",_.bind(this.onTextColor,this)),t.btnTextColor.on("color:select",_.bind(this.onTextColorSelect,this)),t.btnTextColor.on("auto:select",_.bind(this.onAutoFontColor,this)),t.btnTextColor.on("eyedropper:start",_.bind(this.onEyedropperStart,this)),t.btnTextColor.on("eyedropper:end",_.bind(this.onEyedropperEnd,this)),t.btnBackColor.on("click",_.bind(this.onBackColor,this)),t.btnBackColor.on("color:select",_.bind(this.onBackColorSelect,this)),t.btnBackColor.on("eyedropper:start",_.bind(this.onEyedropperStart,this)),t.btnBackColor.on("eyedropper:end",_.bind(this.onEyedropperEnd,this)),t.mnuFormatCellFill&&t.mnuFormatCellFill.on("click",_.bind(this.onFormatCellFill,this)),this.mode.isEdit&&Common.NotificationCenter.on("eyedropper:start",_.bind(this.eyedropperStart,this)),t.btnBorders.on("click",_.bind(this.onBorders,this)),t.btnBorders.rendered&&(t.btnBorders.menu.on("item:click",_.bind(this.onBordersMenu,this)),t.mnuBorderWidth.on("item:toggle",_.bind(this.onBordersWidth,this)),t.mnuBorderColorPicker.on("select",_.bind(this.onBordersColor,this)),$("#id-toolbar-menu-auto-bordercolor").on("click",_.bind(this.onAutoBorderColor,this))),t.btnAlignLeft.on("click",_.bind(this.onHorizontalAlign,this,AscCommon.align_Left)),t.btnAlignCenter.on("click",_.bind(this.onHorizontalAlign,this,AscCommon.align_Center)),t.btnAlignRight.on("click",_.bind(this.onHorizontalAlign,this,AscCommon.align_Right)),t.btnAlignJust.on("click",_.bind(this.onHorizontalAlign,this,AscCommon.align_Justify)),t.btnMerge.on("click",_.bind(this.onMergeCellsMenu,this,t.btnMerge.menu,t.btnMerge.menu.items[0])),t.btnMerge.menu.on("item:click",_.bind(this.onMergeCellsMenu,this)),t.btnAlignTop.on("click",_.bind(this.onVerticalAlign,this,Asc.c_oAscVAlign.Top)),t.btnAlignMiddle.on("click",_.bind(this.onVerticalAlign,this,Asc.c_oAscVAlign.Center)),t.btnAlignBottom.on("click",_.bind(this.onVerticalAlign,this,Asc.c_oAscVAlign.Bottom)),t.btnWrap.on("click",_.bind(this.onWrap,this)),t.btnTextOrient.menu.on("item:click",_.bind(this.onTextOrientationMenu,this)),t.btnInsertTable.on("click",_.bind(this.onBtnInsertTableClick,this)),t.btnInsertImage.menu.on("item:click",_.bind(this.onInsertImageMenu,this)),t.btnInsertHyperlink.on("click",_.bind(this.onHyperlink,this)),t.btnInsertText.on("click",_.bind(this.onBtnInsertTextClick,this)),t.btnInsertText.menu.on("item:click",_.bind(this.onMenuInsertTextClick,this)),t.btnInsertShape.menu.on("hide:after",_.bind(this.onInsertShapeHide,this)),t.btnInsertEquation.on("click",_.bind(this.onInsertEquationClick,this)),t.btnInsertSymbol.menu.items[2].on("click",_.bind(this.onInsertSymbolClick,this)),t.mnuInsertSymbolsPicker.on("item:click",_.bind(this.onInsertSymbolItemClick,this)),t.btnInsertSlicer.on("click",_.bind(this.onInsertSlicerClick,this)),t.btnTableTemplate.menu.on("show:after",_.bind(this.onTableTplMenuOpen,this)),t.btnPercentStyle.on("click",_.bind(this.onNumberFormat,this)),t.btnCommaStyle.on("click",_.bind(this.onNumberFormat,this)),t.btnCurrencyStyle.on("click",_.bind(this.onNumberFormat,this)),t.btnDecDecimal.on("click",_.bind(this.onDecrement,this)),t.btnIncDecimal.on("click",_.bind(this.onIncrement,this)),t.btnInsertFormula.on("click",_.bind(this.onInsertFormulaMenu,this)),t.btnInsertFormula.menu.on("item:click",_.bind(this.onInsertFormulaMenu,this)),t.btnNamedRange.menu.on("item:click",_.bind(this.onNamedRangeMenu,this)),t.btnNamedRange.menu.on("show:after",_.bind(this.onNamedRangeMenuOpen,this)),t.btnClearStyle.menu.on("item:click",_.bind(this.onClearStyleMenu,this)),t.btnAddCell.menu.on("item:click",_.bind(this.onCellInsertMenu,this)),t.btnCopyStyle.on("toggle",_.bind(this.onCopyStyleToggle,this)),t.btnDeleteCell.menu.on("item:click",_.bind(this.onCellDeleteMenu,this)),t.btnColorSchemas.menu.on("item:click",_.bind(this.onColorSchemaClick,this)),t.btnColorSchemas.menu.on("show:after",_.bind(this.onColorSchemaShow,this)),t.cmbFontName.on("selected",_.bind(this.onFontNameSelect,this)),t.cmbFontName.on("show:after",_.bind(this.onComboOpen,this,!0)),t.cmbFontName.on("hide:after",_.bind(this.onHideMenus,this)),t.cmbFontName.on("combo:blur",_.bind(this.onComboBlur,this)),t.cmbFontName.on("combo:focusin",_.bind(this.onComboOpen,this,!1)),t.cmbFontSize.on("selected",_.bind(this.onFontSizeSelect,this)),t.cmbFontSize.on("changed:before",_.bind(this.onFontSizeChanged,this,!0)),t.cmbFontSize.on("changed:after",_.bind(this.onFontSizeChanged,this,!1)),t.cmbFontSize.on("show:after",_.bind(this.onComboOpen,this,!0)),t.cmbFontSize.on("hide:after",_.bind(this.onHideMenus,this)),t.cmbFontSize.on("combo:blur",_.bind(this.onComboBlur,this)),t.cmbFontSize.on("combo:focusin",_.bind(this.onComboOpen,this,!1)),t.listStyles.on("click",_.bind(this.onListStyleSelect,this)),t.cmbNumberFormat.on("selected",_.bind(this.onNumberFormatSelect,this)),t.cmbNumberFormat.on("show:before",_.bind(this.onNumberFormatOpenBefore,this,!0)),t.cmbNumberFormat.cmpEl&&t.cmbNumberFormat.cmpEl.on("click","#id-toolbar-mnu-item-more-formats a",_.bind(this.onNumberFormatSelect,this)),t.btnCurrencyStyle.menu.on("item:click",_.bind(this.onNumberFormatMenu,this)),$("#id-toolbar-menu-new-bordercolor").on("click",_.bind(this.onNewBorderColor,this)),t.btnPageOrient.menu.on("item:click",_.bind(this.onPageOrientSelect,this)),t.btnPageMargins.menu.on("item:click",_.bind(this.onPageMarginsSelect,this)),t.mnuPageSize.on("item:click",_.bind(this.onPageSizeClick,this)),t.mnuScale.on("item:click",_.bind(this.onScaleClick,this,"scale")),t.menuWidthScale.on("item:click",_.bind(this.onScaleClick,this,"width")),t.menuHeightScale.on("item:click",_.bind(this.onScaleClick,this,"height")),t.btnPrintArea.menu.on("item:click",_.bind(this.onPrintAreaClick,this)),t.btnPrintArea.menu.on("show:after",_.bind(this.onPrintAreaMenuOpen,this)),t.btnPageBreak.menu.on("item:click",_.bind(this.onPageBreakClick,this)),t.btnPageBreak.menu.on("show:after",_.bind(this.onPageBreakMenuOpen,this)),t.btnImgGroup.menu.on("item:click",_.bind(this.onImgGroupSelect,this)),t.btnShapesMerge.menu.on("item:click",_.bind(this.onClickMenuShapesMerge,this)),t.btnShapesMerge.menu.on("show:before",_.bind(this.onBeforeShapesMerge,this)),t.btnImgBackward.menu.on("item:click",_.bind(this.onImgArrangeSelect,this)),t.btnImgForward.menu.on("item:click",_.bind(this.onImgArrangeSelect,this)),t.btnImgAlign.menu.on("item:click",_.bind(this.onImgAlignSelect,this)),t.btnImgForward.on("click",this.onImgArrangeSelect.bind(this,"forward")),t.btnImgBackward.on("click",this.onImgArrangeSelect.bind(this,"backward")),t.btnsEditHeader.forEach((function(t){t.on("click",_.bind(e.onEditHeaderClick,e,void 0))})),t.btnPrintTitles.on("click",_.bind(this.onPrintTitlesClick,this)),t.chPrintGridlines.on("change",_.bind(this.onPrintGridlinesChange,this)),t.chPrintHeadings.on("change",_.bind(this.onPrintHeadingsChange,this)),t.btnRtlSheet.on("click",_.bind(this.onRtlSheetClick,this)),t.btnCondFormat.rendered&&t.btnCondFormat.menu.on("show:before",_.bind(this.onShowBeforeCondFormat,this,this.toolbar,"toolbar")),t.btnInsertChartRecommend.on("click",_.bind(this.onChartRecommendedClick,this)),t.btnFillNumbers.menu.on("item:click",_.bind(this.onFillNumMenu,this)),t.btnFillNumbers.menu.on("show:before",_.bind(this.onShowBeforeFillNumMenu,this)),Common.Gateway.on("insertimage",_.bind(this.insertImage,this)),this.onSetupCopyStyleButton(),this.onBtnChangeState("undo:disabled",t.btnUndo,t.btnUndo.isDisabled()),this.onBtnChangeState("redo:disabled",t.btnRedo,t.btnRedo.isDisabled()),this.onBtnChangeState("save:disabled",t.btnSave,t.btnSave.isDisabled()))},setApi:function(t){this.api=t;var e=SSE.getController("Main").appOptions;e.isEdit?(e.isEditDiagram||e.isEditMailMerge||e.isEditOle||(this.api.asc_registerCallback("asc_onSendThemeColors",_.bind(this.onSendThemeColors,this)),this.api.asc_registerCallback("asc_onMathTypes",_.bind(this.onApiMathTypes,this)),this.api.asc_registerCallback("asc_onContextMenu",_.bind(this.onContextMenu,this)),Common.NotificationCenter.on("storage:image-load",_.bind(this.openImageFromStorage,this)),Common.NotificationCenter.on("storage:image-insert",_.bind(this.insertImageFromStorage,this)),this.api.asc_registerCallback("asc_onSelectionMathChanged",_.bind(this.onApiMathChanged,this))),this.api.asc_registerCallback("asc_onInitEditorStyles",_.bind(this.onApiInitEditorStyles,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onApiCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiCoAuthoringDisconnect,this)),this.api.asc_registerCallback("asc_onLockDefNameManager",_.bind(this.onLockDefNameManager,this)),this.api.asc_registerCallback("asc_onLockCFManager",_.bind(this.onLockCFManager,this)),this.api.asc_registerCallback("asc_onUnLockCFManager",_.bind(this.onUnLockCFManager,this)),this.api.asc_registerCallback("asc_onZoomChanged",_.bind(this.onApiZoomChange,this)),Common.NotificationCenter.on("fonts:change",_.bind(this.onApiChangeFont,this)),this.api.asc_registerCallback("asc_onBeginSmartArtPreview",_.bind(this.onApiBeginSmartArtPreview,this)),this.api.asc_registerCallback("asc_onAddSmartArtPreview",_.bind(this.onApiAddSmartArtPreview,this)),this.api.asc_registerCallback("asc_onEndSmartArtPreview",_.bind(this.onApiEndSmartArtPreview,this))):e.isEditOle?Common.NotificationCenter.on("fonts:change",_.bind(this.onApiChangeFont,this)):e.isRestrictedEdit&&(this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onApiSelectionChangedRestricted,this)),Common.NotificationCenter.on("protect:wslock",_.bind(this.onChangeProtectSheet,this))),e.isEditDiagram||e.isEditMailMerge||e.isEditOle||this.api.asc_registerCallback("onPluginToolbarMenu",_.bind(this.onPluginToolbarMenu,this)),this.api.asc_registerCallback("onPluginToolbarCustomMenuItems",_.bind(this.onPluginToolbarCustomMenuItems,this)),this.api.asc_registerCallback("onPluginUpdateToolbarMenu",_.bind(this.onPluginUpdateToolbarMenu,this)),Common.NotificationCenter.on("document:ready",_.bind(this.onDocumentReady,this))},onApiChangeFont:function(t){!Common.Utils.ModalWindow.isVisible()&&this.toolbar.cmbFontName.onApiChangeFont(t)},onContextMenu:function(){this.toolbar.collapse()},onPrint:function(t){"print"==this.toolbar.btnPrint.options.printType?Common.NotificationCenter.trigger("print",this.toolbar):this.getApplication().getController("Main").onPrintQuick()},onPrintMenu:function(t,e){var i=this.toolbar.btnPrint.options.printType,o=e.value;o!=i&&(this.toolbar.btnPrint.changeIcon({next:e.options.iconClsForMainBtn,curr:this.toolbar.btnPrint.menu.items.filter((function(t){return t.value==i}))[0].options.iconClsForMainBtn}),this.toolbar.btnPrint.updateHint([e.caption+e.options.platformKey]),this.toolbar.btnPrint.options.printType=o),this.onPrint(e)},onSave:function(t){if(this.api){var e=this.api.asc_isDocumentCanSave(),i=this.toolbar.btnCollabChanges&&this.toolbar.btnCollabChanges.cmpEl.hasClass("notify");if(!(e||i||this.toolbar.mode.forcesave||this.toolbar.mode.canSaveDocumentToBinary))return;this.api.asc_Save()}Common.component.Analytics.trackEvent("Save"),Common.component.Analytics.trackEvent("ToolBar","Save")},onBtnChangeState:function(t){if(/\:disabled$/.test(t)){var e=arguments[2];this.toolbar.fireEvent(t,[e])}},onUndo:function(t,e){this.api&&this.api.asc_Undo(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Undo")},onRedo:function(t,e){this.api&&this.api.asc_Redo(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Redo")},onCopyPaste:function(t,e){var i=this;if(i.api)if("cut"===t?i.api.asc_Cut():"copy"===t?i.api.asc_Copy():i.api.asc_Paste())Common.component.Analytics.trackEvent("ToolBar","Copy Warning");else{var o=Common.localStorage.getItem("sse-hide-copywarning");o&&1==parseInt(o)||new Common.Views.CopyWarningDialog({handler:function(t){t&&Common.localStorage.setItem("sse-hide-copywarning",1),Common.NotificationCenter.trigger("edit:complete",i.toolbar)}}).show()}Common.NotificationCenter.trigger("edit:complete",i.toolbar)},onSelectAll:function(t){this.api&&this.api.asc_EditSelectAll(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Select All")},onReplace:function(t){this.getApplication().getController("LeftMenu").onShortcut("replace")},onIncreaseFontSize:function(t){this.api&&this.api.asc_increaseFontSize(),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Font Size")},onDecreaseFontSize:function(t){this.api&&this.api.asc_decreaseFontSize(),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Font Size")},onChangeCase:function(t,e,i){this.api&&this.api.asc_ChangeTextCase(e.value),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0})},onBold:function(t,e){this._state.bold=void 0,this.api&&this.api.asc_setCellBold(t.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Bold")},onItalic:function(t,e){this._state.italic=void 0,this.api&&this.api.asc_setCellItalic(t.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Italic")},onUnderline:function(t,e){this._state.underline=void 0,this.api&&this.api.asc_setCellUnderline(t.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Underline")},onStrikeout:function(t,e){this._state.strikeout=void 0,this.api&&this.api.asc_setCellStrikeout(t.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Strikeout")},onSubscriptMenu:function(t,e){var i=this.toolbar.btnSubscript;"sub"==e.value?(this._state.subscript=void 0,this.api.asc_setCellSubscript(e.checked)):(this._state.superscript=void 0,this.api.asc_setCellSuperscript(e.checked)),e.checked&&(i.$icon.removeClass(i.options.icls).addClass(e.options.icls),i.options.icls=e.options.icls),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","sub"==e.value?"Subscript":"Superscript")},onSubscript:function(t,e){var i="btn-subscript"==t.options.icls;i?(this._state.subscript=void 0,this.api.asc_setCellSubscript(t.pressed)):(this._state.superscript=void 0,this.api.asc_setCellSuperscript(t.pressed)),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar",i?"Subscript":"Superscript")},onTextColor:function(){this.toolbar.mnuTextColorPicker.trigger("select",this.toolbar.mnuTextColorPicker,this.toolbar.mnuTextColorPicker.currentColor)},onBackColor:function(){this.toolbar.mnuBackColorPicker.trigger("select",this.toolbar.mnuBackColorPicker,this.toolbar.mnuBackColorPicker.currentColor)},onTextColorSelect:function(t,e){this._state.clrtext_asccolor=this._state.clrtext=void 0,this.toolbar.btnTextColor.currentColor=e,this.toolbar.mnuTextColorPicker.currentColor=e,this.api&&this.api.asc_setCellTextColor(e.isAuto?e.color:Common.Utils.ThemeColor.getRgbColor(e)),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Text Color")},onBackColorSelect:function(t,e){this._state.clrshd_asccolor=this._state.clrback=void 0,this.toolbar.btnBackColor.currentColor=e,this.toolbar.mnuBackColorPicker.currentColor=e,this.api&&this.api.asc_setCellBackgroundColor("transparent"==e?null:Common.Utils.ThemeColor.getRgbColor(e)),Common.component.Analytics.trackEvent("ToolBar","Background Color")},onFormatCellFill:function(t,e){this.getApplication().getController("RightMenu").onRightMenuOpen(Common.Utils.documentSettingsType.Cell)},onNewBorderColor:function(t,e){this.toolbar.btnBorders.menu.hide(),this.toolbar.btnBorders.toggle(!1,!0),this.toolbar.mnuBorderColorPicker.addNewColor()},onAutoFontColor:function(t){this._state.clrtext_asccolor=this._state.clrtext=void 0;var e=new Asc.asc_CColor;e.put_auto(!0),this.toolbar.btnTextColor.currentColor={color:e,isAuto:!0},this.toolbar.mnuTextColorPicker.currentColor={color:e,isAuto:!0},this.api&&this.api.asc_setCellTextColor(e),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Text Color")},onBorders:function(t){var e;_.each(t.menu.getItems(!0),(function(i){if(t.options.borderId==i.options.borderId)return e=i,!1})),e&&this.onBordersMenu(t.menu,e)},onBordersMenu:function(t,e){var i=this;if(i.api&&!_.isUndefined(e.options.borderId)){var o=i.toolbar.btnBorders,n=[],s=o.options.borderswidth,a=o.options.borderscolor;o.rendered&&(o.$icon.removeClass(o.options.icls).addClass(e.options.icls),o.options.icls=e.options.icls),o.options.borderId=e.options.borderId,"inner"==e.options.borderId?(n[Asc.c_oAscBorderOptions.InnerV]=new Asc.asc_CBorder(s,a),n[Asc.c_oAscBorderOptions.InnerH]=new Asc.asc_CBorder(s,a)):"all"==e.options.borderId?(n[Asc.c_oAscBorderOptions.InnerV]=new Asc.asc_CBorder(s,a),n[Asc.c_oAscBorderOptions.InnerH]=new Asc.asc_CBorder(s,a),n[Asc.c_oAscBorderOptions.Left]=new Asc.asc_CBorder(s,a),n[Asc.c_oAscBorderOptions.Top]=new Asc.asc_CBorder(s,a),n[Asc.c_oAscBorderOptions.Right]=new Asc.asc_CBorder(s,a),n[Asc.c_oAscBorderOptions.Bottom]=new Asc.asc_CBorder(s,a)):"outer"==e.options.borderId?(n[Asc.c_oAscBorderOptions.Left]=new Asc.asc_CBorder(s,a),n[Asc.c_oAscBorderOptions.Top]=new Asc.asc_CBorder(s,a),n[Asc.c_oAscBorderOptions.Right]=new Asc.asc_CBorder(s,a),n[Asc.c_oAscBorderOptions.Bottom]=new Asc.asc_CBorder(s,a)):"none"!=e.options.borderId&&(n[e.options.borderId]=new Asc.asc_CBorder(s,a)),i.api.asc_setCellBorders(n),Common.NotificationCenter.trigger("edit:complete",i.toolbar),Common.component.Analytics.trackEvent("ToolBar","Borders")}else"options"===e.value&&this.getApplication().getController("RightMenu").onRightMenuOpen(Common.Utils.documentSettingsType.Cell)},onBordersWidth:function(t,e,i){i&&(this.toolbar.btnBorders.options.borderswidth=e.value,Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Border Width"))},onBordersColor:function(t,e){$("#id-toolbar-mnu-item-border-color > a .menu-item-icon").css("border-color","#"+("object"==_typeof(e)?e.color:e)),this.toolbar.mnuBorderColor.onUnHoverItem(),this.toolbar.btnBorders.options.borderscolor=Common.Utils.ThemeColor.getRgbColor(e),this.toolbar.mnuBorderColorPicker.currentColor=e;var i=this.toolbar.btnBorders.menu.$el.find("#id-toolbar-menu-auto-bordercolor > a");i.hasClass("selected")&&i.removeClass("selected"),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Border Color")},onAutoBorderColor:function(t){$("#id-toolbar-mnu-item-border-color > a .menu-item-icon").css("border-color","#000"),this.toolbar.mnuBorderColor.onUnHoverItem();var e=new Asc.asc_CColor;e.put_auto(!0),this.toolbar.btnBorders.options.borderscolor=e,this.toolbar.mnuBorderColorPicker.clearSelection(),this.toolbar.mnuBorderColorPicker.currentColor={color:e,isAuto:!0};var i=this.toolbar.btnBorders.menu.$el.find("#id-toolbar-menu-auto-bordercolor > a");!i.hasClass("selected")&&i.addClass("selected"),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Border Color")},onHorizontalAlign:function(t,e,i){this._state.pralign=void 0,this.api&&(this.api.asc_setCellAlign(e.pressed?t:null),this.toolbar.btnWrap.allowDepress=!(t==AscCommon.align_Justify)),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Horizontal align")},onVerticalAlign:function(t,e,i){this._state.valign=void 0,this.api&&this.api.asc_setCellVertAlign(e.pressed?t:Asc.c_oAscVAlign.Bottom),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Vertical align")},onMergeCellsMenu:function(t,e){var i=this;function o(t){i._state.merge=void 0,i.api.asc_mergeCells(t),Common.NotificationCenter.trigger("edit:complete",i.toolbar),Common.component.Analytics.trackEvent("ToolBar","Merge")}i.api&&(i.api.asc_getCellInfo().asc_getMerge()!==Asc.c_oAscMergeOptions.Merge&&i.api.asc_mergeCellsDataLost(e.value)?Common.UI.warning({msg:i.warnMergeLostData,buttons:["yes","no"],primary:"yes",callback:function(t){"yes"==t?o(e.value):(i.toolbar.btnMerge.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete",i.toolbar),Common.component.Analytics.trackEvent("ToolBar","Merge"))}}):o(e.value));Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Merge cells")},onWrap:function(t,e){this._state.wrap=void 0,this.api&&this.api.asc_setCellTextWrap(t.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Wrap")},onTextOrientationMenu:function(t,e){var i=0;if("options"!==e.value){switch(e.value){case"countcw":i=45;break;case"clockwise":i=-45;break;case"vertical":i=255;break;case"rotateup":i=90;break;case"rotatedown":i=-90}this._state.angle=void 0,this.api&&this.api.asc_setCellAngle(i),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Text orientation")}else this.getApplication().getController("RightMenu").onRightMenuOpen(Common.Utils.documentSettingsType.Cell)},onBtnInsertTableClick:function(t,e){this.api&&this._setTableFormat(this.api.asc_getDefaultTableStyle()),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Table")},onInsertImageMenu:function(t,e,i){var o=this;"file"===e.value?(this.toolbar.fireEvent("insertimage",this.toolbar),this.api&&setTimeout((function(){o.api.asc_addImage()}),1),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Image")):"url"===e.value?new Common.Views.ImageFromUrlDialog({handler:function(t,e){if("ok"==t){if(o.api){var i=e.replace(/\s/g,"");_.isEmpty(i)||(o.toolbar.fireEvent("insertimage",o.toolbar),o.api.asc_addImageDrawingObject([i]),Common.component.Analytics.trackEvent("ToolBar","Image"))}Common.NotificationCenter.trigger("edit:complete",o.toolbar)}}}).show():"storage"===e.value&&Common.NotificationCenter.trigger("storage:image-load","add")},openImageFromStorage:function(t){var e=this;this.toolbar.mode.canRequestInsertImage?Common.Gateway.requestInsertImage(t):new Common.Views.SelectFileDlg({fileChoiceUrl:this.toolbar.mode.fileChoiceUrl.replace("{fileExt}","").replace("{documentType}","ImagesOnly")}).on("selectfile",(function(i,o){o&&(o.c=t),!o.images&&(o.images=[{fileType:o.fileType,url:o.url}]),o.url=null,e.insertImage(o)})).show()},insertImageFromStorage:function(t){!t||!t._urls||t.c&&"add"!=t.c||(this.toolbar.fireEvent("insertimage",this.toolbar),t._urls.length>0&&this.api.asc_addImageDrawingObject(t._urls,void 0,t.token),Common.component.Analytics.trackEvent("ToolBar","Image"))},insertImage:function(t){if(t&&(t.url||t.images)){t.url&&console.log("Obsolete: The 'url' parameter of the 'insertImage' method is deprecated. Please use 'images' parameter instead.");var e=[];if(t.images&&t.images.length>0)for(var i=0;i<t.images.length;i++)t.images[i]&&t.images[i].url&&e.push(t.images[i].url);else t.url&&e.push(t.url);t._urls=e}Common.NotificationCenter.trigger("storage:image-insert",t)},onHyperlink:function(t){Common.NotificationCenter.trigger("protect:check",this.onHyperlinkCallback,this,[t])},onHyperlinkCallback:function(t){var e,i,o=this;if(o.api){for(var n=o.api.asc_getWorksheetsCount(),s=-1,a=[];++s<n;)a.push({name:o.api.asc_getWorksheetName(s),hidden:o.api.asc_isWorksheetHidden(s)});var r=o.api.asc_getCellInfo(),l=r.asc_getSelectionType();i=r.asc_getHyperlink(),(e=new SSE.Views.HyperlinkSettingsDialog({api:o.api,appOptions:o.appOptions,handler:function(t,e){"ok"==e&&(i=t.getSettings(),o.api.asc_insertHyperlink(i)),Common.NotificationCenter.trigger("edit:complete",o.toolbar)}})).show(),e.setSettings({sheets:a,ranges:o.api.asc_getDefinedNames(Asc.c_oAscGetDefinedNamesList.All,!0),currentSheet:o.api.asc_getActiveWorksheetIndex(),props:i,text:r.asc_getText(),isLock:r.asc_getLockText(),allowInternal:l!==Asc.c_oAscSelectionType.RangeImage&&l!==Asc.c_oAscSelectionType.RangeShape&&l!==Asc.c_oAscSelectionType.RangeShapeText&&l!==Asc.c_oAscSelectionType.RangeChart&&l!==Asc.c_oAscSelectionType.RangeChartText&&l!==Asc.c_oAscSelectionType.RangeSlicer})}Common.component.Analytics.trackEvent("ToolBar","Add Hyperlink")},onEditChart:function(t){if(this.editMode&&Common.Controllers.LaunchController.isScriptLoaded()){var e,i=this,o=i.api.asc_getCellInfo().asc_getSelectionType();if(o!==Asc.c_oAscSelectionType.RangeImage)if(i.api){e=i.api.asc_getChartObject();for(var n=i.api.asc_getGraphicObjectProps(),s=null,a=0;a<n.length;a++)if(n[a].asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image){var r=n[a].asc_getObjectValue();r.asc_getChartProperties()&&(s=r)}if(e){var l=i.toolbar.mode.isEditDiagram||o===Asc.c_oAscSelectionType.RangeChart||o===Asc.c_oAscSelectionType.RangeChartText;new SSE.Views.ChartSettingsDlg({chartSettings:e,imageSettings:s,isChart:!0,api:i.api,handler:function(t,e){"ok"==t&&i.api&&(l?i.api.asc_editChartDrawingObject(e.chartSettings):i.api.asc_addChartDrawingObject(e.chartSettings),e.imageSettings&&i.api.asc_setGraphicObjectProps(e.imageSettings)),Common.NotificationCenter.trigger("edit:complete",i.toolbar)}}).show()}}}},onEditChartData:function(t){if(this.editMode&&Common.Controllers.LaunchController.isScriptLoaded()){var e,i=this;if(i.api)if(e=i.api.asc_getChartObject())i._isEditRanges=!0,e.startEdit(),new SSE.Views.ChartDataDialog({chartSettings:e,api:i.api,handler:function(t,o){"ok"==t&&(e.endEdit(),i._isEditRanges=!1),Common.NotificationCenter.trigger("edit:complete",i)}}).on("close",(function(){i._isEditRanges&&e.cancelEdit(),i._isEditRanges=!1})).show()}},onEditChartType:function(t){if(this.editMode&&Common.Controllers.LaunchController.isScriptLoaded()){var e,i=this;if(i.api)if(e=i.api.asc_getChartObject())i._isEditType=!0,e.startEdit(),new SSE.Views.ChartTypeDialog({chartSettings:e,api:i.api,handler:function(t,o){"ok"==t&&(e.endEdit(),i._isEditType=!1),Common.NotificationCenter.trigger("edit:complete",i)}}).on("close",(function(){i._isEditType&&e.cancelEdit(),i._isEditType=!1})).show()}},onSelectChart:function(t,e){if(this.editMode){var i=this,o=i.api.asc_getCellInfo().asc_getSelectionType();if(i.api){var n,s=o==Asc.c_oAscSelectionType.RangeChart||o==Asc.c_oAscSelectionType.RangeChartText;if(n=i.api.asc_getChartObject(!0))if(s)n.changeType(e);else{n.putType(e);var a=n.getRange(),r=_.isEmpty(a)?Asc.c_oAscError.ID.No:i.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.Chart,a,!0,n.getInRows(),n.getType());if(r==Asc.c_oAscError.ID.No)i.api.asc_addChartDrawingObject(n);else{var l=i.txtInvalidRange;switch(r){case Asc.c_oAscError.ID.StockChartError:l=i.errorStockChart;break;case Asc.c_oAscError.ID.MaxDataSeriesError:l=i.errorMaxRows;break;case Asc.c_oAscError.ID.ComboSeriesError:l=i.errorComboSeries;break;case Asc.c_oAscError.ID.MaxDataPointsError:l=i.errorMaxPoints}Common.UI.warning({msg:l,callback:function(){_.defer((function(t){Common.NotificationCenter.trigger("edit:complete",i.toolbar)}))}})}}}Common.NotificationCenter.trigger("edit:complete",this.toolbar)}},onSelectSpark:function(t){if(this.editMode){var e=(s=this).api.asc_getCellInfo(),i=e.asc_getSelectionType();if(s.api&&(i==Asc.c_oAscSelectionType.RangeCells||i==Asc.c_oAscSelectionType.RangeCol||i==Asc.c_oAscSelectionType.RangeRow||i==Asc.c_oAscSelectionType.RangeMax)){var o=e.asc_getSparklineInfo();if(o){var n=new Asc.sparklineGroup;n.asc_setType(t),this.api.asc_setSparklineGroup(o.asc_getId(),n)}else{var s=this;new SSE.Views.CreateSparklineDialog({api:s.api,props:{selectedCells:s._state.selectedCells},handler:function(e,i){"ok"==e&&i&&(s.view&&s.view.fireEvent("insertspark",s.view),i.destination&&s.api.asc_addSparklineGroup(t,i.source,i.destination)),Common.NotificationCenter.trigger("edit:complete",s)}}).show()}}Common.NotificationCenter.trigger("edit:complete",this.toolbar)}},onApiMathChanged:function(t){this._state.selectedCells=t.asc_getCount()},onInsertTextart:function(t){this.api&&(this.toolbar.fireEvent("inserttextart",this.toolbar),this.api.asc_addTextArt(t),this.toolbar.btnInsertShape.pressed&&this.toolbar.btnInsertShape.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete",this.toolbar,this.toolbar.btnInsertTextArt),Common.component.Analytics.trackEvent("ToolBar","Add Text Art"))},onBtnInsertTextClick:function(t,e){t.menu.getItems(!0).forEach((function(e){e.value==t.options.textboxType&&e.setChecked(!0)})),this.toolbar.btnInsertText.pressed||this.toolbar.btnInsertText.menu.clearAll(!0),this.onInsertText(t.options.textboxType,t,e)},onMenuInsertTextClick:function(t,e){var i=this.toolbar.btnInsertText.options.textboxType,o=e.value;this.toolbar.btnInsertText.toggle(!0),o!=i&&(this.toolbar.btnInsertText.changeIcon({next:e.options.iconClsForMainBtn,curr:this.toolbar.btnInsertText.menu.getItems(!0).filter((function(t){return t.value==i}))[0].options.iconClsForMainBtn}),this.toolbar.btnInsertText.updateHint([e.caption,this.views.Toolbar.prototype.tipInsertText]),this.toolbar.btnInsertText.options.textboxType=o),this.onInsertText(o,t,e)},onInsertText:function(t,e,i){this.api&&this._addAutoshape(this.toolbar.btnInsertText.pressed,t),this.toolbar.btnInsertShape.pressed&&this.toolbar.btnInsertShape.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete",this.toolbar,this.toolbar.btnInsertShape),Common.component.Analytics.trackEvent("ToolBar","Add Text")},onInsertShapeHide:function(t,e){this.toolbar.btnInsertShape.pressed&&!this._isAddingShape&&this.toolbar.btnInsertShape.toggle(!1,!0),this._isAddingShape=!1,Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onSortType:function(t,e){Common.NotificationCenter.trigger("protect:check",this.onSortTypeCallback,this,[t,e])},onSortTypeCallback:function(t,e){if(this.api)if(this.api.asc_getCellInfo().asc_getSelectionType()==Asc.c_oAscSelectionType.RangeSlicer){for(var i=this.api.asc_getGraphicObjectProps(),o=0;o<i.length;o++)if(i[o].asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image){var n=i[o].asc_getObjectValue();if(n.asc_getSlicerProperties()){n.asc_getSlicerProperties().asc_setSortOrder(t==Asc.c_oAscSortOptions.Ascending?Asc.ST_tabularSlicerCacheSortOrder.Ascending:Asc.ST_tabularSlicerCacheSortOrder.Descending),this.api.asc_setGraphicObjectProps(n);break}}Common.NotificationCenter.trigger("edit:complete",this.toolbar)}else{var s=this,a=this.api.asc_sortCellsRangeExpand();switch(a){case Asc.c_oAscSelectionSortExpand.showExpandMessage:var r={width:500,title:this.txtSorting,msg:this.txtExpandSort,buttons:[{caption:this.txtExpand,primary:!0,value:"expand"},{caption:this.txtSortSelected,value:"sort"},"cancel"],callback:function(e){"expand"!=e&&"sort"!=e||s.api.asc_sortColFilter(t,"",void 0,void 0,"expand"==e)}};Common.UI.alert(r);break;case Asc.c_oAscSelectionSortExpand.showLockMessage:r={width:500,title:this.txtSorting,msg:this.txtLockSort,buttons:["yes","no"],primary:"yes",callback:function(e){"yes"==e&&s.api.asc_sortColFilter(t,"",void 0,void 0,!1)}};Common.UI.alert(r);break;case Asc.c_oAscSelectionSortExpand.expandAndNotShowMessage:case Asc.c_oAscSelectionSortExpand.notExpandAndNotShowMessage:this.api.asc_sortColFilter(t,"",void 0,void 0,a===Asc.c_oAscSelectionSortExpand.expandAndNotShowMessage)}}},searchShow:function(){if(this.toolbar.btnSearch){if(this.searchBar&&this.searchBar.isVisible())return void this.searchBar.focus();this.toolbar.btnSearch.toggle(!0)}},onSearch:function(t,e){this.searchBar||(this.searchBar=new Common.UI.SearchBar({showOpenPanel:!1,width:303}),this.searchBar.on("hide",_.bind((function(){this.toolbar.btnSearch.toggle(!1,!0)}),this))),this.toolbar.btnSearch.pressed?this.searchBar.show(this.api.asc_GetSelectedText()):this.searchBar.hide()},onAutoFilter:function(t){var e=this._state.filter;this._state.filter=void 0,this.api&&(this._state.tablename||e?this.api.asc_changeAutoFilter(this._state.tablename,Asc.c_oAscChangeFilterOptions.filter,!e):this.api.asc_addAutoFilter()),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Auto filter")},onClearFilter:function(t){this.api&&this.api.asc_clearFilter(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Clear filter")},onNumberFormat:function(t){this.api&&this.api.asc_setCellStyle(t.options.styleName),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Number Format")},onNumberFormatMenu:function(t,e){if(this.api)if(-1==e.value)if(this._state.numformatinfo&&this._state.numformatinfo.asc_getType()==Asc.c_oAscNumFormatType.Accounting)this.onCustomNumberFormat();else{var i,o=this.api.asc_getLocale();!o&&(o=this.toolbar.mode.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(this.toolbar.mode.lang)):1033),(i=new Asc.asc_CFormatCellsInfo).asc_setType(Asc.c_oAscNumFormatType.Accounting),i.asc_setSeparator(!1),i.asc_setSymbol(o);var n=this.api.asc_getFormatCells(i);this.onCustomNumberFormat(n&&n.length>0?n[0]:void 0,i)}else(i=new Asc.asc_CFormatCellsInfo).asc_setType(Asc.c_oAscNumFormatType.Accounting),i.asc_setSeparator(!1),i.asc_setSymbol(e.value),(n=this.api.asc_getFormatCells(i))&&n.length>0&&this.api.asc_setCellFormat(n[0]);Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Number Format")},onNumberFormatSelect:function(t,e){e?this.api&&this.api.asc_setCellFormat(e.format):this.onCustomNumberFormat(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Number Format")},onCustomNumberFormat:function(t,e){var i=this,o=i.api.asc_getLocale();!o&&(o=i.toolbar.mode.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(i.toolbar.mode.lang)):1033),new SSE.Views.FormatSettingsDialog({api:i.api,handler:function(t,e){e&&i.api.asc_setCellFormat(e.format),Common.NotificationCenter.trigger("edit:complete",i.toolbar)},props:{format:t||i._state.numformat,formatInfo:e||i._state.numformatinfo,langId:o}}).show(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Number Format")},onNumberFormatOpenBefore:function(t){if(this.api){var e=this,i=e.api.asc_getLocale();if(!i&&(i=e.toolbar.mode.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(e.toolbar.mode.lang)):1033),this._state.langId!==i){this._state.langId=i;var o=new Asc.asc_CFormatCellsInfo;o.asc_setType(Asc.c_oAscNumFormatType.None),o.asc_setSymbol(this._state.langId);var n=this.api.asc_getFormatCells(o);e.toolbar.numFormatData.forEach((function(t,i){e.toolbar.numFormatData[i].format=n[i]}))}e.toolbar.numFormatData.forEach((function(t,i){t.exampleval=e.api.asc_getLocaleExample(t.format)})),e.toolbar.cmbNumberFormat.setData(e.toolbar.numFormatData),e.toolbar.cmbNumberFormat.setValue(e._state.numformattype,e.toolbar.txtCustom)}},onDecrement:function(t){this.api&&this.api.asc_decreaseCellDigitNumbers(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Decrement")},onIncrement:function(t){this.api&&this.api.asc_increaseCellDigitNumbers(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Increment")},onInsertFormulaMenu:function(t,e,i){if(this.api)if("more"===e.value){var o=this.getApplication().getController("FormulaDialog");o&&o.showDialog()}else e.value=e.value||"SUM",this.toolbar.fireEvent("function:apply",[{name:this.api.asc_getFormulaLocaleName(e.value),origin:e.value},!0]),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Insert formula")},onNamedRangeMenu:function(t,e,i){if(this.api){var o=this;if("paste"===e.value)new SSE.Views.NamedRangePasteDlg({handler:function(t,e){"ok"==t&&e&&(o.api.asc_insertInCell(e.asc_getName(!0),e.asc_getType()===Asc.c_oAscDefNameType.table?Asc.c_oAscPopUpSelectorType.Table:Asc.c_oAscPopUpSelectorType.Range,!1),Common.component.Analytics.trackEvent("ToolBar","Paste Named Range")),Common.NotificationCenter.trigger("edit:complete",o.toolbar)},ranges:o.api.asc_getDefinedNames(Asc.c_oAscGetDefinedNamesList.WorksheetWorkbook)}).show(),Common.component.Analytics.trackEvent("ToolBar","Paste Named Range");else{var n=o.api.asc_getWorksheetsCount(),s=-1,a=[],r=[];if("new"===e.value){if(this._state.namedrange_locked)return void Common.NotificationCenter.trigger("namedrange:locked");for(;++s<n;)this.api.asc_isWorksheetHidden(s)||a.push({displayValue:o.api.asc_getWorksheetName(s),value:s});new SSE.Views.NamedRangeEditDlg({api:o.api,handler:function(t,e){"ok"==t&&e&&(o.api.asc_setDefinedNames(e),Common.component.Analytics.trackEvent("ToolBar","New Named Range")),Common.NotificationCenter.trigger("edit:complete",o.toolbar)},sheets:a,props:o.api.asc_getDefaultDefinedName(),isEdit:!1}).show()}else{for(var l=this.getApplication().getController("CellEditor");++s<n;)this.api.asc_isWorksheetHidden(s)||(r[s]=o.api.asc_getWorksheetName(s),a.push({displayValue:r[s],value:s}));new SSE.Views.NameManagerDlg({api:o.api,handler:function(t){Common.component.Analytics.trackEvent("ToolBar","Name Manager"),Common.NotificationCenter.trigger("edit:complete",o.toolbar)},locked:o._state.namedrange_locked,sheets:a,sheetNames:r,ranges:o.api.asc_getDefinedNames(Asc.c_oAscGetDefinedNamesList.All),props:o.api.asc_getDefaultDefinedName(),sort:l.rangeListSort}).on("close",(function(t){l.rangeListSort=t.getSettings()})).show()}}}},onNamedRangeMenuOpen:function(t){if(this.api&&t){var e=this.api.asc_getDefinedNames(Asc.c_oAscGetDefinedNamesList.WorksheetWorkbook);t.items[2].setDisabled(e.length<1||this._state.isUserProtected)}},onClearStyleMenu:function(t,e,i){(e.value!=Asc.c_oAscCleanOptions.Format||this._state.wsProps.FormatCells&&this.api.asc_checkLockedCells())&&(e.value!=Asc.c_oAscCleanOptions.All||this.api.asc_checkLockedCells())?e.value==Asc.c_oAscCleanOptions.Comments?this._state.wsProps.Objects?Common.NotificationCenter.trigger("showerror",Asc.c_oAscError.ID.ChangeOnProtectedSheet,Asc.c_oAscError.Level.NoCritical):this.onClearStyleMenuCallback(t,e):Common.NotificationCenter.trigger("protect:check",this.onClearStyleMenuCallback,this,[t,e]):this.onClearStyleMenuCallback(t,e)},onClearStyleMenuCallback:function(t,e,i){this.api&&(e.value==Asc.c_oAscCleanOptions.Comments?this.api.asc_RemoveAllComments(!this.mode.canDeleteComments,!0):this.api.asc_emptyCells(e.value,e.value==Asc.c_oAscCleanOptions.All&&!this.mode.canDeleteComments)),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Clear")},onCopyStyleToggle:function(t,e,i){this.api&&this.api.asc_formatPainter(e?1:0),Common.NotificationCenter.trigger("edit:complete",this.toolbar),this.modeAlwaysSetStyle=e},onCellInsertMenu:function(t,e,i){this.api&&this.api.asc_insertCells(e.value),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Cell insert")},onCellDeleteMenu:function(t,e,i){this.api&&this.api.asc_deleteCells(e.value),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Cell delete")},onColorSchemaClick:function(t,e){this.api&&(this.api.asc_ChangeColorSchemeByIdx(e.value),Common.component.Analytics.trackEvent("ToolBar","Color Scheme")),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onColorSchemaShow:function(t){if(this.api){var e=this.api.asc_GetCurrentColorSchemeIndex(),i=_.find(t.getItems(!0),(function(t){return t.value==e}));i?i.setChecked(!0):t.clearAll(!0)}},onComboBlur:function(){Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onFontNameSelect:function(t,e){this.api&&(e.isNewFont?!Common.Utils.ModalWindow.isVisible()&&Common.UI.warning({width:500,msg:this.confirmAddFontName,buttons:["yes","no"],primary:"yes",callback:_.bind((function(t){"yes"==t?(this.api.asc_setCellFontName(e.name),Common.component.Analytics.trackEvent("ToolBar","Font Name")):this.toolbar.cmbFontName.setValue(this.api.asc_getCellInfo().asc_getXfs().asc_getFontName()),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0})}),this)}):(this.api.asc_setCellFontName(e.name),Common.component.Analytics.trackEvent("ToolBar","Font Name"))),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0})},onComboOpen:function(t,e,i,o){o&&o.fromKeyDown||_.delay((function(){var i=$("input",e.cmpEl).select();t?i.focus():e.isMenuOpen()||i.one("mouseup",(function(t){t.preventDefault()}))}),10)},onFontSizeSelect:function(t,e){this._state.fontsize=void 0,this.api&&this.api.asc_setCellFontSize(e.value),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Font Size")},onFontSizeChanged:function(t,e,i,o){var n,s=this;if(t){if(!e.store.findWhere({displayValue:i.value})&&!(n=/^\+?(\d*(\.|,)?\d+)$|^\+?(\d+(\.|,)?\d*)$/.exec(i.value)))return n=this._getApiTextSize(),setTimeout((function(){Common.UI.warning({msg:s.textFontSizeErr,callback:function(){_.defer((function(t){$("input",e.cmpEl).focus()}))}})}),1),e.setRawValue(n),o.preventDefault(),!1}else n=(n=Common.Utils.String.parseFloat(i.value))>409?409:n<1?1:Math.floor(2*(n+.4))/2,e.setRawValue(n),this._state.fontsize=void 0,this.api&&this.api.asc_setCellFontSize(n),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onListStyleSelect:function(t,e){this._state.prstyle=void 0,this.api&&(this.api.asc_setCellStyle(e.get("name")),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Style"))},onShowBeforeCondFormat:function(t,e){if(!(t.mnuDataBars.menu.items.length>0)){t.btnCondFormat.menu.on("item:click",_.bind(this.onCondFormatMenu,this));for(var i=0;i<7;i++)t.btnCondFormat.menu.items[i].menu.on("item:click",_.bind(this.onCondFormatMenu,this));t.btnCondFormat.menu.items[15].menu.on("item:click",_.bind(this.onCondFormatMenu,this));var o=SSE.getCollection("ConditionalFormatIconsPresets");o.length<1&&SSE.getController("Main").fillCondFormatIconsPresets(this.api.asc_getCFIconsByType());var n=SSE.getCollection("ConditionalFormatIcons");n.length<1&&SSE.getController("Main").fillCondFormatIcons(this.api.asc_getFullCFIcons());var s=this,a=t.mnuDataBars;a.menu.addItem(new Common.UI.MenuItem({template:_.template('<div id="id-'+e+'-menu-databar" class="menu-shapes margin-left-5" style="width: 203px;"></div>')}));var r=new Common.UI.DataViewSimple({el:$("#id-"+e+"-menu-databar",a.$el),parentMenu:a.menu,itemTemplate:_.template('<div class="item-databar" id="<%= id %>"><svg width="25" height="25" class="icon uni-scale"><use xlink:href="#bar-<%= data.name %>"></use></svg></div>')});r.on("item:click",(function(e,i,o,n){s.api&&(o&&s.api.asc_setCF([],[],[Asc.c_oAscCFRuleTypeSettings.dataBar,o.get("data").index]),"click"!==n.type&&t.btnCondFormat.menu.hide(),Common.NotificationCenter.trigger("edit:complete",t,t.btnCondFormat))}));var l=[{data:{name:"gradient-blue",index:0}},{data:{name:"gradient-green",index:1}},{data:{name:"gradient-red",index:2}},{data:{name:"gradient-yellow",index:3}},{data:{name:"gradient-lightblue",index:4}},{data:{name:"gradient-purple",index:5}},{data:{name:"solid-blue",index:6}},{data:{name:"solid-green",index:7}},{data:{name:"solid-red",index:8}},{data:{name:"solid-yellow",index:9}},{data:{name:"solid-lightblue",index:10}},{data:{name:"solid-purple",index:11}}];r.setStore(new Common.UI.DataViewStore(l)),(a=t.mnuColorScales).menu.addItem(new Common.UI.MenuItem({template:_.template('<div id="id-'+e+'-menu-colorscales" class="menu-shapes margin-left-5" style="width: 136px;"></div>')})),(r=new Common.UI.DataViewSimple({el:$("#id-"+e+"-menu-colorscales",a.$el),parentMenu:a.menu,itemTemplate:_.template('<div class="item-colorscale" id="<%= id %>"><svg width="25" height="25" class="icon uni-scale"><use xlink:href="#color-scale-<%= data.name %>"></use></svg></div>')})).on("item:click",(function(e,i,o,n){s.api&&(o&&s.api.asc_setCF([],[],[Asc.c_oAscCFRuleTypeSettings.colorScale,o.get("data").index]),"click"!==n.type&&t.btnCondFormat.menu.hide(),Common.NotificationCenter.trigger("edit:complete",t,t.btnCondFormat))})),l=[{data:{name:"green-yellow-red",index:0}},{data:{name:"red-yellow-green",index:1}},{data:{name:"green-white-red",index:2}},{data:{name:"red-white-green",index:3}},{data:{name:"blue-white-red",index:4}},{data:{name:"red-white-blue",index:5}},{data:{name:"white-red",index:6}},{data:{name:"red-white",index:7}},{data:{name:"green-white",index:8}},{data:{name:"white-green",index:9}},{data:{name:"green-yellow",index:10}},{data:{name:"yellow-green",index:11}}],r.setStore(new Common.UI.DataViewStore(l)),(a=t.mnuIconSets).menu.addItem(new Common.UI.MenuItem({template:_.template('<div id="id-'+e+'-menu-iconsets" class="menu-iconsets" style="width: 227px;"></div>')})),l=[];var c=[Asc.EIconSetType.Arrows3,Asc.EIconSetType.Arrows3Gray,Asc.EIconSetType.Triangles3,Asc.EIconSetType.Arrows4Gray,Asc.EIconSetType.Arrows4,Asc.EIconSetType.Arrows5Gray,Asc.EIconSetType.Arrows5];for(i=0;i<c.length;i++)l.push({group:"menu-iconset-group-direct",data:{index:c[i],iconSet:o.at([c[i]]).get("icons"),icons:n}});c=[Asc.EIconSetType.Traffic3Lights1,Asc.EIconSetType.Traffic3Lights2,Asc.EIconSetType.Signs3,Asc.EIconSetType.Traffic4Lights,Asc.EIconSetType.RedToBlack4];for(i=0;i<c.length;i++)l.push({group:"menu-iconset-group-shape",data:{index:c[i],iconSet:o.at([c[i]]).get("icons"),icons:n}});c=[Asc.EIconSetType.Symbols3,Asc.EIconSetType.Symbols3_2,Asc.EIconSetType.Flags3];for(i=0;i<c.length;i++)l.push({group:"menu-iconset-group-indicator",data:{index:c[i],iconSet:o.at([c[i]]).get("icons"),icons:n}});c=[Asc.EIconSetType.Stars3,Asc.EIconSetType.Rating4,Asc.EIconSetType.Quarters5,Asc.EIconSetType.Rating5,Asc.EIconSetType.Boxes5];for(i=0;i<c.length;i++)l.push({group:"menu-iconset-group-rating",data:{index:c[i],iconSet:o.at([c[i]]).get("icons"),icons:n}});(r=new Common.UI.DataView({el:$("#id-"+e+"-menu-iconsets",a.$el),parentMenu:a.menu,groups:new Common.UI.DataViewGroupStore([{id:"menu-iconset-group-direct",caption:this.textDirectional},{id:"menu-iconset-group-shape",caption:this.textShapes},{id:"menu-iconset-group-indicator",caption:this.textIndicator},{id:"menu-iconset-group-rating",caption:this.textRating}]),store:new Common.UI.DataViewStore(l),showLast:!1,itemTemplate:_.template('<div class="item-iconset" id="<%= id %>"><% _.each(data.iconSet, function(icon) { %><img src="<%= data.icons.at(icon-1).get(\'icon\') %>" style="width:16px;height:16px;"><% }) %></div>')})).on("item:click",(function(e,i,o,n){s.api&&(o&&s.api.asc_setCF([],[],[Asc.c_oAscCFRuleTypeSettings.icons,o.get("data").index]),"click"!==n.type&&t.btnCondFormat.menu.hide(),Common.NotificationCenter.trigger("edit:complete",t,t.btnCondFormat))}))}},onCondFormatMenu:function(t,e){var i=this,o=this.api.asc_getLocale();!o&&(o=this.toolbar.mode.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(this.toolbar.mode.lang)):1033),"manage"==e.value?new SSE.Views.FormatRulesManagerDlg({api:i.api,langId:o,locked:!!i._state.cf_locked[this.api.asc_getActiveWorksheetIndex()],handler:function(t,e){i&&i.api&&"ok"==t&&i.api.asc_setCF(e.rules,e.deleted)}}).show():"clear"==e.value?i.api.asc_clearCF(e.options.type):new SSE.Views.FormatRulesEditDlg({api:i.api,props:null,type:e.options.type,subtype:e.value,percent:e.options.percent,isEdit:!1,langId:o,handler:function(t,e){"ok"==t&&e&&i.api.asc_setCF([e],[])}}).show()},createDelayedElements:function(){var t=this;this.toolbar.createDelayedElements(),this.attachUIEvents(this.toolbar),this.appConfig.isEditDiagram||this.appConfig.isEditMailMerge||this.appConfig.isEditOle||(this.api.asc_registerCallback("asc_onSheetsChanged",_.bind(this.onApiSheetChanged,this)),this.api.asc_registerCallback("asc_onUpdateSheetViewSettings",_.bind(this.onApiSheetChanged,this)),this.api.asc_registerCallback("asc_onEndAddShape",_.bind(this.onApiEndAddShape,this)),this.api.asc_registerCallback("asc_onEditorSelectionChanged",_.bind(this.onApiEditorSelectionChanged,this)),this.api.asc_registerCallback("asc_onUpdateDocumentProps",_.bind(this.onUpdateDocumentProps,this)),this.api.asc_registerCallback("asc_onLockDocumentProps",_.bind(this.onApiLockDocumentProps,this)),this.api.asc_registerCallback("asc_onUnLockDocumentProps",_.bind(this.onApiUnLockDocumentProps,this)),Common.NotificationCenter.on("protect:wslock",_.bind(this.onChangeProtectSheet,this))),this.appConfig.isEditOle&&this.api.asc_registerCallback("asc_onEditorSelectionChanged",_.bind(this.onApiEditorSelectionChanged_OleEditor,this)),this.appConfig.isEditMailMerge||this.applyFormulaSettings(),this.api.asc_registerCallback("asc_onShowChartDialog",_.bind(this.onApiChartDblClick,this)),this.api.asc_registerCallback("asc_onCanUndoChanged",_.bind(this.onApiCanRevert,this,"undo")),this.api.asc_registerCallback("asc_onCanRedoChanged",_.bind(this.onApiCanRevert,this,"redo")),this.api.asc_registerCallback("asc_onEditCell",_.bind(this.onApiEditCell,this)),this.api.asc_registerCallback("asc_onStopFormatPainter",_.bind(this.onApiStyleChange,this)),this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onApiSelectionChanged,this));var e={"command+l,ctrl+l":function(e){if(t.editMode&&!t._state.multiselect&&t.appConfig.canModifyFilter&&!t._state.wsLock){var i=t.api.asc_getCellInfo(),o=i.asc_getAutoFilterInfo(),n=i.asc_getFormatTableInfo();null===(o=o?o.asc_getIsAutoFilter():null)||n||t._setTableFormat(t.api.asc_getDefaultTableStyle())}return!1},"command+shift+l,ctrl+shift+l":function(e){if(t.editMode&&t.api&&!t._state.multiselect&&t.appConfig.canModifyFilter&&!t._state.wsLock){var i=t._state.filter;t._state.filter=void 0,t._state.tablename||i?t.api.asc_changeAutoFilter(t._state.tablename,Asc.c_oAscChangeFilterOptions.filter,!i):t.api.asc_addAutoFilter()}return!1},"command+s,ctrl+s":function(e){t.onSave(),e.preventDefault(),e.stopPropagation()},"command+k,ctrl+k":function(e){!t.editMode||t.toolbar.mode.isEditMailMerge||t.toolbar.mode.isEditDiagram||t.toolbar.mode.isEditOle||t.api.isCellEdited||t._state.multiselect||t._state.inpivot||t.getApplication().getController("LeftMenu").leftMenu.menuFile.isVisible()||t._state.wsProps.InsertHyperlinks||(t.api.asc_getCellInfo().asc_getSelectionType()===Asc.c_oAscSelectionType.RangeShapeText&&!1===t.api.asc_canAddShapeHyperlink()||t.onHyperlink());e.preventDefault()},"command+1,ctrl+1":function(e){return!t.editMode||t.toolbar.mode.isEditMailMerge||t.toolbar.mode.isEditOle||t.api.isCellEdited||t.toolbar.cmbNumberFormat.isDisabled()||t.onCustomNumberFormat(),!1},"shift+f3":function(e){if(t.editMode&&!t.toolbar.btnInsertFormula.isDisabled()){var i=t.getApplication().getController("FormulaDialog");i&&i.showDialog()}return!1}};e["command+shift+=,ctrl+shift+=,command+shift+numplus,ctrl+shift+numplus"+(Common.Utils.isGecko?",command+shift+ff=,ctrl+shift+ff=":"")+(Common.Utils.isMac?",command+shift+0,ctrl+shift+0":"")]=function(e){if(Common.Utils.isMac&&e.keyCode===Common.UI.Keys.ZERO&&"="!==e.key)return!1;if(t.editMode&&!t.toolbar.mode.isEditMailMerge&&!t.toolbar.mode.isEditDiagram&&!t.toolbar.mode.isEditOle&&!t.toolbar.btnAddCell.isDisabled()){var i=t.api.asc_getCellInfo().asc_getSelectionType();if(i===Asc.c_oAscSelectionType.RangeRow||i===Asc.c_oAscSelectionType.RangeCol)i===Asc.c_oAscSelectionType.RangeRow&&!t.toolbar.btnAddCell.menu.items[2].isDisabled()&&t.api.asc_insertCells(Asc.c_oAscInsertOptions.InsertRows),i===Asc.c_oAscSelectionType.RangeCol&&!t.toolbar.btnAddCell.menu.items[3].isDisabled()&&t.api.asc_insertCells(Asc.c_oAscInsertOptions.InsertColumns),Common.NotificationCenter.trigger("edit:complete",t.toolbar);else{for(var o=t.toolbar.btnAddCell.menu.getItems(!0),n=[],s=!1,a=0;a<4;a++)n.push({caption:o[a].caption,value:o[a].value,disabled:o[a].isDisabled()}),!o[a].isDisabled()&&(s=!0);s&&new Common.Views.OptionsDialog({title:t.txtInsertCells,items:n,handler:function(e,i){"ok"==i&&t.api.asc_insertCells(e.getSettings()),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}}).show()}}return!1},e["command+shift+-,ctrl+shift+-,command+shift+numminus,ctrl+shift+numminus"+(Common.Utils.isGecko?",command+shift+ff-,ctrl+shift+ff-":"")]=function(e){if(t.editMode&&!t.toolbar.mode.isEditMailMerge&&!t.toolbar.mode.isEditDiagram&&!t.toolbar.mode.isEditOle&&!t.toolbar.btnDeleteCell.isDisabled()){var i=t.api.asc_getCellInfo().asc_getSelectionType();if(i===Asc.c_oAscSelectionType.RangeRow||i===Asc.c_oAscSelectionType.RangeCol)t.api.asc_deleteCells(i===Asc.c_oAscSelectionType.RangeRow?Asc.c_oAscDeleteOptions.DeleteRows:Asc.c_oAscDeleteOptions.DeleteColumns),Common.NotificationCenter.trigger("edit:complete",t.toolbar);else{for(var o=t.toolbar.btnDeleteCell.menu.getItems(!0),n=[],s=!1,a=0;a<4;a++)n.push({caption:o[a].caption,value:o[a].value,disabled:o[a].isDisabled()}),!o[a].isDisabled()&&(s=!0);s&&new Common.Views.OptionsDialog({title:t.txtDeleteCells,items:n,handler:function(e,i){"ok"==i&&t.api.asc_deleteCells(e.getSettings()),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}}).show()}}return!1},Common.util.Shortcuts.delegateShortcuts({shortcuts:e}),Common.Utils.injectSvgIcons(),this.onChangeProtectSheet(),this.attachToControlEvents(),this.onApiSheetChanged(),Common.NotificationCenter.on("cells:range",_.bind(this.onCellsRange,this))},onChangeViewMode:function(t,e,i){this.toolbar.setFolded(e),this.toolbar.fireEvent("view:compact",[this,e]),e&&this.onTabCollapse(),!i&&Common.localStorage.setBool(this.mode.isEdit?"sse-compact-toolbar":"sse-view-compact-toolbar",e),Common.NotificationCenter.trigger("layout:changed","toolbar"),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onClickChangeCompact:function(t){"file"!=t&&Common.Utils.asyncCall((function(){this.onChangeViewMode(null,!this.toolbar.isCompact())}),this)},fillTableTemplates:function(){if(this.toolbar.btnTableTemplate.rendered){var t,e,i,o=this;_.isUndefined(this.toolbar.mnuTableTemplatePicker)&&(this.toolbar.mnuTableTemplatePicker=(t=$("#id-toolbar-menu-table-templates"),e=this.toolbar.btnTableTemplate.menu,(i=new Common.UI.DataView({el:t,parentMenu:e,restoreHeight:300,groups:new Common.UI.DataViewGroupStore,style:"max-height: 300px;",store:o.getCollection("TableTemplates"),itemTemplate:_.template('<div class="item-template"><img src="<%= imageUrl %>" id="<%= id %>" style="width:60px;height:44px;"></div>'),delayRenderTips:!0})).on("item:click",(function(t,e,i){o.api&&(o._state.tablestylename=null,o._setTableFormat(i?i.get("name"):o.api.asc_getDefaultTableStyle()),Common.NotificationCenter.trigger("edit:complete",o.toolbar),Common.component.Analytics.trackEvent("ToolBar","Table Templates"))})),i.scroller&&i.scroller.update({alwaysVisibleY:!0}),i))}},onTableTplMenuOpen:function(t){if(this.onApiInitTableTemplates(this.api.asc_getTablePictures(this.api.asc_getCellInfo().asc_getFormatTableInfo())),t&&this.toolbar.mnuTableTemplatePicker){var e=this.toolbar.mnuTableTemplatePicker;if(e.cmpEl){var i=$(e.cmpEl.find(".dataview.inner .item-template").get(0)).parent(),o=i.is(":visible")?parseFloat(i.css("width")):60,n=7*(8+o)+11,s=parseFloat(e.cmpEl.css("margin-left"))+parseFloat(e.cmpEl.css("margin-right"));n+s>Common.Utils.innerWidth()&&(n=Math.max(Math.floor((Common.Utils.innerWidth()-s-11)/(8+o)),2)*(8+o)+11),e.cmpEl.css({width:n}),t.alignPosition()}}var a=this.toolbar.mnuTableTemplatePicker.scroller;a&&(a.update({alwaysVisibleY:!0}),a.scrollTop(0));var r=this.toolbar.mnuTableTemplatePicker.store.findWhere({name:this._state.tablestylename});r?this.toolbar.mnuTableTemplatePicker.selectRecord(r):this.toolbar.mnuTableTemplatePicker.deselectAll()},onSendThemeColors:function(){this.toolbar.btnTableTemplate.rendered&&this.toolbar.btnTableTemplate.cmpEl.hasClass("open")&&this.onTableTplMenuOpen()},onApiInitTableTemplates:function(t){var e=this,i=this.getCollection("TableTemplates");if(this.fillTableTemplates(),i){var o=[],n=[{id:"menu-table-group-custom",caption:e.txtGroupTable_Custom,templates:[]},{id:"menu-table-group-light",caption:e.txtGroupTable_Light,templates:[]},{id:"menu-table-group-medium",caption:e.txtGroupTable_Medium,templates:[]},{id:"menu-table-group-dark",caption:e.txtGroupTable_Dark,templates:[]},{id:"menu-table-group-no-name",caption:"&nbsp",templates:[]}];_.each(t,(function(t){var i=t.asc_getDisplayName(),o="",s=null;if(0==t.asc_getType()){var a=i.split(" ");s=a.pop(),null===t.asc_getName()?o="menu-table-group-light":(a.length>0&&(o="menu-table-group-"+a[a.length-1].toLowerCase()),0==n.some((function(t){return t.id===o}))&&(o="menu-table-group-no-name")),a="txtTable_"+a.join(""),i=e[a]?e[a]+" "+s:i,s=parseInt(s)}else o="menu-table-group-custom";n.filter((function(t){return t.id==o}))[0].templates.push({name:t.asc_getName(),caption:t.asc_getDisplayName(),type:t.asc_getType(),imageUrl:t.asc_getImage(),group:o,allowSelected:!0,selected:!1,tip:i,numInGroup:null==s||isNaN(s)?null:s})}));var s=function(t,e){return t.numInGroup-e.numInGroup};n[1].templates.sort(s),n[2].templates.sort(s),n[3].templates.sort(s),(n=n.filter((function(t,e){return t.templates.length>0}))).forEach((function(t){o=o.concat(t.templates),delete t.templates})),e.toolbar.mnuTableTemplatePicker.groups.reset(n),i.reset(o)}},onCellStyleMenuOpen:function(t){if(t&&this.toolbar.mnuCellStylePicker){var e=this.toolbar.mnuCellStylePicker;if(e.cmpEl){var i=$(e.cmpEl.find(".dataview.inner .item").get(0)),o=parseFloat(i.css("margin-left"))+parseFloat(i.css("margin-right")),n=i.is(":visible")?parseFloat(i.css("width")):106,s=6*(o+n)+15,a=parseFloat(e.cmpEl.css("margin-left"))+parseFloat(e.cmpEl.css("margin-right"));s+a>Common.Utils.innerWidth()&&(s=Math.max(Math.floor((Common.Utils.innerWidth()-a-11)/(o+n)),2)*(o+n)+11),e.cmpEl.css({width:s}),t.alignPosition()}}var r=this.toolbar.mnuCellStylePicker.scroller;r&&(r.update({alwaysVisibleY:!0}),r.scrollTop(0));var l=this.toolbar.mnuCellStylePicker.store.findWhere({name:this._state.prstyle});l?this.toolbar.mnuCellStylePicker.selectRecord(l):this.toolbar.mnuCellStylePicker.deselectAll()},onApiInitEditorStyles:function(t){if(window.styles_loaded=!1,this.toolbar.mode.isEditOle){var e=this;_.isUndefined(this.toolbar.mnuCellStylePicker)&&(this.toolbar.mnuCellStylePicker=(i=$("#id-toolbar-menu-cell-styles"),o=this.toolbar.btnCellStyle.menu,(n=new Common.UI.DataView({el:i,parentMenu:o,restoreHeight:380,groups:new Common.UI.DataViewGroupStore,store:new Common.UI.DataViewStore,style:"max-height: 380px;",itemTemplate:_.template('<div class="style"><img src="<%= imageUrl %>" id="<%= id %>" style="width:100px;height:20px;"></div>'),delayRenderTips:!0})).on("item:click",(function(t,i,o){e.onListStyleSelect(t,o)})),n.scroller&&n.scroller.update({alwaysVisibleY:!0}),n))}var i,o,n,s=this,a=this.toolbar.mode.isEditOle?s.toolbar.mnuCellStylePicker:s.toolbar.listStyles;if(a){for(var r=this.toolbar.mode.isEditOle?a:a.menuPicker,l=this.getApplication().getController("Main"),c=r.store.length,h=r.getSelectedRec(),d=[{id:"menu-style-group-custom",caption:this.txtGroupCell_Custom},{id:"menu-style-group-color",caption:this.txtGroupCell_GoodBadAndNeutral},{id:"menu-style-group-model",caption:this.txtGroupCell_DataAndModel},{id:"menu-style-group-title",caption:this.txtGroupCell_TitlesAndHeadings},{id:"menu-style-group-themed",caption:this.txtGroupCell_ThemedCallStyles},{id:"menu-style-group-number",caption:this.txtGroupCell_NumberFormat},{id:"menu-style-group-no-name",caption:this.txtGroupCell_NoName}],m=[],p=0;p<4;p++)m.push("menu-style-group-color");for(p=0;p<8;p++)m.push("menu-style-group-model");for(p=0;p<6;p++)m.push("menu-style-group-title");for(p=0;p<24;p++)m.push("menu-style-group-themed");for(p=0;p<5;p++)m.push("menu-style-group-number");if(c>0&&c==t.length){var u=r.dataViewItems;u&&_.each(t,(function(t,e){var i=t.asc_getImage();u[e].model.set("imageUrl",i,{silent:!0}),u[e].model.set({name:t.asc_getName(),tip:l.translationTable[t.get_Name()]||t.get_Name()}),$(u[e].el).find("img").attr("src",i)}))}else{var g=[],f=0,b=!1;_.each(t,(function(t,e){var i;0==t.asc_getType()?e-f<m.length?i=m[e-f]:(i="menu-style-group-no-name",b=!0):i="menu-style-group-custom",g.push({imageUrl:t.asc_getImage(),name:t.asc_getName(),group:i,tip:l.translationTable[t.get_Name()]||t.get_Name(),uid:Common.UI.getId()}),1==t.asc_getType()&&(f+=1)})),0==f&&(d=d.filter((function(t){return"menu-style-group-custom"!=t.id}))),!1===b&&(d=d.filter((function(t){return"menu-style-group-no-name"!=t.id}))),r.groups.reset(d),r.store.reset(g)}!this.toolbar.mode.isEditOle&&r.store.length>0&&a.rendered&&(h=h?r.store.findWhere({name:h.get("name")}):null,a.fillComboView(h||r.store.at(0),!0,!0)),window.styles_loaded=!0}else s.styles=t},onHomeOpen:function(){var t,e=this.toolbar.listStyles;e&&e.needFillComboView&&e.menuPicker.store.length>0&&e.rendered&&(this._state.prstyle&&(t=e.menuPicker.store.findWhere({name:this._state.prstyle})),e.fillComboView(t||e.menuPicker.store.at(0),!0))},onApiCoAuthoringDisconnect:function(t){this.toolbar.setMode({isDisconnected:!0,enableDownload:!!t}),this.editMode=!1},onApiChartDblClick:function(){this.onEditChart(this.btnInsertChart)},onApiCanRevert:function(t,e){"undo"==t?this._state.can_undo!==e&&(this.toolbar.btnUndo.setDisabled(!e),this._state.can_undo=e):this._state.can_redo!==e&&(this.toolbar.btnRedo.setDisabled(!e),this._state.can_redo=e)},setDisabledComponents:function(t,e){_.each([].concat(t),(function(t){t.isDisabled()!==e&&t.setDisabled(e)}))},onApiEditCell:function(t){this.onEditCell(t)},onEditCell:function(t,e){if(!($(".asc-window.enable-key-events:visible").length>0)){var i=this.toolbar;if(i.mode.isEditDiagram||i.mode.isEditMailMerge){var o=t==Asc.c_oAscCellEditorState.editStart;i.lockToolbar(Common.enumLock.editCell,t==Asc.c_oAscCellEditorState.editStart,{array:[i.btnDecDecimal,i.btnIncDecimal,i.cmbNumberFormat,i.btnEditChartData,i.btnEditChartType]})}else if(i.mode.isEditOle)if(t==Asc.c_oAscCellEditorState.editStart||t==Asc.c_oAscCellEditorState.editEnd){o=t==Asc.c_oAscCellEditorState.editStart;i.lockToolbar(Common.enumLock.editCell,t==Asc.c_oAscCellEditorState.editStart,{array:[i.cmbNumberFormat,i.btnWrap,i.btnMerge,i.btnBackColor,i.btnBorders,i.btnTableTemplate,i.btnHorizontalAlign,i.btnVerticalAlign],merge:!0,clear:e?void 0:[Common.enumLock.editFormula,Common.enumLock.editText]}),o?Common.util.Shortcuts.suspendEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l"):Common.util.Shortcuts.resumeEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l")}else{if(t==Asc.c_oAscCellEditorState.editText)var n=!0,s=!1;else t==Asc.c_oAscCellEditorState.editFormula?n=!(s=!0):t==Asc.c_oAscCellEditorState.editEmptyCell&&(n=s=!1);i.lockToolbar(Common.enumLock.editFormula,s,{array:[i.cmbFontName,i.cmbFontSize,i.btnTextFormatting,i.btnTextColor]}),i.lockToolbar(Common.enumLock.editText,n,{array:[i.btnInsertFormula]})}else if(t==Asc.c_oAscCellEditorState.editStart||t==Asc.c_oAscCellEditorState.editEnd){i.lockToolbar(Common.enumLock.editCell,t==Asc.c_oAscCellEditorState.editStart,{array:[i.btnClearStyle.menu.items[1],i.btnClearStyle.menu.items[2],i.btnClearStyle.menu.items[3],i.btnClearStyle.menu.items[4],i.btnNamedRange.menu.items[0],i.btnNamedRange.menu.items[1]].concat(i.itemsNamedRange),merge:!0,clear:e?void 0:[Common.enumLock.editFormula,Common.enumLock.editText]});var a=Common.Utils.isMac?"command+alt+a":"alt+h";(o=t==Asc.c_oAscCellEditorState.editStart)?Common.util.Shortcuts.suspendEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l, command+k, ctrl+k, command+1, ctrl+1, "+a):Common.util.Shortcuts.resumeEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l, command+k, ctrl+k, command+1, ctrl+1, "+a),o&&(i.listStyles.suspendEvents(),i.listStyles.menuPicker.selectRecord(null),i.listStyles.resumeEvents(),this._state.prstyle=void 0),this.appConfig.isDesktopApp&&(this.appConfig.isSignatureSupport||this.appConfig.isPasswordSupport)&&this.getApplication().getController("Common.Controllers.Protection").SetDisabled(o,!1)}else{if(t==Asc.c_oAscCellEditorState.editText)n=!0,s=!1;else t==Asc.c_oAscCellEditorState.editFormula?n=!(s=!0):t==Asc.c_oAscCellEditorState.editEmptyCell&&(n=s=!1);i.lockToolbar(Common.enumLock.editFormula,s,{array:[i.cmbFontName,i.cmbFontSize,i.btnIncFontSize,i.btnDecFontSize,i.btnChangeCase,i.btnBold,i.btnItalic,i.btnUnderline,i.btnStrikeout,i.btnSubscript,i.btnTextColor]}),i.lockToolbar(Common.enumLock.editText,n,{array:[i.btnInsertFormula].concat(i.btnsFormula)})}this._state.coauthdisable=void 0,this._state.selection_type=void 0,this.checkInsertAutoshape({action:"cancel"})}},onApiZoomChange:function(t,e){},onApiSheetChanged:function(){if(this.toolbar.mode&&this.toolbar.mode.isEdit&&!this.toolbar.mode.isEditDiagram&&!this.toolbar.mode.isEditMailMerge&&!this.toolbar.mode.isEditOle){var t=this.api.asc_getActiveWorksheetIndex(),e=this.api.asc_getPageOptions(t),i=e.asc_getPageSetup(),o=this.api.asc_getSheetViewSettings();this.onApiPageOrient(i.asc_getOrientation()),this.onApiPageSize(i.asc_getWidth(),i.asc_getHeight()),this.onApiPageMargins(e.asc_getPageMargins()),this.onChangeScaleSettings(i.asc_getFitToWidth(),i.asc_getFitToHeight(),i.asc_getScale()),this.onApiGridLines(e.asc_getGridLines()),this.onApiHeadings(e.asc_getHeadings()),this.onApiRtlSheet(o.asc_getRightToLeft()),this.api.asc_isLayoutLocked(t)?this.onApiLockDocumentProps(t):this.onApiUnLockDocumentProps(t),this.toolbar.lockToolbar(Common.enumLock.printAreaLock,this.api.asc_isPrintAreaLocked(t),{array:[this.toolbar.btnPrintArea]}),this.toolbar.lockToolbar(Common.enumLock.pageBreakLock,this.api.asc_GetPageBreaksDisableType(t)===Asc.c_oAscPageBreaksDisableType.all,{array:[this.toolbar.btnPageBreak]})}},onUpdateDocumentProps:function(t){t==this.api.asc_getActiveWorksheetIndex()&&this.onApiSheetChanged()},onApiGridLines:function(t){this.toolbar.chPrintGridlines.setValue(t,!0)},onApiHeadings:function(t){this.toolbar.chPrintHeadings.setValue(t,!0)},onApiRtlSheet:function(t){this.toolbar.btnRtlSheet.toggle(!!t,!0)},onApiPageSize:function(t,e){void 0!==this._state.pgorient&&(Math.abs(this._state.pgsize[0]-t)>.1||Math.abs(this._state.pgsize[1]-e)>.1)&&(this._state.pgsize=[t,e],this.toolbar.mnuPageSize&&(this.toolbar.mnuPageSize.clearAll(!0),_.each(this.toolbar.mnuPageSize.getItems(!0),(function(i){if(i.value&&"object"==_typeof(i.value)&&Math.abs(i.value[0]-t)<.1&&Math.abs(i.value[1]-e)<.1)return i.setChecked(!0),!1}),this)))},onApiPageMargins:function(t){if(t){var e=t.asc_getLeft(),i=t.asc_getTop(),o=t.asc_getRight(),n=t.asc_getBottom();(!this._state.pgmargins||Math.abs(this._state.pgmargins[0]-i)>.1||Math.abs(this._state.pgmargins[1]-e)>.1||Math.abs(this._state.pgmargins[2]-n)>.1||Math.abs(this._state.pgmargins[3]-o)>.1)&&(this._state.pgmargins=[i,e,n,o],this.toolbar.btnPageMargins.menu&&(this.toolbar.btnPageMargins.menu.clearAll(!0),_.each(this.toolbar.btnPageMargins.menu.getItems(!0),(function(t){if(t.value&&"object"==_typeof(t.value)&&Math.abs(t.value[0]-i)<.1&&Math.abs(t.value[1]-e)<.1&&Math.abs(t.value[2]-n)<.1&&Math.abs(t.value[3]-o)<.1)return t.setChecked(!0),!1}),this)))}},onApiPageOrient:function(t){this._state.pgorient!==t&&(this.toolbar.btnPageOrient.menu.items[t==Asc.c_oAscPageOrientation.PagePortrait?0:1].setChecked(!0),this._state.pgorient=t)},onChangeScaleSettings:function(t,e,i){if(this.toolbar.btnScale.menu)if(void 0!==t){var o=!1,n=!1;t=t||0,e=e||0;void 0!==i?this.toolbar.setValueCustomScale(i):this.toolbar.setValueCustomScale(this.api.asc_getPageOptions().asc_getPageSetup().asc_getScale()),this.toolbar.menuWidthScale.clearAll(!0),this.toolbar.menuWidthScale.getItems(!0).forEach((function(e){if(e.value===t)return e.setChecked(!0),o=!0,!1})),o||this.toolbar.menuWidthScale.items[11].setChecked(!0),this.toolbar.menuHeightScale.clearAll(!0),this.toolbar.menuHeightScale.getItems(!0).forEach((function(t){if(t.value===e)return t.setChecked(!0),n=!0,!1})),n||this.toolbar.menuHeightScale.items[11].setChecked(!0),this.toolbar.mnuScalePicker&&(this.toolbar.mnuScalePicker.setDisabled(!(!t&&!e)),this.toolbar.mnuCustomScale.setDisabled(!(!t&&!e))),this._state.scaleWidth=t,this._state.scaleHeight=e,this._state.scale=i}else this.toolbar.mnuScalePicker&&(this.toolbar.mnuScalePicker.setDisabled(!(!this._state.scaleWidth&&!this._state.scaleHeight)),this.toolbar.mnuCustomScale.setDisabled(!(!this._state.scaleWidth&&!this._state.scaleHeight)))},onApiLockDocumentProps:function(t){!0!==this._state.lock_doc&&t==this.api.asc_getActiveWorksheetIndex()&&(this.toolbar.lockToolbar(Common.enumLock.docPropsLock,!0,{array:[this.toolbar.btnPageSize,this.toolbar.btnPageMargins,this.toolbar.btnPageOrient,this.toolbar.btnPageBreak,this.toolbar.btnScale,this.toolbar.btnPrintTitles]}),this._state.lock_doc=!0)},onApiUnLockDocumentProps:function(t){!1!==this._state.lock_doc&&t==this.api.asc_getActiveWorksheetIndex()&&(this.toolbar.lockToolbar(Common.enumLock.docPropsLock,!1,{array:[this.toolbar.btnPageSize,this.toolbar.btnPageMargins,this.toolbar.btnPageOrient,this.toolbar.btnPageBreak,this.toolbar.btnScale,this.toolbar.btnPrintTitles]}),this._state.lock_doc=!1)},onApiEditorSelectionChanged:function(t){if(this.editMode&&!($(".asc-window.enable-key-events:visible").length>0)){var e,i=this.toolbar;if(Common.NotificationCenter.trigger("fonts:change",t),!i.mode.isEditMailMerge&&!i.mode.isEditDiagram&&!i.mode.isEditOle){e=t.asc_getFontBold(),this._state.bold!==e&&(i.btnBold.toggle(!0===e,!0),this._state.bold=e),e=t.asc_getFontItalic(),this._state.italic!==e&&(i.btnItalic.toggle(!0===e,!0),this._state.italic=e),e=t.asc_getFontUnderline(),this._state.underline!==e&&(i.btnUnderline.toggle(!0===e,!0),this._state.underline=e),e=t.asc_getFontStrikeout(),this._state.strikeout!==e&&(i.btnStrikeout.toggle(!0===e,!0),this._state.strikeout=e);var o=t.asc_getFontSubscript(),n=t.asc_getFontSuperscript();if(this._state.subscript!==o||this._state.superscript!==n){var s=n?0:o?1:-1,a=i.btnSubscript;a.toggle(s>-1,!0),s<0?a.menu.clearAll(!0):(a.menu.items[s].setChecked(!0),a.rendered&&a.$icon&&(a.$icon.removeClass(a.options.icls),a.options.icls=a.menu.items[s].options.icls,a.$icon.addClass(a.options.icls))),this._state.subscript=o,this._state.superscript=n}}var r=t.asc_getFontSize();this._state.fontsize!==r&&(i.cmbFontSize.setValue(void 0!==r?r:""),this._state.fontsize=r);var l,c,h=this.toolbar.mnuTextColorPicker;if(!h.isDummy){if(c=t.asc_getFontColor())if(c.get_auto())"auto"!==this._state.clrtext&&(h.clearSelection(),this.toolbar.btnTextColor.setAutoColor(!0),this._state.clrtext="auto");else{var d=_typeof(l=c.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(c.get_r(),c.get_g(),c.get_b()),effectValue:c.get_value()}:Common.Utils.ThemeColor.getHexColor(c.get_r(),c.get_g(),c.get_b())),m=_typeof(this._state.clrtext);("auto"==this._state.clrtext||d!==m||"object"==d&&(l.effectValue!==this._state.clrtext.effectValue||this._state.clrtext.color.indexOf(l.color)<0)||"object"!=d&&void 0!==this._state.clrtext&&this._state.clrtext.indexOf(l)<0)&&(this.toolbar.btnTextColor.setAutoColor(!1),Common.Utils.ThemeColor.selectPickerColorByEffect(l,h),this._state.clrtext=l)}this._state.clrtext_asccolor=c}}},onApiSelectionChanged:function(t){if(this.editMode&&!($(".asc-window.enable-key-events:visible").length>0)&&t){if(this.toolbar.mode.isEditDiagram)return this.onApiSelectionChanged_DiagramEditor(t);if(this.toolbar.mode.isEditMailMerge)return this.onApiSelectionChanged_MailMergeEditor(t);if(this.toolbar.mode.isEditOle)return this.onApiSelectionChanged_OleEditor(t);var e,i=t.asc_getSelectionType(),o=!(this.toolbar.mode.isEditMailMerge||this.toolbar.mode.isEditDiagram||this.toolbar.mode.isEditOle)&&(!0===t.asc_getLocked()||!0===t.asc_getLockedTable()||!0===t.asc_getLockedPivotTable()),n=this._disableEditOptions(i,o),s=this.toolbar,a=t.asc_getXfs(),r=!1;Common.NotificationCenter.trigger("fonts:change",a);var l=a.asc_getFontSize();this._state.fontsize!==l&&(s.cmbFontSize.setValue(void 0!==l?l:""),this._state.fontsize=l),s.lockToolbar(Common.enumLock.cantHyperlink,i===Asc.c_oAscSelectionType.RangeShapeText&&!1===this.api.asc_canAddShapeHyperlink(),{array:[s.btnInsertHyperlink]}),r=i===Asc.c_oAscSelectionType.RangeCells||i===Asc.c_oAscSelectionType.RangeCol||i===Asc.c_oAscSelectionType.RangeRow||i===Asc.c_oAscSelectionType.RangeMax,s.lockToolbar(Common.enumLock.selRange,r,{array:[s.btnImgAlign,s.btnImgBackward,s.btnImgForward,s.btnImgGroup,s.btnShapesMerge]});var c=this.api.asc_canGroupGraphicsObjects(),h=this.api.asc_canUnGroupGraphicsObjects();s.lockToolbar(Common.enumLock.cantGroupUngroup,!c&&!h,{array:[s.btnImgGroup]}),s.btnImgGroup.menu.items[0].setDisabled(!c),s.btnImgGroup.menu.items[1].setDisabled(!h),s.lockToolbar(Common.enumLock.cantGroup,!c,{array:[s.btnImgAlign]});var d=this.api.asc_getSelectedDrawingObjectsCount();if(s.btnImgAlign.menu.items[7].setDisabled(d<3),s.btnImgAlign.menu.items[8].setDisabled(d<3),s.lockToolbar(Common.enumLock.cantMergeShape,!this.api.asc_canMergeSelectedShapes(),{array:[s.btnShapesMerge]}),r=i===Asc.c_oAscSelectionType.RangeImage||i===Asc.c_oAscSelectionType.RangeChart||i===Asc.c_oAscSelectionType.RangeChartText||i===Asc.c_oAscSelectionType.RangeShape||i===Asc.c_oAscSelectionType.RangeShapeText||i===Asc.c_oAscSelectionType.RangeSlicer,s.lockToolbar(Common.enumLock.wsLockFormat,r&&!!this._state.wsProps.Objects&&!!this._state.is_lockText||!r&&!!this._state.wsProps.FormatCells),s.lockToolbar(Common.enumLock.wsLockFormatFill,r&&!!this._state.wsProps.Objects&&!!this._state.is_lockShape||!r&&!!this._state.wsProps.FormatCells),s.lockToolbar(Common.enumLock.Objects,!!this._state.wsProps.Objects),s.lockToolbar(Common.enumLock.FormatCells,!!this._state.wsProps.FormatCells),s.lockToolbar(Common.enumLock.commentLock,i==Asc.c_oAscSelectionType.RangeCells&&(!t.asc_getComments()||t.asc_getComments().length>0||t.asc_getLocked())||i!=Asc.c_oAscSelectionType.RangeCells,{array:this.btnsComment}),s.lockToolbar(Common.enumLock.pageBreakLock,this.api.asc_GetPageBreaksDisableType(this.api.asc_getActiveWorksheetIndex())===Asc.c_oAscPageBreaksDisableType.all,{array:[s.btnPageBreak]}),!n){if(!s.mode.isEditMailMerge&&!s.mode.isEditDiagram&&!s.mode.isEditOle){e=a.asc_getFontBold(),this._state.bold!==e&&(s.btnBold.toggle(!0===e,!0),this._state.bold=e),e=a.asc_getFontItalic(),this._state.italic!==e&&(s.btnItalic.toggle(!0===e,!0),this._state.italic=e),e=a.asc_getFontUnderline(),this._state.underline!==e&&(s.btnUnderline.toggle(!0===e,!0),this._state.underline=e),e=a.asc_getFontStrikeout(),this._state.strikeout!==e&&(s.btnStrikeout.toggle(!0===e,!0),this._state.strikeout=e);var m=a.asc_getFontSubscript(),p=a.asc_getFontSuperscript();if(this._state.subscript!==m||this._state.superscript!==p){var u=p?0:m?1:-1,g=s.btnSubscript;g.toggle(u>-1,!0),u<0?g.menu.clearAll(!0):(g.menu.items[u].setChecked(!0),g.rendered&&(g.$icon.removeClass(g.options.icls),g.options.icls=g.menu.items[u].options.icls,g.$icon.addClass(g.options.icls))),this._state.subscript=m,this._state.superscript=p}}var f,b,C=this.toolbar.mnuTextColorPicker,v=this.toolbar.mnuBackColorPicker;if(!C.isDummy){if(b=a.asc_getFontColor())if(b.get_auto())"auto"!==this._state.clrtext&&(C.clearSelection(),s.btnTextColor.setAutoColor(!0),this._state.clrtext="auto");else{var _=_typeof(f=b.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(b.get_r(),b.get_g(),b.get_b()),effectValue:b.get_value()}:Common.Utils.ThemeColor.getHexColor(b.get_r(),b.get_g(),b.get_b())),w=_typeof(this._state.clrtext);("auto"==this._state.clrtext||_!==w||"object"==_&&(f.effectValue!==this._state.clrtext.effectValue||this._state.clrtext.color.indexOf(f.color)<0)||"object"!=_&&void 0!==this._state.clrtext&&this._state.clrtext.indexOf(f)<0)&&(s.btnTextColor.setAutoColor(!1),Common.Utils.ThemeColor.selectPickerColorByEffect(f,C),this._state.clrtext=f)}this._state.clrtext_asccolor=b}v.isDummy||(((_=_typeof(f=(b=a.asc_getFillColor())&&!b.get_auto()?b.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(b.get_r(),b.get_g(),b.get_b()),effectValue:b.get_value()}:Common.Utils.ThemeColor.getHexColor(b.get_r(),b.get_g(),b.get_b()):"transparent"))!==(w=_typeof(this._state.clrback))||"object"==_&&(f.effectValue!==this._state.clrback.effectValue||this._state.clrback.color.indexOf(f.color)<0)||"object"!=_&&void 0!==this._state.clrback&&this._state.clrback.indexOf(f)<0)&&(Common.Utils.ThemeColor.selectPickerColorByEffect(f,v),this._state.clrback=f),this._state.clrshd_asccolor=b);var A=i==Asc.c_oAscSelectionType.RangeChart||i==Asc.c_oAscSelectionType.RangeChartText;if(A!==this._state.in_chart&&(s.btnInsertChart.updateHint(A?s.tipChangeChart:s.tipInsertChart),this._state.in_chart=A),!A){if(!s.mode.isEditDiagram){var y=t.asc_getAutoFilterInfo(),S=t.asc_getFormatTableInfo();if(!s.mode.isEditMailMerge){var x=a.asc_getHorAlign();if(this._state.pralign!==x){this._state.pralign=x;u=-1;switch(x){case AscCommon.align_Left:u=0,"btn-align-left";break;case AscCommon.align_Center:u=1,"btn-align-center";break;case AscCommon.align_Right:u=2,"btn-align-right";break;case AscCommon.align_Justify:u=3,"btn-align-just";break;default:u=-255,"btn-align-left"}u<0?-255==u&&(s.btnAlignRight.toggle(!1,!0),s.btnAlignLeft.toggle(!1,!0),s.btnAlignCenter.toggle(!1,!0),s.btnAlignJust.toggle(!1,!0)):(s.btnAlignRight.toggle(2===u,!0),s.btnAlignLeft.toggle(0===u,!0),s.btnAlignCenter.toggle(1===u,!0),s.btnAlignJust.toggle(3===u,!0)),s.btnWrap.allowDepress=x!==AscCommon.align_Justify}if(r=x==AscCommon.align_Justify||i==Asc.c_oAscSelectionType.RangeShapeText||i==Asc.c_oAscSelectionType.RangeShape,s.btnTextOrient.menu.items[1].setDisabled(r),s.btnTextOrient.menu.items[2].setDisabled(r),s.btnTextOrient.menu.items[3].setDisabled(r),x=a.asc_getVertAlign(),this._state.valign!==x){switch(this._state.valign=x,u=-1,"",x){case Asc.c_oAscVAlign.Top:u=0,"btn-valign-top";break;case Asc.c_oAscVAlign.Center:u=1,"btn-valign-middle";break;case Asc.c_oAscVAlign.Bottom:u=2,"btn-valign-bottom"}s.btnAlignTop.toggle(0===u,!0),s.btnAlignMiddle.toggle(1===u,!0),s.btnAlignBottom.toggle(2===u,!0)}r=this._state.controlsdisabled.filters||null!==S||y&&null===y.asc_getIsAutoFilter(),s.lockToolbar(Common.enumLock.ruleMerge,r,{array:[s.btnMerge,s.btnInsertTable]}),e=t.asc_getMerge(),this._state.merge!==e&&(s.btnMerge.toggle(e===Asc.c_oAscMergeOptions.Merge,!0),this._state.merge=e),s.btnWrap.isDisabled()||(e=a.asc_getWrapText(),this._state.wrap!==e&&(s.btnWrap.toggle(!0===e,!0),this._state.wrap=e))}e=y?y.asc_getIsAutoFilter():null,this._state.filter!==e&&(s.btnsSetAutofilter.toggle(!0===e,!0),this._state.filter=e),r=this._state.controlsdisabled.filters||null===e,s.lockToolbar(Common.enumLock.ruleFilter,r,{array:s.btnsSetAutofilter.concat(s.btnCustomSort,s.btnTableTemplate,s.btnInsertTable,s.btnRemoveDuplicates,s.btnDataValidation)}),s.lockToolbar(Common.enumLock.tableHasSlicer,y&&y.asc_getIsSlicerAdded(),{array:s.btnsSetAutofilter}),r=i!==Asc.c_oAscSelectionType.RangeSlicer&&(this._state.controlsdisabled.filters||null===e),s.lockToolbar(Common.enumLock.cantSort,r,{array:s.btnsSortDown.concat(s.btnsSortUp)}),e=S?S.asc_getTableStyleName():null,this._state.tablestylename!==e&&this.toolbar.mnuTableTemplatePicker&&((e=this.toolbar.mnuTableTemplatePicker.store.findWhere({name:e}))?(this.toolbar.mnuTableTemplatePicker.selectRecord(e),this._state.tablestylename=e.get("name")):(s.mnuTableTemplatePicker.deselectAll(),this._state.tablestylename=null)),r=this._state.controlsdisabled.filters||!y||!0!==y.asc_getIsApplyAutoFilter(),s.lockToolbar(Common.enumLock.ruleDelFilter,r,{array:s.btnsClearAutofilter});var k=this._state.tablename;this._state.tablename=S?S.asc_getTableName():void 0;var T=this._state.filterapplied;this._state.filterapplied=this._state.filter&&y.asc_getIsApplyAutoFilter(),this._state.tablename===k&&this._state.filterapplied===T||this.getApplication().getController("Statusbar").onApiFilterInfo(!r),this._state.multiselect=t.asc_getMultiselect(),s.lockToolbar(Common.enumLock.multiselect,this._state.multiselect,{array:[s.btnTableTemplate,s.btnInsertHyperlink,s.btnInsertTable]});var I=!!t.asc_getPivotTableInfo();this._state.inpivot!==I&&(!I&&this.toolbar.isTabActive("pivot")&&this.toolbar.setTab("home"),this.toolbar.setVisible("pivot",!!I),I&&this._state.showPivotTab&&this.toolbar.setTab("pivot"),this._state.inpivot=I),s.lockToolbar(Common.enumLock.editPivot,this._state.inpivot,{array:s.btnsSetAutofilter.concat(s.btnMerge,s.btnInsertHyperlink,s.btnInsertTable,s.btnRemoveDuplicates,s.btnDataValidation)}),s.lockToolbar(Common.enumLock.noSlicerSource,!(this._state.inpivot||S),{array:[s.btnInsertSlicer]}),r=!this.appConfig.canModifyFilter,s.lockToolbar(Common.enumLock.cantModifyFilter,r,{array:s.btnsSetAutofilter.concat(s.btnsSortDown,s.btnsSortUp,s.btnCustomSort,s.btnTableTemplate,s.btnClearStyle.menu.items[0],s.btnClearStyle.menu.items[2],s.btnInsertTable,s.btnRemoveDuplicates,s.btnDataValidation)})}if((e=a.asc_getNumFormatInfo())&&(this._state.numformat=a.asc_getNumFormat(),this._state.numformatinfo=e,e=e.asc_getType(),this._state.numformattype!==e&&(s.cmbNumberFormat.setValue(e,s.txtCustom),this._state.numformattype=e)),e=a.asc_getAngle(),this._state.angle!==e){switch(s.btnTextOrient.menu.clearAll(!0),e){case 45:s.btnTextOrient.menu.items[1].setChecked(!0,!0);break;case-45:s.btnTextOrient.menu.items[2].setChecked(!0,!0);break;case 255:s.btnTextOrient.menu.items[3].setChecked(!0,!0);break;case 90:s.btnTextOrient.menu.items[4].setChecked(!0,!0);break;case-90:s.btnTextOrient.menu.items[5].setChecked(!0,!0);break;case 0:s.btnTextOrient.menu.items[0].setChecked(!0,!0)}this._state.angle=e}if(e=t.asc_getStyleName(),this._state.prstyle!=e&&!this.toolbar.listStyles.isDisabled()){var E=this.toolbar.listStyles;if(E.rendered){E.suspendEvents();var P=E.menuPicker.store.findWhere({name:e});this._state.prstyle=E.menuPicker.store.length>0?e:void 0,E.menuPicker.selectRecord(P),E.resumeEvents()}}var D=i==Asc.c_oAscSelectionType.RangeCol,M=i==Asc.c_oAscSelectionType.RangeRow,U=i==Asc.c_oAscSelectionType.RangeMax;r=M||U&&this._state.wsLock||this._state.wsProps.InsertColumns,s.btnAddCell.menu.items[3].setDisabled(r),r=M||U&&this._state.wsLock||!D&&this._state.wsLock||this._state.wsProps.DeleteColumns,s.btnDeleteCell.menu.items[3].setDisabled(r),r=D||U&&this._state.wsLock||this._state.wsProps.InsertRows,s.btnAddCell.menu.items[2].setDisabled(r),r=D||U&&this._state.wsLock||!M&&this._state.wsLock||this._state.wsProps.DeleteRows,s.btnDeleteCell.menu.items[2].setDisabled(r),e=y&&y.asc_getIsApplyAutoFilter(),r=M||e||!(D||U)&&this._state.wsLock||D&&this._state.wsProps.InsertColumns||U&&this._state.wsProps.InsertColumns&&this._state.wsProps.InsertRows,s.btnAddCell.menu.items[0].setDisabled(r),r=M||e||!(D||U)&&this._state.wsLock||D&&this._state.wsProps.DeleteColumns||U&&this._state.wsProps.DeleteColumns&&this._state.wsProps.DeleteRows,s.btnDeleteCell.menu.items[0].setDisabled(r),r=D||e||!(M||U)&&this._state.wsLock||M&&this._state.wsProps.InsertRows||U&&this._state.wsProps.InsertColumns&&this._state.wsProps.InsertRows,s.btnAddCell.menu.items[1].setDisabled(r),r=D||e||!(M||U)&&this._state.wsLock||M&&this._state.wsProps.DeleteRows||U&&this._state.wsProps.DeleteColumns&&this._state.wsProps.DeleteRows,s.btnDeleteCell.menu.items[1].setDisabled(r);for(var F=s.btnAddCell.menu.getItems(!0),R=!1,L=0;L<4;L++)!F[L].isDisabled()&&(R=!0);s.lockToolbar(Common.enumLock.itemsDisabled,!R,{array:[s.btnAddCell]}),F=this.toolbar.btnDeleteCell.menu.getItems(!0),R=!1;for(L=0;L<4;L++)!F[L].isDisabled()&&(R=!0);s.lockToolbar(Common.enumLock.itemsDisabled,!R,{array:[s.btnDeleteCell]}),s.lockToolbar(Common.enumLock.headerLock,t.asc_getLockedHeaderFooter(),{array:this.toolbar.btnsEditHeader}),this._state.isUserProtected=t.asc_getUserProtected(),s.lockToolbar(Common.enumLock.userProtected,this._state.isUserProtected)}}}},onApiSelectionChangedRestricted:function(t){if(this.appConfig.isRestrictedEdit&&t){var e=t.asc_getSelectionType();this.toolbar.lockToolbar(Common.enumLock.commentLock,e==Asc.c_oAscSelectionType.RangeCells&&(!t.asc_getComments()||t.asc_getComments().length>0||t.asc_getLocked())||e!=Asc.c_oAscSelectionType.RangeCells,{array:this.btnsComment}),this.toolbar.lockToolbar(Common.enumLock.Objects,!!this._state.wsProps.Objects,{array:this.btnsComment})}},onApiSelectionChanged_DiagramEditor:function(t){if(this.editMode&&!this.api.isCellEdited&&!this.api.isRangeSelection&&t){var e=this,i=t.asc_getSelectionType(),o=t.asc_getXfs();if(!function(t,i){var o=t==Asc.c_oAscSelectionType.RangeChartText,n=t==Asc.c_oAscSelectionType.RangeChart,s=t==Asc.c_oAscSelectionType.RangeShapeText,a=t==Asc.c_oAscSelectionType.RangeShape,r=t==Asc.c_oAscSelectionType.RangeImage||t==Asc.c_oAscSelectionType.RangeSlicer,l=s||a||o||n,c=!1;if(!l&&!r&&e._state.selection_type===t&&e._state.coauthdisable===i)return t===Asc.c_oAscSelectionType.RangeImage;l&&(c=e.api.asc_getGraphicObjectProps().some((function(t){return t.asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image&&t.asc_getObjectValue().asc_getLocked()})));var h=Common.enumLock,d=t;switch(t){case Asc.c_oAscSelectionType.RangeSlicer:case Asc.c_oAscSelectionType.RangeImage:d=h.selImage;break;case Asc.c_oAscSelectionType.RangeShape:d=h.selShape;break;case Asc.c_oAscSelectionType.RangeShapeText:d=h.selShapeText;break;case Asc.c_oAscSelectionType.RangeChart:d=h.selChart;break;case Asc.c_oAscSelectionType.RangeChartText:d=h.selChartText}return e.toolbar.lockToolbar(d,d!=t,{clear:[h.selImage,h.selChart,h.selChartText,h.selShape,h.selShapeText,h.coAuth]}),e.toolbar.lockToolbar(Common.enumLock.coAuthText,c),r}(i,!1)){var n=i===Asc.c_oAscSelectionType.RangeCells||i===Asc.c_oAscSelectionType.RangeCol||i===Asc.c_oAscSelectionType.RangeRow||i===Asc.c_oAscSelectionType.RangeMax;if(this.toolbar.lockToolbar(Common.enumLock.selRange,n,{array:[this.toolbar.btnEditChartData,this.toolbar.btnEditChartType]}),i!=Asc.c_oAscSelectionType.RangeChart&&i!=Asc.c_oAscSelectionType.RangeChartText){var s=o.asc_getNumFormatInfo();s&&(this._state.numformat=o.asc_getNumFormat(),this._state.numformatinfo=s,s=s.asc_getType(),this._state.numformattype!==s&&(e.toolbar.cmbNumberFormat.setValue(s,e.toolbar.txtCustom),this._state.numformattype=s))}}}},onApiSelectionChanged_MailMergeEditor:function(t){if(this.editMode&&!this.api.isCellEdited&&!this.api.isRangeSelection&&t){var e,i=this,o=t.asc_getSelectionType(),n=function(t,e){var o=t==Asc.c_oAscSelectionType.RangeChartText,n=t==Asc.c_oAscSelectionType.RangeChart,s=t==Asc.c_oAscSelectionType.RangeShapeText,a=t==Asc.c_oAscSelectionType.RangeShape,r=t==Asc.c_oAscSelectionType.RangeImage||t==Asc.c_oAscSelectionType.RangeSlicer,l=s||a||o||n,c=!1;if(!l&&!r&&i._state.selection_type===t&&i._state.coauthdisable===e)return t===Asc.c_oAscSelectionType.RangeImage;l&&(c=i.api.asc_getGraphicObjectProps().some((function(t){return t.asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image&&t.asc_getObjectValue().asc_getLocked()})));return i.toolbar.lockToolbar(Common.enumLock.coAuthText,c),r}(o,!1),s=!1;if(!n&&o!=Asc.c_oAscSelectionType.RangeChart&&o!=Asc.c_oAscSelectionType.RangeChartText&&!i.toolbar.mode.isEditDiagram){var a=t.asc_getAutoFilterInfo();e=a?a.asc_getIsAutoFilter():null,this._state.filter!==e&&(i.toolbar.btnSetAutofilter.toggle(!0===e,!0),this._state.filter=e),s=this._state.controlsdisabled.filters||null===e,i.toolbar.lockToolbar(Common.enumLock.ruleFilter,s,{array:[i.toolbar.btnSetAutofilter,i.toolbar.btnSortDown,i.toolbar.btnSortUp]}),s=this._state.controlsdisabled.filters||!a||!0!==a.asc_getIsApplyAutoFilter(),i.toolbar.lockToolbar(Common.enumLock.ruleDelFilter,s,{array:[i.toolbar.btnClearAutofilter]})}}},onApiSelectionChanged_OleEditor:function(t){if(this.editMode&&!this.api.isCellEdited&&!this.api.isRangeSelection&&t){var e,i=this,o=t.asc_getSelectionType(),n=t.asc_getXfs(),s=this.toolbar,a=function(t,e){var o=t==Asc.c_oAscSelectionType.RangeChartText,n=t==Asc.c_oAscSelectionType.RangeChart,s=t==Asc.c_oAscSelectionType.RangeShapeText,a=t==Asc.c_oAscSelectionType.RangeShape,r=t==Asc.c_oAscSelectionType.RangeImage||t==Asc.c_oAscSelectionType.RangeSlicer,l=s||a||o||n,c=!1;if(!l&&!r&&i._state.selection_type===t&&i._state.coauthdisable===e)return t===Asc.c_oAscSelectionType.RangeImage;l&&(c=i.api.asc_getGraphicObjectProps().some((function(t){return t.asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image&&t.asc_getObjectValue().asc_getLocked()})));var h=Common.enumLock,d=t;switch(t){case Asc.c_oAscSelectionType.RangeSlicer:case Asc.c_oAscSelectionType.RangeImage:d=h.selImage;break;case Asc.c_oAscSelectionType.RangeShape:d=h.selShape;break;case Asc.c_oAscSelectionType.RangeShapeText:d=h.selShapeText;break;case Asc.c_oAscSelectionType.RangeChart:d=h.selChart;break;case Asc.c_oAscSelectionType.RangeChartText:d=h.selChartText}return i.toolbar.lockToolbar(d,d!=t,{clear:[h.selImage,h.selChart,h.selChartText,h.selShape,h.selShapeText,h.coAuth]}),i.toolbar.lockToolbar(Common.enumLock.coAuthText,c),i._state.controlsdisabled.filters=r||l,r}(o,!1),r=!1;if(!a&&o!=Asc.c_oAscSelectionType.RangeChart&&o!=Asc.c_oAscSelectionType.RangeChartText){Common.NotificationCenter.trigger("fonts:change",n);var l=n.asc_getFontSize();this._state.fontsize!==l&&(s.cmbFontSize.setValue(void 0!==l?l:""),this._state.fontsize=l),e=n.asc_getFontBold(),this._state.bold!==e&&(s.btnTextFormatting.menu.items[0].setChecked(!0===e),this._state.bold=e),e=n.asc_getFontItalic(),this._state.italic!==e&&(s.btnTextFormatting.menu.items[1].setChecked(!0===e),this._state.italic=e),e=n.asc_getFontUnderline(),this._state.underline!==e&&(s.btnTextFormatting.menu.items[2].setChecked(!0===e),this._state.underline=e),e=n.asc_getFontStrikeout(),this._state.strikeout!==e&&(s.btnTextFormatting.menu.items[3].setChecked(!0===e),this._state.strikeout=e),e=n.asc_getFontSuperscript(),this._state.superscript!==e&&(s.btnTextFormatting.menu.items[4].setChecked(!0===e),this._state.superscript=e),e=n.asc_getFontSubscript(),this._state.subscript!==e&&(s.btnTextFormatting.menu.items[5].setChecked(!0===e),this._state.subscript=e);var c,h,d=s.mnuTextColorPicker,m=s.mnuBackColorPicker;if(!d.isDummy){if(h=n.asc_getFontColor())if(h.get_auto())"auto"!==this._state.clrtext&&(d.clearSelection(),s.btnTextColor.setAutoColor(!0),this._state.clrtext="auto");else{var p=_typeof(c=h.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(h.get_r(),h.get_g(),h.get_b()),effectValue:h.get_value()}:Common.Utils.ThemeColor.getHexColor(h.get_r(),h.get_g(),h.get_b())),u=_typeof(this._state.clrtext);("auto"==this._state.clrtext||p!==u||"object"==p&&(c.effectValue!==this._state.clrtext.effectValue||this._state.clrtext.color.indexOf(c.color)<0)||"object"!=p&&void 0!==this._state.clrtext&&this._state.clrtext.indexOf(c)<0)&&(s.btnTextColor.setAutoColor(!1),Common.Utils.ThemeColor.selectPickerColorByEffect(c,d),this._state.clrtext=c)}this._state.clrtext_asccolor=h}m.isDummy||(((p=_typeof(c=(h=n.asc_getFillColor())&&!h.get_auto()?h.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(h.get_r(),h.get_g(),h.get_b()),effectValue:h.get_value()}:Common.Utils.ThemeColor.getHexColor(h.get_r(),h.get_g(),h.get_b()):"transparent"))!==(u=_typeof(this._state.clrback))||"object"==p&&(c.effectValue!==this._state.clrback.effectValue||this._state.clrback.color.indexOf(c.color)<0)||"object"!=p&&void 0!==this._state.clrback&&this._state.clrback.indexOf(c)<0)&&(Common.Utils.ThemeColor.selectPickerColorByEffect(c,m),this._state.clrback=c),this._state.clrshd_asccolor=h);var g=t.asc_getAutoFilterInfo(),f=t.asc_getFormatTableInfo(),b=n.asc_getHorAlign();if(this._state.pralign!==b){this._state.pralign=b;var C,v=-1;switch(b){case AscCommon.align_Left:v=0,C="btn-align-left";break;case AscCommon.align_Center:v=1,C="btn-align-center";break;case AscCommon.align_Right:v=2,C="btn-align-right";break;case AscCommon.align_Justify:v=3,C="btn-align-just";break;default:v=-255,C="btn-align-left"}v<0?-255==v&&s.btnHorizontalAlign.menu.clearAll(!0):s.btnHorizontalAlign.menu.items[v].setChecked(!0),s.btnHorizontalAlign.rendered&&s.btnHorizontalAlign.$icon&&(s.btnHorizontalAlign.$icon.removeClass(s.btnHorizontalAlign.options.icls).addClass(C),s.btnHorizontalAlign.options.icls=C),s.btnWrap.allowDepress=b!==AscCommon.align_Justify}if(b=n.asc_getVertAlign(),this._state.valign!==b){switch(this._state.valign=b,v=-1,C="",b){case Asc.c_oAscVAlign.Top:v=0,C="btn-align-top";break;case Asc.c_oAscVAlign.Center:v=1,C="btn-align-middle";break;case Asc.c_oAscVAlign.Bottom:v=2,C="btn-align-bottom"}v<0?-255==v&&s.btnVerticalAlign.menu.clearAll(!0):s.btnVerticalAlign.menu.items[v].setChecked(!0),s.btnVerticalAlign.rendered&&s.btnVerticalAlign.$icon&&(s.btnVerticalAlign.$icon.removeClass(s.btnVerticalAlign.options.icls).addClass(C),s.btnVerticalAlign.options.icls=C)}r=this._state.controlsdisabled.filters||null!==f||g&&null===g.asc_getIsAutoFilter(),s.lockToolbar(Common.enumLock.ruleMerge,r,{array:[s.btnMerge]}),e=t.asc_getMerge(),this._state.merge!==e&&(s.btnMerge.toggle(e===Asc.c_oAscMergeOptions.Merge,!0),this._state.merge=e),s.btnWrap.isDisabled()||(e=n.asc_getWrapText(),this._state.wrap!==e&&(s.btnWrap.toggle(!0===e,!0),this._state.wrap=e)),e=g?g.asc_getIsAutoFilter():null,this._state.filter=e,r=this._state.controlsdisabled.filters||null===e,s.lockToolbar(Common.enumLock.ruleFilter,r,{array:[s.btnTableTemplate]}),e=f?f.asc_getTableStyleName():null,this._state.tablestylename!==e&&this.toolbar.mnuTableTemplatePicker&&((e=this.toolbar.mnuTableTemplatePicker.store.findWhere({name:e}))?(this.toolbar.mnuTableTemplatePicker.selectRecord(e),this._state.tablestylename=e.get("name")):(s.mnuTableTemplatePicker.deselectAll(),this._state.tablestylename=null)),e=t.asc_getStyleName(),this._state.prstyle!=e&&this.toolbar.mnuCellStylePicker&&((e=this.toolbar.mnuCellStylePicker.store.findWhere({name:e}))?(this.toolbar.mnuCellStylePicker.selectRecord(e),this._state.prstyle=e.get("name")):(this.toolbar.mnuCellStylePicker.deselectAll(),this._state.prstyle=null));var _=this._state.tablename;this._state.tablename=f?f.asc_getTableName():void 0;var w=this._state.filterapplied;this._state.filterapplied=this._state.filter&&g.asc_getIsApplyAutoFilter(),this._state.tablename===_&&this._state.filterapplied===w||this.getApplication().getController("Statusbar").onApiFilterInfo(!r),this._state.multiselect=t.asc_getMultiselect(),s.lockToolbar(Common.enumLock.multiselect,this._state.multiselect,{array:[s.btnTableTemplate]}),this._state.inpivot=!!t.asc_getPivotTableInfo(),s.lockToolbar(Common.enumLock.editPivot,this._state.inpivot,{array:[s.btnMerge]}),r=!this.appConfig.canModifyFilter,s.lockToolbar(Common.enumLock.cantModifyFilter,r,{array:[s.btnTableTemplate]}),(e=n.asc_getNumFormatInfo())&&(this._state.numformat=n.asc_getNumFormat(),this._state.numformatinfo=e,e=e.asc_getType(),this._state.numformattype!==e&&(i.toolbar.cmbNumberFormat.setValue(e,i.toolbar.txtCustom),this._state.numformattype=e))}}},onApiEditorSelectionChanged_OleEditor:function(t){if(this.editMode&&!($(".asc-window.enable-key-events:visible").length>0)){var e,i=this.toolbar;Common.NotificationCenter.trigger("fonts:change",t),e=t.asc_getFontBold(),this._state.bold!==e&&(i.btnTextFormatting.menu.items[0].setChecked(!0===e),this._state.bold=e),e=t.asc_getFontItalic(),this._state.italic!==e&&(i.btnTextFormatting.menu.items[1].setChecked(!0===e),this._state.italic=e),e=t.asc_getFontUnderline(),this._state.underline!==e&&(i.btnTextFormatting.menu.items[2].setChecked(!0===e),this._state.underline=e),e=t.asc_getFontStrikeout(),this._state.strikeout!==e&&(i.btnTextFormatting.menu.items[3].setChecked(!0===e),this._state.strikeout=e),e=t.asc_getFontSubscript(),this._state.subscript!==e&&(i.btnTextFormatting.menu.items[4].setChecked(!0===e),this._state.subscript=e),e=t.asc_getFontSuperscript(),this._state.superscript!==e&&(i.btnTextFormatting.menu.items[5].setChecked(!0===e),this._state.superscript=e);var o=t.asc_getFontSize();this._state.fontsize!==o&&(i.cmbFontSize.setValue(void 0!==o?o:""),this._state.fontsize=o);var n,s,a=this.toolbar.mnuTextColorPicker;if(!a.isDummy){if(s=t.asc_getFontColor())if(s.get_auto())"auto"!==this._state.clrtext&&(a.clearSelection(),this.toolbar.btnTextColor.setAutoColor(!0),this._state.clrtext="auto");else{var r=_typeof(n=s.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(s.get_r(),s.get_g(),s.get_b()),effectValue:s.get_value()}:Common.Utils.ThemeColor.getHexColor(s.get_r(),s.get_g(),s.get_b())),l=_typeof(this._state.clrtext);("auto"==this._state.clrtext||r!==l||"object"==r&&(n.effectValue!==this._state.clrtext.effectValue||this._state.clrtext.color.indexOf(n.color)<0)||"object"!=r&&void 0!==this._state.clrtext&&this._state.clrtext.indexOf(n)<0)&&(this.toolbar.btnTextColor.setAutoColor(!1),Common.Utils.ThemeColor.selectPickerColorByEffect(n,a),this._state.clrtext=n)}this._state.clrtext_asccolor=s}}},onApiStyleChange:function(){this.toolbar.btnCopyStyle.toggle(!1,!0),this.modeAlwaysSetStyle=!1},updateThemeColors:function(){var t=function(t,e){if(t){for(var i,o=Common.Utils.ThemeColor.getEffectColors(),n=0;n<o.length;n++)"object"==_typeof(t.currentColor)&&void 0===i&&t.currentColor.effectId==o[n].effectId&&(i=o[n]);t.updateColors(o,Common.Utils.ThemeColor.getStandartColors()),void 0===t.currentColor?t.currentColor=e:void 0!==i&&(t.currentColor=i)}};if(t(this.toolbar.mnuTextColorPicker,Common.Utils.ThemeColor.getStandartColors()[1]),void 0!==this.toolbar.btnTextColor.currentColor&&this.toolbar.btnTextColor.currentColor.isAuto||(this.toolbar.btnTextColor.currentColor=Common.Utils.ThemeColor.getStandartColors()[1],this.toolbar.btnTextColor.setColor(this.toolbar.btnTextColor.currentColor)),t(this.toolbar.mnuBackColorPicker,Common.Utils.ThemeColor.getStandartColors()[3]),void 0===this.toolbar.btnBackColor.currentColor?this.toolbar.btnBackColor.currentColor=Common.Utils.ThemeColor.getStandartColors()[3]:this.toolbar.btnBackColor.currentColor=this.toolbar.mnuBackColorPicker.currentColor.color||this.toolbar.mnuBackColorPicker.currentColor,this.toolbar.btnBackColor.setColor(this.toolbar.btnBackColor.currentColor),void 0===this._state.clrtext_asccolor&&void 0===this._state.clrshd_asccolor||(this._state.clrtext=void 0,this._state.clrback=void 0,this.onApiSelectionChanged(this.api.asc_getCellInfo())),this._state.clrtext_asccolor=void 0,this._state.clrshd_asccolor=void 0,this.toolbar.mnuBorderColorPicker){t(this.toolbar.mnuBorderColorPicker,{color:"000",isAuto:!0});var e=this.toolbar.mnuBorderColorPicker.currentColor;if(e&&e.isAuto){var i=this.toolbar.btnBorders.menu.$el.find("#id-toolbar-menu-auto-bordercolor > a");!i.hasClass("selected")&&i.addClass("selected")}this.toolbar.btnBorders.options.borderscolor=e.color||e,$("#id-toolbar-mnu-item-border-color > a .menu-item-icon").css("border-color","#"+this.toolbar.btnBorders.options.borderscolor)}},hideElements:function(t){if(_.isUndefined(t.compact)||this.onChangeViewMode(t.compact),!_.isUndefined(t.formula)){var e=this.getApplication().getController("CellEditor").getView("CellEditor");e&&e.setVisible(!t.formula),Common.NotificationCenter.trigger("layout:changed","celleditor",t.formula?"hidden":"showed")}_.isUndefined(t.headings)||this.api&&this.api.asc_setDisplayHeadings(!t.headings),_.isUndefined(t.gridlines)||this.api&&this.api.asc_setDisplayGridlines(!t.gridlines),_.isUndefined(t.freezepanes)||this.api&&this.api.asc_freezePane(),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onApiAutoShapes:function(){var t=this,e=function(i){t.fillAutoShapes(),i.off("show:before",e)};t.toolbar.btnInsertShape.menu.on("show:before",e)},fillAutoShapes:function(){var t=this,e=new Common.UI.MenuItem({template:_.template('<div id="id-toolbar-menu-insertshape" class="menu-insertshape"></div>')});t.toolbar.btnInsertShape.menu.addItem(e,!0);var i=Common.localStorage.getItem("sse-recent-shapes"),o=new Common.UI.DataViewShape({el:$("#id-toolbar-menu-insertshape"),itemTemplate:_.template('<div class="item-shape" id="<%= id %>"><svg width="20" height="20" class="icon uni-scale"><use xlink:href="#svg-icon-<%= data.shapeType %>"></use></svg></div>'),groups:t.getApplication().getCollection("ShapeGroups"),parentMenu:t.toolbar.btnInsertShape.menu,outerMenu:{menu:t.toolbar.btnInsertShape.menu,index:0},restoreHeight:652,textRecentlyUsed:t.textRecentlyUsed,recentShapes:i?JSON.parse(i):null});t.toolbar.btnInsertShape.menu.setInnerMenu([{menu:o,index:0}]),o.on("item:click",(function(e,i,o,n){t.api&&(o&&(t._addAutoshape(!0,o.get("data").shapeType),t._isAddingShape=!0),t.toolbar.btnInsertText.pressed&&t.toolbar.btnInsertText.toggle(!1,!0),"click"!==n.type&&t.toolbar.btnInsertShape.menu.hide(),Common.NotificationCenter.trigger("edit:complete",t.toolbar,t.toolbar.btnInsertShape),Common.component.Analytics.trackEvent("ToolBar","Add Shape"))}))},fillEquations:function(){if(this.toolbar.btnInsertEquation.rendered&&!(this.toolbar.btnInsertEquation.menu.getItemsLength(!0)>0)){var t=this,e=this.getApplication().getCollection("EquationGroups"),i=function(o){for(var n=0;n<e.length;++n){new Common.UI.DataViewSimple({el:$("#id-toolbar-menu-equationgroup"+n),parentMenu:o.items[n].menu,store:e.at(n).get("groupStore"),scrollAlwaysVisible:!0,itemTemplate:_.template('<div class="item-equation"><div class="equation-icon" style="background-position:<%= posX %>px <%= posY %>px;width:<%= width %>px;height:<%= height %>px;" id="<%= id %>"></div></div>')}).on("item:click",(function(e,i,o,n){t.api&&(o&&t.api.asc_AddMath(o.get("data").equationType),t.toolbar.btnInsertText.pressed&&t.toolbar.btnInsertText.toggle(!1,!0),t.toolbar.btnInsertShape.pressed&&t.toolbar.btnInsertShape.toggle(!1,!0),"click"!==n.type&&t.toolbar.btnInsertEquation.menu.hide(),Common.NotificationCenter.trigger("edit:complete",t.toolbar,t.toolbar.btnInsertEquation),Common.component.Analytics.trackEvent("ToolBar","Add Equation"))}))}o.off("show:after",i)};t.toolbar.btnInsertEquation.menu.on("show:after",i);for(var o=0;o<e.length;++o){var n=e.at(o),s=new Common.UI.MenuItem({caption:n.get("groupName"),menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{template:_.template('<div id="id-toolbar-menu-equationgroup'+o+'" class="menu-shape margin-left-5" style="width:'+(n.get("groupWidth")+8)+"px; "+n.get("groupHeightStr")+'"></div>')}]})});t.toolbar.btnInsertEquation.menu.addItem(s,!0)}}},onInsertEquationClick:function(){this.api&&(this.api.asc_AddMath(),Common.component.Analytics.trackEvent("ToolBar","Add Equation")),Common.NotificationCenter.trigger("edit:complete",this.toolbar,this.toolbar.btnInsertEquation)},onInsertSymbolClick:function(){Common.NotificationCenter.trigger("protect:check",this.onInsertSymbolClickCallback,this,[])},onInsertSymbolClickCallback:function(){if(this.api){console.log("init");var t=this,e=t.api.asc_GetSelectedText(),i=new Common.Views.SymbolTableDialog({api:t.api,lang:t.toolbar.mode.lang,type:1,special:!0,buttons:[{value:"ok",caption:this.textInsert},"close"],font:e&&e.length>0?t.api.asc_getCellInfo().asc_getXfs().asc_getFontName():void 0,symbol:e&&e.length>0?e.charAt(0):void 0,handler:function(e,i,o){"ok"==i?t.insertSymbol(o.font,o.code,o.special,o.speccharacter):Common.NotificationCenter.trigger("edit:complete",t.toolbar)}});i.show(),i.on("symbol:dblclick",(function(e,i,o){t.insertSymbol(o.font,o.code,o.special,o.speccharacter)}))}},onInsertSymbolItemClick:function(t,e,i,o){this.api&&i&&this.insertSymbol(i.get("font"),i.get("symbol"),i.get("special"))},insertSymbol:function(t,e,i,o){var n=t||this.api.asc_getCellInfo().asc_getXfs().asc_getFontName();this.api.asc_insertSymbol(n,e,i),!o&&this.toolbar.saveSymbol(e,n)},onInsertSlicerClick:function(){var t=this,e=t.api.asc_beforeInsertSlicer();e&&new SSE.Views.SlicerAddDialog({props:e,handler:function(e,i){t&&t.api&&"ok"==e&&t.api.asc_insertSlicer(i),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}}).show()},onApiMathTypes:function(t){this._equationTemp=t;var e=this,i=function(t){e.onMathTypes(e._equationTemp),e._equationTemp&&e._equationTemp.get_Data().length>0&&e.fillEquations(),e.toolbar.btnInsertEquation.menu.off("show:before",i)};e.toolbar.btnInsertEquation.menu.on("show:before",i)},onMathTypes:function(t){t=t||this._equationTemp;var e=[],i=this.getCollection("EquationGroups");if(!(i.length>0)){var o={};o[Common.define.c_oAscMathMainType.Symbol]=[this.textSymbols,11,!1,"svg-icon-symbols"],o[Common.define.c_oAscMathMainType.Fraction]=[this.textFraction,4,!1,"svg-icon-fraction"],o[Common.define.c_oAscMathMainType.Script]=[this.textScript,4,!1,"svg-icon-script"],o[Common.define.c_oAscMathMainType.Radical]=[this.textRadical,4,!1,"svg-icon-radical"],o[Common.define.c_oAscMathMainType.Integral]=[this.textIntegral,3,!0,"svg-icon-integral"],o[Common.define.c_oAscMathMainType.LargeOperator]=[this.textLargeOperator,5,!0,"svg-icon-largeOperator"],o[Common.define.c_oAscMathMainType.Bracket]=[this.textBracket,4,!0,"svg-icon-bracket"],o[Common.define.c_oAscMathMainType.Function]=[this.textFunction,3,!0,"svg-icon-function"],o[Common.define.c_oAscMathMainType.Accent]=[this.textAccent,4,!1,"svg-icon-accent"],o[Common.define.c_oAscMathMainType.LimitLog]=[this.textLimitAndLog,3,!1,"svg-icon-limAndLog"],o[Common.define.c_oAscMathMainType.Operator]=[this.textOperator,4,!1,"svg-icon-operator"],o[Common.define.c_oAscMathMainType.Matrix]=[this.textMatrix,4,!0,"svg-icon-matrix"];var n={},s="",a="";for(s in Common.define.c_oAscMathType){if(Common.define.c_oAscMathType.hasOwnProperty(s))a=2==(w=s.split("_")).length&&"Symbol"==w[0]?"txt"+w[0]+"_"+w[1].toLocaleLowerCase():"txt"+s,n[Common.define.c_oAscMathType[s]]=this[a]}var r,l,c=0,h=0,d=0,m=0,p=0,u=null,g=null,f=null;if(t&&(h=(l=t.get_Data()).length)){for(var b=0;b<h;++b){var C=l[b];if(c=C.get_Id(),m=C.get_W(),p=C.get_H(),u=new Backbone.Collection([],{model:SSE.Models.EquationModel})){var v=0,_=0,w=[];for(d=C.get_Data().length,r=0;r<d;++r){v=(g=C.get_Data()[r]).get_Data().length;for(var A=0;A<v;++A)_=(f=g.get_Data()[A]).get_Id(),a="",n.hasOwnProperty(_)&&(a=n[_]),w.push({data:{equationType:_},tip:a,allowSelected:!0,selected:!1,width:g.get_W(),height:g.get_H(),posX:-f.get_X(),posY:-f.get_Y()});v}u.add(w),m=o[c][1]*(m+10);var y=parseInt(370/(p+10))*(p+10);e.push({groupName:o[c][0],groupStore:u,groupWidth:m,groupHeight:y,groupHeightStr:o[c][2]?" height:"+y+"px!important; ":"",groupIcon:o[c][3]})}}i.add(e)}}},attachToControlEvents:function(){},_disableEditOptions:function(t,e){if(this.api.isCellEdited)return!0;if(this.api.isRangeSelection)return!0;var i=this.toolbar,o=t==Asc.c_oAscSelectionType.RangeChartText,n=t==Asc.c_oAscSelectionType.RangeChart,s=t==Asc.c_oAscSelectionType.RangeShapeText,a=t==Asc.c_oAscSelectionType.RangeShape,r=t==Asc.c_oAscSelectionType.RangeImage,l=t==Asc.c_oAscSelectionType.RangeSlicer,c=s||a||o||n||l,h=!1,d=!1,m=!1,p=!1;if(!c&&!r&&this._state.selection_type===t&&this._state.coauthdisable===e)return t===Asc.c_oAscSelectionType.RangeImage;if(c){for(var u=this.api.asc_getGraphicObjectProps(),g=0;g<u.length;++g)if(u[g].asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image){var f=u[g].asc_getObjectValue(),b=f?f.asc_getShapeProperties():null;b&&(d=b.asc_getFromSmartArtInternal()),h=h||f.asc_getLocked(),p=p||f.asc_getProtectionLockText(),m=m||f.asc_getProtectionLocked()}this._state.is_lockText=p,this._state.is_lockShape=m}if(e)i.lockToolbar(Common.enumLock.coAuth,e);else{var C=Common.enumLock,v=t;switch(t){case Asc.c_oAscSelectionType.RangeImage:v=C.selImage;break;case Asc.c_oAscSelectionType.RangeShape:v=C.selShape;break;case Asc.c_oAscSelectionType.RangeShapeText:v=C.selShapeText;break;case Asc.c_oAscSelectionType.RangeChart:v=C.selChart;break;case Asc.c_oAscSelectionType.RangeChartText:v=C.selChartText;break;case Asc.c_oAscSelectionType.RangeSlicer:v=C.selSlicer}this.appConfig.isEditDiagram||this.appConfig.isEditMailMerge||this.appConfig.isEditOle||i.lockToolbar(v,v!=t,{array:[i.btnClearStyle.menu.items[1],i.btnClearStyle.menu.items[2],i.btnClearStyle.menu.items[3],i.btnClearStyle.menu.items[4]],merge:!0,clear:[C.selImage,C.selChart,C.selChartText,C.selShape,C.selShapeText,C.selSlicer,C.coAuth]}),i.lockToolbar(Common.enumLock.coAuthText,h),i.lockToolbar(Common.enumLock.coAuthText,h&&(t==Asc.c_oAscSelectionType.RangeChart||t==Asc.c_oAscSelectionType.RangeChartText),{array:[i.btnInsertChart,i.btnInsertChartRecommend]}),i.lockToolbar(Common.enumLock.inSmartartInternal,d)}return this._state.controlsdisabled.filters=r||c||e,(r||c||e)&&(i.listStyles&&(i.listStyles.suspendEvents(),i.listStyles.menuPicker.selectRecord(null),i.listStyles.resumeEvents()),this._state.prstyle=void 0),this._state.selection_type=t,this._state.coauthdisable=e,r},_getApiTextSize:function(){var t=this.api.asc_getCellInfo();return t?t.asc_getXfs().asc_getFontSize():12},_setTableFormat:function(t){var e=this;if(!0!==e.api.isRangeSelection)if(e.api.asc_getCellInfo().asc_getFormatTableInfo())if(e._state.filter=void 0,e._state.tablename)e.api.asc_changeAutoFilter(e._state.tablename,Asc.c_oAscChangeFilterOptions.style,t);else{var i=e.api.asc_getCellInfo().asc_getSelectionType();i==Asc.c_oAscSelectionType.RangeMax||i==Asc.c_oAscSelectionType.RangeRow||i==Asc.c_oAscSelectionType.RangeCol?Common.UI.warning({title:e.textLongOperation,msg:e.warnLongOperation,buttons:["ok","cancel"],callback:function(i){"ok"==i&&setTimeout((function(){e.toolbar.fireEvent("inserttable",e.toolbar),e.api.asc_addAutoFilter(t)}),1),Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}):(e.toolbar.fireEvent("inserttable",e.toolbar),e.api.asc_addAutoFilter(t))}else{var o=new SSE.Views.TableOptionsDialog({handler:function(i,o){if("ok"==o)if(e._state.filter=void 0,e.api.asc_setSelectionDialogMode(Asc.c_oAscSelectionDialogType.None),e._state.tablename)e.api.asc_changeAutoFilter(e._state.tablename,Asc.c_oAscChangeFilterOptions.style,t);else{var n=i.getSettings();n.selectionType==Asc.c_oAscSelectionType.RangeMax||n.selectionType==Asc.c_oAscSelectionType.RangeRow||n.selectionType==Asc.c_oAscSelectionType.RangeCol?Common.UI.warning({title:e.textLongOperation,msg:e.warnLongOperation,buttons:["ok","cancel"],callback:function(i){"ok"==i&&setTimeout((function(){e.toolbar.fireEvent("inserttable",e.toolbar),e.api.asc_addAutoFilter(t,n.range)}),1),Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}):(e.toolbar.fireEvent("inserttable",e.toolbar),e.api.asc_addAutoFilter(t,n.range))}Common.NotificationCenter.trigger("edit:complete",e.toolbar)}});o.show(),o.setSettings({api:e.api,selectionType:e.api.asc_getCellInfo().asc_getSelectionType()})}},onHideMenus:function(t){Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0})},onSetupCopyStyleButton:function(){this.modeAlwaysSetStyle=!1;var t=this;Common.NotificationCenter.on({"edit:complete":function(e){t.api&&t.modeAlwaysSetStyle&&"tab"!==e&&(t.api.asc_formatPainter(AscCommon.c_oAscFormatPainterState.kOff),t.toolbar.btnCopyStyle.toggle(!1,!0),t.modeAlwaysSetStyle=!1)}}),$(t.toolbar.btnCopyStyle.cmpEl).dblclick((function(){t.api&&(t.modeAlwaysSetStyle=!0,t.toolbar.btnCopyStyle.toggle(!0,!0),t.api.asc_formatPainter(AscCommon.c_oAscFormatPainterState.kMultiple))}))},onCellsRange:function(t){this.api.isRangeSelection=t!=Asc.c_oAscSelectionDialogType.None,this.onEditCell(this.api.isRangeSelection||this.api.isCellEdited?Asc.c_oAscCellEditorState.editStart:Asc.c_oAscCellEditorState.editEnd,!0);var e=this.toolbar;e.lockToolbar(Common.enumLock.selRangeEdit,this.api.isRangeSelection),this.setDisabledComponents([e.btnUndo],this.api.isRangeSelection||!this.api.asc_getCanUndo()),this.setDisabledComponents([e.btnRedo],this.api.isRangeSelection||!this.api.asc_getCanRedo()),this.onApiSelectionChanged(this.api.asc_getCellInfo())},onLockDefNameManager:function(t){this._state.namedrange_locked=t==Asc.c_oAscDefinedNameReason.LockDefNameManager,this.toolbar.lockToolbar(Common.enumLock.printAreaLock,this.api.asc_isPrintAreaLocked(this.api.asc_getActiveWorksheetIndex()),{array:[this.toolbar.btnPrintArea]}),this.toolbar.lockToolbar(Common.enumLock.namedRangeLock,this._state.namedrange_locked,{array:[this.toolbar.btnPrintArea.menu.items[0],this.toolbar.btnPrintArea.menu.items[2]]})},onLockCFManager:function(t){this._state.cf_locked[t]=!0},onUnLockCFManager:function(t){this._state.cf_locked[t]=!1},activateControls:function(){this.toolbar.lockToolbar(Common.enumLock.disableOnStart,!1,{array:[this.toolbar.btnPrint]}),this._state.activated=!0},DisableToolbar:function(t,e){void 0!==e&&(this.editMode=!e),t=t||!this.editMode;var i=$(".toolbar-mask");if(!(t&&i.length>0||!t&&0==i.length)){var o=this.toolbar;o.hideMoreBtns(),o.$el.find(".toolbar").toggleClass("masked",t),this.toolbar.lockToolbar(Common.enumLock.menuFileOpen,t);var n=Common.Utils.isMac?"command+alt+a":"alt+h";t?(i=$("<div class='toolbar-mask'>").appendTo(o.$el.find(".toolbar")),Common.util.Shortcuts.suspendEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l, command+k, ctrl+k, command+1, ctrl+1, "+n)):(i.remove(),Common.util.Shortcuts.resumeEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l, command+k, ctrl+k, command+1, ctrl+1, "+n))}},applyFormulaSettings:function(){if(this.toolbar.btnInsertFormula&&this.toolbar.btnInsertFormula.rendered)for(var t=this.toolbar.btnInsertFormula.menu.getItems(!0),e=0;e<Math.min(4,t.length);e++)t[e].setCaption(this.api.asc_getFormulaLocaleName(t[e].value))},onAppShowed:function(t){var e=this;e.appConfig=t;var i=t.isEdit,o=!i;if(t.isEditDiagram||t.isEditMailMerge||t.isEditOle||(Common.localStorage.itemExists(i?"sse-compact-toolbar":"sse-view-compact-toolbar")?o=Common.localStorage.getBool(i?"sse-compact-toolbar":"sse-view-compact-toolbar"):t.customization&&(o=i?!!t.customization.compactToolbar:!1!==t.customization.compactToolbar),Common.Utils.InternalSettings.set("toolbar-active-tab",!i&&!o)),e.toolbar.render(_.extend({isCompactView:!i||o},t)),!t.isEditDiagram&&!t.isEditMailMerge&&!t.isEditOle){var n={action:"review",caption:e.toolbar.textTabCollaboration,layoutname:"toolbar-collaboration",dataHintTitle:"U"};(m=e.getApplication().getController("Common.Controllers.ReviewChanges").createToolbarPanel())&&(e.toolbar.addTab(n,m,6),e.toolbar.setVisible("review",(t.isEdit||t.canViewReview||t.canCoAuthoring&&t.canComments)&&Common.UI.LayoutManager.isElementVisible("toolbar-collaboration")))}if(t.isEdit&&(e.toolbar.setMode(t),e.toolbar.btnSave&&e.toolbar.btnSave.on("disabled",_.bind(e.onBtnChangeState,e,"save:disabled")),e.toolbar.btnUndo&&e.toolbar.btnUndo.on("disabled",_.bind(e.onBtnChangeState,e,"undo:disabled")),e.toolbar.btnRedo&&e.toolbar.btnRedo.on("disabled",_.bind(e.onBtnChangeState,e,"redo:disabled")),e.toolbar.btnPrint&&e.toolbar.btnPrint.on("disabled",_.bind(e.onBtnChangeState,e,"print:disabled")),e.toolbar.setApi(e.api),!t.isEditDiagram&&!t.isEditMailMerge&&!t.isEditOle)){var s=e.getApplication().getController("Common.Controllers.Draw");s.setApi(e.api).setMode(t),(m=s.createToolbarPanel())&&(n={action:"draw",caption:e.toolbar.textTabDraw,extcls:"canedit",layoutname:"toolbar-draw",dataHintTitle:"C"},e.toolbar.addTab(n,m,2),e.toolbar.setVisible("draw",Common.UI.LayoutManager.isElementVisible("toolbar-draw")),Array.prototype.push.apply(e.toolbar.lockControls,s.getView().getButtons()));var a=e.getApplication().getController("DataTab");a.setApi(e.api).setConfig({toolbar:e}),a=a.getView("DataTab"),Array.prototype.push.apply(e.toolbar.lockControls,a.getButtons()),e.toolbar.btnsSortDown=a.getButtons("sort-down"),e.toolbar.btnsSortUp=a.getButtons("sort-up"),e.toolbar.btnsSetAutofilter=a.getButtons("set-filter"),e.toolbar.btnsClearAutofilter=a.getButtons("clear-filter"),e.toolbar.btnCustomSort=a.getButtons("sort-custom"),e.toolbar.btnRemoveDuplicates=a.getButtons("rem-duplicates"),e.toolbar.btnDataValidation=a.getButtons("data-validation");var r=e.getApplication().getController("FormulaDialog");r.setConfig({toolbar:e}),r=r.getView("FormulaTab"),e.toolbar.btnsFormula=r.getButtons("formula");var l=r.getButtons("range");if(e.toolbar.itemsNamedRange=l&&l.menu&&l.menu.items?[l.menu.items[0],l.menu.items[1]]:[],Array.prototype.push.apply(e.toolbar.lockControls,r.getButtons()),t.canFeaturePivot){n={action:"pivot",caption:e.textPivot,dataHintTitle:"B"};var c=e.getApplication().getController("PivotTable");c.setApi(e.api).setConfig({toolbar:e}),(m=c.createToolbarPanel())&&(e.toolbar.addTab(n,m,Common.UI.LayoutManager.lastTabIdx+1),e._state.inpivot&&e.toolbar.setVisible("pivot",!0),Array.prototype.push.apply(e.toolbar.lockControls,c.getView("PivotTable").getButtons()))}if(!t.compactHeader){e.toolbar.btnPrint.$el.parents(".group").hide().next().hide();var h=e.toolbar.btnUndo.$el.hide().next().hide().parent();e.toolbar.btnPaste.$el.detach().appendTo(h),e.toolbar.btnPaste.$el.find("button").attr("data-hint-direction","bottom"),e.toolbar.btnCopy.$el.removeClass("split"),e.toolbar.processPanelVisible(null,!0)}if(t.canProtect){n={action:"protect",caption:e.toolbar.textTabProtect,layoutname:"toolbar-protect",dataHintTitle:"T"};if(m=e.getApplication().getController("Common.Controllers.Protection").createToolbarPanel()){(t.isSignatureSupport||t.isPasswordSupport)&&m.append($('<div class="separator long"></div>'));var d=e.getApplication().getController("WBProtection");m.append(d.createToolbarPanel()),e.toolbar.addTab(n,m,7),e.toolbar.setVisible("protect",Common.UI.LayoutManager.isElementVisible("toolbar-protect")),Array.prototype.push.apply(e.toolbar.lockControls,d.getView("WBProtection").getButtons())}}}if(!t.isEditDiagram&&!t.isEditMailMerge&&!t.isEditOle){n={caption:e.toolbar.textTabView,action:"view",extcls:t.isEdit?"canedit":"",layoutname:"toolbar-view",dataHintTitle:"W"};var m,p=e.getApplication().getController("ViewTab");if(p.setApi(e.api).setConfig({toolbar:e,mode:t}),m=p.createToolbarPanel()){var u=Common.UI.LayoutManager.isElementVisible("toolbar-view");e.toolbar.addTab(n,m,8),e.toolbar.setVisible("view",u),!i&&!o&&u&&Common.Utils.InternalSettings.set("toolbar-active-tab","view")}t.isEdit&&Array.prototype.push.apply(e.toolbar.lockControls,p.getView("ViewTab").getButtons())}},onAppReady:function(t){var e=this;if(e.appOptions=t,this.btnsComment=[],t.canCoAuthoring&&t.canComments){var i=Common.enumLock;if(this.btnsComment=Common.Utils.injectButtons(this.toolbar.$el.find(".slot-comment"),"tlbtn-addcomment-","toolbar__icon btn-big-add-comment",this.toolbar.capBtnComment,[i.lostConnect,i.commentLock,i.editCell,i.Objects],void 0,void 0,void 0,"1","bottom","small"),this.btnsComment.length){var o=SSE.getController("Common.Controllers.Comments").getView();this.btnsComment.forEach((function(t){t.updateHint(o.textHintAddComment),t.on("click",(function(t,i){Common.NotificationCenter.trigger("app:comment:add","toolbar",e.api.asc_getCellInfo().asc_getSelectionType()!=Asc.c_oAscSelectionType.RangeCells)})),t.cmpEl.closest("#review-changes-panel").length>0&&t.setCaption(e.toolbar.capBtnAddComment)}),this),o.buttonAddNew&&(o.buttonAddNew.options.lock=[i.lostConnect,i.commentLock,i.editCell,i.Objects],this.btnsComment.add(o.buttonAddNew)),Array.prototype.push.apply(e.toolbar.lockControls,this.btnsComment),Common.UI.LayoutManager.addControls(this.btnsComment)}}Common.UI.TooltipManager.showTip("modernTheme")},onFileMenu:function(t){"show"==t?this.toolbar.isTabActive("file")||this.toolbar.setTab("file"):this.toolbar.isTabActive("file")&&this.toolbar.setTab()},onInsertPivot:function(){this._state.showPivotTab=!0},onPageSizeClick:function(t,e,i){this.api&&i&&(this._state.pgsize=[0,0],this.api.asc_changeDocSize(e.value[0],e.value[1],this.api.asc_getActiveWorksheetIndex()),Common.component.Analytics.trackEvent("ToolBar","Page Size")),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onPageMarginsSelect:function(t,e){if(this.api){if(this._state.pgmargins=void 0,"advanced"!==e.value){(o=new Asc.asc_CPageMargins).asc_setTop(e.value[0]),o.asc_setBottom(e.value[2]),o.asc_setLeft(e.value[1]),o.asc_setRight(e.value[3]),this.api.asc_changePageMargins(o,void 0,void 0,void 0,void 0,this.api.asc_getActiveWorksheetIndex())}else{var i,o,n=this;(i=new SSE.Views.PageMarginsDialog({handler:function(t,e){if("ok"==e){var i=(o=t.getSettings()).margins;Common.localStorage.setItem("sse-pgmargins-top",i.asc_getTop()),Common.localStorage.setItem("sse-pgmargins-left",i.asc_getLeft()),Common.localStorage.setItem("sse-pgmargins-bottom",i.asc_getBottom()),Common.localStorage.setItem("sse-pgmargins-right",i.asc_getRight()),Common.NotificationCenter.trigger("margins:update",i),n.toolbar.btnPageMargins.menu.items[0].setChecked(!0),n.api.asc_changePageMargins(i,o.horizontal,o.vertical,void 0,void 0,n.api.asc_getActiveWorksheetIndex()),Common.NotificationCenter.trigger("edit:complete",n.toolbar)}}})).show(),i.setSettings(n.api.asc_getPageOptions(n.api.asc_getActiveWorksheetIndex()))}Common.component.Analytics.trackEvent("ToolBar","Page Margins")}Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onPageOrientSelect:function(t,e){this._state.pgorient=void 0,this.api&&e.checked&&this.api.asc_changePageOrient(e.value==Asc.c_oAscPageOrientation.PagePortrait,this.api.asc_getActiveWorksheetIndex()),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Page Orientation")},onImgGroupSelect:function(t,e){this.api&&this.api["grouping"==e.value?"asc_groupGraphicsObjects":"asc_unGroupGraphicsObjects"](),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Objects Group")},onImgArrangeSelect:function(t,e){this.api&&("forward"==t?this.api.asc_setSelectedDrawingObjectLayer(Asc.c_oAscDrawingLayerType.BringForward):"backward"==t?this.api.asc_setSelectedDrawingObjectLayer(Asc.c_oAscDrawingLayerType.SendBackward):this.api.asc_setSelectedDrawingObjectLayer(e.value)),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Objects Arrange")},onImgAlignSelect:function(t,e){this.api&&(e.value>-1&&e.value<6?(this.api.asc_setSelectedDrawingObjectAlign(e.value),Common.component.Analytics.trackEvent("ToolBar","Objects Align")):6==e.value?(this.api.asc_DistributeSelectedDrawingObjectHor(),Common.component.Analytics.trackEvent("ToolBar","Distribute")):7==e.value&&(this.api.asc_DistributeSelectedDrawingObjectVer(),Common.component.Analytics.trackEvent("ToolBar","Distribute"))),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onBeforeShapesMerge:function(){this.toolbar.btnShapesMerge.menu.getItems(!0).forEach((function(t){t.setDisabled(!this.api.asc_canMergeSelectedShapes(t.value))}),this)},onClickMenuShapesMerge:function(t,e){e&&e.value&&(this.api.asc_mergeSelectedShapes(e.value),Common.component.Analytics.trackEvent("ToolBar","Shapes Merge")),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onPrintAreaClick:function(t,e){this.api&&(this.api.asc_ChangePrintArea(e.value),Common.component.Analytics.trackEvent("ToolBar","Print Area")),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onPrintAreaMenuOpen:function(){this.api&&this.toolbar.btnPrintArea.menu.items[2].setVisible(this.api.asc_CanAddPrintArea())},onPageBreakClick:function(t,e){this.api&&("ins"===e.value?this.api.asc_InsertPageBreak():"del"===e.value?this.api.asc_RemovePageBreak():"reset"===e.value&&this.api.asc_ResetAllPageBreaks(),Common.component.Analytics.trackEvent("ToolBar","Page Break")),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onPageBreakMenuOpen:function(){if(this.api){var t=this.api.asc_GetPageBreaksDisableType(this.api.asc_getActiveWorksheetIndex());this.toolbar.btnPageBreak.menu.items[0].setDisabled(t===Asc.c_oAscPageBreaksDisableType.insertRemove),this.toolbar.btnPageBreak.menu.items[1].setDisabled(t===Asc.c_oAscPageBreaksDisableType.insertRemove),this.toolbar.btnPageBreak.menu.items[2].setDisabled(t===Asc.c_oAscPageBreaksDisableType.reset)}},onEditHeaderClick:function(t,e){var i=this;if(_.isUndefined(i.fontStore)){i.fontStore=new Common.Collections.Fonts;var o=i.toolbar.cmbFontName.store.toJSON(),n=[];_.each(o,(function(t,e){t.cloneid||n.push(_.clone(t))})),i.fontStore.add(n)}new SSE.Views.HeaderFooterDialog({api:i.api,fontStore:i.fontStore,pageSetup:t,handler:function(t,e){"ok"===e&&i.getApplication().getController("Print").updatePreview(),Common.NotificationCenter.trigger("edit:complete")}}).show(),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onClickChangeScaleInMenu:function(t,e){var i;this.api&&((i="up"===t?e%5>.001?5*Math.ceil(e/5):e+5:e%5>.001?5*Math.floor(e/5):e-5)>400?i=400:i<10&&(i=10),this.onChangeScaleSettings(0,0,i))},onScaleClick:function(t,e,i,o,n){var s=this;if(s.api)if("width"===t&&"more"!==i.value)void 0!==s._state.scaleHeight&&null!==s._state.scaleHeight||(s._state.scaleHeight=0),s.api.asc_SetPrintScale(i.value,s._state.scaleHeight,100),s.onChangeScaleSettings(i.value,s._state.scaleHeight,100);else if("height"===t&&"more"!==i.value)void 0!==s._state.scaleWidth&&null!==s._state.scaleWidth||(s._state.scaleWidth=0),s.api.asc_SetPrintScale(s._state.scaleWidth,i.value,100),s.onChangeScaleSettings(s._state.scaleWidth,i.value,100);else if("scale"===t&&void 0!==n)s.api.asc_SetPrintScale(0,0,n);else if("custom"===i.value||"more"===i.value){new SSE.Views.ScaleDialog({api:s.api,props:null,handler:function(t,e){"ok"==t?s.api&&e&&(s.api.asc_SetPrintScale(e.width,e.height,e.scale),s.onChangeScaleSettings(e.width,e.height,e.scale)):s.onChangeScaleSettings(s._state.scaleWidth,s._state.scaleHeight,s._state.scale),Common.NotificationCenter.trigger("edit:complete")}}).show()}Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onPrintTitlesClick:function(t){if(this.api){var e,i=this;new SSE.Views.PrintTitlesDialog({api:i.api,sheet:i.api.asc_getActiveWorksheetIndex(),handler:function(t,o){"ok"==o&&(e=t.getSettings(),i.api.asc_changePrintTitles(e.width,e.height,i.api.asc_getActiveWorksheetIndex()),Common.NotificationCenter.trigger("edit:complete",i.toolbar))}}).show(),Common.component.Analytics.trackEvent("ToolBar","Print Titles")}Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onChangeProtectSheet:function(t){if(!t){var e=this.getApplication().getController("WBProtection");t=e?e.getWSProps():null}t&&(this._state.wsProps=t.wsProps,this._state.wsLock=t.wsLock,this.toolbar.lockToolbar(Common.enumLock.wsLock,this._state.wsLock),this.toolbar.lockToolbar(Common.enumLock.InsertHyperlinks,this._state.wsProps.InsertHyperlinks,{array:[this.toolbar.btnInsertHyperlink]}),this.appConfig&&this.appConfig.isEdit?this.onApiSelectionChanged(this.api.asc_getCellInfo()):this.onApiSelectionChangedRestricted(this.api.asc_getCellInfo()))},onPrintGridlinesChange:function(t,e){this.api&&this.api.asc_SetPrintGridlines("checked"===e),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onPrintHeadingsChange:function(t,e){this.api&&this.api.asc_SetPrintHeadings("checked"===e),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onRtlSheetClick:function(t){this.api&&this.api.asc_setRightToLeft(t.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onVisibleAreaClose:function(t){this.api&&this.api.asc_toggleChangeVisibleAreaOleEditor(!1),this.toolbar.lockToolbar(Common.enumLock.editVisibleArea,!1),this.toolbar.btnVisibleArea.setVisible(!0),this.toolbar.btnVisibleAreaClose.setVisible(!1),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onVisibleAreaMenu:function(t,e,i){this.api&&("edit"===e.value?(this.api.asc_toggleChangeVisibleAreaOleEditor(!0),this.toolbar.btnVisibleArea.setVisible(!1),this.toolbar.btnVisibleAreaClose.setVisible(!0),this.toolbar.lockToolbar(Common.enumLock.editVisibleArea,!0)):(this.api.asc_toggleShowVisibleAreaOleEditor("show"===e.value),this.toolbar.btnVisibleArea.menu.items[0].setVisible("show"!==e.value),this.toolbar.btnVisibleArea.menu.items[1].setVisible("show"===e.value))),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onOleEditClose:function(){this.api&&(this.api.asc_toggleChangeVisibleAreaOleEditor(!1),this.toolbar.btnVisibleArea.setVisible(!0),this.toolbar.btnVisibleAreaClose.setVisible(!1),this.toolbar.lockToolbar(Common.enumLock.editVisibleArea,!1),this.api.asc_toggleShowVisibleAreaOleEditor(!1),this.toolbar.btnVisibleArea.menu.items[0].setVisible(!0),this.toolbar.btnVisibleArea.menu.items[1].setVisible(!1))},onTextFormattingMenu:function(t,e){if(this.api)switch(e.value){case"bold":this._state.bold=void 0,this.api.asc_setCellBold(e.checked);break;case"italic":this._state.italic=void 0,this.api.asc_setCellItalic(e.checked);break;case"underline":this._state.underline=void 0,this.api.asc_setCellUnderline(e.checked);break;case"strikeout":this._state.strikeout=void 0,this.api.asc_setCellStrikeout(e.checked);break;case"subscript":this._state.subscript=void 0,this.api.asc_setCellSubscript(e.checked);break;case"superscript":this._state.superscript=void 0,this.api.asc_setCellSuperscript(e.checked)}Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Text Formatting")},onHorizontalAlignMenu:function(t,e){this._state.pralign=void 0,this.api&&(this.api.asc_setCellAlign(e.checked?e.value:null),this.toolbar.btnWrap.allowDepress=!(e.value==AscCommon.align_Justify)),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Horizontal align")},onVerticalAlignMenu:function(t,e){this._state.valign=void 0,this.api&&this.api.asc_setCellVertAlign(e.checked?e.value:Asc.c_oAscVAlign.Bottom),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Vertical align")},mouseenterSmartArt:function(t){void 0===this.smartArtGenerating?this.generateSmartArt(t):this.delayedSmartArt=t},mouseleaveSmartArt:function(t){this.delayedSmartArt===t&&(this.delayedSmartArt=void 0)},generateSmartArt:function(t){this.api.asc_generateSmartArtPreviews(t)},onApiBeginSmartArtPreview:function(t){this.smartArtGenerating=t,this.smartArtGroups=this.toolbar.btnInsertSmartArt.menu.getItems(!0),_.findWhere(this.smartArtGroups,{value:t}).menuPicker.loaded=!0,this.smartArtData=Common.define.smartArt.getSmartArtData()},onApiAddSmartArtPreview:function(t){t.forEach(_.bind((function(t){var e=t.asc_getImage(),i=t.asc_getSectionId(),o=_.findWhere(this.smartArtData,{sectionId:i}),n=_.findWhere(o.items,{type:e.asc_getName()}),s=_.findWhere(this.smartArtGroups,{value:i}),a=s.menuPicker.store.findWhere({isLoading:!0});a&&(a.set("isLoading",!1,{silent:!0}),a.set("value",n.type,{silent:!0}),a.set("imageUrl",e.asc_getImage(),{silent:!0}),a.set("tip",n.tip)),this.currentSmartArtMenu=s}),this))},onApiEndSmartArtPreview:function(){if(this.smartArtGenerating=void 0,this.currentSmartArtMenu&&this.currentSmartArtMenu.menu.alignPosition(),void 0!==this.delayedSmartArt){var t=this.delayedSmartArt;this.delayedSmartArt=void 0,this.generateSmartArt(t)}},onInsertSmartArt:function(t){this.api&&this.api.asc_createSmartArt(t)},eyedropperStart:function(){this.toolbar.btnCopyStyle.pressed&&(this.toolbar.btnCopyStyle.toggle(!1,!0),this.api.asc_formatPainter(AscCommon.c_oAscFormatPainterState.kOff),this.modeAlwaysSetStyle=!1)},onEyedropperStart:function(t){this.toolbar._isEyedropperStart=!0,this.api.asc_startEyedropper(_.bind(t.eyedropperEnd,t))},onEyedropperEnd:function(){this.toolbar._isEyedropperStart=!1},onChartRecommendedClick:function(){var t=this,e=t.api.asc_getRecommendedChartData();if(e){var i=t.api.asc_getCellInfo().asc_getSelectionType();new SSE.Views.ChartWizardDialog({api:t.api,props:{recommended:e},isEdit:i==Asc.c_oAscSelectionType.RangeChart||i==Asc.c_oAscSelectionType.RangeChartText,handler:function(e,i){"ok"==e&&t.api&&t.api.asc_addChartSpace(i),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}}).show()}else Common.UI.warning({msg:t.warnNoRecommended,maxwidth:600,callback:function(e){Common.NotificationCenter.trigger("edit:complete",t.toolbar)}})},onFillNumMenu:function(t,e,i){if(this.api){var o=this;e.value===Asc.c_oAscFillType.series?new SSE.Views.FillSeriesDialog({handler:function(t,e){"ok"==t&&e&&o.api.asc_FillCells(Asc.c_oAscFillType.series,e),Common.NotificationCenter.trigger("edit:complete",o.toolbar)},props:o.api.asc_GetSeriesSettings()}).show():o.api.asc_FillCells(e.value)}},onShowBeforeFillNumMenu:function(){if(this.api)for(var t=this.toolbar.btnFillNumbers.menu.getItems(!0),e=this.api.asc_GetSeriesSettings().asc_getToolbarMenuAllowedProps(),i=0;i<t.length;i++)t[i].setDisabled(!e[t[i].value])},onPluginToolbarMenu:function(t){var e=this.api;this.toolbar&&Array.prototype.push.apply(this.toolbar.lockControls,Common.UI.LayoutManager.addCustomControls(this.toolbar,t,(function(t,i,o){e&&e.onPluginToolbarMenuItemClick(t,i,o)})))},onPluginToolbarCustomMenuItems:function(t,e){if(this._isDocReady){var i=this.api;this.toolbar&&Common.UI.LayoutManager.addCustomMenuItems(t,e,(function(t,e){i&&i.onPluginContextMenuItemClick(t,e)}))}else this._state.customPluginData=(this._state.customPluginData||[]).concat([{action:t,data:e}])},onPluginUpdateToolbarMenu:function(t){var e=this.api;this.toolbar&&Array.prototype.push.apply(this.toolbar.lockControls,Common.UI.LayoutManager.addCustomControls(this.toolbar,t,(function(t,i,o){e&&e.onPluginToolbarMenuItemClick(t,i,o)}),!0))},onDocumentReady:function(){this._isDocReady=!0;var t=this;this._state.customPluginData&&this._state.customPluginData.forEach((function(e){t.onPluginToolbarCustomMenuItems(e.action,e.data)})),this._state.customPluginData=null},onActiveTab:function(t){"view"===t?(Common.UI.TooltipManager.closeTip("modernTheme"),Common.UI.TooltipManager.showTip("asyncFunction")):Common.UI.TooltipManager.closeTip("asyncFunction")},onClickTab:function(t){this._state.showPivotTab="pivot"===t},onTabCollapse:function(t){Common.UI.TooltipManager.closeTip("asyncFunction")}},SSE.Controllers.Toolbar||{}))})),define("text!spreadsheeteditor/main/app/template/StatusBar.template",[],(function(){return'\r\n<div class="statusbar">\r\n    <div id="status-tabs-scroll" class="status-group cnt-flex-center" dir="ltr">\r\n        <button id="status-btn-tabback" type="button" class="btn small btn-toolbar" data-hint="0" data-hint-direction="top" data-hint-offset="small" data-hint-title="G"><i class="icon toolbar__icon btn-previtem">&nbsp;</i></button>\r\n        <button id="status-btn-tabnext" type="button" class="btn small btn-toolbar" data-hint="0" data-hint-direction="top" data-hint-offset="small" data-hint-title="J"><i class="icon toolbar__icon btn-nextitem">&nbsp;</i></button>\r\n    </div>\r\n    <div id="status-addtabs-box" class="status-group cnt-flex-center">\r\n        <button id="status-btn-addtab" type="button" class="btn small btn-toolbar" data-hint="0" data-hint-direction="top" data-hint-offset="small" data-hint-title="X"><i class="icon toolbar__icon btn-zoomup">&nbsp;</i></button>\r\n        <div class="cnt-tabslist">\r\n            <button id="status-btn-tabslist" type="button" class="btn small btn-toolbar dropdown-toggle" data-toggle="dropdown" data-hint="0" data-hint-direction="top" data-hint-offset="small" data-hint-title="N"><i class="icon toolbar__icon btn-sheet-list">&nbsp;</i></button>\r\n        </div>\r\n    </div>\r\n    <div id="status-zoom-box" class="status-group cnt-flex-center">\r\n        <div class="separator short"></div>\r\n        <button id="status-btn-zoomdown" type="button" class="btn small btn-toolbar"><i class="icon toolbar__icon btn-zoomdown">&nbsp;</i></button>\r\n        <div class="cnt-zoom">\r\n            <div class="dropdown-toggle" data-toggle="dropdown" data-hint="0" data-hint-direction="top" role="button" aria-haspopup="menu" aria-expanded="false">\r\n                <label id="status-label-zoom" class="status-label">Zoom 100%</label>\r\n            </div>\r\n        </div>\r\n        <button id="status-btn-zoomup" type="button" class="btn small btn-toolbar"><i class="icon toolbar__icon btn-zoomup">&nbsp;</i></button>\r\n    </div>\r\n    <div id="status-math-box" class="status-group cnt-flex-center">\r\n        <div class="separator short"></div>\r\n        <label id="status-math-average">AVERAGE: 10</label>\r\n        <label id="status-math-count">COUNT: 3</label>\r\n        <label id="status-math-min">MIN: 1</label>\r\n        <label id="status-math-max">MAX: 5</label>\r\n        <label id="status-math-sum">SUM: 5</label>\r\n    </div>\r\n    <div id="status-filtered-box" class="status-group cnt-flex-center">\r\n        <div class="separator short"></div>\r\n        <label id="status-filtered-records"></label>\r\n    </div>\r\n    <div id="status-sheets-bar-box">\r\n        <div id="status-sheets-bar" class="status-group">\r\n        </div>\r\n    </div>\r\n    <div id="status-number-of-sheet" class="cnt-flex-center">\r\n        <label id="label-sheets" class="status-label"></label>\r\n    </div>\r\n    <div id="status-action" class="cnt-flex-center">\r\n        <div class="separator short"></div>\r\n        <label id="label-action" class="status-label"></label>\r\n    </div>\r\n</div>\r\n'}));var tip=function(t){var e=t.fn.tooltip;e.prototype=t.fn.tooltip.Constructor.prototype,t.extend(t.fn.tooltip.Constructor.DEFAULTS,{container:"body",delay:{show:500},arrow:!1});var i=function(t,e){this.init("tooltip",t,e)};i.prototype=t.extend({},t.fn.tooltip.Constructor.prototype,{constructor:i,init:function(){e.prototype.init.apply(this,arguments),"cursor"==this.options.placement&&/hover/.exec(this.options.trigger)&&this.$element.on("mousemove.tooltip",this.options.selector,t.proxy(this.mousemove,this)),this.options.zIndex&&this.tip().css("z-index",this.options.zIndex);var i=this;Common.NotificationCenter.on({"layout:changed":function(t){i.options.keepvisible||i.options.hideonclick||!i.tip().is(":visible")||i.hide()}}),this.isDesktopApp=Common.Controllers.Desktop.isActive()},mousemove:function(t){var e=t.clientX*Common.Utils.zoom(),i=t.clientY*Common.Utils.zoom();this.targetXY=[e,this.isDesktopApp?Math.max(i,14):i]},leave:function(t){e.prototype.leave.apply(this,arguments),this.dontShow=void 0},show:function(i){if(this.hasContent()&&this.enabled&&!this.dontShow){if(!this.$element.is(":visible")&&this.$element.closest("[role=menu]").length>0)return;var o=this.tip();!1===this.options.arrow&&o.addClass("arrow-free"),this.options.cls&&o.addClass(this.options.cls);var n="function"!=typeof this.options.placement?/^([a-zA-Z]+)-?([a-zA-Z]*)$/.exec(this.options.placement):null;if(i||!n||n[2].length){var s=t.Event("show.bs.tooltip");if(this.$element.trigger(s),s.isDefaultPrevented())return;if(this.setContent(),this.options.animation&&o.addClass("fade"),o.detach().css({top:0,left:0,display:"block"}),this.options.container?o.appendTo(this.options.container):o.insertAfter(this.$element),"function"==typeof this.options.placement)this.options.placement.call(this,o[0],this.$element[0]);else if("object"==_typeof(i)){var a={top:i[1]+15,left:Common.UI.isRTL()?i[0]-o.width()-9:i[0]+18},r=Common.Utils.innerWidth(),l=Common.Utils.innerHeight();a.left<0&&(a.left=i[0]+18),a.left+o.width()>r&&(a.left=r-o.width()-30),a.top+o.height()>l&&(a.top=l-o.height()-30),Common.Utils.setOffset(o,a).addClass("in")}else{var c=this.getPosition(),h=o[0].offsetWidth,d=o[0].offsetHeight;switch(n[1]){case"bottom":a={top:c.top+c.height+10};break;case"top":a={top:c.top-d-10}}switch(n[2]){case"left":a.left=c.left,this.$element.outerWidth()<=18&&(a.left-=4);break;case"right":a.left=c.left+c.width-h,this.$element.outerWidth()<=18&&(a.left+=4)}this.applyPlacement(a,n[1]),this.moveArrow(),o.addClass(n[1]).addClass(n[0])}this.$element.trigger("shown.bs.tooltip")}else e.prototype.show.apply(this,arguments);var m=this;clearTimeout(m.timeout),m.timeout=setTimeout((function(){"in"==m.hoverState&&m.hide(),m.dontShow=!1}),5e3)}},moveArrow:function(){var t=this.tip().find(".tooltip-arrow, .arrow");switch(this.options.placement){case"top-left":case"bottom-left":t.css("left",10);break;case"top-right":case"bottom-right":t.css("right",10)}},enter:function(e){if("mouseenter"===e.type){var i=t(e.target);if(!(i.is("[role=menu]")||i.parentsUntil(e.currentTarget,"[role=menu]").length&&e.target!==e.currentTarget||this.tip().is(":visible"))){var o=e instanceof this.constructor?e:t(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs.tooltip");clearTimeout(o.timeout),o.hoverState="in",void 0!==this._updateTitle&&(this.tip().find(".tooltip-inner")[this.options.html?"html":"text"](this.options.title),this._updateTitle=void 0),o.options.delay&&o.options.delay.show?o.timeout=setTimeout((function(){"in"==o.hoverState&&o.show("cursor"==o.options.placement?o.targetXY:void 0)}),o.options.delay.show):o.show()}}},replaceArrow:function(t,i,o){!1===this.options.arrow?this.arrow().hide():e.prototype.replaceArrow.apply(this,arguments)},getCalculatedOffset:function(t,i,o,n){var s=e.prototype.getCalculatedOffset.apply(this,arguments);if(this.options.offset>0||this.options.offset<0)switch(/(bottom|top)/.exec(t)[1]){case"bottom":s.top+=this.options.offset;break;case"top":s.top-=this.options.offset}return s},updateTitle:function(t){this.options.title=t,this._updateTitle=t}});var o=t.fn.tooltip;t.fn.tooltip=function(e){return this.each((function(){var o=t(this),n=o.data("bs.tooltip"),s="object"===_typeof(e)&&e;n||o.data("bs.tooltip",n=new i(this,s)),"string"==typeof e&&n[e]()}))},t.fn.tooltip.Constructor=i,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=o,this}};if(tip(window.jQuery),define("tip",(function(){})),void 0===Common)var Common={};if(define("common/main/lib/component/Tab",["common/main/lib/component/BaseView"],(function(t){"use strict";var e=function(t){return this.active=!1,this.label="Tab",this.cls="",this.iconCls="",this.iconVisible=!1,this.iconTitle="",this.index=-1,this.template=_.template(['<li class="list-item <% if(active){ %>active selected<% } %> <% if(cls.length){%><%= cls %><%}%><% if(iconVisible){%> icon-visible <%}%>" data-label="<%- label %>">','<span tabtitle="<%- label %>" draggable="true" oo_editor_input="true" tabindex="-1" data-index="<%= index %>">','<div class="toolbar__icon <% if(iconCls.length){%><%= iconCls %><%}%>" title="<% if(iconTitle.length){%><%=Common.Utils.String.htmlEncode(iconTitle)%><%}%>"></div>',"<%- label %>","</span>","</li>"].join("")),this.initialize.call(this,t),this};_.extend(e.prototype,{initialize:function(t){_.extend(this,t)},render:function(){var t=this.template(this);return this.$el=$(t),this.rendered=!0,this.disable(this.disabled),this},isActive:function(){return this.$el.hasClass("active")},activate:function(){this.$el.hasClass("active")||this.$el.addClass("active")},isSelected:function(){return this.$el.hasClass("selected")},deactivate:function(){this.$el.removeClass("active")},on:function(){this.$el.on.apply(this,arguments)},disable:function(t){this.disabled=t,this.rendered&&(t&&!this.$el.hasClass("disabled")?this.$el.addClass("disabled"):this.$el.removeClass("disabled"))},addClass:function(t){t.length&&!this.$el.hasClass(t)&&this.$el.addClass(t)},removeClass:function(t){t.length&&this.$el.hasClass(t)&&this.$el.removeClass(t)},toggleClass:function(t){t.length&&this.$el.toggleClass(t)},hasClass:function(t){return this.$el.hasClass(t)},setCaption:function(t){this.$el.find("> span").text(t)},changeIconState:function(t,e){this.iconCls.length&&(this.iconVisible=t,this.iconTitle=e||"",this[t?"addClass":"removeClass"]("icon-visible"),e&&this.$el.find("."+this.iconCls).attr("title",e))}}),Common.UI.Tab=e})),define("common/main/lib/component/TabBar",["common/main/lib/component/BaseView","common/main/lib/component/Tab"],(function(){"use strict";var t={bind:function(){this.o||(this.o=$({})),this.o.on.apply(this.o,arguments)},unbind:function(){this.o&&this.o.off.apply(this.o,arguments)},trigger:function(){this.o||(this.o=$({})),this.o.trigger.apply(this.o,arguments)}},e=function(t){this.initialize.call(this,t)};_.extend(e.prototype,t),e.prototype.initialize=function(t){this.bar=t.bar},e.prototype.attach=function(t){t.changeState=$.proxy((function(e){if(e){t.toggleClass("selected");var i=_.find(this.bar.selectTabs,(function(e){return e.sheetindex===t.sheetindex}));i?this.bar.selectTabs=_.without(this.bar.selectTabs,i):this.bar.selectTabs.push(t)}else t.isSelected()||(this.bar.$el.find("ul > li.selected").removeClass("selected"),t.addClass("selected"),this.bar.selectTabs.length=0,this.bar.selectTabs.push(t)),this.trigger("tab:change",t),this.bar.$el.find("ul > li.active").removeClass("active"),t.activate(),this.bar.trigger("tab:changed",this.bar,this.bar.tabs.indexOf(t),t)}),this);new function(){};t.$el.on({click:$.proxy((function(e){if(!t.disabled)if(e.ctrlKey||e.metaKey)t.isActive()||t.changeState(!0);else if(e.shiftKey){this.bar.$el.find("ul > li.selected").removeClass("selected"),this.bar.selectTabs.length=0;for(var i=this.bar.$el.find("ul > li.active").index(),o=this.bar.tabs.indexOf(t),n=o>i?o:i,s=o>i?i:o;s<=n;s++)this.bar.tabs[s].changeState(!0)}else t.$el.hasClass("active")||(this.bar.tabs.length===this.bar.selectTabs.length&&(this.bar.$el.find("ul > li.selected").removeClass("selected"),this.bar.selectTabs.length=0),"manual"==t.control?this.bar.trigger("tab:manual",this.bar,this.bar.tabs.indexOf(t),t):(t.changeState(),this.bar.isEditFormula&&setTimeout((function(){$("#ce-cell-content").focus();var t=$("#ce-cell-content")[0];t.selectionStart=t.selectionEnd=t.value.length}),500)));!t.disabled&&Common.NotificationCenter.trigger("edit:complete","tab")}),this),dblclick:$.proxy((function(){this.trigger("tab:dblclick",this,this.tabs.indexOf(t),t)}),this.bar),contextmenu:$.proxy((function(){this.trigger("tab:contextmenu",this,this.tabs.indexOf(t),t,this.selectTabs)}),this.bar),mousedown:$.proxy((function(e){if(3===e.which||e.shiftKey)this.bar.$el.find("ul > li > span").attr("draggable","false");else{var i=t.isLockTheDrag;this.bar.selectTabs.forEach((function(t){t.isLockTheDrag&&(i=!0)})),(this.bar.selectTabs.length!==this.bar.tabs.length&&1!==this.bar.tabs.length||e.ctrlKey||Common.Utils.isMac&&e.altKey)&&!this.bar.isEditFormula||(i=!0),!(this.bar.selectTabs.length===this.bar.tabs.length&&this.bar.tabs.length>1)||e.ctrlKey||Common.Utils.isMac&&e.altKey||(i=!1,this.bar.$el.find("ul > li.selected").removeClass("selected")),this.bar.$el.find("ul > li > span").attr("draggable",!i),i||e.ctrlKey||e.metaKey||t.changeState()}$("#ce-cell-content").is(":focus")&&(this.bar.isEditFormula?setTimeout((function(){$("#ce-cell-content").focus()}),500):$("#ce-cell-content").blur())}),this)}),t.$el.children().on({dragstart:$.proxy((function(t){var e=t.originalEvent;if(Common.Utils.isIE||Common.Utils.isSafari)Common.Utils.isIE&&this.bar.selectTabs.forEach((function(t){t.$el.find("span").prop("tabtitle","")}));else{var i=document.createElement("div");e.dataTransfer.setDragImage(i,0,0)}e.dataTransfer.effectAllowed="copyMove",this.bar.preventCutTab=!1,this.bar.trigger("tab:dragstart",e.dataTransfer,this.bar.selectTabs)}),this),dragenter:$.proxy((function(t){var e=t.originalEvent;this.bar.isEditFormula?e.dataTransfer.dropEffect="none":(this.bar.$el.find(".mousemove").removeClass("mousemove right"),$(t.currentTarget).parent().addClass("mousemove"),e.dataTransfer.dropEffect=e.ctrlKey||Common.Utils.isMac&&e.altKey?"copy":"move")}),this),dragover:$.proxy((function(t){var e=t.originalEvent;return e.preventDefault&&e.preventDefault(),this.bar.isEditFormula?e.dataTransfer.dropEffect="none":(this.bar.$el.find(".mousemove").removeClass("mousemove right"),$(t.currentTarget).parent().addClass("mousemove"),e.dataTransfer.dropEffect=e.ctrlKey||Common.Utils.isMac&&e.altKey?"copy":"move"),!1}),this),dragleave:$.proxy((function(t){$(t.currentTarget).parent().removeClass("mousemove right")}),this),dragend:$.proxy((function(t){Common.Utils.isMac&&t.altKey&&(this.bar.isDragDrop=!0);var e=t.originalEvent;this.bar.trigger("tab:dragend",!this.bar.preventCutTab&&"move"===e.dataTransfer.dropEffect&&!e.dataTransfer.mozUserCancelled),this.bar.$el.find(".mousemove").removeClass("mousemove right")}),this),drop:$.proxy((function(t){Common.Utils.isMac&&t.altKey&&(this.bar.isDragDrop=!0);var e=t.originalEvent,i=$(e.currentTarget).data("index");this.bar.$el.find(".mousemove").removeClass("mousemove right"),this.bar.trigger("tab:drop",e.dataTransfer,i,e.ctrlKey||Common.Utils.isMac&&e.altKey),this.bar.isDrop=!0,this.bar.preventCutTab=!0}),this)})},e.prototype.detach=function(t){t.$el.off()},Common.UI.TabBar=Common.UI.BaseView.extend({config:{placement:"top",items:[],draggable:!1},tabs:[],template:_.template('<ul id="statusbar_bottom" class="nav nav-tabs <%= placement %>"></ul>'),selectTabs:[],initialize:function(t){_.extend(this.config,t),Common.UI.BaseView.prototype.initialize.call(this,t),this.saved=[],this.isRTL=t.isRTL||!1},render:function(){this.$el.html(this.template(this.config)),this.$bar=this.$el.find("ul");var t=function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)},i=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";return t(this.$bar[0],i,_.bind(this._onMouseWheel,this)),t(this.$bar[0],"dragstart",_.bind((function(t){t.dataTransfer.effectAllowed="copyMove"}),this)),t(this.$bar[0],"dragenter",_.bind((function(t){this.isEditFormula?t.dataTransfer.dropEffect="none":t.dataTransfer.dropEffect=t.ctrlKey||Common.Utils.isMac&&t.altKey?"copy":"move"}),this)),t(this.$bar[0],"dragover",_.bind((function(t){return t.preventDefault&&t.preventDefault(),t.dataTransfer.dropEffect=this.isEditFormula?"none":t.ctrlKey||Common.Utils.isMac&&t.altKey?"copy":"move",!this.isEditFormula&&this.tabs[this.tabs.length-1].$el.addClass("mousemove right"),!1}),this)),t(this.$bar[0],"dragleave",_.bind((function(t){t.dataTransfer.dropEffect="none",this.tabs[this.tabs.length-1].$el.removeClass("mousemove right")}),this)),t(this.$bar[0],"drop",_.bind((function(t){this.$el.find(".mousemove").removeClass("mousemove right"),void 0===this.isDrop?(Common.Utils.isMac&&t.altKey&&(this.isDragDrop=!0),this.trigger("tab:drop",t.dataTransfer,"last",t.ctrlKey||Common.Utils.isMac&&t.altKey)):this.isDrop=void 0}),this)),this.manager=new e({bar:this}),this.insert(-1,this.config.items),this.insert(-1,this.saved),delete this.saved,Common.Gateway.on("processmouse",_.bind(this.onProcessMouse,this)),this.rendered=!0,this},_onMouseWheel:function(t){var e=this.checkInvisible(!0);(t.detail&&-t.detail||t.wheelDelta)<0?e.last&&this.setTabVisible("forward"):e.first&&this.setTabVisible("backward"),Common.NotificationCenter.trigger("hints:clear")},onProcessMouse:function(t){if("mouseup"==t.type&&this.dragging){var e=this.getActive(!0);e&&e.mouseup()}},add:function(t){return this.insert(-1,t)>0},insert:function(t,e){var i=0;if(e&&(e instanceof Array||(e=[e]),e.length)){if(i=e.length,this.rendered){var o,n=this;if(t<0||t>n.tabs.length)for(var s=0;s<e.length;s++)o=new Common.UI.Tab(e[s]),n.$bar.append(o.render().$el),n.tabs.push(o),n.manager.attach(o),o.isActive()&&(n.selectTabs.length=0,n.selectTabs.push(o));else for(s=e.length;s-- >0;)o=new Common.UI.Tab(e[s]),0===t?(n.$bar.prepend(o.render().$el),n.tabs.unshift(o)):(n.$bar.find("li:nth-child("+t+")").before(o.render().$el),n.tabs.splice(t,0,o)),o.isActive()&&(n.selectTabs.length=0,n.selectTabs.push(o)),n.manager.attach(o)}else this.saved.push(e);this.checkInvisible()}return i},remove:function(t){if(t>=0&&t<this.tabs.length){var e=this.tabs.splice(t,1)[0];this.manager.detach(e),e.$el.remove(),this.checkInvisible()}},empty:function(t){var e=this;this.tabs.forEach((function(t){e.manager.detach(t)})),this.$bar.empty(),e.tabs=[],this.checkInvisible(t)},setActive:function(t){if(t instanceof Common.UI.Tab)e=t;else if("number"==typeof t&&t>=0&&t<this.tabs.length)var e=this.tabs[t];!e||"manual"==e.control||e.disabled||e.$el.hasClass("active")||e.changeState(),this.checkInvisible()},setSelectAll:function(t){var e=this;e.selectTabs.length=0,t?e.tabs.forEach((function(t){t.isSelected()||t.addClass("selected"),e.selectTabs.push(t)})):e.tabs.forEach((function(t){t.isActive()?e.selectTabs.push(t):t.isSelected()&&t.removeClass("selected")}))},getActive:function(t){return t?this.$bar.find("> li.active"):this.$bar.find("> li.active").index()},getAt:function(t){return t>=0&&t<this.tabs.length?this.tabs[t]:void 0},getCount:function(){return this.tabs.length},addClass:function(t){t.length&&!this.$bar.hasClass(t)&&this.$bar.addClass(t)},removeClass:function(t){t.length&&this.$bar.hasClass(t)&&this.$bar.removeClass(t)},hasClass:function(t){return this.$bar.hasClass(t)},setTabVisible:function(t,e){if(t<=0)this.$bar.scrollLeft(0),this.checkInvisible(e);else if(t>=this.tabs.length-1){var i=this.tabs[this.tabs.length-1].$el;0===this.$bar.find(".separator-item").length&&this.$bar.append('<li class="separator-item"><span></span></li>'),this.$bar.scrollLeft(this.$bar.scrollLeft()+(Common.Utils.getPosition(i).left+parseInt(i.css("width"))-this.$bar.width())+(this.$bar.width()>400?20:5)),this.checkInvisible(e)}else{this.isTabVisible(this.tabs.length-1)||0!==this.$bar.find(".separator-item").length||this.$bar.append('<li class="separator-item"><span></span></li>');var o,n,s=this.$bar.width();if(this.isRTL)if("forward"==t){for(var a=this.tabs.length-1;a>=0;a--)if(i=this.tabs[a].$el,(o=Common.Utils.getPosition(i).left+parseInt(i.css("width")))>s){this.$bar.scrollLeft(this.$bar.scrollLeft()+(o-s)+(s>400?20:5)),this.checkInvisible(e);break}}else if("backward"==t){for(a=0;a<this.tabs.length;a++)if(i=this.tabs[a].$el,(n=Common.Utils.getPosition(i).left)<0){this.$bar.scrollLeft(this.$bar.scrollLeft()+n-26),this.checkInvisible(e);break}}else"number"==typeof t&&(i=this.tabs[t].$el,(o=(n=Common.Utils.getPosition(i).left)+parseInt(i.css("width")))>s?(this.$bar.scrollLeft(this.$bar.scrollLeft()+(o-s)+20),this.checkInvisible(e)):n<0&&(this.$bar.scrollLeft(this.$bar.scrollLeft()+n-26),this.checkInvisible(e)));else if("forward"==t){for(a=0;a<this.tabs.length;a++)if(i=this.tabs[a].$el,(o=Common.Utils.getPosition(i).left+parseInt(i.css("width")))>s){this.$bar.scrollLeft(this.$bar.scrollLeft()+(o-s)+(this.$bar.width()>400?20:5)),this.checkInvisible(e);break}}else if("backward"==t){for(a=this.tabs.length;a-- >0;)if(i=this.tabs[a].$el,(n=Common.Utils.getPosition(i).left)<0){this.$bar.scrollLeft(this.$bar.scrollLeft()+n-26),this.checkInvisible(e);break}}else"number"==typeof t&&(i=this.tabs[t].$el,o=(n=Common.Utils.getPosition(i).left)+parseInt(i.css("width")),n<0?(this.$bar.scrollLeft(this.$bar.scrollLeft()+n-26),this.checkInvisible(e)):o>s&&(this.$bar.scrollLeft(this.$bar.scrollLeft()+(o-s)+20),this.checkInvisible(e)))}},checkInvisible:function(t){var e={first:!this.isTabVisible(this.isRTL?this.tabs.length-1:0),last:!this.isTabVisible(this.isRTL?0:this.tabs.length-1)};return!t&&this.fireEvent("tab:invisible",this,e),e},hasInvisible:function(){for(var t=Common.Utils.getOffset(this.$bar).left,e=t+this.$bar.width(),i=this.tabs.length;i-- >0;)if(!this.isTabVisible(i,t,e))return!0;return!1},isTabVisible:function(t){var e,i,o,n,s=arguments[1]||Common.Utils.getOffset(this.$bar).left,a=arguments[2]||s+this.$bar.width();return t<this.tabs.length&&t>=0&&(o=this.tabs[t].$el,e=(n=Common.Utils.getBoundingClientRect(o.get(0))).left,i=n.right,!(e<s||i-a>.5))},addDataHint:function(t,e){var i=this.$bar.find("[data-hint]");i.length>0&&(i.removeAttr("data-hint"),i.removeAttr("data-hint-direction"),i.removeAttr("data-hint-offset"),i.removeAttr("data-hint-title"));var o=this.tabs[t].$el;o.attr("data-hint",e||"0"),o.attr("data-hint-direction","top"),o.attr("data-hint-offset","medium"),o.attr("data-hint-title","M")},getWidth:function(){var t=21;return this.tabs.forEach((function(e){t+=e.$el.width()})),t},setDirection:function(t){this.isRTL=t}})})),define("spreadsheeteditor/main/app/view/Statusbar",["text!spreadsheeteditor/main/app/template/StatusBar.template","tip","common/main/lib/component/TabBar","common/main/lib/component/Menu","common/main/lib/component/Window","common/main/lib/component/ThemeColorPalette"],(function(t){"use strict";if(SSE.Views.Statusbar)var e=SSE.Views.Statusbar.RenameDialog,i=SSE.Views.Statusbar.CopyDialog;SSE.Views.Statusbar=Common.UI.BaseView.extend(_.extend({el:"#statusbar",template:_.template(t),events:function(){return{"click #status-btn-tabback":_.bind(this.onBtnTabScroll,this,"backward"),"click #status-btn-tabnext":_.bind(this.onBtnTabScroll,this,"forward")}},api:void 0,initialize:function(t){_.extend(this,t),Common.NotificationCenter.on("uitheme:changed",_.bind((function(){this.setMode()}),this))},render:function(){var t=this;$(this.el).html(this.template({scope:this})),this.cntStatusbar=$(".statusbar",this.el),this.isCompact=Common.localStorage.getBool("sse-compact-statusbar",!0),this.isCompact||this.cntStatusbar.addClass("no-compact"),this.editMode=!1,this.rangeSelectionMode=Asc.c_oAscSelectionDialogType.None,this.isRtlSheet=!1,this.tabBarDefPosition=141,this.btnZoomDown=new Common.UI.Button({el:$("#status-btn-zoomdown",this.el),hint:this.tipZoomOut+" (Ctrl+-)",hintAnchor:"top"}),this.btnZoomUp=new Common.UI.Button({el:$("#status-btn-zoomup",this.el),hint:this.tipZoomIn+" (Ctrl++)",hintAnchor:"top-right"}),this.btnScrollBack=new Common.UI.Button({el:$("#status-btn-tabback",this.el),hint:this.tipPrev,disabled:!0,hintAnchor:"top"}),this.btnScrollNext=new Common.UI.Button({el:$("#status-btn-tabnext",this.el),hint:this.tipNext,disabled:!0,hintAnchor:"top"}),this.btnAddWorksheet=new Common.UI.Button({el:$("#status-btn-addtab",this.el),hint:this.tipAddTab,disabled:!0,hintAnchor:"top"});var e=$(".cnt-tabslist",this.el);this.cntSheetList=new Common.UI.Button({el:e,hint:this.tipListOfSheets,hintAnchor:"top"}),this.btnSheetList=$("#status-btn-tabslist",this.$el),this.sheetListMenu=new Common.UI.Menu({style:"margin-top:-3px;",menuAlign:"bl-tl",search:!0,maxHeight:300}),this.sheetListMenu.on("item:click",(function(e,i){t.fireEvent("show:tab",[i.value])})),this.cntSheetList.cmpEl.on({"show.bs.dropdown":function(){_.defer((function(){t.cntSheetList.cmpEl.find("ul").focus()}),100)},"hide.bs.dropdown":function(){_.defer((function(){t.api.asc_enableKeyEvents(!0)}),100)}}),this.sheetListMenu.render(e),this.sheetListMenu.cmpEl.attr({tabindex:-1}),e.on("app:scaling",(function(){t.setMode()})),this.cntZoom=new Common.UI.Button({el:$(".cnt-zoom",this.el),hint:this.tipZoomFactor,hintAnchor:"top"}),this.cntZoom.cmpEl.on({"show.bs.dropdown":function(){_.defer((function(){t.cntZoom.cmpEl.find("ul").focus()}),100)},"hide.bs.dropdown":function(){_.defer((function(){t.api.asc_enableKeyEvents(!0)}),100)}}),this.zoomMenu=new Common.UI.Menu({style:"margin-top:-5px;",menuAlign:"bl-tl",items:[{caption:"50%",value:50},{caption:"75%",value:75},{caption:"100%",value:100},{caption:"125%",value:125},{caption:"150%",value:150},{caption:"175%",value:175},{caption:"200%",value:200},{caption:"300%",value:300},{caption:"400%",value:400},{caption:"500%",value:500}]}),this.zoomMenu.render($(".cnt-zoom",this.el)),this.zoomMenu.cmpEl.attr({tabindex:-1}),this.labelZoom=$("#status-label-zoom",this.$el),this.tabBarBox=$("#status-sheets-bar-box",this.el),this.tabbar=new Common.UI.TabBar({el:"#status-sheets-bar",placement:"bottom",draggable:!1}).render(),this.tabbar.on({"tab:invisible":_.bind(this.onTabInvisible,this),"tab:changed":_.bind(this.onSheetChanged,this),"tab:contextmenu":_.bind(this.onTabMenu,this),"tab:dblclick":_.bind((function(){!t.editMode||t.mode&&t.mode.isDisconnected||t.rangeSelectionMode===Asc.c_oAscSelectionDialogType.Chart||t.rangeSelectionMode===Asc.c_oAscSelectionDialogType.FormatTable||t.rangeSelectionMode===Asc.c_oAscSelectionDialogType.PrintTitles||t.fireEvent("sheet:changename")}),this)});var i=new Common.UI.Menu({maxHeight:267,menuAlign:"tl-tr"}).on("show:after",(function(){this.scroller.update({alwaysVisibleY:!0})}));i.on("item:click",(function(e,i,o){t.fireEvent("show:hidden",[t,i.value])}));var o=new Common.UI.Menu({menuAlign:"tl-tr",cls:"color-tab",items:[{template:_.template('<div id="id-tab-menu-color" style="width: 164px;display: inline-block;"></div>')},{caption:"--"},{id:"id-tab-menu-new-color",template:_.template('<a tabindex="-1" type="menuitem" style="'+(t.isRtlSheet?"padding-right: 12px;":"padding-left: 12px;")+'">'+t.textNewColor+"</a>")}]});t.mnuTabColor={isDummy:!0,on:function(){}},this.tabMenu=new Common.UI.Menu({menuAlign:"bl-tl",items:[{caption:this.itemInsert,value:"ins"},{caption:this.itemDelete,value:"del"},{caption:this.itemRename,value:"ren"},{caption:this.itemMoveOrCopy,value:"move-copy"},{caption:this.itemHide,value:"hide"},{caption:this.itemHidden,menu:i},{caption:this.itemProtect,value:"protect"},{caption:this.itemTabColor,menu:o},{caption:"--"},{caption:this.selectAllSheets,value:"selectall"},{caption:this.ungroupSheets,value:"noselect"}]}).on("render:after",(function(e){t.mnuTabColor=new Common.UI.ThemeColorPalette({el:$("#id-tab-menu-color"),outerMenu:{menu:o,index:0,focusOnShow:!0},transparent:!0}),o.setInnerMenu([{menu:t.mnuTabColor,index:0}]),t.mnuTabColor.on("select",(function(e,i){t.fireEvent("sheet:setcolor",[i]),setTimeout((function(){t.tabMenu.hide()}),1)}))}));var n=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div style="position: relative;"><div class="item-caption"><%= caption %></div><label class="item-value"><%= options.exampleval ? options.exampleval : "" %></label></div></a>');return this.customizeStatusBarMenu=new Common.UI.Menu({menuAlign:"bl-tl",menuAlignEl:$(this.el),items:[{id:"saved-status",caption:this.itemStatus,value:"status",checkable:!0,checked:!0,template:n,exampleval:""},{caption:"--"},{id:"math-item-average",caption:this.itemAverage,value:"average",checkable:!0,checked:!0,template:n,exampleval:""},{id:"math-item-count",caption:this.itemCount,value:"count",checkable:!0,checked:!0,template:n,exampleval:""},{id:"math-item-min",caption:this.itemMinimum,value:"min",checkable:!0,checked:!0,template:n,exampleval:""},{id:"math-item-max",caption:this.itemMaximum,value:"max",checkable:!0,checked:!0,template:n,exampleval:""},{id:"math-item-sum",caption:this.itemSum,value:"sum",checkable:!0,checked:!0,template:n,exampleval:""}]}),this.tabbar.$el.append('<div class="dropdown-toggle" data-toggle="dropdown" style="width:0; height:0;"></div>'),this.tabMenu.render(this.tabbar.$el),this.tabMenu.cmpEl.attr({tabindex:-1}),this.tabMenu.on("show:after",_.bind(this.onTabMenuAfterShow,this)),this.tabMenu.on("hide:after",_.bind(this.onTabMenuAfterHide,this)),this.tabMenu.on("item:click",_.bind(this.onTabMenuClick,this)),this.boxMath=$("#status-math-box",this.el),this.labelSum=$("#status-math-sum",this.boxMath),this.labelCount=$("#status-math-count",this.boxMath),this.labelAverage=$("#status-math-average",this.boxMath),this.labelMin=$("#status-math-min",this.boxMath),this.labelMax=$("#status-math-max",this.boxMath),this.boxMath.hide(),this.boxFiltered=$("#status-filtered-box",this.el),this.labelFiltered=$("#status-filtered-records",this.boxFiltered),this.boxFiltered.hide(),this.boxZoom=$("#status-zoom-box",this.el),this.boxZoom.find(".separator").css("border-left-color","transparent"),this.boxNumberSheets=$("#status-number-of-sheet",this.el),this.isCompact&&this.boxNumberSheets.hide(),this.labelNumberSheets=$("#label-sheets",this.boxNumberSheets),this.boxAction=$("#status-action",this.el),this.boxAction.hide(),this.labelAction=$("#label-action",this.boxAction),this.$el.append('<div id="statusbar-menu" style="width:0; height:0;"></div>'),this.$customizeStatusBarMenu=this.$el.find("#statusbar-menu"),this.$customizeStatusBarMenu.on({"show.bs.dropdown":function(){_.defer((function(){t.$customizeStatusBarMenu.find("ul").focus()}),100)},"hide.bs.dropdown":function(){_.defer((function(){t.api.asc_enableKeyEvents(!0)}),100)}}),this.$customizeStatusBarMenu.append('<div class="dropdown-toggle" data-toggle="dropdown" style="width:0; height:0;"></div>'),this.customizeStatusBarMenu.render(this.$customizeStatusBarMenu),this.customizeStatusBarMenu.cmpEl.attr({tabindex:-1}),this.customizeStatusBarMenu.on("show:after",_.bind(this.onCustomizeStatusBarAfterShow,this)),this.customizeStatusBarMenu.on("hide:after",_.bind(this.onCustomizeStatusBarAfterHide,this)),this.customizeStatusBarMenu.on("item:click",_.bind(this.onCustomizeStatusBarClick,this)),this.$el.on("contextmenu",_.bind(this.showCustomizeStatusBar,this)),this},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onSheetsChanged",_.bind(this.update,this)),this.api.asc_registerCallback("asc_onUpdateSheetViewSettings",_.bind(this.onUpdateSheetViewSettings,this)),this},setMode:function(t){this.mode=_.extend({},this.mode,t),$("#status-addtabs-box")[this.mode.isEdit?"show":"hide"](),this.tabBarDefPosition=parseInt($("#status-tabs-scroll").css("width"))+parseInt(this.cntStatusbar.css("padding-left")),this.tabBarDefPosition+=this.mode.isEdit?parseFloat($("#status-addtabs-box").css("width")):0,this.btnAddWorksheet.setDisabled(this.mode.isDisconnected||this.api&&(this.api.asc_isWorkbookLocked()||this.api.isCellEdited)||this.rangeSelectionMode!=Asc.c_oAscSelectionDialogType.None),this.mode.isEditOle&&(this.btnAddWorksheet.$el.find("button").addBack().filter("button").attr("data-hint","1"),this.btnScrollBack.$el.find("button").addBack().filter("button").attr("data-hint","1"),this.btnScrollNext.$el.find("button").addBack().filter("button").attr("data-hint","1"),this.cntSheetList.$el.find("button").attr("data-hint","1"),this.cntSheetList.$el.find("button").removeAttr("data-hint-title"),this.cntZoom.$el.find(".dropdown-toggle").attr("data-hint","1")),this.updateTabbarBorders()},setVisible:function(t){t?this.show():this.hide()},isVisible:function(){return this.$el&&this.$el.is(":visible")},update:function(){var t=this;if(this.tabbar.empty(!0),this.tabMenu.items[5].menu.removeAll(),this.tabMenu.items[5].hide(),this.btnAddWorksheet.setDisabled(!0),this.sheetListMenu.removeAll(),this.api){for(var e,i,o,n=this.api.asc_getWorksheetsCount(),s=-1,a=[],r=[],l=[],c=this.api.asc_getActiveWorksheetIndex(),h=this.api.asc_isProtectedWorkbook();++s<n;)i=t.api.asc_isWorksheetLockedOrDeleted(s),o=t.api.asc_getActiveNamedSheetView&&t.api.asc_getActiveNamedSheetView(s)||"",e={sheetindex:s,index:r.length,active:c==s,label:t.api.asc_getWorksheetName(s),cls:i?"coauth-locked":"",isLockTheDrag:i||t.mode.isDisconnected||h,iconCls:"btn-sheet-view",iconTitle:o,iconVisible:""!==o},this.api.asc_isWorksheetHidden(s)?a.push(e):r.push(e),l.push(e);a.length&&(a.forEach((function(e){t.tabMenu.items[5].menu.addItem(new Common.UI.MenuItem({style:"white-space: pre-wrap",caption:e.label,value:e.sheetindex}))})),this.tabMenu.items[5].show()),this.tabbar.add(r),l.forEach((function(e){var i=t.api.asc_isWorksheetHidden(e.sheetindex);t.sheetListMenu.addItem(new Common.UI.MenuItem({style:"white-space: pre",caption:Common.Utils.String.htmlEncode(e.label),value:e.sheetindex,checkable:!0,checked:e.active,hidden:i,visible:!i||!h,textHidden:t.itemHidden,template:_.template(['<a id="<%= id %>" style="<%= style %>" tabindex="-1" type="menuitem" <% if (options.hidden) { %> data-hidden="true" <% } %>>','<div class="color"></div>','<span class="name"><%= caption %></span>','<span class="hidden-mark"><% if (options.hidden) { %><%=  options.textHidden %><% } else { %><% } %></span>',"</a>"].join(""))}))})),_.isUndefined(this.tabBarScroll)||(this.tabbar.$bar.scrollLeft(this.tabBarScroll.scrollLeft),this.tabBarScroll=void 0),this.updateRtlSheet(!0),this.btnAddWorksheet.setDisabled(t.mode.isDisconnected||t.api.asc_isWorkbookLocked()||h||t.api.isCellEdited),this.mode.isEdit&&this.tabbar.addDataHint(_.findIndex(r,(function(t){return t.sheetindex===c})),this.mode.isEditOle?"1":"0"),$("#status-label-zoom").text(Common.Utils.String.format(this.zoomText,Math.floor(100*(this.api.asc_getZoom()+.005)))),this.updateNumberOfSheet(c,n),t.fireEvent("sheet:changed",[t,c]),t.fireEvent("sheet:updateColors",[!0]),Common.NotificationCenter.trigger("comments:updatefilter",["doc","sheet"+t.api.asc_getActiveWorksheetId()],!1)}},onUpdateSheetViewSettings:function(){this.updateRtlSheet()},updateRtlSheet:function(t){var e=this.isRtlSheet;this.isRtlSheet=!!this.api&&!!this.api.asc_getSheetViewSettings().asc_getRightToLeft(),this.cntStatusbar.toggleClass("rtl-sheet",this.isRtlSheet),this.cntStatusbar.attr({dir:this.isRtlSheet?"rtl":"ltr"}),this.tabbar.setDirection(this.isRtlSheet);var i=(this.isCompact?this.isRtlSheet:Common.UI.isRTL())?"rtl":"ltr";this.boxZoom.attr({dir:i}),this.boxMath.attr({dir:i}),this.boxFiltered.attr({dir:i}),this.sheetListMenu.menuAlign=this.isRtlSheet?"br-tr":"bl-tl",(e!==this.isRtlSheet||t)&&this.updateTabbarBorders();var o=this.api?this.api.asc_getActiveWorksheetIndex():0,n=_.findWhere(this.tabbar.tabs,{sheetindex:o});n&&!this.tabbar.isTabVisible(n.index)&&this.tabbar.setTabVisible(n.index)},setMathInfo:function(t){t.count>1?(this.boxMath.is(":visible")||this.boxMath.show(),this.labelCount.text(this.textCount+": "+t.count),this.labelMin.text(t.min&&t.min.length?this.textMin+": "+t.min:""),this.labelMax.text(t.max&&t.max.length?this.textMax+": "+t.max:""),this.labelSum.text(t.sum&&t.sum.length?this.textSum+": "+t.sum:""),this.labelAverage.text(t.average&&t.average.length?this.textAverage+": "+t.average:""),this.labelMin[t.min&&t.min.length>0?"show":"hide"](),this.labelMax[t.max&&t.max.length>0?"show":"hide"](),this.labelSum[t.sum&&t.sum.length>0?"show":"hide"](),this.labelAverage[t.average&&t.average.length>0?"show":"hide"](),this.customizeStatusBarMenu.items.forEach((function(e){"math-item-average"===e.options.id?e.options.exampleval=t.average&&t.average.length?t.average:"":"math-item-min"===e.options.id?e.options.exampleval=t.min&&t.min.length?t.min:"":"math-item-max"===e.options.id?e.options.exampleval=t.max&&t.max.length?t.max:"":"math-item-count"===e.options.id?e.options.exampleval=t.count?String(t.count):"":"math-item-sum"===e.options.id&&(e.options.exampleval=t.sum&&t.sum.length?t.sum:""),$(e.el).find("label").text(e.options.exampleval)}))):(this.customizeStatusBarMenu.items.forEach((function(t){t.options.exampleval="",$(t.el).find("label").text("")})),this.boxMath.is(":visible")&&this.boxMath.hide());var e=this;_.delay((function(){e.updateVisibleItemsBoxMath(),e.updateTabbarBorders(),e.onTabInvisible(void 0,e.tabbar.checkInvisible(!0))}),30)},setFilteredInfo:function(t,e){if(t>0&&e>0)this.boxFiltered.is(":visible")||this.boxFiltered.show(),this.labelFiltered.text(Common.Utils.String.format(this.filteredRecordsText,t,e));else if(t)this.boxFiltered.is(":visible")||this.boxFiltered.show(),this.labelFiltered.text(this.filteredText);else if(null!=t)this.boxFiltered.is(":visible")&&this.boxFiltered.hide();else{var i=this.api.asc_getCellInfo().asc_getAutoFilterInfo(),o=!i||!0!==i.asc_getIsApplyAutoFilter();this.setFilteredInfo(!o)}var n=this;_.delay((function(){n.onTabInvisible(void 0,n.tabbar.checkInvisible(!0))}),30)},onSheetChanged:function(t,e,i){this.api.asc_showWorksheet(i.sheetindex),this.updateNumberOfSheet(i.sheetindex,this.api.asc_getWorksheetsCount()),this.updateRtlSheet(!0),this.mode.isEdit&&this.tabbar.addDataHint(e,this.mode.isEditOle?"1":"0"),this.fireEvent("sheet:changed",[this,i.sheetindex]),this.fireEvent("sheet:updateColors",[!0])},onTabMenu:function(t,e,i,o){var n=this;if(this.mode.isEdit&&!this.isEditFormula&&this.rangeSelectionMode!==Asc.c_oAscSelectionDialogType.Chart&&this.rangeSelectionMode!==Asc.c_oAscSelectionDialogType.FormatTable&&this.rangeSelectionMode!==Asc.c_oAscSelectionDialogType.PrintTitles&&!this.mode.isDisconnected&&i&&i.sheetindex>=0){if(i.isActive()||this.tabbar.setActive(i),_.isUndefined(o))s=n.api.asc_isWorksheetLockedOrDeleted(i.sheetindex);else{var s=!1;o.forEach((function(t){n.api.asc_isWorksheetLockedOrDeleted(t.sheetindex)&&(s=!0)}))}var a=this.api.asc_isWorkbookLocked(),r=this.api.asc_isProtectedWorkbook();this.tabMenu.items[0].setDisabled(a||r),this.tabMenu.items[1].setDisabled(s||r),this.tabMenu.items[2].setDisabled(s||r),this.tabMenu.items[3].setDisabled(s||r),this.tabMenu.items[4].setDisabled(s||r),this.tabMenu.items[5].setDisabled(a||r),this.tabMenu.items[6].setDisabled(o.length>1),this.tabMenu.items[7].setDisabled(s||r),this.tabMenu.items[6].setVisible(!this.mode.isEditOle&&this.mode.canProtect),this.tabMenu.items[6].setCaption(this.api.asc_isProtectedSheet()?this.itemUnProtect:this.itemProtect),1===o.length?this.tabMenu.items[10].hide():this.tabMenu.items[10].show(),this.tabMenu.items[9].setDisabled(s||r),this.tabMenu.items[10].setDisabled(s||r),this.api.asc_closeCellEditor(),this.api.asc_enableKeyEvents(!1);var l=i.$el;this.tabMenu.atposition=function(){var t=l.parent();if(!(t.length<1)){var e=Common.Utils.getBoundingClientRect(l.get(0)),i=Common.Utils.getOffset(t);return{top:e.top,left:e.left-i.left-2,right:e.right-i.left+2}}},this.tabMenu.hide(),this.tabMenu.show();var c=this.tabMenu;_.defer((function(){c.cmpEl.focus()}),10)}},onTabMenuAfterShow:function(t){if(t.atposition){var e=this.tabMenu.atposition();e&&t.setOffset(Common.UI.isRTL()?e.right-$(t.el).width():e.left)}this.enableKeyEvents=!0},onTabMenuAfterHide:function(){_.isUndefined(this.enableKeyEvents)||(this.api&&this.api.asc_enableKeyEvents(this.enableKeyEvents),this.enableKeyEvents=void 0)},onTabMenuClick:function(t,e){e&&this.api&&(this.enableKeyEvents="ins"===e.value||"hide"===e.value,"selectall"===e.value?this.tabbar.setSelectAll(!0):"noselect"===e.value&&this.tabbar.setSelectAll(!1))},onTabInvisible:function(t,e){this.btnScrollBack.isDisabled()!==!e.first&&this.btnScrollBack.setDisabled(!e.first),this.btnScrollNext.isDisabled()!==!e.last&&this.btnScrollNext.setDisabled(!e.last),this.hasTabInvisible=e.first||e.last},onBtnTabScroll:function(t,e){this.tabbar.setTabVisible(t)},updateTabbarBorders:function(){var t=!1,e=parseFloat(this.boxZoom.css("width"));if(this.boxMath.is(":visible")&&(this.isCompact&&this.isRtlSheet||!this.isCompact&&Common.UI.isRTL()?this.boxMath.css({left:e+"px",right:"auto"}):this.boxMath.css({right:e+"px",left:"auto"}),e+=parseFloat(this.boxMath.css("width")),t=!0),this.boxFiltered.is(":visible")&&(this.isCompact&&this.isRtlSheet||!this.isCompact&&Common.UI.isRTL()?this.boxFiltered.css({left:e+"px",right:"auto"}):this.boxFiltered.css({right:e+"px",left:"auto"}),e+=parseFloat(this.boxFiltered.css("width")),t=!0),this.isCompact){var i=this.tabbar.getWidth();if(this.boxAction.is(":visible")){var o=this.actionWidth||140;if(Common.Utils.innerWidth()-e-this.tabBarDefPosition-o-i>0){var n=i+this.tabBarDefPosition;this.isRtlSheet?(this.boxAction.css({left:e+"px",right:n+"px",width:"auto"}),this.boxAction.find(".separator").css("border-right-color","transparent")):(this.boxAction.css({right:e+"px",left:n+"px",width:"auto"}),this.boxAction.find(".separator").css("border-left-color","transparent"))}else this.isRtlSheet?(this.boxAction.css({left:e+"px",right:"auto",width:o+"px"}),this.boxAction.find(".separator").css("border-right-color","")):(this.boxAction.css({right:e+"px",left:"auto",width:o+"px"}),this.boxAction.find(".separator").css("border-left-color","")),t=!0;e+=parseInt(this.boxAction.css("width"))}else Common.Utils.innerWidth()-e-this.tabBarDefPosition-i<=0&&(t=!0);this.boxMath.is(":visible")&&this.boxMath.css({top:"0px",bottom:"auto"}),this.boxFiltered.is(":visible")&&this.boxFiltered.css({top:"0px",bottom:"auto"}),this.boxZoom.css({top:"0px",bottom:"auto"}),this.isRtlSheet?(this.tabBarBox.css("left",e+"px"),this.tabBarBox.css("right",this.tabBarDefPosition+"px"),this.boxZoom.find(".separator").css("border-right-color",t?"":"transparent")):(this.tabBarBox.css("left",this.tabBarDefPosition+"px"),this.tabBarBox.css("right",e+"px"),this.boxZoom.find(".separator").css("border-left-color",t?"":"transparent"))}else this.boxAction.is(":visible")&&(Common.UI.isRTL()?(this.boxAction.css({left:e+"px",right:"135px",width:"auto"}),this.boxAction.find(".separator").css("border-right-color","transparent")):(this.boxAction.css({right:e+"px",left:"135px",width:"auto"}),this.boxAction.find(".separator").css("border-left-color","transparent"))),this.boxMath.is(":visible")&&this.boxMath.css({top:"auto",bottom:"0px"}),this.boxFiltered.is(":visible")&&this.boxFiltered.css({top:"auto",bottom:"0px"}),this.boxZoom.css({top:"auto",bottom:"0px"}),this.boxZoom.find(".separator").css(Common.UI.isRTL()?"border-right-color":"border-left-color",t?"":"transparent"),this.isRtlSheet?(this.tabBarBox.css("left","0px"),this.tabBarBox.css("right",this.tabBarDefPosition+"px")):(this.tabBarBox.css("left",this.tabBarDefPosition+"px"),this.tabBarBox.css("right","0px"));if(this.statusMessage){var s=this.getStatusMessage(this.statusMessage);s!==this.boxAction.text().trim()&&this.labelAction.text(s)}},updateVisibleItemsBoxMath:function(){var t=parseInt(this.$el.css("width")),e=parseInt(this.boxZoom.css("width"))+parseInt($("#status-tabs-scroll").css("width"))+parseInt($("#status-addtabs-box").css("width"));for(this.boxFiltered.is(":visible")&&(e+=parseInt(this.boxFiltered.css("width"))),this.$el.find(".over-box").removeClass("over-box");e+parseInt(this.boxMath.css("width"))+100>t;){var i=this.boxMath.find("label:not(.hide, .over-box)");if(i.length>0&&$(i[i.length-1]).addClass("over-box"),i.length<=1)break}},changeViewMode:function(t){var e=t.isEdit,i=this.isRtlSheet?"right":"left";e?this.tabBarBox.css(i,this.tabBarDefPosition+"px"):this.tabBarBox.css(i,""),this.tabbar.options.draggable=e,this.editMode=e},showCustomizeStatusBar:function(t){var e=$(t.target);$("#status-zoom-box").find(e).length>0||$(t.target).closest(".statusbar .list-item").length>0||$("#status-tabs-scroll").find(e).length>0||$("#status-addtabs-box").find(e).length>0||(this.customizeStatusBarMenu.hide(),this.customizeStatusBarMenu.atposition={left:t.clientX*Common.Utils.zoom(),top:t.clientY*Common.Utils.zoom()},this.customizeStatusBarMenu.show())},onCustomizeStatusBarAfterShow:function(t){if(t.atposition){var e=$(this.el).height(),i=!this.isCompact&&t.atposition.top-Common.Utils.getOffset($(this.el)).top>e/2?e/2:0;t.setOffset(Common.UI.isRTL()?t.atposition.left-$(this.el).width()+2:t.atposition.left,i)}this.enableKeyEvents=!0},onCustomizeStatusBarAfterHide:function(){_.isUndefined(this.enableKeyEvents)||(this.api&&this.api.asc_enableKeyEvents(this.enableKeyEvents),this.enableKeyEvents=void 0)},onCustomizeStatusBarClick:function(t,e,i){var o=e.value,n=e.checked;"status"===o?this.boxAction[n?"removeClass":"addClass"]("hide"):(this.boxMath.find("#status-math-"+o)[n?"removeClass":"addClass"]("hide"),this.boxMath.find("label").length===this.boxMath.find("label.hide").length?this.boxMath.find(".separator").hide():this.boxMath.find(".separator").is(":hidden")&&this.boxMath.find(".separator").show()),this.updateVisibleItemsBoxMath(),this.updateTabbarBorders(),this.onTabInvisible(void 0,this.tabbar.checkInvisible(!0)),i.stopPropagation(),e.$el.find("a").blur()},onChangeCompact:function(t){this.isCompact=t,t?(this.cntStatusbar.removeClass("no-compact"),this.boxNumberSheets.hide()):(this.cntStatusbar.addClass("no-compact"),this.boxNumberSheets.show()),this.updateRtlSheet(!0),this.tabbar.getCount()>0&&this.onTabInvisible(void 0,this.tabbar.checkInvisible(!0))},updateNumberOfSheet:function(t,e){this.labelNumberSheets.text(Common.Utils.String.format(this.sheetIndexText,t+1,e))},getStatusMessage:function(t){return this.isCompact&&t.length>23&&this.boxAction.width()<180?t.substr(0,23).trim()+"...":t},showStatusMessage:function(t,e){this.statusMessage=t,this.actionWidth||(this.actionWidth=t.length>22?166:140),this.labelAction.text(this.getStatusMessage(t)),this.customizeStatusBarMenu.items.forEach((function(e){"saved-status"===e.options.id&&(e.options.exampleval=t),$(e.el).find("label").text(e.options.exampleval)})),this.boxAction.is(":visible")||this.boxAction.show();var i=this;_.delay((function(){i.updateTabbarBorders(),i.onTabInvisible(void 0,i.tabbar.checkInvisible(!0)),e&&e()}),30)},clearStatusMessage:function(){this.labelAction.text(""),this.statusMessage=void 0},getStatusLabel:function(){return this.labelAction},sheetIndexText:"Sheet {0} of {1}",tipZoomIn:"Zoom In",tipZoomOut:"Zoom Out",tipZoomFactor:"Magnification",tipPrev:"Previous Sheet",tipNext:"Next Sheet",tipAddTab:"Add Worksheet",tipListOfSheets:"List of Sheets",itemInsert:"Insert",itemDelete:"Delete",itemRename:"Rename",itemMoveOrCopy:"Move or copy",itemHide:"Hide",itemHidden:"Hidden",itemTabColor:"Tab Color",textNoColor:"No Color",textNewColor:"Add New Custom Color",zoomText:"Zoom {0}%",textSum:"Sum",textCount:"Count",textAverage:"Average",textMin:"Min",textMax:"Max",filteredRecordsText:"{0} of {1} records filtered",filteredText:"Filter mode",selectAllSheets:"Select All Sheets",ungroupSheets:"Ungroup Sheets",itemAverage:"Average",itemCount:"Count",itemMinimum:"Minimum",itemMaximum:"Maximum",itemSum:"Sum",itemStatus:"Saving status",itemProtect:"Protect",itemUnProtect:"Unprotect"},SSE.Views.Statusbar||{})),SSE.Views.Statusbar.RenameDialog=Common.UI.Window.extend(_.extend({options:{header:!1,width:280,cls:"modal-dlg",buttons:["ok","cancel"]},template:'<div class="box"><div class="input-row"><label><%= label %></label></div><div class="input-row" id="txt-sheet-name"></div></div>',initialize:function(t){_.extend(this.options,t||{},{label:this.labelSheetName}),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this.getChild();t.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.txtName=new Common.UI.InputField({el:t.find("#txt-sheet-name"),style:"width:100%;",value:this.options.current,allowBlank:!1,maxLength:31,validation:_.bind(this.nameValidator,this)})},getFocusedComponents:function(){return[this.txtName].concat(this.getFooterButtons())},getDefaultFocusableComponent:function(){return this.txtName},show:function(t,e){Common.UI.Window.prototype.show.apply(this,arguments);var i=this.txtName.$el.find("input");_.delay((function(t){i.focus(),i.select()}),100,this)},onBtnClick:function(t){this.doClose(t.currentTarget.attributes.result.value)},doClose:function(t){"ok"!=t||!0===this.txtName.checkValidate()?(this.options.handler&&this.options.handler.call(this,t,this.txtName.getValue()),this.close()):_.delay((function(t){t.txtName.focus()}),100,this)},onPrimary:function(t){return this.doClose("ok"),!1},nameValidator:function(t){var e=this.options.names;if(!e&&this.options.api){var i=this.options.api,o=i.asc_getActiveWorksheetIndex(),n=i.asc_getWorksheetsCount();for(e=[];n--;)o!==n&&e.push(i.asc_getWorksheetName(n).toLowerCase())}if(e)for(var s=t.toLowerCase(),a=e.length-1;a>=0;--a)if(e[a]===s)return this.errNameExists;return!/^(\')|[:\\\/\*\?\[\]]|(\')$/.test(t)||this.errNameWrongChar},errNameExists:"Worksheet with such name already exist.",errNameWrongChar:"A sheet name cannot contains characters: \\, /, *, ?, [, ], : or the character ' as first or last character",labelSheetName:"Sheet Name"},e||{})),SSE.Views.Statusbar.CopyDialog=Common.UI.Window.extend(_.extend({options:{width:270,cls:"modal-dlg",buttons:["ok","cancel"]},template:'<div class="box"><% if ( supportBooks ) { %><div class="input-row"><label><%= labelSpreadsheet %></label></div><div id="status-cmb-spreadsheet" style="padding-bottom: 12px;"></div><% } %><div class="input-row"><label><%= labelMoveBefore %></label></div><div id="status-list-names" style="height: 178px;padding-bottom: 16px;"></div><div id="status-ch-create-copy"></div></div>',initialize:function(t){_.extend(this.options,t||{},{labelSpreadsheet:this.textSpreadsheet,labelMoveBefore:this.textMoveBefore,supportBooks:!!t.supportBooks}),this.options.tpl=_.template(this.template)(this.options),this.spreadsheets={data:[{displayValue:this.options.spreadsheetName,value:"current",index:0}],changed:!1,opened:!1},this.options.isDesktopApp&&this.options.isOffline&&this.spreadsheets.data.push({displayValue:this.textCreateNewSpreadsheet,value:"new",index:-1}),this.sheets=[this.options.sheets],Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){var t=this;Common.UI.Window.prototype.render.call(this);var e=this.getChild();e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.cmbSpreadsheet=new Common.UI.ComboBox({el:$("#status-cmb-spreadsheet",this.$window),menuStyle:"min-width: 100%;",data:this.spreadsheets.data,cls:"input-group-nr",editable:!1}),this.cmbSpreadsheet.setValue("current");var i=function(){t.spreadsheets.opened=!0,t.spreadsheets.changed&&(t.cmbSpreadsheet.setData(t.spreadsheets.data),t.cmbSpreadsheet.setValue("current")),t.cmbSpreadsheet.off("show:before",i)};this.cmbSpreadsheet.on("show:before",i),this.cmbSpreadsheet.on("selected",_.bind(this.onChangeSpreadsheet,this));var o=[];this.sheets[0].forEach((function(t){o.push(new Common.UI.DataViewModel(t))}),this),o.length&&o.push(new Common.UI.DataViewModel({value:this.itemMoveToEnd,inindex:-255})),this.listNames=new Common.UI.ListView({el:$("#status-list-names",e),store:new Common.UI.DataViewStore(o),cls:"dbl-clickable",itemTemplate:_.template('<div id="<%= id %>" class="list-item"><%= Common.Utils.String.htmlEncode(value) %></div>'),tabindex:1}),this.listNames.selectByIndex(0),this.listNames.on("entervalue",_.bind(this.onPrimary,this)),this.listNames.on("item:dblclick",_.bind(this.onPrimary,this)),this.chCreateCopy=new Common.UI.CheckBox({el:$("#status-ch-create-copy",e),labelText:this.textCreateCopy,value:!1}),this.mask=$(".modals-mask"),this.mask.on("mousedown",_.bind(this.onUpdateFocus,this))},changeSpreadsheets:function(t){this.spreadsheets.changed=!0;var e=this,i=this.spreadsheets.data,o=this.options.isDesktopApp?i.slice(0,i.length-1):i,n=o.length;t.forEach((function(t,i){o.push({displayValue:t.asc_getName(),value:t.asc_getId(),index:n+i});var s=t.asc_getSheets(),a=[];s.forEach((function(t){a.push({value:t.asc_getName(),inindex:t.asc_getIndex()})})),e.sheets[n+i]=a})),this.options.isDesktopApp&&o.push(i[i.length-1]),this.spreadsheets.data=o,this.spreadsheets.opened&&(this.cmbSpreadsheet.setData(this.spreadsheets.data),this.cmbSpreadsheet.setValue("current"))},onChangeSpreadsheet:function(t,e){var i=e.index,o=this.sheets[i];if(o){var n=[];o.forEach((function(t){n.push(new Common.UI.DataViewModel(t))}),this),n.length&&n.push(new Common.UI.DataViewModel({value:this.itemMoveToEnd,inindex:-255})),this.listNames.store.reset(n),this.listNames.selectByIndex(0)}else this.listNames.store.reset([])},getFocusedComponents:function(){return[this.cmbSpreadsheet,this.listNames,this.chCreateCopy].concat(this.getFooterButtons())},getDefaultFocusableComponent:function(){return this.listNames},show:function(t,e){Common.UI.Window.prototype.show.apply(this,arguments),_.delay((function(t){t.listNames.focus()}),100,this)},hide:function(){Common.UI.Window.prototype.hide.apply(this,arguments),this.mask.off("mousedown",_.bind(this.onUpdateFocus,this))},onBtnClick:function(t){if(this.options.handler){var e=this.listNames.getSelectedRec(),i=e?e.get("inindex"):0;-255===i&&(i=this.listNames.store.length-1);var o=this.cmbSpreadsheet.getSelectedRecord();this.options.handler.call(this,t.currentTarget.attributes.result.value,i,"checked"===this.chCreateCopy.getValue(),o.value)}this.close()},onPrimary:function(){if(this.options.handler){var t=this.listNames.getSelectedRec(),e=t?t.get("inindex"):0;-255===e&&(e=this.listNames.store.length-1);var i=this.cmbSpreadsheet.getSelectedRecord();this.options.handler.call(this,"ok",e,"checked"===this.chCreateCopy.getValue(),i.value)}this.close()},onUpdateFocus:function(){_.delay((function(t){t.listNames.focus()}),100,this)},itemMoveToEnd:"(Move to end)",textMoveBefore:"Move before sheet",textCreateCopy:"Create a copy",textSpreadsheet:"Spreadsheet",textCreateNewSpreadsheet:"(Create new spreadsheet)"},i||{}))})),define("spreadsheeteditor/main/app/controller/Statusbar",["core","spreadsheeteditor/main/app/view/Statusbar"],(function(){"use strict";SSE.Controllers.Statusbar=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["Statusbar"],initialize:function(){this.addListeners({Statusbar:{"show:tab":_.bind(this.showTab,this),"show:hidden":_.bind((function(t,e){this.hideWorksheet(!1,e)}),this),"sheet:changename":_.bind((function(){this.api.asc_closeCellEditor(),this.renameWorksheet()}),this),"sheet:setcolor":_.bind(this.setWorksheetColor,this),"sheet:updateColors":_.bind(this.updateTabsColors,this),"sheet:move":_.bind(this.moveWorksheet,this)},ViewTab:{"statusbar:setcompact":_.bind(this.onChangeViewMode,this)}})},events:function(){return{"click #status-btn-zoomdown":_.bind(this.zoomDocument,this,"down"),"click #status-btn-zoomup":_.bind(this.zoomDocument,this,"up"),"click .cnt-zoom":_.bind(this.onZoomShow,this)}},onLaunch:function(){this.statusbar=this.createView("Statusbar").render(),this.statusbar.$el.css("z-index",10),this.statusbar.labelZoom.css("min-width",80),this.statusbar.labelZoom.text(Common.Utils.String.format(this.zoomText,100)),this.statusbar.zoomMenu.on("item:click",_.bind(this.menuZoomClick,this)),this.bindViewEvents(this.statusbar,this.events),$("#id-tab-menu-new-color",this.statusbar.$el).on("click",_.bind(this.onNewBorderColor,this)),this.statusbar.tabbar.on({"tab:dragstart":_.bind((function(t,e){Common.Utils.isIE&&(this.isDrop=!1),Common.UI.Menu.Manager.hideAll(),this.api.asc_closeCellEditor();for(var i=[],o=[],n=this.api.asc_getWorksheetsCount(),s=[],a=-1;++a<n;)this.api.asc_isWorksheetHidden(a)||s.push({value:this.api.asc_getWorksheetName(a),inindex:a});var r=[];e.forEach((function(t){r.push(t.sheetindex)})),s.forEach((function(t){-1!==r.indexOf(t.inindex)&&(i.push(t.inindex),o.push(t.value))}));var l,c=[];l=this.api.asc_StartMoveSheet(_.clone(i)),c.push({type:"onlyoffice",value:l}),c.push({type:"indexes",value:i}),c.push({type:"names",value:o}),c.push({type:"key",value:Common.Utils.InternalSettings.get("sse-doc-info-key")});var h=JSON.stringify(c);Common.Utils.isIE?(t.setData("text","sheet"),this.dataTransfer=h):t.setData("onlyoffice",h),this.dropTabs=e}),this),"tab:drop":_.bind((function(t,e,i){if(!(this.isEditFormula||Common.Utils.isIE&&void 0===this.dataTransfer)){Common.Utils.isIE&&(this.isDrop=!0);var o=Common.Utils.isIE?this.dataTransfer:t.getData("onlyoffice");if(o){var n=JSON.parse(o);if(n){var s=_.findWhere(n,{type:"key"}).value;if(Common.Utils.InternalSettings.get("sse-doc-info-key")===s)this.statusbar.fireEvent("sheet:move",[_.findWhere(n,{type:"indexes"}).value,!i,!0,_.isNumber(e)?e:this.api.asc_getWorksheetsCount()]),Common.NotificationCenter.trigger("tabs:dragend",this);else{var a=_.findWhere(n,{type:"names"}).value,r=this.generateSheetNames(!1,void 0,a);e=_.isNumber(e)?e:this.api.asc_getWorksheetsCount();this.api.asc_EndMoveSheet(e,r,_.findWhere(n,{type:"onlyoffice"}).value)}}}}}),this),"tab:dragend":_.bind((function(t){if(t&&(!Common.Utils.isIE||!1!==this.isDrop)&&this.dropTabs.length>0){var e=[];this.dropTabs.forEach((function(t){e.push(t.sheetindex)})),this.api.asc_deleteWorksheet(e)}this.dropTabs=void 0,Common.Utils.isIE&&(this.isDrop=void 0,this.dataTransfer=void 0),Common.NotificationCenter.trigger("tabs:dragend",this)}),this)})},setApi:function(t){this.api=t,this.api.asc_registerCallback("asc_onZoomChanged",_.bind(this.onZoomChange,this)),this.api.asc_registerCallback("asc_onSelectionMathChanged",_.bind(this.onApiMathChanged,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onApiDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiDisconnect,this)),this.api.asc_registerCallback("asc_onUpdateTabColor",_.bind(this.onApiUpdateTabColor,this)),this.api.asc_registerCallback("asc_onEditCell",_.bind(this.onApiEditCell,this)),this.api.asc_registerCallback("asc_onWorkbookLocked",_.bind(this.onWorkbookLocked,this)),this.api.asc_registerCallback("asc_onWorksheetLocked",_.bind(this.onWorksheetLocked,this)),this.api.asc_registerCallback("asc_onChangeProtectWorkbook",_.bind(this.onChangeProtectWorkbook,this)),this.api.asc_registerCallback("asc_onError",_.bind(this.onError,this)),this.api.asc_registerCallback("asc_onFilterInfo",_.bind(this.onApiFilterInfo,this)),this.api.asc_registerCallback("asc_onActiveSheetChanged",_.bind(this.onApiActiveSheetChanged,this)),this.api.asc_registerCallback("asc_onRefreshNamedSheetViewList",_.bind(this.onRefreshNamedSheetViewList,this)),this.api.asc_registerCallback("asc_generateNewSheetNames",_.bind((function(t,e){e(this.generateSheetNames(!1,void 0,t))}),this)),this.statusbar.setApi(t)},zoomDocument:function(t,e){if(this.api){switch(t){case"up":var i=Math.floor(10*this.api.asc_getZoom())/10;!((i+=.1)>5)&&this.api.asc_setZoom(i);break;case"down":i=Math.ceil(10*this.api.asc_getZoom())/10,!((i-=.1)<.1)&&this.api.asc_setZoom(i)}Common.NotificationCenter.trigger("edit:complete",this.statusbar)}},menuZoomClick:function(t,e){this.api&&this.api.asc_setZoom(e.value/100),Common.NotificationCenter.trigger("edit:complete",this.statusbar)},onZoomChange:function(t,e){var i=Math.floor(100*(t+.005));this.statusbar.labelZoom.text(Common.Utils.String.format(this.zoomText,i)),Common.localStorage.setItem("sse-last-zoom",i)},onApiDisconnect:function(){this.SetDisabled(!0)},SetDisabled:function(t){this.statusbar.setMode({isDisconnected:t}),this.statusbar.update()},onWorkbookLocked:function(t){this.statusbar.tabbar[t?"addClass":"removeClass"]("coauth-locked"),this.statusbar.btnAddWorksheet.setDisabled(t||this.api.isCellEdited||this.statusbar.rangeSelectionMode==Asc.c_oAscSelectionDialogType.Chart||this.statusbar.rangeSelectionMode==Asc.c_oAscSelectionDialogType.FormatTable||this.statusbar.rangeSelectionMode==Asc.c_oAscSelectionDialogType.PrintTitles||this.api.asc_isProtectedWorkbook());for(var e,i=this.statusbar.tabbar.getCount();i-- >0;)(e=this.statusbar.tabbar.getAt(i)).sheetindex>=0||(e.disable(t),e.$el.children(":first-child").attr("draggable",t?"false":"true"))},onWorksheetLocked:function(t,e){for(var i,o=this.statusbar.tabbar.getCount(),n=this.api.asc_isProtectedWorkbook(),s=o;s-- >0;)if(t==(i=this.statusbar.tabbar.getAt(s)).sheetindex){i[e?"addClass":"removeClass"]("coauth-locked"),i.isLockTheDrag=e||n||this.statusbar.rangeSelectionMode==Asc.c_oAscSelectionDialogType.FormatTable||this.statusbar.rangeSelectionMode==Asc.c_oAscSelectionDialogType.PrintTitles,i.$el.children(":first-child").attr("draggable",i.isLockTheDrag?"false":"true");break}var a=this.statusbar.sheetListMenu.items[t];a&&a.$el&&a.$el.children().first().data("hidden")&&a.setDisabled(e)},onChangeProtectWorkbook:function(){var t=this.api.asc_isProtectedWorkbook();this.statusbar.btnAddWorksheet.setDisabled(this.api.isCellEdited||this.api.asc_isWorkbookLocked()||t||this.statusbar.rangeSelectionMode!=Asc.c_oAscSelectionDialogType.None);for(var e,i=this.statusbar.tabbar.getCount();i-- >0;){var o=(e=this.statusbar.tabbar.getAt(i)).hasClass("coauth-locked");e.isLockTheDrag=o||t||this.statusbar.rangeSelectionMode==Asc.c_oAscSelectionDialogType.FormatTable||this.statusbar.rangeSelectionMode==Asc.c_oAscSelectionDialogType.PrintTitles,e.$el.children(":first-child").attr("draggable",e.isLockTheDrag?"false":"true")}this.statusbar.update()},onApiMathChanged:function(t){this.statusbar.setMathInfo({count:t.asc_getCount(),average:t.asc_getAverage(),min:t.asc_getMin(),max:t.asc_getMax(),sum:t.asc_getSum()}),this.statusbar.updateTabbarBorders()},onApiFilterInfo:function(t,e){this.statusbar.setFilteredInfo(t,e),this.statusbar.updateTabbarBorders()},onApiEditCell:function(t){var e=t==Asc.c_oAscCellEditorState.editFormula,i=t!=Asc.c_oAscCellEditorState.editEnd,o=this.statusbar;o.isEditFormula=e,o.tabbar&&(o.tabbar.isEditFormula=e),o.btnZoomUp.setDisabled(i),o.btnZoomDown.setDisabled(i),o.labelZoom[i?"addClass":"removeClass"]("disabled"),o.btnAddWorksheet.setDisabled(i||this.api.asc_isWorkbookLocked()||this.api.asc_isProtectedWorkbook()||o.rangeSelectionMode!=Asc.c_oAscSelectionDialogType.None),o.$el.find("#statusbar_bottom li span").attr("oo_editor_input",!e)},createDelayedElements:function(){this.statusbar.$el.css("z-index",""),this.statusbar.tabMenu.on("item:click",_.bind(this.onTabMenu,this)),this.statusbar.btnAddWorksheet.on("click",_.bind(this.onAddWorksheetClick,this)),Common.UI.LayoutManager.isElementVisible("statusBar-actionStatus")&&!this.statusbar.mode.isEditOle||(this.statusbar.customizeStatusBarMenu.items[0].setVisible(!1),this.statusbar.customizeStatusBarMenu.items[1].setVisible(!1),this.statusbar.boxAction.addClass("hide")),Common.NotificationCenter.on("window:resize",_.bind(this.onWindowResize,this)),Common.NotificationCenter.on("cells:range",_.bind(this.onRangeDialogMode,this))},onWindowResize:function(t){this.statusbar.updateVisibleItemsBoxMath(),this.statusbar.updateTabbarBorders(),this.statusbar.onTabInvisible(void 0,this.statusbar.tabbar.checkInvisible(!0))},onRangeDialogMode:function(t){var e=this.statusbar.tabbar.hasClass("coauth-locked"),i=this.api.asc_getActiveWorksheetIndex();this.statusbar.btnAddWorksheet.setDisabled(e||this.api.isCellEdited||this.api.asc_isProtectedWorkbook()||t!=Asc.c_oAscSelectionDialogType.None),this.statusbar.btnSheetList[t==Asc.c_oAscSelectionDialogType.FormatTable||t==Asc.c_oAscSelectionDialogType.PrintTitles?"addClass":"removeClass"]("disabled");for(var o,n=this.statusbar.tabbar.getCount(),s=this.api.asc_isProtectedWorkbook();n-- >0;)(o=this.statusbar.tabbar.getAt(n)).sheetindex!==i&&o.disable(t==Asc.c_oAscSelectionDialogType.FormatTable||t==Asc.c_oAscSelectionDialogType.PrintTitles),o.isLockTheDrag=o.hasClass("coauth-locked")||s||t!=Asc.c_oAscSelectionDialogType.None;this.statusbar.rangeSelectionMode=t},onTabMenu:function(t,e,i){var o=this,n=this.statusbar.tabbar.selectTabs,s=[];switch(n.forEach((function(t){s.push(t.sheetindex)})),e.value){case"ins":for(var a=[],r=0;r<s.length;r++)a.push(o.createSheetName(a));setTimeout((function(){o.api.asc_insertWorksheet(a)}),1);break;case"del":this.deleteWorksheet(s);break;case"ren":this.renameWorksheet();break;case"move-copy":this.moveWorksheet(s);break;case"hide":setTimeout((function(){o.hideWorksheet(!0,s)}),1);break;case"protect":this.protectWorksheet()}},createSheetName:function(t){for(var e=[],i=this.api.asc_getWorksheetsCount();i--;)e.push(this.api.asc_getWorksheetName(i).toLowerCase());for(var o,n=0;n++,o=this.strSheet+n,!(e.indexOf(o.toLowerCase())<0););if(t&&t.length>0){var s=[];for(t.forEach((function(t){s.push(t.toLowerCase())}));-1!==s.indexOf(o.toLowerCase())||-1!==e.indexOf(o.toLowerCase());)n++,o=this.strSheet+n}return o},createCopyName:function(t,e,i,o){var n=/^(.*)\((\d)\)$/.exec(e),s=n?n[1]:e+" ",a=1,r=e;for(t&&(r=s+"("+ ++a+")");-1!==o.indexOf(r.toLowerCase());)r=s+"("+ ++a+")";if(i&&i.length>0){var l=[];for(i.forEach((function(t){l.push(t.toLowerCase())}));-1!==l.indexOf(r.toLowerCase());)r=s+"("+ ++a+")"}return r},generateSheetNames:function(t,e,i){for(var o=this,n=[],s=this.api.asc_getWorksheetsCount();s--;)n.push(this.api.asc_getWorksheetName(s).toLowerCase());var a=[];return e?e.forEach((function(e){a.push(o.createCopyName(t,o.api.asc_getWorksheetName(e),a,n))})):i&&i.forEach((function(e){a.push(o.createCopyName(t,e,a,n))})),a},deleteWorksheet:function(t){var e=this;1==this.statusbar.tabbar.tabs.length||t.length===this.statusbar.tabbar.tabs.length?Common.UI.warning({msg:this.errorLastSheet}):Common.UI.warning({msg:this.warnDeleteSheet,buttons:["ok","cancel"],callback:function(i){"ok"!=i||e.api.asc_deleteWorksheet(t)||_.delay((function(){Common.UI.error({msg:e.errorRemoveSheet})}),10)}})},hideWorksheet:function(t,e){if(t)1==this.statusbar.tabbar.tabs.length||e.length===this.statusbar.tabbar.tabs.length?Common.UI.warning({msg:this.errorLastSheet}):this.api.asc_hideWorksheet(e);else{this.api.asc_showWorksheet(e),this.loadTabColor(e);var i=this;setTimeout((function(){i.statusbar.tabMenu.hide()}),1)}},renameWorksheet:function(){var t=this,e=t.api.asc_getWorksheetsCount(),i=null;if(e>0){var o=t.api.asc_getActiveWorksheetIndex();if(t.api.asc_isWorksheetLockedOrDeleted(o))return;if(!Common.Utils.InternalSettings.get("sse-settings-coauthmode"))for(i=[];e--;)o!==e&&i.push(t.api.asc_getWorksheetName(e).toLowerCase());var n=t.statusbar.tabbar.tabs[t.statusbar.tabbar.getActive()],s=Common.Utils.getPosition(t.statusbar.$el).top-115,a=Common.Utils.getOffset(n.$el).left,r=t.api.asc_getWorksheetName(t.api.asc_getActiveWorksheetIndex()),l=new SSE.Views.Statusbar.RenameDialog({current:r,names:i,api:t.api,handler:function(e,i){"ok"==e&&i!=r&&t.api.asc_renameWorksheet(i),t.api.asc_enableKeyEvents(!0)}});if("number"==typeof l.options.width){var c=$("body").width();a+l.options.width>c&&(a=c-l.options.width-5)}l.show(a,s)}},moveWorksheet:function(t,e,i,o){for(var n=this,s=n.api.asc_getWorksheetsCount(),a=[],r=[],l=-1;++l<s;)this.api.asc_isWorksheetHidden(l)||a.push({value:n.api.asc_getWorksheetName(l),inindex:l});if(_.isUndefined(t)||a.forEach((function(e){-1!==t.indexOf(e.inindex)&&r.push(e.inindex)})),_.isUndefined(i)){var c,h=n.api.asc_isSupportCopySheetsBetweenBooks();n.copyDialog=new SSE.Views.Statusbar.CopyDialog({title:n.statusbar.itemMoveOrCopy,sheets:a,supportBooks:h,spreadsheetName:n.api.asc_getDocumentName(),isDesktopApp:n.statusbar.mode.isDesktopApp,isOffline:n.statusbar.mode.isOffline,handler:function(t,e,i,o){var a,l;"ok"==(c=t)?("new"===o?a=[]:"current"!==o&&(a=[o]),"current"!==o&&(l=[],r.forEach((function(t){l.push(n.api.asc_getWorksheetName(t))}))),i?(l||(l=n.generateSheetNames(i,r)),n.api.asc_copyWorksheet(-255==e?s:e,l,r,a)):n.api.asc_moveWorksheet(-255==e?s:e,r,l,a)):n.api.asc_cancelMoveCopyWorksheet();n.api.asc_enableKeyEvents(!0)}}),n.copyDialog.on("close",(function(){c||n.api.asc_cancelMoveCopyWorksheet(),n.copyDialog=void 0})),n.copyDialog.show();h&&n.api.asc_getOpeningDocumentsList((function(t){t&&n.copyDialog.changeSpreadsheets(t)}))}else if(e)n.api.asc_moveWorksheet(o,r),n.api.asc_enableKeyEvents(!0);else{var d=n.generateSheetNames(!e,r);n.api.asc_copyWorksheet(o,d,r)}},onAddWorksheetClick:function(t,e,i){this.api&&(this.api.asc_closeCellEditor(),this.api.asc_addWorksheet(this.createSheetName()),Common.NotificationCenter.trigger("comments:updatefilter",["doc","sheet"+this.api.asc_getActiveWorksheetId()],!1)),Common.NotificationCenter.trigger("edit:complete",this.statusbar)},showTab:function(t){if(this.api&&this.api.asc_getActiveWorksheetIndex()!==t)this.api.asc_showWorksheet(t),this.loadTabColor(t);else{var e=_.findWhere(this.statusbar.tabbar.tabs,{sheetindex:t});e&&(this.statusbar.tabbar.setTabVisible(e.index),this.statusbar.sheetListMenu.items[t].setChecked(!0))}var i=this;setTimeout((function(){i.statusbar.sheetListMenu.hide()}),1)},selectTab:function(t){if(this.api&&!this.api.asc_isWorksheetHidden(t)){var e=_.findWhere(this.statusbar.tabbar.tabs,{sheetindex:t});e&&this.statusbar.tabbar.setActive(e)}},onApiUpdateTabColor:function(t){this.loadTabColor(t)},setWorksheetColor:function(t){var e=this;if(this.api){var i=this.statusbar.tabbar.selectTabs,o=[];if(i.forEach((function(t){o.push(t.sheetindex)})),o)if("transparent"===t)this.api.asc_setWorksheetTabColor(null,o),i.forEach((function(t){t.$el.find("span").css("box-shadow","")}));else{var n=Common.Utils.ThemeColor.getRgbColor(t);n&&(this.api.asc_setWorksheetTabColor(n,o),i.forEach((function(t){e.setTabLineColor(t,n)})))}}},updateThemeColors:function(){this.statusbar&&function(t,e){if(t){for(var i,o=Common.Utils.ThemeColor.getEffectColors(),n=0;n<o.length;++n)"object"==_typeof(t.currentColor)&&void 0===i&&t.currentColor.effectId==o[n].effectId&&(i=o[n]);t.updateColors(o,Common.Utils.ThemeColor.getStandartColors()),void 0===t.currentColor?t.currentColor=o[e]:void 0!==i&&(t.currentColor=i)}}(this.statusbar.mnuTabColor,1)},onNewBorderColor:function(){this.statusbar&&this.statusbar.mnuTabColor&&this.statusbar.mnuTabColor.addNewColor()},updateTabsColors:function(t){var e=-1,i=-1,o=null,n=null,s=!1,a=this.api.asc_getWorksheetsCount(),r=this.api.asc_getActiveWorksheetIndex();_.isUndefined(t)||this.application.getController("Toolbar")&&(this.statusbar.mnuTabColor.updateCustomColors(),n=(o=this.api.asc_getWorksheetTabColor(r))?o.get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(o.get_r(),o.get_g(),o.get_b()),effectValue:o.get_value()}:Common.Utils.ThemeColor.getHexColor(o.get_r(),o.get_g(),o.get_b()):"transparent",Common.Utils.ThemeColor.selectPickerColorByEffect(n,this.statusbar.mnuTabColor));for(e=-1;++e<a;)++i,(s=this.api.asc_isWorksheetHidden(e))&&--i,s||this.setTabLineColor(this.statusbar.tabbar.getAt(i),this.api.asc_getWorksheetTabColor(e))},loadTabColor:function(t){if(this.api&&!this.api.asc_isWorksheetHidden(t)){var e=_.findWhere(this.statusbar.tabbar.tabs,{sheetindex:t});e&&this.setTabLineColor(e,this.api.asc_getWorksheetTabColor(t))}},setTabLineColor:function(t,e){t&&((e=null!==e?"#"+Common.Utils.ThemeColor.getHexColor(e.get_r(),e.get_g(),e.get_b()):"").length?(this.statusbar.sheetListMenu.items[t.sheetindex].$el.find(".color").css("background-color",e),e=t.isActive()?"0px 4px 0 "+e+" inset":"0px 4px 0 "+Common.Utils.RGBColor(e).toRGBA(1)+" inset",t.$el.find("span").css("box-shadow",e)):(t.$el.find("span").css("box-shadow",""),this.statusbar.sheetListMenu.items[t.sheetindex].$el.find(".color").css("background-color","")))},onZoomShow:function(t){if(t.target.classList.contains("disabled"))return!1},onError:function(t,e,i){t==Asc.c_oAscError.ID.LockedWorksheetRename&&this.statusbar.update()},onApiActiveSheetChanged:function(t){this.statusbar.tabMenu.hide(),this.statusbar.sheetListMenu.hide(),this.statusbar.sheetListMenu.items[t]&&(this.statusbar.sheetListMenu.clearAll(),this.statusbar.sheetListMenu.items[t].setChecked(!0)),this._sheetViewTip&&this._sheetViewTip.isVisible()&&this.api.asc_getActiveNamedSheetView&&!this.api.asc_getActiveNamedSheetView(t)&&this._sheetViewTip.hide()},onRefreshNamedSheetViewList:function(){for(var t=this.api.asc_getNamedSheetViews(),e=!1,i="",o=this,n=0;n<t.length;n++)if(t[n].asc_getIsActive()){e=!0,i=t[n].asc_getName();break}var s=this.statusbar.tabbar.getAt(this.statusbar.tabbar.getActive());s&&s.changeIconState(e,i),!e||Common.localStorage.getBool("sse-hide-sheet-view-tip")||Common.Utils.InternalSettings.get("sse-hide-sheet-view-tip")?!e&&this._sheetViewTip&&this._sheetViewTip.isVisible()&&this._sheetViewTip.hide():(this._sheetViewTip||(this._sheetViewTip=new Common.UI.SynchronizeTip({target:$("#editor_sdk"),extCls:"no-arrow",text:this.textSheetViewTipFilters,placement:"target"}),this._sheetViewTip.on({dontshowclick:function(){Common.localStorage.setBool("sse-hide-sheet-view-tip",!0),Common.Utils.InternalSettings.set("sse-hide-sheet-view-tip",!0),this.close(),o._sheetViewTip=void 0},closeclick:function(){Common.Utils.InternalSettings.set("sse-hide-sheet-view-tip",!0),this.close(),o._sheetViewTip=void 0}})),this._sheetViewTip.isVisible()||this._sheetViewTip.show())},onChangeViewMode:function(t,e,i){this.statusbar.fireEvent("view:compact",[this.statusbar,e]),!i&&Common.localStorage.setBool("sse-compact-statusbar",e),Common.NotificationCenter.trigger("layout:changed","status"),this.statusbar.onChangeCompact(e),Common.NotificationCenter.trigger("edit:complete",this.statusbar)},setStatusCaption:function(t,e,i,o){this.timerCaption&&(new Date<this.timerCaption||0==t.length)&&!e||(this.timerCaption=void 0,t.length?(this.statusbar.showStatusMessage(t,o),i>0&&(this.timerCaption=(new Date).getTime()+i)):this.statusbar.clearStatusMessage())},protectWorksheet:function(){Common.NotificationCenter.trigger("protect:sheet",!this.api.asc_isProtectedSheet())},getIsDragDrop:function(){var t=this.statusbar.tabbar.isDragDrop;return this.statusbar.tabbar.isDragDrop=!1,t},showDisconnectTip:function(t){var e=this;if(t=t||this.textDisconnect,this.disconnectTip)this.disconnectTip.setText(t);else{var i=this.statusbar.getStatusLabel();i=i.is(":visible")?i.parent():this.statusbar.isVisible()?this.statusbar.$el:$(document.body),this.disconnectTip=new Common.UI.SynchronizeTip({target:i,text:t,placement:"top",position:this.statusbar.isVisible()?void 0:{bottom:0},showLink:!1,style:"max-width: 310px;"}),this.disconnectTip.on({closeclick:function(){e.disconnectTip.hide(),e.disconnectTip=null}})}this.disconnectTip.show()},hideDisconnectTip:function(){this.disconnectTip&&this.disconnectTip.hide(),this.disconnectTip=null},getSelectTabs:function(){var t=this.statusbar.tabbar.selectTabs,e=[];return t.forEach((function(t){e.push(t.sheetindex)})),e},zoomText:"Zoom {0}%",errorLastSheet:"Workbook must have at least one visible worksheet.",errorRemoveSheet:"Can't delete the worksheet.",warnDeleteSheet:"The worksheet maybe has data. Proceed operation?",strSheet:"Sheet",textSheetViewTip:"You are in Sheet View mode. Filters and sorting are visible only to you and those who are still in this view.",textSheetViewTipFilters:"You are in Sheet View mode. Filters are visible only to you and those who are still in this view.",textDisconnect:"<b>Connection is lost</b><br>Trying to connect. Please check connection settings."},SSE.Controllers.Statusbar||{}))})),define("text!spreadsheeteditor/main/app/template/RightMenu.template",[],(function(){return'<div id="view-right-menu" class="tool-menu right">\n    <div class="right-panel side-panel">\n        <div class="content-box">\n            <div id="id-table-settings" class="settings-panel"></div>\n            <div id="id-shape-settings" class="settings-panel"></div>\n            <div id="id-image-settings" class="settings-panel"></div>\n            <div id="id-chart-settings" class="settings-panel"></div>\n            <div id="id-paragraph-settings" class="settings-panel"></div>\n            <div id="id-textart-settings" class="settings-panel"></div>\n            <div id="id-pivot-settings" class="settings-panel"></div>\n            <div id="id-signature-settings" class="settings-panel"></div>\n            <div id="id-cell-settings" class="settings-panel"></div>\n            <div id="id-slicer-settings" class="settings-panel"></div>\n        </div>\n    </div>\n    <div class="tool-menu-btns" role="menubar" aria-label="<%= scope.ariaRightMenu %>" aria-orientation="vertical">\n        <div class="ct-btn-category arrow-left"></div>\n        <button id="id-right-menu-cell" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-cell-settings"><i class="icon toolbar__icon btn-menu-cell">&nbsp;</i></button>\n        <button id="id-right-menu-table" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-table-settings"><i class="icon toolbar__icon btn-menu-table">&nbsp;</i></button>\n        <button id="id-right-menu-shape" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-shape-settings"><i class="icon toolbar__icon btn-menu-shape">&nbsp;</i></button>\n        <button id="id-right-menu-image" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-image-settings"><i class="icon toolbar__icon btn-menu-image">&nbsp;</i></button>\n        <button id="id-right-menu-chart" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-chart-settings"><i class="icon toolbar__icon btn-menu-chart">&nbsp;</i></button>\n        <button id="id-right-menu-text" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-paragraph-settings"><i class="icon toolbar__icon btn-paragraph">&nbsp;</i></button>\n        <button id="id-right-menu-textart" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-textart-settings"><i class="icon toolbar__icon btn-menu-textart">&nbsp;</i></button>\n        <button id="id-right-menu-slicer" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-slicer-settings"><i class="icon toolbar__icon btn-slicer">&nbsp;</i></button>\n        <button id="id-right-menu-signature" class="btn btn-category arrow-left hidden" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-signature-settings"><i class="icon toolbar__icon btn-menu-signature">&nbsp;</i></button>\n        <button id="id-right-menu-pivot" class="btn btn-category arrow-left" data-hint="0" data-hint-direction="left" data-hint-offset="big" content-target="id-pivot-settings"><i class="icon toolbar__icon btn-pivot-sum">&nbsp;</i></button>\n        <div id="slot-right-menu-more"></div>\n    </div>\n</div>'})),define("common/main/lib/component/SideMenu",["underscore","backbone","common/main/lib/component/BaseView"],(function(t,e){"use strict";Common.UI.SideMenu=e.View.extend({buttons:[],btnMoreContainer:void 0,render:function(){this.btnMore=new Common.UI.Button({parentEl:this.btnMoreContainer,cls:"btn-side-more btn-category",iconCls:"toolbar__icon btn-more",onlyIcon:!0,style:"width: 100%;",hint:this.tipMore,menu:new Common.UI.Menu({cls:"shifted-right",items:[]})}),this.btnMore.menu.on("item:click",t.bind(this.onMenuMore,this)),this.btnMore.menu.on("item:custom-click",t.bind(this.onMenuMore,this)),this.btnMore.menu.on("show:before",t.bind(this.onShowBeforeMoreMenu,this)),this.btnMore.hide(),$(window).on("resize",t.bind(this.setMoreButton,this))},setButtons:function(e){this.buttons=[],e.forEach(t.bind((function(t){t&&t.cmpEl.is(":visible")&&this.buttons.push(t)}),this))},addButton:function(t){this.buttons.push(t)},insertButton:function(e,i){this.btnMoreContainer.before(i),e.on("click",t.bind((function(){this.fireEvent("button:click",[e])}),this)),this.addButton(e),this.setMoreButton()},insertPanel:function(t){this.$el.find(".side-panel").append(t)},setMoreButton:function(){if(this.buttons.length){var e=this.btnMore,i=this.buttons[0].cmpEl.outerHeight(!0),o=parseFloat(this.$el.find(".tool-menu-btns").css("padding-top")),n=o+this.buttons.length*i,s=this.$el.height();if(n>s){var a,r,l=[];for(n=o,r=0;r<this.buttons.length;r++)if((n+=i)>s){a=r-1;break}if(this.buttons.forEach((function(e,i){i>=a?(e.options.iconImg?l.push({caption:Common.Utils.String.htmlEncode(e.hint),iconImg:e.options.iconImg,template:t.template(['<a id="<%= id %>" class="menu-item" tabindex="-1" type="menuitem">','<img class="menu-item-icon" src="<%= options.iconImg %>">',"<%= caption %>","</a>"].join("")),value:i,toggleGroup:"sideMenuItems",checkmark:!1,checkable:!0}):e.options.iconsSet?l.push(new Common.UI.MenuItemCustom({caption:Common.Utils.String.htmlEncode(e.hint),iconsSet:e.options.iconsSet,baseUrl:e.options.baseUrl,value:i,disabled:e.isDisabled(),toggleGroup:"sideMenuItems",checkmark:!1,checkable:!0})):l.push({caption:Common.Utils.String.htmlEncode(e.hint),iconCls:"menu__icon "+e.iconCls,value:i,disabled:e.isDisabled(),toggleGroup:"sideMenuItems",checkmark:!1,checkable:!0}),e.cmpEl.hide()):e.cmpEl.show()})),l.length>0){for(this.btnMore.menu.removeAll(),r=0;r<l.length;r++)this.btnMore.menu.addItem(l[r]);e.show()}}else this.buttons.forEach((function(t){t.cmpEl.show()})),e.hide()}},clearMoreButton:function(){this.buttons&&this.buttons.forEach((function(t){t.cmpEl.show()})),this.btnMore.hide()},onMenuMore:function(t,e){var i=this.buttons[e.value];"left-btn-support"!==i.cmpEl.prop("id")&&i.toggle(!i.pressed),i.trigger("click",i)},onShowBeforeMoreMenu:function(e){var i;e.items.forEach((function(t){t.setChecked(!1,!0)})),this.buttons.forEach((function(t,e){t.pressed&&(i=e)}));var o=t.findWhere(e.items,{value:i});o&&o.setChecked(!0,!0)},setDisabledMoreMenuItem:function(e,i){if(this.btnMore&&!e.cmpEl.is(":visible")){var o=t.indexOf(this.buttons,e),n=t.findWhere(this.btnMore.menu.items,{value:o});n&&n.setDisabled(i)}},setDisabledAllMoreMenuItems:function(t){this.btnMore&&this.btnMore.menu.items.length>0&&this.btnMore.menu.items.forEach((function(e){e.setDisabled(t)}))},setDisabledPluginButtons:function(t){var e=this;this.buttons.forEach((function(i){"plugin"===i.options.type&&(i.setDisabled(t),e.setDisabledMoreMenuItem(i,t))}))},isButtonInMoreMenu:function(e){return t.indexOf(this.buttons,e)>-1},getPluginButton:function(t){for(var e,i=0;i<this.buttons.length;i++)if(this.buttons[i].options.value===t){e=this.buttons[i];break}return[e,i]},openPlugin:function(t){var e=this.getPluginButton(t)[0];e&&(e.isDisabled()||e.pressed||(e.toggle(!0),this.fireEvent("button:click",[e])))},closePlugin:function(t){var e=this.getPluginButton(t),i=e[0],o=e[1];i.cmpEl.parent().remove(),this.buttons.splice(o,1),this.close&&this.close(),this.setMoreButton()},isPluginButtonPressed:function(){for(var t=!1,e=0;e<this.buttons.length;e++)if("plugin"===this.buttons[e].options.type&&this.buttons[e].pressed){t=!0;break}return t},toggleActivePluginButton:function(t){for(var e=0;e<this.buttons.length;e++)"plugin"===this.buttons[e].options.type&&this.buttons[e].pressed&&this.buttons[e].toggle(t,!0)},updatePluginButtonsIcons:function(e){var i=this;e.forEach((function(e){var o=i.getPluginButton(e.guid),n=o[0],s=o[1],a=t.findWhere(i.btnMore.menu.items,{value:s}),r=e.baseUrl+e.parsedIcons.normal;n.options.iconsSet||(n.options.iconImg=r,n.cmpEl.find("img").attr("src",r)),a&&!a.options.iconsSet&&a.cmpEl.find("img").attr("src",r)}))}})})),void 0===Common)var Common={};define("common/main/lib/component/MetricSpinner",["common/main/lib/component/BaseView"],(function(){"use strict";Common.UI.MetricSpinner=Common.UI.BaseView.extend({options:{minValue:0,maxValue:100,step:1,defaultUnit:"px",allowAuto:!1,autoText:"Auto",hold:!0,speed:"medium",width:90,allowDecimal:!0,allowBlank:!1,dataHint:"",dataHintDirection:"",dataHintOffset:""},disabled:!1,value:"0 px",rendered:!1,template:'<input type="text" class="form-control" spellcheck="false" role="spinbutton" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>"><div class="spinner-buttons"><button type="button" class="spinner-up"><i class="arrow"></i></button><button type="button" class="spinner-down"><i class="arrow"></i></button></div>',initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this,i=e.$el||$(this.el);i.addClass("spinner"),i.on("mousedown",".spinner-up",_.bind(this.onMouseDown,this,!0)),i.on("mousedown",".spinner-down",_.bind(this.onMouseDown,this,!1)),i.on("mouseup",".spinner-up",_.bind(this.onMouseUp,this,!0)),i.on("mouseup",".spinner-down",_.bind(this.onMouseUp,this,!1)),i.on("mouseover",".spinner-up, .spinner-down",_.bind(this.onMouseOver,this)),i.on("mouseout",".spinner-up, .spinner-down",_.bind(this.onMouseOut,this)),i.on("keydown",".form-control",_.bind(this.onKeyDown,this)),i.on("keyup",".form-control",_.bind(this.onKeyUp,this)),i.on("blur",".form-control",_.bind(this.onBlur,this)),i.on("input",".form-control",_.bind(this.onInput,this)),this.options.allowDecimal||i.on("keypress",".form-control",_.bind(this.onKeyPress,this)),i.on("focus","input.form-control",(function(t){setTimeout((function(){e.$input&&(e.$input[0].selectionStart=0,e.$input[0].selectionEnd=e.$input.val().length)}),1)})),Common.Utils.isGecko&&i.on("blur","input.form-control",(function(){setTimeout((function(){e.$input&&(e.$input[0].selectionStart=e.$input[0].selectionEnd=0)}),1)})),this.switches={count:1,enabled:!0,fromKeyDown:!1},"medium"===this.options.speed?this.switches.speed=300:"fast"===this.options.speed?this.switches.speed=100:this.switches.speed=500,this.render(),this.options.disabled&&this.setDisabled(this.options.disabled),this.options.allowBlank&&(this.allowBlank=this.options.allowBlank),void 0!==this.options.value&&(this.value=this.options.value),this.setRawValue(this.value),this.options.width&&i.width(this.options.width),void 0===this.options.defaultValue&&(this.options.defaultValue=this.options.minValue),this.oldValue=this.options.minValue,this.lastValue=null},render:function(){var t=this.$el||$(this.el),e=_.template(this.template);return t.html($(e({dataHint:this.options.dataHint,dataHintDirection:this.options.dataHintDirection,dataHintOffset:this.options.dataHintOffset}))),this.$input=t.find(".form-control"),this.rendered=!0,null!=this.options.tabindex&&this.$input.attr("tabindex",this.options.tabindex),this.$input.attr("aria-valuemin",this.options.minValue),this.$input.attr("aria-valuemax",this.options.maxValue),this.options.ariaLabel&&this.$input.attr("aria-label",this.options.ariaLabel),this},setDisabled:function(t){t=!!t;var e=this.$el||$(this.el);t!==this.disabled&&(e.find("button").toggleClass("disabled",t),e.toggleClass("disabled",t),t?this.$input.attr({disabled:t}):this.$input.removeAttr("disabled")),this.disabled=t},isDisabled:function(){return this.disabled},setDefaultUnit:function(t){if(this.options.defaultUnit!=t){var e=this.options.defaultUnit;this.options.defaultUnit=t,this.setMinValue(this._recalcUnits(this.options.minValue,e)),this.setMaxValue(this._recalcUnits(this.options.maxValue,e)),this.setValue(this._recalcUnits(this.getNumberValue(),e),!0)}},setMinValue:function(t){this.options.minValue=t,this.$input&&this.$input.attr("aria-valuemin",t)},setMaxValue:function(t){this.options.maxValue=t,this.$input&&this.$input.attr("aria-valuemax",t)},setStep:function(t){this.options.step=t},getMinValue:function(){return this.options.minValue},getMaxValue:function(){return this.options.maxValue},getNumberValue:function(){return this.checkAutoText(this.value)?-1:parseFloat(this.value)},getUnitValue:function(){return this.options.defaultUnit},getValue:function(){return this.value},setRawValue:function(t){this.$input&&(this.$input.val(t),this.$input.attr("aria-valuetext",t))},getRawValue:function(){return this.$input.val()},setValue:function(t,e){var i=!1;if(this._fromKeyDown=!1,this.lastValue=this.value,void 0===t||""===t)this.value="";else if(this.options.allowAuto&&(Math.abs(Common.Utils.String.parseFloat(t)+1)<1e-4||this.checkAutoText(t)))this.value=this.options.autoText;else{var o=this._add(Common.Utils.String.parseFloat(t),0,this.options.allowDecimal?3:0);(void 0===t||isNaN(o))&&(o=this.oldValue,i=!0);var n=this.options.defaultUnit;if(void 0!==t.match){var s=t.match(/(px|em|%|en|ex|pt|"|cm|mm|pc|s|ms|см|мм|пт|сек|мс)$/i);null!==s&&"undefined"!==s[0]&&(n=s[0].toLowerCase())}this.options.defaultUnit===n||i||(o=this._recalcUnits(o,n)),o>this.options.maxValue&&(o=this.options.maxValue,i=!0),o<this.options.minValue&&(o=this.options.minValue,i=!0),this.value=(o+" "+this.options.defaultUnit).trim(),this.oldValue=o}!0!==e&&this.lastValue!==this.value&&this.trigger("change",this,this.value,this.lastValue),!0!==e&&i&&this.trigger("inputerror",this,this.value),this.rendered?this.setRawValue(this.value):this.options.value=this.value},setMask:function(t){this.options.maskExp=t},onMouseDown:function(t,e){this.disabled||(e&&$(e.currentTarget).addClass("active"),this.options.hold&&(this.switches.fromKeyDown=!1,this._startSpin(t,e)))},onMouseUp:function(t,e){this.disabled||($(e.currentTarget).removeClass("active"),this.options.hold?this._stopSpin():this._step(t))},onMouseOver:function(t){this.disabled||$(t.currentTarget).addClass("over")},onMouseOut:function(t){this.disabled||($(t.currentTarget).removeClass("active over"),this.options.hold&&this._stopSpin())},onKeyDown:function(t){if(!this.disabled){if(!this.options.hold||t.keyCode!=Common.UI.Keys.UP&&t.keyCode!=Common.UI.Keys.DOWN)if(t.keyCode==Common.UI.Keys.RETURN)if(this.options.defaultUnit&&this.options.defaultUnit.length){var e=this.getRawValue();if(this.value!=e)return this.onEnterValue(),this.trigger("inputleave",this),this.value==e}else this.onEnterValue();else this._fromKeyDown=!0;else t.preventDefault(),t.stopPropagation(),void 0===this.switches.timeout&&(this.switches.fromKeyDown=!0,this._startSpin(t.keyCode==Common.UI.Keys.UP,t));t.keyCode==Common.UI.Keys.ESC&&this.setRawValue(this.value),t.keyCode!=Common.UI.Keys.RETURN&&t.keyCode!=Common.UI.Keys.ESC||this.trigger("inputleave",this)}},onKeyUp:function(t){this.disabled||t.keyCode!=Common.UI.Keys.UP&&t.keyCode!=Common.UI.Keys.DOWN||(t.stopPropagation(),t.preventDefault(),this.options.hold?this._stopSpin():this._step(t.keyCode==Common.UI.Keys.UP))},onKeyPress:function(t){if(!this.disabled){var e=String.fromCharCode(t.charCode);"."==e||","==e?(t.preventDefault(),t.stopPropagation()):!this.options.maskExp||this.options.maskExp.test(e)||t.ctrlKey||t.keyCode===Common.UI.Keys.RETURN||(t.preventDefault(),t.stopPropagation())}},onInput:function(t,e){this.disabled||t.isDefaultPrevented()||this.trigger("changing",this,$(t.target).val(),t)},onEnterValue:function(){if(this.$input){var t=this.getRawValue();this.setValue(""!==t||this.allowBlank?t:this.value),this.trigger("entervalue",this)}},onBlur:function(t){if(this.$input){var e=this.getRawValue();this.setValue(""!==e||this.allowBlank?e:this.value),this.options.hold&&this.switches.fromKeyDown&&this._stopSpin()}},_startSpin:function(t,e){if(!this.disabled){var i=this.switches.count;1===i?(this._step(t,!0),i=1):i=i<3?1.5:i<8?2.5:6,this.switches.timeout=setTimeout($.proxy((function(){this._step(t,!0),this._startSpin(t)}),this),this.switches.speed/i),this.switches.count++}},_stopSpin:function(t){void 0!==this.switches.timeout&&(clearTimeout(this.switches.timeout),this.switches.timeout=void 0,this.switches.count=1,this.trigger("change",this,this.value,this.lastValue))},_increase:function(t){var e=this;if(!e.readOnly){var i=e.options.step;e._fromKeyDown?(i=this.getRawValue(),i=_.isEmpty(i)?e.oldValue:Common.Utils.String.parseFloat(i)):""!==e.getValue()?(i=e.checkAutoText(e.getValue())?e.options.defaultValue-e.options.step:Common.Utils.String.parseFloat(e.getValue()),isNaN(i)&&(i=this.oldValue)):i=e.options.defaultValue-e.options.step,e.setValue((this._add(i,e.options.step,e.options.allowDecimal?3:0)+" "+this.options.defaultUnit).trim(),t)}},_decrease:function(t){var e=this;if(!e.readOnly){var i=e.options.step;if(e._fromKeyDown)i=this.getRawValue(),i=_.isEmpty(i)?e.oldValue:Common.Utils.String.parseFloat(i);else if(""!==e.getValue()){if(i=e.checkAutoText(e.getValue())?e.options.minValue:Common.Utils.String.parseFloat(e.getValue()),isNaN(i)&&(i=this.oldValue),e.options.allowAuto&&this._add(i,-e.options.step,e.options.allowDecimal?3:0)<e.options.minValue)return void e.setValue(e.options.autoText,!0)}else i=e.options.defaultValue;e.setValue((this._add(i,-e.options.step,e.options.allowDecimal?3:0)+" "+this.options.defaultUnit).trim(),t)}},_step:function(t,e){t?this._increase(e):this._decrease(e),this.options.hold&&this.switches.fromKeyDown&&this.$input&&this.$input.select()},_add:function(t,e,i){var o=Math.pow(10,i||this.options.allowDecimal?2:0);return(Math.round(t*o)+Math.round(e*o))/o},_recalcUnits:function(t,e){if(e.match(/(s|ms|сек|мс)$/i)&&this.options.defaultUnit.match(/(s|ms|сек|мс)$/i)){var i=t;return"ms"!=e&&"мс"!=e||(i=parseFloat((i/1e3).toFixed(6))),"ms"!=this.options.defaultUnit&&"мс"!=this.options.defaultUnit||(i=parseFloat((1e3*i).toFixed(6))),i}var o=new RegExp('(pt|"|cm|mm|pc|см|мм|пт|'+Common.Utils.Metric.txtPt+"|"+Common.Utils.Metric.txtCm+")$","i");if(null===e.match(o)||null===this.options.defaultUnit.match(o))return t;i=t;return"cm"==e||"см"==e||e==Common.Utils.Metric.txtCm?i*=10:"pt"==e||"пт"==e||e==Common.Utils.Metric.txtPt?i=25.4*i/72:'"'==e?i*=25.4:"pc"==e&&(i=25.4*i/6),"cm"==this.options.defaultUnit||"см"==this.options.defaultUnit||this.options.defaultUnit==Common.Utils.Metric.txtCm?i=parseFloat((i/10).toFixed(6)):"pt"==this.options.defaultUnit||"пт"==this.options.defaultUnit||this.options.defaultUnit==Common.Utils.Metric.txtPt?i=parseFloat((72*i/25.4).toFixed(3)):'"'==this.options.defaultUnit?i=parseFloat((i/25.4).toFixed(3)):"pc"==this.options.defaultUnit&&(i=parseFloat((6*i/25.4).toFixed(6))),i},focus:function(){this.$input&&this.$input.focus()},setDefaultValue:function(t){this.options.defaultValue=t},checkAutoText:function(t){if(this.options.allowAuto&&"string"==typeof t){var e=t.toLowerCase();return e==this.options.autoText.toLowerCase()||"auto"==e}return!1}}),Common.UI.CustomSpinner=Common.UI.MetricSpinner.extend(_.extend({initialize:function(t){this.options.toCustomFormat=t.toCustomFormat?t.toCustomFormat:function(t){return t},this.options.fromCustomFormat=t.fromCustomFormat?t.fromCustomFormat:function(t){return t},Common.UI.MetricSpinner.prototype.initialize.call(this,t)},setRawValue:function(t){this.$input&&this.$input.val(this.options.toCustomFormat(t))},getRawValue:function(){return this.options.fromCustomFormat(this.$input.val())}},Common.UI.CustomSpinner||{}))})),define("text!spreadsheeteditor/main/app/template/ParagraphSettings.template",[],(function(){return'<table cols="2" role="presentation" role="presentation">\r\n    <tr>\r\n        <td colspan=2>\r\n            <label class="header"><%= scope.strLineHeight %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="50%">\r\n            <div id="paragraph-combo-line-rule" style="width: 85px;"></div>\r\n        </td>\r\n        <td class="padding-small" width="50%">\r\n            <div id="paragraph-spin-line-height"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2>\r\n            <label class="header"><%= scope.strParagraphSpacing %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="50%">\r\n            <label class="input-label"><%= scope.strSpacingBefore %></label>\r\n            <div id="paragraph-spin-spacing-before"></div>\r\n        </td>\r\n        <td class="padding-small" width="50%">\r\n            <label class="input-label"><%= scope.strSpacingAfter %></label>\r\n            <div id="paragraph-spin-spacing-after"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td align="center" colspan=2>\r\n            <label class="link canfocused" id="paragraph-advanced-link" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.textAdvanced %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'}));var c_paragraphLinerule={LINERULE_LEAST:0,LINERULE_AUTO:1,LINERULE_EXACT:2};if(define("spreadsheeteditor/main/app/view/ParagraphSettings",["text!spreadsheeteditor/main/app/template/ParagraphSettings.template","jquery","underscore","backbone","common/main/lib/component/ComboBox","common/main/lib/component/MetricSpinner"],(function(t,e,i,o){"use strict";SSE.Views.ParagraphSettings=o.View.extend(i.extend({el:"#id-paragraph-settings",template:i.template(t),events:{},options:{alias:"ParagraphSettings"},initialize:function(){this._initSettings=!0,this._state={LineRule:c_paragraphLinerule.LINERULE_AUTO,LineHeight:1.5,LineSpacingBefore:0,LineSpacingAfter:.35,DisabledControls:!1},this.spinners=[],this.lockedControls=[],this._locked=!1,this.render()},render:function(){e(this.el).html(this.template({scope:this})),this.linkAdvanced=e("#paragraph-advanced-link")},setApi:function(t){return this.api=t,this.api&&this.api.asc_registerCallback("asc_onParaSpacingLine",i.bind(this._onLineSpacing,this)),this},onNumLineHeightChange:function(t,e,i,o){""!==this.cmbLineRule.getRawValue()&&this.api&&this.api.asc_putPrLineSpacing(this.cmbLineRule.getValue(),this.cmbLineRule.getValue()==c_paragraphLinerule.LINERULE_AUTO?t.getNumberValue():Common.Utils.Metric.fnRecalcToMM(t.getNumberValue()))},onNumSpacingBeforeChange:function(t,e,i,o){this.api&&(t.getNumberValue()<0?this.api.asc_putLineSpacingBeforeAfter(0,-1):this.api.asc_putLineSpacingBeforeAfter(0,Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},onNumSpacingAfterChange:function(t,e,i,o){this.api&&(t.getNumberValue()<0?this.api.asc_putLineSpacingBeforeAfter(1,-1):this.api.asc_putLineSpacingBeforeAfter(1,Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())))},onLineRuleSelect:function(t,e){this.api&&this.api.asc_putPrLineSpacing(e.value,e.defaultValue),this.numLineHeight.setDefaultUnit(e.defaultUnit),this.numLineHeight.setMinValue(e.minValue),this.numLineHeight.setStep(e.step),Common.NotificationCenter.trigger("edit:complete",this)},_onLineSpacing:function(t){if(!this._initSettings){var e=t.asc_getLineRule(),i=t.asc_getLine();if(this._state.LineRule!==e){var o,n=this.cmbLineRule.store.findWhere(((o={}).value=e,o));n||(n=this.cmbLineRule.store.at(0)),this.cmbLineRule.setValue(null!==e?e:""),this.numLineHeight.setMinValue(n.get("minValue")),this.numLineHeight.setDefaultUnit(n.get("defaultUnit")),this.numLineHeight.setStep(n.get("step")),this._state.LineRule=e}if(Math.abs(this._state.LineHeight-i)>.001||(null===this._state.LineHeight||null===i)&&this._state.LineHeight!==i){var s="";e==c_paragraphLinerule.LINERULE_AUTO?s=i:null!==e&&null!==i&&(s=Common.Utils.Metric.fnRecalcFromMM(i)),this.numLineHeight.setValue(null!==s?s:"",!0),this._state.LineHeight=i}}},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),this.disableControls(this._locked),t){var e={Line:t.asc_getSpacing().asc_getLine(),Before:t.asc_getSpacing().asc_getBefore(),After:t.asc_getSpacing().asc_getAfter(),LineRule:t.asc_getSpacing().asc_getLineRule()};if(this._state.LineRule!==e.LineRule){var i,o=this.cmbLineRule.store.findWhere(((i={}).value=e.LineRule,i));o||(o=this.cmbLineRule.store.at(0)),this.cmbLineRule.setValue(null!==e.LineRule?e.LineRule:""),this.numLineHeight.setMinValue(o.get("minValue")),this.numLineHeight.setDefaultUnit(o.get("defaultUnit")),this.numLineHeight.setStep(o.get("step")),this._state.LineRule=e.LineRule}if(Math.abs(this._state.LineHeight-e.Line)>.001||(null===this._state.LineHeight||null===e.Line)&&this._state.LineHeight!==e.Line){var n="";e.LineRule==c_paragraphLinerule.LINERULE_AUTO?n=e.Line:null!==e.LineRule&&null!==e.Line&&(n=Common.Utils.Metric.fnRecalcFromMM(e.Line)),this.numLineHeight.setValue(null!==n?n:"",!0),this._state.LineHeight=e.Line}(Math.abs(this._state.LineSpacingBefore-e.Before)>.001||(null===this._state.LineSpacingBefore||null===e.Before)&&this._state.LineSpacingBefore!==e.Before)&&(this.numSpacingBefore.setValue(null!==e.Before?e.Before<0?e.Before:Common.Utils.Metric.fnRecalcFromMM(e.Before):"",!0),this._state.LineSpacingBefore=e.Before),(Math.abs(this._state.LineSpacingAfter-e.After)>.001||(null===this._state.LineSpacingAfter||null===e.After)&&this._state.LineSpacingAfter!==e.After)&&(this.numSpacingAfter.setValue(null!==e.After?e.After<0?e.After:Common.Utils.Metric.fnRecalcFromMM(e.After):"",!0),this._state.LineSpacingAfter=e.After)}},updateMetricUnit:function(){if(this.spinners){for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.01)}var i=this._state.LineSpacingBefore;this.numSpacingBefore&&this.numSpacingBefore.setValue(null!==i?i<0?i:Common.Utils.Metric.fnRecalcFromMM(i):"",!0),i=this._state.LineSpacingAfter,this.numSpacingAfter&&this.numSpacingAfter.setValue(null!==i?i<0?i:Common.Utils.Metric.fnRecalcFromMM(i):"",!0)}if(this.cmbLineRule){var o=this.cmbLineRule.store.at(1);if(o.set({defaultUnit:Common.Utils.Metric.getCurrentMetricName(),minValue:parseFloat(Common.Utils.Metric.fnRecalcFromMM(.3).toFixed(2)),step:Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.01}),null!==this._state.LineRule){var n;(o=this.cmbLineRule.store.findWhere(((n={}).value=this._state.LineRule,n)))||(o=this.cmbLineRule.store.at(0)),this.numLineHeight.setDefaultUnit(o.get("defaultUnit")),this.numLineHeight.setStep(o.get("step"));i="";this._state.LineRule==c_paragraphLinerule.LINERULE_AUTO?i=this._state.LineHeight:null!==this._state.LineHeight&&(i=Common.Utils.Metric.fnRecalcFromMM(this._state.LineHeight)),this.numLineHeight&&this.numLineHeight.setValue(null!==i?i:"",!0)}}},createDelayedControls:function(){var t=this;this._arrLineRule=[{displayValue:this.textAuto,defaultValue:1,value:c_paragraphLinerule.LINERULE_AUTO,minValue:.5,step:.01,defaultUnit:""},{displayValue:this.textExact,defaultValue:5,value:c_paragraphLinerule.LINERULE_EXACT,minValue:.03,step:.01,defaultUnit:"cm"}],this.cmbLineRule=new Common.UI.ComboBox({el:e("#paragraph-combo-line-rule"),cls:"input-group-nr",menuStyle:"min-width: 85px;",editable:!1,data:this._arrLineRule,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strLineHeight}),this.cmbLineRule.setValue(c_paragraphLinerule.LINERULE_AUTO),this.lockedControls.push(this.cmbLineRule),this.numLineHeight=new Common.UI.MetricSpinner({el:e("#paragraph-spin-line-height"),step:.01,width:85,value:"1.5",defaultUnit:"",maxValue:132,minValue:.5,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strLineHeight}),this.lockedControls.push(this.numLineHeight),this.numSpacingBefore=new Common.UI.MetricSpinner({el:e("#paragraph-spin-spacing-before"),step:.1,width:85,value:"0 cm",defaultUnit:"cm",maxValue:55.88,minValue:0,allowAuto:!0,autoText:this.txtAutoText,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strParagraphSpacing+" "+this.strSpacingBefore}),this.spinners.push(this.numSpacingBefore),this.lockedControls.push(this.numSpacingBefore),this.numSpacingAfter=new Common.UI.MetricSpinner({el:e("#paragraph-spin-spacing-after"),step:.1,width:85,value:"0.35 cm",defaultUnit:"cm",maxValue:55.88,minValue:0,allowAuto:!0,autoText:this.txtAutoText,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strParagraphSpacing+" "+this.strSpacingAfter}),this.spinners.push(this.numSpacingAfter),this.lockedControls.push(this.numSpacingAfter),this.numLineHeight.on("change",i.bind(this.onNumLineHeightChange,this)),this.numSpacingBefore.on("change",i.bind(this.onNumSpacingBeforeChange,this)),this.numSpacingAfter.on("change",i.bind(this.onNumSpacingAfterChange,this)),this.numLineHeight.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.numSpacingBefore.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.numSpacingAfter.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.cmbLineRule.on("selected",i.bind(this.onLineRuleSelect,this)),this.cmbLineRule.on("hide:after",i.bind(this.onHideMenus,this)),e(this.el).on("click","#paragraph-advanced-link",i.bind(this.openAdvancedSettings,this))},createDelayedElements:function(){this.createDelayedControls(),this.updateMetricUnit(),this._initSettings=!1},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;if(e.api&&!this._locked){var i=e.api.asc_getGraphicObjectProps();if(i&&i.length>0)for(var o,n,s=i.length-1;s>=0;s--)if(o=i[s].asc_getObjectType(),n=i[s].asc_getObjectValue(),Asc.c_oAscTypeSelectElement.Paragraph==o){new SSE.Views.ParagraphSettingsAdvanced({paragraphProps:n,api:e.api,handler:function(t,i){"ok"==t&&e.api&&(e.borderAdvancedProps=i.borderProps,e.api.asc_setGraphicObjectProps(i.paragraphProps)),Common.NotificationCenter.trigger("edit:complete",e)}}).show();break}}}},onHideMenus:function(t,e,i){i||Common.NotificationCenter.trigger("edit:complete",this)},setLocked:function(t){this._locked=t},disableControls:function(t){this._initSettings||this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.linkAdvanced.toggleClass("disabled",t))},strParagraphSpacing:"Paragraph Spacing",strLineHeight:"Line Spacing",strSpacingBefore:"Before",strSpacingAfter:"After",textAuto:"Multiple",textAtLeast:"At least",textExact:"Exactly",textAdvanced:"Show advanced settings",textAt:"At",txtAutoText:"Auto"},SSE.Views.ParagraphSettings||{}))})),define("text!spreadsheeteditor/main/app/template/ImageSettings.template",[],(function(){return'<table cols="3" role="presentation">\r\n    <tr>\r\n        <td colspan=3>\r\n            <label class="header"><%= scope.textSize %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="88px">\r\n            <label class="input-label"><%= scope.textWidth %></label>\r\n            <div id="image-spin-width"></div>\r\n        </td>\r\n        <td class="padding-small" width="28px" style="vertical-align: bottom;">\r\n            <div id="image-button-ratio"></div>\r\n        </td>\r\n        <td class="padding-small" width="88px">\r\n            <label class="input-label"><%= scope.textHeight %></label>\r\n            <div id="image-spin-height"></div>\r\n        </td>\r\n    </tr>\r\n</table>\r\n<table cols="2" role="presentation">\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <button type="button" class="btn btn-text-default" id="image-button-original-size" style="min-width:100px;width: auto;" data-hint="1" data-hint-direction="bottom" data-hint-offset="big"><%= scope.textOriginalSize %></button>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div id="image-button-crop" style="min-width:100px;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div id="image-button-reset-crop"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div id="image-panel-transparent-fill" style="width: 100%;">\r\n                <label class="header" style="display:block;"><%= scope.strTransparency %></label>\r\n                <div style="display: inline-block; margin-top: 3px;">\r\n                    <label id="image-lbl-transparency-start">0</label>\r\n                    <div id="image-slider-transparency" style="display: inline-block;margin: 0 4px; vertical-align: middle;"></div>\r\n                    <label id="image-lbl-transparency-end">100</label>\r\n                </div>\r\n                <div id="image-spin-transparency" class="float-right"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2 class="padding-small">\r\n            <label class="header"><%= scope.textRotation %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="50%">\r\n            <label class="input-label"><%= scope.textRotate90 %></label>\r\n            <div>\r\n                <div id="image-button-270" class="margin-right-4"></div>\r\n                <div id="image-button-90"></div>\r\n            </div>\r\n        </td>\r\n        <td class="padding-small" width="50%">\r\n            <label class="input-label"><%= scope.textFlip %></label>\r\n            <div>\r\n                <div id="image-button-fliph" class="margin-right-4"></div>\r\n                <div id="image-button-flipv"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td colspan=2>\r\n            <div id="image-button-replace" style="width:100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <button type="button" class="btn btn-text-default hidden" id="image-button-edit-object" style="width:100%;"><%= scope.textEditObject %></button>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td align="center" colspan=2>\r\n            <label class="link canfocused" id="image-advanced-link" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.textAdvanced %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'})),define("spreadsheeteditor/main/app/view/ImageSettings",["text!spreadsheeteditor/main/app/template/ImageSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/MetricSpinner"],(function(t,e,i,o){"use strict";SSE.Views.ImageSettings=o.View.extend(i.extend({el:"#id-image-settings",template:i.template(t),events:{},options:{alias:"ImageSettings"},initialize:function(){this._initSettings=!0,this._nRatio=1,this._state={Width:0,Height:0,DisabledControls:!1,keepRatio:!1,isOleObject:!1,cropMode:!1},this.spinners=[],this.lockedControls=[],this._locked=!1,this._noApply=!1,this._originalProps=null,this.render()},render:function(){var t=e(this.el);t.html(this.template({scope:this})),this.linkAdvanced=e("#image-advanced-link"),this.ResetCrop=t.find("#image-button-reset-crop").closest("tr")},setApi:function(t){if(null!=t)return this.api=t,this.api&&this.api.asc_registerCallback("asc_ChangeCropState",i.bind(this._changeCropState,this)),Common.NotificationCenter.on("storage:image-insert",i.bind(this.insertImageFromStorage,this)),this},setMode:function(t){this.mode=t},updateMetricUnit:function(){if(this.spinners){for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}this.spnWidth&&this.spnWidth.setValue(null!==this._state.Width?Common.Utils.Metric.fnRecalcFromMM(this._state.Width):"",!0),this.spnHeight&&this.spnHeight.setValue(null!==this._state.Height?Common.Utils.Metric.fnRecalcFromMM(this._state.Height):"",!0)}},createDelayedControls:function(){var t=this;this.spnWidth=new Common.UI.MetricSpinner({el:e("#image-spin-width"),step:.1,width:78,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textWidth}),this.spinners.push(this.spnWidth),this.lockedControls.push(this.spnWidth),this.spnHeight=new Common.UI.MetricSpinner({el:e("#image-spin-height"),step:.1,width:78,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textHeight}),this.spinners.push(this.spnHeight),this.lockedControls.push(this.spnHeight),this.btnRatio=new Common.UI.Button({parentEl:e("#image-button-ratio"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-advanced-ratio",style:"margin-bottom: 1px;",enableToggle:!0,hint:this.textKeepRatio,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.btnRatio),this.btnRatio.on("click",i.bind((function(t,e){if(t.pressed&&this.spnHeight.getNumberValue()>0&&(this._nRatio=this.spnWidth.getNumberValue()/this.spnHeight.getNumberValue()),this.api){var i=new Asc.asc_CImgProperty;i.asc_putLockAspect(t.pressed),this.api.asc_setGraphicObjectProps(i)}}),this)),this.btnOriginalSize=new Common.UI.Button({el:e("#image-button-original-size")}),this.lockedControls.push(this.btnOriginalSize),this.btnSelectImage=new Common.UI.Button({parentEl:e("#image-button-replace"),cls:"btn-text-menu-default",caption:this.textInsert,style:"width:100%;",menu:new Common.UI.Menu({style:"min-width: 194px;",maxHeight:200,items:[{caption:this.textFromFile,value:0},{caption:this.textFromUrl,value:1},{caption:this.textFromStorage,value:2}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.btnSelectImage),this.btnSelectImage.menu.on("item:click",i.bind(this.onImageSelect,this)),this.btnSelectImage.menu.items[2].setVisible(this.mode.canRequestInsertImage||this.mode.fileChoiceUrl&&this.mode.fileChoiceUrl.indexOf("{documentType}")>-1),this.btnEditObject=new Common.UI.Button({el:e("#image-button-edit-object")}),this.lockedControls.push(this.btnEditObject),this.spnWidth.on("change",i.bind(this.onWidthChange,this)),this.spnHeight.on("change",i.bind(this.onHeightChange,this)),this.spnWidth.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnHeight.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.btnOriginalSize.on("click",i.bind(this.setOriginalSize,this)),this.btnEditObject.on("click",i.bind((function(t){if(Common.Controllers.LaunchController.isScriptLoaded()){if(this.api){var e=this.api.asc_canEditTableOleObject(!0);if(e){var i=SSE.getController("Common.Controllers.ExternalOleEditor").getView("Common.Views.ExternalOleEditor");i&&(i.setEditMode(!0),i.show(),i.setOleData(Asc.asc_putBinaryDataToFrameFromTableOleObject(e)))}else this.api.asc_startEditCurrentOleObject()}Common.NotificationCenter.trigger("edit:complete",this)}}),this));var o=this.btnOriginalSize.cmpEl.outerWidth();this.btnCrop=new Common.UI.Button({parentEl:e("#image-button-crop"),cls:"btn-text-split-default",caption:this.textCrop,split:!0,enableToggle:!0,allowDepress:!0,pressed:this._state.cropMode,width:o,menu:new Common.UI.Menu({style:"min-width:"+o+"px;",items:[{caption:this.textCrop,checkable:!0,allowDepress:!0,checked:this._state.cropMode,value:0},{caption:this.textCropToShape,menu:new Common.UI.Menu({menuAlign:"tl-tl",cls:"menu-shapes menu-change-shape",items:[]})},{caption:this.textCropFill,value:1},{caption:this.textCropFit,value:2}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textCrop}),this.btnCrop.on("click",i.bind(this.onCrop,this)),this.btnCrop.menu.on("item:click",i.bind(this.onCropMenu,this)),this.lockedControls.push(this.btnCrop),this.btnChangeShape=this.btnCrop.menu.items[1],this.btnResetCrop=new Common.UI.Button({parentEl:e("#image-button-reset-crop"),cls:"btn-toolbar align-left",caption:this.textResetCrop,iconCls:"toolbar__icon btn-reset",style:"min-width:100px",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textResetCrop}),this.btnResetCrop.on("click",i.bind(this.onResetCrop,this)),this.lockedControls.push(this.btnResetCrop),this.numTransparency=new Common.UI.MetricSpinner({el:e("#image-spin-transparency"),step:1,width:62,value:"100 %",defaultUnit:"%",maxValue:100,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strTransparency}),this.numTransparency.on("change",i.bind(this.onNumTransparencyChange,this)),this.numTransparency.on("inputleave",(function(){this.fireEvent("editcomplete",this)})),this.lockedControls.push(this.numTransparency),this.sldrTransparency=new Common.UI.SingleSlider({el:e("#image-slider-transparency"),width:75,minValue:0,maxValue:100,value:100}),this.sldrTransparency.on("change",i.bind(this.onTransparencyChange,this)),this.sldrTransparency.on("changecomplete",i.bind(this.onTransparencyChangeComplete,this)),this.lockedControls.push(this.sldrTransparency),this.lblTransparencyStart=e(this.el).find("#image-lbl-transparency-start"),this.lblTransparencyEnd=e(this.el).find("#image-lbl-transparency-end"),this.btnRotate270=new Common.UI.Button({parentEl:e("#image-button-270",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-270",value:0,hint:this.textHint270,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.btnRotate270.on("click",i.bind(this.onBtnRotateClick,this)),this.lockedControls.push(this.btnRotate270),this.btnRotate90=new Common.UI.Button({parentEl:e("#image-button-90",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-90",value:1,hint:this.textHint90,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.btnRotate90.on("click",i.bind(this.onBtnRotateClick,this)),this.lockedControls.push(this.btnRotate90),this.btnFlipV=new Common.UI.Button({parentEl:e("#image-button-flipv",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-flip-vert",value:0,hint:this.textHintFlipV,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.btnFlipV.on("click",i.bind(this.onBtnFlipClick,this)),this.lockedControls.push(this.btnFlipV),this.btnFlipH=new Common.UI.Button({parentEl:e("#image-button-fliph",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-flip-hor",value:1,hint:this.textHintFlipH,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.btnFlipH.on("click",i.bind(this.onBtnFlipClick,this)),this.lockedControls.push(this.btnFlipH),e(this.el).on("click","#image-advanced-link",i.bind(this.openAdvancedSettings,this))},createDelayedElements:function(){this.createDelayedControls(),this.updateMetricUnit(),this.onApiAutoShapes(),this._initSettings=!1},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;if(e.api&&!this._locked){var i=e.api.asc_getGraphicObjectProps();if(i&&i.length>0)for(var o,n,s=i.length-1;s>=0;s--)if(o=i[s].asc_getObjectType(),n=i[s].asc_getObjectValue(),Asc.c_oAscTypeSelectElement.Image==o){new SSE.Views.ImageSettingsAdvanced({imageProps:n,api:e.api,handler:function(t,i){"ok"==t&&e.api&&e.api.asc_setGraphicObjectProps(i.imageProps),Common.NotificationCenter.trigger("edit:complete",e)}}).show();break}}}},onApiAutoShapes:function(){var t=this,e=function(i){t.fillAutoShapes(),i.off("show:before",e)};t.btnChangeShape.menu.on("show:before",e)},fillAutoShapes:function(){var t=this,o=Common.localStorage.getItem("sse-recent-shapes"),n=new Common.UI.MenuItem({template:i.template('<div id="id-img-change-shape-menu" class="menu-insertshape"></div>'),index:0});t.btnChangeShape.menu.addItem(n),new Common.UI.DataViewShape({el:e("#id-img-change-shape-menu"),itemTemplate:i.template('<div class="item-shape" id="<%= id %>"><svg width="20" height="20" class="icon uni-scale"><use xlink:href="#svg-icon-<%= data.shapeType %>"></use></svg></div>'),groups:t.application.getCollection("ShapeGroups"),parentMenu:t.btnChangeShape.menu,restoreHeight:652,textRecentlyUsed:t.textRecentlyUsed,recentShapes:o?JSON.parse(o):null,hideTextRect:!0,hideLines:!0}).on("item:click",(function(e,i,o,n){t.api&&(t.api.asc_changeShapeType(o.get("data").shapeType),Common.NotificationCenter.trigger("edit:complete",t)),"click"!==n.type&&t.btnCrop.menu.hide()}))},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),this.disableControls(this._locked),t){this._originalProps=new Asc.asc_CImgProperty(t);var e=t.asc_getWidth();(Math.abs(this._state.Width-e)>.001||(null===this._state.Width||null===e)&&this._state.Width!==e)&&(this.spnWidth.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.Width=e),e=t.asc_getHeight(),(Math.abs(this._state.Height-e)>.001||(null===this._state.Height||null===e)&&this._state.Height!==e)&&(this.spnHeight.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.Height=e),t.asc_getHeight()>0&&(this._nRatio=t.asc_getWidth()/t.asc_getHeight()),e=t.asc_getLockAspect(),this._state.keepRatio!==e&&(this.btnRatio.toggle(e),this._state.keepRatio=e),this.ResetCrop.toggleClass("hidden",!t.asc_getIsCrop()),this.btnResetCrop.setDisabled(!t.asc_getIsCrop()||this._locked),this.btnOriginalSize.setDisabled(null===t.asc_getImageUrl()||void 0===t.asc_getImageUrl()||this._locked);var i=t.asc_getPluginGuid();if(e=null!=i,this._state.isOleObject!==e&&(this.btnSelectImage.setVisible(!e),this.btnEditObject.setVisible(e),this._state.isOleObject=e),this.btnRotate270.setDisabled(e||this._locked),this.btnRotate90.setDisabled(e||this._locked),this.btnFlipV.setDisabled(e||this._locked),this.btnFlipH.setDisabled(e||this._locked),this.numTransparency.setDisabled(e||this._locked),this.sldrTransparency.setDisabled(e||this._locked),this._state.isOleObject){var o=SSE.getCollection("Common.Collections.Plugins").findWhere({guid:i});this.btnEditObject.setDisabled(!this.api.asc_canEditTableOleObject()&&null==o||this._locked)}else this.btnSelectImage.setDisabled(null===i||this._locked);var n=t.asc_getTransparent();(Math.abs(this._state.Transparency-n)>.001||Math.abs(this.numTransparency.getNumberValue()-n)>.001||(null===this._state.Transparency||null===n)&&(this._state.Transparency!==n||this.numTransparency.getNumberValue()!==n))&&(void 0!==n&&(this.sldrTransparency.setValue(null===n?100:n/255*100,!0),this.numTransparency.setValue(this.sldrTransparency.getValue(),!0)),this._state.Transparency=n)}},onWidthChange:function(t,e,i,o){var n=t.getNumberValue(),s=this.spnHeight.getNumberValue();if(this.btnRatio.pressed&&((s=n/this._nRatio)>this.spnHeight.options.maxValue&&(n=(s=this.spnHeight.options.maxValue)*this._nRatio,this.spnWidth.setValue(n,!0)),this.spnHeight.setValue(s,!0)),this.api){var a=new Asc.asc_CImgProperty;a.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(n)),a.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(s)),this.api.asc_setGraphicObjectProps(a)}},onHeightChange:function(t,e,i,o){var n=t.getNumberValue(),s=this.spnWidth.getNumberValue();if(this.btnRatio.pressed&&((s=n*this._nRatio)>this.spnWidth.options.maxValue&&(n=(s=this.spnWidth.options.maxValue)/this._nRatio,this.spnHeight.setValue(n,!0)),this.spnWidth.setValue(s,!0)),this.api){var a=new Asc.asc_CImgProperty;a.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(s)),a.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(n)),this.api.asc_setGraphicObjectProps(a)}},setOriginalSize:function(){if(this.api){var t=this.api.asc_getCropOriginalImageSize(),e=t.asc_getImageWidth(),i=t.asc_getImageHeight(),o=new Asc.asc_CImgProperty;o.asc_putWidth(e),o.asc_putHeight(i),o.put_Rot(0),this.api.asc_setGraphicObjectProps(o),Common.NotificationCenter.trigger("edit:complete",this)}},setImageUrl:function(t,e){var i=new Asc.asc_CImgProperty;i.asc_putImageUrl(t,e),this.api.asc_setGraphicObjectProps(i)},insertImageFromStorage:function(t){t&&t._urls&&"change"==t.c&&this.setImageUrl(t._urls[0],t.token)},onImageSelect:function(t,e){if(1==e.value){var o=this;new Common.Views.ImageFromUrlDialog({handler:function(t,e){if("ok"==t&&o.api){var n=e.replace(/ /g,"");i.isEmpty(n)||o.setImageUrl(n)}Common.NotificationCenter.trigger("edit:complete",o)}}).show()}else if(2==e.value)Common.NotificationCenter.trigger("storage:image-load","change");else{if(this._isFromFile)return;this._isFromFile=!0,this.api&&this.api.asc_changeImageFromFile(),Common.NotificationCenter.trigger("edit:complete",this),this._isFromFile=!1}},_changeCropState:function(t){this._state.cropMode=t,this.btnCrop&&(this.btnCrop.toggle(t,!0),this.btnCrop.menu.items[0].setChecked(t,!0))},onCrop:function(t,e){this.api&&(t.pressed?this.api.asc_startEditCrop():this.api.asc_endEditCrop()),Common.NotificationCenter.trigger("edit:complete",this)},onCropMenu:function(t,e){this.api&&(1==e.value?this.api.asc_cropFill():2==e.value?this.api.asc_cropFit():e.checked?this.api.asc_startEditCrop():this.api.asc_endEditCrop()),Common.NotificationCenter.trigger("edit:complete",this)},onBtnRotateClick:function(t){var e=new Asc.asc_CImgProperty;e.asc_putRotAdd(3.14159265358979*(1==t.options.value?90:270)/180),this.api.asc_setGraphicObjectProps(e),Common.NotificationCenter.trigger("edit:complete",this)},onBtnFlipClick:function(t){var e=new Asc.asc_CImgProperty;1==t.options.value?e.asc_putFlipHInvert(!0):e.asc_putFlipVInvert(!0),this.api.asc_setGraphicObjectProps(e),Common.NotificationCenter.trigger("edit:complete",this)},onResetCrop:function(){if(this.api){var t=new Asc.asc_CImgProperty;t.put_ResetCrop(!0),this.api.asc_setGraphicObjectProps(t),Common.NotificationCenter.trigger("edit:complete",this)}},onNumTransparencyChange:function(t,e,i,o){if(this.sldrTransparency.setValue(t.getNumberValue(),!0),this.api){var n=t.getNumberValue(),s=new Asc.asc_CImgProperty;s.asc_putTransparent(2.55*n),this.api.asc_setGraphicObjectProps(s)}},onTransparencyChange:function(t,e,o){this._sliderChanged=e,this.numTransparency.setValue(e,!0),this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(i.bind(this._transparencyApplyFunc,this),100))},onTransparencyChangeComplete:function(t,e,i){clearInterval(this.updateslider),this._sliderChanged=e,this._sendUndoPoint||(this.api.setEndPointHistory(),this._transparencyApplyFunc()),this._sendUndoPoint=!0},_transparencyApplyFunc:function(){if(void 0!==this._sliderChanged){var t=new Asc.asc_CImgProperty;t.asc_putTransparent(2.55*this._sliderChanged),this.api.asc_setGraphicObjectProps(t),this._sliderChanged=void 0}},setLocked:function(t){this._locked=t},disableControls:function(t){this._initSettings||(this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.linkAdvanced.toggleClass("disabled",t)),this.btnCrop.setDisabled(t||!this.api.asc_canEditCrop()))},textKeepRatio:"Constant Proportions",textSize:"Size",textWidth:"Width",textHeight:"Height",textOriginalSize:"Actual Size",textInsert:"Replace Image",textFromUrl:"From URL",textFromFile:"From File",textEditObject:"Edit Object",textEdit:"Edit",textAdvanced:"Show advanced settings",textRotation:"Rotation",textRotate90:"Rotate 90°",textFlip:"Flip",textHint270:"Rotate 90° Counterclockwise",textHint90:"Rotate 90° Clockwise",textHintFlipV:"Flip Vertically",textHintFlipH:"Flip Horizontally",textCrop:"Crop",textCropFill:"Fill",textCropFit:"Fit",textCropToShape:"Crop to shape",textFromStorage:"From Storage",textRecentlyUsed:"Recently Used"},SSE.Views.ImageSettings||{}))})),define("text!spreadsheeteditor/main/app/template/ChartSettings.template",[],(function(){return'<table cols="3" id="chart-panel-size" role="presentation">\r\n    <tr>\r\n        <td colspan=3>\r\n            <label class="header"><%= scope.textSize %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small" width="88px">\r\n            <label class="input-label"><%= scope.textWidth %></label>\r\n            <div id="chart-spin-width"></div>\r\n        </td>\r\n        <td class="padding-small" width="28px" style="vertical-align: bottom;">\r\n            <div id="chart-button-ratio"></div>\r\n        </td>\r\n        <td class="padding-small" width="88px">\r\n            <label class="input-label"><%= scope.textHeight %></label>\r\n            <div id="chart-spin-height"></div>\r\n        </td>\r\n    </tr>\r\n</table>\r\n<table cols="1" id="chart-panel-types" role="presentation">\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="not-combined">\r\n        <td class="padding-large">\r\n            <label class="header" style=""><%= scope.textStyle %></label>\r\n            <div class="" id="chart-combo-style" style="width: 100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="chart-btn-change-type" style="width:100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="chart-btn-select-data" style="width:100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="chart-btn-switch" style="width:100%;"></div>\r\n        </td>\r\n    </tr>\r\n</table>\r\n<table cols="1" id="chart-panel-3d-rotate" role="presentation">\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <label class="header"><%= scope.text3dRotation %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <label class="fixed" style="margin-top: 3px;width: 88px;"><%= scope.textX %></label>\r\n            <div id="chart-btn-x-right" style="display: inline-block;" class="float-right margin-left-4"></div>\r\n            <div id="chart-btn-x-left" style="display: inline-block;" class="float-right margin-left-4"></div>\r\n            <div id="chart-spin-x" style="display: inline-block;" class="float-right"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <label class="fixed" style="margin-top: 3px;width: 88px;"><%= scope.textY %></label>\r\n            <div id="chart-btn-y-down" style="display: inline-block;" class="float-right margin-left-4"></div>\r\n            <div id="chart-btn-y-up" style="display: inline-block;" class="float-right margin-left-4"></div>\r\n            <div id="chart-spin-y" style="display: inline-block;" class="float-right"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <label class="fixed" style="margin-top: 3px;width: 88px;"><%= scope.textPerspective %></label>\r\n            <div id="chart-btn-widen" style="display: inline-block;" class="float-right margin-left-4"></div>\r\n            <div id="chart-btn-narrow" style="display: inline-block;" class="float-right margin-left-4"></div>\r\n            <div id="chart-spin-persp" style="display: inline-block;" class="float-right"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="chart-checkbox-right-angle"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="chart-checkbox-autoscale"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <label class="fixed" style="margin-top: 3px;width: 122px;"><%= scope.text3dDepth %></label>\r\n            <div id="chart-spin-3d-depth" style="display: inline-block;" class="float-right"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <label class="fixed" style="margin-top: 3px;width: 122px;"><%= scope.text3dHeight %></label>\r\n            <div id="chart-spin-3d-height" style="display: inline-block;" class="float-right"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <label class="link canfocused" id="chart-def-rotate-link" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.textDefault %></label>\r\n        </td>\r\n    </tr>\r\n</table>\r\n<table cols="1" id="spark-panel-types" role="presentation">\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.textType %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="spark-button-type" style=""></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.textStyle %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <label class="input-label" style=""><%= scope.strTemplate %></label>\r\n            <div class="" id="spark-combo-style" style="width: 100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div style="display:inline-block;vertical-align: middle;width:55px;">\r\n                <label class="input-label" style=""><%= scope.strSparkColor %></label>\r\n                <div id="spark-color-btn" style=""></div>\r\n            </div>\r\n            <div style="display:inline-block;vertical-align: middle;">\r\n                <label class="input-label" style=""><%= scope.strLineWeight %></label>\r\n                <div id="spark-combo-line-type" style="width: 93px;"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n</table>\r\n<table cols="1" id="spark-panel-points" role="presentation">\r\n    <tr>\r\n        <td class="padding-small">\r\n            <label class="header" style="margin-bottom: 4px;"><%= scope.textShow %></label>\r\n            <div style="width: 100%; height: 25px; margin-bottom: 8px;">\r\n                <div id="spark-checkbox-high" style="display: inline-block;margin-top: 4px;"></div>\r\n                <div id="spark-high-color-btn" style="display: inline-block;" class="float-right"></div>\r\n            </div>\r\n            <div style="width: 100%; height: 25px; margin-bottom: 8px;">\r\n                <div id="spark-checkbox-low" style="display: inline-block;margin-top: 4px;"></div>\r\n                <div id="spark-low-color-btn" style="display: inline-block;" class="float-right"></div>\r\n            </div>\r\n            <div style="width: 100%; height: 25px; margin-bottom: 8px;">\r\n                <div id="spark-checkbox-negative" style="display: inline-block;margin-top: 4px;"></div>\r\n                <div id="spark-negative-color-btn" style="display: inline-block;" class="float-right"></div>\r\n            </div>\r\n            <div style="width: 100%; height: 25px; margin-bottom: 8px;">\r\n                <div id="spark-checkbox-first" style="display: inline-block;margin-top: 4px;"></div>\r\n                <div id="spark-first-color-btn" style="display: inline-block;" class="float-right"></div>\r\n            </div>\r\n            <div style="width: 100%; height: 25px; margin-bottom: 8px;">\r\n                <div id="spark-checkbox-last" style="display: inline-block;margin-top: 4px;"></div>\r\n                <div id="spark-last-color-btn" style="display: inline-block;" class="float-right"></div>\r\n            </div>\r\n            <div style="width: 100%; height: 25px;">\r\n                <div id="spark-checkbox-markers" style="display: inline-block;margin-top: 4px;"></div>\r\n                <div id="spark-markers-color-btn" style="display: inline-block;" class="float-right"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n</table>\r\n<table cols="1" role="presentation">\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td align="center">\r\n            <label class="link canfocused" id="chart-advanced-link" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.textAdvanced %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'})),define("spreadsheeteditor/main/app/view/ChartSettings",["text!spreadsheeteditor/main/app/template/ChartSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/MetricSpinner","common/main/lib/component/ComboDataView"],(function(t,e,i,o){"use strict";SSE.Views.ChartSettings=o.View.extend(i.extend({el:"#id-chart-settings",template:i.template(t),events:{},options:{alias:"ChartSettings"},initialize:function(){this._initSettings=!0,this.txtPt=Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt),this._state={Width:0,Height:0,ChartStyle:1,ChartType:-1,SeveralCharts:!1,DisabledControls:!1,keepRatio:!1,SparkType:-1,SparkStyle:1,LineWeight:1,MarkersPoint:!1,HighPoint:!1,LowPoint:!1,FirstPoint:!1,LastPoint:!1,NegativePoint:!1,SparkColor:"000000",MarkersColor:this.defColor,HighColor:this.defColor,LowColor:this.defColor,FirstColor:this.defColor,LastColor:this.defColor,NegativeColor:this.defColor,SparkId:void 0},this._nRatio=1,this.spinners=[],this.chPoints=[],this.lockedControls=[],this._locked=!1,this.defColor={color:"4f81bd",effectId:24},this.isChart=!0,this._noApply=!1,this._originalProps=null,this.render(),this.ChartSizeContainer=e("#chart-panel-size"),this.ChartTypesContainer=e("#chart-panel-types"),this.SparkTypesContainer=e("#spark-panel-types"),this.SparkPointsContainer=e("#spark-panel-points"),this.NotCombinedSettings=e(".not-combined"),this.Chart3DContainer=e("#chart-panel-3d-rotate")},render:function(){e(this.el).html(this.template({scope:this}))},setApi:function(t){return this.api=t,this.api&&(this.api.asc_registerCallback("asc_onUpdateChartStyles",i.bind(this._onUpdateChartStyles,this)),this.api.asc_registerCallback("asc_onAddChartStylesPreview",i.bind(this.onAddChartStylesPreview,this))),this},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),this._isEditType)this._props=t;else{var e=!!(t&&t.asc_getChartProperties&&t.asc_getChartProperties()),o=e?this.api.asc_getChartObject(!0):null,n=o?o.getView3d():null;if(this.isChart===e&&this._state.is3D===!!n||this.ShowHideElem(e,!!n),this._state.is3D=!!n,this.disableControls(this._locked),this.api&&t)if(e){this._originalProps=new Asc.asc_CImgProperty(t),this.isChart=!0,this._noApply=!0,this.chartProps=t.asc_getChartProperties();var s=t.asc_getSeveralCharts()||this._locked;this._state.SeveralCharts!==s&&(this.linkAdvanced.toggleClass("disabled",s),this._state.SeveralCharts=s),s=t.asc_getSeveralChartTypes();var a=this._state.SeveralCharts&&s?null:this.chartProps.getType();if(this._state.ChartType!==a&&(this.ShowCombinedProps(a),null!==a&&a!=Asc.c_oAscChartTypeSettings.comboBarLine&&a!=Asc.c_oAscChartTypeSettings.comboBarLineSecondary&&a!=Asc.c_oAscChartTypeSettings.comboAreaBar&&a!=Asc.c_oAscChartTypeSettings.comboCustom&&this.updateChartStyles(this.api.asc_getChartPreviews(a,void 0,!0)),this._state.ChartType=a),a!=Asc.c_oAscChartTypeSettings.comboBarLine&&a!=Asc.c_oAscChartTypeSettings.comboBarLineSecondary&&a!=Asc.c_oAscChartTypeSettings.comboAreaBar&&a!=Asc.c_oAscChartTypeSettings.comboCustom){if(s=t.asc_getSeveralChartStyles(),this._state.SeveralCharts&&s)this.cmbChartStyle.fieldPicker.deselectAll(),this.cmbChartStyle.menuPicker.deselectAll(),this._state.ChartStyle=null;else if(s=this.chartProps.getStyle(),this._state.ChartStyle!==s||this._isChartStylesChanged){this._state.ChartStyle=s;var r=this.selectCurrentChartStyle();this._isChartStylesChanged&&this.api.asc_generateChartPreviews(this._state.ChartType,r)}this._isChartStylesChanged=!1}this._noApply=!1,s=t.asc_getWidth(),(Math.abs(this._state.Width-s)>.001||(null===this._state.Width||null===s)&&this._state.Width!==s)&&(this.spnWidth.setValue(null!==s?Common.Utils.Metric.fnRecalcFromMM(s):"",!0),this._state.Width=s),s=t.asc_getHeight(),(Math.abs(this._state.Height-s)>.001||(null===this._state.Height||null===s)&&this._state.Height!==s)&&(this.spnHeight.setValue(null!==s?Common.Utils.Metric.fnRecalcFromMM(s):"",!0),this._state.Height=s),t.asc_getHeight()>0&&(this._nRatio=t.asc_getWidth()/t.asc_getHeight()),s=t.asc_getLockAspect(),this._state.keepRatio!==s&&(this.btnRatio.toggle(s),this._state.keepRatio=s);var l=o?o.getSeries():null;this.btnSwitch.setDisabled(this._locked||!l||l.length<1||!o||!o.getRange()),n&&(s=n.asc_getRotX(),((void 0===this._state.X||void 0===s)&&this._state.X!==s||Math.abs(this._state.X-s)>.001)&&(this.spnX.setValue(null!=s?s:"",!0),this._state.X=s),s=n.asc_getRotY(),((void 0===this._state.Y||void 0===s)&&this._state.Y!==s||Math.abs(this._state.Y-s)>.001)&&(this.spnY.setValue(null!=s?s:"",!0),this._state.Y=s),s=n.asc_getRightAngleAxes(),this._state.RightAngle!==s&&(this.chRightAngle.setValue(null!=s?s:"indeterminate",!0),this._state.RightAngle=s),s=n.asc_getPerspective(),((void 0===this._state.Perspective||void 0===s)&&this._state.Perspective!==s||Math.abs(this._state.Perspective-s)>.001)&&(this.spnPerspective.setMinValue(null!=s?.1:0),this.spnPerspective.setValue(null!=s?s:0,!0),this._state.Perspective=s),this.spnPerspective.setDisabled(this._locked||!!this._state.RightAngle),this.btnNarrow.setDisabled(this._locked||!!this._state.RightAngle),this.btnWiden.setDisabled(this._locked||!!this._state.RightAngle),s=n.asc_getDepth(),(Math.abs(this._state.Depth-s)>.001||(void 0===this._state.Depth||void 0===s)&&this._state.Depth!==s)&&(this.spn3DDepth.setValue(null!=s?s:"",!0),this._state.Depth=s),s=n.asc_getHeight(),(Math.abs(this._state.Height3d-s)>.001||(void 0===this._state.Height3d||null===this._state.Height3d||null===s)&&this._state.Height3d!==s)&&(null!==s&&this.spn3DHeight.setValue(s,!0),this.chAutoscale.setValue(null===s,!0),this._state.Height3d=s),this.spn3DHeight.setDisabled(this._locked||null===s))}else{this._originalProps=t,this.isChart=!1,this._state.SparkId=t.asc_getId();a=t.asc_getType();var c=!1;if(this._state.SparkType!==a){var h=this.mnuSparkTypePicker?this.mnuSparkTypePicker.store.findWhere({type:a}):null;this.mnuSparkTypePicker&&this.mnuSparkTypePicker.selectRecord(h,!0),h?this.btnSparkType.setIconCls("svgicon chart-"+h.get("iconCls")):this.btnSparkType.setIconCls("svgicon"),this._state.SparkType=a,c=!0}this.btnSparkType.setDisabled(!this.mnuSparkTypePicker||this._locked);var d=t.asc_getLineWeight(),m=Math.abs(this._state.LineWeight-d)<.001&&!new RegExp(this.txtPt+"\\s*$").test(this.cmbBorderSize.getRawValue());if(Math.abs(this._state.LineWeight-d)>.001||m||(null===this._state.LineWeight||null===d)&&this._state.LineWeight!==d){this._state.LineWeight=d;var p=null===d?d:i.find(this.cmbBorderSize.store.models,(function(t){if(d<t.attributes.value+.01&&d>t.attributes.value-.01)return!0}));p?this.cmbBorderSize.selectRecord(p):this.cmbBorderSize.setValue(null!==d?parseFloat(d.toFixed(2))+" "+this.txtPt:""),this.BorderSize=d}this.cmbBorderSize.setDisabled(this._locked||this._state.SparkType!==Asc.c_oAscSparklineType.Line);var u=t.asc_getColorSeries();if(u)this.SparkColor=u.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),effectValue:u.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),((g=_typeof(this.SparkColor))!==_typeof(this._state.SparkColor)||"object"==g&&(this.SparkColor.effectValue!==this._state.SparkColor.effectValue||this._state.SparkColor.color.indexOf(this.SparkColor.color)<0)||"object"!=g&&(this._state.SparkColor.indexOf(this.SparkColor)<0||"object"==_typeof(this.btnSparkColor.color)))&&(this.btnSparkColor.setColor(this.SparkColor),Common.Utils.ThemeColor.selectPickerColorByEffect(this.SparkColor,this.colorsSpark),this._state.SparkColor=this.SparkColor);var g,f=t.asc_getMarkersPoint();if(u=t.asc_getColorMarkers(),this._state.MarkersPoint!==f&&(this.chMarkersPoint.setValue(null!=f?f:"indeterminate",!0),this._state.MarkersPoint=f,c=!0),this.chMarkersPoint.setDisabled(this._locked||this._state.SparkType!==Asc.c_oAscSparklineType.Line),this.btnMarkersColor.setDisabled(this._locked||this._state.SparkType!==Asc.c_oAscSparklineType.Line),u)this.MarkersColor=u.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),effectValue:u.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),((g=_typeof(this.MarkersColor))!==_typeof(this._state.MarkersColor)||"object"==g&&(this.MarkersColor.effectValue!==this._state.MarkersColor.effectValue||this._state.MarkersColor.color.indexOf(this.MarkersColor.color)<0)||"object"!=g&&(this._state.MarkersColor.indexOf(this.MarkersColor)<0||"object"==_typeof(this.btnMarkersColor.color)))&&(this.btnMarkersColor.setColor(this.MarkersColor),Common.Utils.ThemeColor.selectPickerColorByEffect(this.MarkersColor,this.colorsMarkers),this._state.MarkersColor=this.MarkersColor,c=!0);if(f=t.asc_getHighPoint(),u=t.asc_getColorHigh(),this._state.HighPoint!==f&&(this.chHighPoint.setValue(null!=f?f:"indeterminate",!0),this._state.HighPoint=f,c=!0),u)this.HighColor=u.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),effectValue:u.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),((g=_typeof(this.HighColor))!==_typeof(this._state.HighColor)||"object"==g&&(this.HighColor.effectValue!==this._state.HighColor.effectValue||this._state.HighColor.color.indexOf(this.HighColor.color)<0)||"object"!=g&&(this._state.HighColor.indexOf(this.HighColor)<0||"object"==_typeof(this.btnHighColor.color)))&&(this.btnHighColor.setColor(this.HighColor),Common.Utils.ThemeColor.selectPickerColorByEffect(this.HighColor,this.colorsHigh),this._state.HighColor=this.HighColor,c=!0);if(f=t.asc_getLowPoint(),u=t.asc_getColorLow(),this._state.LowPoint!==f&&(this.chLowPoint.setValue(null!=f?f:"indeterminate",!0),this._state.LowPoint=f,c=!0),u)this.LowColor=u.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),effectValue:u.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),((g=_typeof(this.LowColor))!==_typeof(this._state.LowColor)||"object"==g&&(this.LowColor.effectValue!==this._state.LowColor.effectValue||this._state.LowColor.color.indexOf(this.LowColor.color)<0)||"object"!=g&&(this._state.LowColor.indexOf(this.LowColor)<0||"object"==_typeof(this.btnLowColor.color)))&&(this.btnLowColor.setColor(this.LowColor),Common.Utils.ThemeColor.selectPickerColorByEffect(this.LowColor,this.colorsLow),this._state.LowColor=this.LowColor,c=!0);if(f=t.asc_getFirstPoint(),u=t.asc_getColorFirst(),this._state.FirstPoint!==f&&(this.chFirstPoint.setValue(null!=f?f:"indeterminate",!0),this._state.FirstPoint=f,c=!0),u)this.FirstColor=u.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),effectValue:u.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),((g=_typeof(this.FirstColor))!==_typeof(this._state.FirstColor)||"object"==g&&(this.FirstColor.effectValue!==this._state.FirstColor.effectValue||this._state.FirstColor.color.indexOf(this.FirstColor.color)<0)||"object"!=g&&(this._state.FirstColor.indexOf(this.FirstColor)<0||"object"==_typeof(this.btnFirstColor.color)))&&(this.btnFirstColor.setColor(this.FirstColor),Common.Utils.ThemeColor.selectPickerColorByEffect(this.FirstColor,this.colorsFirst),this._state.FirstColor=this.FirstColor,c=!0);if(f=t.asc_getLastPoint(),u=t.asc_getColorLast(),this._state.LastPoint!==f&&(this.chLastPoint.setValue(null!=f?f:"indeterminate",!0),this._state.LastPoint=f,c=!0),u)this.LastColor=u.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),effectValue:u.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),((g=_typeof(this.LastColor))!==_typeof(this._state.LastColor)||"object"==g&&(this.LastColor.effectValue!==this._state.LastColor.effectValue||this._state.LastColor.color.indexOf(this.LastColor.color)<0)||"object"!=g&&(this._state.LastColor.indexOf(this.LastColor)<0||"object"==_typeof(this.btnLastColor.color)))&&(this.btnLastColor.setColor(this.LastColor),Common.Utils.ThemeColor.selectPickerColorByEffect(this.LastColor,this.colorsLast),this._state.LastColor=this.LastColor,c=!0);if(f=t.asc_getNegativePoint(),u=t.asc_getColorNegative(),this._state.NegativePoint!==f&&(this.chNegativePoint.setValue(null!=f?f:"indeterminate",!0),this._state.NegativePoint=f,c=!0),u)this.NegativeColor=u.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),effectValue:u.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),((g=_typeof(this.NegativeColor))!==_typeof(this._state.NegativeColor)||"object"==g&&(this.NegativeColor.effectValue!==this._state.NegativeColor.effectValue||this._state.NegativeColor.color.indexOf(this.NegativeColor.color)<0)||"object"!=g&&(this._state.NegativeColor.indexOf(this.NegativeColor)<0||"object"==_typeof(this.btnNegativeColor.color)))&&(this.btnNegativeColor.setColor(this.NegativeColor),Common.Utils.ThemeColor.selectPickerColorByEffect(this.NegativeColor,this.colorsNegative),this._state.NegativeColor=this.NegativeColor,c=!0);c&&this.updateSparkStyles(t.asc_getStyles())}}},updateMetricUnit:function(){if(this.spinners){for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}this.spnWidth&&this.spnWidth.setValue(null!==this._state.Width?Common.Utils.Metric.fnRecalcFromMM(this._state.Width):"",!0),this.spnHeight&&this.spnHeight.setValue(null!==this._state.Height?Common.Utils.Metric.fnRecalcFromMM(this._state.Height):"",!0)}},UpdateThemeColors:function(){var t;this._initSettings||(this.btnSparkColor||(t=this.defColor,this.btnSparkColor=new Common.UI.ColorButton({parentEl:e("#spark-color-btn"),color:"000000"}),this.lockedControls.push(this.btnSparkColor),this.colorsSpark=this.btnSparkColor.getPicker(),this.btnSparkColor.on("color:select",i.bind(this.onColorsSparkSelect,this)),this.btnHighColor=new Common.UI.ColorButton({parentEl:e("#spark-high-color-btn")}),this.btnHighColor.setColor(this.defColor.color),this.lockedControls.push(this.btnHighColor),this.colorsHigh=this.btnHighColor.getPicker(),this.btnHighColor.on("color:select",i.bind(this.onColorsPointSelect,this,0)),this.btnLowColor=new Common.UI.ColorButton({parentEl:e("#spark-low-color-btn")}),this.btnLowColor.setColor(this.defColor.color),this.lockedControls.push(this.btnLowColor),this.colorsLow=this.btnLowColor.getPicker(),this.btnLowColor.on("color:select",i.bind(this.onColorsPointSelect,this,1)),this.btnNegativeColor=new Common.UI.ColorButton({parentEl:e("#spark-negative-color-btn")}),this.btnNegativeColor.setColor(this.defColor.color),this.lockedControls.push(this.btnNegativeColor),this.colorsNegative=this.btnNegativeColor.getPicker(),this.btnNegativeColor.on("color:select",i.bind(this.onColorsPointSelect,this,2)),this.btnFirstColor=new Common.UI.ColorButton({parentEl:e("#spark-first-color-btn")}),this.lockedControls.push(this.btnFirstColor),this.btnFirstColor.setColor(this.defColor.color),this.colorsFirst=this.btnFirstColor.getPicker(),this.btnFirstColor.on("color:select",i.bind(this.onColorsPointSelect,this,3)),this.btnLastColor=new Common.UI.ColorButton({parentEl:e("#spark-last-color-btn")}),this.btnLastColor.setColor(this.defColor.color),this.lockedControls.push(this.btnLastColor),this.colorsLast=this.btnLastColor.getPicker(),this.btnLastColor.on("color:select",i.bind(this.onColorsPointSelect,this,4)),this.btnMarkersColor=new Common.UI.ColorButton({parentEl:e("#spark-markers-color-btn")}),this.btnMarkersColor.setColor(this.defColor.color),this.lockedControls.push(this.btnMarkersColor),this.colorsMarkers=this.btnMarkersColor.getPicker(),this.btnMarkersColor.on("color:select",i.bind(this.onColorsPointSelect,this,5))),this.colorsSpark.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsHigh.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors(),t),this.colorsLow.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors(),t),this.colorsNegative.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors(),t),this.colorsFirst.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors(),t),this.colorsLast.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors(),t),this.colorsMarkers.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors(),t),this.btnSparkColor.setColor(this.colorsSpark.getColor()),this.btnHighColor.setColor(this.colorsHigh.getColor()),this.btnLowColor.setColor(this.colorsLow.getColor()),this.btnNegativeColor.setColor(this.colorsNegative.getColor()),this.btnFirstColor.setColor(this.colorsFirst.getColor()),this.btnLastColor.setColor(this.colorsLast.getColor()),this.btnMarkersColor.setColor(this.colorsMarkers.getColor()))},createDelayedControls:function(){var t=this;this.spnWidth=new Common.UI.MetricSpinner({el:e("#chart-spin-width"),step:.1,width:78,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textWidth}),this.spinners.push(this.spnWidth),this.lockedControls.push(this.spnWidth),this.spnHeight=new Common.UI.MetricSpinner({el:e("#chart-spin-height"),step:.1,width:78,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textHeight}),this.spinners.push(this.spnHeight),this.lockedControls.push(this.spnHeight),this.spnWidth.on("change",i.bind(this.onWidthChange,this)),this.spnHeight.on("change",i.bind(this.onHeightChange,this)),this.spnWidth.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnHeight.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.btnRatio=new Common.UI.Button({parentEl:e("#chart-button-ratio"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-advanced-ratio",style:"margin-bottom: 1px;",enableToggle:!0,hint:this.textKeepRatio,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.btnRatio),this.btnRatio.on("click",i.bind((function(t,e){if(t.pressed&&this.spnHeight.getNumberValue()>0&&(this._nRatio=this.spnWidth.getNumberValue()/this.spnHeight.getNumberValue()),this.api){var i=new Asc.asc_CImgProperty;i.asc_putLockAspect(t.pressed),this.api.asc_setGraphicObjectProps(i)}}),this)),this.btnSparkType=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"svgicon chart-spark-column",menu:new Common.UI.Menu({style:"width: 167px;",items:[{template:i.template('<div id="id-spark-menu-type" class="menu-insertchart"></div>')}]})}),this.btnSparkType.on("render:after",i.bind(this.createSparkTypeMenu,this)),this.btnSparkType.render(e("#spark-button-type")),this.lockedControls.push(this.btnSparkType),this.cmbBorderSize=new Common.UI.ComboBorderSizeEditable({el:e("#spark-combo-line-type"),style:"width: 90px;",allowNoBorders:!1}).on("selected",i.bind(this.onBorderSizeSelect,this)).on("changed:before",i.bind(this.onBorderSizeChanged,this,!0)).on("changed:after",i.bind(this.onBorderSizeChanged,this,!1)),this.BorderSize=this.cmbBorderSize.store.at(1).get("value"),this.cmbBorderSize.setValue(this.BorderSize),this.lockedControls.push(this.cmbBorderSize),this.chHighPoint=new Common.UI.CheckBox({el:e("#spark-checkbox-high"),labelText:this.textHighPoint}),this.lockedControls.push(this.chHighPoint),this.chPoints.push(this.chHighPoint),this.chLowPoint=new Common.UI.CheckBox({el:e("#spark-checkbox-low"),labelText:this.textLowPoint}),this.lockedControls.push(this.chLowPoint),this.chPoints.push(this.chLowPoint),this.chNegativePoint=new Common.UI.CheckBox({el:e("#spark-checkbox-negative"),labelText:this.textNegativePoint}),this.lockedControls.push(this.chNegativePoint),this.chPoints.push(this.chNegativePoint),this.chFirstPoint=new Common.UI.CheckBox({el:e("#spark-checkbox-first"),labelText:this.textFirstPoint}),this.lockedControls.push(this.chFirstPoint),this.chPoints.push(this.chFirstPoint),this.chLastPoint=new Common.UI.CheckBox({el:e("#spark-checkbox-last"),labelText:this.textLastPoint}),this.lockedControls.push(this.chLastPoint),this.chPoints.push(this.chLastPoint),this.chMarkersPoint=new Common.UI.CheckBox({el:e("#spark-checkbox-markers"),labelText:this.textMarkers}),this.lockedControls.push(this.chMarkersPoint),this.chPoints.push(this.chMarkersPoint),this.chHighPoint.on("change",i.bind(this.onCheckPointChange,this,0)),this.chLowPoint.on("change",i.bind(this.onCheckPointChange,this,1)),this.chNegativePoint.on("change",i.bind(this.onCheckPointChange,this,2)),this.chFirstPoint.on("change",i.bind(this.onCheckPointChange,this,3)),this.chLastPoint.on("change",i.bind(this.onCheckPointChange,this,4)),this.chMarkersPoint.on("change",i.bind(this.onCheckPointChange,this,5)),this.btnChangeType=new Common.UI.Button({parentEl:e("#chart-btn-change-type"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon btn-menu-chart",caption:this.textChangeType,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnChangeType.on("click",i.bind(this.onChangeType,this)),this.lockedControls.push(this.btnChangeType),this.btnSelectData=new Common.UI.Button({parentEl:e("#chart-btn-select-data"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon btn-select-range",caption:this.textSelectData,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnSelectData.on("click",i.bind(this.onSelectData,this)),this.lockedControls.push(this.btnSelectData),this.btnSwitch=new Common.UI.Button({parentEl:e("#chart-btn-switch"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon btn-switch-row-column",caption:this.textSwitch,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnSwitch.on("click",i.bind(this.onSwitch,this)),this.lockedControls.push(this.btnSwitch),this.spnX=new Common.UI.MetricSpinner({el:e("#chart-spin-x"),step:10,width:57,defaultUnit:"°",value:"20 °",maxValue:359.9,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textX}),this.lockedControls.push(this.spnX),this.spnX.on("change",i.bind(this.onXRotation,this)),this.spnX.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.btnLeft=new Common.UI.Button({parentEl:e("#chart-btn-x-left",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-270",hint:this.textLeft,dataHint:"1",dataHintDirection:"top"}),this.lockedControls.push(this.btnLeft),this.btnLeft.on("click",i.bind((function(){this.spnX.setValue(10*Math.ceil((this.spnX.getNumberValue()-10)/10))}),this)),this.btnRight=new Common.UI.Button({parentEl:e("#chart-btn-x-right",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-90",hint:this.textRight,dataHint:"1",dataHintDirection:"top"}),this.lockedControls.push(this.btnRight),this.btnRight.on("click",i.bind((function(){this.spnX.setValue(10*Math.floor((this.spnX.getNumberValue()+10)/10))}),this)),this.spnY=new Common.UI.MetricSpinner({el:e("#chart-spin-y"),step:10,width:57,defaultUnit:"°",value:"15 °",maxValue:90,minValue:-90,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textY}),this.lockedControls.push(this.spnY),this.spnY.on("change",i.bind(this.onYRotation,this)),this.spnY.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.btnUp=new Common.UI.Button({parentEl:e("#chart-btn-y-up",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-y-clockwise",hint:this.textUp,dataHint:"1",dataHintDirection:"top"}),this.lockedControls.push(this.btnUp),this.btnUp.on("click",i.bind((function(){this.spnY.setValue(10*Math.ceil((this.spnY.getNumberValue()-10)/10))}),this)),this.btnDown=new Common.UI.Button({parentEl:e("#chart-btn-y-down",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-y-counterclockwise",hint:this.textDown,dataHint:"1",dataHintDirection:"top"}),this.lockedControls.push(this.btnDown),this.btnDown.on("click",i.bind((function(){this.spnY.setValue(10*Math.floor((this.spnY.getNumberValue()+10)/10))}),this)),this.spnPerspective=new Common.UI.MetricSpinner({el:e("#chart-spin-persp"),step:5,width:57,defaultUnit:"°",value:"0 °",maxValue:100,minValue:.1,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textPerspective}),this.lockedControls.push(this.spnPerspective),this.spnPerspective.on("change",i.bind(this.onPerspective,this)),this.spnPerspective.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.btnNarrow=new Common.UI.Button({parentEl:e("#chart-btn-narrow",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-up",hint:this.textNarrow,dataHint:"1",dataHintDirection:"top"}),this.lockedControls.push(this.btnNarrow),this.btnNarrow.on("click",i.bind((function(){this.spnPerspective.setValue(5*Math.ceil((this.spnPerspective.getNumberValue()-5)/5))}),this)),this.btnWiden=new Common.UI.Button({parentEl:e("#chart-btn-widen",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-down",hint:this.textWiden,dataHint:"1",dataHintDirection:"top"}),this.lockedControls.push(this.btnWiden),this.btnWiden.on("click",i.bind((function(){this.spnPerspective.setValue(5*Math.floor((this.spnPerspective.getNumberValue()+5)/5))}),this)),this.chRightAngle=new Common.UI.CheckBox({el:e("#chart-checkbox-right-angle"),labelText:this.textRightAngle}),this.lockedControls.push(this.chRightAngle),this.chRightAngle.on("change",i.bind((function(t,e,i,o){if(this.api){var n=this.api.asc_getChartObject(!0);if(n){var s=n.getView3d();s&&(s.asc_setRightAngleAxes("checked"==t.getValue()),n.startEdit(),n.setView3d(s),n.endEdit())}}}),this)),this.chAutoscale=new Common.UI.CheckBox({el:e("#chart-checkbox-autoscale"),labelText:this.textAutoscale}),this.lockedControls.push(this.chAutoscale),this.chAutoscale.on("change",i.bind((function(t,e,i,o){if(this.api){var n=this.api.asc_getChartObject(!0);if(n){var s=n.getView3d();s&&(s.asc_setHeight("checked"==t.getValue()?null:this.spn3DHeight.getNumberValue()),n.startEdit(),n.setView3d(s),n.endEdit())}}}),this)),this.spn3DDepth=new Common.UI.MetricSpinner({el:e("#chart-spin-3d-depth"),step:10,width:70,defaultUnit:"%",value:"0 %",maxValue:2e3,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.text3dDepth}),this.lockedControls.push(this.spn3DDepth),this.spn3DDepth.on("change",i.bind(this.on3DDepth,this)),this.spn3DDepth.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spn3DHeight=new Common.UI.MetricSpinner({el:e("#chart-spin-3d-height"),step:10,width:70,defaultUnit:"%",value:"50 %",maxValue:500,minValue:5,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.text3dHeight}),this.lockedControls.push(this.spn3DHeight),this.spn3DHeight.on("change",i.bind(this.on3DHeight,this)),this.spn3DHeight.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.linkDefRotation=e("#chart-def-rotate-link"),e(this.el).on("click","#chart-def-rotate-link",i.bind(this.onDefRotation,this)),this.linkAdvanced=e("#chart-advanced-link"),e(this.el).on("click","#chart-advanced-link",i.bind(this.openAdvancedSettings,this))},createSparkTypeMenu:function(){if(Common.Controllers.LaunchController.isScriptLoaded()&&!this.mnuChartTypePicker){this.mnuSparkTypePicker=new Common.UI.DataView({el:e("#id-spark-menu-type"),parentMenu:this.btnSparkType.menu,restoreHeight:120,allowScrollbar:!1,groups:new Common.UI.DataViewGroupStore(Common.define.chartData.getSparkGroupData()),store:new Common.UI.DataViewStore(Common.define.chartData.getSparkData()),itemTemplate:i.template('<div id="<%= id %>" class="item-chartlist"><svg width="40" height="40" class="icon uni-scale"><use xlink:href="#chart-<%= iconCls %>"></use></svg></div>'),delayRenderTips:!0}),this.mnuSparkTypePicker.on("item:click",i.bind(this.onSelectSparkType,this,this.btnSparkType));var t=this.mnuSparkTypePicker.store.findWhere({type:this._state.SparkType});this.mnuSparkTypePicker.selectRecord(t,!0),this.btnSparkType.setIconCls(t?"svgicon chart-"+t.get("iconCls"):"svgicon"),this.btnSparkType.setDisabled(this._locked)}},createDelayedElements:function(){this._initSettings=!1,Common.NotificationCenter.on("script:loaded",i.bind(this.createPostLoadElements,this)),this.createDelayedControls(),this.updateMetricUnit(),this.UpdateThemeColors()},createPostLoadElements:function(){this.createSparkTypeMenu()},ShowHideElem:function(t,e){this.ChartSizeContainer.toggleClass("settings-hidden",!t),this.ChartTypesContainer.toggleClass("settings-hidden",!t),this.SparkTypesContainer.toggleClass("settings-hidden",t),this.SparkPointsContainer.toggleClass("settings-hidden",t),this.Chart3DContainer.toggleClass("settings-hidden",!t||!e),this.fireEvent("updatescroller",this)},ShowCombinedProps:function(t){this.NotCombinedSettings.toggleClass("settings-hidden",null===t||t==Asc.c_oAscChartTypeSettings.comboBarLine||t==Asc.c_oAscChartTypeSettings.comboBarLineSecondary||t==Asc.c_oAscChartTypeSettings.comboAreaBar||t==Asc.c_oAscChartTypeSettings.comboCustom)},onWidthChange:function(t,e,i,o){var n=t.getNumberValue(),s=this.spnHeight.getNumberValue();if(this.btnRatio.pressed&&((s=n/this._nRatio)>this.spnHeight.options.maxValue&&(n=(s=this.spnHeight.options.maxValue)*this._nRatio,this.spnWidth.setValue(n,!0)),this.spnHeight.setValue(s,!0)),this.api){var a=new Asc.asc_CImgProperty;a.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(n)),a.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(s)),this.api.asc_setGraphicObjectProps(a)}},onHeightChange:function(t,e,i,o){var n=t.getNumberValue(),s=this.spnWidth.getNumberValue();if(this.btnRatio.pressed&&((s=n*this._nRatio)>this.spnWidth.options.maxValue&&(n=(s=this.spnWidth.options.maxValue)/this._nRatio,this.spnHeight.setValue(n,!0)),this.spnWidth.setValue(s,!0)),this.api){var a=new Asc.asc_CImgProperty;a.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(s)),a.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(n)),this.api.asc_setGraphicObjectProps(a)}},openAdvancedSettings:function(){if(!this.linkAdvanced.hasClass("disabled")&&Common.Controllers.LaunchController.isScriptLoaded()){var t,e=this;e.api&&(t=e.isChart?e.api.asc_getChartObject():e._originalProps)&&new SSE.Views.ChartSettingsDlg({chartSettings:t,imageSettings:e.isChart?e._originalProps:null,sparklineStyles:e.sparklineStyles,isChart:e.isChart,api:e.api,handler:function(t,i){"ok"==t&&e.api&&(e.isChart?(e.api.asc_editChartDrawingObject(i.chartSettings),i.imageSettings&&e.api.asc_setGraphicObjectProps(i.imageSettings)):e.api.asc_setSparklineGroup(e._state.SparkId,i.chartSettings)),Common.NotificationCenter.trigger("edit:complete",e)}}).show()}},onSelectData_simple:function(){var t=this;if(t.api){var e=t.api.asc_getChartObject(),o=new SSE.Views.CellRangeDialog({handler:function(i,o){"ok"==o&&(e.putRange(i.getSettings()),t.api.asc_setSelectionDialogMode(Asc.c_oAscSelectionDialogType.None),t.api.asc_editChartDrawingObject(e)),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}}).on("close",(function(){t.api.asc_onCloseChartFrame()}));o.show(),o.setSettings({api:t.api,range:e.getRange(),validation:function(o){var n;return i.isEmpty(o)?"":(n=t.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.Chart,o,!0,e.getInRows(),t._state.ChartType))==Asc.c_oAscError.ID.No||(n==Asc.c_oAscError.ID.StockChartError?this.errorStockChart:n==Asc.c_oAscError.ID.MaxDataSeriesError?this.errorMaxRows:this.txtInvalidRange)},type:Asc.c_oAscSelectionDialogType.Chart})}},onSelectData:function(){if(Common.Controllers.LaunchController.isScriptLoaded()){var t,e=this;if(e.api)if(t=e.api.asc_getChartObject())e._isEditRanges=!0,t.startEdit(),new SSE.Views.ChartDataDialog({chartSettings:t,api:e.api,handler:function(i,o){"ok"==i&&(t.endEdit(),e._isEditRanges=!1),Common.NotificationCenter.trigger("edit:complete",e)}}).on("close",(function(){e._isEditRanges&&t.cancelEdit(),e._isEditRanges=!1})).show()}},onChangeType:function(){var t=this;t.api&&new SSE.Views.ChartWizardDialog({api:t.api,props:{recommended:t.api.asc_getRecommendedChartData()},type:t._state.ChartType,isEdit:!0,handler:function(e,i){"ok"==e&&t.api&&t.api.asc_addChartSpace(i),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}}).show()},onSelectStyle:function(t,e){if(!this._noApply){if(this.api&&!this._noApply&&this.chartProps){var i=new Asc.asc_CImgProperty;this.chartProps.putStyle(e.get("data")),i.asc_putChartProperties(this.chartProps),this.api.asc_setGraphicObjectProps(i)}Common.NotificationCenter.trigger("edit:complete",this)}},selectCurrentChartStyle:function(){if(this.cmbChartStyle){this.cmbChartStyle.suspendEvents();var t,e=this.cmbChartStyle.menuPicker.store.findWhere({data:this._state.ChartStyle});if(this.cmbChartStyle.menuPicker.selectRecord(e),this.cmbChartStyle.resumeEvents(),this._isChartStylesChanged)if((t=e?this.cmbChartStyle.fillComboView(this.cmbChartStyle.menuPicker.getSelectedRec(),!0):this.cmbChartStyle.fillComboView(this.cmbChartStyle.menuPicker.store.at(0),!0))&&t.length>0){var o=[];return i.each(t,(function(t,e){o.push(t.get("data"))})),o}}},onAddChartStylesPreview:function(t){if(!this._isEditType&&this.cmbChartStyle&&t&&t.length>0){var e=this.cmbChartStyle.menuPicker.store;e&&i.each(t,(function(t,i){var o=e.findWhere({data:t.asc_getName()});o&&o.set("imageUrl",t.asc_getImage())}))}},_onUpdateChartStyles:function(){this.api&&null!==this._state.ChartType&&this._state.ChartType>-1&&this._state.ChartType!=Asc.c_oAscChartTypeSettings.comboBarLine&&this._state.ChartType!=Asc.c_oAscChartTypeSettings.comboBarLineSecondary&&this._state.ChartType!=Asc.c_oAscChartTypeSettings.comboAreaBar&&this._state.ChartType!=Asc.c_oAscChartTypeSettings.comboCustom&&(this.updateChartStyles(this.api.asc_getChartPreviews(this._state.ChartType,void 0,!0)),this.api.asc_generateChartPreviews(this._state.ChartType,this.selectCurrentChartStyle()))},updateChartStyles:function(t){var o=this;if(this._isChartStylesChanged=!0,this.cmbChartStyle||(this.cmbChartStyle=new Common.UI.ComboDataView({itemWidth:50,itemHeight:50,menuMaxHeight:270,enableKeyEvents:!0,cls:"combo-chart-style",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",delayRenderTips:!0,ariaLabel:this.textStyle,fillOnChangeVisibility:!0}),this.cmbChartStyle.render(e("#chart-combo-style")),this.cmbChartStyle.on("click",i.bind(this.onSelectStyle,this)),this.cmbChartStyle.openButton.menu.on("show:after",(function(){o.cmbChartStyle.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.lockedControls.push(this.cmbChartStyle)),t&&t.length>0){var n=this.cmbChartStyle.menuPicker.store;if(n){var s=[];i.each(t,(function(t,e){s.push({imageUrl:t.asc_getImage(),data:t.asc_getName(),tip:o.textStyle+" "+t.asc_getName()})})),n.reset(s,{silent:!1})}}else this.cmbChartStyle.menuPicker.store.reset(),this.cmbChartStyle.clearComboView();this.cmbChartStyle.setDisabled(!t||t.length<1||this._locked)},updateSparkStyles:function(t){var o=this;if(this.cmbSparkStyle||(this.cmbSparkStyle=new Common.UI.ComboDataView({itemWidth:50,itemHeight:50,menuMaxHeight:272,enableKeyEvents:!0,cls:"combo-spark-style",delayRenderTips:!0,fillOnChangeVisibility:!0}),this.cmbSparkStyle.render(e("#spark-combo-style")),this.cmbSparkStyle.on("click",i.bind(this.onSelectSparkStyle,this)),this.cmbSparkStyle.openButton.menu.on("show:after",(function(){o.cmbSparkStyle.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.lockedControls.push(this.cmbSparkStyle)),t&&t.length>1){var n=this.cmbSparkStyle.menuPicker.store,s=t[t.length-1];if(this.sparklineStyles=t,n.length==t.length-1){for(var a=n.models,r=0;r<t.length-1;r++)a[r].set("imageUrl",t[r]);s<0?(this.cmbSparkStyle.fillComboView(n.at(0),!1),this.cmbSparkStyle.fieldPicker.deselectAll(),this.cmbSparkStyle.menuPicker.deselectAll()):this.cmbSparkStyle.menuPicker.selectRecord(n.at(s))}else{var l=[];for(r=0;r<t.length-1;r++)l.push({imageUrl:t[r],data:r});n.reset(l,{silent:!1}),this.cmbSparkStyle.fillComboView(n.at(s<0?0:s),s>-1)}}},onSelectSparkType:function(t,e,o,n){var s={};if(i.isFunction(n.toJSON)){if(!n.get("selected"))return;s=n.toJSON()}else s=n;if(this.btnSparkType.setIconCls("svgicon chart-"+s.iconCls),this._state.SparkType=-1,this.api&&!this._noApply&&this._originalProps){var a=new Asc.sparklineGroup;a.asc_setType(s.type),this.api.asc_setSparklineGroup(this._state.SparkId,a)}Common.NotificationCenter.trigger("edit:complete",this)},onSelectSparkStyle:function(t,e){if(!this._noApply){if(this.api&&!this._noApply&&this._originalProps){var i=new Asc.sparklineGroup;i.asc_setStyle(e.get("data")),this.api.asc_setSparklineGroup(this._state.SparkId,i)}Common.NotificationCenter.trigger("edit:complete",this)}},applyBorderSize:function(t){if(t=Common.Utils.String.parseFloat(t),t=isNaN(t)?1:Math.max(.01,Math.min(1584,t)),this.BorderSize=t,this.api&&!this._noApply&&this._originalProps){var e=new Asc.sparklineGroup;e.asc_setLineWeight(this.BorderSize),this.api.asc_setSparklineGroup(this._state.SparkId,e),Common.NotificationCenter.trigger("edit:complete",this)}},onBorderSizeChanged:function(t,e,o,n){var s=this;if(t){var a=parseFloat(o.value);(!new RegExp("^\\s*(\\d*(\\.|,)?\\d+)\\s*("+s.txtPt+")?\\s*$").exec(o.value)||a<.01||a>1584)&&(this._state.LineWeight=-1,setTimeout((function(){Common.UI.error({msg:s.textBorderSizeErr,callback:function(){i.defer((function(t){Common.NotificationCenter.trigger("edit:complete",s)}))}})}),10))}else this.applyBorderSize(o.value)},onBorderSizeSelect:function(t,e){this.applyBorderSize(e.value)},onColorsSparkSelect:function(t,e){if(this.api&&!this._noApply&&this._originalProps){var i=new Asc.sparklineGroup;i.asc_setColorSeries(Common.Utils.ThemeColor.getRgbColor(e)),this.api.asc_setSparklineGroup(this._state.SparkId,i)}Common.NotificationCenter.trigger("edit:complete",this)},onCheckPointChange:function(t,e,i,o,n){if(this.api&&!this._noApply&&this._originalProps){var s=new Asc.sparklineGroup;switch(t){case 0:s.asc_setHighPoint("checked"==e.getValue());break;case 1:s.asc_setLowPoint("checked"==e.getValue());break;case 2:s.asc_setNegativePoint("checked"==e.getValue());break;case 3:s.asc_setFirstPoint("checked"==e.getValue());break;case 4:s.asc_setLastPoint("checked"==e.getValue());break;case 5:s.asc_setMarkersPoint("checked"==e.getValue())}this.api.asc_setSparklineGroup(this._state.SparkId,s)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsPointSelect:function(t,e,i){if("checked"!==this.chPoints[t].getValue()&&this.chPoints[t].setValue(!0,!0),this.api&&!this._noApply&&this._originalProps){var o=new Asc.sparklineGroup;switch(t){case 0:o.asc_setHighPoint(!0),o.asc_setColorHigh(Common.Utils.ThemeColor.getRgbColor(i));break;case 1:o.asc_setLowPoint(!0),o.asc_setColorLow(Common.Utils.ThemeColor.getRgbColor(i));break;case 2:o.asc_setNegativePoint(!0),o.asc_setColorNegative(Common.Utils.ThemeColor.getRgbColor(i));break;case 3:o.asc_setFirstPoint(!0),o.asc_setColorFirst(Common.Utils.ThemeColor.getRgbColor(i));break;case 4:o.asc_setLastPoint(!0),o.asc_setColorLast(Common.Utils.ThemeColor.getRgbColor(i));break;case 5:o.asc_setMarkersPoint(!0),o.asc_setColorMarkers(Common.Utils.ThemeColor.getRgbColor(i))}this.api.asc_setSparklineGroup(this._state.SparkId,o)}Common.NotificationCenter.trigger("edit:complete",this)},onSwitch:function(){if(this.api){var t=this.api.asc_getChartObject(!0);if(t)t.startEdit(),t.switchRowCol()===Asc.c_oAscError.ID.MaxDataSeriesError?(t.cancelEdit(),Common.UI.warning({msg:this.errorMaxRows,maxwidth:600})):t.endEdit()}},onXRotation:function(t,e,i,o){if(this.api){var n=this.api.asc_getChartObject(!0);if(n){var s=n.getView3d();s&&(s.asc_setRotX(t.getNumberValue()),n.startEdit(),n.setView3d(s),n.endEdit())}}},onYRotation:function(t,e,i,o){if(this.api){var n=this.api.asc_getChartObject(!0);if(n){var s=n.getView3d();s&&(s.asc_setRotY(t.getNumberValue()),n.startEdit(),n.setView3d(s),n.endEdit())}}},onPerspective:function(t,e,i,o){if(this.api){var n=this.api.asc_getChartObject(!0);if(n){var s=n.getView3d();s&&(s.asc_setPerspective(t.getNumberValue()),n.startEdit(),n.setView3d(s),n.endEdit())}}},on3DDepth:function(t,e,i,o){if(this.api){var n=this.api.asc_getChartObject(!0);if(n){var s=n.getView3d();s&&(s.asc_setDepth(t.getNumberValue()),n.startEdit(),n.setView3d(s),n.endEdit())}}},on3DHeight:function(t,e,i,o){if(this.api){var n=this.api.asc_getChartObject(!0);if(n){var s=n.getView3d();s&&(s.asc_setHeight(t.getNumberValue()),n.startEdit(),n.setView3d(s),n.endEdit())}}},onDefRotation:function(){if(this.api){var t=this.api.asc_getChartObject(!0);if(t){var e=t.getView3d();e&&(e.asc_setRotX(20),e.asc_setRotY(15),t.startEdit(),t.setView3d(e),t.endEdit())}}},setLocked:function(t){this._locked=t},disableControls:function(t){this._initSettings||this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.linkAdvanced.toggleClass("disabled",t))}},SSE.Views.ChartSettings||{}))})),define("text!spreadsheeteditor/main/app/template/ShapeSettings.template",[],(function(){return'<table cols="1" role="presentation">\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.strFill %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="shape-combo-fill-src" style="width: 100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <div id="shape-panel-color-fill" class="padding-small" style="width: 100%;">\r\n                <div id="shape-back-color-btn" style=""></div>\r\n            </div>\r\n            <div id="shape-panel-image-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <table cols="2" style="width: 100%;" role="presentation">\r\n                <tr>\r\n                    <td colspan="2" class="padding-small">\r\n                        <div id="shape-button-replace" style="width:100%;"></div>\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <td style="vertical-align: top">\r\n                        <div id="shape-combo-fill-type" style="width: 90px;"></div>\r\n                    </td>\r\n                    <td rowspan="2">\r\n                        <div class="texture-img float-right">\r\n                            <div id="shape-texture-img" style="width: 50px;height: 50px;"></div>\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <td style="vertical-align: bottom">\r\n                        <label class="input-label" style=""><%= scope.textTexture %></label>\r\n                        <div id="shape-combo-fill-texture" style="width: 90px;"></div>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n            </div>\r\n            <div id="shape-panel-pattern-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <label class="input-label" style="margin-top: 3px;"><%= scope.strPattern %></label>\r\n                <div id="shape-combo-pattern" style="width: 100%; height: 42px; margin-bottom: 8px;"></div>\r\n                <div style="width: 100%; height: 25px; margin-bottom: 8px;">\r\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.strForeground %></label>\r\n                    <div id="shape-foreground-color-btn" class="float-right"></div>\r\n                </div>\r\n                <div style="width: 100%; height: 25px;">\r\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.strBackground %></label>\r\n                    <div id="shape-background-color-btn" class="float-right"></div>\r\n                </div>\r\n            </div>\r\n            <div id="shape-panel-gradient-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <table cols="3" style="margin-bottom: 10px;" role="presentation">\r\n                    <tr valign="top">\r\n                        <td colspan="2">\r\n                            <div>\r\n                                <label class="input-label" style=""><%= scope.textStyle %></label>\r\n                                <div id="shape-combo-grad-type" style="width: 100%;"></div>\r\n                            </div>\r\n                        </td>\r\n                        <td rowspan="2" style="width: 100%;">\r\n                            <div class="float-right">\r\n                                <label class="input-label"><%= scope.textDirection %></label>\r\n                                <div id="shape-button-direction"></div>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                    <tr valign="bottom">\r\n                        <td>\r\n                            <label class="input-label angle-label"><%= scope.textAngle %></label>\r\n                        </td>\r\n                        <td>\r\n                            <div id="shape-spin-gradient-angle" style="display: inline-block; width: 60px;"></div>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n                <label class="input-label" style="display:block;margin-bottom: 5px;"><%= scope.textGradient %></label>\r\n                <div style="display: inline-block; margin-top: 3px;">\r\n                    <div id="shape-slider-gradient" style="display: inline-block; vertical-align: middle;"></div>\r\n                </div>\r\n                <div style="height: 40px;margin-top:6px;display:flex;justify-content:space-between;">\r\n                    <div style="display: flex;">\r\n                    <div style="">\r\n                        <label class="input-label" style=""><%= scope.strColor %></label>\r\n                        <div id="shape-gradient-color-btn"></div>\r\n                    </div>\r\n                    <div class="margin-left-10">\r\n                        <label class="input-label" style=""><%= scope.textPosition %></label>\r\n                        <div id="shape-gradient-position"></div>\r\n                    </div>\r\n                    </div>\r\n                    <div style="display:flex;padding-top:15px;">\r\n                        <div id="shape-gradient-add-step"></div>\r\n                        <div id="shape-gradient-remove-step"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <div class="padding-small" id="shape-panel-transparent-fill" style="width: 100%;">\r\n                <label class="header" style="display:block;"><%= scope.strTransparency %></label>\r\n                <div style="display: inline-block; margin-top: 3px;">\r\n                    <label id="shape-lbl-transparency-start">0</label>\r\n                    <div id="shape-slider-transparency" style="display: inline-block;margin: 0 4px; vertical-align: middle;"></div>\r\n                    <label id="shape-lbl-transparency-end">100</label>\r\n                </div>\r\n                <div id="shape-spin-transparency" class="float-right"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.strStroke %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n        <div style="display:inline-block;width:100px;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strSize %></label>\r\n            <div id="shape-combo-border-size" style="width: 93px;"></div>\r\n        </div>\r\n        <div style="display:inline-block;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strColor %></label>\r\n            <div id="shape-border-color-btn" style=""></div>\r\n        </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n        <div style="display:inline-block;width:100px;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strType %></label>\r\n            <div id="shape-combo-border-type" style="width: 93px;"></div>\r\n        </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <div class="padding-small" id="shape-line-panel-transparent-fill" style="width: 100%;">\r\n                <label class="header" style="display:block;"><%= scope.strTransparency %></label>\r\n                <div style="display: inline-block; margin-top: 3px;">\r\n                    <label id="shape-line-lbl-transparency-start">0</label>\r\n                    <div id="shape-line-slider-transparency" style="display: inline-block;margin: 0 4px; vertical-align: middle;"></div>\r\n                    <label id="shape-line-lbl-transparency-end">100</label>\r\n                </div>\r\n                <div id="shape-line-spin-transparency" class="float-right"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-rotation">\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-rotation">\r\n        <td class="padding-small">\r\n            <label class="header"><%= scope.textRotation %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-rotation">\r\n        <td>\r\n            <table cols="2" style="width: 100%;" role="presentation">\r\n                <tr>\r\n                    <td class="padding-small" width="50%">\r\n                        <label class="input-label"><%= scope.textRotate90 %></label>\r\n                        <div>\r\n                            <div id="shape-button-270" class="margin-right-4"></div>\r\n                            <div id="shape-button-90"></div>\r\n                        </div>\r\n                    </td>\r\n                    <td class="padding-small" width="50%">\r\n                        <label class="input-label"><%= scope.textFlip %></label>\r\n                        <div>\r\n                            <div id="shape-button-fliph" class="margin-right-4"></div>\r\n                            <div id="shape-button-flipv"></div>\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n        </td>\r\n    </tr>\r\n    <tr class="change-type">\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="change-type">\r\n        <td>\r\n            <div class="padding-small" id="shape-button-edit-shape-container">\r\n                <div id="shape-button-edit-shape" style="width:100%;"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr class="change-type">\r\n        <td>\r\n            <div class="padding-small" id="shape-button-change-shape-container">\r\n                <div id="shape-button-change-shape" style="width:100%;"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr class="change-type">\r\n        <td class="padding-small" colspan=2>\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="change-type">\r\n        <td>\r\n            <div class="padding-small" id="shape-button-shadow-shape" style="width:100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-only">\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="shape-only">\r\n        <td align="center">\r\n            <label class="link canfocused" id="shape-advanced-link" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.textAdvanced %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'})),void 0===Common)var Common={};if(define("common/main/lib/component/ComboBorderSize",["common/main/lib/component/ComboBox"],(function(){"use strict";Common.UI.BordersModel=Backbone.Model.extend({defaults:function(){return{value:null,displayValue:null,pxValue:null,id:Common.UI.getId(),imgId:void 0}}}),Common.UI.BordersStore=Backbone.Collection.extend({model:Common.UI.BordersModel}),Common.UI.ComboBorderSize=Common.UI.ComboBox.extend(_.extend({template:_.template(['<div class="input-group combobox combo-border-size input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<div class="form-control" style="<%= style %>" role="combobox" aria-expanded="false" aria-controls="<%= id %>-menu" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" data-move-focus-only-tab="true">','<i class="img-line"><svg><use xlink:href="#half-pt"></use></svg></i>','<span class="text"></span>',"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul id="<%= id %>-menu" class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>" role="menuitem"><a tabindex="-1" type="menuitem">',"<span><%= item.displayValue %></span>","<% if(item.imgId!==undefined) { %>",'<span class="border-line">',"<svg>",'<use xlink:href="#<%= item.imgId %>"></use>',"</svg>","</span>","<% } %>","</a></li>","<% }); %>","</ul>","</div>"].join("")),initialize:function(t){var e=Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt),i=[{displayValue:"0.5 "+e,value:.5,pxValue:.5,imgId:"half-pt"},{displayValue:"1 "+e,value:1,pxValue:1,imgId:"one-pt"},{displayValue:"1.5 "+e,value:1.5,pxValue:2,imgId:"one-and-half-pt"},{displayValue:"2.25 "+e,value:2.25,pxValue:3,imgId:"two-and-quarter-pt"},{displayValue:"3 "+e,value:3,pxValue:4,imgId:"three-pt"},{displayValue:"4.5 "+e,value:4.5,pxValue:6,imgId:"four-and-half-pt"},{displayValue:"6 "+e,value:6,pxValue:8,imgId:"six-pt"}];!1!==t.allowNoBorders&&i.unshift({displayValue:this.txtNoBorders,value:0,pxValue:0}),Common.UI.ComboBox.prototype.initialize.call(this,_.extend({editable:!1,store:new Common.UI.BordersStore,data:i,menuStyle:"min-width: 160px;"},t))},render:function(t){return Common.UI.ComboBox.prototype.render.call(this,t),this._formControl=this.cmpEl.find(".form-control"),this},itemClicked:function(t){var e=$(t.currentTarget).parent();if(this._selectedItem=this.store.findWhere({id:e.attr("id")}),this._selectedItem){var i=$(".selected",$(this.el));i.removeClass("selected"),i.attr("aria-checked",!1),e.addClass("selected"),e.attr("aria-checked",!0),this.updateFormControl(this._selectedItem),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),t),t.preventDefault()}},updateFormControl:function(t){var e=$(this.el).find(".form-control"),i=e.find("> .img-line"),o=e.find("> .text");if(t.get("value")>0){var n=e.find("use");n.length>0&&n[0].setAttribute("xlink:href","#"+t.get("imgId")),i.show(),o.hide()}else i.hide(),o.text(this.txtNoBorders).show()},setValue:function(t){this._selectedItem=null==t?void 0:_.find(this.store.models,(function(e){if(t<e.attributes.value+.01&&t>e.attributes.value-.01)return!0}));var e=$(".selected",$(this.el));if(e.removeClass("selected"),e.attr("aria-checked",!1),this._selectedItem){this.updateFormControl(this._selectedItem);var i=$("#"+this._selectedItem.get("id"),$(this.el));i.addClass("selected"),i.attr("aria-checked",!0)}else $(this.el).find(".form-control > .text").text("").show()},focus:function(){this._formControl&&this._formControl.focus()},txtNoBorders:"No Borders"},Common.UI.ComboBorderSize||{})),Common.UI.ComboBorderSizeEditable=Common.UI.ComboBox.extend(_.extend({template:_.template(['<span class="input-group combobox combo-border-size input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<input type="text" class="form-control text" role="combobox" aria-expanded="false" aria-controls="<%= id %>-menu" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>">','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul id="<%= id %>-menu" class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>" role="menuitem"><a tabindex="-1" type="menuitem">',"<% if (!isRTL) { %>","<span><%= item.displayValue %></span>","<% if (item.imgId!==undefined) { %>",'<span class="border-line">',"<svg>",'<use xlink:href="#<%= item.imgId %>"></use>',"</svg>","</span>","<% } %>","<% } else { %>","<% if (item.imgId!==undefined) { %>",'<span class="border-line">',"<svg>",'<use xlink:href="#<%= item.imgId %>"></use>',"</svg>","</span>","<% } %>","<span><%= item.displayValue %></span>","<% } %>","</a></li>","<% }); %>","</ul>","</span>"].join("")),initialize:function(t){this.txtNoBorders=t.txtNoBorders||this.txtNoBorders;var e=Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt),i=[{displayValue:"0.5 "+e,value:.5,pxValue:.5,imgId:"half-pt"},{displayValue:"1 "+e,value:1,pxValue:1,imgId:"one-pt"},{displayValue:"1.5 "+e,value:1.5,pxValue:2,imgId:"one-and-half-pt"},{displayValue:"2.25 "+e,value:2.25,pxValue:3,imgId:"two-and-quarter-pt"},{displayValue:"3 "+e,value:3,pxValue:4,imgId:"three-pt"},{displayValue:"4.5 "+e,value:4.5,pxValue:6,imgId:"four-and-half-pt"},{displayValue:"6 "+e,value:6,pxValue:8,imgId:"six-pt"}];!1!==t.allowNoBorders&&i.unshift({displayValue:this.txtNoBorders,value:0,pxValue:0}),Common.UI.ComboBox.prototype.initialize.call(this,_.extend({editable:!0,store:new Common.UI.BordersStore,data:i,menuStyle:"min-width: 160px;"},t))},render:function(t){return Common.UI.ComboBox.prototype.render.call(this,t),this},txtNoBorders:"No Borders"},Common.UI.ComboBorderSizeEditable||{})),Common.UI.ComboBorderType=Common.UI.ComboBorderSize.extend(_.extend({template:_.template(['<div class="input-group combobox combo-border-size combo-border-type input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<div class="form-control canfocused" style="<%= style %>" role="combobox" aria-expanded="false" aria-controls="<%= id %>-menu" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>" data-move-focus-only-tab="true">','<i class="img-line"><svg><use xlink:href="#solid"></use></svg></i>',"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul id="<%= id %>-menu" class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>" role="menuitem"><a tabindex="-1" type="menuitem">',"<% if (item.imgId!==undefined) { %>","<span>",'<svg><use xlink:href="#<%= item.imgId %>"></use></svg>',"</span>","<% } %>","</a></li>","<% }); %>","</ul>","</div>"].join("")),initialize:function(t){Common.UI.ComboBorderSize.prototype.initialize.call(this,_.extend({store:new Common.UI.BordersStore,data:[{value:Asc.c_oDashType.solid,imgId:"solid"},{value:Asc.c_oDashType.sysDot,imgId:"dots"},{value:Asc.c_oDashType.sysDash,imgId:"dashes"},{value:Asc.c_oDashType.dash,imgId:"dashes-spaced"},{value:Asc.c_oDashType.dashDot,imgId:"dash-dot"},{value:Asc.c_oDashType.lgDash,imgId:"dashes-wide"},{value:Asc.c_oDashType.lgDashDot,imgId:"wide-dash-dot"},{value:Asc.c_oDashType.lgDashDotDot,imgId:"wide-dash-dot-dot"}]},t))},render:function(t){return Common.UI.ComboBorderSize.prototype.render.call(this,t),this},updateFormControl:function(t){if(t){var e=$(this.el).find(".form-control > .img-line use");if(e.length){var i=Math.ceil(t.get("pxValue"));i=i||3,e[0].setAttribute("xlink:href","#"+t.get("imgId")),e.parent().css("height",i+"px")}$(this.el).find(".form-control > .img-line").show()}else $(this.el).find(".form-control > .img-line").hide()},setValue:function(t){this._selectedItem=null==t?void 0:_.find(this.store.models,(function(e){if(t<e.attributes.value+.01&&t>e.attributes.value-.01)return!0}));var e=$(".selected",$(this.el));if(e.removeClass("selected"),e.attr("aria-checked",!1),this.updateFormControl(this._selectedItem),this._selectedItem){var i=$("#"+this._selectedItem.get("id"),$(this.el));i.addClass("selected"),i.attr("aria-checked",!0)}}},Common.UI.ComboBorderType||{})),Common.UI.ComboBoxColor=Common.UI.ComboBox.extend(_.extend({template:_.template(['<div class="input-group combobox combo-color combobox-color input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<div class="form-control" style="<%= style %>" role="combobox" aria-expanded="false" aria-controls="<%= id %>-menu">',"<div></div>","</div>",'<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul id="<%= id %>-menu" class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>","<% if (item.value==-1) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>" role="menuitem"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% } else { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>" role="option">','<a tabindex="-1" type="menuitem"><div style="<%= item.styleStr %>"><%= scope.getDisplayValue(item) %></div></a>',"</li>","<% } %>","<% }); %>","</ul>","</div>"].join("")),render:function(t){return Common.UI.ComboBox.prototype.render.call(this,t),this._formControl=this.cmpEl.find(".form-control"),this.disabled&&this.setDisabled(this.disabled),this},itemClicked:function(t){var e=$(t.currentTarget).parent();if(this._selectedItem=this.store.findWhere({id:e.attr("id")}),this._selectedItem){var i=$(".selected",$(this.el));i.removeClass("selected"),i.attr("aria-checked",!1),e.addClass("selected"),e.attr("aria-checked",!0),this.updateFormControl(this._selectedItem),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),t),t.preventDefault()}},updateFormControl:function(t){var e=$(this.el).find(".form-control > div");e[0].innerHTML=t.get("displayValue"),-1!=t.get("value")?(e.css({"margin-top":"0"}),e.css(t.get("styleObj"))):(e.css({"margin-top":"1px"}),e.css(t.get("styleObj")))},setValue:function(t){var e;this._selectedItem=this.store.findWhere(((e={})[this.valueField]=t,e));var i=$(".selected",$(this.el));if(i.removeClass("selected"),i.attr("aria-checked",!1),this._selectedItem){this.updateFormControl(this._selectedItem);var o=$("#"+this._selectedItem.get("id"),$(this.el));o.addClass("selected"),o.attr("aria-checked",!0)}else{var n=$(this.el).find(".form-control > div");n[0].innerHTML=t,n.css("margin-top","1px"),n.css({color:"","text-align":"",background:"",border:""})}},onResetItems:function(){this.itemsTemplate?$(this.el).find("ul").html($(this.itemsTemplate({items:this.store.toJSON(),scope:this}))):$(this.el).find("ul").html(_.template(["<% _.each(items, function(item) { %>","<% if (item.value==-1) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>" role="menuitem"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% } else { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>" role="menuitem">','<a tabindex="-1" type="menuitem""><div style="<%= item.styleStr %>"><%= scope.getDisplayValue(item) %></div></a>',"</li>","<% } %>","<% }); %>"].join(""))({items:this.store.toJSON(),scope:this})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.scroller=new Common.UI.Scroller(_.extend({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,includePadding:!0,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible},this.options.scroller))},setTabIndex:function(t){this.rendered&&(this.tabindex=t.toString(),!this.disabled&&this._formControl&&this._formControl.attr("tabindex",this.tabindex))},setDisabled:function(t){t=!!t,this.disabled=t,this.rendered&&this._formControl&&(void 0!==this.tabindex&&(t&&(this.tabindex=this._formControl.attr("tabindex")),this._formControl.attr("tabindex",t?"-1":this.tabindex)),this.cmpEl.toggleClass("disabled",t),this._button.toggleClass("disabled",t),this._formControl.toggleClass("disabled",t))},focus:function(){this._formControl&&this._formControl.focus()}},Common.UI.ComboBoxColor||{})),Common.UI.ComboBoxIcons=Common.UI.ComboBox.extend(_.extend({template:_.template(['<div class="input-group combobox combobox-icons combo-color input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">','<div class="form-control" style="<%= style %>" role="combobox" aria-expanded="false" aria-controls="<%= id %>-menu">',"<div></div>","</div>",'<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul id="<%= id %>-menu" class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">',"<% _.each(items, function(item) { %>","<% if (item.value==-1) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>" role="menuitem"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% } else { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>" role="menuitem">','<a tabindex="-1" type="menuitem">',"<% _.each(item.data.iconSet, function(icon) { %>","<img src=\"<%= item.data.icons.at(icon-1).get('icon') %>\">","<% }) %>","</a>","</li>","<% } %>","<% }); %>","</ul>","</div>"].join("")),render:function(t){return Common.UI.ComboBox.prototype.render.call(this,t),this._formControl=this.cmpEl.find(".form-control"),this},itemClicked:function(t){var e=$(t.currentTarget).parent();if(this._selectedItem=this.store.findWhere({id:e.attr("id")}),this._selectedItem){var i=$(".selected",$(this.el));i.removeClass("selected"),i.attr("aria-checked",!1),e.addClass("selected"),e.attr("aria-checked",!0),this.updateFormControl(this._selectedItem),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),t),t.preventDefault()}},updateFormControl:function(t){var e=$(this.el).find(".form-control > div");if(-1!=t.get("value")){var i="";_.each(t.get("data").iconSet,(function(e){i+='<img src="'+t.get("data").icons.at(e-1).get("icon")+'">'})),e[0].innerHTML=i,e.css({"margin-top":"0"})}else e[0].innerHTML=t.get("displayValue"),e.css({"margin-top":"1px"})},setValue:function(t){var e;this._selectedItem=this.store.findWhere(((e={})[this.valueField]=t,e));var i=$(".selected",$(this.el));if(i.removeClass("selected"),i.attr("aria-checked",!1),this._selectedItem){this.updateFormControl(this._selectedItem);var o=$("#"+this._selectedItem.get("id"),$(this.el));o.addClass("selected"),o.attr("aria-checked",!0)}else{var n=$(this.el).find(".form-control > div");n[0].innerHTML=t,n.css({"margin-top":"1px"})}},onResetItems:function(){this.itemsTemplate?$(this.el).find("ul").html($(this.itemsTemplate({items:this.store.toJSON(),scope:this}))):$(this.el).find("ul").html(_.template(["<% _.each(items, function(item) { %>","<% if (item.value==-1) { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>" role="menuitem"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>',"<% } else { %>",'<li id="<%= item.id %>" data-value="<%= item.value %>" role="menuitem">','<a tabindex="-1" type="menuitem" style="padding: 5px;">',"<% _.each(item.data.iconSet, function(icon) { %>","<img src=\"<%= item.data.icons.at(icon-1).get('icon') %>\">","<% }) %>","</a>","</li>","<% } %>","<% }); %>"].join(""))({items:this.store.toJSON(),scope:this})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.scroller=new Common.UI.Scroller(_.extend({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,includePadding:!0,wheelSpeed:10,alwaysVisibleY:this.scrollAlwaysVisible},this.options.scroller))},focus:function(){this._formControl&&this._formControl.focus()}},Common.UI.ComboBoxIcons||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/ColorButton",["common/main/lib/component/Button","common/main/lib/component/ThemeColorPalette"],(function(){"use strict";Common.UI.ButtonColored=Common.UI.Button.extend(_.extend({render:function(t){Common.UI.Button.prototype.render.call(this,t);var e="box"===this.options.colorLine?"btn-color-value-box":"btn-color-value-line";if(/huge/.test(this.options.cls)&&!0===this.options.split&&!1!==this.options.colorLine){var i=$("button",this.cmpEl),o=$(i[1]);o&&o.append($('<div class="'+e+'"></div>'))}else!1!==this.options.colorLine&&$("button:first-child",this.cmpEl).append($('<div class="'+e+'"></div>'));this.colorEl=this.cmpEl.find("."+e),this.options.auto&&(this.autocolor="object"==_typeof(this.options.auto)&&this.options.auto.color||"000000"),void 0!==this.options.color&&this.setColor(this.options.color)},getPicker:function(t,e){if(!this.colorPicker){var i={el:this.cmpEl.find("#"+this.menu.id+"-color-menu"),value:t,colors:e};void 0!==this.options.transparent&&(i.transparent=this.options.transparent),void 0!==this.options.hideEmptyColors&&(i.hideEmptyColors=this.options.hideEmptyColors),void 0!==this.options.themecolors&&(i.themecolors=this.options.themecolors),void 0!==this.options.effects&&(i.effects=this.options.effects),void 0!==this.options.colorHints&&(i.colorHints=this.options.colorHints),void 0!==this.options.paletteCls&&(i.cls=this.options.paletteCls),void 0!==this.options.storageSuffix&&(i.storageSuffix=this.options.storageSuffix),this.colorPicker=new Common.UI.ThemeColorPalette(i),this.colorPicker.on("select",_.bind(this.onColorSelect,this)),this.colorPicker.on("close:extended",_.bind(this.onCloseExtentedColor,this)),this.cmpEl.find("#"+this.menu.id+"-color-new").on("click",_.bind(this.addNewColor,this)),this.options.auto&&(this.cmpEl.find("#"+this.menu.id+"-color-auto").on("click",_.bind(this.onAutoColorSelect,this)),this.colorAuto=this.cmpEl.find("#"+this.menu.id+"-color-auto > a"),"auto"==t&&this.setAutoColor(!0)),this.options.eyeDropper&&this.cmpEl.find("#"+this.menu.id+"-eyedropper").on("click",_.bind(this.onEyedropperStart,this)),this.initInnerMenu()}return this.colorPicker},setPicker:function(t){this.colorPicker=t},getMenu:function(t){if("object"!==_typeof(this.menu)){var e=(t=t||this.options).paletteHeight?t.paletteHeight+"px":"auto",i=t.paletteWidth?t.paletteWidth+"px":"164px",o=Common.UI.getId(),n=[],s=[];t.auto&&(this.autocolor="object"==_typeof(t.auto)&&t.auto.color||"000000",n.push({id:o+"-color-auto",caption:"object"==_typeof(t.auto)&&t.auto.caption||this.textAutoColor,template:_.template('<a tabindex="-1" type="menuitem"><span class="menu-item-icon color-auto" style="background-color: #'+this.autocolor+';"></span><%= caption %></a>')}),n.push({caption:"--"})),t.eyeDropper&&s.push({id:o+"-eyedropper",caption:this.textEyedropper,iconCls:"menu__icon btn-eyedropper"});var a=new Common.UI.Menu({id:o,cls:"color-menu "+(t.eyeDropper?"shifted-right":"shifted-left"),additionalAlign:t.additionalAlign,items:(t.additionalItemsBefore?t.additionalItemsBefore:[]).concat(n).concat([{template:_.template('<div id="'+o+'-color-menu" style="width: '+i+"; height:"+e+'; display: inline-block;"></div>')}]).concat(t.hideColorsSeparator?[]:{caption:"--"}).concat(s).concat([{id:o+"-color-new",template:_.template('<a tabindex="-1" type="menuitem" style="">'+this.textNewColor+"</a>")}]).concat(t.additionalItemsAfter?t.additionalItemsAfter:[])});this.initInnerMenu();var r=this;return a.on("show:after",(function(e){r.colorPicker&&_.delay((function(){r.colorPicker.showLastSelected(),!t.additionalItemsBefore&&!t.auto&&r.colorPicker.focus()}),10)})),a}return this.menu},initInnerMenu:function(){if(this.colorPicker&&"object"===_typeof(this.menu)){var t=(this.options.additionalItemsBefore||[]).length+(this.options.auto?2:0);this.colorPicker.outerMenu={menu:this.menu,index:t},this.menu.setInnerMenu([{menu:this.colorPicker,index:t}])}},setMenu:function(t,e){t=t||this.getMenu(),Common.UI.Button.prototype.setMenu.call(this,t),!e&&this.getPicker(this.options.color,this.options.colors)},onColorSelect:function(t,e){this.setColor(e),this.setAutoColor(!1),this.trigger("color:select",this,e)},onCloseExtentedColor:function(t,e){if(this.options.takeFocusOnClose){var i=this;setTimeout((function(){i.focus()}),1)}},setColor:function(t){"auto"==t&&this.options.auto&&(t=this.autocolor),this.color=t,this.colorEl&&(this.colorEl.css({"background-color":"transparent"==t?t:"object"==_typeof(t)?"#"+t.color:"#"+t}),this.colorEl.toggleClass("bordered","transparent"==t||"box"===this.options.colorLine))},setAutoColor:function(t){this.colorAuto&&(t&&!this.colorAuto.hasClass("selected")?this.colorAuto.addClass("selected"):!t&&this.colorAuto.hasClass("selected")&&this.colorAuto.removeClass("selected"))},isAutoColor:function(){return this.colorAuto&&this.colorAuto.hasClass("selected")},onAutoColorSelect:function(){this.setColor("auto"),this.setAutoColor(!0),this.colorPicker&&this.colorPicker.clearSelection(),this.trigger("auto:select",this,this.autocolor)},addNewColor:function(){this.colorPicker&&this.colorPicker.addNewColor("object"==_typeof(this.color)?this.color.color:this.color)},onEyedropperStart:function(){Common.NotificationCenter.trigger("eyedropper:start"),this.trigger("eyedropper:start",this)},eyedropperEnd:function(t,e,i){if(void 0!==t){var o=Common.Utils.ThemeColor.getHexColor(t,e,i);this.colorPicker.setCustomColor("#"+o),this.onColorSelect(this.colorPicker,o),this.trigger("eyedropper:end",this)}},isMenuOpen:function(){return this.cmpEl.hasClass("open")},focus:function(){$("button",this.cmpEl).focus()},textNewColor:"Add New Custom Color",textAutoColor:"Automatic",textEyedropper:"Eyedropper"},Common.UI.ButtonColored||{})),Common.UI.ColorButton=Common.UI.ButtonColored.extend(_.extend({options:{id:null,hint:!1,enableToggle:!1,allowDepress:!1,toggleGroup:null,cls:"",iconCls:"",caption:"",menu:null,disabled:!1,pressed:!1,split:!1,visible:!0},template:_.template(['<div class="btn-group" id="<%= id %>">','<button type="button" class="btn btn-color dropdown-toggle <%= cls %>" data-toggle="dropdown" style="<%= style %>" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>">',"<span>&nbsp;</span>",'<span class="inner-box-caret">','<i class="caret"></i>',"</span>","</button>","</div>"].join("")),initialize:function(t){if(!t.menu&&!1!==t.menu){var e=this;t.menu=e.getMenu(t),e.on("render:after",(function(i){e.getPicker(t.color,t.colors)}))}Common.UI.Button.prototype.initialize.call(this,t)},render:function(t){Common.UI.Button.prototype.render.call(this,t),this.options.auto&&(this.autocolor="object"==_typeof(this.options.auto)&&this.options.auto.color||"000000"),void 0!==this.options.color&&this.setColor(this.options.color),this.options.ariaLabel&&$("button",this.cmpEl).attr("aria-label",this.options.ariaLabel)},setColor:function(t){"auto"==t&&this.options.auto&&(t=this.autocolor);var e=$(this.cmpEl).find("button span:nth-child(1)");this.color=t,e.toggleClass("color-transparent","transparent"==t),e.css({"background-color":"transparent"==t?t:"object"==_typeof(t)?"#"+t.color:"#"+t})},focus:function(){$("button",this.cmpEl).focus()}},Common.UI.ColorButton||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/Slider",["common/main/lib/component/BaseView","underscore"],(function(t,e){"use strict";Common.UI.SingleSlider=Common.UI.BaseView.extend({options:{width:100,minValue:0,maxValue:100,step:1,value:100,enableKeyEvents:!1,direction:"horizontal"},disabled:!1,template:e.template(['<div class="slider single-slider <% if (this.options.direction === \'vertical\') { %>vertical<% } %>" style="">','<div class="track"></div>','<div class="thumb" style=""></div>',"<% if (this.options.enableKeyEvents) { %>",'<input type="text" style="position: absolute; top:-10px; width: 1px; height: 1px;">',"<% } %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.width=e.options.width,e.minValue=e.options.minValue,e.maxValue=e.options.maxValue,e.delta=100/(e.maxValue-e.minValue),e.step=e.options.step,e.direction=e.options.direction,e.options.el&&e.render(),this.setValue(e.options.value)},render:function(t){var i=this;i.rendered?this.cmpEl=i.$el:(this.cmpEl=$(this.template({})),t?(this.setElement(t,!1),t.html(this.cmpEl)):i.$el.html(this.cmpEl)),this.cmpEl.find(".track-center").width(i.options.width-14),this.cmpEl["vertical"===i.direction?"height":"width"](i.options.width),this.track=this.cmpEl.find(".track"),this.thumb=this.cmpEl.find(".thumb");var o,n=function(t){t.preventDefault(),t.stopPropagation();var e=Math.max(0,Math.min(100,Math.round(("vertical"===i.direction?t.pageY*Common.Utils.zoom()-Common.Utils.getOffset(i.cmpEl).top:t.pageX*Common.Utils.zoom()-Common.Utils.getOffset(i.cmpEl).left-i._dragstart)/i.width*100)));i.setThumbPosition(e),i.lastValue=i.value,i.value=e/i.delta+i.minValue,i.thumb.removeClass("active"),$(document).off("mouseup",n),$(document).off("mousemove",s),i._dragstart=void 0,i.trigger("changecomplete",i,Common.UI.isRTL()?i.maxValue-i.value:i.value,i.lastValue)},s=function(t){if(!i.disabled&&void 0!==i._dragstart){t.preventDefault(),t.stopPropagation();var e=Math.max(0,Math.min(100,Math.round(("vertical"===i.direction?t.pageY*Common.Utils.zoom()-Common.Utils.getOffset(i.cmpEl).top:t.pageX*Common.Utils.zoom()-Common.Utils.getOffset(i.cmpEl).left-i._dragstart)/i.width*100)));i.setThumbPosition(e),i.lastValue=i.value,i.value=e/i.delta+i.minValue,Math.abs(i.value-i.lastValue)>.001&&i.trigger("change",i,Common.UI.isRTL()?i.maxValue-i.value:i.value,i.lastValue)}},a=function(t){i.lastValue=i.value,i.value=Math.max(i.minValue,Math.min(i.maxValue,i.value+(t?i.step:-i.step))),i.setThumbPosition(Math.round((i.value-i.minValue)*i.delta)),i.trigger("change",i,Common.UI.isRTL()?i.maxValue-i.value:i.value,i.lastValue)},r=function(t){i.disabled||t.keyCode!=Common.UI.Keys.UP&&t.keyCode!=Common.UI.Keys.DOWN&&t.keyCode!=Common.UI.Keys.LEFT&&t.keyCode!=Common.UI.Keys.RIGHT||(t.preventDefault(),t.stopPropagation(),l.off("keydown","input",r),o=setInterval(e.bind(a,i,t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.RIGHT),100))};if(!i.rendered){var l=i.cmpEl;l.on("mousedown",".thumb",(function(t){i.disabled||(i._dragstart="vertical"===i.direction?t.pageY*Common.Utils.zoom()-Common.Utils.getOffset(i.thumb).top:t.pageX*Common.Utils.zoom()-Common.Utils.getOffset(i.thumb).left-6,i.thumb.addClass("active"),$(document).on("mouseup",n),$(document).on("mousemove",s),i.options.enableKeyEvents&&setTimeout((function(){i.input.focus()}),10))})),l.on("mousedown",".track",(function(t){if(!i.disabled){var e=Math.max(0,Math.min(100,Math.round(("vertical"===i.direction?t.pageY*Common.Utils.zoom()-Common.Utils.getOffset(i.cmpEl).top:t.pageX*Common.Utils.zoom()-Common.Utils.getOffset(i.cmpEl).left)/i.width*100)));i.setThumbPosition(e),i.lastValue=i.value,i.value=e/i.delta+i.minValue,i.trigger("change",i,Common.UI.isRTL()?i.maxValue-i.value:i.value,i.lastValue),i.trigger("changecomplete",i,Common.UI.isRTL()?i.maxValue-i.value:i.value,i.lastValue)}})),this.options.enableKeyEvents&&(i.input=l.find("input"),l.on("keydown","input",r),l.on("keyup","input",(function(t){i.disabled||(t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.DOWN||Common.UI.Keys.LEFT||Common.UI.Keys.RIGHT)&&(t.stopPropagation(),t.preventDefault(),clearInterval(o),a(t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.RIGHT),l.on("keydown","input",r),i.trigger("changecomplete",i,Common.UI.isRTL()?i.maxValue-i.value:i.value,i.lastValue))})))}var c=this.thumb.width()/2,h=2*-c;this.thumbRange=new Float32Array(101);for(var d=0;d<101;d++)this.thumbRange[d]=c+h*(d/100);return this.setThumbPosition(i.options.value),i.rendered=!0,this},setThumbPosition:function(t){("number"!=typeof t||isNaN(t))&&(t=0);var e=t/100*this.width+this.thumbRange[t];this.track.css("--slider-unfill-percent",100-t+"%"),this.thumb.css("vertical"===this.direction?"top":"left",e+"px")},setValue:function(t){this.lastValue=this.value,this.value=Math.max(this.minValue,Math.min(this.maxValue,t)),this.setThumbPosition(Math.round(((Common.UI.isRTL()?this.maxValue-t:t)-this.minValue)*this.delta))},getValue:function(){return this.value},setDisabled:function(t){(t=!!t)!==this.disabled&&this.cmpEl.toggleClass("disabled",t),this.disabled=t}}),Common.UI.MultiSlider=Common.UI.BaseView.extend({options:{width:100,minValue:0,maxValue:100,values:[0,100],includeSnap:!1,intervalSnap:void 0,thumbTemplate:'<div class="thumb" style=""></div>'},disabled:!1,template:e.template(['<div class="slider multi-slider">','<div class="track">','<div class="track-left"></div>','<div class="track-center""></div>','<div class="track-right" style=""></div>',"</div>","<% _.each(items, function(item) { %>","<%= thumbTemplate %>","<% }); %>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.width=e.options.width,e.minValue=e.options.minValue,e.maxValue=e.options.maxValue,e.delta=100/(e.maxValue-e.minValue),e.includeSnap=e.options.includeSnap,e.intervalSnap=e.options.intervalSnap,e.thumbs=[],e.options.el&&e.render()},render:function(t){var i=this;i.rendered?this.cmpEl=this.$el:(this.cmpEl=$(this.template({items:this.options.values,thumbTemplate:this.options.thumbTemplate})),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl));var o=this.cmpEl;o.find(".track-center").width(i.options.width-14),o.width(i.options.width);var n=function(t){i.includeSnap&&e.each(i.centers,(function(e){t.pageX<=e+i.intervalSnap&&t.pageX>=e-i.intervalSnap&&(t.pageX=e)}))},s=function(t){for(var e,o=100,n=0,s=i.thumbs.length,a=0;a<s;a++)if(e=Math.abs(i.thumbs[a].position-t),Math.abs(e<=o)){var r=i.thumbs[a+1],l=i.thumbs[a-1];if(void 0!==l&&t<l.position)continue;if(void 0!==r&&t>r.position)continue;n=a,o=e}return n};return this.binding={onMouseUp:e.bind((function(t){t.preventDefault(),t.stopPropagation(),n(t);var o=t.data.index,s=i.thumbs[o].value,a=o-1<0?0:i.thumbs[o-1].position,r=o+1<i.thumbs.length?i.thumbs[o+1].position:100,l=Math.round((t.pageX*Common.Utils.zoom()-Common.Utils.getOffset(i.cmpEl).left-i._dragstart)/i.width*100),c=l<a||l>r,h=Math.max(0,Math.min(100,l)),d=h/i.delta+i.minValue;i.thumbs.length<3&&(i.isRemoveThumb=!1),i.isRemoveThumb?(i.trigger("removethumb",i,e.findIndex(i.thumbs,{index:o})),i.trigger("change",i,d,s),i.trigger("changecomplete",i,d,s)):(i.setThumbPosition(o,h),i.thumbs[o].value=d,c&&i.sortThumbs()),$(document).off("mouseup",i.binding.onMouseUp),$(document).off("mousemove",i.binding.onMouseMove),i._dragstart=void 0,!i.isRemoveThumb&&i.trigger("changecomplete",i,d,s),i.isRemoveThumb=void 0}),this),onMouseMove:e.bind((function(t){if(!i.disabled&&void 0!==i._dragstart){t.preventDefault(),t.stopPropagation(),n(t);var e=t.data.index,o=i.thumbs[e].value,s=e-1<0?0:i.thumbs[e-1].position,a=e+1<i.thumbs.length?i.thumbs[e+1].position:100,r=Math.round((t.pageX*Common.Utils.zoom()-Common.Utils.getOffset(i.cmpEl).left-i._dragstart)/i.width*100),l=r<s||r>a,c=Math.max(0,Math.min(100,r)),h=c/i.delta+i.minValue;i.setThumbPosition(e,c),i.thumbs[e].value=h,l&&i.sortThumbs();var d=t.pageY*Common.Utils.zoom()-Common.Utils.getOffset(i.cmpEl).top;i.isRemoveThumb=d>i.cmpEl.height()||d<0,i.setRemoveThumb(e,i.isRemoveThumb),Math.abs(h-o)>.001&&i.trigger("change",i,h,o)}}),this),onMouseDown:e.bind((function(t){if(!i.disabled){var o=t.data.index,n=i.thumbs[o].thumb;i._dragstart=t.pageX*Common.Utils.zoom()-Common.Utils.getOffset(n).left-6.5,function(t){if(i.includeSnap){var o=i.minValue,n=function(t){return(.01*i.width*t+Common.Utils.getOffset(i.cmpEl).left+i._dragstart)/Common.Utils.zoom()};i.centers=[],e.each(i.thumbs,(function(e,s){s!=t&&o!=e.position&&(i.centers.push(n((e.position-o)/2+o)),o=e.position)})),o!=i.maxValue&&i.centers.push(n((i.maxValue-o)/2+o))}}(o),i.setActiveThumb(o),e.each(i.thumbs,(function(t,e){o==e?t.thumb.css("z-index",500):t.thumb.css("z-index","")})),$(document).on("mouseup",null,t.data,i.binding.onMouseUp),$(document).on("mousemove",null,t.data,i.binding.onMouseMove)}}),this)},this.$thumbs=o.find(".thumb"),e.each(this.$thumbs,(function(t,e){var o=$(t);i.thumbs.push({thumb:o,index:e}),i.setValue(e,i.options.values[e]),o.on("mousedown",null,i.thumbs[e],i.binding.onMouseDown)})),i.setActiveThumb(0,!0),i.rendered||o.on("mouseup",".track",(function(t){if(!(i.disabled||!e.isUndefined(i._dragstart)||i.thumbs.length>9)){var o=Math.max(0,Math.min(100,Math.round((t.pageX*Common.Utils.zoom()-Common.Utils.getOffset(i.cmpEl).left)/i.width*100))),n=s(o),a=(i.thumbs[n].colorValue,i.thumbs[n].value,o/i.delta+i.minValue);i.addThumb();var r=i.thumbs.length-1;i.setThumbPosition(r,o),i.thumbs[r].value=a,i.trigger("addthumb",i,r,o),i.trigger("change",i),i.trigger("changecomplete",i)}})),i.rendered=!0,this},setActiveThumb:function(t,e){this.currentThumb=t,this.$thumbs=this.cmpEl.find(".thumb"),this.$thumbs.removeClass("active"),this.thumbs[t].thumb.addClass("active"),!0!==e&&this.trigger("thumbclick",this,t)},setRemoveThumb:function(t,i){-1!==e.findIndex(this.thumbs,{index:t})&&(i&&this.thumbs.length>2?this.$el.find(".active").addClass("remove"):this.$el.find(".remove").removeClass("remove"))},setThumbPosition:function(t,e){this.thumbs[t].position=e,this.thumbs[t].thumb.css({left:e+"%"})},setValue:function(t,e){this.thumbs[t].value=Math.max(this.minValue,Math.min(this.maxValue,e)),this.setThumbPosition(t,Math.round((e-this.minValue)*this.delta))},getValue:function(t){return this.thumbs[t].value},getValues:function(){var t=[];return e.each(this.thumbs,(function(e){t.push(e.value)})),t},setDisabled:function(t){(t=!!t)!==this.disabled&&this.cmpEl.toggleClass("disabled",t),this.disabled=t},sortThumbs:function(){this.thumbs.sort((function(t,e){return t.position-e.position}));var t=[];return e.each(this.thumbs,(function(e,i){t.push(e.index),e.index=i})),t},setThumbs:function(t){var e=this.thumbs.length;if(e!=t)for(var i=0;i<Math.abs(t-e);i++)e<t?this.addThumb():this.removeThumb()},addThumb:function(){var t=this.cmpEl,e=$(this.options.thumbTemplate),i=this.thumbs.length;t.append(e),this.thumbs.push({thumb:e,index:i}),i>0&&this.setValue(i,this.getValue(i-1)),e.on("mousedown",null,this.thumbs[i],this.binding.onMouseDown)},removeThumb:function(t){void 0===t&&(t=this.thumbs.length-1),t>0&&(this.thumbs[t].thumb.remove(),this.thumbs.splice(t,1))}})})),void 0===Common)var Common={};if(define("common/main/lib/component/MultiSliderGradient",["common/main/lib/component/Slider","underscore"],(function(t,e){"use strict";Common.UI.MultiSliderGradient=Common.UI.MultiSlider.extend({options:{width:100,minValue:0,maxValue:100,values:[0,100],colorValues:["#000000","#ffffff"],currentThumb:0,includeSnap:!0,intervalSnap:5,thumbTemplate:'<div class="thumb" style=""><canvas style="width: 100%; height: 100%"></canvas></div>'},disabled:!1,template:e.template(['<div class="slider multi-slider-gradient">','<div class="track"></div>',"<% _.each(items, function(item) { %>","<%= thumbTemplate %>","<% }); %>","</div>"].join("")),initialize:function(t){this.styleStr={},this.tmbOptions={width:12,height:16,border:.5,activeThumbIndex:0,borderColor:Common.Utils.isIE?"#cfcfcf":Common.UI.Themes.currentThemeColor("--border-regular-control"),borderColorActive:Common.Utils.isIE?"#848484":Common.UI.Themes.currentThemeColor("--border-control-focus")},this.scale=Common.Utils.applicationPixelRatio()>=1?Common.Utils.applicationPixelRatio():1,Common.UI.MultiSlider.prototype.initialize.call(this,t)},render:function(t){Common.UI.MultiSlider.prototype.render.call(this,t);var i=this;i.trackEl=i.cmpEl.find(".track");for(var o=0;o<i.thumbs.length;o++)i.thumbs[o].thumb.on("dblclick",null,(function(){i.trigger("thumbdblclick",i)})),i.thumbs[o].thumbcolor=i.thumbs[o].thumb.find("> canvas")[0],i.setSizeThumb(i.thumbs[o].thumb,i.thumbs[o].thumbcolor),i.thumbs[o].context=i.thumbs[o].thumbcolor.getContext("2d"),i.drawThumb(i.thumbs[o]),i.setColorValue(i.options.colorValues[o],o);i.changeSliderStyle(),i.changeGradientStyle(),i.on("change",e.bind(i.changeGradientStyle,i)),Common.NotificationCenter.on({"window:resize":e.bind(i.onResize,i),"uitheme:changed":e.bind(i.changeColors,i)}),this.on("thumbclick",e.bind(i.onActiveThumb,i))},setColorValue:function(t,e){var i=void 0!==e?e:this.currentThumb;this.thumbs[i].colorValue=t,this.thumbFill(this.thumbs[i].context,t),this.changeGradientStyle()},getColorValue:function(t){var e=void 0!==t?t:this.currentThumb;return this.thumbs[e].colorValue},setValue:function(t,e){Common.UI.MultiSlider.prototype.setValue.call(this,t,e),this.changeGradientStyle()},getColorValues:function(){var t=[];return e.each(this.thumbs,(function(e){t.push(e.colorValue)})),t},changeGradientStyle:function(){var t;this.rendered&&(this.styleStr.specific&&(t=Common.Utils.String.format(this.styleStr.specific,this.getColorValues().concat(this.getValues())),this.trackEl.css("background",t)),Common.Utils.isIE&&(t=Common.Utils.String.format("progid:DXImageTransform.Microsoft.gradient( startColorstr={0}, endColorstr={1},GradientType=1 )",this.getColorValue(0),this.getColorValue(this.thumbs.length-1)),this.trackEl.css("filter",t)),this.styleStr.common&&(t=Common.Utils.String.format(this.styleStr.common,this.getColorValues().concat(this.getValues())),this.trackEl.css("background",t)))},sortThumbs:function(){var t=Common.UI.MultiSlider.prototype.sortThumbs.call(this);return this.trigger("sortthumbs",this,t),t},findLeftThumb:function(t){for(var e,i=this,o=100,n=0,s=this.thumbs.length,a=0;a<s;a++)if((e=t-i.thumbs[a].position)>0&&e<=o){var r=i.thumbs[a+1],l=i.thumbs[a-1];if(void 0!==l&&t<l.position)continue;if(void 0!==r&&t>r.position)continue;n=a,o=e}return n},calculationNewColor:function(t,e,i){var o=i?i/100:.5,n=1-o,s=Common.Utils.ThemeColor.getRgbColor(t),a=Common.Utils.ThemeColor.getRgbColor(e),r=[Math.round(s.get_r()*n+a.get_r()*o),Math.round(s.get_g()*n+a.get_g()*o),Math.round(s.get_b()*n+a.get_b()*o)];return Common.Utils.ThemeColor.getHexColor(r[0],r[1],r[2])},addThumb:function(){Common.UI.MultiSlider.prototype.addThumb.call(this);var t=this,e=t.thumbs.length-1;t.thumbs[e].thumb.on("dblclick",null,(function(){t.trigger("thumbdblclick",t)})),t.thumbs[e].thumbcolor=t.thumbs[e].thumb.find("> canvas")[0],e>0&&(t.setSizeThumb(t.thumbs[e].thumb,t.thumbs[e].thumbcolor),t.thumbs[e].context=t.thumbs[e].thumbcolor.getContext("2d"),this.drawThumb(this.thumbs[e]),this.setColorValue(this.getColorValue(e-1),e)),t.changeSliderStyle()},drawThumb:function(t){if(t){var e=t.context,i=this.tmbOptions.border*this.scale+.5>>0,o=i/2,n=((this.tmbOptions.width-this.tmbOptions.border/2)*this.scale+.5>>0)-i/2,s=((this.tmbOptions.width-this.tmbOptions.border)/2*this.scale+.5>>0)+.5*i,a=((this.tmbOptions.width-this.tmbOptions.border/2)*this.scale-.5>>0)+.5*i-s,r=(this.tmbOptions.width/2*this.scale+.5>>0)+i/2,l=(this.tmbOptions.height*this.scale+.5>>0)-i/2,c=(this.scale+.5>>0)+i/2;n=(this.tmbOptions.width*this.scale>>0)-n<=0?n-i:n,l=(this.tmbOptions.height*this.scale>>0)-l<=0?l-i:l,this.tmbOptions.x2=n,this.tmbOptions.y2=l,e.beginPath(),e.moveTo(o,r),e.lineTo(o,l),e.lineTo(n,l),e.lineTo(n,r),e.lineTo(s,c),s!==a&&e.lineTo(a,c),e.lineTo(o,r),e.closePath(),e.lineWidth=i,e.strokeStyle=t.thumb.hasClass("active")?this.tmbOptions.borderColorActive:this.tmbOptions.borderColor,e.stroke()}},thumbFill:function(t,e){var i=this.tmbOptions.border*this.scale+.5>>0,o=2*i,n=this.tmbOptions.x2-1.5*i,s=((this.tmbOptions.width-this.tmbOptions.border)/2*this.scale+.5>>0)+.5*i,a=((this.tmbOptions.width-this.tmbOptions.border/2)*this.scale-.5>>0)+.5*i-s,r=this.tmbOptions.width/2*this.scale+2*i+.5>>0,l=this.tmbOptions.y2-1.5*i>>0,c=this.scale+.5+3*i>>0;t.beginPath(),t.moveTo(o,r),t.lineTo(o,l),t.lineTo(n,l),t.lineTo(n,r),t.lineTo(s,c>>0),s!==a&&t.lineTo(a,c>>0),t.lineTo(o,r),t.closePath(),t.fillStyle=e,t.fill()},redrawThumb:function(t){t&&(t.context.clearRect(0,0,t.thumbcolor.width,t.thumbcolor.height),this.drawThumb(t),this.thumbFill(t.context,t.colorValue))},onActiveThumb:function(){this.redrawThumb(this.thumbs[this.tmbOptions.activeThumbIndex]),this.tmbOptions.activeThumbIndex=this.thumbs.filter((function(t){return t.thumb.hasClass("active")}))[0].index,this.redrawThumb(this.thumbs[this.tmbOptions.activeThumbIndex])},setSizeThumb:function(t,e){t&&e&&(t.css({width:(this.tmbOptions.width*this.scale>>0)/this.scale,height:(this.tmbOptions.height*this.scale>>0)/this.scale}),e.width=this.tmbOptions.width*this.scale,e.height=this.tmbOptions.height*this.scale)},onResize:function(){if(this.thumbs&&0!=this.thumbs.length){this.scale=Common.Utils.applicationPixelRatio()>=1?Common.Utils.applicationPixelRatio():1;for(var t=0;t<this.thumbs.length;t++)this.setSizeThumb(this.thumbs[t].thumb,this.thumbs[t].thumbcolor),this.thumbs[t].context&&this.redrawThumb(this.thumbs[t])}},changeColors:function(){if(!Common.Utils.isIE){this.tmbOptions.borderColor=Common.UI.Themes.currentThemeColor("--border-regular-control"),this.tmbOptions.borderColorActive=Common.UI.Themes.currentThemeColor("--border-control-focus");for(var t=0;t<this.thumbs.length;t++)this.thumbs[t].context&&this.redrawThumb(this.thumbs[t]),this.tmbOptions.activeThumb=this.thumbs[t]}},addNewThumb:function(t,i,o){var n,s=this,a=this.findLeftThumb(i);if(e.isUndefined(o)){var r=100*(i-this.thumbs[a].value)/(this.thumbs[a+1].value-this.thumbs[a].value);n=r<0?this.thumbs[a].colorValue:this.calculationNewColor(this.thumbs[a].colorValue,this.thumbs[a===t-1?a:a+1].colorValue,r)}else{this.addThumb(),t=this.thumbs.length-1,n=this.calculationNewColor(this.thumbs[a].colorValue,this.thumbs[a===t-1?a:a+1].colorValue),this.setThumbPosition(t,i);var l=i/this.delta+this.minValue;this.thumbs[t].value=l}return s.thumbs[t].thumbcolor=s.thumbs[t].thumb.find("> canvas")[0],t>0&&(s.setSizeThumb(s.thumbs[t].thumb,s.thumbs[t].thumbcolor),s.thumbs[t].context=s.thumbs[t].thumbcolor.getContext("2d"),s.drawThumb(s.thumbs[t]),this.setColorValue("#"+n,t)),s.sortThumbs(),s.changeSliderStyle(),s.changeGradientStyle(),n},removeThumb:function(t){void 0===t&&(t=this.thumbs.length-1),this.thumbs.length>2&&(this.thumbs[t].thumb.remove(),this.thumbs.splice(t,1),this.sortThumbs(),this.changeSliderStyle())},changeSliderStyle:function(){this.styleStr={specific:"",common:"linear-gradient(to right"},Common.Utils.isChrome&&Common.Utils.chromeVersion<10||Common.Utils.isSafari&&Common.Utils.safariVersion<5.1?this.styleStr.specific="-webkit-gradient(linear, left top, right top":Common.Utils.isChrome||Common.Utils.isSafari?this.styleStr.specific="-webkit-linear-gradient(left":Common.Utils.isGecko?this.styleStr.specific="-moz-linear-gradient(left":Common.Utils.isOpera&&Common.Utils.operaVersion>11?this.styleStr.specific="-o-linear-gradient(left":Common.Utils.isIE&&(this.styleStr.specific="-ms-linear-gradient(left");for(var t=0;t<this.thumbs.length;t++)this.styleStr.common+=", {"+t+"} {"+(this.thumbs.length+t)+"}%",Common.Utils.isChrome&&Common.Utils.chromeVersion<10||Common.Utils.isSafari&&Common.Utils.safariVersion<5.1?this.styleStr.specific+=", color-stop({"+(this.thumbs.length+t)+"}%,{"+t+"})":this.styleStr.specific+=", {"+t+"} {"+(this.thumbs.length+t)+"}%";this.styleStr.specific+=")",this.styleStr.common+=")"}})})),define("spreadsheeteditor/main/app/view/ShapeSettings",["text!spreadsheeteditor/main/app/template/ShapeSettings.template","jquery","underscore","backbone","common/main/lib/component/ComboBox","common/main/lib/component/ComboBorderSize","common/main/lib/component/MetricSpinner","common/main/lib/component/ThemeColorPalette","common/main/lib/component/ColorButton","common/main/lib/component/ComboDataView","common/main/lib/component/Slider","common/main/lib/component/MultiSliderGradient"],(function(t,e,i,o){"use strict";SSE.Views.ShapeSettings=o.View.extend(i.extend({el:"#id-shape-settings",template:i.template(t),events:{},options:{alias:"ShapeSettings"},initialize:function(){this._initSettings=!0,this._originalProps=null,this._noApply=!0,this.imgprops=null,this._sendUndoPoint=!0,this._sliderChanged=!1,this._texturearray=null,this.txtPt=Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt),this._state={Transparency:null,FillType:Asc.c_oAscFill.FILL_TYPE_SOLID,ShapeColor:"transparent",BlipFillType:Asc.c_oAscFillBlipType.STRETCH,StrokeType:Asc.c_oAscStrokeType.STROKE_COLOR,StrokeWidth:this._pt2mm(1),StrokeColor:"000000",StrokeBorderType:Asc.c_oDashType.solid,FGColor:"000000",BGColor:"ffffff",GradColor:"000000",ShadowColor:"transparent",ShadowPreset:null,GradFillType:Asc.c_oAscFillGradType.GRAD_LINEAR,DisabledFillPanels:!1,DisabledControls:!1,HideShapeOnlySettings:!1,HideChangeTypeSettings:!1,HideRotationSettings:!1,isFromImage:!1,isFromSmartArtInternal:!1},this.lockedControls=[],this._locked=!1,this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_SOLID,this.ShapeColor={Value:1,Color:"transparent"},this.BlipFillType=Asc.c_oAscFillBlipType.STRETCH,this.GradFillType=Asc.c_oAscFillGradType.GRAD_LINEAR,this.GradColor={values:[0,100],colors:["000000","ffffff"],currentIdx:0},this.GradRadialDirectionIdx=0,this.GradLinearDirectionType=0,this.PatternFillType=0,this.FGColor={Value:1,Color:"000000"},this.BGColor={Value:1,Color:"ffffff"},this.BorderColor={Value:1,Color:"transparent"},this.BorderSize=0,this.BorderType=Asc.c_oDashType.solid,this.ShadowColor={Value:1,Color:"transparent"},this.textureNames=[this.txtCanvas,this.txtCarton,this.txtDarkFabric,this.txtGrain,this.txtGranite,this.txtGreyPaper,this.txtKnit,this.txtLeather,this.txtBrownPaper,this.txtPapyrus,this.txtWood],this.fillControls=[],this.gradientColorsStr="#000, #fff",this.typeGradient=90,this.shapeRestoreHeight=615,this.render(),this.FillColorContainer=e("#shape-panel-color-fill"),this.FillImageContainer=e("#shape-panel-image-fill"),this.FillPatternContainer=e("#shape-panel-pattern-fill"),this.FillGradientContainer=e("#shape-panel-gradient-fill"),this.TransparencyContainer=e("#shape-panel-transparent-fill"),this.EditShapeContainer=e("#shape-button-edit-shape-container"),this.EditChangeShapeContainer=e("#shape-button-change-shape-container"),this.ShapeOnlySettings=e(".shape-only"),this.CanChangeType=e(".change-type"),this.RotationSettings=e(".shape-rotation")},render:function(){e(this.el).html(this.template({scope:this}))},setApi:function(t){return this.api=t,this.api&&(this.api.asc_setInterfaceDrawImagePlaceShape("shape-texture-img"),this.api.asc_registerCallback("asc_onInitStandartTextures",i.bind(this.onInitStandartTextures,this))),Common.NotificationCenter.on("storage:image-insert",i.bind(this.insertImageFromStorage,this)),this},setMode:function(t){this.mode=t},onFillSrcSelect:function(t,e){switch(this.ShowHideElem(e.value),e.value){case Asc.c_oAscFill.FILL_TYPE_SOLID:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_SOLID,!this._noApply){var i=new Asc.asc_CShapeProperty;(a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_SOLID),a.asc_putFill(new Asc.asc_CFillSolid),a.asc_getFill().asc_putColor(Common.Utils.ThemeColor.getRgbColor("transparent"==this.ShapeColor.Color?{color:"4f81bd",effectId:24}:this.ShapeColor.Color)),i.asc_putFill(a),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_GRAD:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_GRAD,!this._noApply){i=new Asc.asc_CShapeProperty;if((a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),a.asc_putFill(new Asc.asc_CFillGrad),a.asc_getFill().asc_putGradType(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(a.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),a.asc_getFill().asc_putLinearScale(!0)),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD){this.GradColor.values=[0,100],this.GradColor.colors=[this.GradColor.colors[0],this.GradColor.colors[this.GradColor.colors.length-1]],this.GradColor.currentIdx=0;var o=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[0]).get_color().get_hex(),n=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1]).get_color().get_hex();o="ffffff"===o&&"ffffff"===n?{color:"4f81bd",effectId:24}:this.GradColor.colors[0],a.asc_getFill().asc_putPositions([1e3*this.GradColor.values[0],1e3*this.GradColor.values[1]]),a.asc_getFill().asc_putColors([Common.Utils.ThemeColor.getRgbColor(o),Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1])])}i.asc_putFill(a),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_BLIP:if(this._state.FillType!==Asc.c_oAscFill.FILL_TYPE_BLIP&&!this._noApply&&this._texturearray&&this._texturearray.length>0){this._state.FillType=Asc.c_oAscFill.FILL_TYPE_BLIP;i=new Asc.asc_CShapeProperty;(a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_BLIP),a.asc_putFill(new Asc.asc_CFillBlip),a.asc_getFill().asc_putType(Asc.c_oAscFillBlipType.TILE),a.asc_getFill().asc_putTextureId(this._texturearray[0].type),i.asc_putFill(a),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_PATT:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_PATT,!this._noApply){i=new Asc.asc_CShapeProperty;(a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),a.asc_putFill(new Asc.asc_CFillHatch),a.asc_getFill().asc_putPatternType(this.PatternFillType);var s=Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color).get_color().get_hex();s="ffffff"===Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color).get_color().get_hex()&&"ffffff"===s?{color:"4f81bd",effectId:24}:this.FGColor.Color,a.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(s)),a.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),i.asc_putFill(a),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_NOFILL:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_NOFILL,!this._noApply){var a;i=new Asc.asc_CShapeProperty;(a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_NOFILL),a.asc_putFill(null),i.asc_putFill(a),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}}Common.NotificationCenter.trigger("edit:complete",this)},onColorsBackSelect:function(t,e){if(this.ShapeColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,o=new Asc.asc_CShapeFill;"transparent"==this.ShapeColor.Color?(o.asc_putType(Asc.c_oAscFill.FILL_TYPE_NOFILL),o.asc_putFill(null)):(o.asc_putType(Asc.c_oAscFill.FILL_TYPE_SOLID),o.asc_putFill(new Asc.asc_CFillSolid),o.asc_getFill().asc_putColor(Common.Utils.ThemeColor.getRgbColor(this.ShapeColor.Color))),i.asc_putFill(o),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onPatternSelect:function(t,e){if(this.api&&!this._noApply){this.PatternFillType=e.get("type");var i=new Asc.asc_CShapeProperty,o=new Asc.asc_CShapeFill;o.asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),o.asc_putFill(new Asc.asc_CFillHatch),o.asc_getFill().asc_putPatternType(this.PatternFillType),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_PATT&&(o.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),o.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),i.asc_putFill(o),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsFGSelect:function(t,e){if(this.FGColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,o=new Asc.asc_CShapeFill;o.asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),o.asc_putFill(new Asc.asc_CFillHatch),o.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_PATT&&(o.asc_getFill().asc_putPatternType(this.PatternFillType),o.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),i.asc_putFill(o),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsBGSelect:function(t,e){if(this.BGColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,o=new Asc.asc_CShapeFill;o.asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),o.asc_putFill(new Asc.asc_CFillHatch),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_PATT&&(o.asc_getFill().asc_putPatternType(this.PatternFillType),o.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color))),o.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),i.asc_putFill(o),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onFillTypeSelect:function(t,e){if(this.BlipFillType=e.value,this.api&&!0!==this._fromTextureCmb&&this.OriginalFillType==Asc.c_oAscFill.FILL_TYPE_BLIP){var i=new Asc.asc_CShapeProperty,o=new Asc.asc_CShapeFill;o.asc_putType(Asc.c_oAscFill.FILL_TYPE_BLIP),o.asc_putFill(new Asc.asc_CFillBlip),o.asc_getFill().asc_putType(this.BlipFillType),i.asc_putFill(o),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onNumTransparencyChange:function(t,e,i,o){if(this.sldrTransparency.setValue(t.getNumberValue(),!0),this.api){var n=t.getNumberValue(),s=new Asc.asc_CShapeProperty,a=new Asc.asc_CShapeFill;a.asc_putTransparent(2.55*n),s.asc_putFill(a),this.imgprops.asc_putShapeProperties(s),this.api.asc_setGraphicObjectProps(this.imgprops)}},onTransparencyChange:function(t,e,o){this._sliderChanged=e,this.numTransparency.setValue(e,!0),this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(i.bind(this._transparencyApplyFunc,this),100))},onTransparencyChangeComplete:function(t,e,i){clearInterval(this.updateslider),this._sliderChanged=e,this._sendUndoPoint||(this.api.setEndPointHistory(),this._transparencyApplyFunc()),this._sendUndoPoint=!0},_transparencyApplyFunc:function(){if(void 0!==this._sliderChanged){var t=new Asc.asc_CShapeProperty,e=new Asc.asc_CShapeFill;e.asc_putTransparent(2.55*this._sliderChanged),t.asc_putFill(e),this.imgprops.asc_putShapeProperties(t),this.api.asc_setGraphicObjectProps(this.imgprops),this._sliderChanged=void 0}},onGradTypeSelect:function(t,e){if(this.GradFillType=e.value,this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){this.mnuDirectionPicker.store.reset(this._viewDataLinear),this.mnuDirectionPicker.cmpEl.width(175),this.mnuDirectionPicker.restoreHeight=174;e=this.mnuDirectionPicker.store.findWhere({type:this.GradLinearDirectionType});this.mnuDirectionPicker.selectRecord(e,!0),this.typeGradient=e?this.GradLinearDirectionType+90:-1,this.numGradientAngle.setValue(this.GradLinearDirectionType,!0),this.numGradientAngle.setDisabled(this._locked)}else this.GradFillType==Asc.c_oAscFillGradType.GRAD_PATH&&(this.mnuDirectionPicker.store.reset(this._viewDataRadial),this.mnuDirectionPicker.cmpEl.width(60),this.mnuDirectionPicker.restoreHeight=58,this.mnuDirectionPicker.selectByIndex(this.GradRadialDirectionIdx,!0),this.GradRadialDirectionIdx>=0?this.typeGradient=this._viewDataRadial[this.GradRadialDirectionIdx].type:this.typeGradient=-1,this.numGradientAngle.setValue(0,!0),this.numGradientAngle.setDisabled(!0));if(this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,o=new Asc.asc_CShapeFill;o.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),o.asc_putFill(new Asc.asc_CFillGrad),o.asc_getFill().asc_putGradType(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(o.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),o.asc_getFill().asc_putLinearScale(!0)),i.asc_putFill(o),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onSelectGradient:function(t,e,o,n){if(!this._noApply){var s={};if(i.isFunction(n.toJSON)){if(!n.get("selected"))return;s=n.toJSON()}else s=n;if(this.GradFillType===Asc.c_oAscFillGradType.GRAD_LINEAR?(this.GradLinearDirectionType=s.type,this.typeGradient=s.type+90):(this.GradRadialDirectionIdx=0,this.typeGradient=s.type),this.api&&this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){this.numGradientAngle.setValue(s.type,!0);var a=new Asc.asc_CShapeProperty,r=new Asc.asc_CShapeFill;r.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),r.asc_putFill(new Asc.asc_CFillGrad),r.asc_getFill().asc_putGradType(this.GradFillType),r.asc_getFill().asc_putLinearAngle(6e4*s.type),r.asc_getFill().asc_putLinearScale(!0),a.asc_putFill(r),this.imgprops.asc_putShapeProperties(a),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)}},onColorsGradientSelect:function(t,e){if(this.GradColor.colors[this.GradColor.currentIdx]=e,this.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==_typeof(e)?e.color:e)),this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,o=new Asc.asc_CShapeFill;o.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),o.asc_putFill(new Asc.asc_CFillGrad),o.asc_getFill().asc_putGradType(this.GradFillType);var n=[];this.GradColor.colors.forEach((function(t){n.push(Common.Utils.ThemeColor.getRgbColor(t))})),o.asc_getFill().asc_putColors(n),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD&&(this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(o.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),o.asc_getFill().asc_putLinearScale(!0)),n=[],this.GradColor.values.forEach((function(t){n.push(1e3*t)})),o.asc_getFill().asc_putPositions(n)),i.asc_putFill(o),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onGradientChange:function(t,e,o){this.GradColor.values=t.getValues();var n=this.GradColor.values[this.GradColor.currentIdx];this.spnGradPosition.setValue(Common.UI.isRTL()?this.sldrGradient.maxValue-n:n,!0),this._sliderChanged=!0,this.api&&!this._noApply&&this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(i.bind(this._gradientApplyFunc,this),100))},onGradientChangeComplete:function(t,e,i){clearInterval(this.updateslider),this._sliderChanged=!0,this._sendUndoPoint||(this.api.setEndPointHistory(),this._gradientApplyFunc()),this._sendUndoPoint=!0},_gradientApplyFunc:function(){if(this._sliderChanged){var t=new Asc.asc_CShapeProperty,e=new Asc.asc_CShapeFill;e.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),e.asc_putFill(new Asc.asc_CFillGrad),e.asc_getFill().asc_putGradType(this.GradFillType);var i=[];this.GradColor.values.forEach((function(t){i.push(1e3*t)})),e.asc_getFill().asc_putPositions(i),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(e.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),e.asc_getFill().asc_putLinearScale(!0)),i=[],this.GradColor.colors.forEach((function(t){i.push(Common.Utils.ThemeColor.getRgbColor(t))})),e.asc_getFill().asc_putColors(i),t.asc_putFill(e),this.imgprops.asc_putShapeProperties(t),this.api.asc_setGraphicObjectProps(this.imgprops),this._sliderChanged=!1}},applyBorderSize:function(t){if(t=Common.Utils.String.parseFloat(t),t=isNaN(t)?0:Math.max(0,Math.min(1584,t)),this.BorderSize=t,this.api&&!this._noApply){var e=new Asc.asc_CShapeProperty,i=new Asc.asc_CStroke;this.BorderSize<1e-5?(i.asc_putType(Asc.c_oAscStrokeType.STROKE_NONE),this._state.StrokeType=this._state.StrokeWidth=-1):(i.asc_putType(Asc.c_oAscStrokeType.STROKE_COLOR),"transparent"==this.BorderColor.Color||"transparent"==this.BorderColor.Color.color?i.asc_putColor(Common.Utils.ThemeColor.getRgbColor({color:"000000",effectId:29})):this._state.StrokeType!=Asc.c_oAscStrokeType.STROKE_NONE&&null!==this._state.StrokeType||i.asc_putColor(Common.Utils.ThemeColor.getRgbColor(Common.Utils.ThemeColor.colorValue2EffectId(this.BorderColor.Color))),i.asc_putPrstDash(this.BorderType),i.asc_putWidth(this._pt2mm(this.BorderSize)),i.asc_putTransparent(this._state.LineTransparency)),e.asc_putStroke(i),this.imgprops.asc_putShapeProperties(e),this.api.asc_setGraphicObjectProps(this.imgprops),Common.NotificationCenter.trigger("edit:complete",this)}},onComboBlur:function(){Common.NotificationCenter.trigger("edit:complete",this)},onBorderSizeChanged:function(t,e,o,n){var s=this;if(t){var a=parseFloat(o.value);(!new RegExp("^\\s*(\\d*(\\.|,)?\\d+)\\s*("+s.txtPt+")?\\s*$").exec(o.value)||a<0||a>1584)&&(this._state.StrokeType=this._state.StrokeWidth=-1,setTimeout((function(){Common.UI.error({msg:s.textBorderSizeErr,callback:function(){i.defer((function(t){Common.NotificationCenter.trigger("edit:complete",s)}))}})}),10))}else this.applyBorderSize(o.value)},onBorderSizeSelect:function(t,e){this.applyBorderSize(e.value)},onBorderTypeSelect:function(t,e){if(this.BorderType=e.value,this.api&&!this._noApply){var i=new Asc.asc_CShapeProperty,o=new Asc.asc_CStroke;this.BorderSize<1e-5?o.put_type(Asc.c_oAscStrokeType.STROKE_NONE):(o.put_type(Asc.c_oAscStrokeType.STROKE_COLOR),o.put_color(Common.Utils.ThemeColor.getRgbColor(this.BorderColor.Color)),o.put_width(this._pt2mm(this.BorderSize)),o.asc_putPrstDash(this.BorderType),o.asc_putTransparent(this._state.LineTransparency)),i.put_stroke(o),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsBorderSelect:function(t,e){if(this.BorderColor={Value:1,Color:e},this.api&&this.BorderSize>0&&!this._noApply){var i=new Asc.asc_CShapeProperty,o=new Asc.asc_CStroke;this.BorderSize<1e-5?o.asc_putType(Asc.c_oAscStrokeType.STROKE_NONE):(o.asc_putType(Asc.c_oAscStrokeType.STROKE_COLOR),o.asc_putColor(Common.Utils.ThemeColor.getRgbColor(this.BorderColor.Color)),o.asc_putWidth(this._pt2mm(this.BorderSize)),o.asc_putPrstDash(this.BorderType),o.asc_putTransparent(this._state.LineTransparency)),i.asc_putStroke(o),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onNumLineTransparencyChange:function(t,e,i,o){if(this.sldrLineTransparency.setValue(t.getNumberValue(),!0),this._state.LineTransparency=2.55*t.getNumberValue(),this.api&&!this._noApply){var n=new Asc.asc_CShapeProperty,s=new Asc.asc_CStroke;s.asc_putTransparent(this._state.LineTransparency),n.asc_putStroke(s),this.imgprops.asc_putShapeProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}},onLineTransparencyChange:function(t,e,o){this._sliderChangedLine=e,this.numLineTransparency.setValue(e,!0),this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updatesliderline=setInterval(i.bind(this._transparencyLineApplyFunc,this),100))},onLineTransparencyChangeComplete:function(t,e,i){clearInterval(this.updatesliderline),this._sliderChangedLine=e,this._sendUndoPoint||(this.api.setEndPointHistory(),this._transparencyLineApplyFunc()),this._sendUndoPoint=!0},_transparencyLineApplyFunc:function(){if(void 0!==this._sliderChangedLine){this._state.LineTransparency=2.55*this._sliderChangedLine;var t=new Asc.asc_CShapeProperty,e=new Asc.asc_CStroke;e.asc_putTransparent(this._state.LineTransparency),t.asc_putStroke(e),this.imgprops.asc_putShapeProperties(t),this.api.asc_setGraphicObjectProps(this.imgprops),this._sliderChangedLine=void 0}},setImageUrl:function(t,e){if(null!==this.BlipFillType){var i=new Asc.asc_CShapeProperty,o=new Asc.asc_CShapeFill;o.asc_putType(Asc.c_oAscFill.FILL_TYPE_BLIP),o.asc_putFill(new Asc.asc_CFillBlip),o.asc_getFill().asc_putType(this.BlipFillType),o.asc_getFill().asc_putUrl(t,e),i.asc_putFill(o),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}},insertImageFromStorage:function(t){t&&t._urls&&"fill"==t.c&&this.setImageUrl(t._urls[0],t.token)},onImageSelect:function(t,e){if(1==e.value){var o=this;new Common.Views.ImageFromUrlDialog({handler:function(t,e){if("ok"==t&&o.api){var n=e.replace(/ /g,"");i.isEmpty(n)||o.setImageUrl(n)}Common.NotificationCenter.trigger("edit:complete",o)}}).show()}else 2==e.value?Common.NotificationCenter.trigger("storage:image-load","fill"):(this.api&&this.api.asc_changeShapeImageFromFile(this.BlipFillType),Common.NotificationCenter.trigger("edit:complete",this))},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;if(e.api&&!this._locked){var i=e.api.asc_getGraphicObjectProps();if(i&&i.length>0)for(var o,n,s=i.length-1;s>=0;s--)if(o=i[s].asc_getObjectType(),n=i[s].asc_getObjectValue(),Asc.c_oAscTypeSelectElement.Image==o&&n.asc_getShapeProperties()){new SSE.Views.ShapeSettingsAdvanced({shapeProps:n,handler:function(t,i){"ok"==t&&e.api&&e.api.asc_setGraphicObjectProps(i.shapeProps),Common.NotificationCenter.trigger("edit:complete",e)}}).show();break}}}},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),null==this.imgprops&&(this.imgprops=new Asc.asc_CImgProperty),t&&t.asc_getShapeProperties()){var o=t.asc_getShapeProperties(),n=o.asc_getType();this._originalProps=o,this._noApply=!0,this._state.isFromImage=!!o.get_FromImage(),this._state.isFromSmartArtInternal=!!o.asc_getFromSmartArtInternal(),this.disableControls(this._locked,!o.asc_getCanFill()),this.hideShapeOnlySettings(o.asc_getFromChart()||!!o.asc_getFromImage()),this.hideRotationSettings(o.asc_getFromChart()||!!o.asc_getFromImage()||o.asc_getFromSmartArt()),this.canEditPoint=this.api&&this.api.asc_canEditGeometry(),this.toggleBtnEditShape();var s=o.get_FromChart()||o.asc_getFromSmartArt()||"line"==n||"bentConnector2"==n||"bentConnector3"==n||"bentConnector4"==n||"bentConnector5"==n||"curvedConnector2"==n||"curvedConnector3"==n||"curvedConnector4"==n||"curvedConnector5"==n||"straightConnector1"==n;this.hideChangeTypeSettings(s),!s&&this.btnChangeShape.menu.items.length&&this.btnChangeShape.shapePicker.hideTextRect(o.get_FromImage()||this._state.isFromSmartArtInternal);var a=null,r=o.asc_getFill(),l=r.asc_getType(),c=null,h=r.asc_getTransparent();if((Math.abs(this._state.Transparency-h)>.001||Math.abs(this.numTransparency.getNumberValue()-h)>.001||(null===this._state.Transparency||null===h)&&(this._state.Transparency!==h||this.numTransparency.getNumberValue()!==h))&&(void 0!==h&&(this.sldrTransparency.setValue(null===h?100:h/255*100,!0),this.numTransparency.setValue(this.sldrTransparency.getValue(),!0)),this._state.Transparency=h),null===r||null===l)this.OriginalFillType=null;else if(l==Asc.c_oAscFill.FILL_TYPE_NOFILL)this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_NOFILL;else if(l==Asc.c_oAscFill.FILL_TYPE_SOLID)(c=(r=r.asc_getFill()).asc_getColor())?c.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.ShapeColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB()),effectValue:c.asc_getValue()}}:this.ShapeColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB())}:this.ShapeColor={Value:0,Color:"transparent"},this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_SOLID,this.FGColor="transparent"!==this.ShapeColor.Color?{Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.ShapeColor.Color)}:{Value:1,Color:"000000"},this.BGColor={Value:1,Color:"ffffff"},this.GradColor.colors[0]="transparent"!==this.ShapeColor.Color?Common.Utils.ThemeColor.colorValue2EffectId(this.ShapeColor.Color):"000000",this.GradColor.colors[this.GradColor.colors.length-1]="ffffff";else if(l==Asc.c_oAscFill.FILL_TYPE_BLIP)r=r.asc_getFill(),this.BlipFillType=r.asc_getType(),this._state.BlipFillType!==this.BlipFillType&&(this.BlipFillType==Asc.c_oAscFillBlipType.STRETCH||this.BlipFillType==Asc.c_oAscFillBlipType.TILE?this.cmbFillType.setValue(this.BlipFillType):this.cmbFillType.setValue(""),this._state.BlipFillType=this.BlipFillType),this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_BLIP;else if(l==Asc.c_oAscFill.FILL_TYPE_PATT){if(r=r.asc_getFill(),this.PatternFillType=r.asc_getPatternType(),this._state.PatternFillType!==this.PatternFillType){this.cmbPattern.suspendEvents();a=this.cmbPattern.menuPicker.store.findWhere({type:this.PatternFillType});this.cmbPattern.menuPicker.selectRecord(a),this.cmbPattern.resumeEvents(),this._state.PatternFillType=this.PatternFillType}(c=r.asc_getColorFg())?c.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.FGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB()),effectValue:c.asc_getValue()}}:this.FGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB())}:this.FGColor={Value:1,Color:"000000"},(c=r.asc_getColorBg())?c.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.BGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB()),effectValue:c.asc_getValue()}}:this.BGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB())}:this.BGColor={Value:1,Color:"ffffff"},this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_PATT,this.ShapeColor={Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.FGColor.Color)},this.GradColor.colors[0]=Common.Utils.ThemeColor.colorValue2EffectId(this.FGColor.Color),this.GradColor.colors[this.GradColor.colors.length-1]="ffffff"}else if(l==Asc.c_oAscFill.FILL_TYPE_GRAD){var d=(r=r.asc_getFill()).asc_getGradType();if(this._state.GradFillType===d&&this.GradFillType===d||(this.GradFillType=d,a=void 0,this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR||this.GradFillType==Asc.c_oAscFillGradType.GRAD_PATH?(this.cmbGradType.setValue(this.GradFillType),a=this.cmbGradType.store.findWhere({value:this.GradFillType}),this.onGradTypeSelect(this.cmbGradType,a.attributes)):(this.cmbGradType.setValue(""),this.typeGradient=-1),this._state.GradFillType=this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){var m=Math.floor(r.asc_getLinearAngle()/6e4);if(Math.abs(this.GradLinearDirectionType-m)>.001){this.GradLinearDirectionType=m;var p=this.mnuDirectionPicker.store.findWhere({type:m});this.mnuDirectionPicker.selectRecord(p,!0),this.typeGradient=p?m+90:-1,this.numGradientAngle.setValue(m,!0)}}else this.numGradientAngle.setValue(0,!0);var u=this,g=r.asc_getColors(),f=r.asc_getPositions(),b=g?g.length:this.GradColor.colors.length;this.sldrGradient.setThumbs(b),this.GradColor.colors.length>b&&(this.GradColor.colors.splice(b,this.GradColor.colors.length-b),this.GradColor.values.splice(b,this.GradColor.colors.length-b),this.GradColor.currentIdx=0),g&&g.forEach((function(t,e){t?t.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?(u.GradColor.colors[e]={color:Common.Utils.ThemeColor.getHexColor(t.asc_getR(),t.asc_getG(),t.asc_getB()),effectValue:t.asc_getValue()},Common.Utils.ThemeColor.colorValue2EffectId(u.GradColor.colors[e])):u.GradColor.colors[e]=Common.Utils.ThemeColor.getHexColor(t.asc_getR(),t.asc_getG(),t.asc_getB()):u.GradColor.colors[e]="000000";var i=f[e];null!==i&&(i/=1e3,u.GradColor.values[e]=i)}));for(var C=[],v=this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR?1:.7,_=0;_<b;_++)u.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==_typeof(u.GradColor.colors[_])?u.GradColor.colors[_].color:u.GradColor.colors[_]),_),u.sldrGradient.setValue(_,u.GradColor.values[_]),C.push(u.sldrGradient.getColorValue(_)+" "+u.sldrGradient.getValue(_)*v+"%");this.btnDirectionRedraw(u.sldrGradient,C.join(", ")),(i.isUndefined(u.GradColor.currentIdx)||u.GradColor.currentIdx>=this.GradColor.colors.length)&&(u.GradColor.currentIdx=0),u.sldrGradient.setActiveThumb(u.GradColor.currentIdx);var w=u.GradColor.values[u.GradColor.currentIdx];this.spnGradPosition.setValue(Common.UI.isRTL()?u.sldrGradient.maxValue-w:w),this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_GRAD,this.FGColor={Value:1,Color:this.GradColor.colors[0]},this.BGColor={Value:1,Color:"ffffff"},this.ShapeColor={Value:1,Color:this.GradColor.colors[0]}}this._state.FillType!==this.OriginalFillType&&(this.cmbFillSrc.setValue(null===this.OriginalFillType?"":this.OriginalFillType),this._state.FillType=this.OriginalFillType,this.ShowHideElem(this.OriginalFillType)),e(this.btnTexture.el).find(".form-control").prop("innerHTML",this.textSelectTexture);var A=_typeof(this.ShapeColor.Color),y=_typeof(this._state.ShapeColor);(A!==y||"object"==A&&(this.ShapeColor.Color.effectValue!==this._state.ShapeColor.effectValue||this._state.ShapeColor.color.indexOf(this.ShapeColor.Color.color)<0)||"object"!=A&&this._state.ShapeColor.indexOf(this.ShapeColor.Color)<0)&&(this.btnBackColor.setColor(this.ShapeColor.Color),Common.Utils.ThemeColor.selectPickerColorByEffect(this.ShapeColor.Color,this.colorsBack),this._state.ShapeColor=this.ShapeColor.Color);var S,x=o.asc_getStroke(),k=x.asc_getType(),T="transparent"==this._state.StrokeColor&&"transparent"!==this.BorderColor.Color;if(x?(h=x.asc_getTransparent(),(Math.abs(this._state.LineTransparency-h)>.001||Math.abs(this.numLineTransparency.getNumberValue()-h)>.001||(null===this._state.LineTransparency||null===h)&&(this._state.LineTransparency!==h||this.numLineTransparency.getNumberValue()!==h))&&(void 0!==h&&(this.sldrLineTransparency.setValue(null===h?100:h/255*100,!0),this.numLineTransparency.setValue(this.sldrLineTransparency.getValue(),!0)),this._state.LineTransparency=h),k==Asc.c_oAscStrokeType.STROKE_COLOR&&(c=x.asc_getColor())?c.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.BorderColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB()),effectValue:c.asc_getValue()}}:this.BorderColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(c.asc_getR(),c.asc_getG(),c.asc_getB())}:this.BorderColor={Value:1,Color:"transparent"},S=x.asc_getPrstDash()):(k=null,this.BorderColor={Value:0,Color:"transparent"}),A=_typeof(this.BorderColor.Color),y=_typeof(this._state.StrokeColor),(T||A!==y||"object"==A&&(this.BorderColor.Color.effectValue!==this._state.StrokeColor.effectValue||this._state.StrokeColor.color.indexOf(this.BorderColor.Color.color)<0)||"object"!=A&&(this._state.StrokeColor.indexOf(this.BorderColor.Color)<0||"object"==_typeof(this.btnBorderColor.color)))&&(this.btnBorderColor.setColor(this.BorderColor.Color),Common.Utils.ThemeColor.selectPickerColorByEffect(this.BorderColor.Color,this.colorsBorder),this._state.StrokeColor=this.BorderColor.Color),this._state.StrokeType!==k||k==Asc.c_oAscStrokeType.STROKE_COLOR){if(k==Asc.c_oAscStrokeType.STROKE_COLOR){var I=x.asc_getWidth(),E=Math.abs(this._state.StrokeWidth-I)<1e-5&&!new RegExp(this.txtPt+"\\s*$").test(this.cmbBorderSize.getRawValue());if(Math.abs(this._state.StrokeWidth-I)>1e-5||E||(null===this._state.StrokeWidth||null===I)&&this._state.StrokeWidth!==I){this._state.StrokeWidth=I,null!==I&&(I=this._mm2pt(I));var P=null===I?I:i.find(this.cmbBorderSize.store.models,(function(t){if(I<t.attributes.value+1e-4&&I>t.attributes.value-1e-4)return!0}));P?this.cmbBorderSize.selectRecord(P):this.cmbBorderSize.setValue(null!==I?parseFloat(I.toFixed(2))+" "+this.txtPt:""),this.BorderSize=I}}else k==Asc.c_oAscStrokeType.STROKE_NONE?(this._state.StrokeWidth=0,this.BorderSize=this.cmbBorderSize.store.at(0).get("value"),this.cmbBorderSize.setValue(this.BorderSize)):(this._state.StrokeWidth=null,this.BorderSize=-1,this.cmbBorderSize.setValue(null));this._state.StrokeType=k}this._state.StrokeBorderType!==S&&(this.BorderType=this._state.StrokeBorderType=S,this.cmbBorderType.setValue(S)),((A=_typeof(this.FGColor.Color))!==(y=_typeof(this._state.FGColor))||"object"==A&&(this.FGColor.Color.effectValue!==this._state.FGColor.effectValue||this._state.FGColor.color.indexOf(this.FGColor.Color.color)<0)||"object"!=A&&this._state.FGColor.indexOf(this.FGColor.Color)<0)&&(this.btnFGColor.setColor(this.FGColor.Color),Common.Utils.ThemeColor.selectPickerColorByEffect(this.FGColor.Color,this.colorsFG),this._state.FGColor=this.FGColor.Color),((A=_typeof(this.BGColor.Color))!==(y=_typeof(this._state.BGColor))||"object"==A&&(this.BGColor.Color.effectValue!==this._state.BGColor.effectValue||this._state.BGColor.color.indexOf(this.BGColor.Color.color)<0)||"object"!=A&&this._state.BGColor.indexOf(this.BGColor.Color)<0)&&(this.btnBGColor.setColor(this.BGColor.Color),Common.Utils.ThemeColor.selectPickerColorByEffect(this.BGColor.Color,this.colorsBG),this._state.BGColor=this.BGColor.Color),((A=_typeof(c=this.GradColor.colors[this.GradColor.currentIdx]))!==(y=_typeof(this._state.GradColor))||"object"==A&&(c.effectValue!==this._state.GradColor.effectValue||this._state.GradColor.color.indexOf(c.color)<0)||"object"!=A&&this._state.GradColor.indexOf(c)<0)&&(this.btnGradColor.setColor(c),Common.Utils.ThemeColor.selectPickerColorByEffect(c,this.colorsGrad),this._state.GradColor=c);var D=o.asc_getShadow(),M=null;if(D){var U=D.getPreset();U&&(M=this.viewShadowShapePresets.store.findWhere({value:U})),(c=D.getColor()).get_type()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.ShadowColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(c.get_r(),c.get_g(),c.get_b()),effectValue:c.get_value()}}:this.ShadowColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(c.get_r(),c.get_g(),c.get_b())},c=this.ShadowColor.Color,((A=_typeof(this.ShadowColor))!==(y=_typeof(this._state.ShadowColor))||"object"==A&&(c.effectValue!==this._state.ShadowColor.effectValue||this._state.ShadowColor.color.indexOf(c.color)<0)||"object"!=A&&this._state.ShadowColor.indexOf(c)<0)&&(Common.Utils.ThemeColor.selectPickerColorByEffect(c,this.mnuShadowShapeColorPicker),this._state.ShadowColor=c)}M?(this._state.ShadowPreset=M,this.viewShadowShapePresets.selectRecord(M)):(this._state.ShadowPreset=null,this.viewShadowShapePresets.deselectAll()),this.btnShadowShape.menu.items[1].setChecked(!D,!0),this._noApply=!1}},btnDirectionRedraw:function(t,e){this.gradientColorsStr=e,i.each(this._viewDataLinear,(function(t){t.gradientColorsStr=e})),this._viewDataRadial.gradientColorsStr=this.gradientColorsStr,this.mnuDirectionPicker.store.each((function(t){t.set("gradientColorsStr",e)}),this),-1==this.typeGradient?this.btnDirection.$icon.css({background:"none"}):2==this.typeGradient?this.btnDirection.$icon.css({background:"radial-gradient("+e+")"}):this.btnDirection.$icon.css({background:"linear-gradient("+this.typeGradient+"deg, "+e+")"})},createDelayedControls:function(){var t=this;this._arrFillSrc=[{displayValue:this.textColor,value:Asc.c_oAscFill.FILL_TYPE_SOLID},{displayValue:this.textGradientFill,value:Asc.c_oAscFill.FILL_TYPE_GRAD},{displayValue:this.textImageTexture,value:Asc.c_oAscFill.FILL_TYPE_BLIP},{displayValue:this.textPatternFill,value:Asc.c_oAscFill.FILL_TYPE_PATT},{displayValue:this.textNoFill,value:Asc.c_oAscFill.FILL_TYPE_NOFILL}],this.cmbFillSrc=new Common.UI.ComboBox({el:e("#shape-combo-fill-src"),cls:"input-group-nr",style:"width: 100%;",menuStyle:"min-width: 100%;",editable:!1,data:this._arrFillSrc,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strFill}),this.cmbFillSrc.setValue(this._arrFillSrc[0].value),this.cmbFillSrc.on("selected",i.bind(this.onFillSrcSelect,this)),this.fillControls.push(this.cmbFillSrc);this.cmbPattern=new Common.UI.ComboDataView({itemWidth:28,itemHeight:28,menuMaxHeight:300,enableKeyEvents:!0,cls:"combo-pattern",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",fillOnChangeVisibility:!0,itemTemplate:i.template(['<div class="style" id="<%= id %>">','<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" class="combo-pattern-item" ','width="28" height="28" ','style="background-position: -<%= offsetx %>px -<%= offsety %>px;"/>',"</div>"].join("")),ariaLabel:this.strPattern}),this.cmbPattern.render(e("#shape-combo-pattern")),this.cmbPattern.on("click",i.bind(this.onPatternSelect,this)),this.cmbPattern.openButton.menu.on("show:after",(function(){t.cmbPattern.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.fillControls.push(this.cmbPattern),this.btnSelectImage=new Common.UI.Button({parentEl:e("#shape-button-replace"),cls:"btn-text-menu-default",caption:this.textSelectImage,style:"width:100%;",menu:new Common.UI.Menu({style:"min-width: 194px;",maxHeight:200,items:[{caption:this.textFromFile,value:0},{caption:this.textFromUrl,value:1},{caption:this.textFromStorage,value:2}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textSelectImage}),this.fillControls.push(this.btnSelectImage),this.btnSelectImage.menu.on("item:click",i.bind(this.onImageSelect,this)),this.btnSelectImage.menu.items[2].setVisible(this.mode.canRequestInsertImage||this.mode.fileChoiceUrl&&this.mode.fileChoiceUrl.indexOf("{documentType}")>-1),this._arrFillType=[{displayValue:this.textStretch,value:Asc.c_oAscFillBlipType.STRETCH},{displayValue:this.textTile,value:Asc.c_oAscFillBlipType.TILE}],this.cmbFillType=new Common.UI.ComboBox({el:e("#shape-combo-fill-type"),cls:"input-group-nr",menuStyle:"min-width: 90px;",editable:!1,data:this._arrFillType,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strType}),this.cmbFillType.setValue(this._arrFillType[0].value),this.cmbFillType.on("selected",i.bind(this.onFillTypeSelect,this)),this.fillControls.push(this.cmbFillType),this.numTransparency=new Common.UI.MetricSpinner({el:e("#shape-spin-transparency"),step:1,width:62,value:"100 %",defaultUnit:"%",maxValue:100,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strTransparency}),this.numTransparency.on("change",i.bind(this.onNumTransparencyChange,this)),this.numTransparency.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.fillControls.push(this.numTransparency),this.sldrTransparency=new Common.UI.SingleSlider({el:e("#shape-slider-transparency"),width:75,minValue:0,maxValue:100,value:100}),this.sldrTransparency.on("change",i.bind(this.onTransparencyChange,this)),this.sldrTransparency.on("changecomplete",i.bind(this.onTransparencyChangeComplete,this)),this.fillControls.push(this.sldrTransparency),this.lblTransparencyStart=e(this.el).find("#shape-lbl-transparency-start"),this.lblTransparencyEnd=e(this.el).find("#shape-lbl-transparency-end"),this._arrGradType=[{displayValue:this.textLinear,value:Asc.c_oAscFillGradType.GRAD_LINEAR},{displayValue:this.textRadial,value:Asc.c_oAscFillGradType.GRAD_PATH}],this.cmbGradType=new Common.UI.ComboBox({el:e("#shape-combo-grad-type"),cls:"input-group-nr",menuStyle:"min-width: 100%;",editable:!1,data:this._arrGradType,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textStyle}),this.cmbGradType.setValue(this._arrGradType[0].value),this.cmbGradType.on("selected",i.bind(this.onGradTypeSelect,this)),this.fillControls.push(this.cmbGradType),this._viewDataLinear=[{type:45,subtype:-1},{type:90,subtype:4},{type:135,subtype:5},{type:0,subtype:6,cls:"item-gradient-separator",selected:!0},{type:180,subtype:1},{type:315,subtype:2},{type:270,subtype:3},{type:225,subtype:7}],i.each(this._viewDataLinear,(function(e){e.gradientColorsStr=t.gradientColorsStr})),this._viewDataRadial=[{type:2,subtype:5,gradientColorsStr:this.gradientColorsStr}],this.btnDirection=new Common.UI.Button({cls:"btn-large-dataview",scaling:!1,iconCls:"item-gradient gradient-left",menu:new Common.UI.Menu({style:"min-width: 60px;",menuAlign:"tr-br",items:[{template:i.template('<div id="id-shape-menu-direction" style="width: 175px; margin: 0 5px;"></div>')}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textDirection}),this.btnDirection.on("render:after",(function(o){t.mnuDirectionPicker=new Common.UI.DataView({el:e("#id-shape-menu-direction"),parentMenu:o.menu,restoreHeight:174,store:new Common.UI.DataViewStore(t._viewDataLinear),itemTemplate:i.template('<div id="<%= id %>" class="item-gradient" style="background: <% if(type!=2) {%>linear-gradient(<%= type + 90 %>deg,<%= gradientColorsStr %>) <%} else {%> radial-gradient(<%= gradientColorsStr %>) <%}%>;"></div>')})})),this.btnDirection.render(e("#shape-button-direction")),this.mnuDirectionPicker.on("item:click",i.bind(this.onSelectGradient,this,this.btnDirection)),this.fillControls.push(this.btnDirection),this.sldrGradient=new Common.UI.MultiSliderGradient({el:e("#shape-slider-gradient"),width:192,minValue:0,maxValue:100,values:[0,100]}),this.sldrGradient.on("change",i.bind(this.onGradientChange,this)),this.sldrGradient.on("changecomplete",i.bind(this.onGradientChangeComplete,this)),this.sldrGradient.on("thumbclick",(function(e,i){t.GradColor.currentIdx=i;var o=t.GradColor.colors[t.GradColor.currentIdx];t.btnGradColor.setColor(o),t.colorsGrad.select(o,!1);var n=t.GradColor.values[t.GradColor.currentIdx];t.spnGradPosition.setValue(Common.UI.isRTL()?t.sldrGradient.maxValue-n:n,!0)})),this.sldrGradient.on("thumbdblclick",(function(e){t.btnGradColor.cmpEl.find("button").dropdown("toggle")})),this.sldrGradient.on("sortthumbs",(function(e,o){var n,s=[];i.each(o,(function(e,i){s.push(t.GradColor.colors[e]),t.GradColor.currentIdx==e&&(n=i)})),t.OriginalFillType=null,t.GradColor.colors=s,t.GradColor.currentIdx=n})),this.sldrGradient.on("addthumb",(function(e,i,o){t.GradColor.colors[i]=t.GradColor.colors[t.GradColor.currentIdx],t.GradColor.currentIdx=i;var n=t.sldrGradient.addNewThumb(i,o);t.GradColor.colors[t.GradColor.currentIdx]=n})),this.sldrGradient.on("removethumb",(function(e,o){if(t.sldrGradient.removeThumb(o),t.GradColor.values.splice(o,1),t.sldrGradient.changeGradientStyle(),i.isUndefined(t.GradColor.currentIdx)||t.GradColor.currentIdx>=t.GradColor.colors.length){var n=o>0?o-1:o;n=0===n&&t.GradColor.values.length>2?t.GradColor.values.length-2:n,t.GradColor.currentIdx=n}t.sldrGradient.setActiveThumb(t.GradColor.currentIdx)})),this.fillControls.push(this.sldrGradient),this.spnGradPosition=new Common.UI.MetricSpinner({el:e("#shape-gradient-position"),step:1,width:60,defaultUnit:"%",value:"50 %",allowDecimal:!1,maxValue:100,minValue:0,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textPosition}),this.fillControls.push(this.spnGradPosition),this.spnGradPosition.on("change",i.bind(this.onPositionChange,this)),this.spnGradPosition.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.btnAddGradientStep=new Common.UI.Button({parentEl:e("#shape-gradient-add-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-add-breakpoint",disabled:this._locked,hint:this.tipAddGradientPoint,dataHint:"1",dataHintDirection:"bottom"}),this.btnAddGradientStep.on("click",i.bind(this.onAddGradientStep,this)),this.fillControls.push(this.btnAddGradientStep),this.btnRemoveGradientStep=new Common.UI.Button({parentEl:e("#shape-gradient-remove-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-remove-breakpoint",disabled:this._locked,hint:this.tipRemoveGradientPoint,dataHint:"1",dataHintDirection:"bottom"}),this.btnRemoveGradientStep.on("click",i.bind(this.onRemoveGradientStep,this)),this.fillControls.push(this.btnRemoveGradientStep),this.numGradientAngle=new Common.UI.MetricSpinner({el:e("#shape-spin-gradient-angle"),step:10,width:60,defaultUnit:"°",value:"0 °",allowDecimal:!0,maxValue:359.9,minValue:0,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textAngle}),this.fillControls.push(this.numGradientAngle),this.numGradientAngle.on("change",i.bind(this.onGradientAngleChange,this)),this.numGradientAngle.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.cmbBorderSize=new Common.UI.ComboBorderSizeEditable({el:e("#shape-combo-border-size"),style:"width: 93px;",txtNoBorders:this.txtNoBorders,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strStroke+" "+this.strSize}).on("selected",i.bind(this.onBorderSizeSelect,this)).on("changed:before",i.bind(this.onBorderSizeChanged,this,!0)).on("changed:after",i.bind(this.onBorderSizeChanged,this,!1)).on("combo:blur",i.bind(this.onComboBlur,this,!1)),this.BorderSize=this.cmbBorderSize.store.at(2).get("value"),this.cmbBorderSize.setValue(this.BorderSize),this.lockedControls.push(this.cmbBorderSize),this.cmbBorderType=new Common.UI.ComboBorderType({el:e("#shape-combo-border-type"),style:"width: 93px;",menuStyle:"min-width: 93px;",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strStroke+" "+this.strType}).on("selected",i.bind(this.onBorderTypeSelect,this)).on("combo:blur",i.bind(this.onComboBlur,this,!1)),this.BorderType=Asc.c_oDashType.solid,this.cmbBorderType.setValue(this.BorderType),this.lockedControls.push(this.cmbBorderType),this.numLineTransparency=new Common.UI.MetricSpinner({el:e("#shape-line-spin-transparency"),step:1,width:62,value:"100 %",defaultUnit:"%",maxValue:100,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strStroke+" "+this.strTransparency}),this.numLineTransparency.on("change",i.bind(this.onNumLineTransparencyChange,this)),this.numLineTransparency.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.lockedControls.push(this.numLineTransparency),this.sldrLineTransparency=new Common.UI.SingleSlider({el:e("#shape-line-slider-transparency"),width:75,minValue:0,maxValue:100,value:100}),this.sldrLineTransparency.on("change",i.bind(this.onLineTransparencyChange,this)),this.sldrLineTransparency.on("changecomplete",i.bind(this.onLineTransparencyChangeComplete,this)),this.lockedControls.push(this.sldrLineTransparency),this.lblLineTransparencyStart=e(this.el).find("#shape-line-lbl-transparency-start"),this.lblLineTransparencyEnd=e(this.el).find("#shape-line-lbl-transparency-end"),this.btnRotate270=new Common.UI.Button({parentEl:e("#shape-button-270",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-270",value:0,hint:this.textHint270,dataHint:"1",dataHintDirection:"bottom"}),this.btnRotate270.on("click",i.bind(this.onBtnRotateClick,this)),this.lockedControls.push(this.btnRotate270),this.btnRotate90=new Common.UI.Button({parentEl:e("#shape-button-90",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-rotate-90",value:1,hint:this.textHint90,dataHint:"1",dataHintDirection:"bottom"}),this.btnRotate90.on("click",i.bind(this.onBtnRotateClick,this)),this.lockedControls.push(this.btnRotate90),this.btnFlipV=new Common.UI.Button({parentEl:e("#shape-button-flipv",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-flip-vert",value:0,hint:this.textHintFlipV,dataHint:"1",dataHintDirection:"bottom"}),this.btnFlipV.on("click",i.bind(this.onBtnFlipClick,this)),this.lockedControls.push(this.btnFlipV),this.btnFlipH=new Common.UI.Button({parentEl:e("#shape-button-fliph",t.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-flip-hor",value:1,hint:this.textHintFlipH,dataHint:"1",dataHintDirection:"bottom"}),this.btnFlipH.on("click",i.bind(this.onBtnFlipClick,this)),this.lockedControls.push(this.btnFlipH),this.btnEditShape=new Common.UI.Button({parentEl:e("#shape-button-edit-shape"),cls:"btn-toolbar align-left",caption:this.textEditShape,iconCls:"toolbar__icon btn-menu-shape",style:"width:100%;",menu:new Common.UI.Menu({style:"min-width: 194px;",items:[{caption:this.textEditPoints,value:0,iconCls:"toolbar__icon btn-edit-points"},{caption:this.strChange,menu:new Common.UI.Menu({menuAlign:"tl-tl",cls:"menu-shapes menu-change-shape",items:[],restoreHeightAndTop:!0,additionalAlign:function(i,o,n){i.css({left:o,top:Math.max(Common.Utils.getOffset(e(t.el).parent()).top,Common.Utils.innerHeight()-10-t.shapeRestoreHeight)-parseInt(i.css("margin-top"))})}})}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.btnEditShape),this.btnChangeShape=this.btnEditShape.menu.items[1],this.btnEditShape.menu.items[0].on("click",i.bind(this.onShapeEditPoints,this)),this.btnEditChangeShape=new Common.UI.Button({parentEl:e("#shape-button-change-shape"),cls:"btn-toolbar align-left",caption:this.textEditShape,iconCls:"toolbar__icon btn-menu-shape",style:"width:100%;",menu:new Common.UI.Menu({menuAlign:"tr-br",cls:"menu-shapes menu-change-shape",items:[]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.btnEditChangeShape),this.btnShadowShape=new Common.UI.Button({parentEl:e("#shape-button-shadow-shape"),cls:"btn-toolbar align-left",caption:this.textShadow,iconCls:"toolbar__icon btn-shadow",style:"width:100%;",menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.lockedControls.push(this.btnShadowShape),this.btnShadowShape.setMenu(new Common.UI.Menu({cls:"shifted-right",style:"min-width: 168px",items:[{template:i.template('<div id="shape-button-shadow-shape-menu" class="menu-markers" style="width: 168px; margin: 0 4px 4px 4px;"></div>')},{caption:this.textNoShadow,checkable:!0,value:1},{caption:"--"},this.mnuShadowShapeColor=new Common.UI.MenuItem({caption:this.strColor,menu:new Common.UI.Menu({cls:"color-menu shifted-right",menuAlign:"tl-tr",items:[{template:i.template('<div id="shape-button-shadow-shape-menu-picker" style="width: 164px;display: inline-block;"></div>'),stopPropagation:!0},{caption:"--"},{caption:this.textEyedropper,iconCls:"menu__icon btn-eyedropper",value:1},{caption:this.textMoreColors,value:2}]}),value:2}),{caption:this.textAdjustShadow,value:3}]})),this.btnShadowShape.menu.on("item:click",i.bind(this.onSelectShadowMenu,this)),this.mnuShadowShapeColor.menu.on("item:click",i.bind(this.onSelectShadowColorMenu,this)),this.btnShadowShape.menu.on("show:before",(function(){t._state.ShadowPreset?t.viewShadowShapePresets.selectRecord(t._state.ShadowPreset):t.viewShadowShapePresets.deselectAll()})),this.mnuShadowShapeColor.menu.on("show:before",(function(){t._state.ShadowColor&&t.mnuShadowShapeColorPicker.select(t._state.ShadowColor,!0)})),this.viewShadowShapePresets=new Common.UI.DataView({el:e("#shape-button-shadow-shape-menu"),parentMenu:this.btnShadowShape.menu,outerMenu:{menu:this.btnShadowShape.menu,index:0},allowScrollbar:!1,delayRenderTips:!0,store:new Common.UI.DataViewStore([{value:"tl",offsetX:6,offsetY:6,spread:0,tip:this.txtOffsetBottomRight},{value:"t",offsetX:0,offsetY:6,spread:0,tip:this.txtOffsetBottom},{value:"tr",offsetX:-6,offsetY:6,spread:0,tip:this.txtOffsetBottomLeft},{value:"l",offsetX:6,offsetY:0,spread:0,tip:this.txtOffsetRight},{value:"ctr",offsetX:0,offsetY:0,spread:3,tip:this.txtOffsetCenter},{value:"r",offsetX:-6,offsetY:0,spread:0,tip:this.txtOffsetLeft},{value:"bl",offsetX:6,offsetY:-6,spread:0,tip:this.txtOffsetTopRight},{value:"b",offsetX:0,offsetY:-6,spread:0,tip:this.txtOffsetTop},{value:"br",offsetX:-6,offsetY:-6,spread:0,tip:this.txtOffsetTopLeft}]),itemTemplate:i.template('<div class="item-shadow"><div style="margin-bottom:<%= offsetY %>px;margin-right:<%= offsetX %>px;box-shadow: <% if(Common.Utils.isIE) {%>rgba(0,0,0,0.4)<%} else {%>var(--text-tertiary)<%}%> <%= offsetX %>px <%= offsetY %>px 0px <%= spread %>px ;"></div></div>')}),this.viewShadowShapePresets.on("item:click",i.bind(this.onSelectShadowPreset,this)),this.btnShadowShape.menu.setInnerMenu([{menu:this.viewShadowShapePresets,index:0}]),this.mnuShadowShapeColorPicker=new Common.UI.ThemeColorPalette({el:e("#shape-button-shadow-shape-menu-picker"),outerMenu:{menu:this.mnuShadowShapeColor.menu,index:0}}),this.mnuShadowShapeColor.menu.setInnerMenu([{menu:this.mnuShadowShapeColorPicker,index:0}]),this.mnuShadowShapeColorPicker.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.mnuShadowShapeColorPicker.on("select",i.bind(this.onSelectShadowColor,this)),e(this.el).on("click","#shape-advanced-link",i.bind(this.openAdvancedSettings,this)),this.linkAdvanced=e("#shape-advanced-link")},createDelayedElements:function(){this._initSettings=!1,this.createDelayedControls();var t=[0,1,3,2,4,53,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,23,24,25,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,49,50,51,52];this.patternViewData=[];for(var e=0;e<13;e++)for(var i=0;i<4;i++){var o=4*e+i;this.patternViewData[o]={offsetx:28*i,offsety:28*e,type:t[o]}}this.patternViewData.splice(this.patternViewData.length-2,2);for(e=0;e<this.patternViewData.length;e++)this.patternViewData[e].id=Common.UI.getId();this.cmbPattern.menuPicker.store.add(this.patternViewData),this.cmbPattern.menuPicker.store.length>0&&(this.cmbPattern.fillComboView(this.cmbPattern.menuPicker.store.at(0),!0),this.PatternFillType=this.patternViewData[0].type),this.onInitStandartTextures(),this.onApiAutoShapes(this.btnEditShape.menu.items[1]),this.onApiAutoShapes(this.btnEditChangeShape),this.UpdateThemeColors()},onInitStandartTextures:function(t){var o=this;if(t&&t.length>0&&(o._texturearray=[],i.each(t,(function(t){o._texturearray.push({imageUrl:t.asc_getImage(),name:o.textureNames[t.asc_getId()],tip:o.textureNames[t.asc_getId()],type:t.asc_getId(),selected:!1})}))),o._texturearray&&!(o._texturearray.length<1)&&!this._initSettings&&!this.btnTexture){this.btnTexture=new Common.UI.ComboBox({el:e("#shape-combo-fill-texture"),template:i.template(['<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle" tabindex="0" data-toggle="dropdown">','<div class="form-control text" style="width: 90px;" data-hint="1" data-hint-direction="bottom" data-hint-offset="big">'+this.textSelectTexture+"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default">','<span class="caret" />',"</button>","</div>"].join("")),ariaLabel:this.textTexture}),this.textureMenu=new Common.UI.Menu({items:[{template:i.template('<div id="id-shape-menu-texture" style="width: 233px; margin: 0 5px;"></div>')}]}),this.textureMenu.render(e("#shape-combo-fill-texture")),this.fillControls.push(this.btnTexture);var n=function(t){new Common.UI.DataView({el:e("#id-shape-menu-texture"),restoreHeight:174,parentMenu:t,showLast:!1,delayRenderTips:!0,store:new Common.UI.DataViewStore(o._texturearray||[]),itemTemplate:i.template('<div class="item-texture"><img src="<%= imageUrl %>" id="<%= id %>"></div>')}).on("item:click",i.bind(o.onSelectTexture,o)),t.off("show:before",n)};this.textureMenu.on("show:before",n)}},onSelectTexture:function(t,i,o){if(this._fromTextureCmb=!0,this.cmbFillType.setValue(this._arrFillType[1].value),this._fromTextureCmb=!1,this.api){var n=new Asc.asc_CShapeProperty,s=new Asc.asc_CShapeFill;s.asc_putType(Asc.c_oAscFill.FILL_TYPE_BLIP),s.asc_putFill(new Asc.asc_CFillBlip),s.asc_getFill().asc_putType(Asc.c_oAscFillBlipType.TILE),s.asc_getFill().asc_putTextureId(o.get("type")),n.asc_putFill(s),this.imgprops.asc_putShapeProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}e(this.btnTexture.el).find(".form-control").prop("innerHTML",o.get("name")),Common.NotificationCenter.trigger("edit:complete",this)},onSelectShadowPreset:function(t,e,i){if(this.api){var o=new Asc.asc_CShapeProperty,n=new Asc.asc_CShadowProperty;n.putPreset(i.get("value")),o.asc_putShadow(n),this.imgprops.asc_putShapeProperties(o),this.api.asc_setGraphicObjectProps(this.imgprops)}this.fireEvent("editcomplete",this)},onSelectShadowMenu:function(t,e){if(1==e.value){if(this.api){var i=new Asc.asc_CShapeProperty;if(e.checked)i.asc_putShadow(null);else{var o=new Asc.asc_CShadowProperty;o.putPreset("t"),i.asc_putShadow(o)}this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}this.fireEvent("editcomplete",this)}else if(3==e.value){var n=this;new Common.Views.ShapeShadowDialog({api:this.api,shadowProps:this._originalProps.asc_getShadow(),methodApplySettings:function(t){n.imgprops.asc_putShapeProperties(t),n.api.asc_setGraphicObjectProps(n.imgprops)},handler:function(t){n.fireEvent("editcomplete",this)}}).show()}},onSelectShadowColorMenu:function(t,e){var i=this;1==e.value?this.api.asc_startEyedropper((function(t,e,o){if(void 0!==t){var n=Common.Utils.ThemeColor.getHexColor(t,e,o);i.mnuShadowShapeColorPicker.setCustomColor("#"+n),i.onSelectShadowColor(null,n)}})):2==e.value&&this.mnuShadowShapeColorPicker.addNewColor()},onSelectShadowColor:function(t,e){var i=new Asc.asc_CShapeProperty,o=this._originalProps.asc_getShadow();o||(o=new Asc.asc_CShadowProperty).putPreset("t"),o.putColor(Common.Utils.ThemeColor.getRgbColor(e)),i.asc_putShadow(o),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops),this.fireEvent("editcomplete",this)},onApiAutoShapes:function(t){var e=this,i=function(t){e.fillAutoShapes(),t.off("show:before",i)};t.menu.on("show:before",i)},fillAutoShapes:function(){var t=this,o=Common.localStorage.getItem("sse-recent-shapes"),n=t.canEditPoint?"id-edit-shape-menu":"id-change-shape-menu",s=new Common.UI.MenuItem({template:i.template('<div id="'+n+'" class="menu-insertshape"></div>')});t.btnChangeShape.menu.addItem(s),t.btnChangeShape.shapePicker=new Common.UI.DataViewShape({el:e("#"+n),itemTemplate:i.template('<div class="item-shape" id="<%= id %>"><svg width="20" height="20" class="icon uni-scale"><use xlink:href="#svg-icon-<%= data.shapeType %>"></use></svg></div>'),groups:t.application.getCollection("ShapeGroups"),parentMenu:t.btnChangeShape.menu,restoreHeight:t.shapeRestoreHeight,textRecentlyUsed:t.textRecentlyUsed,recentShapes:o?JSON.parse(o):null,hideTextRect:t._state.isFromImage||t._state.isFromSmartArtInternal,hideLines:!0}),t.btnChangeShape.shapePicker.on("item:click",(function(e,i,o,n){(t.api&&(t.api.asc_changeShapeType(o.get("data").shapeType),Common.NotificationCenter.trigger("edit:complete",t)),"click"!==n.type)&&(t.canEditPoint?t.btnEditShape.menu:t.btnEditChangeShape.menu).hide()}))},onBtnRotateClick:function(t){var e=new Asc.asc_CShapeProperty;e.asc_putRotAdd(3.14159265358979*(1==t.options.value?90:270)/180),this.imgprops.asc_putShapeProperties(e),this.api.asc_setGraphicObjectProps(this.imgprops),Common.NotificationCenter.trigger("edit:complete",this)},toggleBtnEditShape:function(){this.EditShapeContainer.toggleClass("settings-hidden",!this.canEditPoint),this.EditChangeShapeContainer.toggleClass("settings-hidden",this.canEditPoint),this.btnChangeShape=this.canEditPoint?this.btnEditShape.menu.items[1]:this.btnEditChangeShape},onBtnFlipClick:function(t){var e=new Asc.asc_CShapeProperty;1==t.options.value?e.asc_putFlipHInvert(!0):e.asc_putFlipVInvert(!0),this.imgprops.asc_putShapeProperties(e),this.api.asc_setGraphicObjectProps(this.imgprops),Common.NotificationCenter.trigger("edit:complete",this)},onShapeEditPoints:function(){this.api&&this.api.asc_editPointsGeometry()},UpdateThemeColors:function(){this._initSettings||(this.btnBackColor||(this.btnBackColor=new Common.UI.ColorButton({parentEl:e("#shape-back-color-btn"),transparent:!0,color:"transparent",eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"medium",ariaLabel:this.strColor}),this.fillControls.push(this.btnBackColor),this.colorsBack=this.btnBackColor.getPicker(),this.btnBackColor.on("color:select",i.bind(this.onColorsBackSelect,this)),this.btnBackColor.on("eyedropper:start",i.bind(this.onEyedropperStart,this)),this.btnBackColor.on("eyedropper:end",i.bind(this.onEyedropperEnd,this)),this.btnBorderColor=new Common.UI.ColorButton({parentEl:e("#shape-border-color-btn"),color:"000000",eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strStroke+" "+this.strColor}),this.lockedControls.push(this.btnBorderColor),this.colorsBorder=this.btnBorderColor.getPicker(),this.btnBorderColor.on("color:select",i.bind(this.onColorsBorderSelect,this)),this.btnBorderColor.on("eyedropper:start",i.bind(this.onEyedropperStart,this)),this.btnBorderColor.on("eyedropper:end",i.bind(this.onEyedropperEnd,this)),this.btnFGColor=new Common.UI.ColorButton({parentEl:e("#shape-foreground-color-btn"),color:"000000",eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strForeground}),this.fillControls.push(this.btnFGColor),this.colorsFG=this.btnFGColor.getPicker(),this.btnFGColor.on("color:select",i.bind(this.onColorsFGSelect,this)),this.btnFGColor.on("eyedropper:start",i.bind(this.onEyedropperStart,this)),this.btnFGColor.on("eyedropper:end",i.bind(this.onEyedropperEnd,this)),this.btnBGColor=new Common.UI.ColorButton({parentEl:e("#shape-background-color-btn"),color:"ffffff",eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strBackground}),this.fillControls.push(this.btnBGColor),this.colorsBG=this.btnBGColor.getPicker(),this.btnBGColor.on("color:select",i.bind(this.onColorsBGSelect,this)),this.btnBGColor.on("eyedropper:start",i.bind(this.onEyedropperStart,this)),this.btnBGColor.on("eyedropper:end",i.bind(this.onEyedropperEnd,this)),this.btnGradColor=new Common.UI.ColorButton({parentEl:e("#shape-gradient-color-btn"),color:"000000",eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strColor}),this.fillControls.push(this.btnGradColor),this.colorsGrad=this.btnGradColor.getPicker(),this.btnGradColor.on("color:select",i.bind(this.onColorsGradientSelect,this)),this.btnGradColor.on("eyedropper:start",i.bind(this.onEyedropperStart,this)),this.btnGradColor.on("eyedropper:end",i.bind(this.onEyedropperEnd,this))),this.colorsBorder.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBack.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsFG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsGrad.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.mnuShadowShapeColorPicker.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()))},_pt2mm:function(t){return 25.4*t/72},_mm2pt:function(t){return 72*t/25.4},disableFillPanels:function(t){this._state.DisabledFillPanels!==t&&(this._state.DisabledFillPanels=t,i.each(this.fillControls,(function(e){e.setDisabled(t)})),this.lblTransparencyStart.toggleClass("disabled",t),this.lblTransparencyEnd.toggleClass("disabled",t),this.numGradientAngle.setDisabled(t||this.GradFillType!==Asc.c_oAscFillGradType.GRAD_LINEAR))},ShowHideElem:function(t){this.FillColorContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_SOLID),this.FillImageContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_BLIP),this.FillPatternContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_PATT),this.FillGradientContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_GRAD),this.TransparencyContainer.toggleClass("settings-hidden",t===Asc.c_oAscFill.FILL_TYPE_NOFILL||null===t),this.fireEvent("updatescroller",this)},setLocked:function(t){this._locked=t},disableControls:function(t,e){this._initSettings||(this.disableFillPanels(t||e),this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.linkAdvanced.toggleClass("disabled",t),this.lblLineTransparencyStart.toggleClass("disabled",t),this.lblLineTransparencyEnd.toggleClass("disabled",t)),this.btnFlipV.setDisabled(t||this._state.isFromSmartArtInternal),this.btnFlipH.setDisabled(t||this._state.isFromSmartArtInternal))},hideShapeOnlySettings:function(t){this._state.HideShapeOnlySettings!==t&&(this._state.HideShapeOnlySettings=t,this.ShapeOnlySettings.toggleClass("hidden",1==t))},hideChangeTypeSettings:function(t){this._state.HideChangeTypeSettings!==t&&(this._state.HideChangeTypeSettings=t,this.CanChangeType.toggleClass("hidden",1==t))},hideRotationSettings:function(t){this._state.HideRotationSettings!==t&&(this._state.HideRotationSettings=t,this.RotationSettings.toggleClass("hidden",1==t))},onPositionChange:function(t){var e=t.getNumberValue();Common.UI.isRTL()&&(e=this.sldrGradient.maxValue-e);var i=this.GradColor.currentIdx-1<0?0:this.GradColor.values[this.GradColor.currentIdx-1],o=this.GradColor.currentIdx+1<this.GradColor.values.length?this.GradColor.values[this.GradColor.currentIdx+1]:100,n=e<i||e>o;if(this.api){this.GradColor.values[this.GradColor.currentIdx]=e;var s=new Asc.asc_CShapeProperty,a=new Asc.asc_CShapeFill;a.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),a.asc_putFill(new Asc.asc_CFillGrad),a.asc_getFill().asc_putGradType(this.GradFillType);var r=[];this.GradColor.values.forEach((function(t){r.push(1e3*t)})),a.asc_getFill().asc_putPositions(r),s.asc_putFill(a),this.imgprops.asc_putShapeProperties(s),this.api.asc_setGraphicObjectProps(this.imgprops),n&&(this.sldrGradient.sortThumbs(),this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient))}},onAddGradientStep:function(){if(!(this.GradColor.colors.length>9)){var t=this.GradColor.currentIdx,e=(this.GradColor.values[t]+this.GradColor.values[t<this.GradColor.colors.length-1?t+1:t-1])/2;this.GradColor.colors[this.GradColor.colors.length]=this.GradColor.colors[t],this.GradColor.currentIdx=this.GradColor.colors.length-1;var i=this.sldrGradient.addNewThumb(void 0,e,t);this.GradColor.colors[this.GradColor.currentIdx]=i,this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient)}},onRemoveGradientStep:function(){if(!(this.GradColor.values.length<3)){var t=this.GradColor.currentIdx;if(this.GradColor.values.splice(this.GradColor.currentIdx,1),this.sldrGradient.removeThumb(this.GradColor.currentIdx),i.isUndefined(this.GradColor.currentIdx)||this.GradColor.currentIdx>=this.GradColor.colors.length){var e=t>0?t-1:t;e=0===e&&this.GradColor.values.length>2?this.GradColor.values.length-2:e,this.GradColor.currentIdx=e}this.sldrGradient.setActiveThumb(this.GradColor.currentIdx),this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient)}},onGradientAngleChange:function(t,e,i,o){if(this.api&&!this._noApply){var n=new Asc.asc_CShapeProperty,s=new Asc.asc_CShapeFill;s.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),s.asc_putFill(new Asc.asc_CFillGrad),s.asc_getFill().asc_putGradType(this.GradFillType),s.asc_getFill().asc_putLinearAngle(6e4*t.getNumberValue()),s.asc_getFill().asc_putLinearScale(!0),n.asc_putFill(s),this.imgprops.asc_putShapeProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}},onEyedropperStart:function(t){this.api.asc_startEyedropper(i.bind(t.eyedropperEnd,t)),this.fireEvent("eyedropper",!0)},onEyedropperEnd:function(){this.fireEvent("eyedropper",!1)}},SSE.Views.ShapeSettings||{}))})),define("text!spreadsheeteditor/main/app/template/TextArtSettings.template",[],(function(){return'<table cols="1" role="presentation">\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.textTemplate %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="" id="textart-combo-template" style="width: 100%; height: 64px;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.strFill %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div id="textart-combo-fill-src" style="width: 100%;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <div id="textart-panel-color-fill" class="padding-small" style="width: 100%;">\r\n                <div id="textart-back-color-btn" style=""></div>\r\n            </div>\r\n            <div id="textart-panel-image-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <table cols="2" style="width: 100%;" role="presentation">\r\n                <tr>\r\n                    <td class="padding-small" width="50%">\r\n                        <button type="button" class="btn btn-text-default" id="textart-button-from-file" style="width:90px;" data-hint="1" data-hint-direction="bottom" data-hint-offset="big"><%= scope.textFromFile %></button>\r\n                    </td>\r\n                    <td class="padding-small" width="50%">\r\n                        <button type="button" class="btn btn-text-default float-right" id="textart-button-from-url" style="width:90px;" data-hint="1" data-hint-direction="bottom" data-hint-offset="big"><%= scope.textFromUrl %></button>\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <td style="vertical-align: top">\r\n                        <div id="textart-combo-fill-type" style="width: 90px;"></div>\r\n                    </td>\r\n                    <td rowspan="2">\r\n                        <div class="texture-img float-right" style="width: 90px; height: 80px;">\r\n                            <div id="textart-texture-img" style="width: 50px;height: 50px;"></div>\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <td style="vertical-align: bottom">\r\n                        <label class="input-label" style=""><%= scope.textTexture %></label>\r\n                        <div id="textart-combo-fill-texture" style="width: 90px;"></div>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n            </div>\r\n            <div id="textart-panel-pattern-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <label class="input-label" style="margin-top: 3px;"><%= scope.strPattern %></label>\r\n                <div id="textart-combo-pattern" style="width: 100%; height: 42px; margin-bottom: 8px;"></div>\r\n                <div style="width: 100%; height: 25px; margin-bottom: 8px;">\r\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.strForeground %></label>\r\n                    <div id="textart-foreground-color-btn" class="float-right"></div>\r\n                </div>\r\n                <div style="width: 100%; height: 25px;">\r\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.strBackground %></label>\r\n                    <div id="textart-background-color-btn" class="float-right"></div>\r\n                </div>\r\n            </div>\r\n            <div id="textart-panel-gradient-fill" class="settings-hidden padding-small" style="width: 100%;">\r\n                <table cols="3" style="margin-bottom: 10px;" role="presentation">\r\n                    <tr valign="top">\r\n                        <td colspan="2">\r\n                            <div>\r\n                                <label class="input-label" style=""><%= scope.textStyle %></label>\r\n                                <div id="textart-combo-grad-type" style="width: 100%;"></div>\r\n                            </div>\r\n                        </td>\r\n                        <td rowspan="2" style="width: 100%;">\r\n                            <div class="float-right">\r\n                                <label class="input-label"><%= scope.textDirection %></label>\r\n                                <div id="textart-button-direction"></div>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                    <tr valign="bottom">\r\n                        <td>\r\n                            <label class="input-label angle-label"><%= scope.textAngle %></label>\r\n                        </td>\r\n                        <td>\r\n                            <div id="textart-spin-gradient-angle" style="display: inline-block; width: 60px;"></div>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n                <label class="input-label" style="display:block;margin-bottom: 5px;"><%= scope.textGradient %></label>\r\n                <div style="display: inline-block; margin-top: 3px;">\r\n                    <div id="textart-slider-gradient" style="display: inline-block; vertical-align: middle;"></div>\r\n                </div>\r\n                <div style="height: 40px;margin-top:6px;display:flex;justify-content:space-between;">\r\n                    <div style="display: flex;">\r\n                    <div style="">\r\n                        <label class="input-label" style=""><%= scope.strColor %></label>\r\n                        <div id="textart-gradient-color-btn"></div>\r\n                    </div>\r\n                    <div class="margin-left-10">\r\n                        <label class="input-label" style=""><%= scope.textPosition %></label>\r\n                        <div id="textart-gradient-position"></div>\r\n                    </div>\r\n                    </div>\r\n                    <div style="display:flex;padding-top:15px;">\r\n                        <div id="textart-gradient-add-step"></div>\r\n                        <div id="textart-gradient-remove-step"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <div class="padding-small" id="textart-panel-transparent-fill" style="width: 100%;">\r\n                <label class="header" style="display:block;"><%= scope.strTransparency %></label>\r\n                <div style="display: inline-block; margin-top: 3px;">\r\n                    <label id="textart-lbl-transparency-start">0</label>\r\n                    <div id="textart-slider-transparency" style="display: inline-block;margin: 0 4px; vertical-align: middle;"></div>\r\n                    <label id="textart-lbl-transparency-end">100</label>\r\n                </div>\r\n                <div id="textart-spin-transparency" class="float-right"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <label class="header"><%= scope.strStroke %></label>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n        <div style="display:inline-block;width:100px;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strSize %></label>\r\n            <div id="textart-combo-border-size" style="width: 93px;"></div>\r\n        </div>\r\n        <div style="display:inline-block;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strColor %></label>\r\n            <div id="textart-border-color-btn" style=""></div>\r\n        </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td class="padding-small">\r\n        <div style="display:inline-block;width:100px;vertical-align: middle;">\r\n            <label class="input-label" style=""><%= scope.strType %></label>\r\n            <div id="textart-combo-border-type" style="width: 93px;"></div>\r\n        </div>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <div class="padding-small" id="textart-line-panel-transparent-fill" style="width: 100%;">\r\n                <label class="header" style="display:block;"><%= scope.strTransparency %></label>\r\n                <div style="display: inline-block; margin-top: 3px;">\r\n                    <label id="textart-line-lbl-transparency-start">0</label>\r\n                    <div id="textart-line-slider-transparency" style="display: inline-block;margin: 0 4px; vertical-align: middle;"></div>\r\n                    <label id="textart-line-lbl-transparency-end">100</label>\r\n                </div>\r\n                <div id="textart-line-spin-transparency" class="float-right"></div>\r\n            </div>\r\n        </td>\r\n    </tr>\r\n    <tr class="textart-transform">\r\n        <td class="padding-small">\r\n            <div class="separator horizontal"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="textart-transform">\r\n        <td>\r\n            <label class="header"><%= scope.textTransform %></label>\r\n        </td>\r\n    </tr>\r\n    <tr class="textart-transform">\r\n        <td class="padding-small">\r\n            <div class="" id="textart-combo-transform" style="width: 100%; height: 42px;"></div>\r\n        </td>\r\n    </tr>\r\n    <tr class="finish-cell"></tr>\r\n</table>'})),define("spreadsheeteditor/main/app/view/TextArtSettings",["text!spreadsheeteditor/main/app/template/TextArtSettings.template","jquery","underscore","backbone","common/main/lib/component/ComboBox","common/main/lib/component/ComboBorderSize","common/main/lib/component/MetricSpinner","common/main/lib/component/ThemeColorPalette","common/main/lib/component/ColorButton","common/main/lib/component/ComboDataView","common/main/lib/component/Slider","common/main/lib/component/MultiSliderGradient"],(function(t,e,i,o){"use strict";SSE.Views.TextArtSettings=o.View.extend(i.extend({el:"#id-textart-settings",template:i.template(t),events:{},options:{alias:"TextArtSettings"},initialize:function(){this._initSettings=!0,this._noApply=!0,this.imgprops=null,this.shapeprops=null,this._sendUndoPoint=!0,this._sliderChanged=!1,this._texturearray=null,this.txtPt=Common.Utils.Metric.getMetricName(Common.Utils.Metric.c_MetricUnits.pt),this._state={Transparency:null,FillType:Asc.c_oAscFill.FILL_TYPE_SOLID,ShapeColor:"transparent",BlipFillType:Asc.c_oAscFillBlipType.STRETCH,StrokeType:Asc.c_oAscStrokeType.STROKE_COLOR,StrokeWidth:this._pt2mm(1),StrokeColor:"000000",StrokeBorderType:Asc.c_oDashType.solid,FGColor:"000000",BGColor:"ffffff",GradColor:"000000",GradFillType:Asc.c_oAscFillGradType.GRAD_LINEAR,FormId:null,DisabledControls:!1,applicationPixelRatio:Common.Utils.applicationPixelRatio(),isFromSmartArtInternal:!1,HideTransformSettings:!1},this.lockedControls=[],this._locked=!1,this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_SOLID,this.ShapeColor={Value:1,Color:"transparent"},this.BlipFillType=Asc.c_oAscFillBlipType.STRETCH,this.GradFillType=Asc.c_oAscFillGradType.GRAD_LINEAR,this.GradColor={values:[0,100],colors:["000000","ffffff"],currentIdx:0},this.GradRadialDirectionIdx=0,this.GradLinearDirectionType=0,this.PatternFillType=0,this.FGColor={Value:1,Color:"000000"},this.BGColor={Value:1,Color:"ffffff"},this.BorderColor={Value:1,Color:"transparent"},this.BorderSize=0,this.BorderType=Asc.c_oDashType.solid,this.textureNames=[this.txtCanvas,this.txtCarton,this.txtDarkFabric,this.txtGrain,this.txtGranite,this.txtGreyPaper,this.txtKnit,this.txtLeather,this.txtBrownPaper,this.txtPapyrus,this.txtWood],this.render(),this.FillColorContainer=e("#textart-panel-color-fill"),this.FillImageContainer=e("#textart-panel-image-fill"),this.FillPatternContainer=e("#textart-panel-pattern-fill"),this.FillGradientContainer=e("#textart-panel-gradient-fill"),this.TransparencyContainer=e("#textart-panel-transparent-fill"),this.TransformSettings=e(".textart-transform"),this.gradientColorsStr="#000, #fff",this.typeGradient=90,SSE.getCollection("Common.Collections.TextArt").bind({reset:this.fillTextArt.bind(this)})},render:function(){e(this.el).html(this.template({scope:this})),e(window).on("resize",i.bind(this.onWindowResize,this))},setApi:function(t){return this.api=t,this.api&&(this.api.asc_setInterfaceDrawImagePlaceTextArt("textart-texture-img"),this.api.asc_registerCallback("asc_onInitStandartTextures",i.bind(this.onInitStandartTextures,this))),this},onFillSrcSelect:function(t,e){switch(this.ShowHideElem(e.value),e.value){case Asc.c_oAscFill.FILL_TYPE_SOLID:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_SOLID,!this._noApply){var i=new Asc.asc_TextArtProperties;(a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_SOLID),a.asc_putFill(new Asc.asc_CFillSolid),a.asc_getFill().asc_putColor(Common.Utils.ThemeColor.getRgbColor("transparent"==this.ShapeColor.Color?{color:"4f81bd",effectId:24}:this.ShapeColor.Color)),i.asc_putFill(a),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_GRAD:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_GRAD,!this._noApply){i=new Asc.asc_TextArtProperties;if((a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),a.asc_putFill(new Asc.asc_CFillGrad),a.asc_getFill().asc_putGradType(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(a.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),a.asc_getFill().asc_putLinearScale(!0)),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD){this.GradColor.values=[0,100],this.GradColor.colors=[this.GradColor.colors[0],this.GradColor.colors[this.GradColor.colors.length-1]],this.GradColor.currentIdx=0;var o=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[0]).get_color().get_hex(),n=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1]).get_color().get_hex();o="ffffff"===o&&"ffffff"===n?{color:"4f81bd",effectId:24}:this.GradColor.colors[0],a.asc_getFill().asc_putPositions([1e3*this.GradColor.values[0],1e3*this.GradColor.values[1]]),a.asc_getFill().asc_putColors([Common.Utils.ThemeColor.getRgbColor(o),Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1])])}i.asc_putFill(a),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_BLIP:if(this._state.FillType!==Asc.c_oAscFill.FILL_TYPE_BLIP&&!this._noApply&&this._texturearray&&this._texturearray.length>0){this._state.FillType=Asc.c_oAscFill.FILL_TYPE_BLIP;i=new Asc.asc_TextArtProperties;(a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_BLIP),a.asc_putFill(new Asc.asc_CFillBlip),a.asc_getFill().asc_putType(Asc.c_oAscFillBlipType.TILE),a.asc_getFill().asc_putTextureId(this._texturearray[0].type),i.asc_putFill(a),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_PATT:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_PATT,!this._noApply){i=new Asc.asc_TextArtProperties;(a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),a.asc_putFill(new Asc.asc_CFillHatch),a.asc_getFill().asc_putPatternType(this.PatternFillType);var s=Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color).get_color().get_hex();s="ffffff"===Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color).get_color().get_hex()&&"ffffff"===s?{color:"4f81bd",effectId:24}:this.FGColor.Color,a.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(s)),a.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),i.asc_putFill(a),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case Asc.c_oAscFill.FILL_TYPE_NOFILL:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_NOFILL,!this._noApply){var a;i=new Asc.asc_TextArtProperties;(a=new Asc.asc_CShapeFill).asc_putType(Asc.c_oAscFill.FILL_TYPE_NOFILL),a.asc_putFill(null),i.asc_putFill(a),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}}Common.NotificationCenter.trigger("edit:complete",this)},onColorsBackSelect:function(t,e){if(this.ShapeColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,o=new Asc.asc_CShapeFill;"transparent"==this.ShapeColor.Color?(o.asc_putType(Asc.c_oAscFill.FILL_TYPE_NOFILL),o.asc_putFill(null)):(o.asc_putType(Asc.c_oAscFill.FILL_TYPE_SOLID),o.asc_putFill(new Asc.asc_CFillSolid),o.asc_getFill().asc_putColor(Common.Utils.ThemeColor.getRgbColor(this.ShapeColor.Color))),i.asc_putFill(o),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onPatternSelect:function(t,e){if(this.api&&!this._noApply){this.PatternFillType=e.get("type");var i=new Asc.asc_TextArtProperties,o=new Asc.asc_CShapeFill;o.asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),o.asc_putFill(new Asc.asc_CFillHatch),o.asc_getFill().asc_putPatternType(this.PatternFillType),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_PATT&&(o.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),o.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),i.asc_putFill(o),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsFGSelect:function(t,e){if(this.FGColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,o=new Asc.asc_CShapeFill;o.asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),o.asc_putFill(new Asc.asc_CFillHatch),o.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_PATT&&(o.asc_getFill().asc_putPatternType(this.PatternFillType),o.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),i.asc_putFill(o),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsBGSelect:function(t,e){if(this.BGColor={Value:1,Color:e},this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,o=new Asc.asc_CShapeFill;o.asc_putType(Asc.c_oAscFill.FILL_TYPE_PATT),o.asc_putFill(new Asc.asc_CFillHatch),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_PATT&&(o.asc_getFill().asc_putPatternType(this.PatternFillType),o.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color))),o.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),i.asc_putFill(o),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onFillTypeSelect:function(t,e){if(this.BlipFillType=e.value,this.api&&!0!==this._fromTextureCmb&&this.OriginalFillType==Asc.c_oAscFill.FILL_TYPE_BLIP){var i=new Asc.asc_TextArtProperties,o=new Asc.asc_CShapeFill;o.asc_putType(Asc.c_oAscFill.FILL_TYPE_BLIP),o.asc_putFill(new Asc.asc_CFillBlip),o.asc_getFill().asc_putType(this.BlipFillType),i.asc_putFill(o),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onNumTransparencyChange:function(t,e,i,o){if(this.sldrTransparency.setValue(t.getNumberValue(),!0),this.api){var n=t.getNumberValue(),s=new Asc.asc_TextArtProperties,a=new Asc.asc_CShapeFill;a.asc_putTransparent(2.55*n),s.asc_putFill(a),this.shapeprops.put_TextArtProperties(s),this.api.asc_setGraphicObjectProps(this.imgprops)}},onTransparencyChange:function(t,e,o){this._sliderChanged=e,this.numTransparency.setValue(e,!0),this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(i.bind(this._transparencyApplyFunc,this),100))},onTransparencyChangeComplete:function(t,e,i){clearInterval(this.updateslider),this._sliderChanged=e,this._sendUndoPoint||(this.api.setEndPointHistory(),this._transparencyApplyFunc()),this._sendUndoPoint=!0},_transparencyApplyFunc:function(){if(void 0!==this._sliderChanged){var t=new Asc.asc_TextArtProperties,e=new Asc.asc_CShapeFill;e.asc_putTransparent(2.55*this._sliderChanged),t.asc_putFill(e),this.shapeprops.put_TextArtProperties(t),this.api.asc_setGraphicObjectProps(this.imgprops),this._sliderChanged=void 0}},onGradTypeSelect:function(t,e){if(this.GradFillType=e.value,this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){this.mnuDirectionPicker.store.reset(this._viewDataLinear),this.mnuDirectionPicker.cmpEl.width(175),this.mnuDirectionPicker.restoreHeight=174;e=this.mnuDirectionPicker.store.findWhere({type:this.GradLinearDirectionType});this.mnuDirectionPicker.selectRecord(e,!0),this.typeGradient=e?this.GradLinearDirectionType+90:-1,this.numGradientAngle.setValue(this.GradLinearDirectionType,!0),this.numGradientAngle.setDisabled(this._locked)}else this.GradFillType==Asc.c_oAscFillGradType.GRAD_PATH&&(this.mnuDirectionPicker.store.reset(this._viewDataRadial),this.mnuDirectionPicker.cmpEl.width(60),this.mnuDirectionPicker.restoreHeight=58,this.mnuDirectionPicker.selectByIndex(this.GradRadialDirectionIdx,!0),this.GradRadialDirectionIdx>=0?this.typeGradient=this._viewDataRadial[this.GradRadialDirectionIdx].type:this.typeGradient=-1,this.numGradientAngle.setValue(0,!0),this.numGradientAngle.setDisabled(!0));if(this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,o=new Asc.asc_CShapeFill;o.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),o.asc_putFill(new Asc.asc_CFillGrad),o.asc_getFill().asc_putGradType(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(o.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),o.asc_getFill().asc_putLinearScale(!0)),i.asc_putFill(o),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onSelectGradient:function(t,e,o,n){if(!this._noApply){var s={};if(i.isFunction(n.toJSON)){if(!n.get("selected"))return;s=n.toJSON()}else s=n;if(this.GradFillType===Asc.c_oAscFillGradType.GRAD_LINEAR?(this.GradLinearDirectionType=s.type,this.typeGradient=s.type+90):(this.GradRadialDirectionIdx=0,this.typeGradient=s.type),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR?this.GradLinearDirectionType=s.type:this.GradRadialDirectionIdx=0,this.api&&this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){this.numGradientAngle.setValue(s.type,!0);var a=new Asc.asc_TextArtProperties,r=new Asc.asc_CShapeFill;r.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),r.asc_putFill(new Asc.asc_CFillGrad),r.asc_getFill().asc_putGradType(this.GradFillType),r.asc_getFill().asc_putLinearAngle(6e4*s.type),r.asc_getFill().asc_putLinearScale(!0),a.asc_putFill(r),this.shapeprops.put_TextArtProperties(a),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)}},onColorsGradientSelect:function(t,e){if(this.GradColor.colors[this.GradColor.currentIdx]=e,this.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==_typeof(e)?e.color:e)),this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,o=new Asc.asc_CShapeFill;o.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),o.asc_putFill(new Asc.asc_CFillGrad),o.asc_getFill().asc_putGradType(this.GradFillType);var n=[];this.GradColor.colors.forEach((function(t){n.push(Common.Utils.ThemeColor.getRgbColor(t))})),o.asc_getFill().asc_putColors(n),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD&&(this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(o.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),o.asc_getFill().asc_putLinearScale(!0)),n=[],this.GradColor.values.forEach((function(t){n.push(1e3*t)})),o.asc_getFill().asc_putPositions(n)),i.asc_putFill(o),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onGradientChange:function(t,e,o){this.GradColor.values=t.getValues();var n=this.GradColor.values[this.GradColor.currentIdx];this.spnGradPosition.setValue(Common.UI.isRTL()?this.sldrGradient.maxValue-n:n,!0),this._sliderChanged=!0,this.api&&!this._noApply&&this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(i.bind(this._gradientApplyFunc,this),100))},onGradientChangeComplete:function(t,e,i){clearInterval(this.updateslider),this._sliderChanged=!0,this._sendUndoPoint||(this.api.setEndPointHistory(),this._gradientApplyFunc()),this._sendUndoPoint=!0},_gradientApplyFunc:function(){if(this._sliderChanged){var t=new Asc.asc_TextArtProperties,e=new Asc.asc_CShapeFill;e.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),e.asc_putFill(new Asc.asc_CFillGrad),e.asc_getFill().asc_putGradType(this.GradFillType);var i=[];this.GradColor.values.forEach((function(t){i.push(1e3*t)})),e.asc_getFill().asc_putPositions(i),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD&&(this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&(e.asc_getFill().asc_putLinearAngle(6e4*this.GradLinearDirectionType),e.asc_getFill().asc_putLinearScale(!0)),i=[],this.GradColor.colors.forEach((function(t){i.push(Common.Utils.ThemeColor.getRgbColor(t))})),e.asc_getFill().asc_putColors(i)),t.asc_putFill(e),this.shapeprops.put_TextArtProperties(t),this.api.asc_setGraphicObjectProps(this.imgprops),this._sliderChanged=!1}},applyBorderSize:function(t){if(t=Common.Utils.String.parseFloat(t),t=isNaN(t)?0:Math.max(0,Math.min(1584,t)),this.BorderSize=t,this.api&&!this._noApply){var e=new Asc.asc_TextArtProperties,i=new Asc.asc_CStroke;this.BorderSize<1e-5?(i.asc_putType(Asc.c_oAscStrokeType.STROKE_NONE),this._state.StrokeType=this._state.StrokeWidth=-1):(i.asc_putType(Asc.c_oAscStrokeType.STROKE_COLOR),"transparent"==this.BorderColor.Color||"transparent"==this.BorderColor.Color.color?i.asc_putColor(Common.Utils.ThemeColor.getRgbColor({color:"000000",effectId:29})):this._state.StrokeType!=Asc.c_oAscStrokeType.STROKE_NONE&&null!==this._state.StrokeType||i.asc_putColor(Common.Utils.ThemeColor.getRgbColor(Common.Utils.ThemeColor.colorValue2EffectId(this.BorderColor.Color))),i.asc_putPrstDash(this.BorderType),i.asc_putWidth(this._pt2mm(this.BorderSize)),i.asc_putTransparent(this._state.LineTransparency)),e.asc_putLine(i),this.shapeprops.put_TextArtProperties(e),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onComboBlur:function(){Common.NotificationCenter.trigger("edit:complete",this)},onBorderSizeChanged:function(t,e,o,n){var s=this;if(t){var a=parseFloat(o.value);(!new RegExp("^\\s*(\\d*(\\.|,)?\\d+)\\s*("+s.txtPt+")?\\s*$").exec(o.value)||a<0||a>1584)&&(this._state.StrokeType=this._state.StrokeWidth=-1,setTimeout((function(){Common.UI.error({msg:s.textBorderSizeErr,callback:function(){i.defer((function(t){Common.NotificationCenter.trigger("edit:complete",s)}))}})}),10))}else this.applyBorderSize(o.value)},onBorderSizeSelect:function(t,e){this.applyBorderSize(e.value)},onBorderTypeSelect:function(t,e){if(this.BorderType=e.value,this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties,o=new Asc.asc_CStroke;this.BorderSize<1e-5?o.put_type(Asc.c_oAscStrokeType.STROKE_NONE):(o.put_type(Asc.c_oAscStrokeType.STROKE_COLOR),o.put_color(Common.Utils.ThemeColor.getRgbColor(this.BorderColor.Color)),o.put_width(this._pt2mm(this.BorderSize)),o.asc_putPrstDash(this.BorderType),o.asc_putTransparent(this._state.LineTransparency)),i.asc_putLine(o),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsBorderSelect:function(t,e){if(this.BorderColor={Value:1,Color:e},this.api&&this.BorderSize>0&&!this._noApply){var i=new Asc.asc_TextArtProperties,o=new Asc.asc_CStroke;this.BorderSize<1e-5?o.asc_putType(Asc.c_oAscStrokeType.STROKE_NONE):(o.asc_putType(Asc.c_oAscStrokeType.STROKE_COLOR),o.asc_putColor(Common.Utils.ThemeColor.getRgbColor(this.BorderColor.Color)),o.asc_putWidth(this._pt2mm(this.BorderSize)),o.asc_putPrstDash(this.BorderType),o.asc_putTransparent(this._state.LineTransparency)),i.asc_putLine(o),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onNumLineTransparencyChange:function(t,e,i,o){if(this.sldrLineTransparency.setValue(t.getNumberValue(),!0),this._state.LineTransparency=2.55*t.getNumberValue(),this.api&&this.BorderSize>0&&!this._noApply){var n=new Asc.asc_TextArtProperties,s=new Asc.asc_CStroke;s.asc_putTransparent(this._state.LineTransparency),n.asc_putLine(s),this.shapeprops.put_TextArtProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}},onLineTransparencyChange:function(t,e,o){this._sliderChangedLine=e,this.numLineTransparency.setValue(e,!0),this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updatesliderline=setInterval(i.bind(this._transparencyLineApplyFunc,this),100))},onLineTransparencyChangeComplete:function(t,e,i){clearInterval(this.updatesliderline),this._sliderChangedLine=e,this._sendUndoPoint||(this.api.setEndPointHistory(),this._transparencyLineApplyFunc()),this._sendUndoPoint=!0},_transparencyLineApplyFunc:function(){if(void 0!==this._sliderChangedLine){this._state.LineTransparency=2.55*this._sliderChangedLine;var t=new Asc.asc_TextArtProperties,e=new Asc.asc_CStroke;e.asc_putTransparent(this._state.LineTransparency),t.asc_putLine(e),this.shapeprops.put_TextArtProperties(t),this.api.asc_setGraphicObjectProps(this.imgprops),this._sliderChangedLine=void 0}},insertFromUrl:function(){var t=this;new Common.Views.ImageFromUrlDialog({handler:function(e,o){if("ok"==e&&t.api){var n=o.replace(/ /g,"");if(!i.isEmpty(n)&&null!==t.BlipFillType){var s=new Asc.asc_TextArtProperties,a=new Asc.asc_CShapeFill;a.asc_putType(Asc.c_oAscFill.FILL_TYPE_BLIP),a.asc_putFill(new Asc.asc_CFillBlip),a.asc_getFill().asc_putType(t.BlipFillType),a.asc_getFill().asc_putUrl(n),s.asc_putFill(a),t.shapeprops.put_TextArtProperties(s),t.api.asc_setGraphicObjectProps(t.imgprops)}}Common.NotificationCenter.trigger("edit:complete",t)}}).show()},ChangeSettings:function(t){if(null==this.imgprops&&(this.imgprops=new Asc.asc_CImgProperty,this.imgprops.asc_putShapeProperties(new Asc.asc_CShapeProperty),this.shapeprops=this.imgprops.asc_getShapeProperties()),this._initSettings&&this.createDelayedElements(),this._state.isFromSmartArtInternal=t.asc_getShapeProperties()&&t.asc_getShapeProperties().asc_getFromSmartArtInternal(),this.hideTransformSettings(this._state.isFromSmartArtInternal),t&&t.asc_getShapeProperties()&&t.asc_getShapeProperties().get_TextArtProperties()){var o=t.asc_getShapeProperties().get_TextArtProperties();this._noApply=!0,this.disableControls(this._locked);var n=null,s=o.asc_getFill(),a=s?s.asc_getType():null,r=null;if(s){var l=s.asc_getTransparent();(Math.abs(this._state.Transparency-l)>.001||Math.abs(this.numTransparency.getNumberValue()-l)>.001||(null===this._state.Transparency||null===l)&&(this._state.Transparency!==l||this.numTransparency.getNumberValue()!==l))&&(void 0!==l&&(this.sldrTransparency.setValue(null===l?100:l/255*100,!0),this.numTransparency.setValue(this.sldrTransparency.getValue(),!0)),this._state.Transparency=l)}if(null==s||null===a)this.OriginalFillType=null;else if(a==Asc.c_oAscFill.FILL_TYPE_NOFILL)this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_NOFILL;else if(a==Asc.c_oAscFill.FILL_TYPE_SOLID)(r=(s=s.asc_getFill()).asc_getColor())?r.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.ShapeColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(r.asc_getR(),r.asc_getG(),r.asc_getB()),effectValue:r.asc_getValue()}}:this.ShapeColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(r.asc_getR(),r.asc_getG(),r.asc_getB())}:this.ShapeColor={Value:0,Color:"transparent"},this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_SOLID,this.FGColor="transparent"!==this.ShapeColor.Color?{Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.ShapeColor.Color)}:{Value:1,Color:"000000"},this.BGColor={Value:1,Color:"ffffff"},this.GradColor.colors[0]="transparent"!==this.ShapeColor.Color?Common.Utils.ThemeColor.colorValue2EffectId(this.ShapeColor.Color):"000000",this.GradColor.colors[this.GradColor.colors.length-1]="ffffff";else if(a==Asc.c_oAscFill.FILL_TYPE_BLIP)s=s.asc_getFill(),this.BlipFillType=s.asc_getType(),this._state.BlipFillType!==this.BlipFillType&&(this.BlipFillType==Asc.c_oAscFillBlipType.STRETCH||this.BlipFillType==Asc.c_oAscFillBlipType.TILE?this.cmbFillType.setValue(this.BlipFillType):this.cmbFillType.setValue(""),this._state.BlipFillType=this.BlipFillType),this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_BLIP;else if(a==Asc.c_oAscFill.FILL_TYPE_PATT){if(s=s.asc_getFill(),this.PatternFillType=s.asc_getPatternType(),this._state.PatternFillType!==this.PatternFillType){this.cmbPattern.suspendEvents();n=this.cmbPattern.menuPicker.store.findWhere({type:this.PatternFillType});this.cmbPattern.menuPicker.selectRecord(n),this.cmbPattern.resumeEvents(),this._state.PatternFillType=this.PatternFillType}(r=s.asc_getColorFg())?r.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.FGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(r.asc_getR(),r.asc_getG(),r.asc_getB()),effectValue:r.asc_getValue()}}:this.FGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(r.asc_getR(),r.asc_getG(),r.asc_getB())}:this.FGColor={Value:1,Color:"000000"},(r=s.asc_getColorBg())?r.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.BGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(r.asc_getR(),r.asc_getG(),r.asc_getB()),effectValue:r.asc_getValue()}}:this.BGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(r.asc_getR(),r.asc_getG(),r.asc_getB())}:this.BGColor={Value:1,Color:"ffffff"},this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_PATT,this.ShapeColor={Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.FGColor.Color)},this.GradColor.colors[0]=Common.Utils.ThemeColor.colorValue2EffectId(this.FGColor.Color),this.GradColor.colors[this.GradColor.colors.length-1]="ffffff"}else if(a==Asc.c_oAscFill.FILL_TYPE_GRAD){var c=(s=s.asc_getFill()).asc_getGradType();if(this._state.GradFillType===c&&this.GradFillType===c||(this.GradFillType=c,n=void 0,this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR||this.GradFillType==Asc.c_oAscFillGradType.GRAD_PATH?(this.cmbGradType.setValue(this.GradFillType),n=this.cmbGradType.store.findWhere({value:this.GradFillType}),this.onGradTypeSelect(this.cmbGradType,n.attributes)):(this.cmbGradType.setValue(""),this.typeGradient=-1),this._state.GradFillType=this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){var h=Math.floor(s.asc_getLinearAngle()/6e4);if(Math.abs(this.GradLinearDirectionType-h)>.001){this.GradLinearDirectionType=h;var d=this.mnuDirectionPicker.store.findWhere({type:h});this.mnuDirectionPicker.selectRecord(d,!0),this.typeGradient=d?h+90:-1,this.numGradientAngle.setValue(h,!0)}}else this.numGradientAngle.setValue(0,!0);var m=this,p=s.asc_getColors(),u=s.asc_getPositions(),g=p?p.length:this.GradColor.colors.length;this.sldrGradient.setThumbs(g),this.GradColor.colors.length>g&&(this.GradColor.colors.splice(g,this.GradColor.colors.length-g),this.GradColor.values.splice(g,this.GradColor.colors.length-g),this.GradColor.currentIdx=0),p&&p.forEach((function(t,e){t?t.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?(m.GradColor.colors[e]={color:Common.Utils.ThemeColor.getHexColor(t.asc_getR(),t.asc_getG(),t.asc_getB()),effectValue:t.asc_getValue()},Common.Utils.ThemeColor.colorValue2EffectId(m.GradColor.colors[e])):m.GradColor.colors[e]=Common.Utils.ThemeColor.getHexColor(t.asc_getR(),t.asc_getG(),t.asc_getB()):m.GradColor.colors[e]="000000";var i=u[e];null!==i&&(i/=1e3,m.GradColor.values[e]=i)}));for(var f=[],b=this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR?1:.7,C=0;C<g;C++)m.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==_typeof(m.GradColor.colors[C])?m.GradColor.colors[C].color:m.GradColor.colors[C]),C),m.sldrGradient.setValue(C,m.GradColor.values[C]),f.push(m.sldrGradient.getColorValue(C)+" "+m.sldrGradient.getValue(C)*b+"%");this.btnDirectionRedraw(m.sldrGradient,f.join(", ")),(i.isUndefined(m.GradColor.currentIdx)||m.GradColor.currentIdx>=this.GradColor.colors.length)&&(m.GradColor.currentIdx=0),m.sldrGradient.setActiveThumb(m.GradColor.currentIdx);var v=m.GradColor.values[m.GradColor.currentIdx];this.spnGradPosition.setValue(Common.UI.isRTL()?m.sldrGradient.maxValue-v:v),this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_GRAD,this.FGColor={Value:1,Color:this.GradColor.colors[0]},this.BGColor={Value:1,Color:"ffffff"},this.ShapeColor={Value:1,Color:this.GradColor.colors[0]}}this._state.FillType!==this.OriginalFillType&&(this.cmbFillSrc.setValue(null===this.OriginalFillType?"":this.OriginalFillType),this._state.FillType=this.OriginalFillType,this.ShowHideElem(this.OriginalFillType)),e(this.btnTexture.el).find(".form-control").prop("innerHTML",this.textSelectTexture);var _=_typeof(this.ShapeColor.Color),w=_typeof(this._state.ShapeColor);(_!==w||"object"==_&&(this.ShapeColor.Color.effectValue!==this._state.ShapeColor.effectValue||this._state.ShapeColor.color.indexOf(this.ShapeColor.Color.color)<0)||"object"!=_&&this._state.ShapeColor.indexOf(this.ShapeColor.Color)<0)&&(this.btnBackColor.setColor(this.ShapeColor.Color),Common.Utils.ThemeColor.selectPickerColorByEffect(this.ShapeColor.Color,this.colorsBack),this._state.ShapeColor=this.ShapeColor.Color);var A,y=o.asc_getLine(),S=y?y.asc_getType():null,x="transparent"==this._state.StrokeColor&&"transparent"!==this.BorderColor.Color;if(y){l=y.asc_getTransparent();(Math.abs(this._state.LineTransparency-l)>.001||Math.abs(this.numLineTransparency.getNumberValue()-l)>.001||(null===this._state.LineTransparency||null===l)&&(this._state.LineTransparency!==l||this.numLineTransparency.getNumberValue()!==l))&&(void 0!==l&&(this.sldrLineTransparency.setValue(null===l?100:l/255*100,!0),this.numLineTransparency.setValue(this.sldrLineTransparency.getValue(),!0)),this._state.LineTransparency=l),S==Asc.c_oAscStrokeType.STROKE_COLOR&&(r=y.asc_getColor())?r.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.BorderColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(r.asc_getR(),r.asc_getG(),r.asc_getB()),effectValue:r.asc_getValue()}}:this.BorderColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(r.asc_getR(),r.asc_getG(),r.asc_getB())}:this.BorderColor={Value:1,Color:"transparent"},A=y.asc_getPrstDash()}else this.BorderColor={Value:0,Color:"transparent"};if(_=_typeof(this.BorderColor.Color),w=_typeof(this._state.StrokeColor),(x||_!==w||"object"==_&&(this.BorderColor.Color.effectValue!==this._state.StrokeColor.effectValue||this._state.StrokeColor.color.indexOf(this.BorderColor.Color.color)<0)||"object"!=_&&(this._state.StrokeColor.indexOf(this.BorderColor.Color)<0||"object"==_typeof(this.btnBorderColor.color)))&&(this.btnBorderColor.setColor(this.BorderColor.Color),Common.Utils.ThemeColor.selectPickerColorByEffect(this.BorderColor.Color,this.colorsBorder),this._state.StrokeColor=this.BorderColor.Color),this._state.StrokeType!==S||S==Asc.c_oAscStrokeType.STROKE_COLOR){if(S==Asc.c_oAscStrokeType.STROKE_COLOR){var k=y.asc_getWidth(),T=Math.abs(this._state.StrokeWidth-k)<1e-5&&!new RegExp(this.txtPt+"\\s*$").test(this.cmbBorderSize.getRawValue());if(Math.abs(this._state.StrokeWidth-k)>1e-5||T||(null===this._state.StrokeWidth||null===k)&&this._state.StrokeWidth!==k){this._state.StrokeWidth=k,null!==k&&(k=this._mm2pt(k));var I=null===k?k:i.find(this.cmbBorderSize.store.models,(function(t){if(k<t.attributes.value+1e-4&&k>t.attributes.value-1e-4)return!0}));I?this.cmbBorderSize.selectRecord(I):this.cmbBorderSize.setValue(null!==k?parseFloat(k.toFixed(2))+" "+this.txtPt:""),this.BorderSize=k}}else S==Asc.c_oAscStrokeType.STROKE_NONE?(this._state.StrokeWidth=0,this.BorderSize=this.cmbBorderSize.store.at(0).get("value"),this.cmbBorderSize.setValue(this.BorderSize)):(this._state.StrokeWidth=null,this.BorderSize=-1,this.cmbBorderSize.setValue(null));this._state.StrokeType=S}this._state.StrokeBorderType!==A&&(this.BorderType=this._state.StrokeBorderType=A,this.cmbBorderType.setValue(A)),((_=_typeof(this.FGColor.Color))!==(w=_typeof(this._state.FGColor))||"object"==_&&(this.FGColor.Color.effectValue!==this._state.FGColor.effectValue||this._state.FGColor.color.indexOf(this.FGColor.Color.color)<0)||"object"!=_&&this._state.FGColor.indexOf(this.FGColor.Color)<0)&&(this.btnFGColor.setColor(this.FGColor.Color),Common.Utils.ThemeColor.selectPickerColorByEffect(this.FGColor.Color,this.colorsFG),this._state.FGColor=this.FGColor.Color),((_=_typeof(this.BGColor.Color))!==(w=_typeof(this._state.BGColor))||"object"==_&&(this.BGColor.Color.effectValue!==this._state.BGColor.effectValue||this._state.BGColor.color.indexOf(this.BGColor.Color.color)<0)||"object"!=_&&this._state.BGColor.indexOf(this.BGColor.Color)<0)&&(this.btnBGColor.setColor(this.BGColor.Color),Common.Utils.ThemeColor.selectPickerColorByEffect(this.BGColor.Color,this.colorsBG),this._state.BGColor=this.BGColor.Color),((_=_typeof(r=this.GradColor.colors[this.GradColor.currentIdx]))!==(w=_typeof(this._state.GradColor))||"object"==_&&(r.effectValue!==this._state.GradColor.effectValue||this._state.GradColor.color.indexOf(r.color)<0)||"object"!=_&&this._state.GradColor.indexOf(r)<0)&&(this.btnGradColor.setColor(r),Common.Utils.ThemeColor.selectPickerColorByEffect(r,this.colorsGrad),this._state.GradColor=r);var E=o.asc_getForm();if(this._state.FormId!==E){this.cmbTransform.suspendEvents();n=this.cmbTransform.menuPicker.store.findWhere({type:E});this.cmbTransform.menuPicker.selectRecord(n),this.cmbTransform.resumeEvents(),this._state.FormId=E}this._noApply=!1}},btnDirectionRedraw:function(t,e){this.gradientColorsStr=e,i.each(this._viewDataLinear,(function(t){t.gradientColorsStr=e})),this._viewDataRadial.gradientColorsStr=this.gradientColorsStr,this.mnuDirectionPicker.store.each((function(t){t.set("gradientColorsStr",e)}),this),-1==this.typeGradient?this.btnDirection.$icon.css({background:"none"}):2==this.typeGradient?this.btnDirection.$icon.css({background:"radial-gradient("+e+")"}):this.btnDirection.$icon.css({background:"linear-gradient("+this.typeGradient+"deg, "+e+")"})},createDelayedControls:function(){var t=this;this._arrFillSrc=[{displayValue:this.textColor,value:Asc.c_oAscFill.FILL_TYPE_SOLID},{displayValue:this.textGradientFill,value:Asc.c_oAscFill.FILL_TYPE_GRAD},{displayValue:this.textImageTexture,value:Asc.c_oAscFill.FILL_TYPE_BLIP},{displayValue:this.textPatternFill,value:Asc.c_oAscFill.FILL_TYPE_PATT},{displayValue:this.textNoFill,value:Asc.c_oAscFill.FILL_TYPE_NOFILL}],this.cmbFillSrc=new Common.UI.ComboBox({el:e("#textart-combo-fill-src"),cls:"input-group-nr",style:"width: 100%;",menuStyle:"min-width: 100%;",editable:!1,data:this._arrFillSrc,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strFill}),this.cmbFillSrc.setValue(this._arrFillSrc[0].value),this.cmbFillSrc.on("selected",i.bind(this.onFillSrcSelect,this)),this.lockedControls.push(this.cmbFillSrc);this.cmbPattern=new Common.UI.ComboDataView({itemWidth:28,itemHeight:28,menuMaxHeight:300,enableKeyEvents:!0,cls:"combo-pattern",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",fillOnChangeVisibility:!0,itemTemplate:i.template(['<div class="style" id="<%= id %>">','<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" class="combo-pattern-item" ','width="28" height="28" ','style="background-position: -<%= offsetx %>px -<%= offsety %>px;"/>',"</div>"].join("")),ariaLabel:this.strPattern}),this.cmbPattern.render(e("#textart-combo-pattern")),this.cmbPattern.on("click",i.bind(this.onPatternSelect,this)),this.cmbPattern.openButton.menu.on("show:after",(function(){t.cmbPattern.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.lockedControls.push(this.cmbPattern),this.btnInsertFromFile=new Common.UI.Button({el:e("#textart-button-from-file")}),this.lockedControls.push(this.btnInsertFromFile),this.btnInsertFromUrl=new Common.UI.Button({el:e("#textart-button-from-url")}),this.lockedControls.push(this.btnInsertFromUrl),this.btnInsertFromFile.on("click",i.bind((function(t){this.api&&this.api.asc_changeArtImageFromFile(this.BlipFillType),Common.NotificationCenter.trigger("edit:complete",this)}),this)),this.btnInsertFromUrl.on("click",i.bind(this.insertFromUrl,this)),this._arrFillType=[{displayValue:this.textStretch,value:Asc.c_oAscFillBlipType.STRETCH},{displayValue:this.textTile,value:Asc.c_oAscFillBlipType.TILE}],this.cmbFillType=new Common.UI.ComboBox({el:e("#textart-combo-fill-type"),cls:"input-group-nr",menuStyle:"min-width: 90px;",editable:!1,data:this._arrFillType,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strType}),this.cmbFillType.setValue(this._arrFillType[0].value),this.cmbFillType.on("selected",i.bind(this.onFillTypeSelect,this)),this.lockedControls.push(this.cmbFillType),this.numTransparency=new Common.UI.MetricSpinner({el:e("#textart-spin-transparency"),step:1,width:62,value:"100 %",defaultUnit:"%",maxValue:100,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strTransparency}),this.numTransparency.on("change",i.bind(this.onNumTransparencyChange,this)),this.numTransparency.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.lockedControls.push(this.numTransparency),this.sldrTransparency=new Common.UI.SingleSlider({el:e("#textart-slider-transparency"),width:75,minValue:0,maxValue:100,value:100}),this.sldrTransparency.on("change",i.bind(this.onTransparencyChange,this)),this.sldrTransparency.on("changecomplete",i.bind(this.onTransparencyChangeComplete,this)),this.lockedControls.push(this.sldrTransparency),this.lblTransparencyStart=e(this.el).find("#textart-lbl-transparency-start"),this.lblTransparencyEnd=e(this.el).find("#textart-lbl-transparency-end"),this._arrGradType=[{displayValue:this.textLinear,value:Asc.c_oAscFillGradType.GRAD_LINEAR},{displayValue:this.textRadial,value:Asc.c_oAscFillGradType.GRAD_PATH}],this.cmbGradType=new Common.UI.ComboBox({el:e("#textart-combo-grad-type"),cls:"input-group-nr",menuStyle:"min-width: 100%;",editable:!1,data:this._arrGradType,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textStyle}),this.cmbGradType.setValue(this._arrGradType[0].value),this.cmbGradType.on("selected",i.bind(this.onGradTypeSelect,this)),this.lockedControls.push(this.cmbGradType),this._viewDataLinear=[{type:45,subtype:-1},{type:90,subtype:4},{type:135,subtype:5},{type:0,subtype:6,cls:"item-gradient-separator",selected:!0},{type:180,subtype:1},{type:315,subtype:2},{type:270,subtype:3},{type:225,subtype:7}],i.each(this._viewDataLinear,(function(e){e.gradientColorsStr=t.gradientColorsStr})),this._viewDataRadial=[{type:2,subtype:5,gradientColorsStr:this.gradientColorsStr}],this.btnDirection=new Common.UI.Button({cls:"btn-large-dataview",scaling:!1,iconCls:"item-gradient gradient-left",menu:new Common.UI.Menu({style:"min-width: 60px;",menuAlign:"tr-br",items:[{template:i.template('<div id="id-textart-menu-direction" style="width: 175px; margin: 0 5px;"></div>')}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textDirection}),this.btnDirection.on("render:after",(function(o){t.mnuDirectionPicker=new Common.UI.DataView({el:e("#id-textart-menu-direction"),parentMenu:o.menu,restoreHeight:174,store:new Common.UI.DataViewStore(t._viewDataLinear),itemTemplate:i.template('<div id="<%= id %>" class="item-gradient" style="background: <% if(type!=2) {%>linear-gradient(<%= type + 90 %>deg,<%= gradientColorsStr %>) <%} else {%> radial-gradient(<%= gradientColorsStr %>) <%}%>;"></div>')})})),this.btnDirection.render(e("#textart-button-direction")),this.mnuDirectionPicker.on("item:click",i.bind(this.onSelectGradient,this,this.btnDirection)),this.lockedControls.push(this.btnDirection),this.sldrGradient=new Common.UI.MultiSliderGradient({el:e("#textart-slider-gradient"),width:192,minValue:0,maxValue:100,values:[0,100]}),this.sldrGradient.on("change",i.bind(this.onGradientChange,this)),this.sldrGradient.on("changecomplete",i.bind(this.onGradientChangeComplete,this)),this.sldrGradient.on("thumbclick",(function(e,i){t.GradColor.currentIdx=i;var o=t.GradColor.colors[t.GradColor.currentIdx];t.btnGradColor.setColor(o),t.colorsGrad.select(o,!1);var n=t.GradColor.values[t.GradColor.currentIdx];t.spnGradPosition.setValue(Common.UI.isRTL()?t.sldrGradient.maxValue-n:n,!0)})),this.sldrGradient.on("thumbdblclick",(function(e){t.btnGradColor.cmpEl.find("button").dropdown("toggle")})),this.sldrGradient.on("sortthumbs",(function(e,o){var n,s=[];i.each(o,(function(e,i){s.push(t.GradColor.colors[e]),t.GradColor.currentIdx==e&&(n=i)})),t.OriginalFillType=null,t.GradColor.colors=s,t.GradColor.currentIdx=n})),this.sldrGradient.on("addthumb",(function(e,i,o){t.GradColor.colors[i]=t.GradColor.colors[t.GradColor.currentIdx],t.GradColor.currentIdx=i;var n=t.sldrGradient.addNewThumb(i,o);t.GradColor.colors[t.GradColor.currentIdx]=n})),this.sldrGradient.on("removethumb",(function(e,o){if(t.sldrGradient.removeThumb(o),t.GradColor.values.splice(o,1),t.sldrGradient.changeGradientStyle(),i.isUndefined(t.GradColor.currentIdx)||t.GradColor.currentIdx>=t.GradColor.colors.length){var n=o>0?o-1:o;n=0===n&&t.GradColor.values.length>2?t.GradColor.values.length-2:n,t.GradColor.currentIdx=n}t.sldrGradient.setActiveThumb(t.GradColor.currentIdx)})),this.lockedControls.push(this.sldrGradient),this.spnGradPosition=new Common.UI.MetricSpinner({el:e("#textart-gradient-position"),step:1,width:60,defaultUnit:"%",value:"50 %",allowDecimal:!1,maxValue:100,minValue:0,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textPosition}),this.lockedControls.push(this.spnGradPosition),this.spnGradPosition.on("change",i.bind(this.onPositionChange,this)),this.spnGradPosition.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.btnAddGradientStep=new Common.UI.Button({parentEl:e("#textart-gradient-add-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-add-breakpoint",disabled:this._locked,hint:this.tipAddGradientPoint,dataHint:"1",dataHintDirection:"bottom"}),this.btnAddGradientStep.on("click",i.bind(this.onAddGradientStep,this)),this.lockedControls.push(this.btnAddGradientStep),this.btnRemoveGradientStep=new Common.UI.Button({parentEl:e("#textart-gradient-remove-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-remove-breakpoint",disabled:this._locked,hint:this.tipRemoveGradientPoint,dataHint:"1",dataHintDirection:"bottom"}),this.btnRemoveGradientStep.on("click",i.bind(this.onRemoveGradientStep,this)),this.lockedControls.push(this.btnRemoveGradientStep),this.numGradientAngle=new Common.UI.MetricSpinner({el:e("#textart-spin-gradient-angle"),step:10,width:60,defaultUnit:"°",value:"0 °",allowDecimal:!0,maxValue:359.9,minValue:0,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textAngle}),this.lockedControls.push(this.numGradientAngle),this.numGradientAngle.on("change",i.bind(this.onGradientAngleChange,this)),this.numGradientAngle.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.cmbBorderSize=new Common.UI.ComboBorderSizeEditable({el:e("#textart-combo-border-size"),style:"width: 93px;",txtNoBorders:this.txtNoBorders,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strStroke+" "+this.strSize}).on("selected",i.bind(this.onBorderSizeSelect,this)).on("changed:before",i.bind(this.onBorderSizeChanged,this,!0)).on("changed:after",i.bind(this.onBorderSizeChanged,this,!1)).on("combo:blur",i.bind(this.onComboBlur,this,!1)),this.BorderSize=this.cmbBorderSize.store.at(2).get("value"),this.cmbBorderSize.setValue(this.BorderSize),this.lockedControls.push(this.cmbBorderSize),this.cmbBorderType=new Common.UI.ComboBorderType({el:e("#textart-combo-border-type"),style:"width: 93px;",menuStyle:"min-width: 93px;",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strStroke+" "+this.strType}).on("selected",i.bind(this.onBorderTypeSelect,this)).on("combo:blur",i.bind(this.onComboBlur,this,!1)),this.BorderType=Asc.c_oDashType.solid,this.cmbBorderType.setValue(this.BorderType),this.lockedControls.push(this.cmbBorderType),this.numLineTransparency=new Common.UI.MetricSpinner({el:e("#textart-line-spin-transparency"),step:1,width:62,value:"100 %",defaultUnit:"%",maxValue:100,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strStroke+" "+this.strTransparency}),this.numLineTransparency.on("change",i.bind(this.onNumLineTransparencyChange,this)),this.numLineTransparency.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.lockedControls.push(this.numLineTransparency),this.sldrLineTransparency=new Common.UI.SingleSlider({el:e("#textart-line-slider-transparency"),width:75,minValue:0,maxValue:100,value:100}),this.sldrLineTransparency.on("change",i.bind(this.onLineTransparencyChange,this)),this.sldrLineTransparency.on("changecomplete",i.bind(this.onLineTransparencyChangeComplete,this)),this.lockedControls.push(this.sldrLineTransparency),this.lblLineTransparencyStart=e(this.el).find("#textart-line-lbl-transparency-start"),this.lblLineTransparencyEnd=e(this.el).find("#textart-line-lbl-transparency-end"),this.cmbTransform=new Common.UI.ComboDataView({itemWidth:50,itemHeight:50,menuMaxHeight:300,enableKeyEvents:!0,cls:"combo-textart",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textTransform,fillOnChangeVisibility:!0}),this.cmbTransform.render(e("#textart-combo-transform")),this.cmbTransform.on("click",i.bind(this.onTransformSelect,this)),this.cmbTransform.openButton.menu.on("show:after",(function(){t.cmbTransform.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.lockedControls.push(this.cmbTransform)},createDelayedElements:function(){this._initSettings=!1,this.createDelayedControls();var t=[0,1,3,2,4,53,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,23,24,25,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,49,50,51,52];this.patternViewData=[];for(var e=0;e<13;e++)for(var i=0;i<4;i++){var o=4*e+i;this.patternViewData[o]={offsetx:28*i,offsety:28*e,type:t[o]}}this.patternViewData.splice(this.patternViewData.length-2,2);for(e=0;e<this.patternViewData.length;e++)this.patternViewData[e].id=Common.UI.getId();this.cmbPattern.menuPicker.store.add(this.patternViewData),this.cmbPattern.menuPicker.store.length>0&&(this.cmbPattern.fillComboView(this.cmbPattern.menuPicker.store.at(0),!0),this.PatternFillType=this.patternViewData[0].type),this.UpdateThemeColors(),this.onInitStandartTextures(),this.fillTextArt(),this.fillTransform(this.api.asc_getPropertyEditorTextArts())},onInitStandartTextures:function(t){var o=this;if(t&&t.length>0&&(o._texturearray=[],i.each(t,(function(t){o._texturearray.push({imageUrl:t.get_image(),name:o.textureNames[t.get_id()],tip:o.textureNames[t.get_id()],type:t.get_id(),selected:!1})}))),o._texturearray&&!(o._texturearray.length<1)&&!this._initSettings&&!this.btnTexture){this.btnTexture=new Common.UI.ComboBox({el:e("#textart-combo-fill-texture"),template:i.template(['<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle" tabindex="0" data-toggle="dropdown">','<div class="form-control text" style="width: 90px;" data-hint="1" data-hint-direction="bottom" data-hint-offset="big">'+this.textSelectTexture+"</div>",'<div style="display: table-cell;"></div>','<button type="button" class="btn btn-default">','<span class="caret" />',"</button>","</div>"].join("")),ariaLabel:this.textTexture}),this.textureMenu=new Common.UI.Menu({items:[{template:i.template('<div id="id-textart-menu-texture" style="width: 233px; margin: 0 5px;"></div>')}]}),this.textureMenu.render(e("#textart-combo-fill-texture")),this.lockedControls.push(this.btnTexture);var n=function(t){new Common.UI.DataView({el:e("#id-textart-menu-texture"),restoreHeight:174,parentMenu:t,showLast:!1,delayRenderTips:!0,store:new Common.UI.DataViewStore(o._texturearray||[]),itemTemplate:i.template('<div><img src="<%= imageUrl %>" id="<%= id %>"></div>')}).on("item:click",i.bind(o.onSelectTexture,o)),t.off("show:before",n)};this.textureMenu.on("show:before",n)}},onSelectTexture:function(t,i,o){if(this._fromTextureCmb=!0,this.cmbFillType.setValue(this._arrFillType[1].value),this._fromTextureCmb=!1,this.api){var n=new Asc.asc_TextArtProperties,s=new Asc.asc_CShapeFill;s.asc_putType(Asc.c_oAscFill.FILL_TYPE_BLIP),s.asc_putFill(new Asc.asc_CFillBlip),s.asc_getFill().asc_putType(Asc.c_oAscFillBlipType.TILE),s.asc_getFill().asc_putTextureId(o.get("type")),n.asc_putFill(s),this.shapeprops.put_TextArtProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}e(this.btnTexture.el).find(".form-control").prop("innerHTML",o.get("name")),Common.NotificationCenter.trigger("edit:complete",this)},fillTextArt:function(){if(!this._initSettings){var t=this;this.cmbTextArt||(this.cmbTextArt=new Common.UI.ComboDataView({itemWidth:50,itemHeight:50,menuMaxHeight:300,enableKeyEvents:!0,showLast:!1,cls:"combo-textart",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textTemplate,fillOnChangeVisibility:!0}),this.cmbTextArt.render(e("#textart-combo-template")),this.cmbTextArt.on("click",i.bind(this.onTextArtSelect,this)),this.cmbTextArt.openButton.menu.on("show:after",(function(){t.cmbTextArt.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.lockedControls.push(this.cmbTextArt));var o=this.application.getCollection("Common.Collections.TextArt").models,n=this.cmbTextArt.menuPicker.store.length;if(o.length<1)SSE.getController("Main").fillTextArt(this.api.asc_getTextArtPreviews());else if(n>0&&n==o.length){var s=this.cmbTextArt.menuPicker.store.models;i.each(o,(function(t,e){s[e].set("imageUrl",t.get("imageUrl"))}))}else this.cmbTextArt.menuPicker.store.reset(o),this.cmbTextArt.menuPicker.store.length>0&&this.cmbTextArt.fillComboView(this.cmbTextArt.menuPicker.store.at(0))}},onTextArtSelect:function(t,e){if(this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties;i.asc_putStyle(e.get("data")),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},fillTransform:function(t){if(t){for(var e=[],i=0;i<t.length;i++){var o=t[i];e.push({imageUrl:o.Image,type:o.Type,selected:!1})}this.cmbTransform.menuPicker.store.reset(e),this.cmbTransform.menuPicker.store.length>0&&this.cmbTransform.fillComboView(this.cmbTransform.menuPicker.store.at(0),!0)}},onTransformSelect:function(t,e){if(this.api&&!this._noApply){var i=new Asc.asc_TextArtProperties;i.asc_putForm(e.get("type")),this.shapeprops.put_TextArtProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},UpdateThemeColors:function(){this._initSettings||(this.btnBackColor||(this.btnBorderColor=new Common.UI.ColorButton({parentEl:e("#textart-border-color-btn"),color:"000000",eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strStroke+" "+this.strColor}),this.lockedControls.push(this.btnBorderColor),this.colorsBorder=this.btnBorderColor.getPicker(),this.btnBorderColor.on("color:select",i.bind(this.onColorsBorderSelect,this)),this.btnBorderColor.on("eyedropper:start",i.bind(this.onEyedropperStart,this)),this.btnBorderColor.on("eyedropper:end",i.bind(this.onEyedropperEnd,this)),this.btnBackColor=new Common.UI.ColorButton({parentEl:e("#textart-back-color-btn"),transparent:!0,color:"transparent",eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"medium",ariaLabel:this.strColor}),this.lockedControls.push(this.btnBackColor),this.colorsBack=this.btnBackColor.getPicker(),this.btnBackColor.on("color:select",i.bind(this.onColorsBackSelect,this)),this.btnBackColor.on("eyedropper:start",i.bind(this.onEyedropperStart,this)),this.btnBackColor.on("eyedropper:end",i.bind(this.onEyedropperEnd,this)),this.btnFGColor=new Common.UI.ColorButton({parentEl:e("#textart-foreground-color-btn"),color:"000000",eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strForeground}),this.lockedControls.push(this.btnFGColor),this.colorsFG=this.btnFGColor.getPicker(),this.btnFGColor.on("color:select",i.bind(this.onColorsFGSelect,this)),this.btnFGColor.on("eyedropper:start",i.bind(this.onEyedropperStart,this)),this.btnFGColor.on("eyedropper:end",i.bind(this.onEyedropperEnd,this)),this.btnBGColor=new Common.UI.ColorButton({parentEl:e("#textart-background-color-btn"),color:"ffffff",eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strBackground}),this.lockedControls.push(this.btnBGColor),this.colorsBG=this.btnBGColor.getPicker(),this.btnBGColor.on("color:select",i.bind(this.onColorsBGSelect,this)),this.btnBGColor.on("eyedropper:start",i.bind(this.onEyedropperStart,this)),this.btnBGColor.on("eyedropper:end",i.bind(this.onEyedropperEnd,this)),this.btnGradColor=new Common.UI.ColorButton({parentEl:e("#textart-gradient-color-btn"),color:"000000",eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.strColor}),this.lockedControls.push(this.btnGradColor),this.colorsGrad=this.btnGradColor.getPicker(),this.btnGradColor.on("color:select",i.bind(this.onColorsGradientSelect,this)),this.btnGradColor.on("eyedropper:start",i.bind(this.onEyedropperStart,this)),this.btnGradColor.on("eyedropper:end",i.bind(this.onEyedropperEnd,this))),this.colorsBorder.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBack.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsFG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsGrad.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()))},_pt2mm:function(t){return 25.4*t/72},_mm2pt:function(t){return 72*t/25.4},ShowHideElem:function(t){this.FillColorContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_SOLID),this.FillImageContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_BLIP),this.FillPatternContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_PATT),this.FillGradientContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_GRAD),this.TransparencyContainer.toggleClass("settings-hidden",t===Asc.c_oAscFill.FILL_TYPE_NOFILL||null===t),this.fireEvent("updatescroller",this)},setLocked:function(t){this._locked=t},disableControls:function(t){this._initSettings||this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.numGradientAngle.setDisabled(t||this.GradFillType!==Asc.c_oAscFillGradType.GRAD_LINEAR),this.lblLineTransparencyStart.toggleClass("disabled",t),this.lblLineTransparencyEnd.toggleClass("disabled",t))},onPositionChange:function(t){var e=t.getNumberValue();Common.UI.isRTL()&&(e=this.sldrGradient.maxValue-e);var i=this.GradColor.currentIdx-1<0?0:this.GradColor.values[this.GradColor.currentIdx-1],o=this.GradColor.currentIdx+1<this.GradColor.values.length?this.GradColor.values[this.GradColor.currentIdx+1]:100,n=e<i||e>o;if(this.api){this.GradColor.values[this.GradColor.currentIdx]=e;var s=new Asc.asc_TextArtProperties,a=new Asc.asc_CShapeFill;a.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),a.asc_putFill(new Asc.asc_CFillGrad),a.asc_getFill().asc_putGradType(this.GradFillType);var r=[];this.GradColor.values.forEach((function(t){r.push(1e3*t)})),a.asc_getFill().asc_putPositions(r),s.asc_putFill(a),this.shapeprops.put_TextArtProperties(s),this.api.asc_setGraphicObjectProps(this.imgprops),n&&(this.sldrGradient.sortThumbs(),this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient))}},onAddGradientStep:function(){if(!(this.GradColor.colors.length>9)){var t=this.GradColor.currentIdx,e=(this.GradColor.values[t]+this.GradColor.values[t<this.GradColor.colors.length-1?t+1:t-1])/2;this.GradColor.colors[this.GradColor.colors.length]=this.GradColor.colors[t],this.GradColor.currentIdx=this.GradColor.colors.length-1;var i=this.sldrGradient.addNewThumb(void 0,e,t);this.GradColor.colors[this.GradColor.currentIdx]=i,this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient)}},onRemoveGradientStep:function(){if(!(this.GradColor.values.length<3)){var t=this.GradColor.currentIdx;if(this.GradColor.values.splice(this.GradColor.currentIdx,1),this.sldrGradient.removeThumb(this.GradColor.currentIdx),i.isUndefined(this.GradColor.currentIdx)||this.GradColor.currentIdx>=this.GradColor.colors.length){var e=t>0?t-1:t;e=0===e&&this.GradColor.values.length>2?this.GradColor.values.length-2:e,this.GradColor.currentIdx=e}this.sldrGradient.setActiveThumb(this.GradColor.currentIdx),this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient)}},onGradientAngleChange:function(t,e,i,o){if(this.api&&!this._noApply){var n=new Asc.asc_TextArtProperties,s=new Asc.asc_CShapeFill;s.asc_putType(Asc.c_oAscFill.FILL_TYPE_GRAD),s.asc_putFill(new Asc.asc_CFillGrad),s.asc_getFill().asc_putGradType(this.GradFillType),s.asc_getFill().asc_putLinearAngle(6e4*t.getNumberValue()),s.asc_getFill().asc_putLinearScale(!0),n.asc_putFill(s),this.shapeprops.put_TextArtProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}},onWindowResize:function(){this._initSettings||this._state.applicationPixelRatio===Common.Utils.applicationPixelRatio()||this.fillTransform(this.api.asc_getPropertyEditorTextArts()),this._state.applicationPixelRatio=Common.Utils.applicationPixelRatio()},hideTransformSettings:function(t){this._state.HideTransformSettings!==t&&(this._state.HideTransformSettings=t,this.TransformSettings.toggleClass("hidden",!0===t))},onEyedropperStart:function(t){this.api.asc_startEyedropper(i.bind(t.eyedropperEnd,t)),this.fireEvent("eyedropper",!0)},onEyedropperEnd:function(){this.fireEvent("eyedropper",!1)},txtNoBorders:"No Line",strStroke:"Stroke",strColor:"Color",strSize:"Size",strFill:"Fill",textColor:"Color Fill",textImageTexture:"Picture or Texture",textTexture:"From Texture",textFromUrl:"From URL",textFromFile:"From File",textStretch:"Stretch",textTile:"Tile",txtCanvas:"Canvas",txtCarton:"Carton",txtDarkFabric:"Dark Fabric",txtGrain:"Grain",txtGranite:"Granite",txtGreyPaper:"Grey Paper",txtKnit:"Knit",txtLeather:"Leather",txtBrownPaper:"Brown Paper",txtPapyrus:"Papyrus",txtWood:"Wood",strTransparency:"Opacity",textNoFill:"No Fill",textSelectTexture:"Select",textGradientFill:"Gradient Fill",textPatternFill:"Pattern",strBackground:"Background color",strForeground:"Foreground color",strPattern:"Pattern",textEmptyPattern:"No Pattern",textLinear:"Linear",textRadial:"Radial",textDirection:"Direction",textStyle:"Style",textGradient:"Gradient Points",textBorderSizeErr:"The entered value is incorrect.<br>Please enter a value between 0 pt and 1584 pt.",textTransform:"Transform",textTemplate:"Template",strType:"Type",textPosition:"Position",tipAddGradientPoint:"Add gradient point",tipRemoveGradientPoint:"Remove gradient point",textAngle:"Angle"},SSE.Views.TextArtSettings||{}))})),define("text!spreadsheeteditor/main/app/template/TableSettings.template",[],(function(){return'<table cols="2" role="presentation">\n    <tr>\n        <td width="50%">\n            <label class="header"><%= scope.textRows %></label>\n        </td>\n        <td width="50%">\n            <label class="header"><%= scope.textColumns %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small">\n            <div id="table-checkbox-header"></div>\n        </td>\n        <td class="padding-small">\n            <div id="table-checkbox-first"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small">\n            <div id="table-checkbox-total"></div>\n        </td>\n        <td class="padding-small">\n            <div id="table-checkbox-last"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small">\n            <div id="table-checkbox-banded"></div>\n        </td>\n        <td class="padding-small">\n            <div id="table-checkbox-col-banded"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-small">\n            <div id="table-checkbox-filter"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2>\n            <label class="header"><%= scope.textTemplate %></label>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-small">\n            <div class="" id="table-btn-template" style="width: 100%; height: 52px;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr class="hidden">\n        <td colspan=2>\n            <label class="header"><%= scope.textTableName %></label>\n        </td>\n    </tr>\n    <tr class="hidden">\n        <td colspan=2 class="padding-small">\n            <div id="table-txt-name" class="input-row"  style="width: 100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="table-btn-select-data" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="table-btn-edit" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n</table>\n<table cols="2" role="presentation">\n    <tr>\n        <td class="padding-small" colspan=2>\n            <label class="header"><%= scope.textActions %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="table-btn-rem-duplicates" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="table-btn-convert-range" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="table-btn-slicer" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr class="pivot-only">\n        <td class="padding-small" colspan=2>\n            <div id="table-btn-pivot" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td align="center" colspan=2>\n            <label class="link canfocused" id="table-advanced-link" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.textAdvanced %></label>\n        </td>\n    </tr>\n    <tr class="finish-cell"></tr>\n</table>'})),define("spreadsheeteditor/main/app/view/TableSettings",["text!spreadsheeteditor/main/app/template/TableSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/CheckBox","common/main/lib/component/ComboDataView"],(function(t,e,i,o){"use strict";SSE.Views.TableSettings=o.View.extend(i.extend({el:"#id-table-settings",template:i.template(t),events:{},options:{alias:"TableSettings"},initialize:function(){this._initSettings=!0,this._state={TableName:"",TemplateName:"",Range:"",CheckHeader:!1,CheckTotal:!1,CheckBanded:!1,CheckFirst:!1,CheckLast:!1,CheckColBanded:!1,CheckFilter:!1,DisabledControls:!1,TableNameError:!1},this.lockedControls=[],this._locked=!1,this.wsLock=!1,this.wsProps=[],this.isEditCell=!1,this._originalProps=null,this._noApply=!1,this.render()},onCheckTemplateChange:function(t,e,i,o,n,s){this._state[e]=void 0,this.api&&this.api.asc_changeFormatTableInfo(this._state.TableName,t,"checked"==o),Common.NotificationCenter.trigger("edit:complete",this)},onTableTemplateSelect:function(t,e,i,o){this.api&&!this._noApply&&this.api.asc_changeAutoFilter(this._state.TableName,Asc.c_oAscChangeFilterOptions.style,o.get("name")),Common.NotificationCenter.trigger("edit:complete",this)},onEditClick:function(t,e,i){this.api&&(e.options.idx>=0&&e.options.idx<4?this.api.asc_changeSelectionFormatTable(this._state.TableName,e.value):e.options.idx>=4&&e.options.idx<8?this.api.asc_insertCellsInTable(this._state.TableName,e.value):this.api.asc_deleteCellsInTable(this._state.TableName,e.value)),Common.NotificationCenter.trigger("edit:complete",this)},onTableNameChanged:function(t,e,i){var o=this._state.TableName;if(this._state.TableName="",o.toLowerCase()!=e.toLowerCase()){var n=this,s=this.api.asc_checkDefinedName(e,null);if(!0===s.asc_getStatus())s=!0;else switch(s.asc_getReason()){case Asc.c_oAscDefinedNameReason.IsLocked:s=this.textIsLocked;break;case Asc.c_oAscDefinedNameReason.Existed:s=this.textExistName;break;case Asc.c_oAscDefinedNameReason.NameReserved:s=this.textReservedName;break;default:s=this.textInvalidName}!0===s?(this.api.asc_changeDisplayNameTable(o,e),Common.NotificationCenter.trigger("edit:complete",this)):this._state.TableNameError||(this._state.TableNameError=!0,Common.UI.alert({msg:s,title:this.notcriticalErrorTitle,iconCls:"warn",buttons:["ok"],callback:function(t){Common.NotificationCenter.trigger("edit:complete",this),n._state.TableNameError=!1}}))}else Common.NotificationCenter.trigger("edit:complete",this)},render:function(){e(this.el).html(this.template({scope:this})),this.linkAdvanced=e("#table-advanced-link")},setApi:function(t){return this.api=t,t&&(this.api.asc_registerCallback("asc_onSendThemeColors",i.bind(this.onSendThemeColors,this)),this.api.asc_registerCallback("asc_onEditCell",this.onApiEditCell.bind(this))),this},setMode:function(t){this.mode=t},createDelayedControls:function(){this.chHeader=new Common.UI.CheckBox({el:e("#table-checkbox-header"),labelText:this.textHeader,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chHeader),this.chTotal=new Common.UI.CheckBox({el:e("#table-checkbox-total"),labelText:this.textTotal,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chTotal),this.chBanded=new Common.UI.CheckBox({el:e("#table-checkbox-banded"),labelText:this.textBanded,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chBanded),this.chFirst=new Common.UI.CheckBox({el:e("#table-checkbox-first"),labelText:this.textFirst,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chFirst),this.chLast=new Common.UI.CheckBox({el:e("#table-checkbox-last"),labelText:this.textLast,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chLast),this.chColBanded=new Common.UI.CheckBox({el:e("#table-checkbox-col-banded"),labelText:this.textBanded,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chColBanded),this.chFilter=new Common.UI.CheckBox({el:e("#table-checkbox-filter"),labelText:this.textFilter,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chFilter),this.chHeader.on("change",i.bind(this.onCheckTemplateChange,this,Asc.c_oAscChangeTableStyleInfo.rowHeader,"CheckHeader")),this.chTotal.on("change",i.bind(this.onCheckTemplateChange,this,Asc.c_oAscChangeTableStyleInfo.rowTotal,"CheckTotal")),this.chBanded.on("change",i.bind(this.onCheckTemplateChange,this,Asc.c_oAscChangeTableStyleInfo.rowBanded,"CheckBanded")),this.chFirst.on("change",i.bind(this.onCheckTemplateChange,this,Asc.c_oAscChangeTableStyleInfo.columnFirst,"CheckFirst")),this.chLast.on("change",i.bind(this.onCheckTemplateChange,this,Asc.c_oAscChangeTableStyleInfo.columnLast,"CheckLast")),this.chColBanded.on("change",i.bind(this.onCheckTemplateChange,this,Asc.c_oAscChangeTableStyleInfo.columnBanded,"CheckColBanded")),this.chFilter.on("change",i.bind(this.onCheckTemplateChange,this,Asc.c_oAscChangeTableStyleInfo.filterButton,"CheckFilter")),this.txtTableName=new Common.UI.InputField({el:e("#table-txt-name"),name:"tablename",style:"width: 100%;",validateOnBlur:!1}),this.txtTableName.on("changed:after",i.bind(this.onTableNameChanged,this)),this.lockedControls.push(this.txtTableName),this.btnSelectData=new Common.UI.Button({parentEl:e("#table-btn-select-data"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon btn-resize-table",caption:this.textResize,style:"width: 100%;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnSelectData.on("click",i.bind(this.onSelectData,this)),this.lockedControls.push(this.btnSelectData),this.btnEdit=new Common.UI.Button({parentEl:e("#table-btn-edit"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon btn-rows-and-columns",caption:this.textEdit,style:"width: 100%;",menu:new Common.UI.Menu({menuAlign:"tr-br",items:[{caption:this.selectRowText,value:Asc.c_oAscChangeSelectionFormatTable.row,idx:0},{caption:this.selectColumnText,value:Asc.c_oAscChangeSelectionFormatTable.column,idx:1},{caption:this.selectDataText,value:Asc.c_oAscChangeSelectionFormatTable.data,idx:2},{caption:this.selectTableText,value:Asc.c_oAscChangeSelectionFormatTable.all,idx:3},{caption:"--"},{caption:this.insertRowAboveText,value:Asc.c_oAscInsertOptions.InsertTableRowAbove,idx:4},{caption:this.insertRowBelowText,value:Asc.c_oAscInsertOptions.InsertTableRowBelow,idx:5},{caption:this.insertColumnLeftText,value:Asc.c_oAscInsertOptions.InsertTableColLeft,idx:6},{caption:this.insertColumnRightText,value:Asc.c_oAscInsertOptions.InsertTableColRight,idx:7},{caption:"--"},{caption:this.deleteRowText,value:Asc.c_oAscDeleteOptions.DeleteRows,idx:8},{caption:this.deleteColumnText,value:Asc.c_oAscDeleteOptions.DeleteColumns,idx:9},{caption:this.deleteTableText,value:Asc.c_oAscDeleteOptions.DeleteTable,idx:10}]}),dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnEdit.menu.on("show:after",i.bind((function(t){this.api&&(t.items[5].setDisabled(!this._originalProps.asc_getIsInsertRowAbove()),t.items[6].setDisabled(!this._originalProps.asc_getIsInsertRowBelow()),t.items[7].setDisabled(!this._originalProps.asc_getIsInsertColumnLeft()),t.items[8].setDisabled(!this._originalProps.asc_getIsInsertColumnRight()),t.items[10].setDisabled(!this._originalProps.asc_getIsDeleteRow()),t.items[11].setDisabled(!this._originalProps.asc_getIsDeleteColumn()),t.items[12].setDisabled(!this._originalProps.asc_getIsDeleteTable()))}),this)),this.btnEdit.menu.on("item:click",i.bind(this.onEditClick,this)),this.lockedControls.push(this.btnEdit),this.btnConvertRange=new Common.UI.Button({parentEl:e("#table-btn-convert-range"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon btn-convert-to-range",caption:this.textConvertRange,style:"width: 100%;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnConvertRange.on("click",i.bind((function(t){this.api&&this.api.asc_convertTableToRange(this._state.TableName),Common.NotificationCenter.trigger("edit:complete",this)}),this)),this.lockedControls.push(this.btnConvertRange),this.btnRemDuplicates=new Common.UI.Button({parentEl:e("#table-btn-rem-duplicates"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon btn-remove-duplicates",caption:this.textRemDuplicates,style:"width: 100%;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnRemDuplicates.on("click",i.bind((function(t){Common.NotificationCenter.trigger("data:remduplicates",this)}),this)),this.lockedControls.push(this.btnRemDuplicates),this.btnSlicer=new Common.UI.Button({parentEl:e("#table-btn-slicer"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon btn-slicer",caption:this.textSlicer,style:"width: 100%;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnSlicer.on("click",i.bind(this.onInsertSlicerClick,this)),this.lockedControls.push(this.btnSlicer),this.btnPivot=new Common.UI.Button({parentEl:e("#table-btn-pivot"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon btn-pivot-sum",caption:this.textPivot,style:"width: 100%;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.btnPivot.on("click",i.bind(this.onInsertPivotClick,this)),this.lockedControls.push(this.btnPivot),this.$el.find(".pivot-only").toggleClass("hidden",!this.mode.canFeaturePivot),e(this.el).on("click","#table-advanced-link",i.bind(this.openAdvancedSettings,this)),this._initSettings=!1},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;e.api&&!this._locked&&new SSE.Views.TableSettingsAdvanced({tableProps:e._originalProps,api:e.api,handler:function(t,i){"ok"==t&&e.api&&i&&e.api.asc_changeFormatTableInfo(e._state.TableName,Asc.c_oAscChangeTableStyleInfo.advancedSettings,i),Common.NotificationCenter.trigger("edit:complete",e)}}).show()}},ChangeSettings:function(t,e,i){if(this._initSettings&&this.createDelayedControls(),this.wsLock=e,this.wsProps=i,this.disableControls(this._locked),t){this._originalProps=t;var o=t.asc_getTableName();this._state.TableName!==o&&(this.txtTableName.setValue(o),this._state.TableName=o),this._state.Range=t.asc_getTableRange();var n=!1;if(o=t.asc_getFirstRow(),this._state.CheckHeader!==o&&(this.chHeader.setValue(o,!0),this._state.CheckHeader=o,n=!0),o=t.asc_getLastRow(),this._state.CheckTotal!==o&&(this.chTotal.setValue(o,!0),this._state.CheckTotal=o,n=!0),o=t.asc_getBandHor(),this._state.CheckBanded!==o&&(this.chBanded.setValue(o,!0),this._state.CheckBanded=o,n=!0),o=t.asc_getFirstCol(),this._state.CheckFirst!==o&&(this.chFirst.setValue(o,!0),this._state.CheckFirst=o,n=!0),o=t.asc_getLastCol(),this._state.CheckLast!==o&&(this.chLast.setValue(o,!0),this._state.CheckLast=o,n=!0),o=t.asc_getBandVer(),this._state.CheckColBanded!==o&&(this.chColBanded.setValue(o,!0),this._state.CheckColBanded=o,n=!0),o=t.asc_getFilterButton(),this._state.CheckFilter!==o&&(this.chFilter.setValue(o,!0),this._state.CheckFilter=o),this.chFilter.isDisabled()!==(!this._state.CheckHeader||this._locked||null===o)&&this.chFilter.setDisabled(!this._state.CheckHeader||this._locked||null===o||this.wsLock),!n&&this.mnuTableTemplatePicker||this.onApiInitTableTemplates(this.api.asc_getTablePictures(t)),o=t.asc_getTableStyleName(),this._state.TemplateName!==o||this._isTemplatesChanged){var s=this.mnuTableTemplatePicker.store.findWhere({name:o});s||(s=this.mnuTableTemplatePicker.store.at(0)),this.btnTableTemplate.suspendEvents(),this.mnuTableTemplatePicker.selectRecord(s,!0),this.btnTableTemplate.resumeEvents(),this.$el.find(".icon-template-table").css({"background-image":"url("+s.get("imageUrl")+")",height:"44px",width:"60px","background-position":"center","background-size":"cover"}),this._state.TemplateName=o}this._isTemplatesChanged=!1}},onSendThemeColors:function(){this.btnTableTemplate&&this.onApiInitTableTemplates(this.api.asc_getTablePictures(this._originalProps))},onApiInitTableTemplates:function(t){var o=this;this._isTemplatesChanged=!0,this.btnTableTemplate||(this.btnTableTemplate=new Common.UI.Button({cls:"btn-large-dataview sheet-template-table",iconCls:"icon-template-table",scaling:!1,menu:new Common.UI.Menu({items:[{template:i.template('<div id="id-table-menu-template" class="menu-table-template"  style="margin: 0 4px;"></div>')}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textTemplate}),this.btnTableTemplate.on("render:after",(function(t){o.mnuTableTemplatePicker=new Common.UI.DataView({el:e("#id-table-menu-template"),parentMenu:t.menu,restoreHeight:325,groups:new Common.UI.DataViewGroupStore,store:new Common.UI.DataViewStore,itemTemplate:i.template('<div id="<%= id %>" class="item-template"><img src="<%= imageUrl %>" height="44" width="60"></div>'),style:"max-height: 325px;",delayRenderTips:!0})})),this.btnTableTemplate.menu.on("show:before",(function(t){if(t&&o.mnuTableTemplatePicker){var i=o.mnuTableTemplatePicker;if(i.cmpEl){var n=e(i.cmpEl.find(".dataview.inner .item-template").get(0)).parent(),s=n.is(":visible")?parseFloat(n.css("width")):60,a=7*(8+s)+11,r=parseFloat(i.cmpEl.css("margin-left"))+parseFloat(i.cmpEl.css("margin-right"));a+r>Common.Utils.innerWidth()&&(a=Math.max(Math.floor((Common.Utils.innerWidth()-r-11)/(8+s)),2)*(8+s)+11),i.cmpEl.css({width:a}),t.alignPosition()}}})),this.btnTableTemplate.render(e("#table-btn-template")),this.lockedControls.push(this.btnTableTemplate),this.mnuTableTemplatePicker.on("item:click",i.bind(this.onTableTemplateSelect,this,this.btnTableTemplate)),this._locked&&this.btnTableTemplate.setDisabled(this._locked||this.wsProps.FormatCells));var n=o.mnuTableTemplatePicker.store.length;if(n>0&&n==t.length){var s=o.mnuTableTemplatePicker.dataViewItems;s&&i.each(t,(function(t,i){var o=t.asc_getImage(),n=function(t){for(var e=0;e<s.length;e++){if(s[e].model.get("name")&&s[e].model.get("name")===t.asc_getName())return s[e];if(s[e].model.get("caption")===t.asc_getDisplayName())return s[e]}}(t);n&&n.model.set("imageUrl",o,{silent:!0}),n&&e(n.el).find("img").attr("src",o)}))}else{var a=[],r=[{id:"menu-table-group-custom",caption:o.txtGroupTable_Custom,templates:[]},{id:"menu-table-group-light",caption:o.txtGroupTable_Light,templates:[]},{id:"menu-table-group-medium",caption:o.txtGroupTable_Medium,templates:[]},{id:"menu-table-group-dark",caption:o.txtGroupTable_Dark,templates:[]},{id:"menu-table-group-no-name",caption:"&nbsp",templates:[]}];i.each(t,(function(t){var e=t.asc_getDisplayName(),i="",n=null;if(0==t.asc_getType()){var s=e.split(" ");n=s.pop(),null===t.asc_getName()?i="menu-table-group-light":(s.length>0&&(i="menu-table-group-"+s[s.length-1].toLowerCase()),0==r.some((function(t){return t.id===i}))&&(i="menu-table-group-no-name")),s="txtTable_"+s.join(""),e=o[s]?o[s]+" "+n:e,n=parseInt(n)}else i="menu-table-group-custom";r.filter((function(t){return t.id==i}))[0].templates.push({id:Common.UI.getId(),name:t.asc_getName(),caption:t.asc_getDisplayName(),type:t.asc_getType(),imageUrl:t.asc_getImage(),group:i,allowSelected:!0,selected:!1,tip:e,numInGroup:null==n||isNaN(n)?null:n})}));var l=function(t,e){return t.numInGroup-e.numInGroup};r[1].templates.sort(l),r[2].templates.sort(l),r[3].templates.sort(l),(r=r.filter((function(t,e){return t.templates.length>0}))).forEach((function(t){a=a.concat(t.templates),delete t.templates})),o.mnuTableTemplatePicker.groups.reset(r),o.mnuTableTemplatePicker.store.reset(a)}},onSelectData:function(){var t=this;if(t.api){var e=new SSE.Views.TableOptionsDialog({handler:function(e,i){if("ok"==i){t.api.asc_setSelectionDialogMode(Asc.c_oAscSelectionDialogType.None);var o=e.getSettings();o.selectionType==Asc.c_oAscSelectionType.RangeMax||o.selectionType==Asc.c_oAscSelectionType.RangeRow||o.selectionType==Asc.c_oAscSelectionType.RangeCol?Common.UI.warning({title:t.textLongOperation,msg:t.warnLongOperation,buttons:["ok","cancel"],callback:function(e){"ok"==e&&setTimeout((function(){t.api.asc_changeTableRange(t._state.TableName,o.range)}),1),Common.NotificationCenter.trigger("edit:complete",t)}}):t.api.asc_changeTableRange(t._state.TableName,o.range)}Common.NotificationCenter.trigger("edit:complete",t)}});e.show(),e.setSettings({api:t.api,range:t._state.Range,title:t.textResize})}},onInsertSlicerClick:function(){var t=this,e=t.api.asc_beforeInsertSlicer();e&&new SSE.Views.SlicerAddDialog({props:e,handler:function(e,i){t&&t.api&&"ok"==e&&t.api.asc_insertSlicer(i),Common.NotificationCenter.trigger("edit:complete",t)}}).show()},onInsertPivotClick:function(){this.fireEvent("pivottable:create")},onApiEditCell:function(t){this.isEditCell=t!=Asc.c_oAscCellEditorState.editEnd,t!=Asc.c_oAscCellEditorState.editStart&&t!=Asc.c_oAscCellEditorState.editEnd||this.disableControls(this._locked)},setLocked:function(t){this._locked=t},disableControls:function(t){if(!this._initSettings){t=t||this.isEditCell;var e=this;i.each(this.lockedControls,(function(i){i.setDisabled(t||e.wsLock)})),this.linkAdvanced.toggleClass("disabled",t||this.wsLock),this.btnTableTemplate&&this.btnTableTemplate.setDisabled(t||this.wsProps.FormatCells),this.chBanded.setDisabled(t||this.wsProps.FormatCells),this.chFirst.setDisabled(t||this.wsProps.FormatCells),this.chLast.setDisabled(t||this.wsProps.FormatCells),this.chColBanded.setDisabled(t||this.wsProps.FormatCells)}}},SSE.Views.TableSettings||{}))})),define("text!spreadsheeteditor/main/app/template/PivotSettings.template",[],(function(){return'<table cols="2" role="presentation">\n    <tr>\n        <td colspan=2>\n            <label class="header"><%= scope.textFields %></label>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-large">\n            <div id="pivot-list-fields" class="pivot-check-listview"></div>\n        </td>\n    </tr>\n    <tr>\n        <td width="50%">\n            <label class="header"><%= scope.textFilters %></label>\n        </td>\n        <td width="50%">\n            <label class="header"><%= scope.textColumns %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small">\n            <div id="pivot-list-filters" class="pivot-listview"></div>\n        </td>\n        <td class="padding-small">\n            <div id="pivot-list-columns" class="pivot-listview margin-left-3"></div>\n        </td>\n    </tr>\n    <tr>\n        <td width="50%">\n            <label class="header"><%= scope.textRows %></label>\n        </td>\n        <td width="50%">\n            <label class="header"><%= scope.textValues %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-large">\n            <div id="pivot-list-rows" class="pivot-listview"></div>\n        </td>\n        <td class="padding-large">\n            <div id="pivot-list-values" class="pivot-listview margin-left-3"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td align="center" colspan=2>\n            <label class="link" id="pivot-advanced-link" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.textAdvanced %></label>\n        </td>\n    </tr>\n    <tr class="finish-cell"></tr>\n</table>'})),define("spreadsheeteditor/main/app/view/PivotSettings",["text!spreadsheeteditor/main/app/template/PivotSettings.template","jquery","underscore","backbone"],(function(t,e,i,o){"use strict";SSE.Views.PivotSettings=o.View.extend(i.extend({el:"#id-pivot-settings",template:i.template(t),events:{},options:{alias:"PivotSettings"},initialize:function(){this._initSettings=!0,this._state={names:[],DisabledControls:!1,field:{}},this.lockedControls=[],this._locked=!1,this._originalProps=null,this._noApply=!1,this.render()},render:function(){e(this.el).html(this.template({scope:this})),this.linkAdvanced=e("#pivot-advanced-link")},setApi:function(t){return this.api=t,this},createDelayedControls:function(){this.fieldsList=new Common.UI.ListView({el:e("#pivot-list-fields"),store:new Common.UI.DataViewStore,simpleAddMode:!0,template:i.template(['<div class="listview inner no-focus" style=""></div>'].join("")),itemTemplate:i.template(['<div class="has-checkbox">',Common.UI.CheckBoxTemplate,'<div id="<%= id %>" class="list-item" style="pointer-events:none;"><span style="background-color: transparent;"><%= Common.Utils.String.htmlEncode(value) %></span></div>','<div class="listitem-icon img-commonctrl"></div>',"</div>"].join(""))}),this.fieldsList.on({"item:change":this.onItemChanged.bind(this),"item:add":this.onItemChanged.bind(this),"item:click":this.onFieldsCheck.bind(this)}),this.fieldsList.$el.on("dragenter",i.bind(this.onDragEnter,this)),this.fieldsList.$el.on("dragover",i.bind(this.onDragOver,this,this.fieldsList)),this.fieldsList.$el.on("dragleave",i.bind(this.onDragLeave,this,this.fieldsList)),this.fieldsList.$el.on("drop",i.bind(this.onDrop,this)),this.lockedControls.push(this.fieldsList);var t=i.template(['<div id="<%= id %>" class="list-item" style="display:inline-block;">','<div style=""><span><%= Common.Utils.String.htmlEncode(value) %></span></div>','<div class="listitem-icon img-commonctrl"></div>',"</div>"].join(""));this.columnsList=new Common.UI.ListView({el:e("#pivot-list-columns"),store:new Common.UI.DataViewStore,simpleAddMode:!0,template:i.template(['<div class="listview inner no-focus" style=""></div>'].join("")),itemTemplate:t}),this.columnsList.on("item:click",i.bind(this.onColumnsSelect,this,0)),this.columnsList.$el.on("dragenter",i.bind(this.onDragEnter,this)),this.columnsList.$el.on("dragover",i.bind(this.onDragOver,this,this.columnsList)),this.columnsList.$el.on("dragleave",i.bind(this.onDragLeave,this,this.columnsList)),this.columnsList.$el.on("drop",i.bind(this.onDrop,this)),this.lockedControls.push(this.columnsList),this.rowsList=new Common.UI.ListView({el:e("#pivot-list-rows"),store:new Common.UI.DataViewStore,simpleAddMode:!0,template:i.template(['<div class="listview inner no-focus" style=""></div>'].join("")),itemTemplate:t}),this.rowsList.on("item:click",i.bind(this.onColumnsSelect,this,1)),this.rowsList.$el.on("dragenter",i.bind(this.onDragEnter,this)),this.rowsList.$el.on("dragover",i.bind(this.onDragOver,this,this.rowsList)),this.rowsList.$el.on("dragleave",i.bind(this.onDragLeave,this,this.rowsList)),this.rowsList.$el.on("drop",i.bind(this.onDrop,this)),this.lockedControls.push(this.rowsList),this.valuesList=new Common.UI.ListView({el:e("#pivot-list-values"),store:new Common.UI.DataViewStore,simpleAddMode:!0,template:i.template(['<div class="listview inner no-focus" style=""></div>'].join("")),itemTemplate:t}),this.valuesList.on("item:click",i.bind(this.onColumnsSelect,this,2)),this.valuesList.$el.on("dragenter",i.bind(this.onDragEnter,this)),this.valuesList.$el.on("dragover",i.bind(this.onDragOver,this,this.valuesList)),this.valuesList.$el.on("dragleave",i.bind(this.onDragLeave,this,this.valuesList)),this.valuesList.$el.on("drop",i.bind(this.onDrop,this)),this.lockedControls.push(this.valuesList),this.filtersList=new Common.UI.ListView({el:e("#pivot-list-filters"),store:new Common.UI.DataViewStore,simpleAddMode:!0,template:i.template(['<div class="listview inner no-focus" style=""></div>'].join("")),itemTemplate:t}),this.filtersList.on("item:click",i.bind(this.onColumnsSelect,this,3)),this.filtersList.$el.on("dragenter",i.bind(this.onDragEnter,this)),this.filtersList.$el.on("dragover",i.bind(this.onDragOver,this,this.filtersList)),this.filtersList.$el.on("dragleave",i.bind(this.onDragLeave,this,this.filtersList)),this.filtersList.$el.on("drop",i.bind(this.onDrop,this)),this.lockedControls.push(this.filtersList),e(this.el).on("click","#pivot-advanced-link",i.bind(this.openAdvancedSettings,this)),this._initSettings=!1},getDragElement:function(t){return this._dragEl=e('<div style="font-weight: bold;position: absolute;left:-10000px;z-index: 10000;">'+Common.Utils.String.htmlEncode(t)+"</div>"),e(document.body).append(this._dragEl),this._dragEl[0]},onDragEnd:function(){this._dragEl&&this._dragEl.remove(),this._dragEl=null,Common.NotificationCenter.trigger("pivot:dragend",this)},onFieldsDragStart:function(t,e,i){this._state.field={record:t.model},i.originalEvent.dataTransfer.effectAllowed="move",!Common.Utils.isIE&&i.originalEvent.dataTransfer.setDragImage(this.getDragElement(t.model.get("value")),14,14),this.pivotIndex=e,this.fromListView=this.fieldsList.$el[0].id},onItemsDragStart:function(t,e,i,o,n){this._state.field={record:i.model,type:t},n.originalEvent.dataTransfer.effectAllowed="move",!Common.Utils.isIE&&n.originalEvent.dataTransfer.setDragImage(this.getDragElement(i.model.get("value")),14,14),this.itemIndex=o,this.pivotIndex=e.store.at(o).attributes.pivotIndex,this.fromListView=e.$el[0].id},onDragItemEnter:function(t,e,i){i.preventDefault(),t.$el.addClass("insert"),this.indexMoveTo=e},onDragItemLeave:function(t,e,i){t.$el.removeClass("insert"),this.indexMoveTo=void 0},onDragItemOver:function(t,e,i,o){if(-2!==this.pivotIndex||"pivot-list-filters"!==this.enterListView&&"pivot-list-values"!==this.enterListView){o.preventDefault(),o.originalEvent.dataTransfer.dropEffect="move",e.$el.addClass("insert"),this.indexMoveTo=i;var n=e.$el.parent().height(),s=Common.Utils.getPosition(e.$el).top,a=e.$el.outerHeight(),r=e.$el.parent().scrollTop();return s<a&&r>0&&t.scrollToRecord(t.store.at(0===i?0:i-1)),s>n-a&&i<t.store.length&&t.scrollToRecord(t.store.at(i===t.store.length-1?i:i+1)),!1}o.originalEvent.dataTransfer.dropEffect="none"},onDragEnter:function(t){this.enterListView=t.currentTarget.id},onDragOver:function(t,e){if("onlyoffice"!==e.originalEvent.dataTransfer.types[0]&&(-2!==this.pivotIndex||"pivot-list-filters"!==this.enterListView&&"pivot-list-values"!==this.enterListView)&&("pivot-list-fields"!==this.fromListView||"pivot-list-fields"!==this.enterListView))return e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="move",t.$el.find(".item").last().addClass("insert last"),!1;e.originalEvent.dataTransfer.dropEffect="none"},onDragLeave:function(t,e){t.$el.find(".item").removeClass("insert last")},onDrop:function(t){if(t.stopPropagation(),this.onDragEnd(),"pivot-list-fields"===this.fromListView&&"pivot-list-fields"!==this.enterListView){if(i.isNumber(this.pivotIndex)){switch(this.enterListView){case"pivot-list-columns":this.onAddColumn(this.pivotIndex,this.indexMoveTo);break;case"pivot-list-rows":this.onAddRow(this.pivotIndex,this.indexMoveTo);break;case"pivot-list-filters":this.onAddFilter(this.pivotIndex,this.indexMoveTo);break;case"pivot-list-values":this.onAddValues(this.pivotIndex,this.indexMoveTo)}this.pivotIndex=void 0,this.indexMoveTo=void 0}}else if("pivot-list-fields"===this.enterListView)i.isNumber(this.pivotIndex)&&("pivot-list-values"===this.fromListView&&i.isNumber(this.itemIndex)?this.onRemove(this.pivotIndex,this.itemIndex):this.onRemove(this.pivotIndex),this.pivotIndex=void 0);else if(this.fromListView!==this.enterListView){if(i.isNumber(this.itemIndex)&&this.enterListView){switch(this.enterListView){case"pivot-list-columns":this.onMoveTo(0,this.pivotIndex,this.indexMoveTo);break;case"pivot-list-rows":this.onMoveTo(1,this.pivotIndex,this.indexMoveTo);break;case"pivot-list-filters":this.onMoveTo(3,this.pivotIndex,this.indexMoveTo);break;case"pivot-list-values":this.onMoveTo(2,this.pivotIndex,this.indexMoveTo)}this.itemIndex=void 0,this.indexMoveTo=void 0}}else if(this.fromListView===this.enterListView&&i.isNumber(this.itemIndex)&&this.enterListView){if(this.itemIndex!==this.indexMoveTo)switch(this.enterListView){case"pivot-list-columns":this.onMove(0,this.itemIndex,i.isNumber(this.indexMoveTo)?0!==this.indexMoveTo&&this.itemIndex<this.indexMoveTo?this.indexMoveTo-1:this.indexMoveTo:this.columnsList.store.length-1);break;case"pivot-list-rows":this.onMove(1,this.itemIndex,i.isNumber(this.indexMoveTo)?0!==this.indexMoveTo&&this.itemIndex<this.indexMoveTo?this.indexMoveTo-1:this.indexMoveTo:this.rowsList.store.length-1);break;case"pivot-list-filters":this.onMove(3,this.itemIndex,i.isNumber(this.indexMoveTo)?0!==this.indexMoveTo&&this.itemIndex<this.indexMoveTo?this.indexMoveTo-1:this.indexMoveTo:this.filtersList.store.length-1);break;case"pivot-list-values":this.onMove(2,this.itemIndex,i.isNumber(this.indexMoveTo)?0!==this.indexMoveTo&&this.itemIndex<this.indexMoveTo?this.indexMoveTo-1:this.indexMoveTo:this.valuesList.store.length-1)}this.itemIndex=void 0,this.indexMoveTo=void 0}e(this.el).find(".item").removeClass("insert last")},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;e.api&&!this._locked&&new SSE.Views.PivotSettingsAdvanced({props:e._originalProps,api:e.api,handler:function(t,i){"ok"==t&&e.api&&i&&(e._originalProps.asc_set(e.api,i),Common.NotificationCenter.trigger("edit:complete",e)),Common.NotificationCenter.trigger("edit:complete",e)}}).show()}},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedControls(),this.disableControls(this._locked),t){this._originalProps=t,this._state.TableName=t.asc_getName();var e=this,o=[],n=t.asc_getCacheFields(),s=t.asc_getPivotFields();this._state.names=[],s.forEach((function(t,i){e._state.names[i]=t.asc_getName()||n[i].asc_getName()}));var a=function(t,n,s,a){var r=[],l=n.store.models,c=n.store.length===(t?t.length:0);t&&t.forEach((function(t,i){var n=t.asc_getIndex(),s=a?a(n):t.asc_getName();c?l[i].set({pivotIndex:n,index:i,value:s||"",tip:s&&s.length>10?s:""}):r.push(new Common.UI.DataViewModel({selected:!1,allowSelected:!1,pivotIndex:n,index:i,value:s||"",tip:s&&s.length>10?s:""})),o[a?s:e._state.names[n]]=!0})),c||(n.store.reset(r),n.scroller.update({minScrollbarLength:n.minScrollbarLength,alwaysVisibleY:!0,suppressScrollX:!0}),n.dataViewItems.forEach((function(t,o){t.$el.attr("draggable",!0),t.$el.on("dragstart",i.bind(e.onItemsDragStart,e,s,n,t,o)),t.$el.on("dragenter",i.bind(e.onDragItemEnter,e,t,o)),t.$el.on("dragleave",i.bind(e.onDragItemLeave,e,t,o)),t.$el.on("dragover",i.bind(e.onDragItemOver,e,n,t,o)),t.$el.on("drop",i.bind(e.onDrop,e)),t.$el.on("dragend",i.bind(e.onDragEnd,e))})),n.$el.find(".item").last().css({"margin-bottom":"10px"}))},r=t.asc_getColumnFields();r&&(r=i.filter(r,(function(t){var e=t.asc_getIndex();return e>-1||-2==e}))),a(r,this.columnsList,0,(function(t){return t>-1?e._state.names[t]:e.textValues})),(r=t.asc_getRowFields())&&(r=i.filter(r,(function(t){var e=t.asc_getIndex();return e>-1||-2==e}))),a(r,this.rowsList,1,(function(t){return t>-1?e._state.names[t]:e.textValues})),(r=t.asc_getDataFields())&&(r=i.filter(r,(function(t){return t.asc_getIndex()>-1}))),a(r,this.valuesList,2),(r=t.asc_getPageFields())&&(r=i.filter(r,(function(t){return t.asc_getIndex()>-1}))),a(r,this.filtersList,3,(function(t){return e._state.names[t]}));var l=[],c=this.fieldsList.store.models,h=this.fieldsList.store.length===e._state.names.length;e._state.names.forEach((function(t,e){h?c[e].set({value:t,index:e,tip:t.length>25?t:"",check:o[t]}):l.push(new Common.UI.DataViewModel({selected:!1,allowSelected:!1,value:t,index:e,tip:t.length>25?t:"",check:o[t]}))})),h||(this.fieldsList.store.reset(l),this.fieldsList.scroller.update({minScrollbarLength:this.fieldsList.minScrollbarLength,alwaysVisibleY:!0,suppressScrollX:!0}),this.fieldsList.dataViewItems.forEach((function(t,o){t.$el.attr("draggable",!0),t.$el.on("dragstart",i.bind(e.onFieldsDragStart,e,t,o)),t.$el.on("dragend",i.bind(e.onDragEnd,e))})))}},onFieldsCheck:function(t,o,n){var s="",a=!1,r=null,l=window.event?window.event:window._event;if(l){var c=e(l.target);if(c&&c.hasClass("listitem-icon")){if(this._state.field={record:n},this.pivotFieldsMenu){if(this.pivotFieldsMenu.isVisible())return void this.pivotFieldsMenu.hide()}else this.miAddFilter=new Common.UI.MenuItem({caption:this.txtAddFilter,checkable:!1}),this.miAddFilter.on("click",i.bind(this.onAddFilter,this)),this.miAddRow=new Common.UI.MenuItem({caption:this.txtAddRow,checkable:!1}),this.miAddRow.on("click",i.bind(this.onAddRow,this)),this.miAddColumn=new Common.UI.MenuItem({caption:this.txtAddColumn,checkable:!1}),this.miAddColumn.on("click",i.bind(this.onAddColumn,this)),this.miAddValues=new Common.UI.MenuItem({caption:this.txtAddValues,checkable:!1}),this.miAddValues.on("click",i.bind(this.onAddValues,this)),this.pivotFieldsMenu=new Common.UI.Menu({menuAlign:"tr-br",items:[this.miAddFilter,this.miAddRow,this.miAddColumn,this.miAddValues]});null!=n&&n.get("index");var h=this.pivotFieldsMenu,d=e(l.currentTarget),m=e(this.el),p=m.find("#menu-pivot-fields-container");return h.rendered||(p.length<1&&(p=e('<div id="menu-pivot-fields-container" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',h.id),m.append(p)),h.render(p),h.cmpEl.attr({tabindex:"-1"}),h.on("show:after",(function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!0)})).on("hide:after",(function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!1)}))),h.menuAlignEl=d,h.setOffset(-20,-d.height()/2-3),h.show(),i.delay((function(){h.cmpEl.focus()}),10),l.stopPropagation(),void l.preventDefault()}if((s=e(l.currentTarget).find(".list-item")).length){r=Common.Utils.getBoundingClientRect(s.get(0));var u=l.clientX*Common.Utils.zoom(),g=l.clientY*Common.Utils.zoom();r.left<u&&u<r.right&&r.top<g&&g<r.bottom&&(a=!0)}(a||l.target.className.match("checkbox")&&"input"!==l.target.localName)&&this.updateFieldCheck(t,n)}},updateFieldCheck:function(t,e){e&&t&&(e.set("check",!e.get("check")),this.api&&!this._locked&&(e.get("check")?this._originalProps.asc_addField(this.api,e.get("index")):this._originalProps.asc_removeField(this.api,e.get("index")),Common.NotificationCenter.trigger("edit:complete",this)),t.scroller.update({minScrollbarLength:t.minScrollbarLength,alwaysVisibleY:!0,suppressScrollX:!0}))},onColumnsSelect:function(t,o,n,s,a){if(this._state.field={record:s,type:t,length:o.store.length},this.fieldsMenu){if(this.fieldsMenu.isVisible())return void this.fieldsMenu.hide()}else this.miMoveUp=new Common.UI.MenuItem({caption:this.txtMoveUp,checkable:!1}),this.miMoveUp.on("click",i.bind(this.onMoveUp,this)),this.miMoveDown=new Common.UI.MenuItem({caption:this.txtMoveDown,checkable:!1}),this.miMoveDown.on("click",i.bind(this.onMoveDown,this)),this.miMoveBegin=new Common.UI.MenuItem({caption:this.txtMoveBegin,checkable:!1}),this.miMoveBegin.on("click",i.bind(this.onMoveBegin,this)),this.miMoveEnd=new Common.UI.MenuItem({caption:this.txtMoveEnd,checkable:!1}),this.miMoveEnd.on("click",i.bind(this.onMoveEnd,this)),this.miMoveFilter=new Common.UI.MenuItem({caption:this.txtMoveFilter,checkable:!1}),this.miMoveFilter.on("click",i.bind(this.onMoveTo,this,3)),this.miMoveRow=new Common.UI.MenuItem({caption:this.txtMoveRow,checkable:!1}),this.miMoveRow.on("click",i.bind(this.onMoveTo,this,1)),this.miMoveColumn=new Common.UI.MenuItem({caption:this.txtMoveColumn,checkable:!1}),this.miMoveColumn.on("click",i.bind(this.onMoveTo,this,0)),this.miMoveValues=new Common.UI.MenuItem({caption:this.txtMoveValues,checkable:!1}),this.miMoveValues.on("click",i.bind(this.onMoveTo,this,2)),this.miRemove=new Common.UI.MenuItem({caption:this.txtRemove,checkable:!1}),this.miRemove.on("click",i.bind(this.onRemove,this)),this.miFieldSettings=new Common.UI.MenuItem({caption:this.txtFieldSettings,checkable:!1}),this.miFieldSettings.on("click",i.bind(this.onFieldSettings,this)),this.fieldsMenu=new Common.UI.Menu({menuAlign:"tr-br",items:[this.miMoveUp,this.miMoveDown,this.miMoveBegin,this.miMoveEnd,{caption:"--"},this.miMoveFilter,this.miMoveRow,this.miMoveColumn,this.miMoveValues,{caption:"--"},this.miRemove,{caption:"--"},this.miFieldSettings]});var r=null!=s?s.get("index"):-1,l=o.store.length,c=s.get("pivotIndex");this.miMoveUp.setDisabled(r<1),this.miMoveDown.setDisabled(r>l-2||r<0),this.miMoveBegin.setDisabled(r<1),this.miMoveEnd.setDisabled(r>l-2||r<0),this.miMoveFilter.setDisabled(3==t||-2==c),this.miMoveRow.setDisabled(1==t),this.miMoveColumn.setDisabled(0==t),this.miMoveValues.setDisabled(2==t||-2==c),this.miFieldSettings.setDisabled(-2==c);var h=this.fieldsMenu,d=e(a.currentTarget),m=e(this.el),p=m.find("#menu-pivot-container");h.rendered||(p.length<1&&(p=e('<div id="menu-pivot-container" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',h.id),m.append(p)),h.render(p),h.cmpEl.attr({tabindex:"-1"}),h.on("show:after",(function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!0)})).on("hide:after",(function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!1)}))),h.menuAlignEl=d,h.setOffset(-20,-d.height()/2-3),h.show(),i.delay((function(){h.cmpEl.focus()}),10),a.stopPropagation(),a.preventDefault()},setLocked:function(t){this._locked=t},onFieldSettings:function(t,e,i){var o=this;if(o.api&&!this._locked&&o._state.field)if(2==o._state.field.type){var n=o._state.field.record.get("index"),s=o._originalProps.asc_getDataFields()[n];new SSE.Views.ValueFieldSettingsDialog({props:o._originalProps,field:s,api:o.api,handler:function(t,e){"ok"==t&&o.api&&e&&(s.asc_set(o.api,o._originalProps,n,e),Common.NotificationCenter.trigger("edit:complete",o)),Common.NotificationCenter.trigger("edit:complete",o)}}).show()}else{var a=o._state.field.record.get("pivotIndex"),r=o._originalProps.asc_getPivotFields()[a];new SSE.Views.FieldSettingsDialog({props:o._originalProps,fieldIndex:a,api:o.api,type:o._state.field.type,handler:function(t,e){"ok"==t&&o.api&&e&&(r.asc_set(o.api,o._originalProps,a,e),Common.NotificationCenter.trigger("edit:complete",o)),Common.NotificationCenter.trigger("edit:complete",o)}}).show()}},onAddFilter:function(t,e){this.api&&!this._locked&&this._state.field&&(this._originalProps.asc_addPageField(this.api,i.isNumber(t)?t:this._state.field.record.get("index"),i.isNumber(e)?e:void 0),Common.NotificationCenter.trigger("edit:complete",this))},onAddRow:function(t,e){this.api&&!this._locked&&this._state.field&&(this._originalProps.asc_addRowField(this.api,i.isNumber(t)?t:this._state.field.record.get("index"),i.isNumber(e)?e:void 0),Common.NotificationCenter.trigger("edit:complete",this))},onAddColumn:function(t,e){this.api&&!this._locked&&this._state.field&&(this._originalProps.asc_addColField(this.api,i.isNumber(t)?t:this._state.field.record.get("index"),i.isNumber(e)?e:void 0),Common.NotificationCenter.trigger("edit:complete",this))},onAddValues:function(t,e){this.api&&!this._locked&&this._state.field&&(this._originalProps.asc_addDataField(this.api,i.isNumber(t)?t:this._state.field.record.get("index"),i.isNumber(e)?e:void 0),Common.NotificationCenter.trigger("edit:complete",this))},onRemove:function(t,e){this.api&&!this._locked&&this._state.field&&(2==this._state.field.type||i.isNumber(e)?this._originalProps.asc_removeDataField(this.api,i.isNumber(t)?t:this._state.field.record.get("pivotIndex"),i.isNumber(e)?e:this._state.field.record.get("index")):this._originalProps.asc_removeNoDataField(this.api,i.isNumber(t)?t:this._state.field.record.get("pivotIndex")),Common.NotificationCenter.trigger("edit:complete",this))},onMoveUp:function(){if(this.api&&!this._locked&&this._state.field){var t=this._state.field.record.get("index");this.onMove(this._state.field.type,t,t-1)}},onMoveDown:function(){if(this.api&&!this._locked&&this._state.field){var t=this._state.field.record.get("index");this.onMove(this._state.field.type,t,t+1)}},onMoveBegin:function(){if(this.api&&!this._locked&&this._state.field){var t=this._state.field.record.get("index");this.onMove(this._state.field.type,t,0)}},onMoveEnd:function(){if(this.api&&!this._locked&&this._state.field){var t=this._state.field.record.get("index");this.onMove(this._state.field.type,t,this._state.field.length-1)}},onMove:function(t,e,i){switch(t){case 0:this._originalProps.asc_moveColField(this.api,e,i);break;case 1:this._originalProps.asc_moveRowField(this.api,e,i);break;case 2:this._originalProps.asc_moveDataField(this.api,e,i);break;case 3:this._originalProps.asc_movePageField(this.api,e,i)}Common.NotificationCenter.trigger("edit:complete",this)},onMoveTo:function(t,e,o){if(this.api&&!this._locked&&this._state.field){var n=i.isNumber(e)?e:this._state.field.record.get("pivotIndex"),s=i.isNumber(o)?o:void 0,a=2==this._state.field.type?this._state.field.record.get("index"):void 0;switch(t){case 0:this._originalProps.asc_moveToColField(this.api,n,a,s);break;case 1:this._originalProps.asc_moveToRowField(this.api,n,a,s);break;case 2:this._originalProps.asc_moveToDataField(this.api,n,a,s);break;case 3:this._originalProps.asc_moveToPageField(this.api,n,a,s)}Common.NotificationCenter.trigger("edit:complete",this)}},disableControls:function(t){this._initSettings||this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.linkAdvanced.toggleClass("disabled",t))},onItemChanged:function(t,i){var o=i.model.get("check");"indeterminate"==o?e("input[type=checkbox]",i.$el).prop("indeterminate",!0):e("input[type=checkbox]",i.$el).prop({checked:o,indeterminate:!1})},textFields:"Select Fields",textValues:"Values",textRows:"Rows",textColumns:"Columns",textFilters:"Filters",textAdvanced:"Show advanced settings",txtMoveUp:"Move Up",txtMoveDown:"Move Down",txtMoveBegin:"Move to Beginning",txtMoveEnd:"Move to End",txtMoveFilter:"Move to Filters",txtMoveRow:"Move to Rows",txtMoveColumn:"Move to Columns",txtMoveValues:"Move to Values",txtRemove:"Remove Field",txtFieldSettings:"Field Settings",txtAddFilter:"Add to Filters",txtAddRow:"Add to Rows",txtAddColumn:"Add to Columns",txtAddValues:"Add to Values"},SSE.Views.PivotSettings||{}))})),define("text!spreadsheeteditor/main/app/template/SignatureSettings.template",[],(function(){return'<table cols="2" role="presentation">\n    <tr>\n        <td class="padding-large">\n            <label style="font-size: 18px;"><%= scope.strSignature %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-large">\n            <div id="signature-invisible-sign" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr class="requested">\n        <td class="padding-small">\n            <label class="header"><%= scope.strRequested %></label>\n        </td>\n    </tr>\n    <tr class="requested">\n        <td class="padding-large">\n            <div id="signature-requested-sign"></div>\n        </td>\n    </tr>\n    <tr class="valid">\n        <td class="padding-small">\n            <label class="header"><%= scope.strValid %></label>\n        </td>\n    </tr>\n    <tr class="valid">\n        <td class="padding-large">\n            <div id="signature-valid-sign"></div>\n        </td>\n    </tr>\n    <tr class="invalid">\n        <td class="padding-small">\n            <label class="header" style="color:#bb3d3d;"><%= scope.strInvalid %></label>\n        </td>\n    </tr>\n    <tr class="invalid">\n        <td><div id="signature-invalid-sign"></div></td>\n    </tr>\n    <tr class="finish-cell"></tr>\n</table>'})),define("spreadsheeteditor/main/app/view/SignatureSettings",["text!spreadsheeteditor/main/app/template/SignatureSettings.template","jquery","underscore","backbone","common/main/lib/component/Button"],(function(t,e,i,o){"use strict";SSE.Views.SignatureSettings=o.View.extend(i.extend({el:"#id-signature-settings",template:i.template(t),events:{},options:{alias:"SignatureSettings"},initialize:function(){this._state={DisabledEditing:!1,ready:!1,hasValid:!1,hasInvalid:!1,hasRequested:!1,tip:void 0},this._locked=!1,this.render()},render:function(){this.$el.html(this.template({scope:this}));var t=SSE.getController("Common.Controllers.Protection").getView();this.btnAddInvisibleSign=t.getButton("signature"),this.btnAddInvisibleSign.render(this.$el.find("#signature-invisible-sign")),this.viewRequestedList=new Common.UI.DataView({el:e("#signature-requested-sign"),enableKeyEvents:!1,itemTemplate:i.template(['<div id="<%= id %>" class="signature-item requested">','<div class="caret-button nomargin"><div class="caret"></div></div>','<div class="name"><%= Common.Utils.String.htmlEncode(name) %></div>',"</div>"].join(""))}),this.viewValidList=new Common.UI.DataView({el:e("#signature-valid-sign"),enableKeyEvents:!1,itemTemplate:i.template(['<div id="<%= id %>" class="signature-item">','<div class="caret-button <% if (name == "" || date == "") { %>nomargin<% } %>"><div class="caret"></div></div>','<div class="name"><%= Common.Utils.String.htmlEncode(name) %></div>','<div class="date"><%= Common.Utils.String.htmlEncode(date) %></div>',"</div>"].join(""))}),this.viewInvalidList=new Common.UI.DataView({el:e("#signature-invalid-sign"),enableKeyEvents:!1,itemTemplate:i.template(['<div id="<%= id %>" class="signature-item">','<div class="caret-button <% if (name == "" || date == "") { %>nomargin<% } %>"><div class="caret"></div></div>','<div class="name"><%= Common.Utils.String.htmlEncode(name) %></div>','<div class="date"><%= Common.Utils.String.htmlEncode(date) %></div>',"</div>"].join(""))}),this.viewRequestedList.on("item:click",i.bind(this.onSelectSignature,this)),this.viewValidList.on("item:click",i.bind(this.onSelectSignature,this)),this.viewInvalidList.on("item:click",i.bind(this.onSelectSignature,this)),this.viewRequestedList.on("item:contextmenu",i.bind(this.onItemContextMenu,this)),this.viewValidList.on("item:contextmenu",i.bind(this.onItemContextMenu,this)),this.viewInvalidList.on("item:contextmenu",i.bind(this.onItemContextMenu,this)),this.signatureMenu=new Common.UI.Menu({menuAlign:"tr-br",items:[{caption:this.strSign,value:0},{caption:this.strDetails,value:1},{caption:this.strSetup,value:2},{caption:this.strDelete,value:3}]}),this.signatureMenu.on("item:click",i.bind(this.onMenuSignatureClick,this))},setApi:function(t){return this.api=t,this.api&&this.api.asc_registerCallback("asc_onUpdateSignatures",i.bind(this.onApiUpdateSignatures,this)),Common.NotificationCenter.on("document:ready",i.bind(this.onDocumentReady,this)),this},ChangeSettings:function(t){this._state.hasRequested||this._state.hasValid||this._state.hasInvalid||this.updateSignatures(this.api.asc_getSignatures(),this.api.asc_getRequestSignatures())},setLocked:function(t){this._locked=t},setMode:function(t){this.mode=t},onApiUpdateSignatures:function(t,e){this._state.ready&&(this.updateSignatures(t,e),this.showSignatureTooltip(this._state.hasValid,this._state.hasInvalid))},updateSignatures:function(t,e){var o=this,n=[],s=[],a=[],r=1;i.each(e,(function(t,e){var i=t.asc_getSigner1();n.push({name:""!==i?i:o.strSigner+" "+r++,guid:t.asc_getGuid(),requested:!0})})),i.each(t,(function(t,e){var o=t.asc_getDate(),n={name:t.asc_getSigner1(),certificateId:t.asc_getId(),guid:t.asc_getGuid(),date:i.isEmpty(o)?"":new Date(o).toLocaleString(),invisible:!t.asc_getVisible()};0==t.asc_getValid()?s.push(n):a.push(n)})),o._state.hasValid=s.length>0,o._state.hasInvalid=a.length>0,o._state.hasRequested=n.length>0,this.viewRequestedList.store.reset(n),this.viewValidList.store.reset(s),this.viewInvalidList.store.reset(a),this.$el.find(".requested").toggleClass("hidden",!o._state.hasRequested),this.$el.find(".valid").toggleClass("hidden",!o._state.hasValid),this.$el.find(".invalid").toggleClass("hidden",!o._state.hasInvalid),o.disableEditing(o._state.hasValid||o._state.hasInvalid)},onItemContextMenu:function(t,o,n,s){var a=this.signatureMenu;a.isVisible()&&a.hide();var r=Common.Utils.getOffset(e(this.el)),l=[s.clientX*Common.Utils.zoom()-r.left+5,s.clientY*Common.Utils.zoom()-r.top+5];this.showSignatureMenu(n,l),a.menuAlign=Common.UI.isRTL()?"tr-br":"tl-bl",a.menuAlignEl=null,a.setOffset(15,5),a.show(),i.delay((function(){a.cmpEl.focus()}),10)},onSelectSignature:function(t,o,n,s){if(n)if(e(s.target).closest(".caret-button").length){var a=this.signatureMenu;if(a.isVisible())return void a.hide();var r=e(s.currentTarget),l=Common.Utils.getOffset(r),c=Common.Utils.getOffset(e(this.el)),h=[l.left-c.left+r.width(),l.top-c.top+r.height()/2];this.showSignatureMenu(n,h),a.menuAlign=Common.UI.isRTL()?"tl-bl":"tr-br",a.menuAlignEl=r,a.setOffset(-20,-r.height()/2+3),a.show(),i.delay((function(){a.cmpEl.focus()}),10),s.stopPropagation(),s.preventDefault()}else this.api.asc_gotoSignature(n.get("guid"))},showSignatureMenu:function(t,i){this.api.asc_gotoSignature(t.get("guid"));var o=this.signatureMenu,n=e(this.el),s=n.find("#menu-signature-container");o.rendered||(s.length<1&&(s=e('<div id="menu-signature-container" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',o.id),n.append(s)),o.render(s),o.cmpEl.attr({tabindex:"-1"}),o.on({"show:after":function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!0)},"hide:after":function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!1)}}));var a=t.get("requested"),r=this._state.hasValid||this._state.hasInvalid;o.items[0].setVisible(a),o.items[1].setVisible(!a),o.items[2].setVisible(a||!t.get("invisible")),o.items[3].setVisible(!a),o.items[0].setDisabled(this._locked),o.items[3].setDisabled(this._locked),o.items[1].cmpEl.attr("data-value",t.get("certificateId")),o.items[2].cmpEl.attr("data-value",r?1:0),o.cmpEl.attr("data-value",t.get("guid")),s.css({left:i[0],top:i[1]})},onMenuSignatureClick:function(t,e){var i=t.cmpEl.attr("data-value");switch(e.value){case 0:Common.NotificationCenter.trigger("protect:sign",i);break;case 1:this.api.asc_ViewCertificate(e.cmpEl.attr("data-value"));break;case 2:Common.NotificationCenter.trigger("protect:signature","visible",!!parseInt(e.cmpEl.attr("data-value")),i);break;case 3:var o=this;Common.UI.warning({title:this.notcriticalErrorTitle,msg:this.txtRemoveWarning,buttons:["ok","cancel"],primary:"ok",callback:function(t){"ok"==t&&o.api.asc_RemoveSignature(i)}})}},onDocumentReady:function(){this._state.ready=!0,this.updateSignatures(this.api.asc_getSignatures(),this.api.asc_getRequestSignatures()),this.showSignatureTooltip(this._state.hasValid,this._state.hasInvalid,this._state.hasRequested)},showSignatureTooltip:function(t,e,i){var o=this,n=o._state.tip;if(t||e||i){var s=t||e,a=e?o.txtSignedInvalid:t?o.txtSigned:"";i&&(a=o.txtRequestedSignatures+"<br><br>"+a),n&&n.isVisible()&&(a!==n.text||s!==n.showLink)&&(n.close(),o._state.tip=void 0),o._state.tip||((n=new Common.UI.SynchronizeTip({target:SSE.getController("RightMenu").getView("RightMenu").btnSignature.btnEl,text:a,showLink:s,textLink:this.txtContinueEditing,placement:Common.UI.isRTL()?"right-bottom":"left-bottom"})).on({dontshowclick:function(){Common.UI.warning({title:o.notcriticalErrorTitle,msg:o.txtEditWarning,buttons:["ok","cancel"],primary:"ok",callback:function(t){"ok"==t&&(n.close(),o._state.tip=void 0,o.api.asc_RemoveAllSignatures())}})},closeclick:function(){n.close(),o._state.tip=void 0}}),o._state.tip=n,n.show())}else n&&n.isVisible()&&(n.close(),o._state.tip=void 0)},hideSignatureTooltip:function(){var t=this._state.tip;t&&t.isVisible()&&(t.close(),this._state.tip=void 0)},disableEditing:function(t){this._state.DisabledEditing!=t&&(this._state.DisabledEditing=t,Common.NotificationCenter.trigger("editing:disable",t,{viewMode:t,allowSignature:!0,allowProtect:!0,rightMenu:{clear:!1,disable:!0},statusBar:!0,leftMenu:{disable:!1,previewMode:!0},fileMenu:!1,comments:{disable:!1,previewMode:!0},chat:!1,review:!0,viewport:!0,documentHolder:{clear:!0,disable:!0},toolbar:!0,celleditor:{previewMode:!0},header:{search:!1},shortcuts:!1},"signature"))},strSignature:"Signature",strRequested:"Requested signatures",strValid:"Valid signatures",strInvalid:"Invalid signatures",strSign:"Sign",strDetails:"Signature Details",strSetup:"Signature Setup",txtSigned:"Valid signatures has been added to the workbook. The workbook is protected from editing.",txtSignedInvalid:"Some of the digital signatures in workbook are invalid or could not be verified. The workbook is protected from editing.",txtRequestedSignatures:"This workbook needs to be signed.",txtContinueEditing:"Edit anyway",notcriticalErrorTitle:"Warning",txtEditWarning:"Editing will remove the signatures from the workbook.<br>Are you sure you want to continue?",strDelete:"Remove Signature",strSigner:"Signer",txtRemoveWarning:"Are you sure you want to remove this signature?<br>This action cannot be undone."},SSE.Views.SignatureSettings||{}))})),define("text!spreadsheeteditor/main/app/template/CellSettings.template",[],(function(){return'<table cols="2" role="presentation">\n    <tr>\n        <td>\n            <label class="header"><%= scope.textFill %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small">\n            <div id="cell-combo-fill-src" style="width: 100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <div id="cell-panel-color-fill" class="settings-hidden padding-small" style="width: 100%;">\n                <div id="cell-back-color-btn" style=""></div>\n            </div>\n            <div id="cell-panel-pattern-fill" class="settings-hidden padding-small" style="width: 100%;">\n                <label class="input-label" style="margin-top: 3px;"><%= scope.textPattern %></label>\n                <div id="cell-combo-pattern" style="width: 100%; height: 42px; margin-bottom: 8px;"></div>\n                <div style="width: 100%; height: 25px; margin-bottom: 8px;">\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.textForeground %></label>\n                    <div id="cell-foreground-color-btn" class="float-right"></div>\n                </div>\n                <div style="width: 100%; height: 25px;">\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.textBackground %></label>\n                    <div id="cell-background-color-btn" class="float-right"></div>\n                </div>\n            </div>\n            <div id="cell-panel-gradient-fill" class="settings-hidden padding-small" style="width: 100%;">\n                <div style="height:80px;">\n                    <div style="display: inline-block;">\n                        <label class="input-label" ><%= scope.textAngle %></label>\n                        <div id="cell-spin-gradient-angle" style="width: 90px;"></div>\n                    </div>\n                    <div class="cell-direction float-right">\n                        <label class="input-label"><%= scope.textDirection %></label>\n                        <div id="cell-button-direction"></div>\n                    </div>\n                </div>\n                <label class="header" style="display:block;margin-bottom: 5px;"><%= scope.textGradient %></label>\n                <div style="display: inline-block; margin-top: 3px;">\n                    <div id="cell-slider-gradient" style="display: inline-block; vertical-align: middle;"></div>\n                </div>\n                <div style="height: 40px;margin-top:6px;display:flex;justify-content:space-between;">\n                    <div style="display: flex;">\n                    <div style="">\n                        <label class="input-label" style=""><%= scope.textGradientColor %></label>\n                        <div id="cell-gradient-color-btn"></div>\n                    </div>\n                    <div class="margin-left-10">\n                        <label class="input-label" style=""><%= scope.textPosition %></label>\n                        <div id="cell-gradient-position"></div>\n                    </div>\n                    </div>\n                    <div style="display:flex;padding-top:15px;">\n                        <div id="cell-gradient-add-step"></div>\n                        <div id="cell-gradient-remove-step"></div>\n                    </div>\n                </div>\n            </div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-small">\n            <label class="header"><%= scope.textBorders %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="cell-combo-border-type"></div>\n            <div class="border-color color-btn-wrap float-right">\n                <label class="input-label margin-right-5"><%= scope.textBorderColor %></label>\n                <div id="cell-border-color-btn"></div>\n            </div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <label class="input-label"><%= scope.textSelectBorders %></label>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-small">\n            <div id="cell-button-border-all" style="display: inline-block;"></div>\n            <div id="cell-button-border-none" style="display: inline-block;"></div>\n            <div id="cell-button-border-inner" style="display: inline-block;"></div>\n            <div id="cell-button-border-outer" style="display: inline-block;"></div>\n            <div id="cell-button-border-diagu" style="display: inline-block;"></div>\n            <div id="cell-button-border-diagd" style="display: inline-block;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-small">\n            <div id="cell-button-border-left" style="display: inline-block;"></div>\n            <div id="cell-button-border-inner-vert" style="display: inline-block;"></div>\n            <div id="cell-button-border-right" style="display: inline-block;"></div>\n            <div id="cell-button-border-top" style="display: inline-block;"></div>\n            <div id="cell-button-border-inner-hor" style="display: inline-block;"></div>\n            <div id="cell-button-border-bottom" style="display: inline-block;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="">\n            <label class="header"><%= scope.textIndent %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-large" colspan=2>\n            <div id="cell-spin-indent" style="display: inline-block;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-small">\n            <label class="header"><%= scope.textOrientation %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-large" colspan=2>\n            <label class="input-label"><%= scope.textAngle %></label>\n            <div id="cell-spin-angle" class="margin-left-5"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2 class="padding-small">\n            <label class="header"><%= scope.textControl %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="cell-checkbox-wrap"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="cell-checkbox-shrink"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="cell-btn-cond-format" style="width:100%;"></div>\n        </td>\n    </tr>\n    <tr class="finish-cell"></tr>\n</table>'})),define("spreadsheeteditor/main/app/view/CellSettings",["text!spreadsheeteditor/main/app/template/CellSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/ThemeColorPalette","common/main/lib/component/ColorButton","common/main/lib/component/ComboBorderSize"],(function(t,e,i,o){"use strict";SSE.Views.CellSettings=o.View.extend(i.extend({el:"#id-cell-settings",template:i.template(t),events:{},options:{alias:"CellSettings"},initialize:function(){this._initSettings=!0,this._noApply=!0,this._sendUndoPoint=!0,this._state={DisabledControls:!0,DisabledFillPanels:!0,CellAngle:void 0,CellIndent:void 0,GradFillType:Asc.c_oAscFillGradType.GRAD_LINEAR,CellColor:"transparent",FillType:Asc.c_oAscFill.FILL_TYPE_NOFILL,FGColor:"000000",BGColor:"ffffff",GradColor:"000000"},this.lockedControls=[],this._locked=!0,this.isEditCell=!1,this.BorderType=1,this.GradFillType=Asc.c_oAscFillGradType.GRAD_LINEAR,this.GradLinearDirectionType=0,this.GradRadialDirectionIdx=0,this.GradColor={values:[0,100],colors:["000000","ffffff"],currentIdx:0},this.fillControls=[],this.gradientColorsStr="#000, #fff",this.typeGradient=90,this.render(),this.createDelayedControls(),this.FillColorContainer=e("#cell-panel-color-fill"),this.FillPatternContainer=e("#cell-panel-pattern-fill"),this.FillGradientContainer=e("#cell-panel-gradient-fill")},onColorsBackSelect:function(t,e){this.api&&this.api.asc_setCellBackgroundColor("transparent"==e?null:Common.Utils.ThemeColor.getRgbColor(e)),Common.NotificationCenter.trigger("edit:complete",this)},onBtnBordersClick:function(t,e){if(this.api){var i,o=[],n=this.BorderType;this.btnBorderColor.isAutoColor()?(i=new Asc.asc_CColor).put_auto(!0):i=Common.Utils.ThemeColor.getRgbColor(this.btnBorderColor.color),"inner"==t.options.borderId?(o[Asc.c_oAscBorderOptions.InnerV]=new Asc.asc_CBorder(n,i),o[Asc.c_oAscBorderOptions.InnerH]=new Asc.asc_CBorder(n,i)):"all"==t.options.borderId?(o[Asc.c_oAscBorderOptions.InnerV]=new Asc.asc_CBorder(n,i),o[Asc.c_oAscBorderOptions.InnerH]=new Asc.asc_CBorder(n,i),o[Asc.c_oAscBorderOptions.Left]=new Asc.asc_CBorder(n,i),o[Asc.c_oAscBorderOptions.Top]=new Asc.asc_CBorder(n,i),o[Asc.c_oAscBorderOptions.Right]=new Asc.asc_CBorder(n,i),o[Asc.c_oAscBorderOptions.Bottom]=new Asc.asc_CBorder(n,i)):"outer"==t.options.borderId?(o[Asc.c_oAscBorderOptions.Left]=new Asc.asc_CBorder(n,i),o[Asc.c_oAscBorderOptions.Top]=new Asc.asc_CBorder(n,i),o[Asc.c_oAscBorderOptions.Right]=new Asc.asc_CBorder(n,i),o[Asc.c_oAscBorderOptions.Bottom]=new Asc.asc_CBorder(n,i)):"none"!=t.options.borderId&&(o[t.options.borderId]=new Asc.asc_CBorder(n,i)),this.api.asc_setCellBorders(o)}Common.NotificationCenter.trigger("edit:complete",this)},onBorderTypeSelect:function(t,e){this.BorderType=e.value},onAngleChange:function(t,e,i,o){this.api&&e!==i&&this.api.asc_setCellAngle(t.getNumberValue())},onIndentChange:function(t,e,i,o){this.api&&e!==i&&this.api.asc_setCellIndent(t.getNumberValue())},render:function(){e(this.el).html(this.template({scope:this}))},setApi:function(t){return this.api=t,t&&this.api.asc_registerCallback("asc_onEditCell",this.onApiEditCell.bind(this)),this},createDelayedControls:function(){var t=this;this._arrFillSrc=[{displayValue:this.textColor,value:Asc.c_oAscFill.FILL_TYPE_SOLID},{displayValue:this.textGradientFill,value:Asc.c_oAscFill.FILL_TYPE_GRAD},{displayValue:this.textPatternFill,value:Asc.c_oAscFill.FILL_TYPE_PATT},{displayValue:this.textNoFill,value:Asc.c_oAscFill.FILL_TYPE_NOFILL}],this.cmbFillSrc=new Common.UI.ComboBox({el:e("#cell-combo-fill-src"),cls:"input-group-nr",style:"width: 100%;",menuStyle:"min-width: 100%;",editable:!1,data:this._arrFillSrc,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textFill}),this.cmbFillSrc.setValue(Asc.c_oAscFill.FILL_TYPE_NOFILL),this.fillControls.push(this.cmbFillSrc),this.cmbFillSrc.on("selected",i.bind(this.onFillSrcSelect,this)),this.numGradientAngle=new Common.UI.MetricSpinner({el:e("#cell-spin-gradient-angle"),step:10,width:90,defaultUnit:"°",value:"0 °",allowDecimal:!0,maxValue:359.9,minValue:0,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textAngle}),this.lockedControls.push(this.numGradientAngle),this.numGradientAngle.on("change",i.bind(this.onGradientAngleChange,this)),this.numGradientAngle.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this._viewDataLinear=[{offsetx:0,offsety:0,type:45,subtype:-1},{offsetx:50,offsety:0,type:90,subtype:4},{offsetx:100,offsety:0,type:135,subtype:5},{offsetx:0,offsety:50,type:0,subtype:6,cls:"item-gradient-separator",selected:!0},{offsetx:100,offsety:50,type:180,subtype:1},{offsetx:0,offsety:100,type:315,subtype:2},{offsetx:50,offsety:100,type:270,subtype:3},{offsetx:100,offsety:100,type:225,subtype:7}],i.each(this._viewDataLinear,(function(e){e.gradientColorsStr=t.gradientColorsStr})),this.btnDirection=new Common.UI.Button({cls:"btn-large-dataview",scaling:!1,iconCls:"item-gradient gradient-left",menu:new Common.UI.Menu({style:"min-width: 60px;",menuAlign:"tr-br",items:[{template:i.template('<div id="id-cell-menu-direction" style="width: 175px; margin: 0 5px;"></div>')}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textDirection}),this.btnDirection.on("render:after",(function(o){t.mnuDirectionPicker=new Common.UI.DataView({el:e("#id-cell-menu-direction"),parentMenu:o.menu,restoreHeight:174,store:new Common.UI.DataViewStore(t._viewDataLinear),itemTemplate:i.template('<div id="<%= id %>" class="item-gradient" style="background: linear-gradient(<%= type + 90 %>deg,<%= gradientColorsStr %>);"></div>')})})),this.btnDirection.render(e("#cell-button-direction")),this.fillControls.push(this.btnDirection),this.mnuDirectionPicker.on("item:click",i.bind(this.onSelectGradient,this,this.btnDirection)),this.sldrGradient=new Common.UI.MultiSliderGradient({el:e("#cell-slider-gradient"),width:192,minValue:0,maxValue:100,values:[0,100]}),this.sldrGradient.on("change",i.bind(this.onGradientChange,this)),this.sldrGradient.on("changecomplete",i.bind(this.onGradientChangeComplete,this)),this.sldrGradient.on("thumbclick",(function(e,i){t.GradColor.currentIdx=i;var o=t.GradColor.colors[t.GradColor.currentIdx];t.btnGradColor.setColor(o),t.colorsGrad.select(o,!1);var n=t.GradColor.values[t.GradColor.currentIdx];t.spnGradPosition.setValue(Common.UI.isRTL()?t.sldrGradient.maxValue-n:n)})),this.sldrGradient.on("thumbdblclick",(function(e){t.btnGradColor.cmpEl.find("button").dropdown("toggle")})),this.sldrGradient.on("sortthumbs",(function(e,o){var n,s=[];i.each(o,(function(e,i){s.push(t.GradColor.colors[e]),t.GradColor.currentIdx==e&&(n=i)})),t.OriginalFillType=null,t.GradColor.colors=s,t.GradColor.currentIdx=n})),this.sldrGradient.on("addthumb",(function(e,i,o){t.GradColor.colors[i]=t.GradColor.colors[t.GradColor.currentIdx],t.GradColor.currentIdx=i;var n=t.sldrGradient.addNewThumb(i,o);t.GradColor.colors[t.GradColor.currentIdx]=n})),this.sldrGradient.on("removethumb",(function(e,o){if(t.sldrGradient.removeThumb(o),t.GradColor.values.splice(o,1),t.sldrGradient.changeGradientStyle(),i.isUndefined(t.GradColor.currentIdx)||t.GradColor.currentIdx>=t.GradColor.colors.length){var n=o>0?o-1:o;n=0===n&&t.GradColor.values.length>2?t.GradColor.values.length-2:n,t.GradColor.currentIdx=n}t.sldrGradient.setActiveThumb(t.GradColor.currentIdx)})),this.fillControls.push(this.sldrGradient);this.cmbPattern=new Common.UI.ComboDataView({itemWidth:28,itemHeight:28,menuMaxHeight:300,enableKeyEvents:!0,cls:"combo-pattern",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",fillOnChangeVisibility:!0,itemTemplate:i.template(['<div class="style" id="<%= id %>">','<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" class="combo-pattern-item" ','width="28" height="28" ','style="background-position: -<%= offsetx %>px -<%= offsety %>px;"/>',"</div>"].join(""))}),this.cmbPattern.render(e("#cell-combo-pattern")),this.cmbPattern.on("click",i.bind(this.onPatternSelect,this)),this.cmbPattern.openButton.menu.on("show:after",(function(){t.cmbPattern.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.fillControls.push(this.cmbPattern);var o=[-1,-1,-1,-1,-1,-1,-1,-1,-1,8,9,10,11,-1,-1,-1,21,-1,-1,-1,-1,20,22,23,-1,-1,27,28,29,30,-1,-1,33,-1,35,-1,-1,-1,-1,-1,41,-1,43,-1,-1,46,-1,-1,-1,-1];this.patternViewData=[];for(var n=0,s=0;s<13;s++)for(var a=0;a<4;a++){var r=4*s+a;o[r]>-1&&(this.patternViewData[n++]={offsetx:28*a,offsety:28*s,type:o[r]})}for(s=0;s<this.patternViewData.length;s++)this.patternViewData[s].id=Common.UI.getId();this.cmbPattern.menuPicker.store.add(this.patternViewData),this.cmbPattern.menuPicker.store.length>0&&(this.cmbPattern.fillComboView(this.cmbPattern.menuPicker.store.at(0),!0),this.PatternFillType=this.patternViewData[0].type);var l=[[Asc.c_oAscBorderOptions.Left,"toolbar__icon btn-border-left","cell-button-border-left",this.tipLeft,"bottom"],[Asc.c_oAscBorderOptions.InnerV,"toolbar__icon btn-border-insidevert","cell-button-border-inner-vert",this.tipInnerVert,"bottom"],[Asc.c_oAscBorderOptions.Right,"toolbar__icon btn-border-right","cell-button-border-right",this.tipRight,"bottom"],[Asc.c_oAscBorderOptions.Top,"toolbar__icon btn-border-top","cell-button-border-top",this.tipTop,"bottom"],[Asc.c_oAscBorderOptions.InnerH,"toolbar__icon btn-border-insidehor","cell-button-border-inner-hor",this.tipInnerHor,"bottom"],[Asc.c_oAscBorderOptions.Bottom,"toolbar__icon btn-border-bottom","cell-button-border-bottom",this.tipBottom,"bottom"],[Asc.c_oAscBorderOptions.DiagU,"toolbar__icon btn-border-diagup","cell-button-border-diagu",this.tipDiagU,"top"],[Asc.c_oAscBorderOptions.DiagD,"toolbar__icon btn-border-diagdown","cell-button-border-diagd",this.tipDiagD,"top"],["inner","toolbar__icon btn-border-inside","cell-button-border-inner",this.tipInner,"top"],["outer","toolbar__icon btn-border-out","cell-button-border-outer",this.tipOuter,"top"],["all","toolbar__icon btn-border-all","cell-button-border-all",this.tipAll,"top"],["none","toolbar__icon btn-border-no","cell-button-border-none",this.tipNone,"top"]];i.each(l,(function(t,o,n){var s=new Common.UI.Button({parentEl:e("#"+t[2]),cls:"btn-toolbar borders--small",iconCls:t[1],borderId:t[0],hint:t[3],disabled:this._locked,dataHint:"1",dataHintDirection:t[4],dataHintOffset:"small"});s.on("click",i.bind(this.onBtnBordersClick,this)),this.lockedControls.push(s)}),this),this.cmbBorderType=new Common.UI.ComboBorderType({el:e("#cell-combo-border-type"),cls:"cell-border-type",style:"width: 93px;",menuStyle:"min-width: 93px;",disabled:this._locked,data:[{value:Asc.c_oAscBorderStyles.Thin,imgId:"solid-s"},{value:Asc.c_oAscBorderStyles.Hair,imgId:"dots-s"},{value:Asc.c_oAscBorderStyles.Dotted,imgId:"dashes-s"},{value:Asc.c_oAscBorderStyles.Dashed,imgId:"dashes-m"},{value:Asc.c_oAscBorderStyles.DashDot,imgId:"dash-dot-s"},{value:Asc.c_oAscBorderStyles.DashDotDot,imgId:"dash-dot-dot-s"},{value:Asc.c_oAscBorderStyles.Medium,imgId:"solid-m"},{value:Asc.c_oAscBorderStyles.MediumDashed,imgId:"dashes-l"},{value:Asc.c_oAscBorderStyles.MediumDashDot,imgId:"dash-dot-m"},{value:Asc.c_oAscBorderStyles.MediumDashDotDot,imgId:"dash-dot-dot-m"},{value:Asc.c_oAscBorderStyles.Thick,imgId:"solid-l"}],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textBorders}).on("selected",i.bind(this.onBorderTypeSelect,this)),this.BorderType=Asc.c_oAscBorderStyles.Thin,this.cmbBorderType.setValue(this.BorderType),this.lockedControls.push(this.cmbBorderType),this.btnBorderColor=new Common.UI.ColorButton({parentEl:e("#cell-border-color-btn"),disabled:this._locked,menu:!0,color:"auto",auto:!0,eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"medium",ariaLabel:this.textBorderColor}),this.lockedControls.push(this.btnBorderColor),this.btnBackColor=new Common.UI.ColorButton({parentEl:e("#cell-back-color-btn"),disabled:this._locked,menu:!0,transparent:!0,color:"transparent",eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"medium",ariaLabel:this.textBackColor}),this.lockedControls.push(this.btnBackColor),this.spnIndent=new Common.UI.MetricSpinner({el:e("#cell-spin-indent"),step:1,width:60,defaultUnit:"",value:"0",allowDecimal:!1,maxValue:250,minValue:0,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textIndent}),this.lockedControls.push(this.spnIndent),this.spnIndent.on("change",i.bind(this.onIndentChange,this)),this.spnIndent.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnAngle=new Common.UI.MetricSpinner({el:e("#cell-spin-angle"),step:1,width:60,defaultUnit:"°",value:"0 °",allowDecimal:!1,maxValue:90,minValue:-90,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textOrientation+" "+this.textAngle}),this.lockedControls.push(this.spnAngle),this.spnAngle.on("change",i.bind(this.onAngleChange,this)),this.spnAngle.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnGradPosition=new Common.UI.MetricSpinner({el:e("#cell-gradient-position"),step:1,width:60,defaultUnit:"%",value:"50 %",allowDecimal:!1,maxValue:100,minValue:0,disabled:this._locked,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textPosition}),this.lockedControls.push(this.spnGradPosition),this.spnGradPosition.on("change",i.bind(this.onPositionChange,this)),this.spnGradPosition.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.btnAddGradientStep=new Common.UI.Button({parentEl:e("#cell-gradient-add-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-add-breakpoint",disabled:this._locked,hint:this.tipAddGradientPoint,dataHint:"1",dataHintDirection:"bottom"}),this.btnAddGradientStep.on("click",i.bind(this.onAddGradientStep,this)),this.lockedControls.push(this.btnAddGradientStep),this.btnRemoveGradientStep=new Common.UI.Button({parentEl:e("#cell-gradient-remove-step"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-remove-breakpoint",disabled:this._locked,hint:this.tipRemoveGradientPoint,dataHint:"1",dataHintDirection:"bottom"}),this.btnRemoveGradientStep.on("click",i.bind(this.onRemoveGradientStep,this)),this.lockedControls.push(this.btnRemoveGradientStep),this.chWrap=new Common.UI.CheckBox({el:e("#cell-checkbox-wrap"),labelText:this.strWrap,disabled:this._locked,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chWrap),this.chWrap.on("change",this.onWrapChange.bind(this)),this.chShrink=new Common.UI.CheckBox({el:e("#cell-checkbox-shrink"),labelText:this.strShrink,disabled:this._locked,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chShrink),this.chShrink.on("change",this.onShrinkChange.bind(this)),this.btnCondFormat=new Common.UI.Button({parentEl:e("#cell-btn-cond-format"),cls:"btn-toolbar align-left",iconCls:"toolbar__icon btn-cond-format",caption:this.textCondFormat,style:"width: 100%;",menu:!0,disabled:this._locked,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.btnCondFormat)},createDelayedElements:function(){this.UpdateThemeColors(),this.btnCondFormat.setMenu(new Common.UI.Menu({items:[{caption:Common.define.conditionalData.textValue,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textGreater,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.greaterThan},{caption:Common.define.conditionalData.textGreaterEq,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.greaterThanOrEqual},{caption:Common.define.conditionalData.textLess,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.lessThan},{caption:Common.define.conditionalData.textLessEq,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.lessThanOrEqual},{caption:Common.define.conditionalData.textEqual,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.equal},{caption:Common.define.conditionalData.textNotEqual,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.notEqual},{caption:Common.define.conditionalData.textBetween,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.between},{caption:Common.define.conditionalData.textNotBetween,type:Asc.c_oAscCFType.cellIs,value:Asc.c_oAscCFOperator.notBetween}]})},{caption:Common.define.conditionalData.textTop+"/"+Common.define.conditionalData.textBottom,type:Asc.c_oAscCFType.top10,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textTop+" 10 "+this.textItems,type:Asc.c_oAscCFType.top10,value:0,percent:!1},{caption:Common.define.conditionalData.textTop+" 10%",type:Asc.c_oAscCFType.top10,value:0,percent:!0},{caption:Common.define.conditionalData.textBottom+" 10 "+this.textItems,type:Asc.c_oAscCFType.top10,value:1,percent:!1},{caption:Common.define.conditionalData.textBottom+" 10%",type:Asc.c_oAscCFType.top10,value:1,percent:!0}]})},{caption:Common.define.conditionalData.textAverage,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textAbove,type:Asc.c_oAscCFType.aboveAverage,value:0},{caption:Common.define.conditionalData.textBelow,type:Asc.c_oAscCFType.aboveAverage,value:1},{caption:Common.define.conditionalData.textEqAbove,type:Asc.c_oAscCFType.aboveAverage,value:2},{caption:Common.define.conditionalData.textEqBelow,type:Asc.c_oAscCFType.aboveAverage,value:3},{caption:Common.define.conditionalData.text1Above,type:Asc.c_oAscCFType.aboveAverage,value:4},{caption:Common.define.conditionalData.text1Below,type:Asc.c_oAscCFType.aboveAverage,value:5},{caption:Common.define.conditionalData.text2Above,type:Asc.c_oAscCFType.aboveAverage,value:6},{caption:Common.define.conditionalData.text2Below,type:Asc.c_oAscCFType.aboveAverage,value:7},{caption:Common.define.conditionalData.text3Above,type:Asc.c_oAscCFType.aboveAverage,value:8},{caption:Common.define.conditionalData.text3Below,type:Asc.c_oAscCFType.aboveAverage,value:9}]})},{caption:Common.define.conditionalData.textText,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textContains,type:Asc.c_oAscCFType.containsText},{caption:Common.define.conditionalData.textNotContains,type:Asc.c_oAscCFType.notContainsText},{caption:Common.define.conditionalData.textBegins,type:Asc.c_oAscCFType.beginsWith},{caption:Common.define.conditionalData.textEnds,type:Asc.c_oAscCFType.endsWith}]})},{caption:Common.define.conditionalData.textDate,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textYesterday,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.yesterday},{caption:Common.define.conditionalData.textToday,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.today},{caption:Common.define.conditionalData.textTomorrow,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.tomorrow},{caption:Common.define.conditionalData.textLast7days,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.last7Days},{caption:Common.define.conditionalData.textLastWeek,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.lastWeek},{caption:Common.define.conditionalData.textThisWeek,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.thisWeek},{caption:Common.define.conditionalData.textNextWeek,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.nextWeek},{caption:Common.define.conditionalData.textLastMonth,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.lastMonth},{caption:Common.define.conditionalData.textThisMonth,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.thisMonth},{caption:Common.define.conditionalData.textNextMonth,type:Asc.c_oAscCFType.timePeriod,value:Asc.c_oAscTimePeriod.nextMonth}]})},{caption:Common.define.conditionalData.textBlank+"/"+Common.define.conditionalData.textError,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textBlanks,type:Asc.c_oAscCFType.containsBlanks},{caption:Common.define.conditionalData.textNotBlanks,type:Asc.c_oAscCFType.notContainsBlanks},{caption:Common.define.conditionalData.textErrors,type:Asc.c_oAscCFType.containsErrors},{caption:Common.define.conditionalData.textNotErrors,type:Asc.c_oAscCFType.notContainsErrors}]})},{caption:Common.define.conditionalData.textDuplicate+"/"+Common.define.conditionalData.textUnique,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:Common.define.conditionalData.textDuplicate,type:Asc.c_oAscCFType.duplicateValues},{caption:Common.define.conditionalData.textUnique,type:Asc.c_oAscCFType.uniqueValues}]})},{caption:"--"},this.mnuDataBars=new Common.UI.MenuItem({caption:this.textDataBars,type:Asc.c_oAscCFType.dataBar,menu:new Common.UI.Menu({menuAlign:"tl-tr",style:"min-width: auto;",items:[]})}),this.mnuColorScales=new Common.UI.MenuItem({caption:this.textColorScales,type:Asc.c_oAscCFType.colorScale,menu:new Common.UI.Menu({menuAlign:"tl-tr",style:"min-width: auto;",items:[]})}),this.mnuIconSets=new Common.UI.MenuItem({caption:Common.define.conditionalData.textIconSets,type:Asc.c_oAscCFType.iconSet,menu:new Common.UI.Menu({menuAlign:"tl-tr",style:"min-width: auto;",items:[]})}),{caption:"--"},{caption:Common.define.conditionalData.textFormula,type:Asc.c_oAscCFType.expression},{caption:"--"},{caption:this.textNewRule,value:"new"},{caption:this.textClearRule,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{value:"clear",type:Asc.c_oAscSelectionForCFType.selection,caption:this.textSelection},{value:"clear",type:Asc.c_oAscSelectionForCFType.worksheet,caption:this.textThisSheet},{value:"clear",type:Asc.c_oAscSelectionForCFType.table,caption:this.textThisTable},{value:"clear",type:Asc.c_oAscSelectionForCFType.pivot,caption:this.textThisPivot}]})},{caption:this.textManageRule,value:"manage"}]})),this.btnCondFormat.menu.on("show:before",i.bind((function(){this.fireEvent("cf:init",[this,"cell"])}),this)),this._initSettings=!1},ChangeSettings:function(t){var e=this;if(this._initSettings&&this.createDelayedElements(),this.disableControls(this._locked),t){this._noApply=!0;var o=t.asc_getXfs(),n=o.asc_getAngle();if((Math.abs(this._state.CellAngle-n)>.1||void 0===this._state.CellAngle&&this._state.CellAngle!==n)&&(this.spnAngle.setValue(null!==n?255==n?0:n:"",!0),this._state.CellAngle=n),n=o.asc_getIndent(),(Math.abs(this._state.CellIndent-n)>.1||void 0===this._state.CellIndent&&this._state.CellIndent!==n)&&(this.spnIndent.setValue(null!==n?n:"",!0),this._state.CellIndent=n),n=o.asc_getWrapText(),this._state.Wrap!==n&&(this.chWrap.setValue(null!=n?n:"indeterminate",!0),this._state.Wrap=n),this.chWrap.setDisabled(o.asc_getHorAlign()==AscCommon.align_Justify||this._locked),n=o.asc_getShrinkToFit(),this._state.Shrink!==n&&(this.chShrink.setValue(null!=n?n:"indeterminate",!0),this._state.Shrink=n),this.chShrink.setDisabled("checked"==this.chWrap.getValue()||this._locked),this.fill=o.asc_getFill(),this.fill){if(this.pattern=this.fill.asc_getPatternFill(),this.gradient=this.fill.asc_getGradientFill(),null===this.pattern&&null===this.gradient)this.CellColor={Value:0,Color:"transparent"},this.FGColor={Value:1,Color:{color:"4f81bd",effectId:24}},this.BGColor={Value:1,Color:"ffffff"},this.sldrGradient.setThumbs(2),this.GradColor.colors.length=0,this.GradColor.values.length=0,this.GradColor.colors[0]={color:"4f81bd",effectId:24},this.GradColor.colors[1]="ffffff",this.GradColor.values=[0,100],this.GradColor.currentIdx=0,this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_NOFILL;else if(null!==this.pattern)if(-1===this.pattern.asc_getType()){(a=this.pattern.asc_getFgColor())?(a.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.CellColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(a.asc_getR(),a.asc_getG(),a.asc_getB()),effectValue:a.asc_getValue()}}:this.CellColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(a.asc_getR(),a.asc_getG(),a.asc_getB())},this.FGColor={Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.CellColor.Color)}):this.FGColor=this.CellColor={Value:1,Color:"ffffff"},this.BGColor={Value:1,Color:"ffffff"},this.sldrGradient.setThumbs(2),this.GradColor.colors.length=0,this.GradColor.values.length=0,this.GradColor.values=[0,100],this.GradColor.colors[0]=Common.Utils.ThemeColor.colorValue2EffectId(this.CellColor.Color),this.GradColor.colors[1]="ffffff",this.GradColor.currentIdx=0,this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_SOLID}else{if(this.PatternFillType=this.pattern.asc_getType(),this._state.PatternFillType!==this.PatternFillType){this.cmbPattern.suspendEvents();var s=this.cmbPattern.menuPicker.store.findWhere({type:this.PatternFillType});this.cmbPattern.menuPicker.selectRecord(s),this.cmbPattern.resumeEvents(),this._state.PatternFillType=this.PatternFillType}var a;(a=this.pattern.asc_getFgColor())?a.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.FGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(a.asc_getR(),a.asc_getG(),a.asc_getB()),effectValue:a.asc_getValue()}}:this.FGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(a.asc_getR(),a.asc_getG(),a.asc_getB())}:this.FGColor={Value:1,Color:{color:"000000",effectId:24}},(a=this.pattern.asc_getBgColor())?a.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?this.BGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(a.asc_getR(),a.asc_getG(),a.asc_getB()),effectValue:a.asc_getValue()}}:this.BGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(a.asc_getR(),a.asc_getG(),a.asc_getB())}:this.BGColor={Value:1,Color:"ffffff"},this.CellColor={Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.FGColor.Color)},this.sldrGradient.setThumbs(2),this.GradColor.colors.length=0,this.GradColor.values.length=0,this.GradColor.values=[0,100],this.GradColor.colors[0]=Common.Utils.ThemeColor.colorValue2EffectId(this.FGColor.Color),this.GradColor.colors[1]="ffffff",this.GradColor.currentIdx=0,this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_PATT}else if(null!==this.gradient){var r=this.gradient.asc_getType();if(this._state.GradFillType===r&&this.GradFillType===r||(this.GradFillType=r,this._state.GradFillType=this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){n=this.gradient.asc_getDegree();if(Math.abs(this.GradLinearDirectionType-n)>.001){this.GradLinearDirectionType=n;var l=this.mnuDirectionPicker.store.findWhere({type:n});this.mnuDirectionPicker.selectRecord(l,!0),this.typeGradient=l?n+90:-1,this.numGradientAngle.setValue(n,!0)}}e=this;var c,h=(c=this.gradient.asc_getGradientStops()).length;this.sldrGradient.setThumbs(h),this.GradColor.colors.length=0,this.GradColor.values.length=0,c.forEach((function(t){var i=t.asc_getColor(),o=t.asc_getPosition();e.GradColor.colors.push(i.asc_getType()==Asc.c_oAscColor.COLOR_TYPE_SCHEME?{color:Common.Utils.ThemeColor.getHexColor(i.asc_getR(),i.asc_getG(),i.asc_getB()),effectValue:i.asc_getValue()}:Common.Utils.ThemeColor.getHexColor(i.asc_getR(),i.asc_getG(),i.asc_getB())),e.GradColor.values.push(100*o)}));for(var d=[],m=0;m<h;m++)e.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==_typeof(e.GradColor.colors[m])?e.GradColor.colors[m].color:e.GradColor.colors[m]),m),e.sldrGradient.setValue(m,e.GradColor.values[m]),d.push(e.sldrGradient.getColorValue(m)+" "+e.sldrGradient.getValue(m)+"%");this.btnDirectionRedraw(e.sldrGradient,d.join(", ")),(i.isUndefined(e.GradColor.currentIdx)||e.GradColor.currentIdx>=e.GradColor.colors.length)&&(e.GradColor.currentIdx=0),e.sldrGradient.setActiveThumb(e.GradColor.currentIdx);var p=this.GradColor.values[this.GradColor.currentIdx];this.spnGradPosition.setValue(Common.UI.isRTL()?this.sldrGradient.maxValue-p:p),this.OriginalFillType=Asc.c_oAscFill.FILL_TYPE_GRAD,this.FGColor={Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.GradColor.colors[0])},this.BGColor={Value:1,Color:"ffffff"},this.CellColor={Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.GradColor.colors[0])}}this._state.FillType!==this.OriginalFillType&&(this.cmbFillSrc.setValue(null===this.OriginalFillType?"":this.OriginalFillType),this._state.FillType=this.OriginalFillType,this.ShowHideElem(this.OriginalFillType));var u=_typeof(this.CellColor.Color),g=_typeof(this._state.CellColor);(u!==g||"object"==u&&(this.CellColor.Color.effectValue!==this._state.CellColor.effectValue||this._state.CellColor.color.indexOf(this.CellColor.Color)<0)||"object"!=u&&void 0!==this._state.CellColor&&this._state.CellColor.indexOf(this.CellColor.Color)<0)&&(this.btnBackColor.setColor(this.CellColor.Color),Common.Utils.ThemeColor.selectPickerColorByEffect(this.CellColor.Color,this.colorsBack),this._state.CellColor=this.CellColor.Color),((u=_typeof(this.FGColor.Color))!==(g=_typeof(this._state.FGColor))||"object"==u&&(this.FGColor.Color.effectValue!==this._state.FGColor.effectValue||this._state.FGColor.color.indexOf(this.FGColor.Color.color)<0)||"object"!=u&&this._state.FGColor.indexOf(this.FGColor.Color)<0)&&(this.btnFGColor.setColor(this.FGColor.Color),Common.Utils.ThemeColor.selectPickerColorByEffect(this.FGColor.Color,this.colorsFG),this._state.FGColor=this.FGColor.Color),((u=_typeof(this.BGColor.Color))!==(g=_typeof(this._state.BGColor))||"object"==u&&(this.BGColor.Color.effectValue!==this._state.BGColor.effectValue||this._state.BGColor.color.indexOf(this.BGColor.Color.color)<0)||"object"!=u&&this._state.BGColor.indexOf(this.BGColor.Color)<0)&&(this.btnBGColor.setColor(this.BGColor.Color),Common.Utils.ThemeColor.selectPickerColorByEffect(this.BGColor.Color,this.colorsBG),this._state.BGColor=this.BGColor.Color);var f=this.GradColor.colors[this.GradColor.currentIdx];((u=_typeof(f))!==(g=_typeof(this._state.GradColor))||"object"==u&&(f.effectValue!==this._state.GradColor.effectValue||this._state.GradColor.color.indexOf(f.color)<0)||"object"!=u&&this._state.GradColor.indexOf(f)<0)&&(this.btnGradColor.setColor(f),Common.Utils.ThemeColor.selectPickerColorByEffect(f,this.colorsGrad),this._state.GradColor=f),this._noApply=!1}}},btnDirectionRedraw:function(t,e){this.gradientColorsStr=e,i.each(this._viewDataLinear,(function(t){t.gradientColorsStr=e})),this.mnuDirectionPicker.store.each((function(t){t.set("gradientColorsStr",e)}),this),-1==this.typeGradient?this.btnDirection.$icon.css({background:"none"}):2==this.typeGradient?this.btnDirection.$icon.css({background:"radial-gradient("+e+")"}):this.btnDirection.$icon.css({background:"linear-gradient("+this.typeGradient+"deg, "+e+")"})},UpdateThemeColors:function(){this.borderColor||(this.btnBorderColor.setMenu(),this.borderColor=this.btnBorderColor.getPicker(),this.btnBorderColor.on("eyedropper:start",i.bind(this.onEyedropperStart,this)),this.btnBorderColor.on("eyedropper:end",i.bind(this.onEyedropperEnd,this)),this.btnBackColor.setMenu(),this.btnBackColor.on("color:select",i.bind(this.onColorsBackSelect,this)),this.btnBackColor.on("eyedropper:start",i.bind(this.onEyedropperStart,this)),this.btnBackColor.on("eyedropper:end",i.bind(this.onEyedropperEnd,this)),this.colorsBack=this.btnBackColor.getPicker(),this.fillControls.push(this.btnBackColor),this.btnGradColor=new Common.UI.ColorButton({parentEl:e("#cell-gradient-color-btn"),color:"000000",eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textGradientColor}),this.fillControls.push(this.btnGradColor),this.colorsGrad=this.btnGradColor.getPicker(),this.btnGradColor.on("color:select",i.bind(this.onColorsGradientSelect,this)),this.btnGradColor.on("eyedropper:start",i.bind(this.onEyedropperStart,this)),this.btnGradColor.on("eyedropper:end",i.bind(this.onEyedropperEnd,this)),this.btnFGColor=new Common.UI.ColorButton({parentEl:e("#cell-foreground-color-btn"),color:"000000",eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"medium",ariaLabel:this.textForeground}),this.fillControls.push(this.btnFGColor),this.colorsFG=this.btnFGColor.getPicker(),this.btnFGColor.on("color:select",i.bind(this.onColorsFGSelect,this)),this.btnFGColor.on("eyedropper:start",i.bind(this.onEyedropperStart,this)),this.btnFGColor.on("eyedropper:end",i.bind(this.onEyedropperEnd,this)),this.btnBGColor=new Common.UI.ColorButton({parentEl:e("#cell-background-color-btn"),color:"ffffff",eyeDropper:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"medium",ariaLabel:this.textBackground}),this.fillControls.push(this.btnBGColor),this.colorsBG=this.btnBGColor.getPicker(),this.btnBGColor.on("color:select",i.bind(this.onColorsBGSelect,this)),this.btnBGColor.on("eyedropper:start",i.bind(this.onEyedropperStart,this)),this.btnBGColor.on("eyedropper:end",i.bind(this.onEyedropperEnd,this))),this.colorsBack.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.borderColor.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),!this.btnBorderColor.isAutoColor()&&this.btnBorderColor.setColor(this.borderColor.getColor()),this.colorsGrad.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsFG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors())},onApiEditCell:function(t){this.isEditCell=t!=Asc.c_oAscCellEditorState.editEnd,t!=Asc.c_oAscCellEditorState.editStart&&t!=Asc.c_oAscCellEditorState.editEnd||this.disableControls(this._locked)},setLocked:function(t){this._locked=t},disableFillPanels:function(t){this._state.DisabledFillPanels!==t&&(this._state.DisabledFillPanels=t,i.each(this.fillControls,(function(e){e.setDisabled(t)})))},disableControls:function(t){this._initSettings||(t=t||this.isEditCell,this.disableFillPanels(t),this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)}))))},onFillSrcSelect:function(t,e){var i=this;switch(this.ShowHideElem(e.value),e.value){case Asc.c_oAscFill.FILL_TYPE_SOLID:this._state.FillType=Asc.c_oAscFill.FILL_TYPE_SOLID,this._noApply||(null==this.pattern&&(this.pattern=new Asc.asc_CPatternFill),this.pattern.asc_setType(-1),this.pattern.asc_setFgColor(Common.Utils.ThemeColor.getRgbColor("transparent"==this.CellColor.Color?{color:"4f81bd",effectId:24}:this.CellColor.Color)),this.fill.asc_setPatternFill(this.pattern),this.api.asc_setCellFill(this.fill));break;case Asc.c_oAscFill.FILL_TYPE_GRAD:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_GRAD,!this._noApply){if(null==this.gradient&&(this.gradient=new Asc.asc_CGradientFill),this.gradient.asc_setType(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&this.gradient.asc_setDegree(this.GradLinearDirectionType),this.OriginalFillType!==Asc.c_oAscFill.FILL_TYPE_GRAD){if(this.GradColor.currentIdx=0,2===this.GradColor.colors.length){var o=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[0]).get_color().get_hex(),n=Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1]).get_color().get_hex();"ffffff"===o&&"ffffff"===n&&(this.GradColor.colors[0]={color:"4f81bd",effectId:24})}var s=[];this.GradColor.colors.forEach((function(t,e){var o=new Asc.asc_CGradientStop;o.asc_setColor(Common.Utils.ThemeColor.getRgbColor(i.GradColor.colors[e])),o.asc_setPosition(i.GradColor.values[e]/100),s.push(o)})),this.gradient.asc_putGradientStops(s)}this.fill.asc_setGradientFill(this.gradient),this.api.asc_setCellFill(this.fill)}break;case Asc.c_oAscFill.FILL_TYPE_PATT:if(this._state.FillType=Asc.c_oAscFill.FILL_TYPE_PATT,!this._noApply){var a=Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color).get_color().get_hex();a="ffffff"===Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color).get_color().get_hex()&&"ffffff"===a?{color:"4f81bd",effectId:24}:this.FGColor.Color,null==this.pattern&&(this.pattern=new Asc.asc_CPatternFill),this.pattern.asc_setType(this.PatternFillType),this.pattern.asc_setFgColor(Common.Utils.ThemeColor.getRgbColor(a)),this.pattern.asc_setBgColor(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),this.fill.asc_setPatternFill(this.pattern),this.api.asc_setCellFill(this.fill)}break;case Asc.c_oAscFill.FILL_TYPE_NOFILL:this._state.FillType=Asc.c_oAscFill.FILL_TYPE_NOFILL,this._noApply||(this.fill.asc_setPatternFill(null),this.fill.asc_setGradientFill(null),this.api.asc_setCellFill(this.fill))}Common.NotificationCenter.trigger("edit:complete",this)},ShowHideElem:function(t){this.FillColorContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_SOLID),this.FillPatternContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_PATT),this.FillGradientContainer.toggleClass("settings-hidden",t!==Asc.c_oAscFill.FILL_TYPE_GRAD)},onSelectGradient:function(t,e,o,n){var s=this;if(!this._noApply){var a={};if(i.isFunction(n.toJSON)){if(!n.get("selected"))return;a=n.toJSON()}else a=n;if(this.typeGradient=a.type+90,this.GradLinearDirectionType=a.type,this.numGradientAngle.setValue(a.type,!0),this.api&&this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR){if(null==this.gradient){this.gradient=new Asc.asc_CGradientFill,this.gradient.asc_setType(this.GradFillType);var r=[];this.GradColor.values.forEach((function(t,e){var i=new Asc.asc_CGradientStop;i.asc_setColor(Common.Utils.ThemeColor.getRgbColor(s.GradColor.colors[e])),i.asc_setPosition(s.GradColor.values[e]/100),r.push(i)})),this.gradient.asc_putGradientStops(r)}this.gradient.asc_setDegree(a.type),this.fill.asc_setGradientFill(this.gradient),this.api.asc_setCellFill(this.fill)}Common.NotificationCenter.trigger("edit:complete",this)}},onColorsGradientSelect:function(t,e){var i=this;if(this.GradColor.colors[this.GradColor.currentIdx]=e,this.sldrGradient.setColorValue(Common.Utils.String.format("#{0}","object"==_typeof(e)?e.color:e)),this.api&&!this._noApply){null==this.gradient&&(this.gradient=new Asc.asc_CGradientFill,this.gradient.asc_setType(this.GradFillType),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&this.gradient.asc_setDegree(this.GradLinearDirectionType));var o=[];this.GradColor.values.forEach((function(t,e){var n=new Asc.asc_CGradientStop;n.asc_setColor(Common.Utils.ThemeColor.getRgbColor(Common.Utils.ThemeColor.colorValue2EffectId(i.GradColor.colors[e]))),n.asc_setPosition(i.GradColor.values[e]/100),o.push(n)})),this.gradient.asc_putGradientStops(o),this.fill.asc_setGradientFill(this.gradient),this.api.asc_setCellFill(this.fill)}Common.NotificationCenter.trigger("edit:complete",this)},onGradientAngleChange:function(t,e,i,o){this.api&&!this._noApply&&(null==this.gradient&&(this.gradient=new Asc.asc_CGradientFill,this.gradient.asc_setType(this.GradFillType)),this.GradFillType==Asc.c_oAscFillGradType.GRAD_LINEAR&&this.gradient.asc_setDegree(t.getNumberValue()),this.fill.asc_setGradientFill(this.gradient),this.api.asc_setCellFill(this.fill))},onGradientChange:function(t,e,o){this.GradColor.values=t.getValues();var n=this.GradColor.values[this.GradColor.currentIdx];this.spnGradPosition.setValue(Common.UI.isRTL()?this.sldrGradient.maxValue-n:n,!0),this._sliderChanged=!0,this.api&&!this._noApply&&this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(i.bind(this._gradientApplyFunc,this),100))},onGradientChangeComplete:function(t,e,i){clearInterval(this.updateslider),this._sliderChanged=!0,this._sendUndoPoint||(this.api.setEndPointHistory(),this._gradientApplyFunc()),this._sendUndoPoint=!0},_gradientApplyFunc:function(){if(this._sliderChanged){var t=this;null==this.gradient&&(this.gradient=new Asc.asc_CGradientFill);var e=[];this.GradColor.colors.forEach((function(i,o){var n=new Asc.asc_CGradientStop;n.asc_setColor(Common.Utils.ThemeColor.getRgbColor(Common.Utils.ThemeColor.colorValue2EffectId(t.GradColor.colors[o]))),n.asc_setPosition(t.GradColor.values[o]/100),e.push(n)})),this.gradient.asc_putGradientStops(e),this.fill.asc_setGradientFill(this.gradient),this.api.asc_setCellFill(this.fill),this._sliderChanged=!1}},onPatternSelect:function(t,e){this.api&&!this._noApply&&(this.PatternFillType=e.get("type"),null==this.pattern&&(this.pattern=new Asc.asc_CPatternFill,this.pattern.asc_setFgColor(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),this.pattern.asc_setBgColor(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),this.pattern.asc_setType(this.PatternFillType),this.fill.asc_setPatternFill(this.pattern),this.api.asc_setCellFill(this.fill)),Common.NotificationCenter.trigger("edit:complete",this)},onColorsFGSelect:function(t,e){this.FGColor={Value:1,Color:e},this.api&&!this._noApply&&(null==this.pattern&&(this.pattern=new Asc.asc_CPatternFill,this.pattern.asc_setType(this.PatternFillType),this.pattern.asc_setBgColor(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),this.pattern.asc_setFgColor(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),this.fill.asc_setPatternFill(this.pattern),this.api.asc_setCellFill(this.fill)),Common.NotificationCenter.trigger("edit:complete",this)},onColorsBGSelect:function(t,e){this.BGColor={Value:1,Color:e},this.api&&!this._noApply&&(null==this.pattern&&(this.pattern=new Asc.asc_CPatternFill,this.pattern.asc_setFgColor(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),this.pattern.asc_setType(this.PatternFillType)),this.pattern.asc_setBgColor(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),this.fill.asc_setPatternFill(this.pattern),this.api.asc_setCellFill(this.fill)),Common.NotificationCenter.trigger("edit:complete",this)},onWrapChange:function(t,e,i,o){this.api&&!this._noApply&&this.api.asc_setCellTextWrap("checked"==t.getValue()),this.chShrink.setDisabled("checked"==t.getValue()||this._locked),Common.NotificationCenter.trigger("edit:complete",this)},onShrinkChange:function(t,e,i,o){this.api&&!this._noApply&&this.api.asc_setCellTextShrink("checked"==t.getValue()),Common.NotificationCenter.trigger("edit:complete",this)},onPositionChange:function(t){var e=this,i=t.getNumberValue();Common.UI.isRTL()&&(i=this.sldrGradient.maxValue-i);var o=this.GradColor.currentIdx-1<0?0:this.GradColor.values[this.GradColor.currentIdx-1],n=this.GradColor.currentIdx+1<this.GradColor.values.length?this.GradColor.values[this.GradColor.currentIdx+1]:100,s=i<o||i>n;if(this.api){this.GradColor.values[this.GradColor.currentIdx]=i,null==this.gradient&&(this.gradient=new Asc.asc_CGradientFill,this.gradient.asc_setType(this.GradFillType));var a=[];this.GradColor.values.forEach((function(t,i){var o=new Asc.asc_CGradientStop;o.asc_setColor(Common.Utils.ThemeColor.getRgbColor(Common.Utils.ThemeColor.colorValue2EffectId(e.GradColor.colors[i]))),o.asc_setPosition(e.GradColor.values[i]/100),a.push(o)})),this.gradient.asc_putGradientStops(a),this.fill.asc_setGradientFill(this.gradient),this.api.asc_setCellFill(this.fill),s&&(this.sldrGradient.sortThumbs(),this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient))}},onAddGradientStep:function(){if(!(this.GradColor.colors.length>9)){var t=this.GradColor.currentIdx,e=(this.GradColor.values[t]+this.GradColor.values[t<this.GradColor.colors.length-1?t+1:t-1])/2;this.GradColor.colors[this.GradColor.colors.length]=this.GradColor.colors[t],this.GradColor.currentIdx=this.GradColor.colors.length-1;var i=this.sldrGradient.addNewThumb(void 0,e,t);this.GradColor.colors[this.GradColor.currentIdx]=i,this.sldrGradient.trigger("change",this.sldrGradient),this.sldrGradient.trigger("changecomplete",this.sldrGradient)}},onRemoveGradientStep:function(){if(!(this.GradColor.values.length<3)){var t=this.GradColor.currentIdx;if(this.GradColor.values.splice(this.GradColor.currentIdx,1),this.sldrGradient.removeThumb(this.GradColor.currentIdx),i.isUndefined(this.GradColor.currentIdx)||this.GradColor.currentIdx>=this.GradColor.colors.length){var e=t>0?t-1:t;e=0===e&&this.GradColor.values.length>2?this.GradColor.values.length-2:e,this.GradColor.currentIdx=e}this.sldrGradient.setActiveThumb(this.GradColor.currentIdx)}},onEyedropperStart:function(t){this.api.asc_startEyedropper(i.bind(t.eyedropperEnd,t)),this.fireEvent("eyedropper",!0)},onEyedropperEnd:function(){this.fireEvent("eyedropper",!1)}},SSE.Views.CellSettings||{}))})),define("text!spreadsheeteditor/main/app/template/SlicerSettings.template",[],(function(){return'<table cols="3" role="presentation">\n    <tr>\n        <td class="padding-large" width="88px">\n            <label class="input-label"><%= scope.textWidth %></label>\n            <div id="slicer-spin-width"></div>\n        </td>\n        <td class="padding-large" width="28px" style="vertical-align: bottom;">\n            <div id="slicer-button-ratio"></div>\n        </td>\n        <td class="padding-large" width="88px">\n            <label class="input-label"><%= scope.textHeight %></label>\n            <div id="slicer-spin-height"></div>\n        </td>\n    </tr>\n</table>\n<table cols="2" role="presentation">\n    <tr>\n        <td class="padding-small" colspan=2>\n            <label class="header"><%= scope.textPosition %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" width="50%">\n            <label class="input-label"><%= scope.textHor %></label>\n            <div id="slicer-spin-hor"></div>\n        </td>\n        <td class="padding-small" width="50%">\n            <label class="input-label"><%= scope.textVert %></label>\n            <div id="slicer-spin-vert"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="slicer-checkbox-disable-resize"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2>\n            <label class="header"><%= scope.textButtons %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <label class="input-label"><%= scope.textColumns %></label>\n            <div id="slicer-spin-cols" class="margin-left-5"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" width="50%">\n            <label class="input-label"><%= scope.textWidth %></label>\n            <div id="slicer-spin-col-width"></div>\n        </td>\n        <td class="padding-small" width="50%">\n            <label class="input-label"><%= scope.textHeight %></label>\n            <div id="slicer-spin-col-height"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td colspan=2>\n            <label class="header"><%= scope.textStyle %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="slicer-btn-style" style="width: 100%;"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <label class="header"><%= scope.strSorting %></label>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="slicer-radio-asc"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-large" colspan=2>\n            <div id="slicer-radio-desc"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="slicer-check-hide-nodata"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="slicer-check-indicate-nodata"></div>\n        </td>\n    </tr>\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div id="slicer-check-show-nodata-last"></div>\n        </td>\n    </tr>\n    \x3c!--<tr>--\x3e\n        \x3c!--<td class="padding-small" colspan=2>--\x3e\n            \x3c!--<div id="slicer-check-show-deleted"></div>--\x3e\n        \x3c!--</td>--\x3e\n    \x3c!--</tr>--\x3e\n    <tr>\n        <td class="padding-small" colspan=2>\n            <div class="separator horizontal"></div>\n        </td>\n    </tr>\n    <tr>\n        <td align="center" colspan=2>\n            <label class="link canfocused" id="slicer-advanced-link" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%= scope.textAdvanced %></label>\n        </td>\n    </tr>\n    <tr class="finish-cell"></tr>\n</table>'})),define("spreadsheeteditor/main/app/view/SlicerSettings",["text!spreadsheeteditor/main/app/template/SlicerSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/MetricSpinner"],(function(t,e,i,o){"use strict";SSE.Views.SlicerSettings=o.View.extend(i.extend({el:"#id-slicer-settings",template:i.template(t),events:{},options:{alias:"SlicerSettings"},initialize:function(){this._initSettings=!0,this._nRatio=1,this._state={Width:0,Height:0,DisabledControls:!1,keepRatio:!1,ColCount:0,ColWidth:0,ColHeight:0,PosVert:0,PosHor:0,PosLocked:!1,SortOrder:void 0,IndNoData:!1,ShowNoData:!1,HideNoData:!1,DisabledSizeControls:!1},this.spinners=[],this.lockedControls=[],this.sizeControls=[],this._locked=!1,this._noApply=!1,this._originalProps=null,this.styles=null,this.render()},render:function(){e(this.el).html(this.template({scope:this})),this.linkAdvanced=e("#slicer-advanced-link")},setApi:function(t){if(null!=t)return this.api=t,this.api.asc_registerCallback("asc_onSendThemeColors",i.bind(this.onSendThemeColors,this)),this},setMode:function(t){this.mode=t},updateMetricUnit:function(){if(this.spinners){for(var t=0;t<this.spinners.length;t++){var e=this.spinners[t];e.setDefaultUnit(Common.Utils.Metric.getCurrentMetricName()),e.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.pt?1:.1)}this.spnWidth&&this.spnWidth.setValue(null!==this._state.Width?Common.Utils.Metric.fnRecalcFromMM(this._state.Width):"",!0),this.spnHeight&&this.spnHeight.setValue(null!==this._state.Height?Common.Utils.Metric.fnRecalcFromMM(this._state.Height):"",!0),this.spnColWidth&&this.spnColWidth.setValue(null!==this._state.ColWidth?Common.Utils.Metric.fnRecalcFromMM(this._state.ColWidth):"",!0),this.spnColHeight&&this.spnColHeight.setValue(null!==this._state.ColHeight?Common.Utils.Metric.fnRecalcFromMM(this._state.ColHeight):"",!0);var i=this._state.PosHor;this.spnHor&&this.spnHor.setValue(null!=i?Common.Utils.Metric.fnRecalcFromMM(i):"",!0),i=this._state.PosVert,this.spnVert&&this.spnVert.setValue(null!=i?Common.Utils.Metric.fnRecalcFromMM(i):"",!0)}},createDelayedControls:function(){var t=this;this.spnWidth=new Common.UI.MetricSpinner({el:e("#slicer-spin-width"),step:.1,width:78,defaultUnit:"cm",value:"0 cm",maxValue:5963.9,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textWidth}),this.spinners.push(this.spnWidth),this.sizeControls.push(this.spnWidth),this.spnHeight=new Common.UI.MetricSpinner({el:e("#slicer-spin-height"),step:.1,width:78,defaultUnit:"cm",value:"0 cm",maxValue:5963.9,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textHeight}),this.spinners.push(this.spnHeight),this.sizeControls.push(this.spnHeight),this.btnRatio=new Common.UI.Button({parentEl:e("#slicer-button-ratio"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-advanced-ratio",style:"margin-bottom: 1px;",enableToggle:!0,hint:this.textKeepRatio,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}),this.sizeControls.push(this.btnRatio),this.btnRatio.on("click",i.bind((function(t,e){t.pressed&&this.spnHeight.getNumberValue()>0&&(this._nRatio=this.spnWidth.getNumberValue()/this.spnHeight.getNumberValue()),this.api&&this._originalProps&&(this._originalProps.asc_putLockAspect(t.pressed),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)}),this)),this.spnWidth.on("change",i.bind(this.onWidthChange,this)),this.spnHeight.on("change",i.bind(this.onHeightChange,this)),this.spnWidth.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnHeight.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnHor=new Common.UI.MetricSpinner({el:e("#slicer-spin-hor"),step:.1,width:85,defaultUnit:"cm",value:"0 cm",maxValue:5963.9,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textPosition+" "+this.textHor}),this.spinners.push(this.spnHor),this.sizeControls.push(this.spnHor),this.spnVert=new Common.UI.MetricSpinner({el:e("#slicer-spin-vert"),step:.1,width:85,defaultUnit:"cm",value:"0 cm",maxValue:5963.9,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textPosition+" "+this.textVert}),this.spinners.push(this.spnVert),this.sizeControls.push(this.spnVert),this.spnHor.on("change",i.bind(this.onHorChange,this)),this.spnVert.on("change",i.bind(this.onVertChange,this)),this.spnHor.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnVert.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.chLock=new Common.UI.CheckBox({el:e("#slicer-checkbox-disable-resize"),labelText:this.textLock,disabled:this._locked,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chLock),this.chLock.on("change",this.onLockSlicerChange.bind(this)),this.spnColWidth=new Common.UI.MetricSpinner({el:e("#slicer-spin-col-width"),step:.1,width:85,defaultUnit:"cm",value:"0 cm",maxValue:5963.9,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textColumns+" "+this.textWidth}),this.spinners.push(this.spnColWidth),this.sizeControls.push(this.spnColWidth),this.spnColHeight=new Common.UI.MetricSpinner({el:e("#slicer-spin-col-height"),step:.1,width:85,defaultUnit:"cm",value:"0 cm",maxValue:5963.9,minValue:0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textColumns+" "+this.textHeight}),this.spinners.push(this.spnColHeight),this.sizeControls.push(this.spnColHeight),this.numCols=new Common.UI.MetricSpinner({el:e("#slicer-spin-cols"),step:1,width:55,defaultUnit:"",defaultValue:1,value:"1",allowDecimal:!1,maxValue:2e4,minValue:1,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textColumns}),this.sizeControls.push(this.numCols),this.spnColWidth.on("change",i.bind(this.onColWidthChange,this)),this.spnColHeight.on("change",i.bind(this.onColHeightChange,this)),this.numCols.on("change",i.bind(this.onColChange,this)),this.spnColWidth.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.spnColHeight.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.numCols.on("inputleave",(function(){Common.NotificationCenter.trigger("edit:complete",t)})),this.radioAsc=new Common.UI.RadioBox({el:e("#slicer-radio-asc"),name:"asc-radio-slicer-sort",labelText:this.textAsc+" ("+this.textAZ+")",checked:!0,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.radioAsc.on("change",i.bind((function(t,e,i){e&&this.api&&(this._originalProps&&(this._originalProps.asc_getSlicerProperties().asc_setSortOrder(Asc.ST_tabularSlicerCacheSortOrder.Ascending),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this))}),this)),this.lockedControls.push(this.radioAsc),this.radioDesc=new Common.UI.RadioBox({el:e("#slicer-radio-desc"),name:"asc-radio-slicer-sort",labelText:this.textDesc+" ("+this.textZA+")",checked:!1,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.radioDesc.on("change",i.bind((function(t,e,i){e&&this.api&&(this._originalProps&&(this._originalProps.asc_getSlicerProperties().asc_setSortOrder(Asc.ST_tabularSlicerCacheSortOrder.Descending),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this))}),this)),this.lockedControls.push(this.radioDesc),this.chHideNoData=new Common.UI.CheckBox({el:e("#slicer-check-hide-nodata"),labelText:this.strHideNoData,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.chHideNoData.on("change",i.bind((function(t,e,i,o){var n="checked"==t.getValue();this._originalProps&&this.api&&(this._originalProps.asc_getSlicerProperties().asc_setHideItemsWithNoData(n),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)}),this)),this.lockedControls.push(this.chHideNoData),this.chIndNoData=new Common.UI.CheckBox({el:e("#slicer-check-indicate-nodata"),labelText:this.strIndNoData,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.chIndNoData.on("change",i.bind((function(t,e,i,o){var n="checked"==t.getValue();this._originalProps&&this.api&&(this._originalProps.asc_getSlicerProperties().asc_setIndicateItemsWithNoData(n),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)}),this)),this.lockedControls.push(this.chIndNoData),this.chShowNoData=new Common.UI.CheckBox({el:e("#slicer-check-show-nodata-last"),disabled:!0,labelText:this.strShowNoData,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.chShowNoData.on("change",i.bind((function(t,e,i,o){this._originalProps&&this.api&&(this._originalProps.asc_getSlicerProperties().asc_setShowItemsWithNoDataLast("checked"==t.getValue()),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)}),this)),this.lockedControls.push(this.chShowNoData),this.chShowDel=new Common.UI.CheckBox({el:e("#slicer-check-show-deleted"),labelText:this.strShowDel,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.chShowDel.on("change",i.bind((function(t,e,i,o){}),this)),this.lockedControls.push(this.chShowDel),e(this.el).on("click","#slicer-advanced-link",i.bind(this.openAdvancedSettings,this))},createDelayedElements:function(){this.createDelayedControls(),this.updateMetricUnit(),this._initSettings=!1},onSendThemeColors:function(){this.btnSlicerStyle&&this._originalProps&&this.onInitStyles(this._originalProps.asc_getSlicerProperties().asc_getStylesPictures())},openAdvancedSettings:function(t){if(!this.linkAdvanced.hasClass("disabled")){var e=this;if(e.api&&!this._locked){var i=e.api.asc_getGraphicObjectProps();if(i&&i.length>0)for(var o,n,s=i.length-1;s>=0;s--)if(o=i[s].asc_getObjectType(),n=i[s].asc_getObjectValue(),Asc.c_oAscTypeSelectElement.Image==o){new SSE.Views.SlicerSettingsAdvanced({imageProps:n,api:e.api,styles:e.styles||e._originalProps.asc_getSlicerProperties().asc_getStylesPictures(),handler:function(t,i){"ok"==t&&e.api&&e.api.asc_setGraphicObjectProps(i.imageProps),Common.NotificationCenter.trigger("edit:complete",e)}}).show();break}}}},ChangeSettings:function(t){if(this._initSettings&&this.createDelayedElements(),t){this._originalProps=new Asc.asc_CImgProperty(t);var e=t.asc_getWidth();if((Math.abs(this._state.Width-e)>.001||(null===this._state.Width||null===e)&&this._state.Width!==e)&&(this.spnWidth.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.Width=e),e=t.asc_getHeight(),(Math.abs(this._state.Height-e)>.001||(null===this._state.Height||null===e)&&this._state.Height!==e)&&(this.spnHeight.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.Height=e),t.asc_getHeight()>0&&(this._nRatio=t.asc_getWidth()/t.asc_getHeight()),e=t.asc_getLockAspect(),this._state.keepRatio!==e&&(this.btnRatio.toggle(e),this._state.keepRatio=e),e=t.get_Position()){var i={X:e.get_X(),Y:e.get_Y()};this.spnHor.setValue(null!=i.X?Common.Utils.Metric.fnRecalcFromMM(i.X):"",!0),this.spnVert.setValue(null!=i.Y?Common.Utils.Metric.fnRecalcFromMM(i.Y):"",!0),this._state.PosHor=i.X,this._state.PosVert=i.Y}else this.spnHor.setValue("",!0),this.spnVert.setValue("",!0),this._state.PosHor=this._state.PosVert=null;var o=t.asc_getSlicerProperties();if(this.disableControls(this._locked,!!o&&o.asc_getLockedPosition()),o){if(e=o.asc_getColumnCount(),(Math.abs(this._state.ColCount-e)>.1||(null===this._state.ColCount||null===e)&&this._state.ColCount!==e)&&(this.numCols.setValue(null!==e?e:"",!0),this._state.ColCount=e),e=o.asc_getButtonWidth()/36e3,(Math.abs(this._state.ColWidth-e)>.001||(null===this._state.ColWidth||null===e)&&this._state.ColWidth!==e)&&(this.spnColWidth.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.ColWidth=e),e=o.asc_getRowHeight()/36e3,(Math.abs(this._state.ColHeight-e)>.001||(null===this._state.ColHeight||null===e)&&this._state.ColHeight!==e)&&(this.spnColHeight.setValue(null!==e?Common.Utils.Metric.fnRecalcFromMM(e):"",!0),this._state.ColHeight=e),this.btnSlicerStyle||this.onInitStyles(o.asc_getStylesPictures()),e=o.asc_getStyle(),this._state.StyleType!==e||this._isTemplatesChanged){this.btnSlicerStyle.suspendEvents();var n=this.btnSlicerStyle.menuPicker.store.findWhere({type:e});this.btnSlicerStyle.menuPicker.selectRecord(n),this.btnSlicerStyle.resumeEvents(),n?this.btnSlicerStyle.fillComboView(this.btnSlicerStyle.menuPicker.getSelectedRec(),!0):this.btnSlicerStyle.fillComboView(this.btnSlicerStyle.menuPicker.store.at(0),!0),this._state.StyleType=e}this._isTemplatesChanged=!1,e=o.asc_getLockedPosition(),this.chLock.setValue(null!=e?!!e:"indeterminate",!0),(e=o.asc_getSortOrder())==Asc.ST_tabularSlicerCacheSortOrder.Ascending?this.radioAsc.setValue(!0,!0):this.radioDesc.setValue(!0,!0),e=o.asc_getIndicateItemsWithNoData(),this._state.IndNoData!==e&&(this.chIndNoData.setValue(null!=e?!!e:"indeterminate",!0),this._state.IndNoData=e),e=o.asc_getShowItemsWithNoDataLast(),this._state.ShowNoData!==e&&(this.chShowNoData.setValue(null!=e?!!e:"indeterminate",!0),this._state.ShowNoData=e),e=o.asc_getHideItemsWithNoData(),this._state.HideNoData!==e&&(this.chHideNoData.setValue(null!=e?!!e:"indeterminate",!0),this._state.HideNoData=e),this.chIndNoData.setDisabled(e||this._locked),this.chShowNoData.setDisabled(e||"checked"!=this.chIndNoData.getValue()||this._locked),this.chShowDel.setDisabled(e||this._locked)}}},onWidthChange:function(t,e,i,o){var n=t.getNumberValue(),s=this.spnHeight.getNumberValue();this.btnRatio.pressed&&((s=n/this._nRatio)>this.spnHeight.options.maxValue&&(n=(s=this.spnHeight.options.maxValue)*this._nRatio,this.spnWidth.setValue(n,!0)),this.spnHeight.setValue(s,!0)),this.api&&this._originalProps&&(this._originalProps.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(n)),this._originalProps.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(s)),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},onHeightChange:function(t,e,i,o){var n=t.getNumberValue(),s=this.spnWidth.getNumberValue();this.btnRatio.pressed&&((s=n*this._nRatio)>this.spnWidth.options.maxValue&&(n=(s=this.spnWidth.options.maxValue)/this._nRatio,this.spnHeight.setValue(n,!0)),this.spnWidth.setValue(s,!0)),this.api&&this._originalProps&&(this._originalProps.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(s)),this._originalProps.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(n)),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},onHorChange:function(t,e,i,o){var n=new Asc.CPosition;""!==t.getValue()&&n.put_X(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),""!==this.spnVert.getValue()&&n.put_Y(Common.Utils.Metric.fnRecalcToMM(this.spnVert.getNumberValue())),this.api&&this._originalProps&&(this._originalProps.put_Position(n),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},onVertChange:function(t,e,i,o){var n=new Asc.CPosition;""!==this.spnHor.getValue()&&n.put_X(Common.Utils.Metric.fnRecalcToMM(this.spnHor.getNumberValue())),""!==t.getValue()&&n.put_Y(Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api&&this._originalProps&&(this._originalProps.put_Position(n),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},onColWidthChange:function(t,e,i,o){this.api&&this._originalProps&&(this._originalProps.asc_getSlicerProperties().asc_setButtonWidth(36e3*Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},onColHeightChange:function(t,e,i,o){this.api&&this._originalProps&&(this._originalProps.asc_getSlicerProperties().asc_setRowHeight(36e3*Common.Utils.Metric.fnRecalcToMM(t.getNumberValue())),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},onColChange:function(t,e,i,o){this.api&&this._originalProps&&(this._originalProps.asc_getSlicerProperties().asc_setColumnCount(t.getNumberValue()),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},onInitStyles:function(t){var o=this;if(this._isTemplatesChanged=!0,this.styles=t,this.btnSlicerStyle||(this.btnSlicerStyle=new Common.UI.ComboDataView({itemWidth:36,itemHeight:48,menuMaxHeight:235,enableKeyEvents:!0,cls:"combo-slicer-style",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big",ariaLabel:this.textStyle,fillOnChangeVisibility:!0}),this.btnSlicerStyle.render(e("#slicer-btn-style")),this.btnSlicerStyle.on("click",i.bind(this.onSelectSlicerStyle,this)),this.btnSlicerStyle.openButton.menu.on("show:after",(function(){o.btnSlicerStyle.menuPicker.scroller.update({alwaysVisibleY:!0})})),this.lockedControls.push(this.btnSlicerStyle),this._locked&&this.btnSlicerStyle.setDisabled(this._locked)),t&&t.length>0){var n=this.btnSlicerStyle.menuPicker.store;if(n){var s=n.length;if(s>0&&s==this.styles.length){var a=n.models;i.each(t,(function(t,e){a[e].set("imageUrl",t.asc_getImage())}))}else{var r=[];i.each(t,(function(t,e){r.push({type:t.asc_getName(),imageUrl:t.asc_getImage()})})),n.reset(r,{silent:!1})}}}else this.btnSlicerStyle.menuPicker.store.reset(),this.btnSlicerStyle.clearComboView();this.btnSlicerStyle.setDisabled(this.btnSlicerStyle.menuPicker.store.length<1||this._locked)},onSelectSlicerStyle:function(t,e){this._noApply||(this._originalProps&&(this._originalProps.asc_getSlicerProperties().asc_setStyle(e.get("type")),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this))},onLockSlicerChange:function(t,e,i,o){this.api&&this._originalProps&&(this._originalProps.asc_getSlicerProperties().asc_setLockedPosition("checked"==t.getValue()),this.api.asc_setGraphicObjectProps(this._originalProps)),Common.NotificationCenter.trigger("edit:complete",this)},setLocked:function(t){this._locked=t},disableControls:function(t,e){this._initSettings||(this.disableSizeControls(t||e),this._state.DisabledControls!==t&&(this._state.DisabledControls=t,i.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.linkAdvanced.toggleClass("disabled",t)))},disableSizeControls:function(t){this._state.DisabledSizeControls!==t&&(this._state.DisabledSizeControls=t,i.each(this.sizeControls,(function(e){e.setDisabled(t)})))},textKeepRatio:"Constant Proportions",textSize:"Size",textWidth:"Width",textHeight:"Height",textAdvanced:"Show advanced settings",textPosition:"Position",textHor:"Horizontal",textVert:"Vertical",textButtons:"Buttons",textColumns:"Columns",textStyle:"Style",textLock:"Disable resizing or moving",strSorting:"Sorting and filtering",textAsc:"Ascending",textDesc:"Descending",textAZ:"A to Z",textZA:"Z to A",textOldNew:"oldest to newest",textNewOld:"newest to oldest",textSmallLarge:"smallest to largest",textLargeSmall:"largest to smallest",strHideNoData:"Hide items with no data",strIndNoData:"Visually indicate items with no data",strShowNoData:"Show items with no data last",strShowDel:"Show items deleted from the data source"},SSE.Views.SlicerSettings||{}))})),void 0===Common)var Common={};define("common/main/lib/component/ListView",["common/main/lib/component/DataView"],(function(){"use strict";Common.UI.ListView=Common.UI.DataView.extend({options:{handleSelect:!0,enableKeyEvents:!0,showLast:!0,simpleAddMode:!1,headers:[],initSort:null,keyMoveDirection:"vertical",itemTemplate:_.template('<div id="<%= id %>" class="list-item" style="" role="listitem"><%= value %></div>'),cls:""},template:_.template(['<div role="list" class="listview inner <%= cls %>" <% if (options.dataHint) { %> data-hint="<%= options.dataHint %>" <% } if (options.dataHintDirection) { %> data-hint-direction="<%= options.dataHintDirection %>" <% } if (options.dataHintOffset) { %> data-hint-offset="<%= options.dataHintOffset %>" <% } %>>',"</div>"].join("")),initialize:function(t){null!=this.options.initSort&&(this.activeSortType=this.options.initSort.type,this.sortDirection=this.options.initSort.direction),this.headerEl=null,this.headerHeight=0,Common.UI.DataView.prototype.initialize.call(this,t)},render:function(){this.options.headers.length>0&&this.insertHeaders(),Common.UI.DataView.prototype.render.call(this)},insertHeaders:function(){var t=_.template(['<div class="listview-table-header-wrapper">','<div class="listview-table-header">',"<% _.each(headers, function(header){ %>","<%if (header.sortType) { %>",'<div class="table-header-item" style="<% if (header.width) {%>width: <%=header.width%>px; <%}%> <% if (header.style) { %> <%= header.style %> <%}%>" sort-type="<%=header.sortType%>">','<div class="header-sorted-wrapper">','<span class="header-sorted">',"<label><%= header.name %></label>",'<span class="sort-direction caret <%if (sortDirection == -1) { %>sort-desc <% } if (activeSortType != header.sortType) { %>caret-hidden<%}%>"></span>',"</span>","</div>","</div>","<%} else { %>",'<label class="table-header-item" style="<% if (header.width) {%>width: <%=header.width%>px; <%}%> <% if (header.style) { %> <%= header.style %> <%}%>"><%= header.name %></label>',"<%}%>","<% }); %>","</div>","</div>"].join(""))({headers:this.options.headers,activeSortType:this.options.initSort?this.options.initSort.type:null,sortDirection:this.options.initSort?this.options.initSort.direction:null});this.$el.before(t);for(var e=this,i=this.$el.prev().children(),o=0,n=0;o<this.options.headers.length;o++){var s=this.options.headers[o];if(s.sortType){var a=s.name.split(" "),r=$(i.find(".table-header-item .header-sorted label")[n]),l=$("<label>A</label>");if(e.$el.before(l),a.length>1&&r.height()>Math.ceil(l.height())){var c=0;a.forEach((function(t){l.text(t),l.width()>c&&(c=l.width())})),c<r.width()&&r.width(c)}l.remove(),n++}}if(i.find(".table-header-item .header-sorted").on("click",(function(t){var o=$(t.currentTarget).parent().parent().attr("sort-type"),n=$(t.currentTarget).find(".caret");e.activeSortType===o?e.sortDirection=-e.sortDirection:(e.activeSortType=o,e.sortDirection=1),i.find(".caret").addClass("caret-hidden"),n.removeClass("caret-hidden"),-1==e.sortDirection?n.addClass("sort-desc"):n.removeClass("sort-desc"),e.trigger("header:click",e.activeSortType,e.sortDirection)})),0!=this.tabindex&&this.handleSelect){i.on("click",(function(t){e.focus()}));var h=function(t){e.focus(),e.$el.find(".inner").removeClass("focused"),$(document).off("mouseup",h)};i.on("mousedown",(function(t){e.$el.find(".inner").addClass("focused"),$(document).on("mouseup",h)}))}this.headerEl=i,this.calcOffsetFromHeader()},setHeaderName:function(t,e){if(!(t<0||t>this.options.headers.length-1)&&this.headerEl){var i=$(this.headerEl.find(".table-header-item")[t]);i.attr("sort-type")&&(i=i.find("label")[0]),this.options.headers[t].name=e,i.text(e)}},setHeaderWidth:function(t,e){if(!(t<0||t>this.options.headers.length-1)&&this.headerEl){var i=$(this.headerEl.find(".table-header-item")[t]);i.attr("sort-type")&&(i=i.find("label")[0]),this.options.headers[t].width=e,$(i).width(e)}},calcOffsetFromHeader:function(){if(this.headerEl){var t=Math.floor(this.headerEl.outerHeight());this.headerHeight=t,this.scrollYStyle=_.extend({},this.scrollYStyle,{"margin-top":t+1+"px"})}},setOffsetFromHeader:function(t){this.headerEl&&(!0===t&&this.calcOffsetFromHeader(),this.$el.find(".listview").css({"padding-top":this.headerHeight+"px"}),this.scroller&&this.scroller.update(t?{scrollYStyle:this.scrollYStyle}:void 0))},onResetItems:function(){this.innerEl=null,Common.UI.DataView.prototype.onResetItems.call(this),this.trigger("items:reset",this),this.headerEl&&this.setOffsetFromHeader()},createNewItem:function(t){return new Common.UI.DataViewItem({template:this.itemTemplate,model:t,tabindex:this.itemTabindex})},onAddItem:function(t,e,i){var o=this.createNewItem(t);if(this.innerEl||(this.innerEl=$(this.el).find(".inner")),o&&this.innerEl){if(this.dataViewItems.length<1&&this.innerEl.find(".empty-text").remove(),this.options.simpleAddMode)this.innerEl.append(o.render().el),this.dataViewItems.push(o);else{var n=_.indexOf(this.store.models,t),s=this.innerEl.find("> .item");n>0?$(s.get(n-1)).after(o.render().el):s.length>0?$(s[n]).before(o.render().el):this.innerEl.append(o.render().el),this.dataViewItems=this.dataViewItems.slice(0,n).concat(o).concat(this.dataViewItems.slice(n))}if(this.listenTo(o,"change",this.onChangeItem),this.listenTo(o,"remove",this.onRemoveItem),this.listenTo(o,"click",this.onClickItem),this.listenTo(o,"dblclick",this.onDblClickItem),this.listenTo(o,"select",this.onSelectItem),this.listenTo(o,"tipchange",this.onChangeTip),this.listenTo(o,"contextmenu",this.onContextMenuItem),t.get("tip")){var a=$(o.el);a.attr("data-toggle","tooltip"),a.tooltip({title:t.get("tip"),placement:"cursor",zIndex:this.tipZIndex})}this.isSuspendEvents||this.trigger("item:add",this,o,t)}},focus:function(){this.cmpEl&&this.cmpEl.find(".listview").focus()},scrollToRecord:function(t,e){if(this._fromKeyDown){if(t){var i=$(this.el).find(".inner"),o=i.innerHeight(),n=_.indexOf(this.store.models,t),s=n>=0&&this.dataViewItems.length>n?$(this.dataViewItems[n].el):i.find("#"+t.get("id"));if(!(s.length<=0)){var a,r=Common.Utils.getPosition(s).top,l=s.outerHeight(),c=this.dataViewItems[0].el,h=c?c.offsetTop:0;e||r<h?a=i.scrollTop()+r-h:r+l>o&&(a=i.scrollTop()+r+l-o),void 0!==a&&(this.scroller&&this.allowScrollbar?this.scroller.scrollTop(a,0):i.scrollTop(a))}}}else Common.UI.DataView.prototype.scrollToRecord.call(this,t,e,this.headerHeight)},onChangeTip:function(t){var e=t.$el||$(t.el),i=e.data("bs.tooltip"),o=t.model;i?i.updateTitle(o.get("tip")||""):o.get("tip")&&(e.attr("data-toggle","tooltip"),e.tooltip({title:o.get("tip"),placement:"cursor",zIndex:this.tipZIndex}))}})}));var SCALE_MIN=40,MENU_SCALE_PART=260,MENU_BASE_WIDTH=220,reqerr;if(define("spreadsheeteditor/main/app/view/RightMenu",["text!spreadsheeteditor/main/app/template/RightMenu.template","jquery","underscore","backbone","common/main/lib/component/SideMenu","common/main/lib/component/Button","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox","spreadsheeteditor/main/app/view/ParagraphSettings","spreadsheeteditor/main/app/view/ImageSettings","spreadsheeteditor/main/app/view/ChartSettings","spreadsheeteditor/main/app/view/ShapeSettings","spreadsheeteditor/main/app/view/TextArtSettings","spreadsheeteditor/main/app/view/TableSettings","spreadsheeteditor/main/app/view/PivotSettings","spreadsheeteditor/main/app/view/SignatureSettings","spreadsheeteditor/main/app/view/CellSettings","spreadsheeteditor/main/app/view/SlicerSettings","common/main/lib/component/Scroller","common/main/lib/component/ListView"],(function(t,e,i,o){"use strict";SSE.Views.RightMenu=Common.UI.SideMenu.extend(i.extend({el:"#right-menu",template:i.template(t),events:{},initialize:function(){return this.minimizedMode=!0,this.btnText=new Common.UI.Button({hint:this.txtParagraphSettings,asctype:Common.Utils.documentSettingsType.Paragraph,enableToggle:!0,disabled:!0,iconCls:"btn-paragraph",toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnImage=new Common.UI.Button({hint:this.txtImageSettings,asctype:Common.Utils.documentSettingsType.Image,enableToggle:!0,disabled:!0,iconCls:"btn-menu-image",toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnChart=new Common.UI.Button({hint:this.txtChartSettings,asctype:Common.Utils.documentSettingsType.Chart,enableToggle:!0,disabled:!0,iconCls:"btn-menu-chart",toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnShape=new Common.UI.Button({hint:this.txtShapeSettings,asctype:Common.Utils.documentSettingsType.Shape,enableToggle:!0,disabled:!0,iconCls:"btn-menu-shape",toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnTextArt=new Common.UI.Button({hint:this.txtTextArtSettings,asctype:Common.Utils.documentSettingsType.TextArt,enableToggle:!0,disabled:!0,iconCls:"btn-menu-textart",toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnTable=new Common.UI.Button({hint:this.txtTableSettings,asctype:Common.Utils.documentSettingsType.Table,enableToggle:!0,disabled:!0,iconCls:"btn-menu-table",toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnPivot=new Common.UI.Button({hint:this.txtPivotSettings,asctype:Common.Utils.documentSettingsType.Pivot,enableToggle:!0,disabled:!0,iconCls:"btn-pivot-sum",visible:!1,toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnCell=new Common.UI.Button({hint:this.txtCellSettings,asctype:Common.Utils.documentSettingsType.Cell,enableToggle:!0,disabled:!0,iconCls:"btn-menu-cell",toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this.btnSlicer=new Common.UI.Button({hint:this.txtSlicerSettings,asctype:Common.Utils.documentSettingsType.Slicer,enableToggle:!0,disabled:!0,iconCls:"btn-slicer",toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this._settings=[],this._settings[Common.Utils.documentSettingsType.Paragraph]={panel:"id-paragraph-settings",btn:this.btnText},this._settings[Common.Utils.documentSettingsType.Image]={panel:"id-image-settings",btn:this.btnImage},this._settings[Common.Utils.documentSettingsType.Shape]={panel:"id-shape-settings",btn:this.btnShape},this._settings[Common.Utils.documentSettingsType.Chart]={panel:"id-chart-settings",btn:this.btnChart},this._settings[Common.Utils.documentSettingsType.TextArt]={panel:"id-textart-settings",btn:this.btnTextArt},this._settings[Common.Utils.documentSettingsType.Table]={panel:"id-table-settings",btn:this.btnTable},this._settings[Common.Utils.documentSettingsType.Pivot]={panel:"id-pivot-settings",btn:this.btnPivot},this._settings[Common.Utils.documentSettingsType.Cell]={panel:"id-cell-settings",btn:this.btnCell},this._settings[Common.Utils.documentSettingsType.Slicer]={panel:"id-slicer-settings",btn:this.btnSlicer},this},render:function(t){var o=e(this.el);this.trigger("render:before",this),this.defaultHideRightMenu=!(t.customization&&!1===t.customization.hideRightMenu);var n=!Common.localStorage.getBool("sse-hide-right-settings",this.defaultHideRightMenu);return Common.Utils.InternalSettings.set("sse-hide-right-settings",!n),Common.NotificationCenter.on("app:repaint",(function(){o.css("width",(n?MENU_SCALE_PART:SCALE_MIN)+"px")})),Common.NotificationCenter.on("uitheme:changed",i.bind((function(){this.updateWidth(),Common.NotificationCenter.trigger("layout:changed","rightmenu")}),this)),o.html(this.template({scope:this})),this.updateWidth(),o.css("z-index",101),o.show(),this.btnMoreContainer=e("#slot-right-menu-more"),Common.UI.SideMenu.prototype.render.call(this),this.btnMore.menu.menuAlign="tr-tl",this.btnText.setElement(e("#id-right-menu-text"),!1),this.btnText.render(),this.btnImage.setElement(e("#id-right-menu-image"),!1),this.btnImage.render(),this.btnChart.setElement(e("#id-right-menu-chart"),!1),this.btnChart.render(),this.btnShape.setElement(e("#id-right-menu-shape"),!1),this.btnShape.render(),this.btnTextArt.setElement(e("#id-right-menu-textart"),!1),this.btnTextArt.render(),this.btnTable.setElement(e("#id-right-menu-table"),!1),this.btnTable.render(),this.btnPivot.setElement(e("#id-right-menu-pivot"),!1),this.btnPivot.render(),this.btnCell.setElement(e("#id-right-menu-cell"),!1),this.btnCell.render(),this.btnSlicer.setElement(e("#id-right-menu-slicer"),!1),this.btnSlicer.render(),this.btnText.on("click",i.bind(this.onBtnMenuClick,this)),this.btnImage.on("click",i.bind(this.onBtnMenuClick,this)),this.btnChart.on("click",i.bind(this.onBtnMenuClick,this)),this.btnShape.on("click",i.bind(this.onBtnMenuClick,this)),this.btnTextArt.on("click",i.bind(this.onBtnMenuClick,this)),this.btnTable.on("click",i.bind(this.onBtnMenuClick,this)),this.btnPivot.on("click",i.bind(this.onBtnMenuClick,this)),this.btnCell.on("click",i.bind(this.onBtnMenuClick,this)),this.btnSlicer.on("click",i.bind(this.onBtnMenuClick,this)),this.paragraphSettings=new SSE.Views.ParagraphSettings,this.imageSettings=new SSE.Views.ImageSettings,this.chartSettings=new SSE.Views.ChartSettings,this.shapeSettings=new SSE.Views.ShapeSettings,this.textartSettings=new SSE.Views.TextArtSettings,this.tableSettings=new SSE.Views.TableSettings,this.pivotSettings=new SSE.Views.PivotSettings,this.cellSettings=new SSE.Views.CellSettings,this.slicerSettings=new SSE.Views.SlicerSettings,t&&t.isSignatureSupport&&(this.btnSignature=new Common.UI.Button({hint:this.txtSignatureSettings,asctype:Common.Utils.documentSettingsType.Signature,enableToggle:!0,disabled:!0,iconCls:"btn-menu-signature",toggleGroup:"tabpanelbtnsGroup",allowMouseEventsOnDisabled:!0}),this._settings[Common.Utils.documentSettingsType.Signature]={panel:"id-signature-settings",btn:this.btnSignature},this.btnSignature.setElement(e("#id-right-menu-signature"),!1),this.btnSignature.render().setVisible(!0),this.btnSignature.on("click",i.bind(this.onBtnMenuClick,this)),this.signatureSettings=new SSE.Views.SignatureSettings),i.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:e(this.el).find(".right-panel > .content-box"),suppressScrollX:!0,useKeyboard:!1})),n&&(e("#id-cell-settings").closest(".right-panel").css("display","inline-block"),e("#id-cell-settings").addClass("active")),this.trigger("render:after",this),this},setApi:function(t){var e=this;this.api=t;var o=function(t){this._isEyedropperStart=t},n=function(){e.updateScroller()};return this.paragraphSettings.setApi(t),this.imageSettings.setApi(t),this.chartSettings.setApi(t).on("updatescroller",n),this.shapeSettings.setApi(t).on("eyedropper",i.bind(o,this)).on("updatescroller",n),this.textartSettings.setApi(t).on("eyedropper",i.bind(o,this)).on("updatescroller",n),this.tableSettings.setApi(t),this.pivotSettings.setApi(t),this.cellSettings.setApi(t).on("eyedropper",i.bind(o,this)),this.slicerSettings.setApi(t),this.signatureSettings&&this.signatureSettings.setApi(t),this},setMode:function(t){return this.mode=t,this.imageSettings&&this.imageSettings.setMode(t),this.shapeSettings&&this.shapeSettings.setMode(t),this.tableSettings&&this.tableSettings.setMode(t),this},onBtnMenuClick:function(t,i){var o,n=t&&"plugin"===t.options.type,s=e(this.el).find(".right-panel");t&&!n&&(o=e("#"+this._settings[t.options.asctype].panel)),t&&t.pressed?(this.minimizedMode&&(e(this.el).width(MENU_SCALE_PART),s.css("display","inline-block"),this.minimizedMode=!1,Common.localStorage.setItem("sse-hide-right-settings",0),Common.Utils.InternalSettings.set("sse-hide-right-settings",!1)),s.find(".settings-panel.active").removeClass("active"),o&&o.addClass("active"),this.scroller&&this.scroller.scrollTop(0)):(s.css("display","none"),e(this.el).width(SCALE_MIN),this.minimizedMode=!0,Common.localStorage.setItem("sse-hide-right-settings",1),Common.Utils.InternalSettings.set("sse-hide-right-settings",!0)),!n&&e(".right-panel .plugin-panel").toggleClass("active",!1),t&&!n&&this.fireEvent("rightmenuclick",[this,t.options.asctype,this.minimizedMode,i])},SetActivePane:function(t,i){if(!(this.minimizedMode&&!0!==i||void 0===this._settings[t]))if(this.minimizedMode)this._settings[t].btn.toggle(!0,!1),this._settings[t].btn.trigger("click",this._settings[t].btn);else{var o=e("#"+this._settings[t].panel);o.hasClass("active")||(o.parent().find(".settings-panel.active").removeClass("active"),o.addClass("active"),this.scroller&&(this.scroller.update(),this.scroller.scrollTop(0))),this._settings[t].btn.isActive()||this._settings[t].btn.toggle(!0,!1)}},GetActivePane:function(){var t=this.$el.find(".settings-panel.active");return this.minimizedMode||0===t.length?null:t[0].id},clearSelection:function(){var t=e(".right-panel");t.find(".settings-panel.active").removeClass("active"),this._settings.forEach((function(t){t.btn.isActive()&&t.btn.toggle(!1,!0)})),t.css("display","none"),e(this.el).width(SCALE_MIN),this.minimizedMode=!0,Common.NotificationCenter.trigger("layout:changed","rightmenu")},updateScroller:function(){this.scroller&&(this.scroller.update(),this.scroller.scrollTop(0))},setButtons:function(){var t=[this.btnCell,this.btnTable,this.btnShape,this.btnImage,this.btnChart,this.btnText,this.btnTextArt,this.btnSlicer,this.btnSignature,this.btnPivot];Common.UI.SideMenu.prototype.setButtons.apply(this,[t])},updateWidth:function(){var t=e(this.el).find(".right-panel"),i=parseInt(t.css("padding-left"))+parseInt(t.css("padding-right"));t.css("width",MENU_BASE_WIDTH+i+"px"),MENU_SCALE_PART=SCALE_MIN+MENU_BASE_WIDTH+i,this.$el.css("width",(Common.Utils.InternalSettings.get("sse-hide-right-settings")?SCALE_MIN:MENU_SCALE_PART)+"px")},txtParagraphSettings:"Paragraph Settings",txtImageSettings:"Image Settings",txtShapeSettings:"Shape Settings",txtTextArtSettings:"Text Art Settings",txtChartSettings:"Chart Settings",txtSparklineSettings:"Sparkline Settings",txtTableSettings:"Table Settings",txtPivotSettings:"Pivot Table Settings",txtSignatureSettings:"Signature Settings",txtCellSettings:"Cell Settings",txtSlicerSettings:"Slicer Settings",ariaRightMenu:"Right menu"},SSE.Views.RightMenu||{}))})),define("spreadsheeteditor/main/app/controller/RightMenu",["core","spreadsheeteditor/main/app/view/RightMenu"],(function(){"use strict";SSE.Controllers.RightMenu=Backbone.Controller.extend({models:[],collections:[],views:["RightMenu"],initialize:function(){this.editMode=!0,this._state={wsLock:!1,wsProps:[],inPivot:!1},this.addListeners({Toolbar:{insertimage:this.onInsertImage.bind(this),insertshape:this.onInsertShape.bind(this),insertchart:this.onInsertChart.bind(this),inserttextart:this.onInsertTextArt.bind(this),inserttable:this.onInsertTable.bind(this)},RightMenu:{rightmenuclick:this.onRightMenuClick,"button:click":_.bind(this.onBtnCategoryClick,this)},PivotTable:{insertpivot:this.onInsertPivot},ViewTab:{"rightmenu:hide":this.onRightMenuHide.bind(this)},"Common.Views.Plugins":{"plugins:addtoright":_.bind(this.addNewPlugin,this),"pluginsright:open":_.bind(this.openPlugin,this),"pluginsright:close":_.bind(this.closePlugin,this),"pluginsright:hide":_.bind(this.onHidePlugins,this),"pluginsright:updateicons":_.bind(this.updatePluginButtonsIcons,this)}}),Common.Utils.InternalSettings.set("sse-rightpanel-active-table",1),Common.Utils.InternalSettings.set("sse-rightpanel-active-pivot",1),Common.Utils.InternalSettings.set("sse-rightpanel-active-spark",1)},onLaunch:function(){this.rightmenu=this.createView("RightMenu"),this.rightmenu.on("render:after",_.bind(this.onRightMenuAfterRender,this))},onRightMenuAfterRender:function(t){t.imageSettings.application=t.shapeSettings.application=t.textartSettings.application=this.getApplication(),this._settings=[],this._settings[Common.Utils.documentSettingsType.Paragraph]={panelId:"id-paragraph-settings",panel:t.paragraphSettings,btn:t.btnText,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Image]={panelId:"id-image-settings",panel:t.imageSettings,btn:t.btnImage,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Shape]={panelId:"id-shape-settings",panel:t.shapeSettings,btn:t.btnShape,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.TextArt]={panelId:"id-textart-settings",panel:t.textartSettings,btn:t.btnTextArt,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Chart]={panelId:"id-chart-settings",panel:t.chartSettings,btn:t.btnChart,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Table]={panelId:"id-table-settings",panel:t.tableSettings,btn:t.btnTable,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Pivot]={panelId:"id-pivot-settings",panel:t.pivotSettings,btn:t.btnPivot,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Signature]={panelId:"id-signature-settings",panel:t.signatureSettings,btn:t.btnSignature,hidden:1,props:{},locked:!1},this._settings[Common.Utils.documentSettingsType.Cell]={panelId:"id-cell-settings",panel:t.cellSettings,btn:t.btnCell,hidden:1,locked:!1},this._settings[Common.Utils.documentSettingsType.Slicer]={panelId:"id-slicer-settings",panel:t.slicerSettings,btn:t.btnSlicer,hidden:1,locked:!1}},setApi:function(t){this.api=t,this.api.asc_registerCallback("asc_onUpdateSignatures",_.bind(this.onApiUpdateSignatures,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("cells:range",_.bind(this.onCellsRange,this)),Common.NotificationCenter.on("protect:wslock",_.bind(this.onChangeProtectSheet,this))},setMode:function(t){this.editMode=t.isEdit},onRightMenuClick:function(t,e,i,o){if(!i&&this.editMode){o&&(e==Common.Utils.documentSettingsType.Table?(Common.Utils.InternalSettings.set("sse-rightpanel-active-table",2),this._settings[Common.Utils.documentSettingsType.Chart].hidden||Common.Utils.InternalSettings.set("sse-rightpanel-active-spark",Math.min(Common.Utils.InternalSettings.get("sse-rightpanel-active-spark"),1))):e==Common.Utils.documentSettingsType.Pivot?Common.Utils.InternalSettings.set("sse-rightpanel-active-pivot",1):e!=Common.Utils.documentSettingsType.Chart||this._settings[Common.Utils.documentSettingsType.Cell].hidden?Common.Utils.documentSettingsType.Cell&&(this._settings[Common.Utils.documentSettingsType.Table].hidden||Common.Utils.InternalSettings.set("sse-rightpanel-active-table",0),this._settings[Common.Utils.documentSettingsType.Pivot].hidden||Common.Utils.InternalSettings.set("sse-rightpanel-active-pivot",0),this._settings[Common.Utils.documentSettingsType.Chart].hidden||Common.Utils.InternalSettings.set("sse-rightpanel-active-spark",0)):(Common.Utils.InternalSettings.set("sse-rightpanel-active-spark",2),this._settings[Common.Utils.documentSettingsType.Table].hidden||Common.Utils.InternalSettings.set("sse-rightpanel-active-table",Math.min(Common.Utils.InternalSettings.get("sse-rightpanel-active-table"),1))));var n=this._settings[e].panel,s=this._settings[e].props;s&&n&&(n.ChangeSettings.call(n,e==Common.Utils.documentSettingsType.Signature?void 0:s,this._state.wsLock,this._state.wsProps),this.rightmenu.updateScroller())}Common.NotificationCenter.trigger("layout:changed","rightmenu"),Common.NotificationCenter.trigger("edit:complete",this.rightmenu)},onSelectionChanged:function(t){if(!this.rangeSelectionMode&&t){var e=[],i=t.asc_getSelectionType(),o=t.asc_getFormatTableInfo(),n=t.asc_getSparklineInfo(),s=t,a=t.asc_getPivotTableInfo();i!=Asc.c_oAscSelectionType.RangeImage&&i!=Asc.c_oAscSelectionType.RangeShape&&i!=Asc.c_oAscSelectionType.RangeSlicer&&i!=Asc.c_oAscSelectionType.RangeChart&&i!=Asc.c_oAscSelectionType.RangeChartText&&i!=Asc.c_oAscSelectionType.RangeShapeText||(e=this.api.asc_getGraphicObjectProps()),!(e.length<=0)||s||o||n||a||this.rightmenu.minimizedMode||"id-signature-settings"===this.rightmenu.GetActivePane()||(this.rightmenu.clearSelection(),this._openRightMenu=!0),this.onFocusObject(e,s,o,n,a)}},onFocusObject:function(t,e,i,o,n,s){if(this.editMode||s){for(var a=e&&e.asc_getLocked()||this._state.wsProps.FormatCells,r=e&&!0===e.asc_getLockedTable()||!this.rightmenu.mode.canModifyFilter||this._state.wsProps.FormatCells,l=e&&!0===e.asc_getLockedSparkline()||this._state.wsLock,c=e&&!0===e.asc_getLockedPivotTable()||this._state.wsProps.PivotTables,h=e&&!0===e.asc_getUserProtected(),d=0;d<this._settings.length;++d)d!=Common.Utils.documentSettingsType.Signature&&this._settings[d]&&(this._settings[d].hidden=1,this._settings[d].locked=!1);this._settings[Common.Utils.documentSettingsType.Signature].locked=!1;var m=!1;for(d=0;d<t.length;++d){var p=t[d].asc_getObjectType(),u=this.getDocumentSettingsType(p);if(!(void 0===u||u>=this._settings.length||void 0===this._settings[u])){var g=t[d].asc_getObjectValue();u==Common.Utils.documentSettingsType.Image?(m=m||g.asc_getProtectionLockText(),null!==g.asc_getChartProperties()?(u=Common.Utils.documentSettingsType.Chart,this._settings[u].btn.updateHint(this.rightmenu.txtChartSettings)):null!==g.asc_getShapeProperties()?(u=Common.Utils.documentSettingsType.Shape,g.asc_getShapeProperties().asc_getTextArtProperties()&&(this._settings[Common.Utils.documentSettingsType.TextArt].props=g,this._settings[Common.Utils.documentSettingsType.TextArt].hidden=0,this._settings[Common.Utils.documentSettingsType.TextArt].locked=g.asc_getLocked()||this._state.wsProps.Objects&&g.asc_getProtectionLockText())):null!==g.asc_getSlicerProperties()&&(u=Common.Utils.documentSettingsType.Slicer),this._settings[u].locked=g.asc_getLocked()||this._state.wsProps.Objects&&g.asc_getProtectionLocked()):this._settings[u].locked=g.asc_getLocked(),this._settings[u].props=g,this._settings[u].hidden=0,this._settings[Common.Utils.documentSettingsType.Signature].locked||(this._settings[Common.Utils.documentSettingsType.Signature].locked=g.asc_getLocked()),this._settings[Common.Utils.documentSettingsType.Paragraph].locked||(this._settings[Common.Utils.documentSettingsType.Paragraph].locked=this._state.wsProps.Objects&&m)}}i&&(u=Common.Utils.documentSettingsType.Table,this._settings[u].props=i,this._settings[u].locked=r,this._settings[u].hidden=0),o&&(u=Common.Utils.documentSettingsType.Chart,this._settings[u].props=o,this._settings[u].locked=l,this._settings[u].hidden=0,this._settings[u].btn.updateHint(this.rightmenu.txtSparklineSettings)),this.rightmenu.mode.canFeaturePivot&&(u=Common.Utils.documentSettingsType.Pivot,n&&(this._settings[u].props=n,this._settings[u].locked=c,this._settings[u].hidden=0),this._state.inPivot!==!this._settings[u].hidden&&(this.rightmenu.clearMoreButton(),this.rightmenu.btnPivot.setVisible(!this._settings[u].hidden),this.rightmenu.setButtons(),this.rightmenu.setMoreButton(),this._state.inPivot=!this._settings[u].hidden)),t.length<=0&&e&&(u=Common.Utils.documentSettingsType.Cell,this._settings[u].props=e,this._settings[u].locked=a||h,this._settings[u].hidden=0);var f,b=-1,C=-1,v=this.rightmenu.GetActivePane();for(d=0;d<this._settings.length;++d){void 0!==(w=this._settings[d])&&void 0!==w.btn&&void 0!==w.panel&&(w.hidden?(w.btn.isDisabled()||(w.btn.setDisabled(!0),this.rightmenu.setDisabledMoreMenuItem(w.btn,!0)),v==w.panelId&&(f=-1)):(w.btn.isDisabled()&&(w.btn.setDisabled(!1),this.rightmenu.setDisabledMoreMenuItem(w.btn,!1)),d!=Common.Utils.documentSettingsType.Signature&&(b=d),w.needShow?(w.needShow=!1,C=d):v==w.panelId&&(f=d),w.panel.setLocked(w.locked)))}if(!this.rightmenu.minimizedMode||this._openRightMenu){var _,w;if(C<0&&void 0!==this._lastVisibleSettings)void 0===(w=this._settings[this._lastVisibleSettings])||void 0===w.btn||void 0===w.panel||w.hidden||(C=this._lastVisibleSettings);if(C<0&&!this._settings[Common.Utils.documentSettingsType.Cell].hidden&&(!this._settings[Common.Utils.documentSettingsType.Table].hidden||!this._settings[Common.Utils.documentSettingsType.Pivot].hidden||!this._settings[Common.Utils.documentSettingsType.Chart].hidden)){var A=Common.Utils.InternalSettings.get("sse-rightpanel-active-table"),y=Common.Utils.InternalSettings.get("sse-rightpanel-active-pivot"),S=Common.Utils.InternalSettings.get("sse-rightpanel-active-spark");this._settings[Common.Utils.documentSettingsType.Table].hidden||this._settings[Common.Utils.documentSettingsType.Chart].hidden?this._settings[Common.Utils.documentSettingsType.Table].hidden?this._settings[Common.Utils.documentSettingsType.Chart].hidden||(C=0===S?Common.Utils.documentSettingsType.Cell:Common.Utils.documentSettingsType.Chart):C=0===A?Common.Utils.documentSettingsType.Cell:Common.Utils.documentSettingsType.Table:C=A==S?0===A?Common.Utils.documentSettingsType.Cell:Common.Utils.documentSettingsType.Chart:A>S?Common.Utils.documentSettingsType.Table:Common.Utils.documentSettingsType.Chart,this._settings[Common.Utils.documentSettingsType.Pivot].hidden||(C=0===y?Common.Utils.documentSettingsType.Cell:Common.Utils.documentSettingsType.Pivot)}C>-1?_=C:b>=0&&f<0?_=b:f>=0?_=f:s&&!this._settings[Common.Utils.documentSettingsType.Signature].hidden&&(_=Common.Utils.documentSettingsType.Signature),null==_&&this._openRightMenu&&b>=0&&(_=b),void 0!==_&&(this.rightmenu.SetActivePane(_,this._openRightMenu),_!=Common.Utils.documentSettingsType.Signature?this._settings[_].panel.ChangeSettings.call(this._settings[_].panel,this._settings[_].props,this._state.wsLock,this._state.wsProps):this._settings[_].panel.ChangeSettings.call(this._settings[_].panel),this._openRightMenu=!1,_!==f&&this.rightmenu.updateScroller())}this._settings[Common.Utils.documentSettingsType.Image].needShow=!1,this._settings[Common.Utils.documentSettingsType.Chart].needShow=!1,this._settings[Common.Utils.documentSettingsType.Table].needShow=!1,n&&(this._settings[Common.Utils.documentSettingsType.Pivot].needShow=!1)}},onCoAuthoringDisconnect:function(){this.SetDisabled(!0),this.setMode({isEdit:!1})},onInsertImage:function(){this._settings[Common.Utils.documentSettingsType.Image].needShow=!0},onInsertChart:function(){this._settings[Common.Utils.documentSettingsType.Chart].needShow=!0},onInsertShape:function(){this._settings[Common.Utils.documentSettingsType.Shape].needShow=!0},onInsertTextArt:function(){this._settings[Common.Utils.documentSettingsType.TextArt].needShow=!0},onInsertTable:function(){},onInsertPivot:function(){this._settings[Common.Utils.documentSettingsType.Pivot].needShow=!0,Common.Utils.InternalSettings.set("sse-rightpanel-active-pivot",1),this._openRightMenu=!0},UpdateThemeColors:function(){this.rightmenu.shapeSettings.UpdateThemeColors(),this.rightmenu.textartSettings.UpdateThemeColors(),this.rightmenu.chartSettings.UpdateThemeColors(),this.rightmenu.cellSettings.UpdateThemeColors()},updateMetricUnit:function(){this.rightmenu.paragraphSettings.updateMetricUnit(),this.rightmenu.chartSettings.updateMetricUnit(),this.rightmenu.imageSettings.updateMetricUnit(),this.rightmenu.slicerSettings.updateMetricUnit()},createDelayedElements:function(){this.api&&(this._openRightMenu=!Common.localStorage.getBool("sse-hide-right-settings",this.rightmenu.defaultHideRightMenu),Common.Utils.InternalSettings.set("sse-hide-right-settings",!this._openRightMenu),this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onSelectionChanged,this)),this.api.asc_registerCallback("asc_doubleClickOnObject",_.bind(this.onDoubleClickOnObject,this)),this.onChangeProtectSheet()),this.rightmenu.setButtons(),this.rightmenu.setMoreButton()},onDoubleClickOnObject:function(t){if(this.editMode){var e=t.asc_getObjectType(),i=this.getDocumentSettingsType(e);if(!(void 0===i||i>=this._settings.length||void 0===this._settings[i])){var o=t.asc_getObjectValue();i==Common.Utils.documentSettingsType.Image&&(null!==o.asc_getChartProperties()?i=Common.Utils.documentSettingsType.Chart:null!==o.asc_getShapeProperties()&&(i=Common.Utils.documentSettingsType.Shape)),i!==Common.Utils.documentSettingsType.Paragraph&&(this.rightmenu.SetActivePane(i,!0),this._settings[i].panel.ChangeSettings.call(this._settings[i].panel,this._settings[i].props,this._state.wsLock,this._state.wsProps),this.rightmenu.updateScroller())}}},getDocumentSettingsType:function(t){switch(t){case Asc.c_oAscTypeSelectElement.Paragraph:return Common.Utils.documentSettingsType.Paragraph;case Asc.c_oAscTypeSelectElement.Image:return Common.Utils.documentSettingsType.Image}},onApiUpdateSignatures:function(t,e){if(this.rightmenu.signatureSettings){var i=(!t||t.length<1)&&(!e||e.length<1),o=Common.Utils.documentSettingsType.Signature;this._settings[o].hidden=i?1:0,this._settings[o].btn.setDisabled(i),this.rightmenu.setDisabledMoreMenuItem(this._settings[o].btn,i),this._settings[o].panel.setLocked(this._settings[o].locked)}},SetDisabled:function(t,e){this.setMode({isEdit:!t}),this.rightmenu&&this.rightmenu.paragraphSettings&&(this.rightmenu.paragraphSettings.disableControls(t),this.rightmenu.shapeSettings.disableControls(t),this.rightmenu.imageSettings.disableControls(t),this.rightmenu.chartSettings.disableControls(t),this.rightmenu.tableSettings.disableControls(t),this.rightmenu.pivotSettings.disableControls(t),this.rightmenu.cellSettings.disableControls(t),this.rightmenu.slicerSettings.disableControls(t),this.rightmenu.signatureSettings&&(!e&&this.rightmenu.btnSignature.setDisabled(t),e&&t&&this.onFocusObject([],void 0,void 0,void 0,void 0,!0)),t?(this.rightmenu.btnText.setDisabled(t),this.rightmenu.btnTable.setDisabled(t),this.rightmenu.btnImage.setDisabled(t),this.rightmenu.btnShape.setDisabled(t),this.rightmenu.btnTextArt.setDisabled(t),this.rightmenu.btnChart.setDisabled(t),this.rightmenu.btnPivot.setDisabled(t),this.rightmenu.btnCell.setDisabled(t),this.rightmenu.btnSlicer.setDisabled(t),this.rightmenu.setDisabledAllMoreMenuItems(t)):this.onSelectionChanged(this.api.asc_getCellInfo()))},onCellsRange:function(t){this.rangeSelectionMode=t!=Asc.c_oAscSelectionDialogType.None},onChangeProtectSheet:function(t){if(!t){var e=this.getApplication().getController("WBProtection");t=e?e.getWSProps():null}t&&(this._state.wsProps=t.wsProps,this._state.wsLock=t.wsLock),this.onSelectionChanged(this.api.asc_getCellInfo())},onRightMenuHide:function(t,e){if(this.rightmenu){if(e)this.rightmenu.show(),this._openRightMenu=!Common.Utils.InternalSettings.get("sse-hide-right-settings"),this.onSelectionChanged(this.api.asc_getCellInfo()),this._lastVisibleSettings=void 0;else{var i,o=this.rightmenu.GetActivePane();if(o){for(var n=0;n<this._settings.length;n++)if(this._settings[n]&&this._settings[n].panelId===o){i=n;break}this._lastVisibleSettings=i}this.rightmenu.clearSelection(),this.rightmenu.hide(),this.rightmenu.signatureSettings&&this.rightmenu.signatureSettings.hideSignatureTooltip()}!t&&this.rightmenu.fireEvent("view:hide",[this,!e]),Common.localStorage.setBool("sse-hidden-rightmenu",!e)}Common.NotificationCenter.trigger("layout:changed","main"),Common.NotificationCenter.trigger("edit:complete",this.rightmenu)},onRightMenuOpen:function(t){void 0===this._settings[t]||this._settings[t].hidden||this._settings[t].btn.isDisabled()||this._settings[t].panelId===this.rightmenu.GetActivePane()||(this.tryToShowRightMenu(),this.rightmenu.SetActivePane(t,!0),this._settings[t].panel.ChangeSettings.call(this._settings[t].panel,this._settings[t].props),this.rightmenu.updateScroller())},tryToShowRightMenu:function(){!this.rightmenu||!this.rightmenu.mode||this.rightmenu.mode.canBrandingExt&&this.rightmenu.mode.customization&&!1===this.rightmenu.mode.customization.rightMenu||!Common.UI.LayoutManager.isElementVisible("rightMenu")||this.onRightMenuHide(null,!0)},addNewPlugin:function(t,e,i){this.rightmenu.insertButton(t,e),this.rightmenu.insertPanel(i)},openPlugin:function(t){this.rightmenu.openPlugin(t)},closePlugin:function(t){this.rightmenu.closePlugin(t),this.rightmenu.onBtnMenuClick(),Common.NotificationCenter.trigger("layout:changed","rightmenu"),this.rightmenu.fireEvent("editcomplete",this.rightmenu)},onHidePlugins:function(){Common.NotificationCenter.trigger("layout:changed","rightmenu")},updatePluginButtonsIcons:function(t){this.rightmenu.updatePluginButtonsIcons(t)},onBtnCategoryClick:function(t){"plugin"!==t.options.type||t.isDisabled()||(this.rightmenu.onBtnMenuClick(t),t.pressed?this.rightmenu.fireEvent("plugins:showpanel",[t.options.value]):this.rightmenu.fireEvent("plugins:hidepanel",[t.options.value]),Common.NotificationCenter.trigger("layout:changed","rightmenu"),this.rightmenu.fireEvent("editcomplete",this.rightmenu))}})})),define("text!spreadsheeteditor/main/app/template/LeftMenu.template",[],(function(){return'<div id="view-left-menu" class="tool-menu left">\r\n    <div class="tool-menu-btns" role="menubar" aria-orientation="vertical" aria-label="<%= scope.ariaLeftMenu %>">\r\n        <button id="left-btn-searchbar" class="btn btn-category" data-hint="0" data-hint-direction="right" data-hint-offset="big" content-target="left-panel-search"><i class="icon toolbar__icon btn-menu-search">&nbsp;</i></button>\r\n        \x3c!-- /** coauthoring begin **/ --\x3e\r\n        <button id="left-btn-comments" class="btn btn-category" content-target="left-panel-comments" data-hint="0" data-hint-direction="right" data-hint-offset="big"><i class="icon toolbar__icon btn-menu-comments">&nbsp;</i></button>\r\n        <button id="left-btn-chat" class="btn btn-category" content-target="left-panel-chat" data-hint="0" data-hint-direction="right" data-hint-offset="big"><i class="icon toolbar__icon btn-menu-chat">&nbsp;</i></button>\r\n        \x3c!-- /** coauthoring end **/ --\x3e\r\n        <button id="left-btn-spellcheck" class="btn btn-category" content-target="left-panel-spellcheck" data-hint="0" data-hint-direction="right" data-hint-offset="big" data-layout-name="leftMenu-spellcheck"><i class="icon toolbar__icon btn-ic-docspell">&nbsp;</i></button>\r\n        <button id="left-btn-support" class="btn btn-category" content-target="" data-hint="0" data-hint-direction="right" data-hint-offset="big"><i class="icon toolbar__icon btn-menu-support">&nbsp;</i></button>\r\n        <button id="left-btn-about" class="btn btn-category" content-target="" data-hint="0" data-hint-direction="right" data-hint-offset="big"><i class="icon toolbar__icon btn-menu-about">&nbsp;</i></button>\r\n        <div class="separator horizontal separator-plugins" style="display: none;"></div>\r\n        <div id="slot-left-menu-more"></div>\r\n    </div>\r\n    <div class="left-panel side-panel" style="">\r\n        <div id="left-panel-search" class="content-box" style="display: none;"></div>\r\n        \x3c!-- /** coauthoring begin **/ --\x3e\r\n        <div id="left-panel-comments"class="content-box" style="display: none;"></div>\r\n        <div id="left-panel-chat" class="content-box" style="display: none;"></div>\r\n        <div id="left-panel-spellcheck" class="content-box" style="display: none; height: 100%;"></div>\r\n        \x3c!-- /** coauthoring end **/ --\x3e\r\n    </div>\r\n</div>'})),define("common/main/lib/view/About",["common/main/lib/component/BaseView","common/main/lib/component/Scroller"],(function(){"use strict";Common.Views.About=Common.UI.BaseView.extend(_.extend({menu:void 0,rendered:!1,options:{alias:"Common.Views.About"},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.txtVersionNum="9.0.57.1",!/\s$/.test(this.txtAddress)&&(this.txtAddress+=" "),!/\s$/.test(this.txtMail)&&(this.txtMail+=" "),!/\s$/.test(this.txtTel)&&(this.txtTel+=" "),!/\s$/.test(this.txtVersion)&&(this.txtVersion+=" "),this.template=_.template(['<table id="id-about-licensor-logo" cols="1" style="width: 100%; margin-top: 20px;">',"<tr>",'<td align="center"><div class="asc-about-office"></div></td>',"</tr>","<tr>",'<td align="center"><label class="asc-about-version">'+t.appName.toUpperCase()+"</label></td>","</tr>","<tr>",'<td align="center"><label class="asc-about-version" id="id-about-licensor-version-name">'+this.txtVersion+this.txtVersionNum+"</label></td>","</tr>","</table>",'<table id="id-about-licensor-info" cols="3" style="width: 100%;" class="margin-bottom">',"<tr>",'<td colspan="3" align="center" style="padding: 20px 0 10px 0;"><label class="asc-about-companyname"><%= publishername %></label></td>',"</tr>","<tr>",'<td colspan="3" align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtAddress+"</label>",'<label class="asc-about-desc"><%= publisheraddr %></label>',"</td>","</tr>","<tr>",'<td colspan="3" align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtMail+"</label>",'<a href="mailto:<%= supportemail %>"><%= supportemail %></a>',"</td>","</tr>","<tr>",'<td colspan="3" align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtTel+"</label>",'<label class="asc-about-desc" dir="ltr"><%= phonenum %></label>',"</td>","</tr>","<tr>",'<td colspan="3" align="center">','<a href="<%= publisherurl %>" target="_blank"><% print(publisherurl.replace(/https?:\\/{2}/, "").replace(/\\/$/,"")) %></a>',"</td>","</tr>","</table>",'<table id="id-about-licensee-info" cols="1" style="width: 100%; margin-top: 20px;" class="hidden margin-bottom"><tbody>',"<tr>",'<td align="center" class="padding-small"><div id="id-about-company-logo"></div></td>',"</tr>","<tr>",'<td align="center"><label class="asc-about-version">'+t.appName.toUpperCase()+"</label></td>","</tr>","<tr>",'<td align="center"><label style="padding-bottom: 29px;" class="asc-about-version" id="id-about-licensee-version-name">'+this.txtVersion+this.txtVersionNum+"</label></td>","</tr>","<tr>",'<td align="center" class="padding-small">','<label class="asc-about-companyname" id="id-about-company-name"></label>',"</td>","</tr>","<tr>",'<td align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtAddress+"</label>",'<label class="asc-about-desc" id="id-about-company-address"></label>',"</td>","</tr>","<tr>",'<td align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtMail+"</label>",'<a href="mailto:" id="id-about-company-mail"></a>',"</td>","</tr>","<tr>",'<td align="center" class="padding-small">','<label class="asc-about-desc-name">'+this.txtTel+"</label>",'<label class="asc-about-desc" id="id-about-company-tel"></label>',"</td>","</tr>","<tr>",'<td align="center" class="padding-small">','<a href="" target="_blank" id="id-about-company-url"></a>',"</td>","</tr>","<tr>",'<td align="center">','<label class="asc-about-lic" id="id-about-company-lic"></label>',"</td>","</tr>","</table>",'<table id="id-about-licensor-short" cols="1" style="width: 100%; margin-top: 31px;" class="hidden"><tbody>',"<tr>",'<td style="width:50%;"><div class="separator horizontal short left"></div></td>','<td align="center"><label class="asc-about-header">'+this.txtPoweredBy+"</label></td>",'<td style="width:50%;"><div class="separator horizontal short"></div></td>',"</tr>","<tr>",'<td colspan="3" align="center" style="padding: 9px 0 10px;"><label class="asc-about-companyname"><%= publishername %></label></td>',"</tr>","<tr>",'<td colspan="3" align="center">','<a href="<%= publisherurl %>" target="_blank"><% print(publisherurl.replace(/https?:\\/{2}/, "").replace(/\\/$/,"")) %></a>',"</td>","</tr>","</table>"].join("")),this.menu=t.menu},render:function(){if(!this.rendered){this.rendered=!0;var t=$(this.template({publishername:"Ascensio System SIA",publisheraddr:"20A-12 Ernesta Birznieka-Upisha street, Riga, Latvia, EU, LV-1050",publisherurl:"https://www.onlyoffice.com",supportemail:"1639670695@qq.com",phonenum:"+371 633-99867",scope:this}));this.cntLicenseeInfo=t.findById("#id-about-licensee-info"),this.cntLicensorInfo=t.findById("#id-about-licensor-info"),this.divCompanyLogo=t.findById("#id-about-company-logo"),this.lblCompanyName=t.findById("#id-about-company-name"),this.lblCompanyAddress=t.findById("#id-about-company-address"),this.lblCompanyMail=t.findById("#id-about-company-mail"),this.lblCompanyUrl=t.findById("#id-about-company-url"),this.lblCompanyLic=t.findById("#id-about-company-lic"),this.lblCompanyTel=t.findById("#id-about-company-tel"),this.$el.html(t),this.$el.addClass("about-dlg"),this.licData&&this.setLicInfo(this.licData),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0}))}return this},setLicInfo:function(t){if(this.rendered)if(t&&"object"==_typeof(t)&&t.customer&&"object"==_typeof(t.customer)){this.licData=t;var e=t.customer;$("#id-about-licensor-logo").addClass("hidden"),$("#id-about-licensor-short").removeClass("hidden"),this.cntLicensorInfo.addClass("hidden"),this.cntLicenseeInfo.removeClass("hidden"),this.cntLicensorInfo.removeClass("margin-bottom");var i=e.name;if(i&&i.length?this.lblCompanyName.text(i):this.lblCompanyName.parents("tr").addClass("hidden"),(i=e.address)&&i.length?this.lblCompanyAddress.text(i):this.lblCompanyAddress.parents("tr").addClass("hidden"),(i=e.mail)&&i.length?this.lblCompanyMail.attr("href","mailto:"+i).text(i):this.lblCompanyMail.parents("tr").addClass("hidden"),(i=e.phone)&&i.length?this.lblCompanyTel.text(i):this.lblCompanyTel.parents("tr").addClass("hidden"),(i=e.www)&&i.length){var o=/^https?:\/{2}/i.test(i)?"":"http://";this.lblCompanyUrl.attr("href",o+i).text(i)}else this.lblCompanyUrl.parents("tr").addClass("hidden");(i=e.info)&&i.length?this.lblCompanyLic.text(i):this.lblCompanyLic.parents("tr").addClass("hidden"),(i=Common.UI.Themes.isDarkTheme()?e.logoDark||e.logo:e.logo||e.logoDark)&&i.length?this.divCompanyLogo.html('<img src="'+i+'" style="max-width:216px; max-height: 35px;" />'):this.divCompanyLogo.parents("tr").addClass("hidden"),i&&i.length&&Common.NotificationCenter.on("uitheme:changed",this.changeLogo.bind(this))}else this.cntLicenseeInfo.addClass("hidden"),this.cntLicensorInfo.addClass("margin-bottom");else this.licData=t||!0},changeLogo:function(){if(this.licData){var t=this.licData.customer;t.logo&&t.logoDark&&t.logo!==t.logoDark&&this.divCompanyLogo.find("img").attr("src",Common.UI.Themes.isDarkTheme()?t.logoDark||t.logo:t.logo||t.logoDark)}},show:function(){this.rendered||this.render(),Common.UI.BaseView.prototype.show.call(this,arguments),this.fireEvent("show",this)},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.fireEvent("hide",this)},setMode:function(t){t.isLightVersion&&($("#id-about-licensor-version-name").text(this.txtEdition+this.txtVersion+this.txtVersionNum),$("#id-about-licensee-version-name").text(this.txtEdition+this.txtVersion+this.txtVersionNum))},txtPoweredBy:"Powered by",txtVersion:"Version ",txtLicensor:"LICENSOR",txtLicensee:"LICENSEE",txtAddress:"address: ",txtMail:"email: ",txtTel:"tel.: ",txtEdition:"Integration Edition "},Common.Views.About||{}))})),define("text!common/main/lib/template/Comments.template",[],(function(){return'<% if (!hide && !filtered) { %>\r\n    <div id="<%= id %>" class="user-comment-item">\r\n\r\n        \x3c!-- comment block --\x3e\r\n\r\n        <div class="user-info">\r\n            <div class="color"\r\n                <% if (avatar) { %>\r\n                    style="background-image: url(<%=avatar%>); <% if (usercolor!==null) { %> border-color:<%=usercolor%>; border-style:solid;<% }%>" \r\n                <% } else { %>\r\n                    style="background-color: <% if (usercolor!==null) { %> <%=usercolor%> <% } else { %> #cfcfcf <% }%>;" \r\n                <% } %>\r\n            ><% if (!avatar) { %><%-initials%><% } %></div>\r\n            <div class="user-info-text">\r\n                <div class="user-name"><%= scope.getEncodedName(parsedName) %></div>\r\n                <% if (date!==null) { %>\r\n                    <div class="user-date"><%=date%></div>\r\n                <% } %>\r\n            </div>\r\n        </div>\r\n        <% if (quote!==null && quote!==\'\') { %>\r\n        <div class="user-quote"><%=scope.getFixedQuote(quote)%></div>\r\n        <% } %>\r\n        <% if (!editText || scope.viewmode) { %>\r\n            <div oo_editor_input="true" tabindex="-1" class="user-message user-select"><%=scope.pickLink(comment)%></div>\r\n        <% } else { %>\r\n            <div class="inner-edit-ct">\r\n                <textarea class="msg-reply user-select textarea-control" maxlength="maxCommLength" aria-label="textComment"><%=comment%></textarea>\r\n                <button class="btn normal dlg-btn primary btn-inner-edit" id="id-comments-change">textEdit</button>\r\n                <button class="btn normal dlg-btn btn-inner-close">textCancel</button>\r\n            </div>\r\n        <% } %>\r\n\r\n        \x3c!-- replys elements --\x3e\r\n\r\n        <% var add_arrow = true; %>\r\n        <% if (replys.length) { %>\r\n            <% _.each(replys, function (item, index) { %>\r\n                <% if (!item.get("hide")) { %>\r\n                <% if (add_arrow) { add_arrow = false; %>\r\n                    <div class="reply-arrow img-commonctrl"></div>\r\n                <% } %>\r\n                <div class="reply-item-ct" <% if (scope.viewmode && index==replys.length-1) { %>style="padding-bottom: 0;" <% } %>>\r\n                    <div class="user-info">\r\n                        <div class="color"\r\n                            <% if (item.get("avatar")) { %>\r\n                                style="background-image: url(<%=item.get(\'avatar\')%>); <% if (item.get(\'usercolor\')!==null) { %> border-color:<%=item.get(\'usercolor\')%>; border-style:solid;<% }%>" \r\n                            <% } else { %>\r\n                                style="background-color: <% if (item.get(\'usercolor\')!==null) { %> <%=item.get(\'usercolor\')%> <% } else { %> #cfcfcf <% }%>;" \r\n                            <% } %>\r\n                        ><% if (!item.get("avatar")) { %><%-item.get("initials")%><% } %></div>\r\n                        <div class="user-info-text">\r\n                            <div class="user-name"><%= scope.getEncodedName(item.get("parsedName")) %></div>\r\n                            <div class="user-date"><%=item.get("date")%></div>\r\n                        </div>\r\n                    </div>\r\n                    <% if (!item.get("editText")) { %>\r\n                        <div oo_editor_input="true" tabindex="-1" class="user-message user-select"><%=scope.pickLink(item.get("reply"))%></div>\r\n                        <% if (!scope.viewmode) { %>\r\n                            <div class="btns-reply-ct">\r\n                            <% if (item.get("editable")) { %>\r\n                                <div class="btn-edit-common img-commonctrl" data-value="<%=item.get("id")%>"></div>\r\n                            <% } %>\r\n                            <% if (item.get("removable")) { %>\r\n                                <div class="btn-delete img-commonctrl" data-value="<%=item.get("id")%>"></div>\r\n                            <% } %>\r\n                            </div>\r\n                        <%}%>\r\n                    <% } else { %>\r\n                        <div class="inner-edit-ct">\r\n                            <textarea class="msg-reply textarea-fix user-select textarea-control" maxlength="maxCommLength" aria-label="textReply"><%=item.get("reply")%></textarea>\r\n                            <button class="btn normal dlg-btn primary btn-inner-edit btn-fix" id="id-comments-change">textEdit</button>\r\n                            <button class="btn normal dlg-btn btn-inner-close">textClose</button>\r\n                        </div>\r\n                    <% } %>\r\n                </div>\r\n                <% } %>\r\n            <% }); %>\r\n        <% } %>\r\n\r\n        \x3c!-- add reply button --\x3e\r\n\r\n        <% if (!showReply && !scope.viewmode) { %>\r\n            <% if (replys.length && !add_arrow) { %>\r\n                <label class="user-reply with-reply" role="presentation" tabindex="-1">textAddReply</label>\r\n            <% } else { %>\r\n                <label class="user-reply" role="presentation" tabindex="-1">textAddReply</label>\r\n            <% } %>\r\n        <% } %>\r\n\r\n        \x3c!-- edit buttons --\x3e\r\n\r\n        <% if (!editText && !lock) { %>\r\n            <div class="edit-ct">\r\n                <% if (!scope.viewmode) { %>\r\n                    <% if (editable) { %>\r\n                        <div class="btn-edit-common img-commonctrl"></div>\r\n                    <% } %>\r\n                    <% if (removable) { %>\r\n                        <div class="btn-delete img-commonctrl"></div>\r\n                    <% } %>\r\n                <% } %>\r\n                <% if (editable && !scope.viewmode) { %>\r\n                    <div class="btn-resolve <% if (resolved) print(\'img-commonctrl comment-resolved\') %>" data-toggle="tooltip"></div>\r\n                <% } else if ((!editable || scope.viewmode) && resolved) { %>\r\n                    <div class="icon-resolve i-comment-resolved img-commonctrl" data-toggle="tooltip"></div>\r\n                <% } %>\r\n            </div>\r\n        <% } %>\r\n\r\n        \x3c!-- reply --\x3e\r\n\r\n        <% if (showReply) { %>\r\n            <div class="reply-ct">\r\n                <textarea class="msg-reply user-select textarea-control" placeholder="textAddReply" maxlength="maxCommLength" aria-label="textReply"></textarea>\r\n                <button class="btn normal dlg-btn primary btn-reply" id="id-comments-change">textReply</button>\r\n                <button class="btn normal dlg-btn btn-close">textClose</button>\r\n            </div>\r\n        <% } %>\r\n        <% if (lock) { %>\r\n            <div class="lock-area"></div>\r\n            <div class="lock-author"><%=lockuserid%></div>\r\n        <% } %>\r\n        <% if (!last) { %>\r\n            <div class="separator-cmt"></div>\r\n        <% } %>\r\n    </div>\r\n<% } %>\r\n'})),define("text!common/main/lib/template/CommentsPanel.template",[],(function(){return'<div id="comments-box" class="layout-ct vbox">\r\n    <div class="layout-item messages-ct"></div>\r\n    <div class="layout-item add-link-ct">\r\n        <label id="add-comment-doc" class="btn new" data-hint="1" data-hint-direction="bottom" data-hint-offset="medium"><%=textAddCommentToDoc%></label>\r\n    </div>\r\n    <div style="display: none;" class="layout-item new-comment-ct">\r\n        <div class="inner-ct">\r\n            <textarea id="comment-msg-new" class="user-select textarea-control" placeholder="<%=textEnterCommentHint%>" maxlength="<%=maxCommLength%>" data-hint="1" data-hint-direction="left-top" aria-label="<%=textEnterCommentHint%>"></textarea>\r\n        </div>\r\n        <button class="btn add normal dlg-btn primary" data-hint="1" data-hint-direction="bottom" data-hint-offset="big" style="width: auto;min-width: 86px;"><%=textAddComment%></button>\r\n        <button class="btn cancel normal dlg-btn" data-hint="1" data-hint-direction="bottom" data-hint-offset="big" style="width: auto;min-width: 86px;"><%=textCancel%></button>\r\n    </div>\r\n    <div id="comments-header" class="">\r\n        <label role="heading"><%=textComments%></label>\r\n        <div id="comments-btn-close" class="float-right margin-left-4"></div>\r\n        <div id="comments-btn-sort" class="float-right margin-left-4"></div>\r\n        <div id="comments-btn-add" class="float-right"></div>\r\n    </div>\r\n</div>\r\n'})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Comments",["text!common/main/lib/template/Comments.template","text!common/main/lib/template/CommentsPanel.template","common/main/lib/util/utils","common/main/lib/component/Button","common/main/lib/component/ComboBox","common/main/lib/component/DataView","common/main/lib/component/Layout","common/main/lib/component/Window"],(function(t,e){"use strict";function i(t,e){var i,o,n=t;for(i in e)void 0!==i&&(o=e[i],n=n.replace(new RegExp(i,"g"),o));return n}var o=Common.UI.DataView.extend({options:{handleSelect:!1,scrollable:!0,listenStoreEvents:!1,template:_.template('<div class="dataview-ct inner" role="list"></div>')},getTextBox:function(){var t=$(this.el).find("textarea");return t&&t.length?t:void 0},setFocusToTextBox:function(){var t=$(this.el).find("textarea");if(t&&t.length){var e=t.val();t.focus(),t.val(""),t.val(e)}},getActiveTextBoxVal:function(){var t=$(this.el).find("textarea");return t&&t.length?t.val().trim():""},disableTextBoxButton:function(t){var e=$(t.siblings("#id-comments-change")[0]);t.val().trim().length>0?(e.removeAttr("disabled"),e.removeClass("disabled")):(e.attr("disabled",!0),e.addClass("disabled"))},autoHeightTextBox:function(){var t=this,e=$(this.el).find("textarea"),i=null,o=55,n=0,s=0;function a(){i.scrollHeight>i.clientHeight?e.css({height:i.scrollHeight+n+"px"}):i.clientHeight>=o&&(e.css({height:o+"px"}),i.scrollHeight>i.clientHeight&&(s=Math.max(i.scrollHeight+n,o),e.css({height:s+"px"}))),t.autoScrollToEditButtons()}e&&e.length&&(i=e.get(0),t.disableTextBoxButton(e),i&&(n=.25*parseInt(e.css("lineHeight"),10),a(),e.bind("input propertychange",(function(e){a(),t.disableTextBoxButton($(e.target))})))),this.textBox=e},clearTextBoxBind:function(){this.textBox&&(this.textBox.unbind("input propertychange"),this.textBox=void 0)},autoScrollToEditButtons:function(){var t=$("#id-comments-change"),e=null,i=Common.Utils.getBoundingClientRect(this.el),o=0;t.length&&(e=Common.Utils.getBoundingClientRect(t.get(0)))&&i&&(o=i.bottom-(e.bottom+7))<0&&this.scroller.scrollTop(this.scroller.getScrollTop()-o)}});Common.Views.Comments=Common.UI.BaseView.extend(_.extend({el:"#left-panel-comments",template:_.template(e),addCommentHeight:45,newCommentHeight:110,textBoxAutoSizeLocked:void 0,viewmode:!1,_commentsViewOnItemClick:function(t,e,i,o){var n,s,a,r,l,c=this;function h(){c.update()}if(n=$(o.target))if(s=i.get("editText"),a=i.get("showReply"),r=i.get("uid"),l=n.attr("data-value"),n.hasClass("btn-edit-common"))_.isUndefined(l)?s||(c.fireEvent("comment:closeEditing"),i.set("editText",!0),t.autoHeightTextBox(),h(),t.setFocusToTextBox(),c.hookTextBox()):(c.fireEvent("comment:closeEditing",[r]),c.fireEvent("comment:editReply",[r,l]),c.commentsView.reply=l,t.autoHeightTextBox(),h(),c.hookTextBox(),t.autoScrollToEditButtons(),t.setFocusToTextBox());else if(n.hasClass("btn-delete"))_.isUndefined(l)?(c.fireEvent("comment:remove",[r]),Common.NotificationCenter.trigger("edit:complete",c)):c.fireEvent("comment:removeReply",[r,l]),c.fireEvent("comment:closeEditing"),h();else if(n.hasClass("user-reply"))c.fireEvent("comment:closeEditing"),i.set("showReply",!0),h(),t.autoHeightTextBox(),c.hookTextBox(),t.autoScrollToEditButtons(),t.setFocusToTextBox();else if(n.hasClass("btn-reply",!1))a&&(c.fireEvent("comment:addReply",[r,t.getActiveTextBoxVal()]),c.fireEvent("comment:closeEditing"),h());else if(n.hasClass("btn-close",!1))c.fireEvent("comment:closeEditing",[r]);else if(n.hasClass("btn-inner-edit",!1))_.isUndefined(c.commentsView.reply)?s&&c.fireEvent("comment:change",[r,t.getActiveTextBoxVal()]):(c.fireEvent("comment:changeReply",[r,c.commentsView.reply,t.getActiveTextBoxVal()]),c.commentsView.reply=void 0),c.fireEvent("comment:closeEditing"),h();else if(n.hasClass("btn-inner-close",!1))c.fireEvent("comment:closeEditing"),c.commentsView.reply=void 0,h();else if(n.hasClass("btn-resolve",!1)){var d=n.data("bs.tooltip");d&&(d.dontShow=!0),c.fireEvent("comment:resolve",[r]),h()}else if(!n.hasClass("msg-reply")&&!n.hasClass("btn-resolve")){var m=!1;if(n.hasClass("user-message"))if(window.getSelection)m=""!==window.getSelection().toString();else document.selection&&(m=document.selection);c.fireEvent("comment:show",[r,!1,m]),Common.NotificationCenter.trigger("edit:complete",c)}},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.store=this.options.store,this.hasFilters=!1;var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:"",this.showCommentToDocAtBottom=!1,!this.showCommentToDocAtBottom&&(this.addCommentHeight=0)},render:function(){var e=this;if(this.rendered||(this.$el.html(this.template({textAddCommentToDoc:e.textAddCommentToDoc,textAddComment:e.textAddComment,textCancel:e.textCancel,textEnterCommentHint:e.textEnterCommentHint,maxCommLength:Asc.c_oAscMaxCellOrCommentLength,textComments:e.textComments})),this.buttonAddCommentToDoc=new Common.UI.Button({el:$(".btn.new",this.$el),enableToggle:!1}),this.buttonAdd=new Common.UI.Button({action:"add",el:$(".btn.add",this.$el),enableToggle:!1}),this.buttonCancel=new Common.UI.Button({el:$(".btn.cancel",this.$el),enableToggle:!1}),this.buttonSort=new Common.UI.Button({parentEl:$("#comments-btn-sort",this.$el),cls:"btn-toolbar no-caret",iconCls:"toolbar__icon btn-more",hint:this.textSort,menu:new Common.UI.Menu({style:"min-width: auto;",items:[{caption:this.mniDateDesc,value:"date-desc",checkable:!0,checked:"date-desc"===(Common.localStorage.getItem(this.appPrefix+"comments-sort")||"date-desc"),toggleGroup:"sortcomments"},{caption:this.mniDateAsc,value:"date-asc",checkable:!0,checked:"date-asc"===(Common.localStorage.getItem(this.appPrefix+"comments-sort")||"date-desc"),toggleGroup:"sortcomments"},{caption:this.mniAuthorAsc,value:"author-asc",checkable:!0,checked:"author-asc"===Common.localStorage.getItem(this.appPrefix+"comments-sort"),toggleGroup:"sortcomments"},{caption:this.mniAuthorDesc,value:"author-desc",checkable:!0,checked:"author-desc"===Common.localStorage.getItem(this.appPrefix+"comments-sort"),toggleGroup:"sortcomments"},{caption:this.mniPositionAsc,value:"position-asc",checkable:!0,visible:"de-"===this.appPrefix,checked:"position-asc"===Common.localStorage.getItem(this.appPrefix+"comments-sort"),toggleGroup:"sortcomments"},{caption:this.mniPositionDesc,value:"position-desc",checkable:!0,visible:"de-"===this.appPrefix,checked:"position-desc"===Common.localStorage.getItem(this.appPrefix+"comments-sort"),toggleGroup:"sortcomments"},{caption:"--",visible:!1},this.menuFilterGroups=new Common.UI.MenuItem({caption:this.mniFilterGroups,checkable:!1,visible:!1,menu:new Common.UI.Menu({menuAlign:"tl-tr",style:"min-width: auto;",items:[]})}),{caption:"--"},this.mnuAddCommentToDoc=new Common.UI.MenuItem({caption:this.textAddCommentToDoc,checkable:!1})]})}),this.buttonClose=new Common.UI.Button({parentEl:$("#comments-btn-close",this.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-close",hint:this.textClosePanel}),this.buttonAddNew=new Common.UI.Button({parentEl:$("#comments-btn-add",this.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-add-comment",hint:this.textHintAddComment}),this.buttonAddCommentToDoc.on("click",_.bind(this.onClickShowBoxDocumentComment,this)),this.buttonAdd.on("click",_.bind(this.onClickAddDocumentComment,this)),this.buttonCancel.on("click",_.bind(this.onClickCancelDocumentComment,this)),this.buttonClose.on("click",_.bind(this.onClickClosePanel,this)),this.buttonSort.menu.on("item:toggle",_.bind(this.onSortClick,this)),this.menuFilterGroups.menu.on("item:toggle",_.bind(this.onFilterGroupsClick,this)),this.mnuAddCommentToDoc.on("click",_.bind(this.onClickShowBoxDocumentComment,this)),this.buttonAddNew.on("click",_.bind(this.onClickAddNewComment,this)),this.txtComment=$("#comment-msg-new",this.el),this.scrollerNewCommet=new Common.UI.Scroller({el:$(".new-comment-ct")}),this.txtComment.keydown((function(t){if(!t.ctrlKey&&!t.metaKey||t.altKey||t.keyCode!=Common.UI.Keys.RETURN){if(t.keyCode===Common.UI.Keys.TAB){var i,o,n;n=this.selectionStart,o=this.selectionEnd,(i=$(this)).val(i.val().substring(0,n)+"\t"+i.val().substring(o)),this.selectionStart=this.selectionEnd=n+1,t.stopImmediatePropagation(),t.preventDefault()}}else e.onClickAddDocumentComment(),t.stopImmediatePropagation()}))),this.commentsView)this.commentsView.onResetItems();else{this.commentsView=new o({el:$(".messages-ct",e.el),store:e.store,itemTemplate:_.template(i(t,{textAddReply:e.textAddReply,textAdd:e.textAdd,textCancel:e.textCancel,textEdit:e.textEdit,textReply:e.textReply,textClose:e.textClose,textComment:e.textComment,maxCommLength:Asc.c_oAscMaxCellOrCommentLength})),emptyText:e.txtEmpty});var n=function(t,i,o){i.tipsArray&&i.tipsArray.forEach((function(t){t.remove()}));var n=[],s=$(i.el).find(".btn-resolve:not(.comment-resolved)");s.tooltip({title:e.textResolve,placement:"cursor"}),s.each((function(t,e){n.push($(e).data("bs.tooltip").tip())})),(s=$(i.el).find(".comment-resolved")).tooltip({title:e.textOpenAgain,placement:"cursor"}),s.each((function(t,e){n.push($(e).data("bs.tooltip").tip())})),(s=$(i.el).find(".i-comment-resolved")).tooltip({title:e.textViewResolved,placement:"cursor"}),s.each((function(t,e){n.push($(e).data("bs.tooltip").tip())})),i.tipsArray=n};this.commentsView.on({"item:add":n,"item:remove":n,"item:change":n,"item:click":this._commentsViewOnItemClick.bind(this)})}return this.rendered||this.setupLayout(),this.update(),this.rendered=!0,this},update:function(){this.updateLayout(),this.updateScrolls()},updateScrolls:function(){this.commentsView&&this.commentsView.scroller&&this.commentsView.scroller.update({minScrollbarLength:this.commentsView.minScrollbarLength,alwaysVisibleY:!0})},showEditContainer:function(t){var e=$(".add-link-ct",this.el),i=$(".new-comment-ct",this.el),o=$(".messages-ct",this.el);$("#comments-box",this.el);if(this.layout.freezePanels(!t),t){e.css({display:"none"}),i.css({display:"table-row"}),o.toggleClass("stretch",!1),this.txtComment.val("");var n=this;setTimeout((function(){n.txtComment.focus()}),10),this.textBoxAutoSizeLocked=void 0}else e.css({display:"table-row"}),i.css({display:"none"}),o.toggleClass("stretch",!this.mode.canComments||this.mode.compatibleFeatures||!this.showCommentToDocAtBottom);this.updateLayout(),this.updateScrolls()},onClickShowBoxDocumentComment:function(){this.fireEvent("comment:closeEditing"),this.showEditContainer(!0)},onClickAddDocumentComment:function(){this.fireEvent("comment:add",[this,this.txtComment.val().trim(),void 0,!1,!0]),this.txtComment.val("")},onClickCancelDocumentComment:function(){this.showEditContainer(!1)},onClickAddNewComment:function(){Common.NotificationCenter.trigger("app:comment:add")},saveText:function(t){this.commentsView&&this.commentsView.cmpEl.find(".lock-area").length<1&&(this.textVal=void 0,t?this.commentsView.clearTextBoxBind():this.textVal=this.commentsView.getActiveTextBoxVal())},loadText:function(){if(this.textVal&&this.commentsView){var t=this.commentsView.getTextBox();t&&t.val(this.textVal)}},hookTextBox:function(){var t=this.commentsView.getTextBox();t&&t.keydown((function(t){if(!t.ctrlKey&&!t.metaKey||t.altKey||t.keyCode!=Common.UI.Keys.RETURN){if(t.keyCode===Common.UI.Keys.TAB){var e,i,o;o=this.selectionStart,i=this.selectionEnd,(e=$(this)).val(e.val().substring(0,o)+"\t"+e.val().substring(i)),this.selectionStart=this.selectionEnd=o+1,t.stopImmediatePropagation(),t.preventDefault()}}else{var n=$("#id-comments-change");n&&n.length&&n.click(),t.stopImmediatePropagation()}}))},setupLayout:function(){var t=this,e=t.$el,i=$(".new-comment-ct",t.el),o=($(".add-link-ct",t.el),$("#comments-box",t.el)),n=o.find(" > .layout-item");t.layout=new Common.UI.VBoxLayout({box:o,freeze:!0,items:[{el:n[0],rely:!0,resize:{hidden:!1,autohide:!1,fmin:function(){var e=o.height();return"none"!==i.css("display")&&.5*e<t.newCommentHeight?e-t.newCommentHeight:.5*e},fmax:function(){return"none"!==i.css("display")?o.height()-t.newCommentHeight:o.height()-t.addCommentHeight}}},{el:n[1],stretch:!0},{el:n[2],stretch:!0}]}),t.layout.on("layout:resizedrag",(function(){t.updateScrolls(),t.textBoxAutoSizeLocked=!0}),this),$(window).on("resize",(function(){if("none"!==e.css("display")){var i=$("#comments-box",t.el).height(),o=$(".new-comment-ct",t.el),n=$(".add-link-ct",t.el);"none"!==o.css("display")?t.layout.setResizeValue(0,Math.max(-t.newCommentHeight,Math.min(i-((o.height()||0)+4),i-t.newCommentHeight))):t.layout.setResizeValue(0,Math.max(-t.addCommentHeight,Math.min(i-(n.height()||0),i-t.addCommentHeight))),t.updateScrolls()}})),this.autoHeightTextBox()},changeLayout:function(t){this.mode=t;var e=this,i=$(".new-comment-ct",this.el),o=$(".add-link-ct",this.el),n=$(".messages-ct",this.el);if(n.toggleClass("stretch",!t.canComments||t.compatibleFeatures||!this.showCommentToDocAtBottom),this.buttonAddNew.setVisible(t.canComments),this.buttonSort&&this.buttonSort.menu){var s=this.buttonSort.menu;s.items[s.items.length-1].setVisible(t.canComments&&!t.compatibleFeatures),s.items[s.items.length-2].setVisible(t.canComments&&!t.compatibleFeatures),this.buttonSort.updateHint(t.canComments&&!t.compatibleFeatures?this.hasFilters?this.textSortFilterMore:this.textSortMore:this.hasFilters?this.textSortFilter:this.textSort)}if(!t.canComments||t.compatibleFeatures)t.compatibleFeatures?(i.remove(),o.remove()):(i.hide(),o.hide()),this.layout.changeLayout([{el:n[0],rely:!1,stretch:!0}]);else{var a=$("#comments-box",this.el);this.showCommentToDocAtBottom?o.show():o.remove(),this.layout.changeLayout([{el:n[0],rely:!0,resize:{hidden:!1,autohide:!1,fmin:function(){var t=a.height();return"none"!==i.css("display")&&.5*t<e.newCommentHeight?t-e.newCommentHeight:.5*t},fmax:function(){return"none"!==i.css("display")?a.height()-e.newCommentHeight:a.height()-e.addCommentHeight}}}].concat(this.showCommentToDocAtBottom?[{el:o[0],stretch:!0}]:[]).concat([{el:i[0],stretch:!0}]))}},updateLayout:function(){var t=$("#comments-box",this.el);"none"!==$(".new-comment-ct",this.el).css("display")?this.layout.setResizeValue(0,t.height()-this.newCommentHeight):this.layout.setResizeValue(0,t.height()-this.addCommentHeight)},disableTextBoxButton:function(t){var e=$(t.parent().siblings(".add")[0]);t.val().trim().length>0?(e.removeAttr("disabled"),e.removeClass("disabled")):(e.attr("disabled",!0),e.addClass("disabled"))},autoHeightTextBox:function(){var t=this,e=0,i=44,o=$("#comment-msg-new",this.el);function n(){var o,n,s;if(o=$("#comment-msg-new",t.el),s=$("#comments-box",t.el).height(),0==o.val().length)return t.layout.setResizeValue(0,Math.max(-t.newCommentHeight,s-t.newCommentHeight)),void(t.textBoxAutoSizeLocked=void 0);_.isUndefined(t.textBoxAutoSizeLocked)&&(o.height(),o.get(0).scrollHeight,o.css({height:i+"px"}),o.height(),n=Math.max(o.get(0).scrollHeight+e,48),o.css({height:"100%"}),s=$("#comments-box",t.el).height(),t.layout.setResizeValue(0,Math.max(-t.newCommentHeight,Math.min(s-n-48,s-t.newCommentHeight))))}o.length<1||(t.disableTextBoxButton(o),e=.25*parseInt(o.css("lineHeight"),10),n(),o.bind("input propertychange",(function(e){n(),t.disableTextBoxButton($(e.target))})),this.textBox=o)},getFixedQuote:function(t){return Common.Utils.String.ellipsis(Common.Utils.String.htmlEncode(t),120,!0)},getUserName:function(t){return Common.Utils.String.htmlEncode(AscCommon.UserInfoParser.getParsedName(t))},getEncodedName:function(t){return Common.Utils.String.htmlEncode(t)},pickLink:function(t){var e,i,o=[];t.replace(Common.Utils.ipStrongRe,(function(t){var i=/[\.,\?\+;:=!\(\)]+$/.exec(t);return i&&(t=t.substring(0,i.index)),e=arguments[arguments.length-2],o.push({start:e,end:t.length+e,str:'<a href="'+t+'" target="_blank" data-can-copy="true">'+t+"</a>"}),""})),(t.length<1e3||t.search(/\S{255,}/)<0)&&t.replace(Common.Utils.hostnameStrongRe,(function(t){var n=/[\.,\?\+;:=!\(\)]+$/.exec(t);n&&(t=t.substring(0,n.index));var s=/(((^https?)|(^ftp)):\/\/)/i.test(t)?t:"http://"+t;return e=arguments[arguments.length-2],i=t.length,_.find(o,(function(t){return e>=t.start&&e<t.end||e<=t.start&&e+i>t.start}))||o.push({start:e,end:i+e,str:'<a href="'+s+'" target="_blank" data-can-copy="true">'+t+"</a>"}),""})),t.replace(Common.Utils.emailStrongRe,(function(t){var n=/((^mailto:)\/\/)/i.test(t)?t:"mailto:"+t;return e=arguments[arguments.length-2],i=t.length,_.find(o,(function(t){return e>=t.start&&e<t.end||e<=t.start&&e+i>t.start}))||o.push({start:e,end:i+e,str:'<a href="'+n+'">'+t+"</a>"}),""}));for(var n=(o=_.sortBy(o,(function(t){return t.start}))).length>0?Common.Utils.String.htmlEncode(t.substring(0,o[0].start))+o[0].str:Common.Utils.String.htmlEncode(t),s=1;s<o.length;s++)n+=Common.Utils.String.htmlEncode(t.substring(o[s-1].end,o[s].start))+o[s].str;return o.length>0&&(n+=Common.Utils.String.htmlEncode(t.substring(o[s-1].end,t.length))),n},pickEMail:function(t,e,i){var o=[];i&&(o=Common.Utils.String.htmlEncode(i).match(/\B[@+][A-Z0-9._%+-]+@[A-Z0-9._-]+\.[A-Z]+\b/gi),o=_.map(o,(function(t){return t.slice(1,t.length)})));var n=Common.Utils.String.htmlEncode(e).match(/\B[@+][A-Z0-9._%+-]+@[A-Z0-9._-]+\.[A-Z]+\b/gi);n=_.map(n,(function(t){return t.slice(1,t.length)})),(n=_.difference(n,o)).length>0&&Common.Gateway.requestSendNotify({emails:n,actionId:t,actionLink:{action:{type:"comment",data:t}},message:e})},onSortClick:function(t,e,i){i&&this.fireEvent("comment:sort",[e.value])},onFilterGroupsClick:function(t,e,i){i&&this.fireEvent("comment:filtergroups",[e.value])},onClickClosePanel:function(){Common.NotificationCenter.trigger("leftmenu:change","hide")},textComments:"Comments",textAnonym:"Guest",textAddCommentToDoc:"Add Comment to Document",textAddComment:"Add Comment",textCancel:"Cancel",textAddReply:"Add Reply",textReply:"Reply",textClose:"Close",textResolved:"Resolved",textResolve:"Resolve",textEnterCommentHint:"Enter your comment here",textEdit:"Edit",textAdd:"Add",textOpenAgain:"Open Again",textHintAddComment:"Add Comment",textSort:"Sort comments",textComment:"Comment",mniPositionAsc:"From top",mniPositionDesc:"From bottom",mniAuthorAsc:"Author A to Z",mniAuthorDesc:"Author Z to A",mniDateDesc:"Newest",mniDateAsc:"Oldest",textClosePanel:"Close comments",textViewResolved:"You have not permission for reopen comment",mniFilterGroups:"Filter by Group",textAll:"All",txtEmpty:"There are no comments in the document.",textSortFilter:"Sort and filter comments",textSortMore:"Sort and more",textSortFilterMore:"Sort, filter and more"},Common.Views.Comments||{}))})),define("text!common/main/lib/template/Chat.template",[],(function(){return'<div id="chat-box" class="layout-ct vbox">\r\n    <div id="chat-users" class="layout-item area">\r\n        <div id="chat-user-ct"></div>\r\n    </div>\r\n    <div id="chat-messages" class="layout-item area">\r\n        <div id="chat-message-ct"></div>\r\n    </div>\r\n    <div id="chat-options" class="layout-item">\r\n        <div id="chat-options-ct">\r\n            <textarea id="chat-msg-text" class="user-select textarea-control" maxlength="<%=maxMsgLength%>" data-hint="1" data-hint-direction="left-top" placeholder="<%=textEnterMessage%>" aria-label="<%=textEnterMessage%>"></textarea>\r\n            <button id="chat-msg-btn-add" class="btn normal dlg-btn primary" data-hint="1" data-hint-direction="bottom" data-hint-offset="big"><%=scope.textSend%></button>\r\n        </div>\r\n    </div>\r\n    <div id="chat-header" class="">\r\n            <label role="heading"><%=textChat%></label>\r\n            <div id="chat-btn-close" class="float-right margin-left-4"></div>\r\n        </div>\r\n</div>'})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Chat",["text!common/main/lib/template/Chat.template","common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout"],(function(t){"use strict";Common.Views.Chat=Common.UI.BaseView.extend(_.extend({el:"#left-panel-chat",template:_.template(t),storeUsers:void 0,storeMessages:void 0,tplUser:['<li id="<%= user.get("iid") %>"<% if (!user.get("online")) { %> class="offline"<% } %>>','<div class="name"><div class="color" style="background-color: <%= user.get("color") %>;" ></div><%= Common.Utils.String.htmlEncode(user.get("parsedName")) %>',"</div>","</li>"].join(""),templateUserList:_.template("<ul><% for (originalId in users) { %><%= _.template(usertpl)({user: users[originalId][0], scope: scope}) %><% } %></ul>"),tplMsg:["<li>",'<% if (msg.get("type")==1) { %>','<div class="message service" data-can-copy="true"><%= msg.get("message") %></div>',"<% } else { %>",'<div class="color"','<% if (msg.get("avatar")) { %>','style="background-image: url(<%=msg.get("avatar")%>); <% if (msg.get("usercolor")!==null) { %> border-color:<%=msg.get("usercolor")%>; border-style:solid;<% }%>"',"<% } else { %>",'style="background-color: <% if (msg.get("usercolor")!==null) { %> <%=msg.get("usercolor")%> <% } else { %> #cfcfcf <% }%>;"',"<% } %>",'><% if (!msg.get("avatar")) { %><%-msg.get("initials")%><% } %></div>','<div class="user-content">','<div class="user-name" data-can-copy="true">','<%= Common.Utils.String.htmlEncode(msg.get("parsedName")) %>',"</div>",'<label class="message user-select" data-can-copy="true" tabindex="-1" oo_editor_input="true"><%= msg.get("message") %></label>',"</div>","<% } %>","</li>"].join(""),templateMsgList:_.template("<ul><% _.each(messages, function(item) { %><%= _.template(msgtpl)({msg: item, scope: scope}) %><% }); %></ul>"),events:{},usersBoxHeight:117,messageBoxHeight:70,addMessageBoxHeight:110,initialize:function(t){_.extend(this,t),Common.UI.BaseView.prototype.initialize.call(this,arguments),this.storeUsers.bind({add:_.bind(this._onResetUsers,this),change:_.bind(this._onResetUsers,this),reset:_.bind(this._onResetUsers,this)}),this.storeMessages.bind({add:_.bind(this._onAddMessage,this),reset:_.bind(this._onResetMessages,this)})},render:function(t){return t=t||this.el,$(t).html(this.template({scope:this,maxMsgLength:Asc.c_oAscMaxCellOrCommentLength,textChat:this.textChat,textEnterMessage:this.textEnterMessage})),this.panelBox=$("#chat-box",this.el),this.panelUsers=$("#chat-users",this.el),this.panelMessages=$("#chat-messages",this.el),this.txtMessage=$("#chat-msg-text",this.el),this.panelOptions=$("#chat-options",this.el),this.panelUsers.scroller=new Common.UI.Scroller({el:$("#chat-users"),useKeyboard:!0,minScrollbarLength:25}),this.panelMessages.scroller=new Common.UI.Scroller({el:$("#chat-messages"),includePadding:!0,useKeyboard:!0,minScrollbarLength:40}),this.panelOptions.scroller=new Common.UI.Scroller({el:$("#chat-options")}),this.buttonClose=new Common.UI.Button({parentEl:$("#chat-btn-close",this.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-close",hint:this.textClosePanel}),this.buttonClose.on("click",_.bind(this.onClickClosePanel,this)),$("#chat-msg-btn-add",this.el).on("click",_.bind(this._onBtnAddMessage,this)),this.txtMessage.on("keydown",_.bind(this._onKeyDown,this)),this.setupLayout(),this.trigger("render:after",this),this},focus:function(){var t=this;_.defer((function(){t.txtMessage.focus()}),100),this.updateLayout(!0),this.setupAutoSizingTextBox()},getFocusElement:function(){return this.txtMessage},_onKeyDown:function(t){t.keyCode==Common.UI.Keys.RETURN&&(!t.ctrlKey&&!t.metaKey||t.altKey||this._onBtnAddMessage(t))},_onResetUsers:function(t,e){this.panelUsers&&(this.panelUsers.html(this.templateUserList({users:this.storeUsers.chain().filter((function(t){return t.get("online")})).groupBy((function(t){return t.get("idOriginal")})).value(),usertpl:this.tplUser,scope:this})),this.panelUsers.scroller.update({minScrollbarLength:25,alwaysVisibleY:!0}))},_onAddMessage:function(t,e,i){if(this.panelMessages){var o=this.panelMessages.find("ul");o&&o.length&&(this._prepareMessage(t),o.append(_.template(this.tplMsg)({msg:t,scope:this})),this.panelMessages.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0}),this.panelMessages.scroller.scrollTop(Common.Utils.getBoundingClientRect(o.get(0)).height))}},_onResetMessages:function(t,e){this.panelMessages&&(t.each((function(t){this._prepareMessage(t)}),this),this.panelMessages.html(this.templateMsgList({messages:t.models,msgtpl:this.tplMsg,scope:this})),this.panelMessages.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0}))},renderMessages:function(){this.panelMessages&&this.storeMessages&&(this.panelMessages.html(this.templateMsgList({messages:this.storeMessages.models,msgtpl:this.tplMsg,scope:this})),this.panelMessages.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0}))},_onBtnAddMessage:function(t){this.txtMessage&&(this.fireEvent("message:add",[this,this.txtMessage.val().trim()]),this.txtMessage.val(""),this.focus())},_prepareMessage:function(t){var e=this.storeUsers.findOriginalUser(t.get("userid")),i=Common.UI.ExternalUsers.getImage(t.get("userid"));t.set({usercolor:e?e.get("color"):Common.UI.ExternalUsers.getColor(t.get("userid")),avatar:i,initials:e?e.get("initials"):Common.Utils.getUserInitials(t.get("parsedName")),message:this._pickLink(t.get("message"))},{silent:!0}),void 0===i&&Common.UI.ExternalUsers.get("info",[t.get("userid")])},_pickLink:function(t){var e,i,o=[];t.replace(Common.Utils.ipStrongRe,(function(t){var i=/[\.,\?\+;:=!\(\)]+$/.exec(t);return i&&(t=t.substring(0,i.index)),e=arguments[arguments.length-2],o.push({start:e,end:t.length+e,str:'<a href="'+t+'" target="_blank" data-can-copy="true">'+t+"</a>"}),""})),(t.length<1e3||t.search(/\S{255,}/)<0)&&t.replace(Common.Utils.hostnameStrongRe,(function(t){var n=/[\.,\?\+;:=!\(\)]+$/.exec(t);n&&(t=t.substring(0,n.index));var s=/(((^https?)|(^ftp)):\/\/)/i.test(t)?t:"http://"+t;return e=arguments[arguments.length-2],i=t.length,_.find(o,(function(t){return e>=t.start&&e<t.end||e<=t.start&&e+i>t.start}))||o.push({start:e,end:i+e,str:'<a href="'+s+'" target="_blank" data-can-copy="true">'+t+"</a>"}),""})),t.replace(Common.Utils.emailStrongRe,(function(t){var n=/((^mailto:)\/\/)/i.test(t)?t:"mailto:"+t;return e=arguments[arguments.length-2],i=t.length,_.find(o,(function(t){return e>=t.start&&e<t.end||e<=t.start&&e+i>t.start}))||o.push({start:e,end:i+e,str:'<a href="'+n+'">'+t+"</a>"}),""}));for(var n=(o=_.sortBy(o,(function(t){return t.start}))).length>0?Common.Utils.String.htmlEncode(t.substring(0,o[0].start))+o[0].str:Common.Utils.String.htmlEncode(t),s=1;s<o.length;s++)n+=Common.Utils.String.htmlEncode(t.substring(o[s-1].end,o[s].start))+o[s].str;return o.length>0&&(n+=Common.Utils.String.htmlEncode(t.substring(o[s-1].end,t.length))),n},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.fireEvent("hide",this),this.textBoxAutoSizeLocked=void 0},setupLayout:function(){var t=this,e=$(t.el),i=this.panelBox.find(" > .layout-item");t.layout=new Common.UI.VBoxLayout({box:this.panelBox,items:[{el:i[0],rely:!0,behaviour:"splitter",resize:{hidden:!1,autohide:!1,fmin:function(){return t.usersBoxHeight},fmax:function(){return Math.max(t.usersBoxHeight-20,.5*t.panelBox.height()-t.messageBoxHeight)}}},{el:i[1],rely:!0,behaviour:"splitter",resize:{hidden:!1,autohide:!1,fmin:function(){return Math.max(t.messageBoxHeight+t.usersBoxHeight,.5*t.panelBox.height())},fmax:function(){return t.panelBox.height()-t.addMessageBoxHeight}}},{el:i[2],stretch:!0}]}),t.layout.on("layout:resizedrag",(function(e){t.updateScrolls(),t.usersCachedHeigt=t.panelUsers.height()+8+1,e.index||(t.textBoxAutoSizeLocked=!0)}),this),$(window).on("resize",(function(){"none"!==e.css("display")&&t.updateLayout()})),this.updateLayout();var o=this.panelBox.height();this.layout.setResizeValue(0,this.usersBoxHeight),this.layout.setResizeValue(1,Math.max(this.addMessageBoxHeight,Math.max(.5*o,o-t.panelOptions.height()-4))),this.setupAutoSizingTextBox(),this.disableTextBoxButton($(this.txtMessage)),this.txtMessage.bind("input propertychange",_.bind(this.onTextareaInput,this))},onTextareaInput:function(t){this.updateHeightTextBox(t),this.disableTextBoxButton($(t.target))},disableTextBoxButton:function(t){var e=$(t.siblings("#chat-msg-btn-add")[0]);t.val().trim().length>0?(e.removeAttr("disabled"),e.removeClass("disabled")):(e.attr("disabled",!0),e.addClass("disabled"))},updateLayout:function(t){var e=this,i=this.panelBox.height();if(e.layout.setResizeValue(1,Math.max(e.addMessageBoxHeight,Math.max(.5*i,i-e.panelOptions.height()-4))),t){this.panelUsers.css("height");this.panelUsers.css("height","1px");var o=this.panelUsers.get(0).scrollHeight;e.layout.setResizeValue(0,Math.max(e.usersBoxHeight,Math.min(o+2,Math.floor(.5*i)-e.messageBoxHeight)))}else e.layout.setResizeValue(0,Math.max(e.usersBoxHeight,Math.min(e.usersCachedHeigt+2,Math.floor(.5*i)-e.messageBoxHeight)));e.updateScrolls(),e.updateHeightTextBox(null)},setupAutoSizingTextBox:function(){this.lineHeight=0,this.minHeight=44,this.lineHeight=1.25*parseInt(this.txtMessage.css("lineHeight"),10),this.updateHeightTextBox(!0)},updateHeightTextBox:function(t){var e,i,o=this.txtMessage;if(i=this.panelBox.height(),t&&0==o.val().length)return this.layout.setResizeValue(1,Math.max(this.addMessageBoxHeight,i-this.addMessageBoxHeight)),this.textBoxAutoSizeLocked=void 0,void this.updateScrolls();_.isUndefined(this.textBoxAutoSizeLocked)&&(o.height(),o.get(0).scrollHeight,o.css({height:this.minHeight+"px"}),o.height(),e=Math.max(o.get(0).scrollHeight+this.lineHeight,1),o.css({height:"100%"}),i=this.panelBox.height(),this.layout.setResizeValue(1,Math.max(this.addMessageBoxHeight,Math.min(i-e-40,i-this.addMessageBoxHeight)))&&this.updateScrolls())},updateScrolls:function(){this.panelUsers&&this.panelUsers.scroller&&this.panelMessages&&this.panelMessages.scroller&&(this.panelUsers.scroller.update({minScrollbarLength:25,alwaysVisibleY:!0}),this.panelMessages.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0}))},onClickClosePanel:function(){Common.NotificationCenter.trigger("leftmenu:change","hide")},textSend:"Send",textChat:"Chat",textClosePanel:"Close chat",textEnterMessage:"Enter your message here"},Common.Views.Chat||{}))})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/History",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout"],(function(t){"use strict";Common.Views.History=Common.UI.BaseView.extend(_.extend({el:"#left-panel-history",storeHistory:void 0,template:_.template(['<div id="history-box" class="layout-ct vbox">','<div id="history-header" class="">',"<label><%=scope.textVersionHistory%></label>",'<div id="history-btn-back" class="float-right margin-left-4"></div>','<div id="history-btn-menu" class="float-right"></div>',"</div>",'<div id="history-list" class="">',"</div>","</div>"].join("")),initialize:function(t){_.extend(this,t),Common.UI.BaseView.prototype.initialize.call(this,arguments);var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:""},render:function(t){t=t||this.el,$(t).html(this.template({scope:this})).width((parseInt(Common.localStorage.getItem(this.appPrefix+"mainmenu-width"))||MENU_SCALE_PART)-SCALE_MIN),this.viewHistoryList=new Common.UI.TreeView({el:$("#history-list"),store:this.storeHistory,enableKeyEvents:!1,style:"border: none",itemTemplate:_.template(["<div ",'id="<%= id %>"','class="tree-item <% if (!isVisible) { %>hidden<% } %>" ','style="<% if (hasParent) { %>'+(Common.UI.isRTL()?"padding-right: 40px;":"padding-left: 40px;")+'<% } %>"',">","<% if (!hasParent) { %>",'<div class="caret-wrap">',"<% if (hasSubItems) { %>",'<div class="tree-caret img-commonctrl <% if (!isExpanded) { %>up<% } %>"></div>',"<% } %>","</div>","<% } %>",'<div class="content-wrap">','<div class="item-internal">',"<div ",'class="color"',"<% if (avatar) { %>",'style="background-image: url(<%=avatar%>); <% if (usercolor!==null) { %> border-color:<%=usercolor%>; border-style:solid;<% }%>"',"<% } else { %>",'style="background-color: <% if (usercolor!==null) { %> <%=usercolor%> <% } else { %> #cfcfcf <% }%>;"',"<% } %>",">","<% if (!avatar) { %><%-initials%><% } %>","</div>",'<div class="item-content">','<div class="item-title">','<div class="user-date"><%= created %></div>',"<% if (markedAsVersion) { %>",'<div class="user-version">'+this.textVer+"<%=version%></div>","<% } %>","</div>",'<div class="user-name">',"<%= Common.Utils.String.htmlEncode(AscCommon.UserInfoParser.getParsedName(username)) %>","</div>","</div>","</div>","<% if (canRestore && selected) { %>",'<label class="revision-restore" role="presentation" tabindex="-1">'+this.textRestore+"</label>","<% } %>","</div>","</div>"].join(""))});var e=this;this.viewHistoryList.on("item:expand",(function(t,i,o){e.btnExpand.setCaption(e.storeHistory.hasCollapsed()?e.textShowAll:e.textHideAll)})),this.btnBackToDocument=new Common.UI.Button({parentEl:$("#history-btn-back",this.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-close",hint:this.textCloseHistory});var i=[this.btnExpand=new Common.UI.MenuItem({caption:this.textHideAll,checkable:!1})];return window.DE&&i.push(this.chHighlightDeleted=new Common.UI.MenuItem({caption:this.textHighlightDeleted,value:"highlight",checkable:!0})),this.buttonMenu=new Common.UI.Button({parentEl:$("#history-btn-menu",this.$el),cls:"btn-toolbar no-caret",iconCls:"toolbar__icon btn-more",hint:this.textMore,menu:new Common.UI.Menu({style:"min-width: auto;",items:i})}),this.trigger("render:after",this),this},textRestore:"Restore",textVersionHistory:"Version History",textHighlightDeleted:"Highlight deleted",textHideAll:"Hide detailed changes",textShowAll:"Show detailed changes",textVer:"ver.",textMore:"More",textCloseHistory:"Close history"},Common.Views.History||{}))})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Plugins",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout","common/main/lib/component/Window"],(function(t){"use strict";Common.Views.Plugins=Common.UI.BaseView.extend(_.extend({storePlugins:void 0,initialize:function(t){_.extend(this,t),this._locked=!1,this._state={DisabledControls:!1,docProtection:{isReadOnly:!1,isReviewOnly:!1,isFormsOnly:!1,isCommentsOnly:!1}},this.lockedControls=[],this.pluginPanels={},this.customPluginPanels={},Common.UI.BaseView.prototype.initialize.call(this,arguments)},render:function(t){return t&&(this.$el=$(t)),this.pluginMenu=new Common.UI.Menu({menuAlign:"tr-br",items:[]}),this.trigger("render:after",this),this},getPanel:function(){var t=$('<section id="plugins-panel" class="panel" data-tab="plugins" role="tabpanel" aria-labelledby="plugins"></section>'),e=$('<div class="group"></div>');return this.storePlugins.isEmpty()||this.storePlugins.each((function(t){})),e.appendTo(t),t},renderTo:function(t){if(!this.storePlugins.isEmpty()){var e=this,i=$('<div class="group"></div>'),o=Common.enumLock;this.storePlugins.each((function(t){if(t.get("visible")){var n=t.get("variations"),s=t.get("guid"),a=n[t.get("currentVariation")].get("icons"),r=t.get("baseUrl")+e.parseIcons(a),l=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconImg:r,caption:Common.Utils.String.htmlEncode(t.get("name")),menu:n&&n.length>1,split:n&&n.length>1,value:s,hint:t.get("name"),lock:t.get("isDisplayedInViewer")?[o.viewMode,o.previewReviewMode,o.viewFormMode,o.selRangeEdit,o.editFormula]:[o.viewMode,o.previewReviewMode,o.viewFormMode,o.lostConnect,o.docLockView,o.docLockForms,o.docLockComments,o.selRangeEdit,o.editFormula],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),c=$('<span class="btn-slot text x-huge"></span>').appendTo(i);l.render(c),t.set("button",l),e.lockedControls.push(l)}}));var n=e._state.docProtection;Common.Utils.lockControls(Common.enumLock.docLockView,n.isReadOnly,{array:e.lockedControls}),Common.Utils.lockControls(Common.enumLock.docLockForms,n.isFormsOnly,{array:e.lockedControls}),Common.Utils.lockControls(Common.enumLock.docLockComments,n.isCommentsOnly,{array:e.lockedControls}),t.html(i),$('<div class="separator long"></div>').prependTo(t)}},setLocked:function(t){this._locked=t},ChangeSettings:function(t){this.disableControls(this._locked)},disableControls:function(t){this._state.DisabledControls!==t&&(this._state.DisabledControls=t,_.each(this.lockedControls,(function(e){e.setDisabled(t)})),this.pluginsMask&&this.pluginsMask.css("display",t?"block":"none"))},SetDisabled:function(t,e,i){e?Common.Utils.lockControls(Common.enumLock.previewReviewMode,t,{array:this.lockedControls}):i?Common.Utils.lockControls(Common.enumLock.viewFormMode,t,{array:this.lockedControls}):Common.Utils.lockControls(Common.enumLock.viewMode,t,{array:this.lockedControls})},openedPluginMode:function(t,e){var i=this.storePlugins.findWhere({guid:t});if(i){var o=i.get("button");o&&(e||o.toggle(!0),o.menu&&o.menu.items.length>0&&(o.menu.items[0].setCaption(this.textStop),o.menu.items[0].isRun=!0),o.options.isRun=!0)}},closedPluginMode:function(t,e){var i=this.storePlugins.findWhere({guid:t});if(i){var o=i.get("button");o&&(e||o.toggle(!1),o.menu&&o.menu.items.length>0&&(o.menu.items[0].setCaption(this.textStart),o.menu.items[0].isRun=!1),o.options.isRun=!1)}},iconsStr2IconsObj:function(t){var e=t;return"string"==typeof e?-1===e.indexOf("%")?[t,t]:Common.UI.iconsStr2IconsObj(t):e},parseIcons:function(t){return Common.UI.getSuitableIcons(this.iconsStr2IconsObj(t))},updatePluginIcons:function(t){if(!t.get("visible"))return null;var e=t.get("variations")[t.get("currentVariation")].get("icons");""!==e&&(t.set("parsedIcons",this.parseIcons(e)),this.updatePluginButton(t))},updatePluginButton:function(t){if(!t.get("visible")||!t.get("parsedIcons"))return null;var e=t.get("backgroundPlugin");e&&e.cmpEl&&e.cmpEl.find("img").attr("src",t.get("baseUrl")+t.get("parsedIcons").normal)},createBackgroundPluginsButton:function(){var t=Common.enumLock,e=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-background-plugins",caption:this.textBackgroundPlugins,menu:new Common.UI.Menu({cls:"background-plugins",style:"min-width: 230px;",items:[{template:_.template('<div class="menu-header">'+this.textTheListOfBackgroundPlugins+"</div>"),stopPropagation:!0}],restoreHeight:!0}),hint:this.textBackgroundPlugins,lock:[t.viewMode,t.previewReviewMode,t.viewFormMode,t.docLockView,t.docLockForms,t.docLockComments,t.selRangeEdit,t.editFormula],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"});return this.lockedControls.push(e),e},createPluginButton:function(t){if(!t.get("visible"))return null;var e,i=this,o=t.get("variations"),n=t.get("guid"),s=o[t.get("currentVariation")].get("icons");""===s?e="toolbar__icon btn-plugin-default":t.set("parsedIcons",this.parseIcons(s));var a=[];_.each(t.get("variations"),(function(t,e){t.get("visible")&&a.push({caption:e>0?t.get("description"):i.textStart,value:parseInt(t.get("index")),isRun:!1})}));var r=Common.enumLock,l=new Common.UI.ButtonCustom({cls:"btn-toolbar x-huge icon-top",iconCls:e,iconsSet:this.iconsStr2IconsObj(s),baseUrl:t.get("baseUrl"),caption:Common.Utils.String.htmlEncode(t.get("name")),menu:a.length>1,split:a.length>1,value:n,isRun:!1,hint:t.get("name"),lock:t.get("isDisplayedInViewer")?[r.viewMode,r.previewReviewMode,r.viewFormMode,r.selRangeEdit,r.editFormula]:[r.viewMode,r.previewReviewMode,r.viewFormMode,r.docLockView,r.docLockForms,r.docLockComments,r.selRangeEdit,r.editFormula],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"});return l.split&&(l.setMenu(new Common.UI.Menu({items:a,pluginGuid:t.get("guid")})),l.menu.on("item:click",(function(t,e,o){i.fireEvent("plugin:select",[t.options.pluginGuid,e.value,e.isRun,0===e.value&&e.isRun])}))),l.on("click",(function(t,e){i.fireEvent("plugin:select",[t.options.value,0,l.options.isRun])})),t.set("button",l),i.lockedControls.push(l),l},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.fireEvent("hide",this)},showPluginPanel:function(t,e){var i=this.pluginPanels[e]?this.pluginPanels[e]:this.customPluginPanels[e],o=this.pluginPanels[e]?this.storePlugins.findWhere({guid:e}).get("menu"):i.menu;if(t){for(var n in this.pluginPanels)this.pluginPanels[n].menu===o&&this.pluginPanels[n].$el.removeClass("active");for(var n in this.customPluginPanels)this.customPluginPanels[n].menu===o&&this.customPluginPanels[n].$el.removeClass("active");i.$el.addClass("active")}else i.$el.removeClass("active"),this.fireEvent("right"===o?"pluginsright:hide":"pluginsleft:hide",this)},strPlugins:"Plugins",textStart:"Start",textStop:"Stop",groupCaption:"Plugins",tipMore:"More",textBackgroundPlugins:"Background Plugins",textTheListOfBackgroundPlugins:"The list of background plugins",textSettings:"Settings"},Common.Views.Plugins||{}))})),define("text!spreadsheeteditor/main/app/template/FileMenu.template",[],(function(){return'<div class="panel-menu" role="menubar" aria-label="<%= scope.ariaFileMenu %>">\r\n    <li id="fm-btn-return" class="fm-btn" data-layout-name="toolbar-file-close"></li>\r\n    <li class="devider devider-small"></li>\r\n    <li id="fm-btn-create" class="fm-btn"></li>\r\n    <li id="fm-btn-recent" class="fm-btn"></li>\r\n    <li class="devider devider-small"></li>\r\n    <li id="fm-btn-save" class="fm-btn" data-layout-name="toolbar-file-save"></li>\r\n    <li id="fm-btn-edit" class="fm-btn"></li>\r\n    <li id="fm-btn-download" class="fm-btn"></li>\r\n    <li id="fm-btn-save-copy" class="fm-btn"></li>\r\n    <li id="fm-btn-save-desktop" class="fm-btn"></li>\r\n    <li id="fm-btn-export-pdf" class="fm-btn"></li>\r\n    <li id="fm-btn-print-with-preview" class="fm-btn"></li>\r\n    <li id="fm-btn-rename" class="fm-btn"></li>\r\n    <li id="fm-btn-protect" class="fm-btn"></li>\r\n    <li class="devider"></li>\r\n    <li id="fm-btn-info" class="fm-btn" data-layout-name="toolbar-file-info"></li>\r\n    <li id="fm-btn-history" class="fm-btn"></li>\r\n    <li id="fm-btn-rights" class="fm-btn"></li>\r\n    <li id="fm-btn-back" class="fm-btn"></li>\r\n    <li class="devider-last"></li>\r\n    <li class="devider"></li>\r\n    <li id="fm-btn-settings" class="fm-btn" data-layout-name="toolbar-file-settings"></li>\r\n    <li id="fm-btn-help" class="fm-btn"></li>\r\n</div>\r\n<div class="panel-context">\r\n    <div id="panel-saveas" class="content-box"></div>\r\n    <div id="panel-savecopy" class="content-box"></div>\r\n    <div id="panel-recentfiles" class="content-box"></div>\r\n    <div id="panel-createnew" class="content-box"></div>\r\n    <div id="panel-info" class="content-box"></div>\r\n    <div id="panel-rights" class="content-box"></div>\r\n    <div id="panel-settings" class="content-box"></div>\r\n    <div id="panel-help" class="content-box"></div>\r\n    <div id="panel-protect" class="content-box"></div>\r\n    <div id="panel-print" class="content-box"></div>\r\n</div>'})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/RecentFiles",["common/main/lib/component/BaseView"],(function(){"use strict";Common.Views.RecentFiles=Common.UI.BaseView.extend(_.extend({menu:void 0,template:_.template(['<div class="header"><%= scope.txtOpenRecent %></div>','<div id="id-recent-view"></div>'].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=t.menu,this.recent=t.recent,this.el=t.el,Common.NotificationCenter.on("update:recents",function(t){if(this.viewRecentPicker){var e=this.viewRecentPicker.store;e&&e.reset(this.recent.concat(t))}}.bind(this))},render:function(){return this.$el.html(this.template({scope:this})),this.viewRecentPicker=new Common.UI.DataView({el:$("#id-recent-view"),store:new Common.UI.DataViewStore(this.recent),itemTemplate:_.template(['<div class="recent-wrap">','<div class="recent-icon">',"<div>",'<div class= <% if (typeof format !== "undefined") {%> "img-format-<%=format %>"<% } else {%> "svg-file-recent"<%} %>></div>',"</div>","</div>",'<div class="file-name"><% if (typeof title !== "undefined") {%><%= Common.Utils.String.htmlEncode(title || "") %><% } %></div>','<div class="file-info"><% if (typeof folder !== "undefined") {%><%= Common.Utils.String.htmlEncode(folder || "") %><% } %></div>',"</div>"].join(""))}),this.viewRecentPicker.on("item:click",_.bind(this.onRecentFileClick,this)),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:this.$el,suppressScrollX:!0,alwaysVisibleY:!0})),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.scroller&&this.scroller.update()},onRecentFileClick:function(t,e,i){this.menu&&!Common.Controllers.Desktop.openRecent(i)&&this.menu.fireEvent("recent:open",[this.menu,i.get("url")])},txtOpenRecent:"Open Recent"},Common.Views.RecentFiles||{}))})),define("spreadsheeteditor/main/app/view/FileMenu",["text!spreadsheeteditor/main/app/template/FileMenu.template","underscore","common/main/lib/component/BaseView","common/main/lib/view/RecentFiles"],(function(t,e){"use strict";SSE.Views.FileMenu=Common.UI.BaseView.extend(e.extend({el:"#file-menu-panel",rendered:!1,options:{alias:"FileMenu"},template:e.template(t),events:function(){return{"click .fm-btn":e.bind((function(t){var i=$(t.currentTarget);i.hasClass("active")||($(".fm-btn",this.el).removeClass("active"),i.addClass("active"));var o=e.findWhere(this.items,{el:t.currentTarget});if(o){var n=this.panels[o.options.action];if("help"===o.options.action&&!0===n.noHelpContents&&navigator.onLine){this.fireEvent("item:click",[this,"external-help",!0]);var s=Common.Utils.InternalSettings.get("url-help-center");return void(s&&window.open(s,"_blank"))}this.fireEvent("item:click",[this,o.options.action,!!n]),n&&(this.$el.find(".content-box:visible").hide(),this.active=o.options.action,n.show())}}),this)}},initialize:function(){},render:function(){var t=$(this.template({scope:this}));if(this.miClose=new Common.UI.MenuItem({el:t.elementById("#fm-btn-return"),action:"back",caption:this.btnCloseMenuCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-previtem icon-rtl"}),this.miSave=new Common.UI.MenuItem({el:t.elementById("#fm-btn-save"),action:"save",caption:this.btnSaveCaption,canFocused:!1,disabled:!0,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],dataHintTitle:"S",iconCls:"menu__icon btn-save"}),this.options.miSave&&(this.miSave.setDisabled(this.options.miSave.isDisabled()),delete this.options.miSave),this.miEdit=new Common.UI.MenuItem({el:t.elementById("#fm-btn-edit"),action:"edit",caption:this.btnToEditCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-edit"}),this.miDownload=new Common.UI.MenuItem({el:t.elementById("#fm-btn-download"),action:"saveas",caption:this.btnDownloadCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-download"}),this.miSaveCopyAs=new Common.UI.MenuItem({el:t.elementById("#fm-btn-save-copy"),action:"save-copy",caption:this.btnSaveCopyAsCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-save-copy"}),this.miSaveAs=new Common.UI.MenuItem({el:t.elementById("#fm-btn-save-desktop"),action:"save-desktop",caption:this.btnSaveAsCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.miExportToPDF=new Common.UI.MenuItem({el:t.elementById("#fm-btn-export-pdf"),action:"export-pdf",caption:this.btnExportToPDFCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.miPrintWithPreview=new Common.UI.MenuItem({el:t.elementById("#fm-btn-print-with-preview"),action:"printpreview",caption:this.btnPrintCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],dataHintTitle:"P",iconCls:"menu__icon btn-print"}),this.miRename=new Common.UI.MenuItem({el:t.elementById("#fm-btn-rename"),action:"rename",caption:this.btnRenameCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-rename"}),this.options.miRename&&(this.miRename.setDisabled(this.options.miRename.isDisabled()),delete this.options.miRename),this.miProtect=new Common.UI.MenuItem({el:t.elementById("#fm-btn-protect"),action:"protect",caption:this.btnProtectCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-lock"}),this.options.miProtect&&(this.miProtect.setDisabled(this.options.miProtect.isDisabled()),delete this.options.miProtect),this.miRecent=new Common.UI.MenuItem({el:t.elementById("#fm-btn-recent"),action:"recent",caption:this.btnRecentFilesCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[2,14]}),this.miNew=new Common.UI.MenuItem({el:t.elementById("#fm-btn-create"),action:"new",caption:this.btnCreateNewCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-create-new"}),this.miInfo=new Common.UI.MenuItem({el:t.elementById("#fm-btn-info"),action:"info",caption:this.btnInfoCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-menu-about"}),this.miAccess=new Common.UI.MenuItem({el:t.elementById("#fm-btn-rights"),action:"rights",caption:this.btnRightsCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-users-share"}),this.miSettings=new Common.UI.MenuItem({el:t.elementById("#fm-btn-settings"),action:"opts",caption:this.btnSettingsCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-settings"}),this.miHelp=new Common.UI.MenuItem({el:t.elementById("#fm-btn-help"),action:"help",caption:this.btnHelpCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-help"}),this.miHistory=new Common.UI.MenuItem({el:t.elementById("#fm-btn-history"),action:"history",caption:this.btnHistoryCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-version-history"}),this.miBack=new Common.UI.MenuItem({el:t.elementById("#fm-btn-back"),action:"exit",caption:this.btnBackCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-goback"}),this.items=[],this.items.push(this.miClose,this.miSave,this.miEdit,this.miDownload,this.miSaveCopyAs,this.miSaveAs,this.miExportToPDF,this.miPrintWithPreview,this.miRename,this.miProtect,this.miRecent,this.miNew,this.miInfo,this.miAccess,this.miHistory,this.miSettings,this.miHelp,this.miBack),this.rendered=!0,this.$el.html(t),this.$el.find(".content-box").hide(),e.isUndefined(this.scroller)){var i=this;this.scroller=new Common.UI.Scroller({el:this.$el.find(".panel-menu"),suppressScrollX:!0,alwaysVisibleY:!0}),Common.NotificationCenter.on("window:resize",(function(){i.scroller.update()}))}return this.applyMode(),Common.Controllers.Desktop.isActive()&&Common.NotificationCenter.trigger("update:recents",Common.Controllers.Desktop.recentFiles()),this.api&&(this.panels.info.setApi(this.api),this.panels.protect&&this.panels.protect.setApi(this.api),this.panels.opts&&this.panels.opts.setApi(this.api)),this.fireEvent("render:after",this),this},show:function(t,e){if((!this.isVisible()||void 0!==t)&&this.mode&&Common.Controllers.LaunchController.isScriptLoaded()){this.rendered||this.render();var i=!this.mode.canDownload||this.mode.isDesktopApp&&this.mode.isOffline?"info":"saveas";t||(t=this.active||i),this.$el.show(),this.scroller.update(),this.selectMenu(t,e,i),this.api.asc_enableKeyEvents(!1),this.fireEvent("menu:show",[this])}},hide:function(){this.$el.hide(),this.fireEvent("menu:hide",[this])},applyMode:function(){if(this.rendered&&(this.panels||(this.panels={opts:new SSE.Views.FileMenuPanels.MainSettingsGeneral({menu:this}).render(this.$el.find("#panel-settings")),info:new SSE.Views.FileMenuPanels.DocumentInfo({menu:this}).render(this.$el.find("#panel-info")),rights:new SSE.Views.FileMenuPanels.DocumentRights({menu:this}).render(this.$el.find("#panel-rights"))}),this.mode)){var t=Common.UI.LayoutManager.isElementVisible("toolbar-file-close");this.miClose[t?"show":"hide"](),this.miDownload[!this.mode.canDownload||this.mode.isDesktopApp&&this.mode.isOffline?"hide":"show"]();var e=!!window.AscDesktopEditor&&window.AscDesktopEditor.isBlockchainSupport();if(this.miSaveCopyAs[!this.mode.canDownload||this.mode.isDesktopApp&&this.mode.isOffline||!this.mode.canRequestSaveAs&&!this.mode.saveAsUrl||e?"hide":"show"](),this.miSaveAs[this.mode.canDownload&&this.mode.isDesktopApp&&this.mode.isOffline?"show":"hide"](),this.miExportToPDF[this.mode.canDownload&&this.mode.isDesktopApp&&this.mode.isOffline?"show":"hide"](),this.miSave[this.mode.showSaveButton&&Common.UI.LayoutManager.isElementVisible("toolbar-file-save")?"show":"hide"](),this.miEdit[!this.mode.isEdit&&this.mode.canEdit&&this.mode.canRequestEditRights?"show":"hide"](),this.miPrintWithPreview[this.mode.canPrint?"show":"hide"](),this.miRename[this.mode.canRename&&!this.mode.isDesktopApp?"show":"hide"](),this.miProtect[this.mode.isSignatureSupport||this.mode.isPasswordSupport?"show":"hide"](),this.miRecent[this.mode.canOpenRecent?"show":"hide"](),this.miNew[this.mode.canCreateNew?"show":"hide"](),t=Common.UI.LayoutManager.isElementVisible("toolbar-file-info"),this.miInfo[t?"show":"hide"](),t=!this.mode.isOffline&&this.document&&this.document.info&&(this.document.info.sharingSettings&&this.document.info.sharingSettings.length>0||this.mode.sharingSettingsUrl&&this.mode.sharingSettingsUrl.length||this.mode.canRequestSharingSettings),this.miAccess[t?"show":"hide"](),t=this.mode.canUseHistory&&!this.mode.isDisconnected,this.miHistory[t?"show":"hide"](),t=Common.UI.LayoutManager.isElementVisible("toolbar-file-settings"),this.miSettings[t?"show":"hide"](),t=this.mode.canHelp,this.miHelp[t?"show":"hide"](),t=this.mode.canBack,this.miBack[t?"show":"hide"](),this.customizationDone||(this.customizationDone=!0,this.mode.canBack&&this.mode.customization.goback.text&&"string"==typeof this.mode.customization.goback.text&&this.miBack.setCaption(this.mode.customization.goback.text)),this.panels.opts.setMode(this.mode),this.panels.info.setMode(this.mode),!this.mode.isDisconnected&&this.panels.info.updateInfo(this.document),this.panels.rights.setMode(this.mode),!this.mode.isDisconnected&&this.panels.rights.updateInfo(this.document),this.panels.printpreview&&this.panels.printpreview.setMode(this.mode),this.mode.canCreateNew&&this.mode.templates&&this.mode.templates.length&&!this.panels.new&&(this.panels.new=new SSE.Views.FileMenuPanels.CreateNew({menu:this,docs:this.mode.templates,blank:this.mode.canRequestCreateNew||!!this.mode.createUrl}).render()),this.mode.canOpenRecent&&this.mode.recent&&!this.panels.recent&&(this.panels.recent=new Common.Views.RecentFiles({el:"#panel-recentfiles",menu:this,recent:this.mode.recent}).render()),(this.mode.isSignatureSupport||this.mode.isPasswordSupport)&&(!this.panels.protect&&(this.panels.protect=new SSE.Views.FileMenuPanels.ProtectDoc({menu:this}).render()),this.panels.protect.setMode(this.mode)),this.mode.canDownload&&!this.panels.saveas&&(this.panels.saveas=new SSE.Views.FileMenuPanels.ViewSaveAs({menu:this,fileType:this.document.fileType}).render()),this.mode.canDownload&&(this.mode.canRequestSaveAs||this.mode.saveAsUrl)&&!this.panels["save-copy"]&&(this.panels["save-copy"]=new SSE.Views.FileMenuPanels.ViewSaveCopy({menu:this,fileType:this.document.fileType}).render()),this.mode.canHelp&&!this.panels.help&&(this.panels.help=new SSE.Views.FileMenuPanels.Help({menu:this}).render(),this.panels.help.setLangConfig(this.mode.lang)),null!=this.mode.disableEditing&&(this.panels.opts.SetDisabled(this.mode.disableEditing),delete this.mode.disableEditing),this.mode.canPrint){var i=SSE.getController("Print").getView("PrintWithPreview");i.menu=this,!this.panels.printpreview&&(this.panels.printpreview=i.render(this.$el.find("#panel-print")))}Common.Controllers.Desktop.isActive()?(this.$el.find("#fm-btn-local-open").length<1&&($('<li id="fm-btn-local-open" class="fm-btn"/>').insertBefore($("#fm-btn-recent",this.$el)),this.items.push(new Common.UI.MenuItem({el:$("#fm-btn-local-open",this.$el),action:"file:open",caption:this.btnFileOpenCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-open"}))),this.$el.find("#fm-btn-exit").length<1&&($('<li class="devider" /><li id="fm-btn-exit" class="fm-btn"/>').insertAfter($("#fm-btn-back",this.$el)),this.items.push(new Common.UI.MenuItem({el:$("#fm-btn-exit",this.$el),action:"file:exit",caption:this.btnExitCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-close"})))):this.mode.canCloseEditor&&this.$el.find("#fm-btn-close").length<1&&($('<li class="devider" /><li id="fm-btn-close" class="fm-btn"/>').insertAfter($("#fm-btn-back",this.$el)),this.items.push(new Common.UI.MenuItem({el:$("#fm-btn-close",this.$el),action:"close-editor",caption:this.mode.customization.close.text||this.btnCloseEditor,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-close"}))),this.mode.canSwitchToMobile&&($('<li id="fm-btn-switchmobile" class="fm-btn"></li>').insertBefore($("#fm-btn-settings",this.$el)),this.items.push(new Common.UI.MenuItem({el:$("#fm-btn-switchmobile",this.$el),action:"switch:mobile",caption:this.btnSwitchToMobileCaption,canFocused:!1,dataHint:1,dataHintDirection:"left-top",dataHintOffset:[-2,22],iconCls:"menu__icon btn-switch-mobile"}))),this.hideDividers()}},hideDividers:function(){var t=Array.from(this.$el.find(".panel-menu > li")),e=t.map((function(t,e){return{el:t,i:e}})).filter((function(t){var e=t.el;return $(e).hasClass("fm-btn")&&"none"!==$(e).css("display")}));if(e.length)for(var i=e[0].i,o=e[e.length-1].i,n=!1,s=t.length-1;s>=0;s--){var a=$(t[s]);if(a.hasClass("devider"))s>i&&s<o&&!n?(a.show(),n=!0):a.hide();else a.hasClass("fm-btn")&&"none"!==a.css("display")&&(n=!1)}else t.forEach((function(t){var e=$(t);e.hasClass("devider")&&e.css("display","none")}))},setMode:function(t,e){t.isDisconnected?(this.mode.canEdit=this.mode.isEdit=!1,this.mode.canOpenRecent=this.mode.canCreateNew=!1,this.mode.isDisconnected=t.isDisconnected,this.mode.canRename=!1,t.enableDownload||(this.mode.canPrint=this.mode.canDownload=!1)):this.mode=t,e||this.applyMode()},setApi:function(t){this.api=t,this.rendered&&(this.panels.info.setApi(t),this.panels.opts&&this.panels.opts.setApi(t),this.panels.protect&&this.panels.protect.setApi(t)),this.api.asc_registerCallback("asc_onDocumentName",e.bind(this.onDocumentName,this))},loadDocument:function(t){this.document=t.doc},selectMenu:function(t,e,i){if(t){var o=this._getMenuItem(t),n=this.panels[t];if(!o.isDisabled()&&o.isVisible()||(o=this._getMenuItem(i),n=this.panels[i]),o&&n){if($(".fm-btn",this.el).removeClass("active"),o.$el.addClass("active"),this.$el.find(".content-box:visible").hide(),n.show(e),this.scroller){var s=Common.Utils.getPosition(o.$el).top,a=o.$el.outerHeight(),r=this.$el.outerHeight();if(s<0||s+a>r){var l=this.scroller.$el.scrollTop()+s+(a-r)/2;l=Math.floor(l/a)*a,this.scroller.scrollTop(l)}}this.active=t}}},_getMenuItem:function(t){return e.find(this.items,(function(e){return e.options.action==t}))},onDocumentName:function(t){this.document.title=t,this.rendered&&this.panels.info.updateInfo(this.document)},isVisible:function(){return!this.$el.is(":hidden")},getButton:function(t){if(this.rendered){if("save"==t)return this.miSave;if("rename"==t)return this.miRename;if("protect"==t)return this.miProtect}else{if("save"==t)return this.options.miSave?this.options.miSave:this.options.miSave=new Common.UI.MenuItem({});if("rename"==t)return this.options.miRename?this.options.miRename:this.options.miRename=new Common.UI.MenuItem({});if("protect"==t)return this.options.miProtect?this.options.miProtect:this.options.miProtect=new Common.UI.MenuItem({})}},SetDisabled:function(t,e){if(this.mode){this.panels?this.panels.opts.SetDisabled(t):this.mode.disableEditing=t;var i=this.getButton("protect");e&&e.protect&&i.setDisabled(t||!this.mode.isEdit)}},btnSaveCaption:"Save",btnDownloadCaption:"Download as...",btnInfoCaption:"Document Info...",btnRightsCaption:"Access Rights...",btnCreateNewCaption:"Create New",btnRecentFilesCaption:"Open Recent...",btnPrintCaption:"Print",btnHelpCaption:"Help...",btnReturnCaption:"Back to Document",btnToEditCaption:"Edit Document",btnBackCaption:"Go to Documents",btnSettingsCaption:"Advanced Settings...",btnSaveAsCaption:"Save as",btnRenameCaption:"Rename...",btnCloseMenuCaption:"Back",btnProtectCaption:"Protect",btnSaveCopyAsCaption:"Save Copy as...",btnHistoryCaption:"Versions History",btnExitCaption:"Exit",btnFileOpenCaption:"Open...",btnExportToPDFCaption:"Export to PDF",btnCloseEditor:"Close File",ariaFileMenu:"File menu"},SSE.Views.FileMenu||{}))})),define("spreadsheeteditor/main/app/view/LeftMenu",["text!spreadsheeteditor/main/app/template/LeftMenu.template","jquery","underscore","backbone","common/main/lib/component/SideMenu","common/main/lib/component/Button","common/main/lib/view/About","common/main/lib/view/Comments","common/main/lib/view/Chat","common/main/lib/view/History","common/main/lib/view/Plugins","spreadsheeteditor/main/app/view/FileMenu"],(function(t,e,i,o){"use strict";var n=40;SSE.Views.LeftMenu=Common.UI.SideMenu.extend(i.extend({el:"#left-menu",template:i.template(t),initialize:function(){this.minimizedMode=!0,this._state={disabled:!1}},render:function(){var t=e(this.template({scope:this}));return this.btnMoreContainer=t.find("#slot-left-menu-more"),Common.UI.SideMenu.prototype.render.call(this),this.btnMore.menu.menuAlign="tl-tr",this.btnSearchBar=new Common.UI.Button({action:"advancedsearch",el:t.elementById("#left-btn-searchbar"),hint:this.tipSearch,disabled:!0,iconCls:"btn-menu-search",enableToggle:!0,toggleGroup:"leftMenuGroup"}),this.btnSearchBar.on("click",i.bind(this.onBtnMenuClick,this)),this.btnAbout=new Common.UI.Button({action:"about",el:t.elementById("#left-btn-about"),hint:this.tipAbout,enableToggle:!0,disabled:!0,iconCls:"btn-menu-about",toggleGroup:"leftMenuGroup"}),this.btnAbout.on("toggle",i.bind(this.onBtnMenuToggle,this)),this.btnSupport=new Common.UI.Button({action:"support",el:t.elementById("#left-btn-support"),hint:this.tipSupport,disabled:!0,iconCls:"btn-menu-support"}),this.btnSupport.on("click",i.bind((function(){var t=this.mode.customization;t&&t.feedback&&t.feedback.url?window.open(t.feedback.url):window.open("https://support.onlyoffice.com"),Common.NotificationCenter.trigger("edit:complete",this)}),this)),this.btnComments=new Common.UI.Button({el:t.elementById("#left-btn-comments"),hint:this.tipComments+Common.Utils.String.platformKey("Ctrl+Shift+H"),enableToggle:!0,disabled:!0,iconCls:"btn-menu-comments",toggleGroup:"leftMenuGroup"}),this.btnComments.on("toggle",this.onBtnCommentsToggle.bind(this)),this.btnComments.on("click",this.onBtnMenuClick.bind(this)),this.btnChat=new Common.UI.Button({el:t.elementById("#left-btn-chat"),hint:this.tipChat+Common.Utils.String.platformKey("Alt+Q"," ("+(Common.Utils.isMac?Common.Utils.String.textCtrl+"+":"")+"{0})"),enableToggle:!0,disabled:!0,iconCls:"btn-menu-chat",toggleGroup:"leftMenuGroup"}),this.btnChat.on("click",this.onBtnMenuClick.bind(this)),this.btnComments.hide(),this.btnChat.hide(),this.btnSpellcheck=new Common.UI.Button({el:t.elementById("#left-btn-spellcheck"),hint:this.tipSpellcheck,enableToggle:!0,disabled:!0,iconCls:"btn-ic-docspell",toggleGroup:"leftMenuGroup"}),this.btnSpellcheck.hide(),this.btnSpellcheck.on("click",i.bind(this.onBtnMenuClick,this)),this.menuFile=new SSE.Views.FileMenu({}),this.btnAbout.panel=new Common.Views.About({el:"#about-menu-panel",appName:this.txtEditor}),this.$el.html(t),this},onBtnMenuToggle:function(t,e){e?(t.panel.show(),this._state.pluginIsRunning||this.$el.width(n)):t.panel.hide(),SSE.getController("Toolbar").DisableToolbar(1==e),Common.NotificationCenter.trigger("layout:changed","leftmenu")},onBtnCommentsToggle:function(t,e){e||this.fireEvent("comments:hide",this)},onBtnMenuClick:function(t,i){if(this.btnAbout.toggle(!1),t.pressed)this.$el.width()>n||this.$el.width(Common.localStorage.getItem("sse-mainmenu-width")||300);else if(!this._state.pluginIsRunning){var o=this.$el.width();this.isVisible()&&o>n&&Common.localStorage.setItem("sse-mainmenu-width",o),this.$el.width(n)}this.onCoauthOptions(),t.pressed&&"advancedsearch"==t.options.action&&this.fireEvent("search:aftershow",this),"plugin"!==t.options.type&&e(".left-panel .plugin-panel").toggleClass("active",!1),Common.NotificationCenter.trigger("layout:changed","leftmenu")},onCoauthOptions:function(t){this.mode.canCoAuthoring&&(this.mode.canViewComments&&(this.btnComments.pressed&&this.btnComments.$el.hasClass("notify")&&this.btnComments.$el.removeClass("notify"),this.panelComments[this.btnComments.pressed?"show":"hide"](),this.fireEvent(this.btnComments.pressed?"comments:show":"comments:hide",this)),this.mode.canChat&&(this.btnChat.pressed?(this.btnChat.$el.hasClass("notify")&&this.btnChat.$el.removeClass("notify"),this.panelChat.show(),this.panelChat.focus()):this.panelChat.hide())),this.panelSpellcheck&&(this.btnSpellcheck.pressed?this.panelSpellcheck.show():this.panelSpellcheck.hide()),this.panelSearch&&(this.btnSearchBar.pressed?(this.panelSearch.show(),this.panelSearch.focus()):this.panelSearch.hide())},getFocusElement:function(){var t=!1;return this.btnChat&&this.btnChat.pressed?t=this.panelChat.getFocusElement():this.btnSearchBar&&this.btnSearchBar.pressed&&(t=this.panelSearch.getFocusElement()),t},setOptionsPanel:function(t,e){"chat"==t?this.panelChat=e.render("#left-panel-chat"):"comment"==t?this.panelComments=e:"spellcheck"!=t||this.panelSpellcheck?"history"==t?this.panelHistory=e.render("#left-panel-history"):"advancedsearch"==t&&(this.panelSearch=e.render("#left-panel-search")):this.panelSpellcheck=e.render("#left-panel-spellcheck")},markCoauthOptions:function(t,e){"chat"!=t||!this.btnChat.isVisible()&&!this.isButtonInMoreMenu(this.btnChat)||this.btnChat.isDisabled()||this.btnChat.pressed||this.btnChat.$el.addClass("notify"),"comments"!=t||!this.btnComments.isVisible()&&!this.isButtonInMoreMenu(this.btnComments)||this.btnComments.pressed||this.btnComments.isDisabled()&&!e||this.btnComments.$el.addClass("notify")},close:function(t){this.btnAbout.toggle(!1),this._state.pluginIsRunning||this.$el.width(n),this.mode&&this.mode.canCoAuthoring&&(this.mode.canViewComments&&(this.panelComments&&this.panelComments.hide(),this.btnComments.pressed&&this.fireEvent("comments:hide",this),this.btnComments.toggle(!1,!0)),this.mode.canChat&&(this.panelChat&&this.panelChat.hide(),this.btnChat.toggle(!1))),this.panelSpellcheck&&(this.panelSpellcheck.hide(),this.btnSpellcheck.toggle(!1,!0)),this.panelSearch&&(this.panelSearch.hide(),this.btnSearchBar.toggle(!1,!0)),this.toggleActivePluginButton(!1)},isOpened:function(){var t=this.btnSearchBar.pressed;return!t&&(t=this.btnComments.pressed||this.btnChat.pressed),t},disableMenu:function(t,e){this.btnAbout.setDisabled(!1),this.btnSupport.setDisabled(!1),this.btnSearchBar.setDisabled(!1),this.btnComments.setDisabled(!1),this.btnChat.setDisabled(!1),this.btnSpellcheck.setDisabled(!1)},showMenu:function(t,e){var i=/^(\w+):?(\w*)$/.exec(t);if("file"==i[1]){if(!Common.Controllers.LaunchController.isScriptLoaded())return;this.menuFile.show(i[2].length?i[2]:void 0,e)}else"chat"==t?!this.btnChat.isVisible()&&!this.isButtonInMoreMenu(this.btnChat)||this.btnChat.isDisabled()||this.btnChat.pressed||(this.btnChat.toggle(!0),this.onBtnMenuClick(this.btnChat),this.panelChat.focus()):"comments"==t?!this.btnComments.isVisible()&&!this.isButtonInMoreMenu(this.btnComments)||this.btnComments.isDisabled()||this.btnComments.pressed||(this.btnComments.toggle(!0),this.onBtnMenuClick(this.btnComments),this.btnComments.$el.focus()):"advancedsearch"==t&&(!this.btnSearchBar.isVisible()&&!this.isButtonInMoreMenu(this.btnSearchBar)||this.btnSearchBar.isDisabled()||this.btnSearchBar.pressed||(this.btnSearchBar.toggle(!0),this.onBtnMenuClick(this.btnSearchBar)))},getMenu:function(t){switch(t){case"file":return this.menuFile;case"about":return this.btnAbout.panel;default:return null}},setMode:function(t){return this.mode=t,this.btnAbout.panel.setMode(t),this},setDeveloperMode:function(t,o,n){if(this.$el.is(":visible")){if((t&Asc.c_oLicenseMode.Trial||t&Asc.c_oLicenseMode.Developer)&&!this.developerHint){var s="";t&Asc.c_oLicenseMode.Trial&&t&Asc.c_oLicenseMode.Developer?s=this.txtTrialDev:0!=(t&Asc.c_oLicenseMode.Trial)?s=this.txtTrial:0!=(t&Asc.c_oLicenseMode.Developer)&&(s=this.txtDeveloper),s=s.toUpperCase(),this.developerHint=e('<div id="developer-hint">'+s+"</div>").appendTo(this.$el),this.devHeight=this.developerHint.outerHeight(),!this.devHintInited&&e(window).on("resize",i.bind(this.onWindowResize,this)),this.devHintInited=!0}if(this.developerHint&&this.developerHint.toggleClass("hidden",!(t&Asc.c_oLicenseMode.Trial||t&Asc.c_oLicenseMode.Developer)),o&&!this.betaHint){var a=t?'style="margin-top: 4px;"':"",r=(n||"").split("."),l="";r.length>0&&(l+="v. "+r[0]),r.length>1&&(l+="."+r[1]),this.betaHint=e('<div id="beta-hint"'+a+">"+l+" (beta)</div>").appendTo(this.$el),this.betaHeight=this.betaHint.outerHeight(),!this.devHintInited&&e(window).on("resize",i.bind(this.onWindowResize,this)),this.devHintInited=!0}this.betaHint&&this.betaHint.toggleClass("hidden",!o);var c=this.$el.find("button.btn-category:visible"),h=c.length>0?e(c[c.length-1]):null;this.minDevPosition=h?Common.Utils.getOffset(h).top-Common.Utils.getOffset(h.offsetParent()).top+h.height()+20:20,this.onWindowResize()}},setLimitMode:function(){if(this.$el.is(":visible")){if(!this.limitHint){var t=this.txtLimit.toUpperCase();this.limitHint=e('<div id="limit-hint" style="margin-top: 4px;">'+t+"</div>").appendTo(this.$el),this.limitHeight=this.limitHint.outerHeight(),!this.devHintInited&&e(window).on("resize",i.bind(this.onWindowResize,this)),this.devHintInited=!0}this.limitHint&&this.limitHint.toggleClass("hidden",!1);var o=this.$el.find("button.btn-category:visible"),n=o.length>0?e(o[o.length-1]):null;this.minDevPosition=n?Common.Utils.getOffset(n).top-Common.Utils.getOffset(n.offsetParent()).top+n.height()+20:20,this.onWindowResize()}},onWindowResize:function(){var t=(this.devHeight||0)+(this.betaHeight||0)+(this.limitHeight||0),e=Math.max((this.$el.height()-t)/2,this.minDevPosition);this.developerHint&&(this.developerHint.css("top",e),e+=this.devHeight),this.betaHint&&(this.betaHint.css("top",e),e+=this.betaHeight+4),this.limitHint&&this.limitHint.css("top",e)},showHistory:function(){this._state.pluginIsRunning=!1,this._state.historyIsRunning=!0,this.panelHistory.show(),this.panelHistory.$el.width((parseInt(Common.localStorage.getItem("sse-mainmenu-width"))||300)-n),Common.NotificationCenter.trigger("layout:changed","history")},isVisible:function(){return this.$el&&this.$el.is(":visible")},setButtons:function(){var t=[this.btnSearchBar,this.btnComments,this.btnChat,this.btnSpellcheck,this.btnSupport,this.btnAbout];Common.UI.SideMenu.prototype.setButtons.apply(this,[t])},tipComments:"Comments",tipChat:"Chat",tipAbout:"About",tipSupport:"Feedback & Support",tipFile:"File",tipSearch:"Search",tipPlugins:"Plugins",txtDeveloper:"DEVELOPER MODE",txtTrial:"TRIAL MODE",tipSpellcheck:"Spell checking",txtTrialDev:"Trial Developer Mode",txtLimit:"Limit Access",txtEditor:"Spreadsheet Editor",ariaLeftMenu:"Left menu"},SSE.Views.LeftMenu||{}))})),define("spreadsheeteditor/main/app/controller/LeftMenu",["core","common/main/lib/util/Shortcuts","spreadsheeteditor/main/app/view/LeftMenu","spreadsheeteditor/main/app/view/FileMenu"],(function(){"use strict";SSE.Controllers.LeftMenu=Backbone.Controller.extend(_.extend({views:["LeftMenu","FileMenu"],initialize:function(){this.addListeners({"Common.Views.Chat":{hide:_.bind(this.onHideChat,this)},"Common.Views.Plugins":{"plugins:addtoleft":_.bind(this.addNewPlugin,this),"pluginsleft:open":_.bind(this.openPlugin,this),"pluginsleft:close":_.bind(this.closePlugin,this),"pluginsleft:hide":_.bind(this.onHidePlugins,this),"pluginsleft:updateicons":_.bind(this.updatePluginButtonsIcons,this)},"Common.Views.Header":{"history:show":function(){this.leftMenu.panelHistory.isVisible()||this.clickMenuFileItem("header","history")}.bind(this),rename:_.bind((function(t){this.mode&&this.mode.wopi&&this.api?this.api.asc_wopi_renameFile(t):Common.Gateway.requestRename(t)}),this)},LeftMenu:{"file:show":_.bind(this.fileShowHide,this,!0),"file:hide":_.bind(this.fileShowHide,this,!1),"comments:show":_.bind(this.commentsShowHide,this,!0),"comments:hide":_.bind(this.commentsShowHide,this,!1),"button:click":_.bind(this.onBtnCategoryClick,this)},"Common.Views.About":{show:_.bind(this.aboutShowHide,this,!0),hide:_.bind(this.aboutShowHide,this,!1)},FileMenu:{"menu:hide":_.bind(this.menuFilesShowHide,this,"hide"),"menu:show":_.bind(this.menuFilesShowHide,this,"show"),"item:click":_.bind(this.clickMenuFileItem,this),"saveas:format":_.bind(this.clickSaveAsFormat,this),"savecopy:format":_.bind((function(t,e,i){this.mode&&this.mode.wopi&&void 0!==i?this.saveAsInWopi(t,e,i):this.clickSaveCopyAsFormat(t,e,i)}),this),"settings:apply":_.bind(this.applySettings,this),"spellcheck:apply":_.bind(this.applySpellcheckSettings,this),"create:new":_.bind(this.onCreateNew,this),"recent:open":_.bind(this.onOpenRecent,this)},Toolbar:{"file:settings":_.bind(this.clickToolbarSettings,this),"file:open":this.clickToolbarTab.bind(this,"file"),"file:close":this.clickToolbarTab.bind(this,"other"),"save:disabled":this.changeToolbarSaveState.bind(this)},"Common.Views.ReviewChanges":{"collaboration:chat":_.bind(this.onShowHideChat,this)},SearchBar:{"search:show":_.bind(this.onShowHideSearch,this)},ViewTab:{"leftmenu:hide":_.bind(this.onLeftMenuHide,this)}}),Common.NotificationCenter.on("app:comment:add",_.bind(this.onAppAddComment,this)),Common.NotificationCenter.on("leftmenu:change",_.bind(this.onMenuChange,this)),Common.NotificationCenter.on("collaboration:history",_.bind((function(){this.leftMenu.panelHistory.isVisible()||this.clickMenuFileItem(null,"history")}),this)),Common.NotificationCenter.on("file:print",_.bind(this.clickToolbarPrint,this)),Common.NotificationCenter.on("script:loaded",_.bind(this.createPostLoadElements,this)),Common.NotificationCenter.on("script:loaded:spellcheck",_.bind(this.initializeSpellcheck,this))},onLaunch:function(){this.leftMenu=this.createView("LeftMenu").render(),this.leftMenu.btnSearchBar.on("toggle",_.bind(this.onMenuSearchBar,this));var t={"command+shift+s,ctrl+shift+s":_.bind(this.onShortcut,this,"save"),"command+f,ctrl+f":_.bind(this.onShortcut,this,"search"),"ctrl+h":_.bind(this.onShortcut,this,"replace"),esc:_.bind(this.onShortcut,this,"escape"),"command+shift+h,ctrl+shift+h":_.bind(this.onShortcut,this,"comments"),f1:_.bind(this.onShortcut,this,"help")};t[Common.Utils.isMac?"ctrl+alt+f":"alt+f"]=_.bind(this.onShortcut,this,"file"),t[Common.Utils.isMac?"ctrl+alt+q":"alt+q"]=_.bind(this.onShortcut,this,"chat"),Common.util.Shortcuts.delegateShortcuts({shortcuts:t}),Common.util.Shortcuts.suspendEvents();var e=this;this.leftMenu.$el.find("button").each((function(){$(this).on("keydown",(function(t){Common.UI.Keys.RETURN!==t.keyCode&&Common.UI.Keys.SPACE!==t.keyCode||(e.leftMenu.btnAbout.toggle(!1),this.blur(),t.preventDefault(),e.api.asc_enableKeyEvents(!0))}))}))},setApi:function(t){if(this.api=t,this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onApiServerDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiServerDisconnect,this)),this.api.asc_registerCallback("asc_onDownloadUrl",_.bind(this.onDownloadUrl,this)),Common.NotificationCenter.on("download:cancel",_.bind(this.onDownloadCancel,this)),this.mode.canCoAuthoring&&(this.mode.canChat&&this.api.asc_registerCallback("asc_onCoAuthoringChatReceiveMessage",_.bind(this.onApiChatMessage,this)),this.mode.canComments)){this.api.asc_registerCallback("asc_onAddComment",_.bind(this.onApiAddComment,this)),this.api.asc_registerCallback("asc_onAddComments",_.bind(this.onApiAddComments,this));var e=this.getApplication().getController("Common.Controllers.Comments").groupCollection;for(var i in e)for(var o=e[i],n=Common.Utils.InternalSettings.get("sse-settings-resolvedcomment"),s=0;s<o.length;++s){var a=o.at(s);if(!a.get("hide")&&a.get("userid")!==this.mode.user.id&&""!==a.get("userid")&&(n||!a.get("resolved"))){this.leftMenu.markCoauthOptions("comments",!0);break}}}return this.mode.isEditMailMerge||this.mode.isEditDiagram||this.mode.isEditOle||this.api.asc_registerCallback("asc_onEditCell",_.bind(this.onApiEditCell,this)),this.leftMenu.getMenu("file").setApi(t),this.mode.canUseHistory&&this.getApplication().getController("Common.Controllers.History").setApi(this.api).setMode(this.mode),this.getApplication().getController("Search").setApi(this.api).setMode(this.mode),this.leftMenu.setOptionsPanel("advancedsearch",this.getApplication().getController("Search").getView("Common.Views.SearchPanel")),this},setMode:function(t){return this.mode=t,this.leftMenu.setMode(t),this.leftMenu.getMenu("file").setMode(t),this},SetDisabled:function(t,e){this.leftMenu._state.disabled!==t&&(this.leftMenu._state.disabled=t,this.mode&&(t?(this.previsEdit=this.mode.isEdit,this.prevcanEdit=this.mode.canEdit,this.mode.isEdit=this.mode.canEdit=!t):(this.mode.isEdit=this.previsEdit,this.mode.canEdit=this.prevcanEdit))),t&&this.leftMenu.close(),(!e||e.comments&&e.comments.disable)&&this.leftMenu.btnComments.setDisabled(t),e&&!e.chat||this.leftMenu.btnChat.setDisabled(t),this.leftMenu.btnSpellcheck.setDisabled(t),this.leftMenu.setDisabledPluginButtons(t)},createDelayedElements:function(){return this.mode.canCoAuthoring?(this.leftMenu.btnComments[this.mode.canViewComments&&!this.mode.isLightVersion?"show":"hide"](),this.mode.canViewComments&&this.leftMenu.setOptionsPanel("comment",this.getApplication().getController("Common.Controllers.Comments").getView("Common.Views.Comments")),this.leftMenu.btnChat[this.mode.canChat&&!this.mode.isLightVersion?"show":"hide"](),this.mode.canChat&&this.leftMenu.setOptionsPanel("chat",this.getApplication().getController("Common.Controllers.Chat").getView("Common.Views.Chat"))):(this.leftMenu.btnChat.hide(),this.leftMenu.btnComments.hide()),this.mode.canUseHistory&&this.leftMenu.setOptionsPanel("history",this.getApplication().getController("Common.Controllers.History").getView("Common.Views.History")),(this.mode.trialMode||this.mode.isBeta)&&this.leftMenu.setDeveloperMode(this.mode.trialMode,this.mode.isBeta,this.mode.buildVersion),Common.util.Shortcuts.resumeEvents(),this.mode.isEditMailMerge||this.mode.isEditDiagram||this.mode.isEditOle||Common.NotificationCenter.on("cells:range",_.bind(this.onCellsRange,this)),this.leftMenu.setButtons(),this.leftMenu.setMoreButton(),this},createPostLoadElements:function(){},initializeSpellcheck:function(){this.mode.isEdit&&Common.UI.FeaturesManager.canChange("spellcheck")&&(Common.UI.LayoutManager.isElementVisible("leftMenu-spellcheck")&&this.leftMenu.btnSpellcheck.show(),this.leftMenu.setOptionsPanel("spellcheck",this.getApplication().getController("Spellcheck").getView("Spellcheck")),this.leftMenu.setButtons(),this.leftMenu.setMoreButton())},enablePlugins:function(){(this.mode.trialMode||this.mode.isBeta)&&this.leftMenu.setDeveloperMode(this.mode.trialMode,this.mode.isBeta,this.mode.buildVersion)},clickMenuFileItem:function(t,e,i){var o=!0;switch(e){case"back":break;case"save":this.api.asc_Save();break;case"save-desktop":this.api.asc_DownloadAs();break;case"export-pdf":Common.NotificationCenter.trigger("export:to",this.leftMenu,Asc.c_oAscFileType.PDF);break;case"print":Common.NotificationCenter.trigger("print",this.leftMenu);break;case"exit":Common.NotificationCenter.trigger("goback");break;case"edit":this.getApplication().getController("Statusbar").setStatusCaption(this.requestEditRightsText),Common.Gateway.requestEditRights();break;case"new":i?o=!1:this.onCreateNew(void 0,"blank");break;case"rename":var n=(s=this).api.asc_getDocumentName();new Common.Views.RenameDialog({filename:n,maxLength:this.mode.wopi?this.mode.wopi.FileNameMaxLength:void 0,handler:function(t,e){"ok"!=t||_.isEmpty(e.trim())||n===e.trim()||(s.mode.wopi?s.api.asc_wopi_renameFile(e):Common.Gateway.requestRename(e)),Common.NotificationCenter.trigger("edit:complete",s)}}).show();break;case"history":if(!this.leftMenu.panelHistory.isVisible())if(this.api.asc_isDocumentModified()){var s=this;this.api.asc_stopSaving(),Common.UI.warning({closable:!1,width:500,title:this.notcriticalErrorTitle,msg:this.leavePageText,buttons:["ok","cancel"],primary:"ok",callback:function(t){"ok"==t?(s.api.asc_undoAllChanges(),s.api.asc_continueSaving(),s.showHistory()):s.api.asc_continueSaving()}})}else this.showHistory();break;case"external-help":o=!0;break;case"close-editor":Common.NotificationCenter.trigger("close");break;case"switch:mobile":Common.Gateway.switchEditorType("mobile",!0);break;default:o=!1}o&&t&&t.hide()},showLostDataWarning:function(t){Common.UI.warning({title:this.textWarning,msg:this.warnDownloadAs,buttons:["ok","cancel"],callback:_.bind((function(e){"ok"==e&&t.call()}),this)})},clickSaveAsFormat:function(t,e){if(e==Asc.c_oAscFileType.CSV){var i=this;this.api.asc_getWorksheetsCount()>1?Common.UI.warning({title:this.textWarning,msg:this.warnDownloadCsvSheets,buttons:[{value:"ok",caption:this.textSave},"cancel"],callback:_.bind((function(o){"ok"==o&&i.showLostDataWarning((function(){Common.NotificationCenter.trigger("download:advanced",Asc.c_oAscAdvancedOptionsID.CSV,i.api.asc_getAdvancedOptions(),2,new Asc.asc_CDownloadOptions(e)),t.hide()}))}),this)}):this.showLostDataWarning((function(){Common.NotificationCenter.trigger("download:advanced",Asc.c_oAscAdvancedOptionsID.CSV,i.api.asc_getAdvancedOptions(),2,new Asc.asc_CDownloadOptions(e)),t.hide()}))}else e==Asc.c_oAscFileType.PDF||e==Asc.c_oAscFileType.PDFA?(t.hide(),Common.NotificationCenter.trigger("download:settings",this.leftMenu,e)):(this.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(e)),t.hide())},clickSaveCopyAsFormat:function(t,e,i,o){if(e==Asc.c_oAscFileType.CSV){var n=this;this.api.asc_getWorksheetsCount()>1?Common.UI.warning({title:this.textWarning,msg:this.warnDownloadCsvSheets,buttons:[{value:"ok",caption:this.textSave},"cancel"],callback:_.bind((function(s){"ok"==s&&n.showLostDataWarning((function(){n.isFromFileDownloadAs=i;var s=new Asc.asc_CDownloadOptions(e,!0);s.asc_setIsSaveAs(!0),o&&s.asc_setWopiSaveAsPath(o),Common.NotificationCenter.trigger("download:advanced",Asc.c_oAscAdvancedOptionsID.CSV,n.api.asc_getAdvancedOptions(),2,s),t.hide()}))}),this)}):n.showLostDataWarning((function(){n.isFromFileDownloadAs=i;var s=new Asc.asc_CDownloadOptions(e,!0);s.asc_setIsSaveAs(!0),o&&s.asc_setWopiSaveAsPath(o),Common.NotificationCenter.trigger("download:advanced",Asc.c_oAscAdvancedOptionsID.CSV,n.api.asc_getAdvancedOptions(),2,s),t.hide()}))}else if(e==Asc.c_oAscFileType.PDF||e==Asc.c_oAscFileType.PDFA)this.isFromFileDownloadAs=i,t.hide(),Common.NotificationCenter.trigger("download:settings",this.leftMenu,e,!0,o);else{this.isFromFileDownloadAs=i;var s=new Asc.asc_CDownloadOptions(e,!0);s.asc_setIsSaveAs(!0),o&&s.asc_setWopiSaveAsPath(o),this.api.asc_DownloadAs(s),t.hide()}},saveAsInWopi:function(t,e,i){var o=this,n=this.getApplication().getController("Viewport").getView("Common.Views.Header").getDocumentCaption();!n&&(n=o.txtUntitled);var s=n.lastIndexOf(".");s>0&&(n=n.substring(0,s)),new Common.Views.TextInputDialog({label:o.textSelectPath,value:n||"",inputFixedConfig:{fixedValue:i,fixedWidth:40},inputConfig:{maxLength:o.mode.wopi.FileNameMaxLength},handler:function(n,s){"ok"==n&&("string"==typeof i&&(s+=i),o.clickSaveCopyAsFormat(t,e,i,s))}}).show()},onDownloadUrl:function(t,e){if(this.isFromFileDownloadAs){var i=this,o=this.getApplication().getController("Viewport").getView("Common.Views.Header").getDocumentCaption();if(!o&&(o=i.txtUntitled),"string"==typeof this.isFromFileDownloadAs){var n=o.lastIndexOf(".");n>0&&(o=o.substring(0,n)+this.isFromFileDownloadAs)}i.mode.canRequestSaveAs?Common.Gateway.requestSaveAs(t,o,e):(i._saveCopyDlg=new Common.Views.SaveAsDlg({saveFolderUrl:i.mode.saveAsUrl,saveFileUrl:t,defFileName:o}),i._saveCopyDlg.on("saveaserror",(function(t,e){var o={closable:!1,title:i.textWarning,msg:e,iconCls:"warn",buttons:["ok"],callback:function(t){Common.NotificationCenter.trigger("edit:complete",i)}};Common.UI.alert(o)})).on("close",(function(t){i._saveCopyDlg=void 0})),i._saveCopyDlg.show())}this.isFromFileDownloadAs=!1},onDownloadCancel:function(){this.isFromFileDownloadAs=!1},applySettings:function(t){var e=Common.localStorage.getBool("sse-settings-cachemode",!0);Common.Utils.InternalSettings.set("sse-settings-cachemode",e),this.api.asc_setDefaultBlitMode(e),e=Common.localStorage.getItem("sse-settings-fontrender"),Common.Utils.InternalSettings.set("sse-settings-fontrender",e),this.api.asc_setFontRenderingMode(parseInt(e)),e=Common.localStorage.getBool("sse-settings-livecomment",!0),Common.Utils.InternalSettings.set("sse-settings-livecomment",e);var i=Common.localStorage.getBool("sse-settings-resolvedcomment");Common.Utils.InternalSettings.set("sse-settings-resolvedcomment",i),this.mode.canViewComments&&this.leftMenu.panelComments&&this.leftMenu.panelComments.isVisible()&&(e=i=!0),e?this.api.asc_showComments(i):this.api.asc_hideComments(),this.getApplication().getController("Common.Controllers.ReviewChanges").commentsShowHide(e?"show":"hide"),e=Common.localStorage.getBool("sse-settings-r1c1"),Common.Utils.InternalSettings.set("sse-settings-r1c1",e),this.api.asc_setR1C1Mode(e),e=Common.localStorage.getBool("sse-settings-smooth-scroll"),Common.Utils.InternalSettings.set("sse-settings-smooth-scroll",e),this.api.asc_SetSmoothScrolling(e);var o=Common.Utils.InternalSettings.get("sse-settings-coauthmode");this.mode.isEdit&&!this.mode.isOffline&&this.mode.canCoAuthoring?this.mode.canChangeCoAuthoring&&(o=Common.localStorage.getBool("sse-settings-coauthmode",!0),Common.Utils.InternalSettings.set("sse-settings-coauthmode",o),this.api.asc_SetFastCollaborative(o)):this.mode.canLiveView&&!this.mode.isOffline&&this.mode.canChangeCoAuthoring&&(o=Common.localStorage.getBool("sse-settings-view-coauthmode",!1),Common.Utils.InternalSettings.set("sse-settings-coauthmode",o),this.api.asc_SetFastCollaborative(o)),this.mode.isEdit&&(!this.mode.canChangeCoAuthoring&&o||(e=parseInt(Common.localStorage.getItem("sse-settings-autosave")),Common.Utils.InternalSettings.set("sse-settings-autosave",e),this.api.asc_setAutoSaveGap(e)),e=parseInt(Common.localStorage.getItem("sse-settings-paste-button")),Common.Utils.InternalSettings.set("sse-settings-paste-button",e),this.api.asc_setVisiblePasteButton(!!e),e=Common.localStorage.getBool("sse-settings-def-sheet-rtl"),Common.Utils.InternalSettings.set("sse-settings-def-sheet-rtl",e),this.api.asc_setDefaultDirection(e));var n=Common.localStorage.getItem("sse-settings-reg-settings"),s=Common.Utils.InternalSettings.get("sse-settings-use-base-separator");null===n&&(n=this.api.asc_getLocale()),s?this.api.asc_setLocale(parseInt(n),void 0,void 0):this.api.asc_setLocale(parseInt(n),Common.localStorage.getItem("sse-settings-decimal-separator"),Common.localStorage.getItem("sse-settings-group-separator")),e=Common.localStorage.getBool("app-settings-screen-reader"),Common.Utils.InternalSettings.set("app-settings-screen-reader",e),this.api.setSpeechEnabled(e);var a=Common.localStorage.getItem("sse-settings-zoom");if(a>0){var r=Common.Utils.InternalSettings.get("sse-settings-zoom");null!==r&&-3!=r&&r/100!=this.api.asc_getZoom()||this.api.asc_setZoom(a/100)}Common.Utils.InternalSettings.set("sse-settings-zoom",a),t.hide(),this.leftMenu.fireEvent("settings:apply")},applySpellcheckSettings:function(t){if(this.mode.isEdit&&this.api&&Common.UI.FeaturesManager.canChange("spellcheck")){var e=Common.localStorage.getBool("sse-spellcheck-ignore-uppercase-words");this.api.asc_ignoreUppercase(e),e=Common.localStorage.getBool("sse-spellcheck-ignore-numbers-words"),this.api.asc_ignoreNumbers(e),(e=Common.localStorage.getItem("sse-spellcheck-locale"))&&this.api.asc_setDefaultLanguage(parseInt(e))}t.hide(),this.leftMenu.fireEvent("spellcheck:update")},onCreateNew:function(t,e){if(!Common.Controllers.Desktop.process("create:new"))if("blank"==e&&this.mode.canRequestCreateNew)Common.Gateway.requestCreateNew();else{var i=window.open("blank"==e?this.mode.createUrl:e,"_blank");i&&i.focus()}t&&t.hide()},onOpenRecent:function(t,e){t&&t.hide();var i=window.open(e);i&&i.focus(),Common.component.Analytics.trackEvent("Open Recent")},clickToolbarSettings:function(t){this.leftMenu.showMenu("file:opts")},clickToolbarTab:function(t,e){"file"==t?this.leftMenu.showMenu("file"):this.leftMenu.menuFile.hide()},clickToolbarPrint:function(){this.leftMenu.showMenu("file:printpreview")},changeToolbarSaveState:function(t){var e=this.leftMenu.menuFile.getButton("save");e&&e.setDisabled(t)},onHideChat:function(){$(this.leftMenu.btnChat.el).blur(),Common.NotificationCenter.trigger("layout:changed","leftmenu")},onHidePlugins:function(){Common.NotificationCenter.trigger("layout:changed","leftmenu")},addNewPlugin:function(t,e,i){this.leftMenu.insertButton(t,e),this.leftMenu.insertPanel(i)},onBtnCategoryClick:function(t){"plugin"!==t.options.type||t.isDisabled()||(t.pressed?(this.tryToShowLeftMenu(),this.leftMenu.fireEvent("plugins:showpanel",[t.options.value])):this.leftMenu.fireEvent("plugins:hidepanel",[t.options.value]),this.leftMenu.onBtnMenuClick(t))},openPlugin:function(t){this.leftMenu.openPlugin(t)},closePlugin:function(t){this.leftMenu.closePlugin(t),Common.NotificationCenter.trigger("layout:changed","leftmenu")},updatePluginButtonsIcons:function(t){this.leftMenu.updatePluginButtonsIcons(t)},setPreviewMode:function(t){this.viewmode!==t&&(this.viewmode=t,this.leftMenu.panelSearch&&this.leftMenu.panelSearch.setSearchMode(this.viewmode?"no-replace":"search"),this.leftMenu.setDisabledPluginButtons(this.viewmode))},onApiServerDisconnect:function(t){this.mode.isEdit=!1,this.leftMenu.close(),this.leftMenu.btnComments.setDisabled(!0),this.leftMenu.btnChat.setDisabled(!0),this.leftMenu.btnSpellcheck.setDisabled(!0),this.leftMenu.setDisabledPluginButtons(!0),this.leftMenu.getMenu("file").setMode({isDisconnected:!0,enableDownload:!!t})},onApiChatMessage:function(){this.leftMenu.markCoauthOptions("chat")},onApiAddComment:function(t,e){var i=Common.Utils.InternalSettings.get("sse-settings-resolvedcomment");e&&e.asc_getUserId()!==this.mode.user.id&&(i||!e.asc_getSolved())&&AscCommon.UserInfoParser.canViewComment(e.asc_getUserName())&&this.leftMenu.markCoauthOptions("comments")},onApiAddComments:function(t){for(var e=Common.Utils.InternalSettings.get("sse-settings-resolvedcomment"),i=0;i<t.length;++i)if(t[i].asc_getUserId()!==this.mode.user.id&&(e||!t[i].asc_getSolved())&&AscCommon.UserInfoParser.canViewComment(t[i].asc_getUserName())){this.leftMenu.markCoauthOptions("comments");break}},onAppAddComment:function(t,e){if(e){var i=this;new Promise((function(t,e){t()})).then((function(){Common.UI.Menu.Manager.hideAll(),i.leftMenu.showMenu("comments");var t=SSE.getController("Common.Controllers.Comments");t.getView().showEditContainer(!0),t.onAfterShow()}))}},commentsShowHide:function(t){if(this.api){var e=Common.Utils.InternalSettings.get("sse-settings-livecomment"),i=Common.Utils.InternalSettings.get("sse-settings-resolvedcomment");e&&i||(t?this.api.asc_showComments(!0):e?this.api.asc_showComments(i):this.api.asc_hideComments()),t&&this.getApplication().getController("Common.Controllers.Comments").onAfterShow(),t||$(this.leftMenu.btnComments.el).blur()}},fileShowHide:function(t){this.api&&(this.api.asc_closeCellEditor(),this.api.asc_enableKeyEvents(!t))},aboutShowHide:function(t){this.api&&(this.api.asc_closeCellEditor(),this.api.asc_enableKeyEvents(!t),t||$(this.leftMenu.btnAbout.el).blur(),!t&&this.leftMenu._state.pluginIsRunning&&(this.leftMenu.panelPlugins.show(),this.mode.canCoAuthoring&&(this.mode.canViewComments&&this.leftMenu.panelComments.hide(),this.mode.canChat&&this.leftMenu.panelChat.hide())))},menuFilesShowHide:function(t){this.api&&(this.api.asc_closeCellEditor(),"show"==t?this.api.asc_enableKeyEvents(!1):Common.NotificationCenter.trigger("menu:hide")),this.dlgSearch&&("show"==t?this.dlgSearch.suspendKeyEvents():Common.Utils.asyncCall(this.dlgSearch.resumeKeyEvents,this.dlgSearch))},onShortcut:function(t,e){if(this.mode){if(this.mode.isEditDiagram&&"escape"!=t)return!1;if(this.mode.isEditMailMerge&&"escape"!=t&&"search"!=t)return!1;if(this.mode.isEditOle&&"escape"!=t&&"search"!=t)return!1;switch(t){case"replace":case"search":if(this.mode.isEditMailMerge||this.mode.isEditOle)return this.leftMenu.fireEvent("search:show"),!1;if(!this.leftMenu.btnSearchBar.isDisabled()){Common.UI.Menu.Manager.hideAll(),this.leftMenu.btnAbout.toggle(!1),this.leftMenu.menuFile.isVisible()&&this.leftMenu.menuFile.hide();var i=this.api.asc_GetSelectedText();if(this.isSearchPanelVisible())return i&&this.leftMenu.panelSearch.setFindText(i),this.leftMenu.panelSearch.focus(""!==i?t:"search"),this.leftMenu.fireEvent("search:aftershow",[i||void 0]),!1;if(this.getApplication().getController("Viewport").isSearchBarVisible()){var o=this.getApplication().getController("Viewport");if("replace"!==t)return i&&o.searchBar.setText(i),o.searchBar.focus(),!1;o.header.btnSearch.toggle(!1),this.onShowHideSearch(!0,o.searchBar.inputSearch.val())}else{if("search"===t)return Common.NotificationCenter.trigger("search:show"),!1;this.onShowHideSearch(!0,i||void 0)}this.leftMenu.btnSearchBar.toggle(!0,!0),this.leftMenu.panelSearch.focus(i?t:"search")}return!1;case"save":return this.mode.canDownload&&(this.mode.isDesktopApp&&this.mode.isOffline?this.api.asc_DownloadAs():(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("file:saveas"))),!1;case"help":return this.mode.canHelp&&(Common.UI.Menu.Manager.hideAll(),this.api.asc_closeCellEditor(),this.leftMenu.showMenu("file:help")),!1;case"file":return Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("file"),!1;case"escape":var n=this.getApplication().getController("Viewport").header.btnSearch;if(n.pressed&&n.toggle(!1),this.leftMenu.menuFile.isVisible())return Common.UI.HintManager.needCloseFileMenu()&&this.leftMenu.menuFile.hide(),!1;var s=SSE.getController("Statusbar").statusbar.$el.find('.open > [data-toggle="dropdown"]');if(s.length)return $.fn.dropdown.Constructor.prototype.keydown.call(s[0],e),!1;if(this.mode.canPlugins&&this.leftMenu.panelPlugins&&!0!==this.api.isCellEdited&&(s=this.leftMenu.panelPlugins.$el.find('#menu-plugin-container.open > [data-toggle="dropdown"]')).length)return $.fn.dropdown.Constructor.prototype.keydown.call(s[0],e),!1;if(this.leftMenu.btnAbout.pressed)return Common.UI.HintManager.isHintVisible()||(this.leftMenu.close(),Common.NotificationCenter.trigger("layout:changed","leftmenu")),!1;if(this.mode.isEditDiagram||this.mode.isEditMailMerge||this.mode.isEditOle){var a=(this.mode.isEditMailMerge||this.mode.isEditOle)&&this.getApplication().getController("Toolbar").toolbar.btnSearch,r=a&&a.pressed;if(s=$(document.body).find(".open > .dropdown-menu"),!this.api.isCellEdited&&!s.length&&!r)return this.mode.isEditOle&&Common.NotificationCenter.trigger("oleedit:close"),Common.Gateway.internalMessage("shortcut",{key:"escape"}),!1;r&&a.toggle(!1)}break;case"chat":return this.mode.canCoAuthoring&&this.mode.canChat&&!this.mode.isLightVersion&&(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("chat")),!1;case"comments":return this.mode.canCoAuthoring&&this.mode.canViewComments&&!this.mode.isLightVersion&&(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("comments"),this.getApplication().getController("Common.Controllers.Comments").onAfterShow()),!1}}},onCellsRange:function(t){var e=t!=Asc.c_oAscSelectionDialogType.None;this.leftMenu.btnAbout.setDisabled(e),this.leftMenu.btnSearchBar.setDisabled(e),this.leftMenu.btnSpellcheck.setDisabled(e),this.mode.canPlugins&&this.leftMenu.panelPlugins&&(Common.Utils.lockControls(Common.enumLock.selRangeEdit,e,{array:this.leftMenu.panelPlugins.lockedControls}),this.leftMenu.panelPlugins.setLocked(e))},onApiEditCell:function(t){var e=t==Asc.c_oAscCellEditorState.editFormula;this.leftMenu.btnAbout.setDisabled(e),this.leftMenu.btnSearchBar.setDisabled(e),this.leftMenu.btnSpellcheck.setDisabled(e),this.mode.canPlugins&&this.leftMenu.panelPlugins&&(Common.Utils.lockControls(Common.enumLock.editFormula,e,{array:this.leftMenu.panelPlugins.lockedControls}),this.leftMenu.panelPlugins.setLocked(e))},onShowHideChat:function(t){this.mode.canCoAuthoring&&this.mode.canChat&&!this.mode.isLightVersion&&(t?(Common.UI.Menu.Manager.hideAll(),this.tryToShowLeftMenu(),this.leftMenu.showMenu("chat")):(this.leftMenu.btnChat.toggle(!1,!0),this.leftMenu.onBtnMenuClick(this.leftMenu.btnChat)))},onShowHideSearch:function(t,e){t?(Common.UI.Menu.Manager.hideAll(),this.tryToShowLeftMenu(),this.leftMenu.showMenu("advancedsearch"),this.leftMenu.fireEvent("search:aftershow",[e])):(this.leftMenu.btnSearchBar.toggle(!1,!0),this.leftMenu.onBtnMenuClick(this.leftMenu.btnSearchBar))},onMenuSearchBar:function(t,e){if(e){var i=this.mode.isEdit&&!this.viewmode?void 0:"no-replace";this.leftMenu.panelSearch.setSearchMode(i)}},isSearchPanelVisible:function(){return this.leftMenu&&this.leftMenu.panelSearch&&this.leftMenu.panelSearch.isVisible()},onMenuChange:function(t){"hide"===t&&(this.leftMenu.btnComments.isActive()&&this.api?(this.leftMenu.btnComments.toggle(!1),this.leftMenu.onBtnMenuClick(this.leftMenu.btnComments),this.api.asc_enableKeyEvents(!0)):this.leftMenu.btnSearchBar.isActive()&&this.api?(this.leftMenu.btnSearchBar.toggle(!1),this.leftMenu.onBtnMenuClick(this.leftMenu.btnSearchBar)):this.leftMenu.btnSpellcheck.isActive()&&this.api?(this.leftMenu.btnSpellcheck.toggle(!1),this.leftMenu.onBtnMenuClick(this.leftMenu.btnSpellcheck)):this.leftMenu.btnChat.isActive()&&(this.leftMenu.btnChat.toggle(!1),this.leftMenu.onBtnMenuClick(this.leftMenu.btnChat)))},showHistory:function(){if(!this.mode.wopi){var t=this.getApplication().getController("Main");t.loadMask||(t.loadMask=new Common.UI.LoadMask({owner:$("#viewport")})),t.loadMask.setTitle(this.textLoadHistory),t.loadMask.show()}Common.Gateway.requestHistory()},isCommentsVisible:function(){return this.leftMenu&&this.leftMenu.panelComments&&this.leftMenu.panelComments.isVisible()},onLeftMenuHide:function(t,e){this.leftMenu&&(!e&&this.leftMenu.close(),e?this.leftMenu.show():this.leftMenu.hide(),Common.localStorage.setBool("sse-hidden-leftmenu",!e),!t&&this.leftMenu.fireEvent("view:hide",[this,!e])),Common.NotificationCenter.trigger("layout:changed","main"),Common.NotificationCenter.trigger("edit:complete",this.leftMenu)},tryToShowLeftMenu:function(){this.mode.canBrandingExt&&this.mode.customization&&!1===this.mode.customization.leftMenu||!Common.UI.LayoutManager.isElementVisible("leftMenu")||this.onLeftMenuHide(null,!0)},textNoTextFound:"Text not found",newDocumentTitle:"Unnamed document",textItemEntireCell:"Entire cell contents",requestEditRightsText:"Requesting editing rights...",warnDownloadAs:"If you continue saving in this format all features except the text will be lost.<br>Are you sure you want to continue?",textWarning:"Warning",textSheet:"Sheet",textWorkbook:"Workbook",textByColumns:"By columns",textByRows:"By rows",textFormulas:"Formulas",textValues:"Values",textWithin:"Within",textSearch:"Search",textLookin:"Look in",txtUntitled:"Untitled",textLoadHistory:"Loading version history...",leavePageText:"All unsaved changes in this document will be lost.<br> Click 'Cancel' then 'Save' to save them. Click 'OK' to discard all the unsaved changes.",warnDownloadCsvSheets:"The CSV format does not support saving a multi-sheet file.<br>To keep the selected format and save only the current sheet, press Save.<br>To save the current spreadsheet, click Cancel and save it in a different format.",textSave:"Save",textSelectPath:"Enter a new name for saving the file copy"},SSE.Controllers.LeftMenu||{}))})),define("spreadsheeteditor/main/app/controller/Spellcheck",["core"],(function(){"use strict";SSE.Controllers.Spellcheck=Backbone.Controller.extend(_.extend({models:[],collections:[],views:[],initialize:function(){var t=this;this.addListeners({Spellcheck:{show:function(){t._initSettings&&t.loadLanguages(),t.updateLanguages(),t.onClickNext()},hide:function(){t.api&&t.api.asc_cancelSpellCheck()}},LeftMenu:{"spellcheck:update":function(){t.updateLanguages()}}})},events:function(){},onLaunch:function(){this._isDisabled=!1,this._initSettings=!0,Common.NotificationCenter.on("script:loaded",_.bind(this.onPostLoadComplete,this))},onPostLoadComplete:function(){this.views=this.getApplication().getClasseRefs("view",["Spellcheck"]),this.panelSpellcheck=this.createView("Spellcheck",{}),this.panelSpellcheck.on("render:after",_.bind(this.onAfterRender,this)),Common.NotificationCenter.trigger("script:loaded:spellcheck"),this.api&&(this.api.asc_registerCallback("asc_onSpellCheckVariantsFound",_.bind(this.onSpellCheckVariantsFound,this)),this.api.asc_registerCallback("asc_onEditCell",_.bind(this.onApiEditCell,this)))},setApi:function(t){return this.api=t,this},setMode:function(t){return this.mode=t,this.panelSpellcheck&&this.panelSpellcheck.btnToDictionary.setVisible(t.isDesktopApp),this},onAfterRender:function(t){t.buttonNext.on("click",_.bind(this.onClickNext,this)),t.btnToDictionary.on("click",_.bind(this.onDictionary,this)),t.cmbDictionaryLanguage.on("selected",_.bind(this.onSelectLanguage,this)),t.btnChange.on("click",_.bind(this.onClickChange,this)),t.btnIgnore.on("click",_.bind(this.onClickIgnore,this)),t.btnChange.menu.on("item:click",_.bind(this.onClickChangeMenu,this)),t.btnIgnore.menu.on("item:click",_.bind(this.onClickIgnoreMenu,this))},onClickNext:function(){this.api&&this.api.asc_nextWord(),Common.NotificationCenter.trigger("edit:complete",this,{restorefocus:!0})},onDictionary:function(){if(this.api){var t=this.panelSpellcheck.currentWord.getValue();t&&this.api.asc_spellCheckAddToDictionary(t)}},SetDisabled:function(t){this._isDisabled=t},setLanguages:function(t){this.languages=t,this._initSettings=!0,this.panelSpellcheck.cmbDictionaryLanguage&&this.panelSpellcheck.cmbDictionaryLanguage.store.length>0&&this.panelSpellcheck.cmbDictionaryLanguage.store.reset()},loadLanguages:function(){var t=this;if(this._initSettings){Common.Utils.InternalSettings.set("sse-spellcheck-locale",Common.localStorage.getItem("sse-spellcheck-locale"));var e="app-settings-recent-langs";this.panelSpellcheck.cmbDictionaryLanguage&&this.panelSpellcheck.cmbDictionaryLanguage.setRecent({count:Common.Utils.InternalSettings.get(e+"-count")||5,offset:Common.Utils.InternalSettings.get(e+"-offset")||0,key:e,valueField:"shortName"})}if(this.languages&&this.languages.length>0){var i,o,n=[];this.allLangs=Common.util.LanguageInfo.getLanguages(),this.languages.forEach((function(e){e=parseInt(e),t.allLangs.hasOwnProperty(e)&&(i=t.allLangs[e],o=Common.util.LanguageInfo.getLocalLanguageDisplayName(e),n.push({displayValue:o.native,displayValueEn:o.english,shortName:i[0],value:e}))})),n.sort((function(t,e){return t.shortName<e.shortName?-1:t.shortName>e.shortName?1:0})),this.langs=n}else this.langs=void 0;this._initSettings=!1;var s=0===this.panelSpellcheck.cmbDictionaryLanguage.store.length;return[this.allLangs,this.langs,s]},updateLanguages:function(){var t,e=Common.Utils.InternalSettings.get("sse-spellcheck-locale"),i=!1;t=e?parseInt(e):this.mode.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(this.mode.lang)):1033;var o=this.panelSpellcheck.cmbDictionaryLanguage;if(this.langs&&this.langs.length>0){0===o.store.length&&(o.setData(this.langs),i=!0);var n=o.store.findWhere({value:t});!n&&this.allLangs[t]&&(t=this.allLangs[t][0].split(/[\-\_]/)[0],n=o.store.find((function(e){return 0==e.get("shortName").indexOf(t)}))),o.setValue(n?n.get("value"):this.langs[0].value),t=o.getValue()}else o.setValue(Common.util.LanguageInfo.getLocalLanguageName(t)[1]),o.setDisabled(!0);i&&this.api&&(this.api.asc_setDefaultLanguage(t),t!==parseInt(e)&&Common.Utils.InternalSettings.set("sse-spellcheck-locale",t),i=!1)},onSelectLanguage:function(t,e){var i=e.value;if(this.api&&i){this.api.asc_setDefaultLanguage(i);var o=this.panelSpellcheck.cmbDictionaryLanguage.getValue();Common.localStorage.setItem("sse-spellcheck-locale",o),Common.Utils.InternalSettings.set("sse-spellcheck-locale",o)}Common.NotificationCenter.trigger("edit:complete",this,{restorefocus:!0})},onClickChange:function(t,e){if(this.api){var i=this.panelSpellcheck.suggestionList.getSelectedRec();i&&this.api.asc_replaceMisspelledWord(i.get("value"),this._currentSpellObj)}Common.NotificationCenter.trigger("edit:complete",this,{restorefocus:!0})},onClickChangeMenu:function(t,e){if(this.api){var i=this.panelSpellcheck.suggestionList.getSelectedRec();0==e.value?i&&this.api.asc_replaceMisspelledWord(i.get("value"),this._currentSpellObj):1==e.value&&i&&this.api.asc_replaceMisspelledWord(i.get("value"),this._currentSpellObj,!0)}Common.NotificationCenter.trigger("edit:complete",this,{restorefocus:!0})},onClickIgnore:function(){this.api&&this.api.asc_ignoreMisspelledWord(this._currentSpellObj,!1),Common.NotificationCenter.trigger("edit:complete",this,{restorefocus:!0})},onClickIgnoreMenu:function(t,e){this.api&&(0==e.value?this.api.asc_ignoreMisspelledWord(this._currentSpellObj,!1):1==e.value&&this.api.asc_ignoreMisspelledWord(this._currentSpellObj,!0)),Common.NotificationCenter.trigger("edit:complete",this,{restorefocus:!0})},onSpellCheckVariantsFound:function(t){if(this.panelSpellcheck&&this.panelSpellcheck.rendered&&(null!==t||this._currentSpellObj!==t||this.panelSpellcheck.isVisible())){this._currentSpellObj=t;var e,i=[];if(t){e=t.get_Word();var o=t.get_Variants();o&&o.forEach((function(t){var e=new Common.UI.DataViewModel;e.set({value:t}),i.push(e)}))}var n=this.api.isCellEdited;this.panelSpellcheck.currentWord.setValue(e||""),this.panelSpellcheck.suggestionList.store.reset(i),i.length>0&&this.panelSpellcheck.suggestionList.selectByIndex(0),this.panelSpellcheck.currentWord.setDisabled(!e||n),this.panelSpellcheck.btnChange.setDisabled(i.length<1||n),this.panelSpellcheck.btnIgnore.setDisabled(!e||n),this.panelSpellcheck.btnToDictionary.setDisabled(!e||n),this.panelSpellcheck.lblComplete.toggleClass("hidden",!t||!!e),this.panelSpellcheck.buttonNext.setDisabled(!this.panelSpellcheck.lblComplete.hasClass("hidden"))}},onApiEditCell:function(t){this.panelSpellcheck&&this.panelSpellcheck.rendered&&(t==Asc.c_oAscCellEditorState.editEnd?(this.panelSpellcheck.buttonNext.setDisabled(!this.panelSpellcheck.lblComplete.hasClass("hidden")),this.panelSpellcheck.cmbDictionaryLanguage.setDisabled(!(this.languages&&this.languages.length>0))):(this.panelSpellcheck.buttonNext.setDisabled(!0),this.panelSpellcheck.currentWord.setDisabled(!0),this.panelSpellcheck.btnChange.setDisabled(!0),this.panelSpellcheck.btnIgnore.setDisabled(!0),this.panelSpellcheck.btnToDictionary.setDisabled(!0),this.panelSpellcheck.cmbDictionaryLanguage.setDisabled(!0)))}},SSE.Controllers.Spellcheck||{}))})),void 0===Common)var Common={};if(Common.IrregularStack=function(t){var e=[],i=function(t,e){return"object"===_typeof(t)&&"object"===_typeof(e)&&window.JSON?window.JSON.stringify(t)===window.JSON.stringify(e):t===e},o=(t=t||{}).strongCompare||i,n=t.weakCompare||i,s=function(t,i){for(var o=e.length-1;o>=0;o--)if(i(e[o],t))return o;return-1};return{push:function(t){e.push(t)},pop:function(t){var i=s(t,o);if(-1!=i)return e.splice(i,1)[0]},get:function(t){var i="object"===_typeof(t)?s(t,n):t;if(-1!=i)return e[i]},exist:function(t){return!(s(t,o)<0)},length:function(){return e.length}}},define("irregularstack",(function(){})),void 0===Common)var Common={};if(define("common/main/lib/component/LoadMask",["common/main/lib/component/BaseView"],(function(){"use strict";Common.UI.LoadMask=Common.UI.BaseView.extend({options:{cls:"",style:"",title:"Loading...",owner:document.body},template:_.template(['<div id="<%= id %>" class="asc-loadmask-body <%= cls %>" role="presentation" tabindex="-1">','<i id="loadmask-spinner" class="asc-loadmask-image"></i>','<div class="asc-loadmask-title"><%- title %></div>',"</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.template=this.options.template||this.template,this.title=this.options.title,this.ownerEl=this.options.owner instanceof Common.UI.BaseView?$(this.options.owner.el):$(this.options.owner),this.loaderEl=$(this.template({id:this.id,cls:this.options.cls,style:this.options.style,title:this.title})),this.maskeEl=$('<div class="asc-loadmask"></div>'),this.timerId=0},render:function(){return this},internalShowLoader:function(){this.ownerEl.append(this.loaderEl),this.loaderEl.css("min-width",$(".asc-loadmask-title",this.loaderEl).width()+105),this.ownerEl&&0==this.ownerEl.closest(".asc-window.modal").length&&Common.util.Shortcuts.suspendEvents()},internalShowMask:function(){this.ownerEl.ismasked||(this.ownerEl.ismasked=!0,this.ownerEl.append(this.maskeEl))},show:function(t){if(this.internalShowMask(),this.ownerEl.hasloader)return this;this.ownerEl.hasloader=!0;var e=this;return e.title!=e.options.title&&(e.options.title=e.title,$(".asc-loadmask-title",this.loaderEl).html(Common.Utils.String.htmlEncode(e.title))),t?e.internalShowLoader():e.timerId||(e.timerId=setTimeout((function(){e.internalShowLoader()}),500)),this},hide:function(){var t=this.ownerEl;this.timerId&&(clearTimeout(this.timerId),this.timerId=0),t&&t.ismasked&&this.maskeEl&&this.maskeEl.remove(),delete t.ismasked,t&&t.hasloader&&(0!=t.closest(".asc-window.modal").length||Common.Utils.ModalWindow.isVisible()||Common.util.Shortcuts.resumeEvents(),this.loaderEl&&this.loaderEl.remove()),delete t.hasloader},setTitle:function(t){if(this.title=t,this.ownerEl&&this.ownerEl.hasloader&&this.loaderEl){var e=$(".asc-loadmask-title",this.loaderEl);e.html(Common.Utils.String.htmlEncode(t)),this.loaderEl.css("min-width",e.width()+105)}},isVisible:function(){return!!this.ownerEl.ismasked},updatePosition:function(){var t=this.ownerEl,e=this.loaderEl;t&&t.hasloader&&e&&(e.css({top:Math.round(t.height()/2-(e.height()+parseInt(e.css("padding-top"))+parseInt(e.css("padding-bottom")))/2)+"px",left:Math.round(t.width()/2-(e.width()+parseInt(e.css("padding-left"))+parseInt(e.css("padding-right")))/2)+"px"}),e.css({visibility:"visible"}))}})})),define("common/main/lib/component/Tooltip",["tip","backbone"],(function(){"use strict";var t=function(t){this.$element=this.placement=void 0,this.init.call(this,t)};_.extend(t.prototype,Backbone.Events,{init:function(t){if(this.$element=t.owner instanceof Backbone.View?t.owner.$el:$(t.owner),this.placement=t.placement,this.$element.data("bs.tooltip")&&this.$element.removeData("bs.tooltip"),this.$element.tooltip({title:t.title,trigger:"manual",placement:t.placement,offset:t.offset,cls:t.cls,html:t.html,hideonclick:t.hideonclick,keepvisible:t.keepvisible}),t.hideonclick){var e=this,i=this.$element.data("bs.tooltip");i&&i.tip().on("click",(function(){i.hide(),e.trigger("tooltip:hideonclick",this)}))}this.$element.on("shown.bs.tooltip",_.bind(this.onTipShown,this)),this.$element.on("hidden.bs.tooltip",_.bind(this.onTipHidden,this))},show:function(t){this.getBSTip().show(t)},hide:function(t){this.getBSTip().hide(t)},setTitle:function(t){var e=this.getBSTip();e&&(e.options.title=t)},updateTitle:function(){var t=this.getBSTip();t.$tip.find(".tooltip-inner")[t.options.html?"html":"text"](t.options.title)},getBSTip:function(){return this.$element.data("bs.tooltip")},onTipShown:function(){this.trigger("tooltip:show",this)},onTipHidden:function(){this.trigger("tooltip:hide",this)},isVisible:function(){return this.getBSTip().tip().is(":visible")}}),Common.UI=Common.UI||{},Common.UI.Tooltip=t})),void 0===Common)var Common={};if(Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/Fonts",["core","common/main/lib/collection/Fonts"],(function(){"use strict";Common.Controllers.Fonts=Backbone.Controller.extend(function(){var t=4;function e(e,i){e.showlastused&&function(e,i){for(var o,n=i.get("type")==t,s=-1,a=e.length,r=i.get("name");!n&&++s<a&&(o=e.at(s)).get("type")==t;)n=o.get("name")==r}(e.store,i)}function i(t){Common.NotificationCenter.trigger("fonts:change",t)}function o(t,e){var i=[];_.each(t,(function(t){var e=t.asc_getFontId();i.push({id:_.isEmpty(e)?Common.UI.getId():e,name:t.asc_getFontName(),imgidx:t.asc_getFontThumbnail(),type:t.asc_getFontType()})}));var o=this.getCollection("Common.Collections.Fonts");o&&o.add(i),Common.NotificationCenter.trigger("fonts:load",o,e)}return{models:["Common.Models.Fonts"],collections:["Common.Collections.Fonts"],views:[],initialize:function(){Common.NotificationCenter.on("fonts:select",_.bind(e,this))},onLaunch:function(){},setApi:function(t){this.api=t,this.api.asc_registerCallback("asc_onInitEditorFonts",_.bind(o,this)),this.api.asc_registerCallback("asc_onFontFamily",_.bind(i,this))}}}())})),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/TextArt",["backbone"],(function(t){"use strict";Common.Collections.TextArt=t.Collection.extend({model:t.Model.extend({defaults:function(){return{id:Common.UI.getId(),imageUrl:null,data:null}}})})})),void 0===window.Common&&(window.Common={}),Common.util=Common.util||{},Common.util.LanguageInfo=new function(){var t={54:["af","Afrikaans"],1078:["af-ZA","Afrikaans (Suid Afrika)","Afrikaans (South Africa)"],28:["sq","Shqipe"],1052:["sq-AL","Shqipe (Shqipëria)","Albanian (Albania)"],132:["gsw","Elsässisch"],1156:["gsw-FR","Elsässisch (Frànkrisch)","Alsatian (France)"],94:["am","አማርኛ"],1118:["am-ET","አማርኛ (ኢትዮጵያ)","Amharic (Ethiopia)"],1:["ar","العربية‏"],5121:["ar-DZ","العربية (الجزائر)‏","Arabic (Algeria)"],15361:["ar-BH","العربية (البحرين)‏","Arabic (Bahrain)"],3073:["ar-EG","العربية (مصر)‏","Arabic (Egypt)"],2049:["ar-IQ","العربية (العراق)‏","Arabic (Iraq)"],11265:["ar-JO","العربية (الأردن)‏","Arabic (Jordan)"],13313:["ar-KW","العربية (الكويت)‏","Arabic (Kuwait)"],12289:["ar-LB","العربية (لبنان)‏","Arabic (Lebanon)"],4097:["ar-LY","العربية (ليبيا)‏","Arabic (Libya)"],6145:["ar-MA","العربية (المملكة المغربية)‏","Arabic (Morocco)"],8193:["ar-OM","العربية (عمان)‏","Arabic (Oman)"],16385:["ar-QA","العربية (قطر)‏","Arabic (Qatar)"],1025:["ar-SA","العربية (المملكة العربية السعودية)‏","Arabic (Saudi Arabia)"],10241:["ar-SY","العربية (سوريا)‏","Arabic (Syria)"],7169:["ar-TN","العربية (تونس)‏","Arabic (Tunisia)"],14337:["ar-AE","العربية (الإمارات العربية المتحدة)‏","Arabic (U.A.E.)"],9217:["ar-YE","العربية (اليمن)‏","Arabic (Yemen)"],43:["hy","Հայերեն"],1067:["hy-AM","Հայերեն (Հայաստան)","Armenian (Armenia)"],77:["as","অসমীয়া"],1101:["as-IN","অসমীয়া (ভাৰত)","Assamese (India)"],44:["az","Azərbaycan­ılı"],29740:["az-Cyrl","Азәрбајҹан дили"],2092:["az-Cyrl-AZ","Азәрбајҹан (Азәрбајҹан)","Azeri (Cyrillic, Azerbaijan)"],30764:["az-Latn","Azərbaycan­ılı"],1068:["az-Latn-AZ","Azərbaycan­ılı (Azərbaycan)","Azeri (Latin, Azerbaijan)"],109:["ba","Башҡорт"],1133:["ba-RU","Башҡорт (Россия)","Bashkir (Russia)"],45:["eu","Euskara"],1069:["eu-ES","Euskara (Euskara)","Basque (Basque)"],35:["be","Беларуская"],1059:["be-BY","Беларуская (Беларусь)","Belarusian (Belarus)"],69:["bn","বাংলা"],2117:["bn-BD","বাংলা (বাংলাদেশ)","Bengali (Bangladesh)"],1093:["bn-IN","বাংলা (ভারত)","Bengali (India)"],30746:["bs","bosanski"],25626:["bs-Cyrl","Босански (Ћирилица)"],8218:["bs-Cyrl-BA","Босански (Босна и Херцеговина)","Bosnian (Cyrillic, Bosnia and Herzegovina)"],26650:["bs-Latn","Bosanski (Latinica)"],5146:["bs-Latn-BA","Bosanski (Bosna i Hercegovina)","Bosnian (Latin, Bosnia and Herzegovina)"],126:["br","Brezhoneg"],1150:["br-FR","Brezhoneg (Frañs)","Breton (France)"],2:["bg","Български"],1026:["bg-BG","Български (България)","Bulgarian (Bulgaria)"],3:["ca","Català"],1027:["ca-ES","Català (Català)","Catalan (Catalan)"],2051:["ca-ES-valencia","Català (Valencià)","Catalan (Valencia)"],30724:["zh","中文"],4:["zh-Hans","中文(简体)","Chinese (Simplified)"],2052:["zh-CN","中文(中华人民共和国)","Chinese (People's Republic of China)"],4100:["zh-SG","中文(新加坡)","Chinese (Simplified, Singapore)"],31748:["zh-Hant","中文(繁體)","Chinese (Traditional)"],3076:["zh-HK","中文(香港特別行政區)","Chinese (Traditional, Hong Kong S.A.R.)"],5124:["zh-MO","中文(澳門特別行政區)","Chinese (Traditional, Macao S.A.R.)"],1028:["zh-TW","中文(台灣)","Chinese (Traditional, Taiwan)"],131:["co","Corsu"],1155:["co-FR","Corsu (France)","Corsican (France)"],26:["hr","Hrvatski"],1050:["hr-HR","Hrvatski (Hrvatska)","Croatian (Croatia)"],4122:["hr-BA","Hrvatski (Bosna i Hercegovina)","Croatian (Bosnia and Herzegovina)"],5:["cs","Čeština"],1029:["cs-CZ","Čeština (Česká republika)","Czech (Czech Republic)"],6:["da","Dansk"],1030:["da-DK","Dansk (Danmark)","Danish (Denmark)"],140:["prs","درى‏"],1164:["prs-AF","درى (افغانستان)‏","Dari (Afghanistan)"],101:["dv","ދިވެހިބަސް‏"],1125:["dv-MV","ދިވެހިބަސް (ދިވެހި ރާއްޖެ)‏","Divehi (Maldives)"],19:["nl","Nederlands"],2067:["nl-BE","Nederlands (België)","Dutch (Belgium)"],1043:["nl-NL","Nederlands (Nederland)","Dutch (Netherlands)"],9:["en","English"],3081:["en-AU","English (Australia)","English (Australia)"],10249:["en-BZ","English (Belize)","English (Belize)"],4105:["en-CA","English (Canada)","English (Canada)"],9225:["en-029","English (Caribbean)","English (Caribbean)"],16393:["en-IN","English (India)","English (India)"],6153:["en-IE","English (Ireland)","English (Ireland)"],8201:["en-JM","English (Jamaica)","English (Jamaica)"],17417:["en-MY","English (Malaysia)","English (Malaysia)"],5129:["en-NZ","English (New Zealand)","English (New Zealand)"],13321:["en-PH","English (Philippines)","English (Philippines)"],18441:["en-SG","English (Singapore)","English (Singapore)"],7177:["en-ZA","English (South Africa)","English (South Africa)"],11273:["en-TT","English (Trinidad y Tobago)","English (Trinidad y Tobago)"],2057:["en-GB","English (United Kingdom)","English (United Kingdom)"],1033:["en-US","English (United States)","English (United States)"],12297:["en-ZW","English (Zimbabwe)","English (Zimbabwe)"],15369:["en-HK","English (Hong Kong)","English (Hong Kong)"],14345:["en-ID","English (Indonesia)","English (Indonesia)"],37:["et","Eesti"],1061:["et-EE","Eesti (Eesti)","Estonian (Estonia)"],56:["fo","Føroyskt"],1080:["fo-FO","Føroyskt (Føroyar)","Faroese (Faroe Islands)"],100:["fil","Filipino"],1124:["fil-PH","Filipino (Pilipinas)","Filipino (Philippines)"],11:["fi","Suomi"],1035:["fi-FI","Suomi (Suomi)","Finnish (Finland)"],12:["fr","Français"],2060:["fr-BE","Français (Belgique)","French (Belgium)"],3084:["fr-CA","Français (Canada)","French (Canada)"],1036:["fr-FR","Français (France)","French (France)"],5132:["fr-LU","Français (Luxembourg)","French (Luxembourg)"],6156:["fr-MC","Français (Principauté de Monaco)","French (Principality of Monaco)"],4108:["fr-CH","Français (Suisse)","French (Switzerland)"],15372:["fr-HT","Français (Haïti)","French (Haiti)"],9228:["fr-CG","Français (Congo-Brazzaville)","French (Congo)"],12300:["fr-CI","Français (Côte d’Ivoire)","French (Cote d'Ivoire)"],11276:["fr-CM","Français (Cameroun)","French (Cameroon)"],14348:["fr-MA","Français (Maroc)","French (Morocco)"],13324:["fr-ML","Français (Mali)","French (Mali)"],8204:["fr-RE","Français (La Réunion)","French (Reunion)"],10252:["fr-SN","Français (Sénégal)","French (Senegal)"],7180:["fr-West","French"],98:["fy","Frysk"],1122:["fy-NL","Frysk (Nederlân)","Frisian (Netherlands)"],86:["gl","Galego"],1110:["gl-ES","Galego (Galego)","Galician (Galician)"],55:["ka","ქართული"],1079:["ka-GE","ქართული (საქართველო)","Georgian (Georgia)"],7:["de","Deutsch"],3079:["de-AT","Deutsch (Österreich)","German (Austria)"],1031:["de-DE","Deutsch (Deutschland)","German (Germany)"],5127:["de-LI","Deutsch (Liechtenstein)","German (Liechtenstein)"],4103:["de-LU","Deutsch (Luxemburg)","German (Luxembourg)"],2055:["de-CH","Deutsch (Schweiz)","German (Switzerland)"],8:["el","Ελληνικά"],1032:["el-GR","Ελληνικά (Ελλάδα)","Greek (Greece)"],111:["kl","Kalaallisut"],1135:["kl-GL","Kalaallisut (Kalaallit Nunaat)","Greenlandic (Greenland)"],71:["gu","ગુજરાતી"],1095:["gu-IN","ગુજરાતી (ભારત)","Gujarati (India)"],104:["ha","Hausa"],31848:["ha-Latn","Hausa (Latin)"],1128:["ha-Latn-NG","Hausa (Nigeria)","Hausa (Latin, Nigeria)"],13:["he","עברית‏"],1037:["he-IL","עברית (ישראל)‏","Hebrew (Israel)"],57:["hi","हिंदी"],1081:["hi-IN","हिंदी (भारत)","Hindi (India)"],14:["hu","Magyar"],1038:["hu-HU","Magyar (Magyarország)","Hungarian (Hungary)"],15:["is","Íslenska"],1039:["is-IS","Íslenska (Ísland)","Icelandic (Iceland)"],112:["ig","Igbo"],1136:["ig-NG","Igbo (Nigeria)","Igbo (Nigeria)"],33:["id","Bahasa Indonesia"],1057:["id-ID","Bahasa Indonesia (Indonesia)","Indonesian (Indonesia)"],93:["iu","Inuktitut"],31837:["iu-Latn","Inuktitut (Qaliujaaqpait)"],2141:["iu-Latn-CA","Inuktitut (Kanatami, kanata)","Inuktitut (Latin, Canada)"],30813:["iu-Cans","ᐃᓄᒃᑎᑐᑦ (ᖃᓂᐅᔮᖅᐸᐃᑦ)"],1117:["iu-Cans-CA","ᐃᓄᒃᑎᑐᑦ (ᑲᓇᑕᒥ)","Inuktitut (Canada)"],60:["ga","Gaeilge"],2108:["ga-IE","Gaeilge (Éire)","Irish (Ireland)"],52:["xh","isiXhosa"],1076:["xh-ZA","isiXhosa (uMzantsi Afrika)","isiXhosa (South Africa)"],53:["zu","isiZulu"],1077:["zu-ZA","isiZulu (iNingizimu Afrika)","isiZulu (South Africa)"],16:["it","Italiano"],1040:["it-IT","Italiano (Italia)","Italian (Italy)"],2064:["it-CH","Italiano (Svizzera)","Italian (Switzerland)"],17:["ja","日本語"],1041:["ja-JP","日本語 (日本)","Japanese (Japan)"],75:["kn","ಕನ್ನಡ"],1099:["kn-IN","ಕನ್ನಡ (ಭಾರತ)","Kannada (India)"],63:["kk","Қазақ"],1087:["kk-KZ","Қазақ (Қазақстан)","Kazakh (Kazakhstan)"],83:["km","ខ្មែរ"],1107:["km-KH","ខ្មែរ (កម្ពុជា)","Khmer (Cambodia)"],134:["qut","K'iche"],1158:["qut-GT","K'iche (Guatemala)","K'iche (Guatemala)"],135:["rw","Kinyarwanda"],1159:["rw-RW","Kinyarwanda (Rwanda)","Kinyarwanda (Rwanda)"],65:["sw","Kiswahili"],1089:["sw-KE","Kiswahili (Kenya)","Kiswahili (Kenya)"],87:["kok","कोंकणी"],1111:["kok-IN","कोंकणी (भारत)","Konkani (India)"],18:["ko","한국어"],1042:["ko-KR","한국어 (대한민국)","Korean (Korea)"],64:["ky","Кыргыз"],1088:["ky-KG","Кыргыз (Кыргызстан)","Kyrgyz (Kyrgyzstan)"],84:["lo","ລາວ"],1108:["lo-LA","ລາວ (ສ.ປ.ປ. ລາວ)","Lao (Lao P.D.R.)"],38:["lv","Latviešu"],1062:["lv-LV","Latviešu (Latvija)","Latvian (Latvia)"],39:["lt","Lietuvių"],1063:["lt-LT","Lietuvių (Lietuva)","Lithuanian (Lithuania)"],31790:["dsb","Dolnoserbšćina"],2094:["dsb-DE","Dolnoserbšćina (Nimska)","Lower Sorbian (Germany)"],110:["lb","Lëtzebuergesch"],1134:["lb-LU","Lëtzebuergesch (Luxembourg)","Luxembourgish (Luxembourg)"],1071:["mk-MK","Македонски јазик (Македонија)","Macedonian (Macedonia)"],47:["mk","Македонски јазик"],62:["ms","Bahasa Melayu"],2110:["ms-BN","Bahasa Melayu (Brunei Darussalam)","Malay (Brunei Darussalam)"],1086:["ms-MY","Bahasa Melayu (Malaysia)","Malay (Malaysia)"],76:["ml","മലയാളം"],1100:["ml-IN","മലയാളം (ഭാരതം)","Malayalam (India)"],58:["mt","Malti"],1082:["mt-MT","Malti (Malta)","Maltese (Malta)"],129:["mi","Reo Māori"],1153:["mi-NZ","Reo Māori (Aotearoa)","Maori (New Zealand)"],122:["arn","Mapudungun"],1146:["arn-CL","Mapudungun (Chile)","Mapudungun (Chile)"],78:["mr","मराठी"],1102:["mr-IN","मराठी (भारत)","Marathi (India)"],124:["moh","Kanien'kéha"],1148:["moh-CA","Kanien'kéha (Canada)","Mohawk (Canada)"],80:["mn","Монгол хэл"],30800:["mn-Cyrl","Монгол хэл"],1104:["mn-MN","Монгол хэл (Монгол улс)","Mongolian (Cyrillic, Mongolia)"],31824:["mn-Mong","ᠮᠤᠨᠭᠭᠤᠯ ᠬᠡᠯᠡ"],2128:["mn-Mong-CN","ᠮᠤᠨᠭᠭᠤᠯ ᠬᠡᠯᠡ (ᠪᠦᠭᠦᠳᠡ ᠨᠠᠢᠷᠠᠮᠳᠠᠬᠤ ᠳᠤᠮᠳᠠᠳᠤ ᠠᠷᠠᠳ ᠣᠯᠣᠰ)","Mongolian (People's Republic of China)"],97:["ne","नेपाली"],1121:["ne-NP","नेपाली (नेपाल)","Nepali (Nepal)"],2145:["ne-IN","नेपाली (भारत)","Nepali (India)"],20:["no","Norsk"],31764:["nb","Norsk (bokmål)"],1044:["nb-NO","Norsk, bokmål (Norge)","Norwegian, Bokmål (Norway)"],30740:["nn","Norsk (Nynorsk)"],2068:["nn-NO","Norsk, nynorsk (Noreg)","Norwegian, Nynorsk (Norway)"],130:["oc","Occitan"],1154:["oc-FR","Occitan (França)","Occitan (France)"],72:["or","ଓଡ଼ିଆ"],1096:["or-IN","ଓଡ଼ିଆ (ଭାରତ)","Oriya (India)"],99:["ps","پښتو‏"],1123:["ps-AF","پښتو (افغانستان)‏","Pashto (Afghanistan)"],41:["fa","فارسى‏"],1065:["fa-IR","فارسى (ایران)‏","Persian (Iran)"],21:["pl","Polski"],1045:["pl-PL","Polski (Polska)","Polish (Poland)"],22:["pt","Português"],1046:["pt-BR","Português (Brasil)","Portuguese (Brazil)"],2070:["pt-PT","Português (Portugal)","Portuguese (Portugal)"],70:["pa","ਪੰਜਾਬੀ"],1094:["pa-IN","ਪੰਜਾਬੀ (ਭਾਰਤ)","Punjabi (India)"],107:["quz","Runasimi"],1131:["quz-BO","Runasimi (Qullasuyu)","Quechua (Bolivia)"],2155:["quz-EC","Runasimi (Ecuador)","Quechua (Ecuador)"],3179:["quz-PE","Runasimi (Piruw)","Quechua (Peru)"],24:["ro","Română"],1048:["ro-RO","Română (România)","Romanian (Romania)"],2072:["ro-MD","Română (Moldova)","Romanian (Republic of Moldova)"],23:["rm","Rumantsch"],1047:["rm-CH","Rumantsch (Svizra)","Romansh (Switzerland)"],25:["ru","Русский"],1049:["ru-RU","Русский (Россия)","Russian (Russia)"],2073:["ru-MD","Русский (Молдавия)","Russian (Republic of Moldova)"],28731:["smn","Sämikielâ"],9275:["smn-FI","Sämikielâ (Suomâ)","Sami (Inari, Finland)"],31803:["smj","Julevusámegiella"],4155:["smj-NO","Julevusámegiella (Vuodna)","Sami (Lule, Norway)"],5179:["smj-SE","Julevusámegiella (Svierik)","Sami (Lule, Sweden)"],59:["se","Davvisámegiella"],3131:["se-FI","Davvisámegiella (Suopma)","Sami (Northern, Finland)"],1083:["se-NO","Davvisámegiella (Norga)","Sami (Northern, Norway)"],2107:["se-SE","Davvisámegiella (Ruoŧŧa)","Sami (Northern, Sweden)"],29755:["sms","Sääm´ǩiõll"],8251:["sms-FI","Sääm´ǩiõll (Lää´ddjânnam)","Sami (Skolt, Finland)"],30779:["sma","åarjelsaemiengiele"],6203:["sma-NO","åarjelsaemiengiele (Nöörje)","Sami (Southern, Norway)"],7227:["sma-SE","åarjelsaemiengiele (Sveerje)","Sami (Southern, Sweden)"],79:["sa","संस्कृत"],1103:["sa-IN","संस्कृत (भारतम्)","Sanskrit (India)"],145:["gd","Gàidhlig"],1169:["gd-GB","Gàidhlig (An Rìoghachd Aonaichte)","Scottish Gaelic (United Kingdom)"],31770:["sr","Srpski"],27674:["sr-Cyrl","Српски (Ћирилица)"],7194:["sr-Cyrl-BA","Српски (Босна и Херцеговина)","Serbian (Cyrillic, Bosnia and Herzegovina)"],12314:["sr-Cyrl-ME","Српски (Црна Гора)","Serbian (Cyrillic, Montenegro)"],3098:["sr-Cyrl-CS","Српски (Србија и Црна Гора (Претходно))","Serbian (Cyrillic, Serbia and Montenegro (Former))"],10266:["sr-Cyrl-RS","Српски (Србија)","Serbian (Cyrillic, Serbia)"],28698:["sr-Latn","Srpski (Latinica)"],6170:["sr-Latn-BA","Srpski (Bosna i Hercegovina)","Serbian (Latin, Bosnia and Herzegovina)"],11290:["sr-Latn-ME","Srpski (Crna Gora)","Serbian (Latin, Montenegro)"],2074:["sr-Latn-CS","Srpski (Srbija i Crna Gora (Prethodno))","Serbian (Latin, Serbia and Montenegro (Former))"],9242:["sr-Latn-RS","Srpski (Srbija, Latinica)","Serbian (Latin, Serbia)"],108:["nso","Sesotho sa Leboa"],1132:["nso-ZA","Sesotho sa Leboa (Afrika Borwa)","Sesotho sa Leboa (South Africa)"],50:["tn","Setswana"],1074:["tn-ZA","Setswana (Aforika Borwa)","Setswana (South Africa)"],91:["si","සිංහ"],1115:["si-LK","සිංහල (ශ්‍රී ලංකාව)","Sinhala (Sri Lanka)"],27:["sk","Slovenčina"],1051:["sk-SK","Slovenčina (Slovenská republika)","Slovak (Slovakia)"],36:["sl","Slovenski"],1060:["sl-SI","Slovenski (Slovenija)","Slovenian (Slovenia)"],10:["es","Español"],11274:["es-AR","Español (Argentina)","Spanish (Argentina)"],16394:["es-BO","Español (Bolivia)","Spanish (Bolivia)"],13322:["es-CL","Español (Chile)","Spanish (Chile)"],9226:["es-CO","Español (Colombia)","Spanish (Colombia)"],5130:["es-CR","Español (Costa Rica)","Spanish (Costa Rica)"],7178:["es-DO","Español (República Dominicana)","Spanish (Dominican Republic)"],12298:["es-EC","Español (Ecuador)","Spanish (Ecuador)"],17418:["es-SV","Español (El Salvador)","Spanish (El Salvador)"],4106:["es-GT","Español (Guatemala)","Spanish (Guatemala)"],18442:["es-HN","Español (Honduras)","Spanish (Honduras)"],2058:["es-MX","Español (México)","Spanish (Mexico)"],19466:["es-NI","Español (Nicaragua)","Spanish (Nicaragua)"],6154:["es-PA","Español (Panamá)","Spanish (Panama)"],15370:["es-PY","Español (Paraguay)","Spanish (Paraguay)"],10250:["es-PE","Español (Perú)","Spanish (Peru)"],20490:["es-PR","Español (Puerto Rico)","Spanish (Puerto Rico)"],3082:["es-ES","Español (España, alfabetización internacional)","Spanish (Spain)"],21514:["es-US","Español (Estados Unidos)","Spanish (United States)"],14346:["es-UY","Español (Uruguay)","Spanish (Uruguay)"],8202:["es-VE","Español (Republica Bolivariana de Venezuela)","Spanish (Venezuela)"],1034:["es-ES_tradnl","Spanish"],22538:["es-419","Español (América Latina y el Caribe)","Spanish (Latin America and the Caribbean)"],23562:["es-CU","Español (Cuba)","Spanish (Cuba)"],29:["sv","Svenska"],2077:["sv-FI","Svenska (Finland)","Swedish (Finland)"],1053:["sv-SE","Svenska (Sverige)","Swedish (Sweden)"],90:["syr","ܣܘܪܝܝܐ‏"],1114:["syr-SY","ܣܘܪܝܝܐ (سوريا)‏","Syriac (Syria)"],40:["tg","Тоҷикӣ"],31784:["tg-Cyrl","Тоҷикӣ"],1064:["tg-Cyrl-TJ","Тоҷикӣ (Тоҷикистон)","Tajik (Cyrillic, Tajikistan)"],95:["tzm","Tamazight"],31839:["tzm-Latn","Tamazight (Latin)"],2143:["tzm-Latn-DZ","Tamazight (Djazaïr)","Tamazight (Latin, Algeria)"],73:["ta","தமிழ்"],1097:["ta-IN","தமிழ் (இந்தியா)","Tamil (India)"],68:["tt","Татар"],1092:["tt-RU","Татар (Россия)","Tatar (Russia)"],74:["te","తెలుగు"],1098:["te-IN","తెలుగు (భారత దేశం)","Telugu (India)"],30:["th","ไทย"],1054:["th-TH","ไทย (ไทย)","Thai (Thailand)"],81:["bo","བོད་ཡིག"],1105:["bo-CN","བོད་ཡིག (ཀྲུང་ཧྭ་མི་དམངས་སྤྱི་མཐུན་རྒྱལ་ཁབ།)","Tibetan (People's Republic of China)"],2129:["bo-BT","Tibetan (Bhutan)","Tibetan (Bhutan)"],31:["tr","Türkçe"],1055:["tr-TR","Türkçe (Türkiye)","Turkish (Turkey)"],66:["tk","Türkmençe"],1090:["tk-TM","Türkmençe (Türkmenistan)","Turkmen (Turkmenistan)"],34:["uk","Українська"],1058:["uk-UA","Українська (Україна)","Ukrainian (Ukraine)"],46:["hsb","Hornjoserbšćina"],1070:["hsb-DE","Hornjoserbšćina (Němska)","Upper Sorbian (Germany)"],32:["ur","اُردو‏"],1056:["ur-PK","اُردو (پاکستان)‏","Urdu (Islamic Republic of Pakistan)"],2080:["ur-IN","اُردو (بھارت)‏","Urdu (India)"],128:["ug","ئۇيغۇر يېزىقى‏"],1152:["ug-CN","ئۇيغۇر يېزىقى (جۇڭخۇا خەلق جۇمھۇرىيىتى)‏","Uighur (People's Republic of China)"],30787:["uz-Cyrl","Ўзбек"],2115:["uz-Cyrl-UZ","Ўзбек (Ўзбекистон)","Uzbek (Cyrillic, Uzbekistan)"],67:["uz","U'zbek"],31811:["uz-Latn","U'zbek"],1091:["uz-Latn-UZ","U'zbek (U'zbekiston Respublikasi)","Uzbek (Latin, Uzbekistan)"],42:["vi","Tiếng Việt"],1066:["vi-VN","Tiếng Việt (Việt Nam)","Vietnamese (Vietnam)"],82:["cy","Cymraeg"],1106:["cy-GB","Cymraeg (y Deyrnas Unedig)","Welsh (United Kingdom)"],136:["wo","Wolof"],1160:["wo-SN","Wolof (Sénégal)","Wolof (Senegal)"],133:["sah","Саха"],1157:["sah-RU","Саха (Россия)","Yakut (Russia)"],120:["ii","ꆈꌠꁱꂷ"],1144:["ii-CN","ꆈꌠꁱꂷ (ꍏꉸꏓꂱꇭꉼꇩ)","Yi (People's Republic of China)"],106:["yo","Yoruba"],1130:["yo-NG","Yoruba (Nigeria)","Yoruba (Nigeria)"],1126:["bin-NG","Bini (Nigeria)","Bini (Nigeria)"],1116:["chr-US","ᏣᎳᎩ (ᏌᏊ ᎢᏳᎾᎵᏍᏔᏅ ᏍᎦᏚᎩ)","Cherokee (United States)"],1127:["fuv-NG","Nigerian Fulfulde (Nigeria)","Nigerian Fulfulde (Nigeria)"],1138:["gaz-ET","West Central Oromo (Ethiopia)","West Central Oromo (Ethiopia)"],1140:["gn-PY","Guarani (Paraguay)","Guarani (Paraguay)"],1141:["haw-US","ʻŌlelo Hawaiʻi (ʻAmelika Hui Pū ʻIa)","Hawaiian (United States)"],1129:["ibb-NG","Ibibio (Nigeria)","Ibibio (Nigeria)"],1137:["kr-NG","Kanuri (Nigeria)","Kanuri (Nigeria)"],1112:["mni","Manipuri","Manipuri"],1109:["my-MM","Burmese (Myanmar)","Burmese (Myanmar)"],1145:["pap-AN","Papiamento, Netherlands Antilles","Papiamento, Netherlands Antilles"],2118:["pa-PK","Panjabi (Pakistan)","Panjabi (Pakistan)"],1165:["plt-MG","Plateau Malagasy (Madagascar)","Plateau Malagasy (Madagascar)"],1113:["sd-IN","Sindhi (India)","Sindhi (India)"],2137:["sd-PK","Sindhi (Pakistan)","Sindhi (Pakistan)"],1143:["so-SO","Soomaali (Soomaaliya)","Somali (Somalia)"],1072:["st-ZA","Southern Sotho (South Africa)","Southern Sotho (South Africa)"],1139:["ti-ER","ትግርኛ (ኤርትራ)","Tigrinya (Eritrea)"],2163:["ti-ET","ትግርኛ (ኢትዮጵያ)","Tigrinya (Ethiopia)"],1119:["tmz","Tamanaku"],3167:["tmz-MA","Tamaziɣt n laṭlaṣ (Meṛṛuk)","Tamanaku (Morocco)"],1073:["ts-ZA","Tsonga (South Africa)","Tsonga (South Africa)"],1075:["ven-ZA","South Africa","South Africa"]},e={ar:1025,az:1068,en:1033,sr:9242,zh:4},i=function(e){if(e)for(var i in t)if(t[i][0].toLowerCase()===e.toLowerCase())return i;return null};return{getLocalLanguageName:function(e){return t[e]||["",e]},getLocalLanguageCode:i,getLocalLanguageDisplayName:function(e){var i=t[e];if(i){var o=function(t){var e=t.replace("(","– "),i=e.lastIndexOf(")");return-1!==i&&(e=e.slice(0,i)+e.slice(i+1)),e},n=i[1],s=i[2];return s?{native:o(n),english:o(s)}:{native:n,english:""}}return null},getDefaultLanguageCode:function(t){return t=t.toLowerCase(),e[t]?e[t]:(t+="-"+t.toUpperCase(),i(t))},getLanguages:function(){return t}}},define("common/main/lib/util/LanguageInfo",(function(){})),define("spreadsheeteditor/main/app/model/ShapeGroup",["backbone"],(function(t){"use strict";SSE.Models=SSE.Models||{},SSE.Models.ShapeModel=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),imageUrl:null,data:null}}}),SSE.Models.ShapeGroup=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),groupName:null,groupId:null,groupStore:null}}})})),define("spreadsheeteditor/main/app/collection/ShapeGroups",["backbone","spreadsheeteditor/main/app/model/ShapeGroup"],(function(t){"use strict";if(void 0===e)var e={};e.Collections=e.Collections||{},SSE.Collections.ShapeGroups=t.Collection.extend({model:SSE.Models.ShapeGroup})})),define("spreadsheeteditor/main/app/model/EquationGroup",["backbone"],(function(t){"use strict";SSE.Models=SSE.Models||{},SSE.Models.EquationModel=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),data:null,width:0,height:0,posX:0,posY:0}}}),SSE.Models.EquationGroup=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),groupName:null,groupId:null,groupStore:null}}})})),define("spreadsheeteditor/main/app/collection/EquationGroups",["backbone","spreadsheeteditor/main/app/model/EquationGroup"],(function(t){"use strict";if(void 0===e)var e={};e.Collections=e.Collections||{},SSE.Collections.EquationGroups=t.Collection.extend({model:SSE.Models.EquationGroup})})),define("spreadsheeteditor/main/app/collection/ConditionalFormatIcons",["backbone"],(function(t){"use strict";SSE.Collections.ConditionalFormatIcons=t.Collection.extend({model:t.Model.extend({defaults:function(){return{id:Common.UI.getId(),index:0,icon:null}}})}),SSE.Collections.ConditionalFormatIconsPresets=t.Collection.extend({model:t.Model.extend({defaults:function(){return{id:Common.UI.getId(),data:0,icons:null}}})})})),define("spreadsheeteditor/main/app/model/Formula",["backbone"],(function(t){"use strict";SSE.Models=SSE.Models||{},SSE.Models.FormulaModel=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),index:0,group:null,name:null,origin:null,args:null}}}),SSE.Models.FormulaGroup=t.Model.extend({defaults:function(){return{id:Common.UI.getId(),index:0,name:null,store:null,functions:[]}}})})),define("spreadsheeteditor/main/app/collection/FormulaGroups",["backbone","spreadsheeteditor/main/app/model/Formula"],(function(t){"use strict";SSE.Collections=SSE.Collections||{},SSE.Collections.FormulaGroups=t.Collection.extend({model:SSE.Models.FormulaGroup})})),define("spreadsheeteditor/main/app/view/FormulaDialog",["common/main/lib/component/Window","spreadsheeteditor/main/app/collection/FormulaGroups"],(function(){"use strict";SSE.Views=SSE.Views||{},SSE.Views.FormulaDialog=Common.UI.Window.extend(_.extend({applyFunction:void 0,initialize:function(t){var e=this,i={};_.extend(i,{width:375,header:!0,cls:"modal-dlg formula-dlg",contentTemplate:"",title:e.txtTitle,items:[],buttons:[{value:"ok",caption:this.okButtonText,primary:!0,id:"formula-dlg-btn-ok"},"cancel"]},t),this.template=t.template||['<div class="box" style="height:405px;">','<div class="content-panel" >','<div id="formula-dlg-search" style="margin-bottom:10px;"></div>','<label class="header">'+e.textGroupDescription+"</label>",'<div id="formula-dlg-combo-group" class="input-group-nr" style=""></div>','<label class="header" style="margin-top: 10px">'+e.textListDescription+"</label>",'<div id="formula-dlg-combo-functions" class="combo-functions"></div>','<label id="formula-dlg-args" style="margin-top: 7px"></label>','<label id="formula-dlg-desc" style="margin-top: 4px; display: block;"></label>',"</div>","</div>",'<div class="separator horizontal"></div>'].join(""),this.api=t.api,this.formulasGroups=t.formulasGroups,this.handler=t.handler,i.tpl=_.template(this.template)(i),Common.UI.Window.prototype.initialize.call(this,i)},render:function(){Common.UI.Window.prototype.render.call(this),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this));var t=this;this.inputSearch=new Common.UI.InputField({el:$("#formula-dlg-search",this.$window),allowBlank:!0,placeHolder:this.txtSearch,validateOnChange:!0,validation:function(){return!0}}).on("changing",(function(e,i){i.length?(i=i.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),t.filter=i.toLowerCase()):t.filter=void 0,t.filterFormulas()})),this.btnOk=_.find(this.getFooterButtons(),(function(t){return t.$el&&t.$el.find("#formula-dlg-btn-ok").addBack().filter("#formula-dlg-btn-ok").length>0}))||new Common.UI.Button({el:$("#formula-dlg-btn-ok")}),this.syntaxLabel=$("#formula-dlg-args"),this.descLabel=$("#formula-dlg-desc"),this.fillFormulasGroups()},getFocusedComponents:function(){return[this.inputSearch,this.cmbFuncGroup,this.cmbListFunctions].concat(this.getFooterButtons())},getDefaultFocusableComponent:function(){return this.inputSearch},show:function(t){if(this.$window){var e,i,o,n,s=this.initConfig.height;void 0===window.innerHeight?(e=document.documentElement.offsetWidth,i=document.documentElement.offsetHeight):(e=Common.Utils.innerWidth(),i=Common.Utils.innerHeight()),o=(parseInt(i,10)-parseInt(s,10))/2,n=(parseInt(e,10)-parseInt(this.initConfig.width,10))/2,this.$window.css("left",Math.floor(n)),this.$window.css("top",Math.floor(o))}Common.UI.Window.prototype.show.call(this),t&&this.cmbFuncGroup.setValue(t),(t||"Last10"==this.cmbFuncGroup.getValue())&&this.fillFunctions(this.cmbFuncGroup.getValue()),this.inputSearch.setValue(""),this._preventCloseCellEditor=!1},hide:function(){var t=this.cmbFuncGroup.getValue();"Recommended"==t&&(t="Last10"),this.cmbFuncGroup.store.length>0&&"Recommended"==this.cmbFuncGroup.store.at(0).get("value")&&(this.cmbFuncGroup.store.shift(),this.cmbFuncGroup.onResetItems()),this.cmbFuncGroup.setValue(t),this.recommended=this.filter=void 0,Common.UI.Window.prototype.hide.call(this),!this._preventCloseCellEditor&&this.api.asc_closeCellEditor(!0)},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},onDblClickFunction:function(){this._handleInput("ok")},onSelectGroup:function(t,e){_.isUndefined(e)||_.isUndefined(e.value)||e.value&&this.fillFunctions(e.value),this.onUpdateFocus()},onSelectFunction:function(t,e,i){this.formulasGroups&&i&&(this.applyFunction={name:i.get("value"),origin:i.get("origin")},this.syntaxLabel.text(this.applyFunction.name+i.get("args")),this.descLabel.text(i.get("desc")))},onPrimary:function(t,e,i){return this._handleInput("ok"),!1},_handleInput:function(t){if(this.handler&&"ok"==t){if(this.btnOk.isDisabled())return;this._preventCloseCellEditor=!0,this.handler.call(this,this.applyFunction)}this.hide()},onUpdateFocus:function(){this.cmbListFunctions&&_.delay((function(t){t.cmbListFunctions.focus()}),100,this)},fillFormulasGroups:function(){if(this.formulasGroups){var t=Common.Utils.InternalSettings.get("sse-settings-func-locale");_.isEmpty(t)&&(t="en");var e,i=[],o=this.formulasGroups.length;for(e=0;e<o;++e){var n;(n=this.formulasGroups.at(e)).get("functions").length&&i.push({value:n.get("name"),displayValue:n.get("caption")})}this.cmbFuncGroup?this.cmbFuncGroup.setData(i):(this.cmbFuncGroup=new Common.UI.ComboBox({el:$("#formula-dlg-combo-group"),menuStyle:"min-width: 100%;",cls:"input-group-nr",data:i,editable:!1,takeFocusOnClose:!0}),this.cmbFuncGroup.on("selected",_.bind(this.onSelectGroup,this))),this.cmbFuncGroup.setValue("Last10"),this.fillFunctions("Last10"),this.allFunctions=new Common.UI.DataViewStore,(n=this.formulasGroups.findWhere({name:"All"}))&&this.allFunctions.reset(n.get("functions"))}},fillFunctions:function(t){if(this.formulasGroups&&(this.cmbListFunctions||this.functions||(this.functions=new Common.UI.DataViewStore,this.cmbListFunctions=new Common.UI.ListView({el:$("#formula-dlg-combo-functions"),store:this.functions,tabindex:1,cls:"dbl-clickable"}),this.cmbListFunctions.on("item:select",_.bind(this.onSelectFunction,this)),this.cmbListFunctions.on("item:dblclick",_.bind(this.onDblClickFunction,this)),this.cmbListFunctions.on("entervalue",_.bind(this.onPrimary,this)),this.cmbListFunctions.onKeyDown=_.bind(this.onKeyDown,this),this.onUpdateFocus()),this.functions)){this.functions.reset();var e=null;if("Recommended"==t)e=this.recommended;else{var i=this.formulasGroups.findWhere({name:t});i&&(e=i.get("functions"))}for(var o=e?e.length:0,n=0;n<o;++n)this.functions.push(new Common.UI.DataViewModel({id:e[n].get("index"),selected:n<1,allowSelected:!0,value:e[n].get("name"),args:e[n].get("args"),desc:e[n].get("desc"),origin:e[n].get("origin")}));this.applyFunction=o?{name:e[0].get("name"),origin:e[0].get("origin")}:void 0,this.syntaxLabel.text(o?this.applyFunction.name+e[0].get("args"):""),this.descLabel.text(o?e[0].get("desc"):""),this.cmbListFunctions.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0}),this.btnOk.setDisabled(!o)}},filterFormulas:function(){if(!this.filter)return this.cmbFuncGroup.setValue("Last10"),void this.fillFunctions("Last10");var t=this,e=new RegExp(t.filter,"ig"),i=this.allFunctions.filter((function(t){return!!t.get("name").match(e)}));if(i.length>0){"Recommended"!=this.cmbFuncGroup.store.at(0).get("value")&&(this.cmbFuncGroup.store.unshift({value:"Recommended",displayValue:this.txtRecommended}),this.cmbFuncGroup.onResetItems());var o=_.findIndex(i,(function(e){return e.get("name").toLowerCase()===t.filter}));if(o>0){var n=i.splice(o,1);i.unshift(n[0])}}else 0==i.length&&this.cmbFuncGroup.store.length>0&&"Recommended"==this.cmbFuncGroup.store.at(0).get("value")&&(this.cmbFuncGroup.store.shift(),this.cmbFuncGroup.onResetItems());this.cmbFuncGroup.setValue("Recommended",this.txtRecommended),this.recommended=i,this.fillFunctions("Recommended")},onKeyDown:function(t,e){var i=0,o=null,n=this,s=this.cmbListFunctions,a="",r="",l=null,c=null,h=!1,d=null;if(!s.disabled){if(_.isUndefined(void 0)&&(e=t),a=t.key,t.keyCode>64&&t.keyCode<91&&a&&a.length){for(a=a.toLocaleLowerCase(),(d=s.store.findWhere({selected:!0}))&&(h=(r=d.get("value"))&&r.length&&r[0].toLocaleLowerCase()===a),i=0;i<s.store.length;++i)if((r=(o=s.store.at(i)).get("value"))[0].toLocaleLowerCase()===a){if(null===l&&(l=o),h){d===o&&(h=!1);continue}if(o.get("selected"))continue;return void m(o)}if(l)return void m(l)}Common.UI.DataView.prototype.onKeyDown.call(s,t,e)}function m(t){s.selectRecord(t),n.onScrollToRecordCustom.call(s,t),c=$(s.el).find(".inner"),s.scroller.scrollTop(c.scrollTop(),0),e.preventDefault(),e.stopPropagation()}},onScrollToRecordCustom:function(t){var e=$(this.el).find(".inner"),i=Common.Utils.getOffset(e).top,o=e.find("#"+t.get("id")).parent(),n=Common.Utils.getOffset(o).top;(n<i||n+o.height()>i+e.height())&&(this.scroller?this.scroller.scrollTop(e.scrollTop()+n-i,0):e.scrollTop(e.scrollTop()+n-i))},textGroupDescription:"Select Function Group",textListDescription:"Select Function",sDescription:"Description",txtTitle:"Insert Function",txtSearch:"Search",txtRecommended:"Recommended"},SSE.Views.FormulaDialog||{}))})),define("spreadsheeteditor/main/app/view/FormulaTab",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout"],(function(){"use strict";SSE.Views.FormulaTab=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;t.btnAutosum.on("click",(function(){t.fireEvent("function:apply",[{name:t.api.asc_getFormulaLocaleName("SUM"),origin:"SUM"},!0])})),t.btnAutosum.menu.on("item:click",(function(e,i,o){t.fireEvent("function:apply",[{name:i.caption,origin:i.value},!0])})),t.btnFormula.on("click",(function(){t.fireEvent("function:apply",[{name:"more",origin:"more"}])})),t.btnCalculate.on("click",(function(){t.fireEvent("function:calculate",[{type:Asc.c_oAscCalculateType.All}])})),t.btnCalculate.menu.on("item:click",(function(e,i,o){t.fireEvent("function:calculate",[{type:i.value}])})),t.btnNamedRange.menu.on("show:after",(function(e){t.fireEvent("function:namedrange-open",[e])})),t.btnNamedRange.menu.on("item:click",(function(e,i,o){t.fireEvent("function:namedrange",[e,i,o])})),t.btnWatch.on("click",(function(e,i){t.fireEvent("function:watch",[e.pressed])})),t.btnTracePrec.on("click",(function(e,i){t.fireEvent("function:precedents")})),t.btnTraceDep.on("click",(function(e,i){t.fireEvent("function:dependents")})),t.btnRemArrows.menu.on("item:click",(function(e,i,o){t.fireEvent("function:remove-arrows",[i.value])})),t.btnRemArrows.on("click",(function(e,i){t.fireEvent("function:remove-arrows",[Asc.c_oAscRemoveArrowsType.all])})),t.btnShowFormulas&&this.btnShowFormulas.on("click",(function(e,i){t.fireEvent("function:showformula",[e.pressed])}))}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this),this.toolbar=t.toolbar,this.formulasGroups=t.formulasGroups,this.lockedControls=[],this.formulaControls=[];var e=this,i=e.toolbar.$el,o=Common.enumLock,n=SSE.getController("FormulaDialog");this.btnFinancial=new Common.UI.Button({parentEl:i.find("#slot-btn-financial"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-finance",caption:n.sCategoryFinancial,hint:n.sCategoryFinancial,menu:!0,split:!1,action:"formula-financial",disabled:!0,lock:[o.editText,o.selChart,o.selChartText,o.selShape,o.selShapeText,o.selImage,o.selSlicer,o.selRangeEdit,o.lostConnect,o.coAuth,o.noSubitems,o.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnFinancial),this.formulaControls.push(this.btnFinancial),this.btnLogical=new Common.UI.Button({parentEl:i.find("#slot-btn-logical"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-logic",caption:n.sCategoryLogical,hint:n.sCategoryLogical,menu:!0,split:!1,disabled:!0,action:"formula-logical",lock:[o.editText,o.selChart,o.selChartText,o.selShape,o.selShapeText,o.selImage,o.selSlicer,o.selRangeEdit,o.lostConnect,o.coAuth,o.noSubitems,o.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnLogical),this.formulaControls.push(this.btnLogical),this.btnTextData=new Common.UI.Button({parentEl:i.find("#slot-btn-text"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-func-text",caption:n.sCategoryTextAndData,hint:n.sCategoryTextAndData,menu:!0,split:!1,action:"formula-textdata",disabled:!0,lock:[o.editText,o.selChart,o.selChartText,o.selShape,o.selShapeText,o.selImage,o.selSlicer,o.selRangeEdit,o.lostConnect,o.coAuth,o.noSubitems,o.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnTextData),this.formulaControls.push(this.btnTextData),this.btnDateTime=new Common.UI.Button({parentEl:i.find("#slot-btn-datetime"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-datetime",caption:n.sCategoryDateAndTime,hint:n.sCategoryDateAndTime,menu:!0,split:!1,action:"formula-datetime",disabled:!0,lock:[o.editText,o.selChart,o.selChartText,o.selShape,o.selShapeText,o.selImage,o.selSlicer,o.selRangeEdit,o.lostConnect,o.coAuth,o.noSubitems,o.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnDateTime),this.formulaControls.push(this.btnDateTime),this.btnReference=new Common.UI.Button({parentEl:i.find("#slot-btn-lookup"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-lookup",caption:n.sCategoryLookupAndReference,hint:n.sCategoryLookupAndReference,menu:!0,split:!1,action:"formula-reference",disabled:!0,lock:[o.editText,o.selChart,o.selChartText,o.selShape,o.selShapeText,o.selImage,o.selSlicer,o.selRangeEdit,o.lostConnect,o.coAuth,o.noSubitems,o.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnReference),this.formulaControls.push(this.btnReference),this.btnMath=new Common.UI.Button({parentEl:i.find("#slot-btn-math"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-func-math",caption:n.sCategoryMathematic,hint:n.sCategoryMathematic,menu:!0,split:!1,action:"formula-math",disabled:!0,lock:[o.editText,o.selChart,o.selChartText,o.selShape,o.selShapeText,o.selImage,o.selSlicer,o.selRangeEdit,o.lostConnect,o.coAuth,o.noSubitems,o.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnMath),this.formulaControls.push(this.btnMath),this.btnRecent=new Common.UI.Button({parentEl:i.find("#slot-btn-recent"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-recent",caption:this.txtRecent,hint:this.txtRecent,menu:!0,split:!1,action:"formula-recent",disabled:!0,lock:[o.editText,o.selChart,o.selChartText,o.selShape,o.selShapeText,o.selImage,o.selSlicer,o.selRangeEdit,o.lostConnect,o.coAuth,o.noSubitems,o.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnRecent),this.formulaControls.push(this.btnRecent),this.btnAutosum=new Common.UI.Button({parentEl:i.find("#slot-btn-autosum"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-autosum",caption:this.txtAutosum,hint:[this.txtAutosumTip+Common.Utils.String.platformKey("Alt+="),this.txtFormulaTip+Common.Utils.String.platformKey("Shift+F3")],split:!0,action:"autosum",disabled:!0,lock:[o.editText,o.selChart,o.selChartText,o.selShape,o.selShapeText,o.selImage,o.selSlicer,o.selRangeEdit,o.lostConnect,o.coAuth,o.userProtected],menu:new Common.UI.Menu({items:[{caption:"SUM",value:"SUM"},{caption:"AVERAGE",value:"AVERAGE"},{caption:"MIN",value:"MIN"},{caption:"MAX",value:"MAX"},{caption:"COUNT",value:"COUNT"},{caption:"--"},{caption:e.txtAdditional,value:"more",hint:e.txtFormulaTip+Common.Utils.String.platformKey("Shift+F3")}]}),dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnAutosum),this.formulaControls.push(this.btnAutosum),this.btnFormula=new Common.UI.Button({parentEl:i.find("#slot-btn-additional-formula"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ins-formula",caption:this.txtFormula,hint:this.txtFormulaTip+Common.Utils.String.platformKey("Shift+F3"),disabled:!0,lock:[o.editText,o.selChart,o.selChartText,o.selShape,o.selShapeText,o.selImage,o.selSlicer,o.selRangeEdit,o.lostConnect,o.coAuth,o.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnFormula),this.formulaControls.push(this.btnFormula),this.btnMore=new Common.UI.Button({parentEl:i.find("#slot-btn-more"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-big-more",caption:this.txtMore,hint:this.txtMore,menu:!0,split:!1,action:"formula-more",disabled:!0,lock:[o.editText,o.selChart,o.selChartText,o.selShape,o.selShapeText,o.selImage,o.selSlicer,o.selRangeEdit,o.lostConnect,o.coAuth,o.noSubitems,o.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnMore),this.formulaControls.push(this.btnMore),this.btnCalculate=new Common.UI.Button({parentEl:i.find("#slot-btn-calculate"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-calculation",caption:this.txtCalculation,split:!0,menu:!0,action:"calculate",disabled:!0,lock:[o.editCell,o.selRangeEdit,o.lostConnect,o.coAuth],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnCalculate),this.formulaControls.push(this.btnCalculate),this.btnNamedRange=new Common.UI.Button({parentEl:i.find("#slot-btn-named-range-huge"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-big-named-range",caption:this.toolbar.txtNamedRange,hint:this.toolbar.txtNamedRange,split:!1,disabled:!0,lock:[o.selChart,o.selChartText,o.selShape,o.selShapeText,o.selImage,o.lostConnect,o.coAuth,o.selRangeEdit,o.wsLock],menu:new Common.UI.Menu({items:[{caption:e.toolbar.txtManageRange,lock:[o.editCell],value:"manage"},{caption:e.toolbar.txtNewRange,lock:[o.editCell],value:"new"},{caption:e.toolbar.txtPasteRange,lock:[o.userProtected],value:"paste"}]}),action:"named-ranges",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnNamedRange),this.btnWatch=new Common.UI.Button({parentEl:i.find("#slot-btn-watch-window"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-watch-window",caption:this.txtWatch,hint:this.tipWatch,disabled:!0,enableToggle:!0,lock:[o.editCell,o.lostConnect,o.coAuth],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnWatch),this.btnTracePrec=new Common.UI.Button({parentEl:i.find("#slot-btn-trace-prec"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-trace-precedents",lock:[o.editCell,o.editText,o.selChart,o.selChartText,o.selShape,o.selShapeText,o.selImage,o.selSlicer,o.selRangeEdit,o.lostConnect,o.coAuth,o.wsLock],caption:this.capBtnTracePrec,dataHint:"1",dataHintDirection:"left",dataHintOffset:"medium"}),this.lockedControls.push(this.btnTracePrec),this.btnTraceDep=new Common.UI.Button({parentEl:i.find("#slot-btn-trace-dep"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-trace-dependents",lock:[o.editCell,o.editText,o.selChart,o.selChartText,o.selShape,o.selShapeText,o.selImage,o.selSlicer,o.selRangeEdit,o.lostConnect,o.coAuth,o.wsLock],caption:this.capBtnTraceDep,dataHint:"1",dataHintDirection:"left",dataHintOffset:"medium"}),this.lockedControls.push(this.btnTraceDep),this.btnRemArrows=new Common.UI.Button({parentEl:i.find("#slot-btn-remove-arrows"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-remove-trace-arrows",lock:[o.editCell,o.editText,o.selChart,o.selChartText,o.selShape,o.selShapeText,o.selImage,o.selSlicer,o.selRangeEdit,o.lostConnect,o.coAuth,o.wsLock],caption:this.capBtnRemoveArr,split:!0,menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"0, -8"}),this.lockedControls.push(this.btnRemArrows),this.btnShowFormulas=new Common.UI.Button({parentEl:i.find("#slot-btn-show-formulas"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-show-formulas",caption:this.txtShowFormulas,disabled:!0,enableToggle:!0,lock:[o.sheetLock,o.editCell,o.lostConnect,o.coAuth],dataHint:"1",dataHintDirection:"left",dataHintOffset:"medium"}),this.lockedControls.push(this.btnShowFormulas),Common.UI.LayoutManager.addControls(this.lockedControls),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return this},onAppReady:function(e){var i=this;new Promise((function(t,e){t()})).then((function(){i.btnCalculate.updateHint([i.tipCalculateTheEntireWorkbook+Common.Utils.String.platformKey("F9"),i.tipCalculate]);var e=new Common.UI.Menu({items:[{caption:i.textCalculateWorkbook,value:Asc.c_oAscCalculateType.All},{caption:i.textCalculateCurrentSheet,value:Asc.c_oAscCalculateType.ActiveSheet}]});i.btnCalculate.setMenu(e),i.btnShowFormulas.updateHint(i.tipShowFormulas+Common.Utils.String.format(" ({0}+`)",Common.Utils.String.textCtrl)),i.btnTracePrec.updateHint(i.tipTracePrec),i.btnTraceDep.updateHint(i.tipTraceDep),i.btnRemArrows.updateHint(i.tipRemoveArr),i.btnRemArrows.setMenu(new Common.UI.Menu({items:[{caption:i.capBtnRemoveArr,value:Asc.c_oAscRemoveArrowsType.all},{caption:i.txtRemPrec,value:Asc.c_oAscRemoveArrowsType.precedent},{caption:i.txtRemDep,value:Asc.c_oAscRemoveArrowsType.dependent}]})),t.call(i)}))},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButtons:function(t){return"formula"==t?this.formulaControls:"range"==t?this.btnNamedRange:this.lockedControls},SetDisabled:function(t){this.lockedControls&&this.lockedControls.forEach((function(e){e&&e.setDisabled(t)}),this)},setButtonMenu:function(t,e){var i,o=this,n=[],s=o.formulasGroups.findWhere({name:e});if(s){var a=s.get("functions");a&&a.forEach((function(t){n.push(new Common.UI.MenuItem({caption:t.get("name"),value:t.get("origin")}))}))}n.length&&(t.menu&&t.menu.rendered?(i=t.menu._innerMenu)&&(i.removeAll(),n.forEach((function(t){i.addItem(t)}))):(t.setMenu(new Common.UI.Menu({items:[{template:_.template('<div id="id-toolbar-formula-menu-'+e+'" style="display: flex;" class="open"></div>')},{caption:"--"},{caption:o.txtAdditional,value:"more",hint:o.txtFormulaTip+Common.Utils.String.platformKey("Shift+F3")}]})),t.menu.items[2].on("click",(function(t,i){o.fireEvent("function:apply",[{name:t.caption,origin:t.value},!1,e])})),t.menu.on("show:after",(function(t,e){t._innerMenu.scroller.update({alwaysVisibleY:!0}),_.delay((function(){t._innerMenu&&t._innerMenu.cmpEl.focus()}),10)})),(i=new Common.UI.Menu({maxHeight:300,cls:"internal-menu",items:n,outerMenu:{menu:t.menu,index:0}})).render(t.menu.items[0].cmpEl.children(":first")),i.cmpEl.css({display:"block",position:"relative",left:0,top:0}),i.cmpEl.attr({tabindex:"-1"}),i.on("item:click",(function(t,i,n){o.fireEvent("function:apply",[{name:i.caption,origin:i.value},!1,e])})),t.menu._innerMenu=i,t.menu.setInnerMenu([{menu:i,index:0}])));Common.Utils.lockControls(Common.enumLock.noSubitems,n.length<1,{array:[t]})},setMenuItemMenu:function(t){var e=this,i=[],o=SSE.getController("FormulaDialog"),n=e.formulasGroups.findWhere({name:t}),s=n?n.get("functions"):[];s&&s.forEach((function(t){i.push(new Common.UI.MenuItem({caption:t.get("name"),value:t.get("origin")}))}));var a,r,l=this.btnMore;if(l.menu&&l.menu.rendered)for(var c=0;c<l.menu.getItemsLength(!0);c++)if(l.menu.items[c].options.value===t){a=l.menu.items[c];break}a?((r=a.menu._innerMenu)&&(r.removeAll(),i.forEach((function(t){r.addItem(t)}))),a.setVisible(i.length>0)):((a=new Common.UI.MenuItem({caption:o["sCategory"+t]||t,value:t,visible:i.length>0,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{template:_.template('<div id="id-toolbar-formula-menu-'+t+'" style="display: flex;" class="open"></div>')},{caption:"--"},{caption:e.txtAdditional,value:"more",hint:e.txtFormulaTip+Common.Utils.String.platformKey("Shift+F3")}]})})).menu.items[2].on("click",(function(i,o){e.fireEvent("function:apply",[{name:i.caption,origin:i.value},!1,t])})),a.menu.on("show:after",(function(t,e){t._innerMenu.scroller.update({alwaysVisibleY:!0}),_.delay((function(){t._innerMenu&&t._innerMenu.items[0].cmpEl.find("> a").focus()}),10)})).on("keydown:before",(function(t,e){if(e.keyCode==Common.UI.Keys.LEFT||e.keyCode==Common.UI.Keys.ESC){var i=t.cmpEl.parent();i.hasClass("dropdown-submenu")&&i.hasClass("over")&&(i.removeClass("over"),i.find("> a").focus())}})),(r=new Common.UI.Menu({maxHeight:300,cls:"internal-menu",items:i,outerMenu:{menu:a.menu,index:0}})).on("item:click",(function(i,o,n){e.fireEvent("function:apply",[{name:o.caption,origin:o.value},!1,t])})),a.menu._innerMenu=r,a.menu.setInnerMenu([{menu:r,index:0}]));return a},fillFunctions:function(){if(this.formulasGroups){this.setButtonMenu(this.btnFinancial,"Financial"),this.setButtonMenu(this.btnLogical,"Logical"),this.setButtonMenu(this.btnTextData,"TextAndData"),this.setButtonMenu(this.btnDateTime,"DateAndTime"),this.setButtonMenu(this.btnReference,"LookupAndReference"),this.setButtonMenu(this.btnMath,"Mathematic"),this.setButtonMenu(this.btnRecent,"Last10");for(var t=this.btnAutosum.menu.getItems(!0),e=0;e<Math.min(4,t.length);e++)this.api&&t[e].setCaption(this.api.asc_getFormulaLocaleName(t[e].value));var i=this,o=this.btnMore,n=[],s=0;o.menu&&o.menu.rendered&&o.menu.removeAll(!0),["Cube","Database","Engineering","Information","Statistical","Custom"].forEach((function(t){var e=i.setMenuItemMenu(t);e&&(n.push(e),e.visible&&s++)})),n.length&&(o.menu&&o.menu.rendered?n.forEach((function(t){o.menu.addItem(t,!0)})):o.setMenu(new Common.UI.Menu({items:n})),o.menu.getItems(!0).forEach((function(t){var e=t.menu.items[0].cmpEl.children(":first"),i=t.menu._innerMenu;i.render(e),i.cmpEl.css({display:"block",position:"relative",left:0,top:0}),i.cmpEl.attr({tabindex:"-1"})}))),Common.Utils.lockControls(Common.enumLock.noSubitems,s<1,{array:[o]})}},updateRecent:function(){this.formulasGroups&&this.setButtonMenu(this.btnRecent,"Last10")},updateCustom:function(){var t=this.btnMore;if(this.formulasGroups?this.setMenuItemMenu("Custom"):null){var e=!1;if(t.menu&&t.menu.rendered)for(var i=0;i<t.menu.getItemsLength(!0);i++)if(t.menu.items[i].visible){e=!0;break}Common.Utils.lockControls(Common.enumLock.noSubitems,!e,{array:[t]})}},setApi:function(t){this.api=t},txtRecent:"Recently used",txtAutosum:"Autosum",txtAutosumTip:"Summation",txtAdditional:"Insert Function",txtFormula:"Function",txtFormulaTip:"Insert function",txtMore:"More functions",txtCalculation:"Calculation",tipCalculate:"Calculate",textCalculateWorkbook:"Calculate workbook",textCalculateCurrentSheet:"Calculate current sheet",textAutomatic:"Automatic",textManual:"Manual",tipCalculateTheEntireWorkbook:"Calculate the entire workbook",txtWatch:"Watch Window",tipWatch:"Add cells to the Watch Window list",capBtnTracePrec:"Trace Precedents",tipTracePrec:"Show arrows that indicate which cells affect the value of the selected cell",capBtnTraceDep:"Trace Dependents",tipTraceDep:"Show arrows that indicate which cells are affected by the value of the selected cell",capBtnRemoveArr:"Remove Arrows",tipRemoveArr:"Remove the arrows drawn by Trace Precedents or Trace Dependents",txtRemPrec:"Remove Precedents Arrows",txtRemDep:"Remove Dependents Arrows",txtShowFormulas:"Show Formulas",tipShowFormulas:"Display the formula in each cell instead of the resulting value"}}(),SSE.Views.FormulaTab||{}))})),define("spreadsheeteditor/main/app/controller/FormulaDialog",["core","spreadsheeteditor/main/app/collection/FormulaGroups","spreadsheeteditor/main/app/view/FormulaDialog","spreadsheeteditor/main/app/view/FormulaTab"],(function(){"use strict";SSE.Controllers=SSE.Controllers||{},SSE.Controllers.FormulaDialog=Backbone.Controller.extend(_.extend({models:[],views:["FormulaDialog","FormulaTab"],collections:["FormulaGroups"],initialize:function(){var t=this;t.langJson={},t.langDescJson={},t.formulasLoaded=!1,this.addListeners({FileMenu:{"settings:apply":function(){t.needUpdateFormula=!0;var e=Common.localStorage.getItem("sse-settings-func-locale");Common.Utils.InternalSettings.set("sse-settings-func-locale",e),t.formulasGroups.reset(),t.reloadTranslations(e)}},FormulaTab:{"function:apply":this.applyFunction,"function:calculate":this.onCalculate,"function:watch":this.onWatch,"function:precedents":this.onPrecedents,"function:dependents":this.onDependents,"function:remove-arrows":this.onRemArrows,"function:showformula":this.onShowFormula},Toolbar:{"function:apply":this.applyFunction,"tab:active":this.onTabActive},Statusbar:{"sheet:changed":this.onApiSheetChanged.bind(this)}})},applyFunction:function(t,e,i){t&&("more"===t.origin?this.showDialog(i):(e?this.api.asc_insertInCell(t.name,Asc.c_oAscPopUpSelectorType.Func,!!e):this.api.asc_startWizard(t.name,this._cleanCell),!e&&this.updateLast10Formulas(t.origin)))},setConfig:function(t){return this.toolbar=t.toolbar,this.formulaTab=this.createView("FormulaTab",{toolbar:this.toolbar.toolbar,formulasGroups:this.formulasGroups}),this},setApi:function(t,e){if(this.api=t,this.formulasGroups){if(Common.Utils.InternalSettings.set("sse-settings-func-last",Common.localStorage.getItem("sse-settings-func-last")),this.reloadTranslations(Common.localStorage.getItem("sse-settings-func-locale")||this.appOptions.lang,!0,e),!this.mode.isEdit||e)return;var i=this;this.formulas=new SSE.Views.FormulaDialog({api:this.api,toolclose:"hide",formulasGroups:this.formulasGroups,handler:_.bind(this.applyFunction,this)}),this.formulas.on({hide:function(){i._cleanCell=void 0}})}return this.formulaTab&&(this.formulaTab.setApi(this.api),this.api.asc_registerCallback("asc_onWorksheetLocked",this.onWorksheetLocked.bind(this)),this.api.asc_registerCallback("asc_onSheetsChanged",this.onApiSheetChanged.bind(this)),this.api.asc_registerCallback("asc_onUpdateFormulasViewSettings",this.onUpdateFormulasViewSettings.bind(this)),this.onApiSheetChanged()),this.api.asc_registerCallback("asc_onSendFunctionWizardInfo",_.bind(this.onSendFunctionWizardInfo,this)),this.api.asc_registerCallback("asc_onAddCustomFunction",_.bind(this.onAddCustomFunction,this)),this},setMode:function(t){return this.mode=t,this},onLaunch:function(){this.formulasGroups=this.getApplication().getCollection("FormulaGroups"),SSE.Collections.formulasLangs=["en","be","bg","ca","zh","cs","da","nl","fi","fr","de","el","hu","hy","id","it","ja","ko","lv","lo","nb","pl","pt-br","pt","ro","ru","sk","sl","sv","es","tr","uk","vi"];Common.Gateway.on("init",this.loadConfig.bind(this))},loadConfig:function(t){this.appOptions={},this.appOptions.lang=t.config.lang},reloadTranslations:function(t,e,i){this.formulasLoaded=!1,t=(t||"en").toLowerCase();var o=_.indexOf(SSE.Collections.formulasLangs,t);o<0&&(t=t.split(/[\-_]/)[0],o=_.indexOf(SSE.Collections.formulasLangs,t)),t=o>=0?SSE.Collections.formulasLangs[o]:"en";var n=this;Common.Utils.InternalSettings.set("sse-settings-func-locale",t),n.langJson[t]?(n.api.asc_setLocalization(n.langJson[t],t),Common.NotificationCenter.trigger("formula:settings",this)):"en"==t?(n.api.asc_setLocalization(void 0,t),Common.NotificationCenter.trigger("formula:settings",this)):Common.Utils.loadConfig("resources/formula-lang/"+t+".json",(function(e){"error"!=e&&(n.langJson[t]=e,n.api.asc_setLocalization(e,t),Common.NotificationCenter.trigger("formula:settings",this))})),this.mode.isEdit&&!i&&(n.langDescJson[t]?n.loadingFormulas(n.langDescJson[t],e):Common.Utils.loadConfig("resources/formula-lang/"+t+"_desc.json",(function(i){"error"!=i?(n.langDescJson[t]=i,n.loadingFormulas(i,e)):Common.Utils.loadConfig("resources/formula-lang/en_desc.json",(function(i){n.langDescJson[t]="error"!=i?i:null,n.loadingFormulas(n.langDescJson[t],e)}))})))},getDescription:function(t){return t?(t=t.toLowerCase(),this.langDescJson[t]?this.langDescJson[t]:null):""},showDialog:function(t,e){this.formulas&&(this.needUpdateFormula&&(this.needUpdateFormula=!1,this.formulas.$window&&this.formulas.fillFormulasGroups()),this._formulagroup=t,this._cleanCell=e,this.api.asc_startWizard())},onSendFunctionWizardInfo:function(t){if(this.formulasLoaded){if(t){var e=t.asc_getName(),i=this.api.asc_getFormulaNameByLocale(e),o=this.getDescription(Common.Utils.InternalSettings.get("sse-settings-func-locale")),n=this.api.asc_getCustomFunctionInfo(i),s="";if(n)s="("+(n.asc_getArg()||[]).map((function(t){return t.asc_getIsOptional()?"["+t.asc_getName()+"]":t.asc_getName()})).join(this.api.asc_getFunctionArgumentSeparator()+" ")+")";var a={name:e,origin:i,args:o&&o[i]?o[i].a.replace(/[,;]/g,this.api.asc_getFunctionArgumentSeparator()):s,desc:o&&o[i]?o[i].d:n&&n.asc_getDescription()||"",argsDesc:o&&o[i]&&o[i].ad?o[i].ad.split("!"):[],custom:!!n};new SSE.Views.FormulaWizard({api:this.api,lang:this.appOptions.lang,funcprops:a,props:t,handler:function(t,e,i){}}).show(),this._cleanCell=void 0}else this.formulas.show(this._formulagroup);this._formulagroup=void 0}},hideDialog:function(){this.formulas&&this.formulas.isVisible()&&this.formulas.hide()},updateLast10Formulas:function(t){var e=Common.Utils.InternalSettings.get("sse-settings-func-last")||"SUM;AVERAGE;IF;HYPERLINK;COUNT;MAX;SIN;SUMIF;PMT;STDEV";e=e.split(";");var i=_.indexOf(e,t);e.splice(i<0?e.length-1:i,1),e.unshift(t);var o=e.join(";");if(Common.localStorage.setItem("sse-settings-func-last",o),Common.Utils.InternalSettings.set("sse-settings-func-last",o),this.formulasGroups){var n=this.formulasGroups.findWhere({name:"Last10"});n&&n.set("functions",this.loadingLast10Formulas(this.getDescription(Common.Utils.InternalSettings.get("sse-settings-func-locale")))),this.formulaTab&&this.formulaTab.updateRecent()}},loadingLast10Formulas:function(t){for(var e=(Common.Utils.InternalSettings.get("sse-settings-func-last")||"SUM;AVERAGE;IF;HYPERLINK;COUNT;MAX;SIN;SUMIF;PMT;STDEV").split(";"),i=this.api.asc_getFunctionArgumentSeparator(),o=[],n=this.formulasGroups?this.formulasGroups.findWhere({name:"All"}):null,s=n?n.get("functions"):null,a=0;a<e.length;a++){var r=e[a],l=t&&t[r]?null:this.api.asc_getCustomFunctionInfo(r),c=t&&t[r]?t[r].d:l&&l.asc_getDescription()||"",h="";if(l)h="("+(l.asc_getArg()||[]).map((function(t){return t.asc_getIsOptional()?"["+t.asc_getName()+"]":t.asc_getName()})).join(this.api.asc_getFunctionArgumentSeparator()+" ")+")";(c||!s||_.find(s,(function(t){return t.get("origin")===r})))&&o.push(new SSE.Models.FormulaModel({index:a,group:"Last10",name:this.api.asc_getFormulaLocaleName(r),origin:r,args:t&&t[r]?t[r].a.replace(/[,;]/g,i):h,desc:c}))}return o},loadingFormulas:function(t,e){var i,o,n,s=0,a=0,r=this.formulasGroups,l=null,c=0,h=0,d=null,m=[],p=null,u=null,g=this.api.asc_getFunctionArgumentSeparator();if(r&&(i="Last10",(u=new SSE.Models.FormulaGroup({name:i,index:c,store:r,caption:this["sCategory"+i]||i}))&&(r.push(u),c+=1),i="All",(p=new SSE.Models.FormulaGroup({name:i,index:c,store:r,caption:this["sCategory"+i]||i}))&&(r.push(p),c+=1),p)){for(d=this.api.asc_getFormulasInfo(),s=0;s<d.length;s+=1){for(i=d[s].asc_getGroupName(),o=d[s].asc_getFormulasArray(),l=new SSE.Models.FormulaGroup({name:i,index:c,store:r,caption:this["sCategory"+i]||i}),c+=1,n=[],a=0;a<o.length;a+=1){var f=o[a].asc_getName(),b=t&&t[f]?null:this.api.asc_getCustomFunctionInfo(f),C="";if(b)C="("+(b.asc_getArg()||[]).map((function(t){return t.asc_getIsOptional()?"["+t.asc_getName()+"]":t.asc_getName()})).join(this.api.asc_getFunctionArgumentSeparator()+" ")+")";var v=new SSE.Models.FormulaModel({index:h,group:i,name:o[a].asc_getLocaleName(),origin:f,args:t&&t[f]?t[f].a.replace(/[,;]/g,g):C,desc:t&&t[f]?t[f].d:b&&b.asc_getDescription()||""});h+=1,n.push(v),m.push(v)}l.set("functions",_.sortBy(n,(function(t){return t.get("name")}))),r.push(l)}p.set("functions",_.sortBy(m,(function(t){return t.get("name")}))),u&&u.set("functions",this.loadingLast10Formulas(t))}this.formulasLoaded=!0,(!e||this._formulasInited)&&this.formulaTab&&this.formulaTab.fillFunctions()},onAddCustomFunction:function(){this.needUpdateFormula=!0;var t,e,i=0,o=0,n="Custom",s=this.formulasGroups,a=0,r=null,l=[],c=null,h=null;if(s){if(c=this.formulasGroups.findWhere({name:"All"}))for(l=c.get("functions"),i=0;i<l.length;i++)l[i].get("group")===n&&(l.splice(i,1),i--);for((h=this.formulasGroups.findWhere({name:n}))||(h=new SSE.Models.FormulaGroup({name:n,index:s.length,store:s,caption:this["sCategory"+n]||n}),s.push(h)),r=this.api.asc_getFormulasInfo(),i=0;i<r.length;i+=1)if(e=[],r[i].asc_getGroupName()===n){for(t=r[i].asc_getFormulasArray(),o=0;o<t.length;o+=1){var d=t[o].asc_getName(),m=this.api.asc_getCustomFunctionInfo(d),p="";if(m)p="("+(m.asc_getArg()||[]).map((function(t){return t.asc_getIsOptional()?"["+t.asc_getName()+"]":t.asc_getName()})).join(this.api.asc_getFunctionArgumentSeparator()+" ")+")";var u=new SSE.Models.FormulaModel({index:a,group:n,name:t[o].asc_getLocaleName(),origin:d,args:p,desc:m&&m.asc_getDescription()||""});a+=1,e.push(u),l.push(u)}h.set("functions",_.sortBy(e,(function(t){return t.get("name")}))),c.set("functions",_.sortBy(l,(function(t){return t.get("name")})));break}this.formulaTab&&this.formulaTab.updateCustom();var g=this.formulasGroups.findWhere({name:"Last10"});g&&g.set("functions",this.loadingLast10Formulas(this.getDescription(Common.Utils.InternalSettings.get("sse-settings-func-locale")))),this.formulaTab&&this.formulaTab.updateRecent()}},onTabActive:function(t){"formula"==t&&!this._formulasInited&&this.formulaTab&&(this.formulaTab.fillFunctions(),this._formulasInited=!0)},onCalculate:function(t){var e=t.type;e!==Asc.c_oAscCalculateType.All&&e!==Asc.c_oAscCalculateType.ActiveSheet||this.api&&this.api.asc_calculate(e)},onWatch:function(t){if(t){var e=this;this._watchDlg=new SSE.Views.WatchDialog({api:this.api,handler:function(t){Common.NotificationCenter.trigger("edit:complete")}}),this._watchDlg.on("close",(function(t){e.formulaTab.btnWatch.toggle(!1,!0),e._watchDlg=null,Common.NotificationCenter.trigger("edit:complete")})).show()}else this._watchDlg&&this._watchDlg.close()},onPrecedents:function(t){this.api&&this.api.asc_TracePrecedents(),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onDependents:function(t){this.api&&this.api.asc_TraceDependents(),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onRemArrows:function(t){this.api&&this.api.asc_RemoveTraceArrows(t),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onShowFormula:function(t){this.api&&this.api.asc_setShowFormulas(!!t),Common.NotificationCenter.trigger("edit:complete")},onWorksheetLocked:function(t,e){t==this.api.asc_getActiveWorksheetIndex()&&this.formulaTab&&Common.Utils.lockControls(Common.enumLock.sheetLock,e,{array:[this.formulaTab.btnShowFormulas]})},onApiSheetChanged:function(){if(this.mode&&this.mode.isEdit&&!this.mode.isEditDiagram&&!this.mode.isEditMailMerge&&!this.mode.isEditOle){this.formulaTab&&this.formulaTab.btnShowFormulas.toggle(this.api.asc_getShowFormulas(),!0);var t=this.api.asc_getActiveWorksheetIndex();this.onWorksheetLocked(t,this.api.asc_isWorksheetLockedOrDeleted(t))}},onUpdateFormulasViewSettings:function(){!this.mode||!this.mode.isEdit||this.mode.isEditDiagram||this.mode.isEditMailMerge||this.mode.isEditOle||this.formulaTab&&this.formulaTab.btnShowFormulas.toggle(this.api.asc_getShowFormulas(),!0)},sCategoryAll:"All",sCategoryLast10:"10 last used",sCategoryLogical:"Logical",sCategoryCube:"Cube",sCategoryDatabase:"Database",sCategoryDateAndTime:"Date and time",sCategoryEngineering:"Engineering",sCategoryFinancial:"Financial",sCategoryInformation:"Information",sCategoryLookupAndReference:"Lookup and reference",sCategoryMathematic:"Math and trigonometry",sCategoryStatistical:"Statistical",sCategoryTextAndData:"Text and data",sCategoryCustom:"Custom"},SSE.Controllers.FormulaDialog||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/RadioBox",["common/main/lib/component/BaseView","underscore"],(function(t,e){"use strict";Common.UI.RadioBox=Common.UI.BaseView.extend({options:{labelText:""},disabled:!1,rendered:!1,template:e.template('<div class="radiobox canfocused" role="radio" data-hint="<%= dataHint %>" data-hint-direction="<%= dataHintDirection %>" data-hint-offset="<%= dataHintOffset %>"><input type="radio" name="<%= name %>" id="<%= id %>" class="button__radiobox"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><circle class="rb-circle" cx="8" cy="8" r="6.5" /><circle class="rb-check-mark" cx="8" cy="8" r="4" /></svg><span></span></div>'),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.dataHint=t.dataHint,this.dataHintDirection=t.dataHintDirection,this.dataHintOffset=t.dataHintOffset;if(this.name=this.options.name||Common.UI.getId(),this.render(),this.options.disabled&&this.setDisabled(this.options.disabled),void 0!==this.options.checked&&this.setValue(this.options.checked,!0),this.setCaption(this.options.labelText),this.options.ariaLabel||this.options.labelText){var e=this.options.ariaLabel?this.options.ariaLabel:this.options.labelText;this.$label.attr("aria-label",e)}},render:function(){var t=this.$el||$(this.el);return t.html(this.template({labelText:this.options.labelText,name:this.name,id:Common.UI.getId("rdb-"),dataHint:this.dataHint,dataHintDirection:this.dataHintDirection,dataHintOffset:this.dataHintOffset})),this.$radio=t.find("input[type=radio]"),this.$label=t.find("div.radiobox"),this.$span=this.$label.find("span"),this.$label.on({keydown:this.onKeyDown.bind(this),click:function(t){this.disabled||this.setValue(!0)}.bind(this)}),this.rendered=!0,this},setDisabled:function(t){this.rendered&&((t=!!t)!==this.disabled&&(this.$label.toggleClass("disabled",t),this.$radio.toggleClass("disabled",t),t?this.$radio.attr({disabled:t}):this.$radio.removeAttr("disabled"),void 0!==this.tabindex&&(t&&(this.tabindex=this.$label.attr("tabindex")),this.$label.attr("tabindex",t?"-1":this.tabindex))),this.disabled=t)},isDisabled:function(){return this.disabled},onItemCheck:function(t){this.disabled||this.setValue(!0)},setRawValue:function(t){if(t=!0===t||"true"===t||"1"===t||1===t){var e=$("input[type=radio][name="+this.name+"]");e.removeClass("checked"),e.parent().attr("aria-checked",!1)}this.$radio.toggleClass("checked",t),this.$radio.prop("checked",t),this.$label.attr("aria-checked",t)},setValue:function(t,e){if(this.rendered){var i=this.$radio.hasClass("checked");this.setRawValue(t),!0!==e&&i!==t&&this.trigger("change",this,this.$radio.is(":checked"))}else this.options.checked=t},getValue:function(){return this.$radio.is(":checked")},setCaption:function(t){this.$span.text(t),this.$span.css("visibility",t?"visible":"hidden")},onKeyDown:function(t){t.isDefaultPrevented()||t.keyCode===Common.UI.Keys.SPACE&&this.onItemCheck(t)},focus:function(){this.$label&&this.$label.focus()},setTabIndex:function(t){this.rendered&&(this.tabindex=t.toString(),!this.disabled&&this.$label.attr("tabindex",this.tabindex))}})})),void 0===Common)var Common={};if(void 0===Common.UI&&(Common.UI={}),Common.UI.HintManager=new function(){var t,e,i,o="en",n=[],s=[],a=[],r=[],l=!1,c=!1,h=0,d=document,m=[],p=[],u="",g=!1,f=!1,b=!1,C=!1,v=!0,w=[],A={"scroll-right":"R","scroll-left":"V"},y=function(t,e){e?d=e:"esc"!==t?d=C?[$(window.parent.document).find(".advanced-settings-dlg:visible")[0],window.document]:$("#file-menu-panel").is(":visible")?$("#file-menu-panel"):t&&t.closest(".hint-section")||document:0===h&&(d=document)},S=function(t){!i||!t&&Common.Utils.ModalWindow.isVisible()||(f=t,i.asc_enableKeyEvents(!t))},x=function(){u="",0===h&&Common.NotificationCenter.trigger("toolbar:collapse"),(0===p.length||$("#file-menu-panel").is(":visible")&&1===h)&&D(),p.length>0?(!f&&S(!0),c=!0,p.forEach((function(t){t.show()})),t=setInterval((function(){u.length>0&&(u="")}),5e3)):c=!1,Common.NotificationCenter.trigger("hints:show",c,h)},k=function(){c=!1,p&&p.forEach((function(t){t.remove()})),clearInterval(t),Common.NotificationCenter.trigger("hints:show",!1)},T=function(t){M(),p.length=0,m.length=0,void 0!==t?h=t:h++},I=function(t){var e=t;if(-1===n.indexOf(e)){var i=s.indexOf(e);e=n[i]}return e},E=function(t){return t.hasClass("disabled")||t.parent().hasClass("disabled")||t.attr("disabled")},P=function(){m=[],w=[];var t=[],e=[],i=[];_.isArray(d)?d.forEach((function(o){t=t.concat($(o).find("[data-hint="+h+"]").toArray()),i=i.concat($(o).find("[data-hint-title][data-hint="+h+"]").toArray()),e=e.concat($(o).find("[data-hint-title-lang][data-hint="+h+"]").toArray())})):(t=$(d).find("[data-hint="+h+"]").toArray(),i=$(d).find("[data-hint-title][data-hint="+h+"]").toArray(),e=$(d).find("[data-hint-title-lang][data-hint="+h+"]").toArray());var a=t.filter((function(t){return $(t).is(":visible")})),r=e.filter((function(t){return $(t).is(":visible")})),l=i.filter((function(t){return $(t).is(":visible")}));if(a.length!==r.length){var c=[],p=[];if(0===h)for(var u in A){var g=A[u].charAt(0).toLowerCase();w.push(g);var f=n.indexOf(g);p.indexOf(f)<0&&p.push(f)}if(a.length+(0===h?_.size(A):0)>n.length?(l.forEach((function(t){var e=$(t).data("hint-title").charAt(0).toLowerCase();e=I(e),w.indexOf(e)<0&&w.push(e)})),c=function(t){for(var e,i,o=n.slice(),s=0;s<n.length&&(-1===w.indexOf(n[s])&&(e=n[s],i=s),!e);s++);if(e){for(o[i]=e+n[0],s=0;o.length<t;s++)e+n[s]!==o[i]&&o.push(e+n[s]);return o}return!1}(a.length+(0===h?_.size(A):0))):c=n.slice(),c.length){l.forEach((function(t){var e=$(t),i=e.attr("data-hint-title");if(i){var n,a=(i=i.toLowerCase()).charAt(0),r=s.indexOf(a);if(p.indexOf(r)<0&&p.push(r),"en"===o)e.attr("data-hint-title-lang",i.toUpperCase());else{var l="";for(n=0;n<i.length;n++)l+=I(i.charAt(n));e.attr("data-hint-title-lang",l.toUpperCase())}}}));var b=0;a.forEach((function(t){for(var e=$(t);-1!==p.indexOf(b);)b++;e.attr("data-hint-title")||b>c.length||(e.attr("data-hint-title-lang",c[b].toUpperCase()),b++),m.push(e)}))}}else a.forEach((function(t){m.push($(t))}))},D=function(){var t=C?window.parent.innerHeight*Common.Utils.zoom():Common.Utils.innerHeight()-20,e=C?window.parent.innerWidth*Common.Utils.zoom():Common.Utils.innerWidth(),i=C?d[0]:d,o=0!==h&&$(i).length>0&&!C?Common.Utils.getOffset($(i)).top:0,n=0!==h&&$(i).length>0&&!C?o+$(i).height():t;"toolbar"===$(i).prop("id")&&$(i).outerHeight()<$(i).find(".box-controls").outerHeight()&&(n+=$(i).find(".box-controls").outerHeight()),0===m.length&&P(),m.forEach((function(i,s){if(!E(i)){var a=0,r=e;if(!C&&"toolbar"===$(d).prop("id")&&$(d).find(".toolbar-mask").length>0||$("#about-menu-panel").is(":visible")&&"right-menu"===i.closest(".hint-section").prop("id"))return;if(window.SSE&&"statusbar_bottom"===i.parent().prop("id")){var l=i.parent();if(Common.Utils.getOffset(i).left>Common.Utils.getOffset(l).left+l.width())return}if(0===h&&i.closest(".tabs.short").length>0){var c=i.closest(".tabs.short");r=(a=Common.Utils.getOffset(c).left)+c.width(),i.hasClass("scroll")||(a+=20,r-=20)}var m=$('<div style="" class="hint-div">'+i.attr("data-hint-title-lang")+"</div>"),u=i.attr("data-hint-direction");Common.UI.isRTL()&&u&&(u.indexOf("left")>-1?u=u.replace("left","right"):u.indexOf("right")>-1&&(u=u.replace("right","left"))),window.SSE&&!C&&9!==d.nodeType&&"toolbar"===d.prop("id")&&"data"===i.closest(".panel").attr("data-tab")&&(i.parent().hasClass("slot-sortdesc")||i.parent().hasClass("slot-btn-setfilter")?(u="top",i.attr("data-hint-direction","top")):(i.parent().hasClass("slot-btn-clear-filter")||i.parent().hasClass("slot-sortasc"))&&(u="bottom",i.attr("data-hint-direction","bottom")));var g=t;$("#file-menu-panel").is(":visible")&&h>1&&($(".fms-flex-apply").is(":visible")||$("#fms-flex-apply").is(":visible"))&&i.closest(".fms-flex-apply").length<1&&i.closest("#fms-flex-apply").length<1&&(g=t-$(".fms-flex-apply").height());var f=i.attr("data-hint-offset"),b="big"===f?6:"medium"===f?4:"small"===f?2:0;if(b)switch(u){case"bottom":f=[-b,0];break;case"top":f=[b,0];break;case"right":f=[0,-b];break;case"left":f=[0,b]}else f=f?i.attr("data-hint-offset").split(",").map((function(t){return parseInt(t)})):[0,0],Common.UI.isRTL()&&(f[1]=-f[1]);var v,_,w=Common.Utils.getOffset(i);"left-top"===u?(v=w.top-10+f[0],_=w.left-10+f[1]):"right-top"===u?(v=w.top-10+f[0],_=w.left+(i.outerWidth()-18)+10+f[1]):"top"===u?(v=w.top-18+f[0],_=w.left+(i.outerWidth()-18)/2+f[1]):"right"===u?(v=w.top+(i.outerHeight()-18)/2+f[0],_=w.left+i.outerWidth()+f[1]):"left"===u?(v=w.top+(i.outerHeight()-18)/2+f[0],_=w.left-18+f[1]):(v=w.top+i.outerHeight()+f[0],_=w.left+(i.outerWidth()-18)/2+f[1]),v<g&&_<e&&v>o&&v<n&&_>a&&_+18<r&&(m.css({top:v,left:_}),C&&s<2?(m.css("z-index","1060"),$(window.parent.document.body).append(m)):$(document.body).append(m)),p.push(m)}}))},M=function(){p&&p.forEach((function(t){t.remove()}))},U=function(){h=$("#file-menu-panel").is(":visible")||C?1:0,y(),p.length=0,m.length=0},F=function(t){Common.Utils.loadConfig("../../common/main/resources/alphabetletters/alphabetletters.json",(function(e){s=e.en;var i=function(t){return o=t,n=e[t]},a=!!i(t)||(!!i(t.split(/[\-_]/)[0])||i("en"));if(a&&"en"!==o)for(var r in A){var l=I(A[r].toLowerCase());l&&(A[r]=l.toUpperCase())}return a})),Common.Utils.loadConfig("../../common/main/resources/alphabetletters/qwertyletters.json",(function(t){a=t[o],"en"!==o&&(r=t.en)}))},R=function(t,e){if(!(Common.Utils.isIE||Common.UI.isMac&&Common.Utils.isGecko)&&(c&&k(),p.length>0&&U(),!e&&f&&S(!1),t&&(g=!0),$(".hint-div").length>0&&$(".hint-div").remove(),$("iframe").length>0))try{$("iframe").contents().find(".hint-div").remove()}catch(t){}},L=function(t){v!==t&&(v=t)};return{init:function(t){if(!(Common.Utils.isIE||Common.UI.isMac&&Common.Utils.isGecko)){i=t;var s=Common.localStorage.getKeysFilter();e=s&&s.length?s.split(",")[0]:"",Common.NotificationCenter.on({"app:ready":function(t){var e=t.lang?t.lang.toLowerCase():"en";F(e),b=!0},"hints:clear":R,"window:resize":R}),$("#editor_sdk").on("click",(function(){R()})),$(document).on("mousedown",(function(){R()})),$(document).on("keyup",(function(t){t.keyCode!=Common.UI.Keys.ALT&&91!==t.keyCode||!l||window.SSE&&window.SSE.getController("Statusbar").getIsDragDrop()?c&&t.preventDefault():(t.preventDefault(),c?(k(),U(),f&&(f=!1,i.asc_enableKeyEvents(!0))):($("input:focus").blur(),h=$("#file-menu-panel").is(":visible")||C?1:0,y(),x())),l=!1})),$(document).on("keydown",(function(t){if(c)if(t.preventDefault(),t.keyCode==Common.UI.Keys.ESC)setTimeout((function(){0===h?(k(),U(),S(!1)):(M(),p.length=0,m.length=0,h--,y("esc"),x())}),10);else{var i=null,s=!1,f=t.keyCode;if(16!==f&&17!==f&&18!==f&&91!==f&&(i="en"===o?f>47&&f<58||f>64&&f<91?String.fromCharCode(t.keyCode):null:/[.*+?^${}()|[\]\\]/g.test(t.key)?null:t.key),i){var _;if("en"!==o&&-1===n.indexOf(i.toLowerCase())){var w=r.indexOf(i.toLowerCase());-1!==w&&(i=a[w])}u+=i.toUpperCase();for(var A=0;A<m.length;A++){var I=m[A];if(!E(I)){var P=I.attr("data-hint-title-lang");if(new RegExp("^"+u).test(P)&&(s=!0),P===u){_=I;break}}}if(_){Common.UI.ScreenReaderFocusManager&&Common.UI.ScreenReaderFocusManager.exitFocusMode();var D=_.prop("tagName").toLowerCase();if(window.SSE&&"statusbar_bottom"===_.parent().prop("id"))k(),_.contextmenu(),U();else if("input"===D||"textarea"===D)k(),_.trigger(jQuery.Event("click",{which:1})),_.focus(),U();else if(_.hasClass("listview"))k(),_.focus(),U();else{if(g=!1,k(),!C&&"toolbar"===$(d).prop("id")&&$(d).find(".toolbar-mask").length>0)return void U();var F=_.attr("content-target")&&!$("#"+_.attr("content-target")).is(":visible")||"slot-btn-chat"===_.parent().prop("id")&&!$("#left-panel-chat").is(":visible")||_.parent().hasClass("ribtab")&&!$("#toolbar").children(".toolbar").hasClass("expanded");if((!_.attr("content-target")&&"slot-btn-chat"!==_.parent().prop("id")||F)&&($("#file-menu-panel").is(":visible")&&("fm-btn-info"===_.parent().prop("id")&&$("#panel-info").is(":visible")||"fm-btn-settings"===_.parent().prop("id")&&$("#panel-settings").is(":visible"))||(_.attr("for")?$("#"+_.attr("for")).trigger(jQuery.Event("click",{which:1})):(_.trigger(jQuery.Event("click",{which:1})),F&&(g=!1)))),"btn-go-back"===_.prop("id")||"slot-btn-options"===_.closest(".btn-slot").prop("id")||"slot-btn-mode"===_.closest(".btn-slot").prop("id")||"id-btn-favorite"===_.prop("id")||"tlb-box-users"===_.parent().prop("id")||"left-btn-thumbs"===_.prop("id")||_.hasClass("scroll")||"left-btn-about"===_.prop("id")||"left-btn-support"===_.prop("id")||"slot-btn-search"===_.closest(".btn-slot").prop("id")||"slot-btn-edit-mode"===_.closest(".btn-slot").prop("id"))return void U();if("add-comment-doc"===_.prop("id"))return M(),p.length=0,m.length=0,void x();g||("slot-btn-chat"===_.parent().prop("id")?(T(1),y(void 0,$("#left-menu.hint-section"))):"id-right-menu-signature"===_.prop("id")?(T(2),y(_)):(T(),y(_)),x(),p.length<1&&U())}}else s||(u="")}}l=Common.Utils.InternalSettings.get(e+"settings-show-alt-hints")&&!t.shiftKey&&t.keyCode==Common.UI.Keys.ALT&&!Common.Utils.ModalWindow.isVisible()&&b&&n.length>0&&!(window.PE&&$("#pe-preview").is(":visible"))&&!(Common.UI.ScreenReaderFocusManager&&Common.UI.ScreenReaderFocusManager.isFocusMode()),Common.Utils.InternalSettings.get(e+"settings-show-alt-hints")&&t.altKey&&115!==t.keyCode&&v&&t.preventDefault()}))}},setMode:function(t){C=t.isEditDiagram||t.isEditMailMerge||t.isEditOle,L(!!C)},clearHints:R,needCloseFileMenu:function(){return!(c&&h>1)},isHintVisible:function(){return c},getStaticHint:function(t){return A[t]},setInternalEditorLoading:L}},define("common/main/lib/controller/HintManager",(function(){})),void 0===Common)var Common={};if(void 0===Common.UI&&(Common.UI={}),Common.UI.LayoutManager=new function(){var t,e,i,o=[],n=[],s=0,a=[],r=function(i,o,n){if(!i&&(i=t),e&&i)for(var s in i)if(i.hasOwnProperty(s))if("object"===_typeof(i[s]))r(i[s],o,(n||"")+s+"-");else if(!1===i[s]){var a="[data-layout-name="+(n||"")+s+"]",l=o?o.find(a):$(a);l&&l.hide&&l.hide()}},l=function(i,o,n){if(!o&&(o=t),!e||!o)return!0;var s=!0;for(var a in o)if(o.hasOwnProperty(a)&&("object"===_typeof(o[a])?s=l(i,o[a],(n||"")+a+"-"):i===(n||"")+a&&(s=o[a]),!1===s))return s;return s},c=function(t,e,i,o){var n=[];if(t&&t.customButtonsArr&&t.customButtonsArr[i])if(!o||o.length<1)n=t.customButtonsArr[i],t.customButtonsArr[i]=void 0;else for(var s=0;s<t.customButtonsArr[i].length;s++){var a=t.customButtonsArr[i][s];a.options.tabid!==e||_.findWhere(o,{id:a.options.value})||(n.push(a),t.customButtonsArr[i].splice(s,1),s--)}return n},h=function(t,e,i,o){o?o.removeAll():(o=new Common.UI.Menu({menuAlign:"tl-tr",items:[]})).on("item:custom-click",(function(t,e,o){i&&i(e.options.guid,e.value)}));var n=!1;return t.forEach((function(t){t.separator&&o.addItem(new Common.UI.MenuItemCustom({caption:"--"})),t.text&&o.addItem(new Common.UI.MenuItemCustom({caption:t.text||"",value:t.id,menu:!!t.items&&h(t.items,e,i),baseUrl:"",iconsSet:t.icons,guid:e})),n=n||!!t.icons})),n&&(o.cmpEl?o.cmpEl.toggleClass("shifted-right",!0):o.options.cls="shifted-right"),o},d=function(t,e,i){if(e){var o=p(t);o&&0!=o.length?o.forEach((function(o){var n=t;if("object"===_typeof(o.menu))f(n,o.menu,e,i);else if(o.menu){var s=e,a=i;o.on("menu:created",(function(){f(n,o.menu,s,a)}))}})):n.push({action:t,data:e,callback:i})}},m=function(){if(s)s=2;else{s=1;for(var t=n.length;t>0;){var e=n.shift();d(e.action,e.data,e.callback),t--}2===s?(s=0,m()):s=0}},p=function(t){if(o){var e=[];return o.forEach((function(i){i instanceof Common.UI.Button&&i.action===t&&e.push(i)})),e}},u=function(t,e,i){if(t&&t.items.length>0)for(var o=t.items.length-1;o>=0;o--)if(t.items[o].isCustomItem&&(void 0===i&&t.items[o].options.guid===e||t.items[o].options.guid===e&&t.items[o].value===i))return t.items[o]},g=function(t,e,i,o){var n=this,s=!1;return o?o.removeAll():((o=new Common.UI.Menu({menuAlign:"tl-tr",items:[]})).on("item:custom-click",(function(t,e,o){!n._preventCustomClick&&i&&i(e.options.guid,e.value)})),o.on("menu:click",(function(t,e){n._preventCustomClick&&e.stopPropagation()}))),t.forEach((function(t){t.separator&&o.addItem(new Common.UI.MenuItemCustom({caption:"--",guid:e})),t.text&&o.addItem(new Common.UI.MenuItemCustom({caption:t.text||"",value:t.id,menu:!!t.items&&g(t.items,e,i),iconsSet:t.icons,baseUrl:"",guid:e,disabled:!!t.disabled})),s=s||!!t.icons})),s&&(o.cmpEl?o.cmpEl.toggleClass("shifted-right",!0):o.options.cls=o.cls="shifted-right"),o},f=function(t,e,i,o){if(e){if(!i||i.length<1)return _removeCustomMenuItems(e),void(e._hasCustomItems=!1);var n=this;n._preventCustomClick&&clearTimeout(n._preventCustomClick),e._hasCustomItems&&(n._preventCustomClick=setTimeout((function(){n._preventCustomClick=null}),500));var s,r=!1,l=[];if(e._hasCustomItems=!1,i.forEach((function(i){a[i.guid]||(a[i.guid]={actions:[],tabs:[]}),_.indexOf(a[i.guid].actions,t)<0&&a[i.guid].actions.push(t),_removeCustomMenuItems(e,i.guid,i.items);var c=!u(e,i.guid);i&&i.items&&i.items.length>0&&(e._hasCustomItems=!0,i.items.forEach((function(t){if(t.separator&&c&&e.addItem(new Common.UI.MenuItemCustom({caption:"--",guid:i.guid})),t.text){var a=u(e,i.guid,t.id),h=t.text||"";if(a)a.setCaption(h),a.setDisabled(!!t.disabled),t.items&&(a.menu?(a.menu.isVisible()&&a.menu.cmpEl.find(" > li:not(.divider):not(.disabled):visible").find("> a").filter(":focus").length>0&&(a.menu.isOver=!0,s=a.cmpEl),g(t.items,i.guid,o,a.menu)):a.setMenu(g(t.items,i.guid,o)));else{a=new Common.UI.MenuItemCustom({caption:h,value:t.id,guid:i.guid,menu:!!(t.items&&t.items.length>=0)&&g(t.items,i.guid,o),iconsSet:t.icons,baseUrl:"",disabled:!!t.disabled}).on("click",(function(t,e){!n._preventCustomClick&&o&&o(t.options.guid,t.value)}));r=r||!!t.icons,e.addItem(a),l.push(a)}}})))})),s){var c=$("> [role=menu]",s).find("> li:not(.divider):not(.disabled):visible > a");c.length>0&&c.eq(0).focus()}if(r)for(var h=0;h<l.length;h++)r&&(l[h].cmpEl?l[h].cmpEl.toggleClass("shifted-right",!0):l[h].options.cls=l[h].cls="shifted-right");e.rendered&&e.alignPosition()}};return _removeCustomMenuItems=function(t,e,i){if(t&&t.items.length>0)for(var o=0;o<t.items.length;o++)t.items[o].isCustomItem&&(void 0===e||t.items[o].options.guid===e&&!_.findWhere(i||[],{id:t.items[o].options.value}))&&(t.removeItem(t.items[o]),o--)},{init:function(i,o,n){t=i,e=o,n},applyCustomization:r,isElementVisible:l,getInitValue:function(i){if(e&&t){var o=i.split("-"),n=0,s=t;for(n=0;n<o.length&&("object"===_typeof(s[o[n]])&&s[o[n]]);n++)s=s[o[n]];if(n===o.length)return"object"===_typeof(s)&&s?s.mode:s}},lastTabIdx:10,addControls:function(t){"[object Array]"===Object.prototype.toString.call(t)||t instanceof Array?Array.prototype.push.apply(o,t):Array.prototype.push.apply(o,[t]),n.length&&m()},getControls:function(){return o},addCustomControls:function(t,e,o,n){if(e){i=t;var s=[];return e.forEach((function(e){e.tabs&&e.tabs.forEach((function(i){if(i){var r=[],l=n?[]:c(t,i.id,e.guid,i.items);a[e.guid]||(a[e.guid]={actions:[],tabs:[]}),_.indexOf(a[e.guid].tabs,i)<0&&a[e.guid].tabs.push(i.id),i.items&&i.items.forEach((function(n,s){if(n.removed){var a=function(t,e,i,o){if(t&&t.customButtonsArr&&t.customButtonsArr[i])for(var n=0;n<t.customButtonsArr[i].length;n++){var s=t.customButtonsArr[i][n];if(s.options.tabid===e&&s.options.guid===i&&s.options.value===o)return t.customButtonsArr[i].splice(n,1),s}}(t,i.id,e.guid,n.id);a&&l.push(a)}else{var c=function(t,e,i,o){if(t&&t.customButtonsArr&&t.customButtonsArr[i])for(var n=0;n<t.customButtonsArr[i].length;n++){var s=t.customButtonsArr[i][n];if(s.options.tabid===e&&s.options.guid===i&&s.options.value===o)return s}}(t,i.id,e.guid,n.id),d=Common.enumLock;if(c){if(c instanceof Common.UI.Button){var m=n.text||"";c.options.caption!==(m||" ")&&(c.cmpEl.closest(".btn-slot.x-huge").toggleClass("nocaption",!m),c.setCaption(m||" "),c.options.caption=m||" "),c.updateHint(n.hint||""),void 0!==n.disabled&&Common.Utils.lockControls(d.customLock,!!n.disabled,{array:[c]}),c.menu&&n.items&&n.items.length>0&&("object"!==_typeof(c.menu)&&(c.setMenu(new Common.UI.Menu({items:[]})),c.menu.on("item:custom-click",(function(t,e,i){o&&o(e.options.guid,e.value)}))),h(n.items,e.guid,o,c.menu))}}else"button"!==n.type&&"big-button"!==n.type||(c=new Common.UI.ButtonCustom({cls:"btn-toolbar x-huge icon-top",iconsSet:n.icons,baseUrl:"",caption:n.text||" ",menu:n.items,split:n.items&&!!n.split,enableToggle:n.enableToggle&&(!n.items||!!n.split),value:n.id,guid:e.guid,tabid:i.id,separator:n.separator,hint:n.hint||"",lock:n.lockInViewMode?[d.customLock,d.viewMode,d.previewReviewMode,d.viewFormMode,d.docLockView,d.docLockForms,d.docLockComments,d.selRangeEdit,d.editFormula]:[d.customLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),n.items&&"object"===_typeof(n.items)&&(c.setMenu(new Common.UI.Menu({items:[]})),c.menu.on("item:custom-click",(function(t,e,i){o&&o(e.options.guid,e.value)})),h(n.items,e.guid,o,c.menu)),c.menu&&!c.split||c.on("click",(function(t,e){o&&o(t.options.guid,t.options.value,t.pressed)})),r.push(c),n.disabled&&Common.Utils.lockControls(d.customLock,n.disabled,{array:[c]}))}})),t.addCustomControls({action:i.id,caption:i.text||""},r,l),t.customButtonsArr||(t.customButtonsArr=[]),t.customButtonsArr[e.guid]||(t.customButtonsArr[e.guid]=[]),Array.prototype.push.apply(t.customButtonsArr[e.guid],r),Array.prototype.push.apply(s,r)}}))})),s}},clearCustomControls:function(t){i&&a[t]&&a[t].tabs&&(a[t].tabs.forEach((function(e){i.addCustomControls({action:e},void 0,c(i,e,t))})),a[t].tabs=[])},addCustomMenuItems:d,clearCustomMenuItems:function(t){a[t]&&a[t].actions&&(a[t].actions.forEach((function(e){var i=p(e);i&&i.forEach((function(e){"object"===_typeof(e.menu)&&_removeCustomMenuItems(e.menu,t)}))})),a[t].actions=[])}}},Common.UI.FeaturesManager=new function(){var t,e;return{init:function(i,o){t=i,e=o},canChange:function(i,o){return!((e||o)&&t&&"object"===_typeof(t[i])&&t[i]&&!1===t[i].change)},getInitValue:function(i,o){if((e||o)&&t&&void 0!==t[i]){if("object"!==_typeof(t[i])||!t[i])return t[i];if(void 0!==t[i].mode)return t[i].mode}},isFeatureEnabled:function(i,o){return!e&&!o||!t||!1!==t[i]}}},define("common/main/lib/controller/LayoutManager",(function(){})),void 0===Common)var Common={};if(void 0===Common.UI&&(Common.UI={}),Common.UI.ExternalUsers=new function(){var t,e=[],i=!1,o=[],n=!1,s=[],a=[],r=function(t,o,n,s,a){if("info"===t)if("object"!==_typeof(o)&&(o=[o]),o&&(o=_.uniq(o)),o.length>100)for(;o.length>0;)Common.Gateway.requestUsers("info",o.splice(0,100));else Common.Gateway.requestUsers("info",o);else{if(i)return;void 0===e[t=t||"mention"]?(i=!0,Common.Gateway.requestUsers(t||"mention",void 0,n||0,s||100,a||"")):Common.NotificationCenter.trigger("mentions:setusers",t,e[t])}},l=function(t){if("info"===t.c)if(n)s.push(t);else{n=!0;var e=[];t.users&&_.each(t.users,(function(t){var i=_.findWhere(o,{id:t.id});i?(i.image=t.image,i.name=t.name,i.email=t.email):e.push(t)})),o=o.concat(e),Common.NotificationCenter.trigger("mentions:setusers",t.c,t.users),n=!1,s.length>0&&l(s.shift())}};return{init:function(o,n){Common.Gateway.on("setusers",l),t=n,o&&(Common.Gateway.on("setusers",(function(t){if("info"!==t.c)if(null!==t.users){var o=t.c||"mention",n=t.users||[];void 0===t.total&&(e[o]=n),i=!1,Common.NotificationCenter.trigger("mentions:setusers",o,n,t.total)}else e=[]})),Common.NotificationCenter.on("mentions:clearusers",(function(t){"info"!==t&&(e[t||"mention"]=void 0)})))},get:r,getImage:function(t,e){var i,n=_.findWhere(o,{id:t});return n&&(i=n.image),e&&void 0===i&&r("info",[t]),i},setImage:function(t,e){var i=_.findWhere(o,{id:t});i?i.image=e:o.push({id:t,image:e})},getColor:function(e,i){if(!a[e]){var o=t.asc_getUserColorById(e);a[e]=["#"+("000000"+o.toString(16)).substr(-6),o]}return i?a[e][1]:a[e][0]}}},define("common/main/lib/controller/ExternalUsers",(function(){})),define("common/main/lib/controller/LaunchController",[],(function(){!Common.Controllers&&(Common.Controllers={}),Common.Controllers.LaunchController=new function(){var t=!1,e=function(){var e=this,i=window.DE||window.PE||window.SSE||window.PDFE||window.VE;!i.postLaunchScripts&&(i.postLaunchScripts=[]),require({waitSeconds:0},i.postLaunchScripts,(function(){Common.UI.ScreenReaderFocusManager&&Common.UI.ScreenReaderFocusManager.init(e.api),window.less&&(t=!0,Common.NotificationCenter.trigger("script:loaded"))}))},i=function(e){t=!0,Common.NotificationCenter.trigger("script:loaded")},o=function(t){e.call(this)},n=function(t){};return{init:function(t){this.api=t,Common.NotificationCenter.on("app:ready",o.bind(this)),Common.NotificationCenter.on("app:face",n.bind(this)),Common.NotificationCenter.on("app-pack:loaded",i.bind(this))},isScriptLoaded:function(){return t}}}})),define("common/main/lib/view/UserNameDialog",["common/main/lib/component/Window"],(function(){"use strict";Common.Views.UserNameDialog=Common.UI.Window.extend(_.extend({options:{width:330,header:!1,modal:!1,cls:"modal-dlg",buttons:["ok","cancel"]},initialize:function(t){_.extend(this.options,t||{}),this.template=['<div class="box">','<div style="margin-bottom: 2px;">'+(this.options.label?this.options.label:this.textLabel)+"</div>",'<div id="id-dlg-username-caption" class="input-row"></div>','<div id="id-dlg-username-chk-use" class="" style="margin-top: 10px;"></div>',"</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=this;t.inputLabel=new Common.UI.InputField({el:$("#id-dlg-username-caption"),allowBlank:!0,style:"width: 100%;",maxLength:128,validateOnBlur:!1,validation:t.options.validation||function(t){return!!t||""}}),t.inputLabel.setValue(this.options.value||""),t.chDontShow=new Common.UI.CheckBox({el:$("#id-dlg-username-chk-use"),labelText:this.textDontShow,value:this.options.check}),this.getChild().find(".dlg-btn").on("click",_.bind(this.onBtnClick,this))},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var t=this;_.delay((function(){t.getChild("input").focus()}),50)},onPrimary:function(t){return this._handleInput("ok"),!1},onBtnClick:function(t){this._handleInput(t.currentTarget.attributes.result.value)},_handleInput:function(t){if(this.options.handler){if("ok"==t&&!0!==this.inputLabel.checkValidate())return void this.inputLabel.cmpEl.find("input").focus();this.options.handler.call(this,t,{input:this.inputLabel.getValue(),checkbox:"checked"==this.chDontShow.getValue()})}this.close()},textLabel:"Label:",textLabelError:"Label must not be empty.",textDontShow:"Don't ask me again"},Common.Views.UserNameDialog||{}))})),define("spreadsheeteditor/main/app/controller/Main",["core","irregularstack","common/main/lib/component/Window","common/main/lib/component/LoadMask","common/main/lib/component/Tooltip","common/main/lib/controller/Fonts","common/main/lib/collection/TextArt","common/main/lib/util/LanguageInfo","common/main/lib/util/LocalStorage","spreadsheeteditor/main/app/collection/ShapeGroups","spreadsheeteditor/main/app/collection/TableTemplates","spreadsheeteditor/main/app/collection/EquationGroups","spreadsheeteditor/main/app/collection/ConditionalFormatIcons","spreadsheeteditor/main/app/controller/FormulaDialog","common/main/lib/component/RadioBox","common/main/lib/controller/FocusManager","common/main/lib/controller/HintManager","common/main/lib/controller/LayoutManager","common/main/lib/controller/ExternalUsers","common/main/lib/controller/LaunchController","common/main/lib/view/OpenDialog","common/main/lib/view/UserNameDialog"],(function(){"use strict";var t,e,i,o;SSE.Controllers.Main=Backbone.Controller.extend(_.extend((t=-255,e=-256,i={about:"button#left-btn-about",feedback:"button#left-btn-support"},o={toolbar:"#viewport #toolbar",leftMenu:"#viewport #left-menu, #viewport #id-toolbar-full-placeholder-btn-settings, #viewport #id-toolbar-short-placeholder-btn-settings",rightMenu:"#viewport #right-menu",statusBar:"#statusbar"},Common.localStorage.setId("table"),Common.localStorage.setKeysFilter("sse-,asc.table"),Common.localStorage.sync(),{models:[],collections:["ShapeGroups","EquationGroups","TableTemplates","ConditionalFormatIcons","ConditionalFormatIconsPresets","Common.Collections.TextArt","Common.Collections.HistoryUsers"],views:[],initialize:function(){this.addListeners({FileMenu:{"settings:apply":_.bind(this.applySettings,this)},"Common.Views.ReviewChanges":{"settings:apply":_.bind(this.applySettings,this)}});var t=this,e={Series:this.txtSeries,"Diagram Title":this.txtDiagramTitle,"X Axis":this.txtXAxis,"Y Axis":this.txtYAxis,"Your text here":this.txtArt,Table:this.txtTable,Print_Area:this.txtPrintArea,Confidential:this.txtConfidential,"Prepared by ":this.txtPreparedBy+" ",Page:this.txtPage,"Page %1 of %2":this.txtPageOf,Pages:this.txtPages,Date:this.txtDate,Time:this.txtTime,Tab:this.txtTab,File:this.txtFile,Column:this.txtColumn,Row:this.txtRow,"%1 of %2":this.txtByField,"(All)":this.txtAll,Values:this.txtValues,"Grand Total":this.txtGrandTotal,"Row Labels":this.txtRowLbls,"Column Labels":this.txtColLbls,"Multi-Select (Alt+S)":this.txtMultiSelect+Common.Utils.String.platformKey("Alt+S"," ("+(Common.Utils.isMac?Common.Utils.String.textCtrl+"+":"")+"{0})"),"Clear Filter (Alt+C)":this.txtClearFilter+Common.Utils.String.platformKey("Alt+C"," ("+(Common.Utils.isMac?Common.Utils.String.textCtrl+"+":"")+"{0})"),"(blank)":this.txtBlank,Group:this.txtGroup,Seconds:this.txtSeconds,Minutes:this.txtMinutes,Hours:this.txtHours,Days:this.txtDays,Months:this.txtMonths,Quarters:this.txtQuarters,Years:this.txtYears,"%1 or %2":this.txtOr,Qtr:this.txtQuarter,Text:this.textText,Sheet:this.txtSheet,None:this.txtNone,Slicer:this.txtSlicer,Info:this.txtInfo,Picture:this.txtPicture,PivotTable:this.txtPivotTable,View:this.txtView};["Normal","Neutral","Bad","Good","Input","Output","Calculation","Check Cell","Explanatory Text","Note","Linked Cell","Warning Text","Heading 1","Heading 2","Heading 3","Heading 4","Title","Total","Currency","Percent","Comma"].forEach((function(i){e[i]=t["txtStyle_"+i.replace(/ /g,"_")]||i})),["Aspect","Blue Green","Blue II","Blue Warm","Blue","Grayscale","Green Yellow","Green","Marquee","Median","Office 2007 - 2010","Office 2013 - 2022","Office","Orange Red","Orange","Paper","Red Orange","Red Violet","Red","Slipstream","Violet II","Violet","Yellow Orange","Yellow"].forEach((function(i){e[i]=t["txtScheme_"+i.replace(/[ -]/g,"_")]||i})),e["Currency [0]"]=t.txtStyle_Currency+" [0]",e["Comma [0]"]=t.txtStyle_Comma+" [0]";for(var i=1;i<7;i++)e["Accent"+i]=t.txtAccent+i,e["20% - Accent"+i]="20% - "+t.txtAccent+i,e["40% - Accent"+i]="40% - "+t.txtAccent+i,e["60% - Accent"+i]="60% - "+t.txtAccent+i;t.translationTable=e},onLaunch:function(){var t=this;if(this._state={isDisconnected:!1,usersCount:1,fastCoauth:!0,lostEditingRights:!1,licenseType:!1,isDocModified:!1,requireUserAction:!0},!Common.Utils.isBrowserSupported())return Common.Utils.showBrowserRestriction(),void Common.Gateway.reportError(void 0,this.unsupportedBrowserErrorText);this.api=this.getApplication().getController("Viewport").getApi(),Common.UI.FocusManager.init(),Common.UI.HintManager.init(this.api),Common.UI.Themes.init(this.api),Common.Controllers.LaunchController.init(this.api);var e=Common.localStorage.getBool("sse-settings-cachemode",!0);if(Common.Utils.InternalSettings.set("sse-settings-cachemode",e),this.api.asc_setDefaultBlitMode(!!e),null===(e=Common.localStorage.getItem("sse-settings-fontrender"))&&(e="3"),Common.Utils.InternalSettings.set("sse-settings-fontrender",e),this.api.asc_setFontRenderingMode(parseInt(e)),e=Common.localStorage.getBool("sse-settings-show-alt-hints",!0),Common.Utils.InternalSettings.set("sse-settings-show-alt-hints",e),e=Common.localStorage.getBool("app-settings-screen-reader"),Common.Utils.InternalSettings.set("app-settings-screen-reader",e),this.api.setSpeechEnabled(e),!Common.Utils.isIE&&/^https?:\/\//.test("https://helpcenter.onlyoffice.com/userguides/docs-se.aspx")){var i=new URL("https://helpcenter.onlyoffice.com/userguides/docs-se.aspx");i.searchParams&&i.searchParams.set("lang",Common.Locale.getCurrentLanguage()),Common.Utils.InternalSettings.set("url-help-center",i.toString())}this.api.asc_registerCallback("asc_onOpenDocumentProgress",_.bind(this.onOpenDocument,this)),this.api.asc_registerCallback("asc_onEndAction",_.bind(this.onLongActionEnd,this)),this.api.asc_registerCallback("asc_onError",_.bind(this.onError,this)),this.api.asc_registerCallback("asc_onDocumentContentReady",_.bind(this.onDocumentContentReady,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),this.api.asc_registerCallback("asc_onAdvancedOptions",_.bind(this.onAdvancedOptions,this)),this.api.asc_registerCallback("asc_onDocumentUpdateVersion",_.bind(this.onUpdateVersion,this)),this.api.asc_registerCallback("asc_onServerVersion",_.bind(this.onServerVersion,this)),this.api.asc_registerCallback("asc_onDocumentName",_.bind(this.onDocumentName,this)),this.api.asc_registerCallback("asc_onPrintUrl",_.bind(this.onPrintUrl,this)),this.api.asc_registerCallback("asc_onMeta",_.bind(this.onMeta,this)),this.api.asc_registerCallback("asc_onSpellCheckInit",_.bind(this.loadLanguages,this)),this.api.asc_registerCallback("asc_onOleEditorReady",_.bind(this.onOleEditorReady,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("goback",_.bind(this.goBack,this)),Common.NotificationCenter.on("close",_.bind(this.closeEditor,this)),Common.NotificationCenter.on("namedrange:locked",_.bind(this.onNamedRangeLocked,this)),Common.NotificationCenter.on("protectedrange:locked",_.bind(this.onProtectedRangeLocked,this)),Common.NotificationCenter.on("download:cancel",_.bind(this.onDownloadCancel,this)),Common.NotificationCenter.on("download:advanced",_.bind(this.onAdvancedOptions,this)),Common.NotificationCenter.on("showmessage",_.bind(this.onExternalMessage,this)),Common.NotificationCenter.on("markfavorite",_.bind(this.markFavorite,this)),Common.NotificationCenter.on("protect:check",_.bind(this.checkProtectedRange,this)),Common.NotificationCenter.on("editing:disable",_.bind(this.onEditingDisable,this)),Common.NotificationCenter.on("showerror",_.bind(this.onError,this)),this.stackLongActions=new Common.IrregularStack({strongCompare:this._compareActionStrong,weakCompare:this._compareActionWeak}),this.stackLongActions.push({id:-254,type:Asc.c_oAscAsyncActionType.BlockInteraction}),this.stackDisableActions=new Common.IrregularStack({strongCompare:this._compareActionWeak,weakCompare:this._compareActionWeak}),this.stackMacrosRequests=[],this.isShowOpenDialog=!1,this.editorConfig={},Common.Gateway.on("init",_.bind(this.loadConfig,this)),Common.Gateway.on("showmessage",_.bind(this.onExternalMessage,this)),Common.Gateway.on("opendocument",_.bind(this.loadDocument,this)),Common.Gateway.on("opendocumentfrombinary",_.bind(this.loadBinary,this)),Common.Gateway.on("internalcommand",_.bind(this.onInternalCommand,this)),Common.Gateway.on("grabfocus",_.bind(this.onGrabFocus,this)),Common.Gateway.appReady(),this.getApplication().getController("Viewport").setApi(this.api),$(document.body).on("focus","input, textarea:not(#ce-cell-content)",(function(e){!0!==t.isAppDisabled&&e&&e.target&&!/area_id/.test(e.target.id)&&(/msg-reply/.test(e.target.className)?t.dontCloseDummyComment=!0:/textarea-control/.test(e.target.className)?t.inTextareaControl=!0:!Common.Utils.ModalWindow.isVisible()&&/form-control/.test(e.target.className)&&(t.inFormControl=!0))})),$(document.body).on("blur","input, textarea",(function(e){if(!0!==t.isAppDisabled&&!t.isFrameClosed&&!(Common.Utils.ModalWindow.isVisible()&&!($(".asc-window.enable-key-events:visible").length>0)||t.loadMask&&t.loadMask.isVisible())){if(/form-control/.test(e.target.className)&&(t.inFormControl=!1),t.getApplication().getController("LeftMenu").getView("LeftMenu").getMenu("file").isVisible()&&0===$(".asc-window.enable-key-events:visible").length)return;if(!e.relatedTarget||!/area_id/.test(e.target.id)&&!("input"==e.target.localName&&$(e.target).parent().find(e.relatedTarget).length>0)&&!("textarea"==e.target.localName&&$(e.target).closest(".asc-window").find(".dropdown-menu").find(e.relatedTarget).length>0)&&("input"!=e.relatedTarget.localName||!/form-control/.test(e.relatedTarget.className))&&("textarea"!=e.relatedTarget.localName||/area_id/.test(e.relatedTarget.id))){if(Common.Utils.isIE&&e.originalEvent&&e.originalEvent.target&&/area_id/.test(e.originalEvent.target.id)&&e.originalEvent.target===e.originalEvent.srcElement)return;Common.Utils.isLinux&&t.appOptions&&t.appOptions.isDesktopApp?(e.relatedTarget||!e.originalEvent||e.originalEvent.sourceCapabilities)&&t.api.asc_enableKeyEvents(!0):t.api.asc_enableKeyEvents(!0),/msg-reply/.test(e.target.className)?t.dontCloseDummyComment=!1:/textarea-control/.test(e.target.className)&&(t.inTextareaControl=!1)}}})).on("dragover",(function(t){var e=t.originalEvent;if(e.target&&$(e.target).closest("#editor_sdk").length<1&&!$(e.target).is("#statusbar_bottom")&&!$.contains($("#statusbar_bottom"),$(e.target)))return e.preventDefault(),e.dataTransfer.dropEffect="none",!1})).on("dragstart",(function(t){var e=t.originalEvent;if(e.target){var i=$(e.target);(i.closest(".combobox").length>0||i.closest(".dropdown-menu").length>0||i.closest(".input-field").length>0||i.closest(".spinner").length>0||i.closest(".textarea-field").length>0||i.closest(".ribtab").length>0||i.closest(".combo-dataview").length>0)&&e.preventDefault()}})),Common.Utils.isChrome&&$(document.body).on("keydown","textarea",(function(t){t.keyCode!==Common.UI.Keys.PAGEUP&&t.keyCode!==Common.UI.Keys.PAGEDOWN||setTimeout((function(){$("#viewport").scrollLeft(0),$("#viewport").scrollTop(0)}),0)})),Common.NotificationCenter.on({"modal:show":function(e){Common.Utils.ModalWindow.show(),t.api.asc_enableKeyEvents(!1)},"modal:close":function(e){Common.Utils.ModalWindow.close(),Common.Utils.ModalWindow.isVisible()||t.api.asc_enableKeyEvents(!0)},"modal:hide":function(e){Common.Utils.ModalWindow.close(),Common.Utils.ModalWindow.isVisible()||t.api.asc_enableKeyEvents(!0)},"dataview:focus":function(t){},"dataview:blur":function(e){Common.Utils.ModalWindow.isVisible()||t.api.asc_enableKeyEvents(!0)},"menu:show":function(t){},"menu:hide":function(e,i){Common.Utils.ModalWindow.isVisible()||e&&e.cmpEl.hasClass("from-cell-edit")||i||(t.api.asc_InputClearKeyboardElement(),t.api.asc_enableKeyEvents(!0))},"edit:complete":_.bind(this.onEditComplete,this),"settings:unitschanged":_.bind(this.unitsChanged,this)}),this.initNames(),Common.util.Shortcuts.delegateShortcuts({shortcuts:{"command+s,ctrl+s,command+p,ctrl+p,command+k,ctrl+k,command+d,ctrl+d":_.bind((function(t){t.preventDefault(),t.stopPropagation()}),this)}}),t.defaultTitleText="ONLYOFFICE",t.warnNoLicense=(t.warnNoLicense||"").replace(/%1/g,"KKK"),t.warnNoLicenseUsers=(t.warnNoLicenseUsers||"").replace(/%1/g,"KKK"),t.textNoLicenseTitle=(t.textNoLicenseTitle||"").replace(/%1/g,"KKK"),t.warnLicenseExceeded=(t.warnLicenseExceeded||"").replace(/%1/g,"KKK"),t.warnLicenseUsersExceeded=(t.warnLicenseUsersExceeded||"").replace(/%1/g,"KKK"),Common.NotificationCenter.on("script:loaded",_.bind(t.onPostLoadComplete,t))},loadConfig:function(t){if(this.editorConfig=$.extend(this.editorConfig,t.config),this.appOptions={},this.appOptions.customization=this.editorConfig.customization,this.appOptions.canRenameAnonymous=!("object"==_typeof(this.appOptions.customization)&&"object"==_typeof(this.appOptions.customization.anonymous)&&!1===this.appOptions.customization.anonymous.request),this.appOptions.guestName="object"==_typeof(this.appOptions.customization)&&"object"==_typeof(this.appOptions.customization.anonymous)&&"string"==typeof this.appOptions.customization.anonymous.label&&""!==this.appOptions.customization.anonymous.label.trim()?Common.Utils.String.htmlEncode(this.appOptions.customization.anonymous.label):this.textGuest,this.appOptions.canRenameAnonymous&&(a=Common.localStorage.getItem("guest-username"),Common.Utils.InternalSettings.set("guest-username",a),Common.Utils.InternalSettings.set("save-guest-username",!!a)),this.appOptions.customization.font){if(this.appOptions.customization.font.name&&"string"==typeof this.appOptions.customization.font.name){for(var e=this.appOptions.customization.font.name.split(","),i=0;i<e.length;i++){var o=e[i].trim();o&&/[\s0-9\.]/.test(o)&&(e[i]="'"+o+"'")}document.documentElement.style.setProperty("--font-family-base-custom",e.join(","))}if(this.appOptions.customization.font.size){var n=parseInt(this.appOptions.customization.font.size);!isNaN(n)&&document.documentElement.style.setProperty("--font-size-base-app-custom",n+"px")}}this.editorConfig.user=this.appOptions.user=Common.Utils.fillUserInfo(this.editorConfig.user,this.editorConfig.lang,a?a+" ("+this.appOptions.guestName+")":this.textAnonymous,Common.localStorage.getItem("guest-id")||"uid-"+Date.now()),this.appOptions.user.anonymous&&Common.localStorage.setItem("guest-id",this.appOptions.user.id),this.appOptions.isDesktopApp="desktop"==this.editorConfig.targetApp||Common.Controllers.Desktop.isActive(),Common.Controllers.Desktop.isActive()&&!this.editorConfig.recent&&(this.editorConfig.recent=[]),this.appOptions.canCreateNew=this.editorConfig.canRequestCreateNew||!_.isEmpty(this.editorConfig.createUrl)||this.editorConfig.templates&&this.editorConfig.templates.length,this.appOptions.canOpenRecent=void 0!==this.editorConfig.recent,this.appOptions.templates=this.editorConfig.templates,this.appOptions.recent=this.editorConfig.recent,this.appOptions.createUrl=this.editorConfig.createUrl,this.appOptions.canRequestCreateNew=this.editorConfig.canRequestCreateNew,this.appOptions.lang=this.editorConfig.lang,this.appOptions.location="string"==typeof this.editorConfig.location?this.editorConfig.location.toLowerCase():"",this.appOptions.region="string"==typeof this.editorConfig.region?this.editorConfig.region.toLowerCase():this.editorConfig.region,this.appOptions.canAutosave=!1,this.appOptions.canAnalytics=!1,this.appOptions.sharingSettingsUrl=this.editorConfig.sharingSettingsUrl,this.appOptions.saveAsUrl=this.editorConfig.saveAsUrl,this.appOptions.fileChoiceUrl=this.editorConfig.fileChoiceUrl,this.appOptions.isEditDiagram="editdiagram"==this.editorConfig.mode,this.appOptions.isEditMailMerge="editmerge"==this.editorConfig.mode,this.appOptions.isEditOle="editole"==this.editorConfig.mode,this.appOptions.canPlugins=!1,this.appOptions.canRequestUsers=this.editorConfig.canRequestUsers,this.appOptions.canRequestSendNotify=this.editorConfig.canRequestSendNotify,this.appOptions.canRequestSaveAs=this.editorConfig.canRequestSaveAs,this.appOptions.canRequestInsertImage=this.editorConfig.canRequestInsertImage,this.appOptions.compatibleFeatures="object"==_typeof(this.appOptions.customization)&&!!this.appOptions.customization.compatibleFeatures,this.appOptions.canRequestSharingSettings=this.editorConfig.canRequestSharingSettings,this.appOptions.mentionShare=!("object"==_typeof(this.appOptions.customization)&&0==this.appOptions.customization.mentionShare),this.appOptions.canMakeActionLink=this.editorConfig.canMakeActionLink,this.appOptions.canFeaturePivot=!0,this.appOptions.canFeatureViews=!0,this.appOptions.canRequestReferenceData=this.editorConfig.canRequestReferenceData,this.appOptions.canRequestOpen=this.editorConfig.canRequestOpen,this.appOptions.canRequestReferenceSource=this.editorConfig.canRequestReferenceSource,this.appOptions.canSaveDocumentToBinary=this.editorConfig.canSaveDocumentToBinary,!this.appOptions.user.guest||!this.appOptions.canRenameAnonymous||this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle||Common.NotificationCenter.on("user:rename",_.bind(this.showRenameUserDialog,this)),this.appOptions.canRequestClose=this.editorConfig.canRequestClose,this.appOptions.canCloseEditor=!1,this.appOptions.canSwitchToMobile=this.editorConfig.forceDesktop;var s=!1;"object"===_typeof(this.appOptions.customization)&&("object"==_typeof(this.appOptions.customization.goback)&&!1!==this.editorConfig.canBackToFolder&&(s=void 0===this.appOptions.customization.close?!_.isEmpty(this.editorConfig.customization.goback.url)||this.editorConfig.customization.goback.requestClose&&this.appOptions.canRequestClose:!_.isEmpty(this.editorConfig.customization.goback.url)&&!this.editorConfig.customization.goback.requestClose,this.appOptions.customization.goback.requestClose&&console.log("Obsolete: The 'requestClose' parameter of the 'customization.goback' section is deprecated. Please use 'close' parameter in the 'customization' section instead.")),this.appOptions.customization.close&&"object"===_typeof(this.appOptions.customization.close)&&(this.appOptions.canCloseEditor=!1!==this.appOptions.customization.close.visible&&this.appOptions.canRequestClose&&!this.appOptions.isDesktopApp)),this.appOptions.canBack=this.appOptions.canBackToFolder=!!s,this.headerView=this.getApplication().getController("Viewport").getView("Common.Views.Header"),this.headerView.setCanBack(this.appOptions.canBack,this.appOptions.canBack?this.editorConfig.customization.goback.text:"");var a,r=Common.localStorage.getItem("sse-settings-reg-settings"),l=Common.localStorage.getBool("sse-settings-use-base-separator",!0),c=void 0,h=void 0;Common.Utils.InternalSettings.set("sse-settings-use-base-separator",l),l||(c=Common.localStorage.getItem("sse-settings-decimal-separator"),h=Common.localStorage.getItem("sse-settings-group-separator")),null!==r?this.api.asc_setLocale(parseInt(r),c,h):(r=this.appOptions.region,r=null!==(r=Common.util.LanguageInfo.getLanguages().hasOwnProperty(r)?r:Common.util.LanguageInfo.getLocalLanguageCode(r))?parseInt(r):this.editorConfig.lang?parseInt(Common.util.LanguageInfo.getLocalLanguageCode(this.editorConfig.lang)):1033,this.api.asc_setLocale(r,c,h)),Common.Utils.InternalSettings.set("sse-config-lang",this.editorConfig.lang),a=Common.localStorage.getBool("sse-settings-r1c1"),Common.Utils.InternalSettings.set("sse-settings-r1c1",a),this.api.asc_setR1C1Mode(a),this.loadDefaultMetricSettings(),this.editorConfig.customization&&(this.editorConfig.customization.toolbarNoTabs||"desktop"!==this.editorConfig.targetApp&&(this.editorConfig.customization.loaderName||this.editorConfig.customization.loaderLogo))||$("#editor_sdk").append('<div class="doc-placeholder">'+'<div class="columns"></div>'.repeat(2)+"</div>"),a=null===(a=Common.localStorage.getItem("sse-macros-mode"))?"enable"==(a=this.editorConfig.customization?this.editorConfig.customization.macrosMode:"warn")?1:"disable"==a?2:0:parseInt(a),Common.Utils.InternalSettings.set("sse-macros-mode",a),a=Common.localStorage.getItem("sse-allow-macros-request"),Common.Utils.InternalSettings.set("sse-allow-macros-request",null!==a?parseInt(a):0),this.appOptions.wopi=this.editorConfig.wopi,this.headerView.setWopi(this.appOptions.wopi),this.editorConfig.canRequestRefreshFile&&(Common.Gateway.on("refreshfile",_.bind(this.onRefreshFile,this)),this.api.asc_registerCallback("asc_onRequestRefreshFile",_.bind(this.onRequestRefreshFile,this))),this.isFrameClosed=this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle,Common.Controllers.Desktop.init(this.appOptions),Common.UI.HintManager.setMode(this.appOptions)},loadDocument:function(t){this.appOptions.spreadsheet=t.doc,this.permissions={};var e={};if(t.doc){this.permissions=_.extend(this.permissions,t.doc.permissions);var i=$.extend({},t.doc.options,this.editorConfig.actionLink||{}),o=new Asc.asc_CUserInfo;o.put_Id(this.appOptions.user.id),o.put_FullName(this.appOptions.user.fullname),o.put_IsAnonymousUser(!!this.appOptions.user.anonymous),(e=new Asc.asc_CDocInfo).put_Id(t.doc.key),e.put_Url(t.doc.url),e.put_DirectUrl(t.doc.directUrl),e.put_Title(t.doc.title),e.put_Format(t.doc.fileType),e.put_VKey(t.doc.vkey),e.put_Options(i),e.put_UserInfo(o),e.put_CallbackUrl(this.editorConfig.callbackUrl),e.put_Token(t.doc.token),e.put_Permissions(t.doc.permissions),e.put_EncryptedInfo(this.editorConfig.encryptionKeys),e.put_Lang(this.editorConfig.lang),e.put_Mode(this.editorConfig.mode),e.put_ReferenceData(t.doc.referenceData),e.put_SupportsOnSaveDocument(this.editorConfig.canSaveDocumentToBinary),e.put_Wopi(this.editorConfig.wopi),this.editorConfig.shardkey&&e.put_Shardkey(this.editorConfig.shardkey);var n=this.editorConfig.coEditing&&"object"==_typeof(this.editorConfig.coEditing)?"view"===this.editorConfig.mode&&!1!==this.editorConfig.coEditing.change?"fast":this.editorConfig.coEditing.mode||"fast":"fast";e.put_CoEditingMode(n);var s=!this.editorConfig.customization||!1!==this.editorConfig.customization.macros;e.asc_putIsEnabledMacroses(!!s),s=!this.editorConfig.customization||!1!==this.editorConfig.customization.plugins,e.asc_putIsEnabledPlugins(!!s),this.editorConfig.customization&&(void 0!==this.editorConfig.customization.showVerticalScroll&&null!==this.editorConfig.customization.showVerticalScroll&&e.asc_putShowVerticalScroll(this.editorConfig.customization.showVerticalScroll),void 0!==this.editorConfig.customization.showHorizontalScroll&&null!==this.editorConfig.customization.showHorizontalScroll&&e.asc_putShowHorizontalScroll(this.editorConfig.customization.showHorizontalScroll)),this.headerView&&this.headerView.setDocumentCaption(t.doc.title),Common.Utils.InternalSettings.set("sse-doc-info-key",t.doc.key)}this.api.asc_registerCallback("asc_onGetEditorPermissions",_.bind(this.onEditorPermissions,this)),this.api.asc_registerCallback("asc_onLicenseChanged",_.bind(this.onLicenseChanged,this)),this.api.asc_registerCallback("asc_onMacrosPermissionRequest",_.bind(this.onMacrosPermissionRequest,this)),this.api.asc_registerCallback("asc_onRunAutostartMacroses",_.bind(this.onRunAutostartMacroses,this)),this.api.asc_setDocInfo(e),this.api.asc_getEditorPermissions(this.editorConfig.licenseUrl,this.editorConfig.customerId)},onProcessSaveResult:function(t){this.api.asc_OnSaveEnd(t.result),t&&!1===t.result&&Common.UI.error({title:this.criticalErrorTitle,msg:_.isEmpty(t.message)?this.errorProcessSaveResult:t.message})},onProcessRightsChange:function(t){if(t&&!1===t.enabled){var e=this,i=this._state.lostEditingRights;this._state.lostEditingRights=!this._state.lostEditingRights,this.api.asc_coAuthoringDisconnect(),Common.NotificationCenter.trigger("collaboration:sharingdeny"),Common.NotificationCenter.trigger("api:disconnect"),!i&&Common.UI.TooltipManager.showTip({step:"changeRights",text:_.isEmpty(t.message)?this.warnProcessRightsChange:t.message,target:"#toolbar",maxwidth:600,showButton:!1,automove:!0,noHighlight:!0,multiple:!0,callback:function(){e._state.lostEditingRights=!1}})}},onDownloadAs:function(t){if(this.appOptions.canDownload){this._state.isFromGatewayDownloadAs=!0;var e=t&&"string"==typeof t?Asc.c_oAscFileType[t.toUpperCase()]:null,i=[Asc.c_oAscFileType.XLSX,Asc.c_oAscFileType.ODS,Asc.c_oAscFileType.CSV,Asc.c_oAscFileType.PDF,Asc.c_oAscFileType.PDFA,Asc.c_oAscFileType.XLTX,Asc.c_oAscFileType.OTS,Asc.c_oAscFileType.XLSM,Asc.c_oAscFileType.XLSB,Asc.c_oAscFileType.JPG,Asc.c_oAscFileType.PNG];if((!e||i.indexOf(e)<0)&&(e=Asc.c_oAscFileType.XLSX),e==Asc.c_oAscFileType.PDF||e==Asc.c_oAscFileType.PDFA)Common.NotificationCenter.trigger("download:settings",this,e,!0);else{var o=new Asc.asc_CDownloadOptions(e,!0);o.asc_setIsSaveAs(!0),this.api.asc_DownloadAs(o)}}else Common.Gateway.reportError(Asc.c_oAscError.ID.AccessDeny,this.errorAccessDeny)},onProcessMouse:function(t){if("mouseup"==t.type){var e=document.getElementById("editor_sdk");if(e){var i=Common.Utils.getBoundingClientRect(e),o=t.event||{};this.api.asc_onMouseUp(o,t.x-i.left,t.y-i.top)}}},onRequestClose:function(){var t=this;this.api.asc_isDocumentModified()?(this.api.asc_stopSaving(),Common.UI.warning({closable:!1,width:500,title:this.notcriticalErrorTitle,msg:this.leavePageTextOnClose,buttons:["ok","cancel"],primary:"ok",callback:function(e){"ok"==e?(t.api.asc_undoAllChanges(),t.api.asc_continueSaving(),Common.Gateway.requestClose()):t.api.asc_continueSaving()}})):Common.Gateway.requestClose()},goBack:function(t){var e=this;if(!Common.Controllers.Desktop.process("goback"))if(e.appOptions.customization.goback.requestClose&&e.appOptions.canRequestClose)e.onRequestClose();else{var i=e.appOptions.customization.goback.url;t||!1===e.appOptions.customization.goback.blank?parent.location.href=i:window.open(i,"_blank")}},closeEditor:function(){this.appOptions.canRequestClose&&this.onRequestClose()},markFavorite:function(t){Common.Controllers.Desktop.process("markfavorite")||Common.Gateway.metaChange({favorite:t})},onSetFavorite:function(t){this.appOptions.canFavorite&&this.headerView&&this.headerView.setFavorite(!!t)},onEditComplete:function(t,e){if(e&&e.restorefocus&&this.api.isCEditorFocused){var i=this;setTimeout((function(){i.formulaInput.blur(),i.formulaInput.focus()}),0)}else this.getApplication().getController("DocumentHolder").getView("DocumentHolder").focus(),this.api.isCEditorFocused=!1;var o=this.getApplication(),n=o.getController("Toolbar").getView("Toolbar"),s=o.getController("RightMenu").getView("RightMenu");this.appOptions.isEdit&&(n&&n._isEyedropperStart||s&&s._isEyedropperStart)&&(n._isEyedropperStart?n._isEyedropperStart=!1:s._isEyedropperStart=!1,this.api.asc_cancelEyedropper()),Common.UI.HintManager.clearHints(!0)},onSelectionChanged:function(t){t&&(this._isChartDataReady||t.asc_getSelectionType()!=Asc.c_oAscSelectionType.RangeChart||(this._isChartDataReady=!0,Common.Gateway.internalMessage("chartDataReady")))},onLongActionBegin:function(t,e){var i={id:e,type:t};this.stackLongActions.push(i),this.setLongActionView(i)},onLongActionEnd:function(t,e){var i={id:e,type:t};if(this.stackLongActions.pop(i),this.headerView&&this.headerView.setDocumentCaption(this.api.asc_getDocumentName()),this.updateWindowTitle(this.api.asc_isDocumentModified(),!0),i=this.stackLongActions.get({type:Asc.c_oAscAsyncActionType.Information}))this.setLongActionView(i);else{var o=this;e!=Asc.c_oAscAsyncAction.Save&&e!=Asc.c_oAscAsyncAction.ForceSaveButton||this.appOptions.isOffline?this.getApplication().getController("Statusbar").setStatusCaption(""):this._state.fastCoauth&&this._state.usersCount>1?o._state.timerSave=setTimeout((function(){o.getApplication().getController("Statusbar").setStatusCaption(o.textChangesSaved,!1,3e3)}),500):o.getApplication().getController("Statusbar").setStatusCaption(o.textChangesSaved,!1,3e3)}e==Asc.c_oAscAsyncAction.Save&&this.synchronizeChanges(),(i=this.stackLongActions.get({type:Asc.c_oAscAsyncActionType.BlockInteraction}))?this.setLongActionView(i):(this.loadMask&&(!this.loadMask.isVisible()||this.dontCloseDummyComment||this.inTextareaControl||Common.Utils.ModalWindow.isVisible()||this.inFormControl||((this.appOptions.isEditMailMerge||this.appOptions.isEditDiagram||this.appOptions.isEditOle)&&Common.UI.HintManager.setInternalEditorLoading(!1),this.api.asc_enableKeyEvents(!0)),this.loadMask.hide()),t==Asc.c_oAscAsyncActionType.BlockInteraction&&e!=Asc.c_oAscAsyncAction.LoadDocumentFonts&&e!=Asc.c_oAscAsyncAction.LoadFonts&&e!=Asc.c_oAscAsyncAction.ApplyChanges&&e!=Asc.c_oAscAsyncAction.LoadImage&&e!=Asc.c_oAscAsyncAction.UploadImage&&this.onEditComplete(this.loadMask,{restorefocus:!0})),e==Asc.c_oAscAsyncAction.Disconnect?(this._state.timerDisconnect&&clearTimeout(this._state.timerDisconnect),this.disableEditing(!1,"reconnect"),Common.UI.TooltipManager.closeTip("disconnect"),this.getApplication().getController("Statusbar").setStatusCaption(this.textReconnect)):e===Asc.c_oAscAsyncAction.RefreshFile&&(this.disableEditing(!1,"refresh-file"),Common.UI.TooltipManager.closeTip("refreshFile"),this.getApplication().getController("Statusbar").setStatusCaption(""))},setLongActionView:function(i){var o="",n="",s=!1;switch(i.id){case Asc.c_oAscAsyncAction.Open:o=this.openTitleText,n=this.openTextText;break;case Asc.c_oAscAsyncAction.Save:case Asc.c_oAscAsyncAction.ForceSaveButton:case Asc.c_oAscAsyncAction.ForceSaveTimeout:clearTimeout(this._state.timerSave),s=!0,o=this.saveTitleText,n=this.appOptions.isOffline?"":this.saveTextText;break;case Asc.c_oAscAsyncAction.LoadDocumentFonts:o=this.loadFontsTitleText,n=this.loadFontsTextText;break;case Asc.c_oAscAsyncAction.LoadDocumentImages:o=this.loadImagesTitleText,n=this.loadImagesTextText;break;case Asc.c_oAscAsyncAction.LoadFont:o=this.loadFontTitleText,n=this.loadFontTextText;break;case Asc.c_oAscAsyncAction.LoadImage:o=this.loadImageTitleText,n=this.loadImageTextText;break;case Asc.c_oAscAsyncAction.DownloadAs:o=this.downloadTitleText,n=this.downloadTextText;break;case Asc.c_oAscAsyncAction.Print:o=this.printTitleText,n=this.printTextText;break;case Asc.c_oAscAsyncAction.UploadImage:o=this.uploadImageTitleText,n=this.uploadImageTextText;break;case Asc.c_oAscAsyncAction.SlowOperation:o=this.textPleaseWait,n=this.textPleaseWait;break;case Asc.c_oAscAsyncAction.Waiting:o=this.waitText,n=this.waitText;break;case t:o=this.txtEditingMode,n=this.waitText;break;case e:o=this.loadingDocumentTitleText+"           ",n=this.loadingDocumentTitleText;break;case Asc.c_oAscAsyncAction.Disconnect:return o=this.textDisconnect,n=this.textDisconnect,Common.UI.Menu.Manager.hideAll(),this.disableEditing(!0,"reconnect"),this._state.timerDisconnect=setTimeout((function(){Common.UI.TooltipManager.showTip("disconnect")}),this._state.unloadTimer||0),void this.getApplication().getController("Statusbar").setStatusCaption(n);case Asc.c_oAscAsyncAction.RefreshFile:return o=this.textUpdating,n=this.textUpdating,Common.UI.Menu.Manager.hideAll(),this.disableEditing(!0,"refresh-file"),Common.UI.TooltipManager.showTip("refreshFile"),void this.getApplication().getController("Statusbar").setStatusCaption(n);default:"string"==typeof i.id&&(o=i.id,n=i.id)}i.type==Asc.c_oAscAsyncActionType.BlockInteraction?(!this.loadMask&&(this.loadMask=new Common.UI.LoadMask({owner:$("#viewport")})),this.loadMask.setTitle(o),this.isShowOpenDialog||(this.api.asc_enableKeyEvents(!1),this.loadMask.show())):this.getApplication().getController("Statusbar").setStatusCaption(n,s,0,null)},onApplyEditRights:function(t){this.getApplication().getController("Statusbar").setStatusCaption(""),t&&!t.allowed&&Common.UI.info({title:this.requestEditFailedTitleText,msg:t.message||this.requestEditFailedMessageText})},onDocumentContentReady:function(){if(!this._isDocReady){Common.Gateway.internalMessage("documentReady",{}),this._state.openDlg&&this._state.openDlg.close();var t,i=this;i._isDocReady=!0,Common.NotificationCenter.trigger("app:ready",this.appOptions),i.hidePreloader(),i.onLongActionEnd(Asc.c_oAscAsyncActionType.BlockInteraction,e),t=this.appOptions.isEditMailMerge||this.appOptions.isEditDiagram||this.appOptions.isEditOle?100:Common.localStorage.getItem("sse-settings-zoom"),Common.Utils.InternalSettings.set("sse-settings-zoom",t);var o=null!==t?parseInt(t)/100:this.appOptions.customization&&this.appOptions.customization.zoom?parseInt(this.appOptions.customization.zoom)/100:1,n=null!==(t=Common.localStorage.getItem("sse-last-zoom"))?parseInt(t)/100:1;if(this.api.asc_setZoom(o>0?o:o<0&&n>0?n:1),this.isLiveCommenting=Common.localStorage.getBool("sse-settings-livecomment",!0),Common.Utils.InternalSettings.set("sse-settings-livecomment",this.isLiveCommenting),t=Common.localStorage.getBool("sse-settings-resolvedcomment"),Common.Utils.InternalSettings.set("sse-settings-resolvedcomment",t),this.isLiveCommenting?this.api.asc_showComments(t):this.api.asc_hideComments(),this._state.fastCoauth=Common.Utils.InternalSettings.get("sse-settings-coauthmode"),this.api.asc_SetFastCollaborative(i._state.fastCoauth),this.api.asc_setAutoSaveGap(Common.Utils.InternalSettings.get("sse-settings-autosave")),Common.UI.FeaturesManager.canChange("spellcheck")){var s=Common.localStorage.getBool("sse-spellcheck-ignore-uppercase-words",!0);Common.Utils.InternalSettings.set("sse-spellcheck-ignore-uppercase-words",s),this.api.asc_ignoreUppercase(s);var a=Common.localStorage.getBool("sse-spellcheck-ignore-numbers-words",!0);Common.Utils.InternalSettings.set("sse-spellcheck-ignore-numbers-words",a),this.api.asc_ignoreNumbers(a)}t=Common.localStorage.getBool("sse-settings-smooth-scroll",!0),Common.Utils.InternalSettings.set("sse-settings-smooth-scroll",t),this.api.asc_SetSmoothScrolling(t),t=Common.localStorage.getBool("sse-settings-def-sheet-rtl"),Common.Utils.InternalSettings.set("sse-settings-def-sheet-rtl",t),this.api.asc_setDefaultDirection(t),i.api.asc_registerCallback("asc_onStartAction",_.bind(i.onLongActionBegin,i)),i.api.asc_registerCallback("asc_onConfirmAction",_.bind(i.onConfirmAction,i)),i.api.asc_registerCallback("asc_onActiveSheetChanged",_.bind(i.onActiveSheetChanged,i)),i.api.asc_registerCallback("asc_onPrint",_.bind(i.onPrint,i));var r=i.getApplication();i.headerView.setDocumentCaption(i.api.asc_getDocumentName()),i.updateWindowTitle(i.api.asc_isDocumentModified(),!0);var l=r.getController("Toolbar"),c=r.getController("Statusbar"),h=r.getController("DocumentHolder"),d=r.getController("RightMenu"),m=r.getController("LeftMenu"),p=r.getController("CellEditor"),u=c.getView("Statusbar"),g=m.getView("LeftMenu"),f=h.getView("DocumentHolder"),b=r.getController("Common.Controllers.Chat"),C=r.getController("Common.Controllers.Plugins"),v=r.getController("Spellcheck");if(g.getMenu("file").loadDocument({doc:i.appOptions.spreadsheet}),m.setMode(i.appOptions).createDelayedElements().setApi(i.api),i.appOptions.isEditMailMerge||i.appOptions.isEditDiagram||i.appOptions.isEditOle||(C.setApi(i.api),this.api&&this.api.asc_setFrozenPaneBorderType(Common.localStorage.getBool("sse-freeze-shadow",!0)?Asc.c_oAscFrozenPaneBorderType.shadow:Asc.c_oAscFrozenPaneBorderType.line),r.getController("Common.Controllers.ExternalOleEditor").setApi(this.api).loadConfig({config:this.editorConfig,customization:this.editorConfig.customization})),g.disableMenu("all",!1),i.appOptions.isEditMailMerge||i.appOptions.isEditDiagram||i.appOptions.isEditOle||!i.appOptions.canBranding||i.getApplication().getController("LeftMenu").leftMenu.getMenu("about").setLicInfo(i.editorConfig.customization),h.setApi(i.api).loadConfig({config:i.editorConfig}),b.setApi(this.api).setMode(this.appOptions),c.createDelayedElements(),c.setApi(i.api),f.setApi(i.api),u.update(),this.formulaInput=p.getView("CellEditor").$el.find("textarea"),i.appOptions.isEdit){Common.UI.FeaturesManager.canChange("spellcheck")&&v.setApi(i.api).setMode(i.appOptions),i.appOptions.canForcesave&&(i.appOptions.forcesave=Common.localStorage.getBool("sse-settings-forcesave",i.appOptions.canForcesave),Common.Utils.InternalSettings.set("sse-settings-forcesave",i.appOptions.forcesave),i.api.asc_setIsForceSaveOnUserSave(i.appOptions.forcesave)),null===(t=Common.localStorage.getItem("sse-settings-paste-button"))&&(t="1"),Common.Utils.InternalSettings.set("sse-settings-paste-button",parseInt(t)),i.api.asc_setVisiblePasteButton(!!parseInt(t)),null===(t=Common.localStorage.getItem("sse-settings-function-tooltip"))&&(t="1"),Common.Utils.InternalSettings.set("sse-settings-function-tooltip",parseInt(t)),i.loadAutoCorrectSettings(),i.needToUpdateVersion&&(Common.NotificationCenter.trigger("api:disconnect"),l.onApiCoAuthoringDisconnect());var w=setInterval((function(){if(window.styles_loaded||i.appOptions.isEditDiagram||i.appOptions.isEditMailMerge||i.appOptions.isEditOle){if(clearInterval(w),Common.NotificationCenter.trigger("comments:updatefilter",["doc","sheet"+i.api.asc_getActiveWorksheetId()]),f.createDelayedElements(),l.createDelayedElements(),i.appOptions.isEditMailMerge||i.appOptions.isEditDiagram||i.appOptions.isEditOle)i.appOptions.isEditOle&&i.updateThemeColors();else{var t=i.api.asc_getPropertyEditorShapes();t&&i.fillAutoShapes(t[0],t[1]),i.updateThemeColors(),l.activateControls()}d.createDelayedElements(),i.api.asc_registerCallback("asc_onDocumentCanSaveChanged",_.bind(i.onDocumentCanSaveChanged,i)),i.api.asc_registerCallback("asc_OnTryUndoInFastCollaborative",_.bind(i.onTryUndoInFastCollaborative,i)),i.onDocumentModifiedChanged(i.api.asc_isDocumentModified());var e=r.getController("FormulaDialog");e&&e.setApi(i.api),i.needToUpdateVersion&&l.onApiCoAuthoringDisconnect(),Common.NotificationCenter.trigger("document:ready","main"),i.applyLicense()}}),50)}else{var A=r.getController("FormulaDialog");A&&A.setApi(i.api),f.createDelayedElementsViewer(),Common.Utils.injectSvgIcons(),Common.NotificationCenter.trigger("document:ready","main"),i.applyLicense()}if(!i.appOptions.isEditMailMerge&&!i.appOptions.isEditDiagram&&!i.appOptions.isEditOle){var y=~~(1e6*Math.random());$(".toolbar").prepend(Common.Utils.String.format('<div class="lazy-{0} x-huge"><div class="toolbar__icon" style="position: absolute; width: 1px; height: 1px;"></div>',y)),setTimeout((function(){$(Common.Utils.String.format(".toolbar .lazy-{0}",y)).remove()}),10)}i.appOptions.canAnalytics,Common.Gateway.on("applyeditrights",_.bind(i.onApplyEditRights,i)),Common.Gateway.on("processsaveresult",_.bind(i.onProcessSaveResult,i)),Common.Gateway.on("processrightschange",_.bind(i.onProcessRightsChange,i)),Common.Gateway.on("processmouse",_.bind(i.onProcessMouse,i)),Common.Gateway.on("downloadas",_.bind(i.onDownloadAs,i)),Common.Gateway.on("setfavorite",_.bind(i.onSetFavorite,i)),Common.Gateway.on("requestclose",_.bind(i.onRequestClose,i)),Common.Gateway.on("refreshhistory",_.bind(i.onRefreshHistory,i)),Common.Gateway.sendInfo({mode:i.appOptions.isEdit?"edit":"view"}),$(document).on("contextmenu",_.bind(i.onContextMenu,i)),void 0!==document.hidden&&document.hidden?document.addEventListener("visibilitychange",S):S(),Common.Gateway.documentReady(),this._state.requireUserAction=!1,!this.appOptions.user.guest||!this.appOptions.canRenameAnonymous||this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle||null!==Common.Utils.InternalSettings.get("guest-username")||this.showRenameUserDialog(),this._needToSaveAsFile&&this.getApplication().getController("LeftMenu").leftMenu.showMenu("file:saveas")}function S(){if(!window.AscDesktopEditor){var t=[];Common.Utils.isIE9m&&t.push(i.warnBrowserIE9),t.length&&i.showTips(t)}document.removeEventListener("visibilitychange",S)}},onPostLoadComplete:function(){this.appOptions.isEdit&&this.setLanguages()},onLicenseChanged:function(t){if(!(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle)){var e=t.asc_getLicenseType();void 0!==e&&(this.appOptions.canEdit||this.appOptions.isRestrictedEdit)&&"view"!==this.editorConfig.mode&&(e===Asc.c_oLicenseResult.Connections||e===Asc.c_oLicenseResult.UsersCount||e===Asc.c_oLicenseResult.ConnectionsOS||e===Asc.c_oLicenseResult.UsersCountOS||e===Asc.c_oLicenseResult.SuccessLimit&&0!=(this.appOptions.trialMode&Asc.c_oLicenseMode.Limited))&&(this._state.licenseType=e),void 0===e||!this.appOptions.canLiveView||e!==Asc.c_oLicenseResult.ConnectionsLive&&e!==Asc.c_oLicenseResult.ConnectionsLiveOS&&e!==Asc.c_oLicenseResult.UsersViewCount&&e!==Asc.c_oLicenseResult.UsersViewCountOS||(this._state.licenseType=e),this._isDocReady&&this.applyLicense()}},applyLicense:function(){if("view"===this.editorConfig.mode)this.appOptions.canLiveView&&(this._state.licenseType===Asc.c_oLicenseResult.ConnectionsLive||this._state.licenseType===Asc.c_oLicenseResult.ConnectionsLiveOS||this._state.licenseType===Asc.c_oLicenseResult.UsersViewCount||this._state.licenseType===Asc.c_oLicenseResult.UsersViewCountOS||!this.appOptions.isAnonymousSupport&&this.appOptions.user.anonymous)&&this.disableLiveViewing(!0);else if(!this.appOptions.isAnonymousSupport&&this.appOptions.user.anonymous)this.disableEditing(!0),this.api.asc_coAuthoringDisconnect(),Common.NotificationCenter.trigger("api:disconnect"),Common.UI.warning({title:this.notcriticalErrorTitle,msg:this.warnLicenseAnonymous,buttons:["ok"]});else if(this._state.licenseType){var t=this._state.licenseType,e=["ok"],i="ok";0==(this.appOptions.trialMode&Asc.c_oLicenseMode.Limited)||t!==Asc.c_oLicenseResult.SuccessLimit&&this.appOptions.permissionsLicense!==Asc.c_oLicenseResult.SuccessLimit?t===Asc.c_oLicenseResult.Connections||t===Asc.c_oLicenseResult.UsersCount?t=t===Asc.c_oLicenseResult.Connections?this.warnLicenseExceeded:this.warnLicenseUsersExceeded:(t=t===Asc.c_oLicenseResult.ConnectionsOS?this.warnNoLicense:this.warnNoLicenseUsers,e=[{value:"buynow",caption:this.textBuyNow},{value:"contact",caption:this.textContactUs}],i="buynow"):t=this.warnLicenseLimitedRenewed,this._state.licenseType!==Asc.c_oLicenseResult.SuccessLimit&&(this.appOptions.isEdit||this.appOptions.isRestrictedEdit)&&(this.disableEditing(!0),this.api.asc_coAuthoringDisconnect(),Common.NotificationCenter.trigger("api:disconnect"));var o=Common.localStorage.getItem("sse-license-warning");o=null!==o?parseInt(o):0;var n=(new Date).getTime();n-o>864e5&&Common.UI.info({maxwidth:500,title:this.textNoLicenseTitle,msg:t,buttons:e,primary:i,callback:function(t){Common.localStorage.setItem("sse-license-warning",n),"buynow"==t?window.open("https://www.onlyoffice.com","_blank"):"contact"==t&&window.open("mailto:sales@onlyoffice.com","_blank")}})}else!this.appOptions.isDesktopApp&&!this.appOptions.canBrandingExt&&!(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle)&&this.editorConfig&&this.editorConfig.customization&&(this.editorConfig.customization.loaderName||this.editorConfig.customization.loaderLogo||this.editorConfig.customization.font&&(this.editorConfig.customization.font.size||this.editorConfig.customization.font.name))&&Common.UI.warning({title:this.textPaidFeature,msg:this.textCustomLoader,buttons:[{value:"contact",caption:this.textContactUs},{value:"close",caption:this.textClose}],primary:"contact",callback:function(t){"contact"==t&&window.open("mailto:sales@onlyoffice.com","_blank")}})},disableEditing:function(t,e){!e&&(e="disconnect");var i="reconnect"===e||"refresh-file"===e;Common.NotificationCenter.trigger("editing:disable",t,{viewMode:t,allowSignature:!1,allowProtect:!1,rightMenu:{clear:!i,disable:!0},statusBar:!0,leftMenu:{disable:!0,previewMode:!0},fileMenu:{protect:!0,history:i},comments:{disable:!i,previewMode:!0},chat:!0,review:!0,viewport:!0,documentHolder:{clear:!i,disable:!0},toolbar:!0,celleditor:{previewMode:!0},header:{search:"not-loaded"===e},shortcuts:"not-loaded"===e},e||"disconnect")},onEditingDisable:function(t,e,i){var o=this.getApplication(),n={type:i,disable:t,options:e};t&&!this.stackDisableActions.get({type:i})&&this.stackDisableActions.push(n),!t&&this.stackDisableActions.pop({type:i});var s=!t&&this.stackDisableActions.length()>0?this.stackDisableActions.get(this.stackDisableActions.length()-1):null;if(e.rightMenu&&o.getController("RightMenu")&&(e.rightMenu.clear&&o.getController("RightMenu").getView("RightMenu").clearSelection(),e.rightMenu.disable&&o.getController("RightMenu").SetDisabled(t,e.allowSignature)),e.statusBar&&o.getController("Statusbar").SetDisabled(t),e.review&&o.getController("Common.Controllers.ReviewChanges").SetDisabled(t),e.viewport&&o.getController("Viewport").SetDisabled(t),e.toolbar&&o.getController("Toolbar").DisableToolbar(t,e.viewMode),e.documentHolder&&(e.documentHolder.clear&&o.getController("DocumentHolder").clearSelection(),e.documentHolder.disable&&o.getController("DocumentHolder").SetDisabled(t,e.allowProtect)),e.leftMenu&&(e.leftMenu.disable&&o.getController("LeftMenu").SetDisabled(t,e),e.leftMenu.previewMode&&o.getController("LeftMenu").setPreviewMode(t)),e.fileMenu&&(o.getController("LeftMenu").leftMenu.getMenu("file").SetDisabled(t,e.fileMenu),e.leftMenu.disable&&o.getController("LeftMenu").leftMenu.getMenu("file").applyMode()),e.comments){var a=this.getApplication().getController("Common.Controllers.Comments");a&&e.comments.previewMode&&a.setPreviewMode(t)}e.celleditor&&e.celleditor.previewMode&&o.getController("CellEditor").setPreviewMode(t),e.shortcuts&&(t?Common.util.Shortcuts.suspendEvents():Common.util.Shortcuts.resumeEvents()),e.header&&(e.header.search&&this.headerView&&this.headerView.lockHeaderBtns("search",t),this.headerView&&this.headerView.lockHeaderBtns("undo",e.viewMode,Common.enumLock.lostConnect),this.headerView&&this.headerView.lockHeaderBtns("redo",e.viewMode,Common.enumLock.lostConnect)),s&&this.onEditingDisable(s.disable,s.options,s.type)},disableLiveViewing:function(t){this.appOptions.canLiveView=!t,this.api.asc_SetFastCollaborative(!t),Common.Utils.InternalSettings.set("sse-settings-coauthmode",!t)},onOpenDocument:function(t){var e=document.getElementById("loadmask-text"),i=(t.asc_getCurrentFont()+t.asc_getCurrentImage())/(t.asc_getFontsCount()+t.asc_getImagesCount());i=this.textLoadingDocument+": "+Common.Utils.String.fixedDigits(Math.min(Math.round(100*i),100),3,"  ")+"%",e?e.innerHTML=i:this.loadMask&&this.loadMask.setTitle(i)},onEditorPermissions:function(t){var i=t?t.asc_getLicenseType():Asc.c_oLicenseResult.Error;if(t&&!(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle)){if(Asc.c_oLicenseResult.Expired===i||Asc.c_oLicenseResult.Error===i||Asc.c_oLicenseResult.ExpiredTrial===i||Asc.c_oLicenseResult.NotBefore===i||Asc.c_oLicenseResult.ExpiredLimited===i)return Common.UI.warning({title:Asc.c_oLicenseResult.NotBefore===i?this.titleLicenseNotActive:this.titleLicenseExp,msg:Asc.c_oLicenseResult.NotBefore===i?this.warnLicenseBefore:this.warnLicenseExp,buttons:[],closable:!1}),void((this._isDocReady||this._isPermissionsInited)&&(this.disableEditing(!0),Common.NotificationCenter.trigger("api:disconnect")));if(this.onServerVersion(t.asc_getBuildVersion())||!this.onLanguageLoaded())return;if(this._isDocReady||this._isPermissionsInited)return void this.api.asc_LoadDocument();t.asc_getRights()!==Asc.c_oRights.Edit&&(this.permissions.edit=!1),this.appOptions.permissionsLicense=i,this.appOptions.canAutosave=!0,this.appOptions.canAnalytics=t.asc_getIsAnalyticsEnable(),this.appOptions.isOffline=this.api.asc_isOffline(),this.appOptions.isCrypted=this.api.asc_isCrypto(),this.appOptions.canLicense=i===Asc.c_oLicenseResult.Success||i===Asc.c_oLicenseResult.SuccessLimit,this.appOptions.isLightVersion=t.asc_getIsLight(),this.appOptions.canCoAuthoring=!this.appOptions.isLightVersion,this.appOptions.canComments=this.appOptions.canLicense&&(void 0===this.permissions.comment?!1!==this.permissions.edit:this.permissions.comment)&&"view"!==this.editorConfig.mode,this.appOptions.canComments=this.appOptions.canComments&&!("object"==_typeof(this.editorConfig.customization)&&!1===this.editorConfig.customization.comments),this.appOptions.canViewComments=this.appOptions.canComments||!("object"==_typeof(this.editorConfig.customization)&&!1===this.editorConfig.customization.comments),this.appOptions.canChat=this.appOptions.canLicense&&!this.appOptions.isOffline&&!(!1===this.permissions.chat||void 0===this.permissions.chat&&"object"==_typeof(this.editorConfig.customization)&&!1===this.editorConfig.customization.chat),"object"==_typeof(this.editorConfig.customization)&&void 0!==this.editorConfig.customization.chat&&console.log("Obsolete: The 'chat' parameter of the 'customization' section is deprecated. Please use 'chat' parameter in the permissions instead."),this.appOptions.canRename=this.editorConfig.canRename,this.appOptions.buildVersion=t.asc_getBuildVersion(),this.appOptions.trialMode=t.asc_getLicenseMode(),this.appOptions.isBeta=t.asc_getIsBeta(),this.appOptions.canModifyFilter=!1!==this.permissions.modifyFilter,this.appOptions.canBrandingExt=t.asc_getCanBranding()&&("object"==_typeof(this.editorConfig.customization)||this.editorConfig.plugins),Common.UI.LayoutManager.init(this.editorConfig.customization?this.editorConfig.customization.layout:null,this.appOptions.canBrandingExt,this.api),this.editorConfig.customization&&Common.UI.FeaturesManager.init(this.editorConfig.customization.features,this.appOptions.canBrandingExt),Common.UI.TabStyler.init(this.editorConfig.customization),this.appOptions.canBranding=t.asc_getCustomization(),this.appOptions.canBranding&&this.headerView.setBranding(this.editorConfig.customization,this.appOptions),this.appOptions.canFavorite=this.appOptions.spreadsheet.info&&void 0!==this.appOptions.spreadsheet.info.favorite&&null!==this.appOptions.spreadsheet.info.favorite,this.appOptions.canFavorite&&this.headerView&&this.headerView.setFavorite(this.appOptions.spreadsheet.info.favorite),this.appOptions.canRename&&this.headerView.setCanRename(!0),this.appOptions.canUseReviewPermissions=this.appOptions.canLicense&&(!!this.permissions.reviewGroups||this.appOptions.canLicense&&this.editorConfig.customization&&this.editorConfig.customization.reviewPermissions&&"object"==_typeof(this.editorConfig.customization.reviewPermissions)),this.appOptions.canUseCommentPermissions=this.appOptions.canLicense&&!!this.permissions.commentGroups,this.appOptions.canUseUserInfoPermissions=this.appOptions.canLicense&&!!this.permissions.userInfoGroups,AscCommon.UserInfoParser.setParser(!0),AscCommon.UserInfoParser.setCurrentName(this.appOptions.user.fullname),this.appOptions.canUseReviewPermissions&&AscCommon.UserInfoParser.setReviewPermissions(this.permissions.reviewGroups,this.editorConfig.customization.reviewPermissions),this.appOptions.canUseCommentPermissions&&AscCommon.UserInfoParser.setCommentPermissions(this.permissions.commentGroups),this.appOptions.canUseUserInfoPermissions&&AscCommon.UserInfoParser.setUserInfoPermissions(this.permissions.userInfoGroups),this.headerView.setUserName(AscCommon.UserInfoParser.getParsedName(AscCommon.UserInfoParser.getCurrentName())),this.headerView.setUserId(this.appOptions.user.id),this.headerView.setUserAvatar(this.appOptions.user.image)}else this.appOptions.canModifyFilter=!0;this.appOptions.canRequestEditRights=this.editorConfig.canRequestEditRights,this.appOptions.canEdit=!1!==this.permissions.edit&&(this.editorConfig.canRequestEditRights||"view"!==this.editorConfig.mode),this.appOptions.isEdit=(this.appOptions.canLicense||this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle)&&!1!==this.permissions.edit&&"view"!==this.editorConfig.mode,this.appOptions.canDownload=!1!==this.permissions.download,this.appOptions.canPrint=!1!==this.permissions.print&&!(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle),this.appOptions.canQuickPrint=this.appOptions.canPrint&&!Common.Utils.isMac&&this.appOptions.isDesktopApp,this.appOptions.canForcesave=this.appOptions.isEdit&&!this.appOptions.isOffline&&!(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle)&&"object"==_typeof(this.editorConfig.customization)&&!!this.editorConfig.customization.forcesave,this.appOptions.forcesave=this.appOptions.canForcesave,this.appOptions.canEditComments=this.appOptions.isOffline||!this.permissions.editCommentAuthorOnly,this.appOptions.canDeleteComments=this.appOptions.isOffline||!this.permissions.deleteCommentAuthorOnly,"object"==_typeof(this.editorConfig.customization)&&!0===this.editorConfig.customization.commentAuthorOnly&&(console.log("Obsolete: The 'commentAuthorOnly' parameter of the 'customization' section is deprecated. Please use 'editCommentAuthorOnly' and 'deleteCommentAuthorOnly' parameters in the permissions instead."),void 0===this.permissions.editCommentAuthorOnly&&void 0===this.permissions.deleteCommentAuthorOnly&&(this.appOptions.canEditComments=this.appOptions.canDeleteComments=this.appOptions.isOffline)),this.appOptions.isSignatureSupport=this.appOptions.isEdit&&this.appOptions.isDesktopApp&&this.appOptions.isOffline&&this.api.asc_isSignaturesSupport()&&!1!==this.permissions.protect&&!(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle),this.appOptions.isPasswordSupport=this.appOptions.isEdit&&this.api.asc_isProtectionSupport()&&!1!==this.permissions.protect&&!(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle),this.appOptions.canProtect=!1!==this.permissions.protect&&!(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle),this.appOptions.canHelp=!("object"==_typeof(this.editorConfig.customization)&&!1===this.editorConfig.customization.help),this.appOptions.isRestrictedEdit=!this.appOptions.isEdit&&this.appOptions.canComments,this.appOptions.canSaveToFile=this.appOptions.isEdit||this.appOptions.isRestrictedEdit,this.appOptions.showSaveButton=this.appOptions.isEdit,this.appOptions.compactHeader=this.appOptions.customization&&"object"==_typeof(this.appOptions.customization)&&!!this.appOptions.customization.compactHeader,this.appOptions.twoLevelHeader=this.appOptions.isEdit,this.appOptions.canLiveView=!!t.asc_getLiveViewerSupport()&&"view"===this.editorConfig.mode,this.appOptions.canChangeCoAuthoring=this.appOptions.isEdit&&!(this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle)&&this.appOptions.canCoAuthoring&&!(this.editorConfig.coEditing&&"object"==_typeof(this.editorConfig.coEditing)&&!1===this.editorConfig.coEditing.change)||this.appOptions.canLiveView&&!(this.editorConfig.coEditing&&"object"==_typeof(this.editorConfig.coEditing)&&!1===this.editorConfig.coEditing.change),this.appOptions.isAnonymousSupport=!!this.api.asc_isAnonymousSupport(),this.appOptions.isEditDiagram||this.appOptions.isEditMailMerge||this.appOptions.isEditOle||(this.getApplication().getController("Common.Controllers.Plugins").setMode(this.appOptions),Common.UI.ExternalUsers.init(this.appOptions.canRequestUsers,this.api),this.appOptions.user.image?Common.UI.ExternalUsers.setImage(this.appOptions.user.id,this.appOptions.user.image):Common.UI.ExternalUsers.get("info",this.appOptions.user.id)),this.appOptions.canUseHistory=this.appOptions.canLicense&&this.editorConfig.canUseHistory&&this.appOptions.canCoAuthoring&&!this.appOptions.isOffline,this.appOptions.canHistoryClose=this.editorConfig.canHistoryClose,this.appOptions.canHistoryRestore=this.editorConfig.canHistoryRestore,this.appOptions.isLightVersion&&(this.appOptions.canUseHistory=!1),this.loadCoAuthSettings(),this.applyModeCommonElements(),this.applyModeEditorElements(),this._isPermissionsInited=!0,this.appOptions.isEdit||(Common.NotificationCenter.trigger("app:face",this.appOptions),this.hidePreloader(),this.onLongActionBegin(Asc.c_oAscAsyncActionType.BlockInteraction,e)),this.api.asc_setViewMode(!this.appOptions.isEdit&&!this.appOptions.isRestrictedEdit),this.api.asc_setCanSendChanges(this.appOptions.canSaveToFile),this.appOptions.isRestrictedEdit&&this.appOptions.canComments&&this.api.asc_setRestriction(Asc.c_oAscRestrictionType.OnlyComments),this.api.asc_LoadDocument()},loadCoAuthSettings:function(){var t,e=!0,i=1;this.appOptions.isEdit&&!this.appOptions.isOffline&&this.appOptions.canCoAuthoring?(this.appOptions.canChangeCoAuthoring?null===(t=Common.localStorage.getItem("sse-settings-coauthmode"))&&null===(t=this.editorConfig.coEditing&&void 0!==this.editorConfig.coEditing.mode?"strict"===this.editorConfig.coEditing.mode?0:1:null)&&!Common.localStorage.itemExists("sse-settings-autosave")&&this.appOptions.customization&&!1===this.appOptions.customization.autosave&&(t=0):null===(t=this.editorConfig.coEditing&&void 0!==this.editorConfig.coEditing.mode?"strict"===this.editorConfig.coEditing.mode?0:1:null)&&this.appOptions.customization&&!1===this.appOptions.customization.autosave&&(t=0),e=null===t||1==parseInt(t)):!this.appOptions.isEdit&&this.appOptions.isRestrictedEdit?e=!0:this.appOptions.canLiveView&&!this.appOptions.isOffline?(t=Common.localStorage.getItem("sse-settings-view-coauthmode"),this.appOptions.canChangeCoAuthoring&&null!==t||(t=this.editorConfig.coEditing&&"strict"===this.editorConfig.coEditing.mode?0:1),e=1==parseInt(t)):(e=!1,i=0),this.appOptions.isEdit&&this.appOptions.canAutosave&&(null===(t=Common.localStorage.getItem("sse-settings-autosave"))&&this.appOptions.customization&&!1===this.appOptions.customization.autosave&&(t=0),i=e||null===t?this.appOptions.canCoAuthoring?1:0:parseInt(t)),Common.Utils.InternalSettings.set("sse-settings-coauthmode",e),Common.Utils.InternalSettings.set("sse-settings-autosave",i)},loadDefaultMetricSettings:function(){var t="";if(this.appOptions.location)console.log("Obsolete: The 'location' parameter of the 'editorConfig' section is deprecated. Please use 'region' parameter in the 'editorConfig' section instead."),t=this.appOptions.location;else if(this.appOptions.region){var e=this.appOptions.region;(e=Common.util.LanguageInfo.getLanguages().hasOwnProperty(e)?Common.util.LanguageInfo.getLocalLanguageName(e)[0]:e)&&"string"==typeof e&&(i=e.split(/[\-_]/)).length>1&&(t=i[i.length-1])}else{var i;(i=(this.appOptions.lang||"en").split(/[\-_]/)).length>1&&(t=i[i.length-1]),t||(i=(navigator.language||"").split(/[\-_]/)).length>1&&(t=i[i.length-1])}/^(ca|us)$/i.test(t)&&Common.Utils.Metric.setDefaultMetric(Common.Utils.Metric.c_MetricUnits.inch)},applyModeCommonElements:function(){window.editor_elements_prepared=!0;var t=this.getApplication(),e=t.getController("Viewport").getView("Viewport"),i=t.getController("Statusbar").getView("Statusbar");if(this.headerView&&this.headerView.setVisible(!(this.appOptions.isEditMailMerge||this.appOptions.isDesktopApp||this.appOptions.isEditDiagram||this.appOptions.isEditOle)),e&&e.setMode(this.appOptions,!0),i&&i.setMode(this.appOptions),t.getController("Toolbar").setMode(this.appOptions),t.getController("DocumentHolder").setMode(this.appOptions),e&&e.applyCommonMode(),(this.appOptions.isEditMailMerge||this.appOptions.isEditDiagram)&&i.hide(),(this.appOptions.isEditMailMerge||this.appOptions.isEditDiagram||this.appOptions.isEditOle)&&(t.getController("LeftMenu").getView("LeftMenu").hide(),$(window).mouseup((function(t){Common.Gateway.internalMessage("processMouse",{event:"mouse:up"})})).mousemove($.proxy((function(t){(this.isDiagramDrag||this.isDiagramResize)&&Common.Gateway.internalMessage("processMouse",{event:"mouse:move",pagex:t.pageX*Common.Utils.zoom(),pagey:t.pageY*Common.Utils.zoom()})}),this))),this.appOptions.isEditMailMerge||this.appOptions.isEditDiagram||this.appOptions.isEditOle)this.api.asc_registerCallback("asc_sendFromFrameToGeneralEditor",_.bind(this.onSendFromFrameToGeneralEditor,this)),this.appOptions.isEditOle&&this.api.asc_registerCallback("asc_onSendThemeColors",_.bind(this.onSendThemeColors,this));else{this.api.asc_registerCallback("asc_onSendThemeColors",_.bind(this.onSendThemeColors,this)),this.api.asc_registerCallback("asc_onDownloadUrl",_.bind(this.onDownloadUrl,this)),this.api.asc_registerCallback("asc_onDocumentModifiedChanged",_.bind(this.onDocumentModifiedChanged,this));var o=t.getController("Print");o&&this.api&&o.setApi(this.api).setMode(this.appOptions)}var n=this.getApplication().getController("CellEditor");n&&n.setApi(this.api).setMode(this.appOptions);var s=this.getApplication().getController("FormulaDialog");s&&s.setMode(this.appOptions).setApi(this.api,!0)},applyModeEditorElements:function(i){var o=this.getApplication().getController("Common.Controllers.Comments");o&&(o.setMode(this.appOptions),o.setConfig({config:this.editorConfig,sdkviewname:"#ws-canvas-outer",fullInfoHintMode:!0,hintmode:!0},this.api));var n=this,s=this.getApplication();s.getController("Common.Controllers.ReviewChanges").setMode(n.appOptions).setConfig({config:n.editorConfig},n.api).loadDocument({doc:n.appOptions.spreadsheet});var a=Common.localStorage.getItem("sse-settings-unit");void 0===(a=null!==a?parseInt(a):n.appOptions.customization&&n.appOptions.customization.unit?Common.Utils.Metric.c_MetricUnits[n.appOptions.customization.unit.toLocaleLowerCase()]:Common.Utils.Metric.getDefaultMetric())&&(a=Common.Utils.Metric.getDefaultMetric()),Common.Utils.Metric.setCurrentMetric(a),Common.Utils.InternalSettings.set("sse-settings-unit",a);var r=s.getController("Toolbar");if(r&&r.setApi(n.api),this.appOptions.isRestrictedEdit)s.getController("WBProtection").setMode(n.appOptions).setConfig({config:n.editorConfig},n.api);else if(this.appOptions.isEdit){var l=s.getController("Statusbar"),c=s.getController("RightMenu"),h=s.getController("Common.Controllers.Fonts");if(h&&h.setApi(n.api),c&&c.setApi(n.api),s.getController("Common.Controllers.Protection").setMode(n.appOptions).setConfig({config:n.editorConfig},n.api),s.getController("WBProtection").setMode(n.appOptions).setConfig({config:n.editorConfig},n.api),l&&(l.getView("Statusbar").changeViewMode(n.appOptions),n.appOptions.isEditOle&&l.onChangeViewMode(null,!0,!0)),n.appOptions.isEditMailMerge||n.appOptions.isEditDiagram||n.appOptions.isEditOle||!n.appOptions.canFeaturePivot||s.getController("PivotTable").setMode(n.appOptions),this.getApplication().getController("Viewport").getView("Viewport").applyEditorMode(),c.getView("RightMenu").setMode(n.appOptions).setApi(n.api),this.toolbarView=r.getView("Toolbar"),n.appOptions.isEditMailMerge||n.appOptions.isEditDiagram||n.appOptions.isEditOle)c.getView("RightMenu").hide();else{var d={};JSON.parse(Common.localStorage.getItem("sse-hidden-formula"))&&(d.formula=!0),s.getController("Toolbar").hideElements(d)}n.api.asc_registerCallback("asc_onCollaborativeChanges",_.bind(n.onCollaborativeChanges,n)),n.api.asc_registerCallback("asc_onAuthParticipantsChanged",_.bind(n.onAuthParticipantsChanged,n)),n.api.asc_registerCallback("asc_onParticipantsChanged",_.bind(n.onAuthParticipantsChanged,n)),n.api.asc_registerCallback("asc_onConnectionStateChanged",_.bind(n.onUserConnection,n)),n.api.asc_registerCallback("asc_onConvertEquationToMath",_.bind(n.onConvertEquationToMath,n)),n.appOptions.canSaveDocumentToBinary&&n.api.asc_registerCallback("asc_onSaveDocument",_.bind(n.onSaveDocumentBinary,n)),n.appOptions.isEditDiagram&&n.api.asc_registerCallback("asc_onSelectionChanged",_.bind(n.onSelectionChanged,n)),n.api.asc_setFilteringMode&&n.api.asc_setFilteringMode(n.appOptions.canModifyFilter),n.stackLongActions.exist({id:t,type:Asc.c_oAscAsyncActionType.BlockInteraction})?n.onLongActionEnd(Asc.c_oAscAsyncActionType.BlockInteraction,t):this._isDocReady||(Common.NotificationCenter.trigger("app:face",this.appOptions),n.hidePreloader(),n.onLongActionBegin(Asc.c_oAscAsyncActionType.BlockInteraction,e)),window.onbeforeunload=_.bind(n.onBeforeUnload,n),window.onunload=_.bind(n.onUnload,n)}this.appOptions.isEdit||(window.onbeforeunload=_.bind(n.onBeforeUnloadView,n))},onExternalMessage:function(t,e){t&&t.msg&&(t.msg=t.msg.toString(),this.showTips([t.msg.charAt(0).toUpperCase()+t.msg.substring(1)],e),Common.component.Analytics.trackEvent("External Error"))},onError:function(t,i,o,n){if(this.isFrameClosed)this.lastFrameError={id:t,level:i,errData:o,callback:n};else{switch(t){case Asc.c_oAscError.ID.LoadingScriptError:return this.showTips([this.scriptLoadError]),void(this.tooltip&&this.tooltip.getBSTip().$tip.css("z-index",1e4));case Asc.c_oAscError.ID.CanNotPasteImage:return void this.showTips([this.errorCannotPasteImg],{timeout:7e3,hideCloseTip:!0});case Asc.c_oAscError.ID.DocumentAndChangeMismatch:return void this.getApplication().getController("Common.Controllers.History").onHashError();case Asc.c_oAscError.ID.UpdateVersion:return void Common.UI.TooltipManager.showTip("updateVersion");case Asc.c_oAscError.ID.SessionIdle:return void Common.UI.TooltipManager.showTip("sessionIdle");case Asc.c_oAscError.ID.SessionToken:return void Common.UI.TooltipManager.showTip("sessionToken");case Asc.c_oAscError.ID.UserDrop:if(this._state.lostEditingRights)return void(this._state.lostEditingRights=!1);this._state.lostEditingRights=!0,Common.NotificationCenter.trigger("collaboration:sharingdeny");var s=this;return void Common.UI.TooltipManager.showTip({step:"userDrop",text:this.errorUserDrop,target:"#toolbar",maxwidth:600,showButton:!1,automove:!0,noHighlight:!0,multiple:!0,callback:function(){s._state.lostEditingRights=!1}})}this.hidePreloader(),this.onLongActionEnd(Asc.c_oAscAsyncActionType.BlockInteraction,e);var a={closable:!0};switch(t){case Asc.c_oAscError.ID.Unknown:a.msg=this.unknownErrorText;break;case Asc.c_oAscError.ID.ConvertationTimeout:a.msg=this.convertationTimeoutText;break;case Asc.c_oAscError.ID.ConvertationOpenError:a.msg=this.openErrorText;break;case Asc.c_oAscError.ID.ConvertationSaveError:a.msg=this.appOptions.isDesktopApp&&this.appOptions.isOffline?this.saveErrorTextDesktop:this.saveErrorText;break;case Asc.c_oAscError.ID.DownloadError:a.msg=this.downloadErrorText;break;case Asc.c_oAscError.ID.UplImageSize:a.msg=this.uploadImageSizeMessage;break;case Asc.c_oAscError.ID.UplImageExt:a.msg=this.uploadImageExtMessage;break;case Asc.c_oAscError.ID.UplImageFileCount:a.msg=this.uploadImageFileCountMessage;break;case Asc.c_oAscError.ID.PastInMergeAreaError:a.msg=this.pastInMergeAreaError;break;case Asc.c_oAscError.ID.FrmlWrongCountParentheses:a.msg=this.errorWrongBracketsCount;break;case Asc.c_oAscError.ID.FrmlWrongOperator:a.msg=this.errorWrongOperator;break;case Asc.c_oAscError.ID.FrmlWrongMaxArgument:a.msg=this.errorCountArgExceed;break;case Asc.c_oAscError.ID.FrmlWrongCountArgument:a.msg=this.errorCountArg;break;case Asc.c_oAscError.ID.FrmlWrongFunctionName:a.msg=this.errorFormulaName;break;case Asc.c_oAscError.ID.FrmlAnotherParsingError:a.msg=this.errorFormulaParsing;break;case Asc.c_oAscError.ID.FrmlWrongArgumentRange:a.msg=this.errorArgsRange;break;case Asc.c_oAscError.ID.FrmlOperandExpected:a.msg=this.errorOperandExpected;break;case Asc.c_oAscError.ID.FrmlWrongReferences:a.msg=this.errorFrmlWrongReferences;break;case Asc.c_oAscError.ID.UnexpectedGuid:a.msg=this.errorUnexpectedGuid;break;case Asc.c_oAscError.ID.Database:a.msg=this.errorDatabaseConnection;break;case Asc.c_oAscError.ID.FileRequest:a.msg=this.errorFileRequest;break;case Asc.c_oAscError.ID.FileVKey:a.msg=this.errorFileVKey;break;case Asc.c_oAscError.ID.StockChartError:a.msg=this.errorStockChart;break;case Asc.c_oAscError.ID.MaxDataSeriesError:a.msg=this.getApplication().getController("Toolbar").errorMaxRows;break;case Asc.c_oAscError.ID.ComboSeriesError:a.msg=this.getApplication().getController("Toolbar").errorComboSeries;break;case Asc.c_oAscError.ID.DataRangeError:a.msg=this.errorDataRange;break;case Asc.c_oAscError.ID.MaxDataPointsError:a.msg=this.errorMaxPoints;break;case Asc.c_oAscError.ID.VKeyEncrypt:a.msg=this.errorToken;break;case Asc.c_oAscError.ID.KeyExpire:a.msg=this.errorTokenExpire;break;case Asc.c_oAscError.ID.UserCountExceed:a.msg=this.errorUsersExceed;break;case Asc.c_oAscError.ID.CannotMoveRange:a.msg=this.errorMoveRange;break;case Asc.c_oAscError.ID.UplImageUrl:a.msg=this.errorBadImageUrl;break;case Asc.c_oAscError.ID.CoAuthoringDisconnect:a.msg=this.errorViewerDisconnect;break;case Asc.c_oAscError.ID.ConvertationPassword:a.msg=this.errorFilePassProtect;break;case Asc.c_oAscError.ID.AutoFilterDataRangeError:a.msg=this.errorAutoFilterDataRange;break;case Asc.c_oAscError.ID.AutoFilterChangeFormatTableError:a.msg=this.errorAutoFilterChangeFormatTable;break;case Asc.c_oAscError.ID.AutoFilterChangeError:a.msg=this.errorAutoFilterChange;break;case Asc.c_oAscError.ID.AutoFilterMoveToHiddenRangeError:a.msg=this.errorAutoFilterHiddenRange;break;case Asc.c_oAscError.ID.CannotFillRange:a.msg=this.errorFillRange;break;case Asc.c_oAscError.ID.InvalidReferenceOrName:a.msg=this.errorInvalidRef;break;case Asc.c_oAscError.ID.LockCreateDefName:a.msg=this.errorCreateDefName;break;case Asc.c_oAscError.ID.PasteMaxRangeError:a.msg=this.errorPasteMaxRange;break;case Asc.c_oAscError.ID.LockedAllError:a.msg=this.errorLockedAll;break;case Asc.c_oAscError.ID.Warning:a.msg=this.errorConnectToServer,a.closable=!1;break;case Asc.c_oAscError.ID.LockedWorksheetRename:a.msg=this.errorLockedWorksheetRename;break;case Asc.c_oAscError.ID.OpenWarning:a.msg=this.errorOpenWarning;break;case Asc.c_oAscError.ID.CopyMultiselectAreaError:a.msg=this.errorCopyMultiselectArea;break;case Asc.c_oAscError.ID.PrintMaxPagesCount:a.msg=this.errorPrintMaxPagesCount;break;case Asc.c_oAscError.ID.SessionAbsolute:a.msg=this.errorSessionAbsolute;break;case Asc.c_oAscError.ID.AccessDeny:a.msg=this.errorAccessDeny;break;case Asc.c_oAscError.ID.LockedCellPivot:a.msg=this.errorLockedCellPivot;break;case Asc.c_oAscError.ID.PivotLabledColumns:a.msg=this.errorLabledColumnsPivot;break;case Asc.c_oAscError.ID.PivotOverlap:a.msg=this.errorPivotOverlap;break;case Asc.c_oAscError.ID.PivotFieldNameExists:a.msg=this.errorPivotFieldNameExists;break;case Asc.c_oAscError.ID.FormulaInPivotFieldName:a.msg=this.errorFormulaInPivotFieldName;break;case Asc.c_oAscError.ID.PasteInPivot:a.msg=this.errorPasteInPivot;break;case Asc.c_oAscError.ID.ForceSaveButton:case Asc.c_oAscError.ID.ForceSaveTimeout:a.msg=this.errorForceSave,a.maxwidth=600;break;case Asc.c_oAscError.ID.DataEncrypted:a.msg=this.errorDataEncrypted;break;case Asc.c_oAscError.ID.EditingError:a.msg=this.appOptions.isDesktopApp&&this.appOptions.isOffline?this.errorEditingSaveas:this.errorEditingDownloadas;break;case Asc.c_oAscError.ID.CannotChangeFormulaArray:a.msg=this.errorChangeArray;break;case Asc.c_oAscError.ID.MultiCellsInTablesFormulaArray:a.msg=this.errorMultiCellFormula;break;case Asc.c_oAscError.ID.MailToClientMissing:a.msg=this.errorEmailClient;break;case Asc.c_oAscError.ID.NoDataToParse:a.msg=this.errorNoDataToParse;break;case Asc.c_oAscError.ID.CannotUngroupError:a.msg=this.errorCannotUngroup;break;case Asc.c_oAscError.ID.FrmlMaxTextLength:a.msg=this.errorFrmlMaxTextLength;break;case Asc.c_oAscError.ID.FrmlMaxReference:a.msg=this.errorFrmlMaxReference;break;case Asc.c_oAscError.ID.DataValidate:var r=o?o.asc_getErrorStyle():void 0;void 0!==r&&(a.iconCls=r==Asc.c_oAscEDataValidationErrorStyle.Stop?"error":r==Asc.c_oAscEDataValidationErrorStyle.Information?"info":"warn"),o&&o.asc_getErrorTitle()&&(a.title=Common.Utils.String.htmlEncode(o.asc_getErrorTitle())),a.buttons=["ok","cancel"],a.msg=o&&o.asc_getError()?Common.Utils.String.htmlEncode(o.asc_getError()):this.errorDataValidate,a.maxwidth=600;break;case Asc.c_oAscError.ID.ConvertationOpenLimitError:a.msg=this.errorFileSizeExceed;break;case Asc.c_oAscError.ID.FTChangeTableRangeError:a.msg=this.errorFTChangeTableRangeError;break;case Asc.c_oAscError.ID.FTRangeIncludedOtherTables:a.msg=this.errorFTRangeIncludedOtherTables;break;case Asc.c_oAscError.ID.PasteSlicerError:a.msg=this.errorPasteSlicerError;break;case Asc.c_oAscError.ID.RemoveDuplicates:a.iconCls="info",a.title=Common.UI.Window.prototype.textInformation,a.buttons=["ok"],a.msg=null!==o.asc_getDuplicateValues()&&null!==o.asc_getUniqueValues()?Common.Utils.String.format(this.errRemDuplicates,o.asc_getDuplicateValues(),o.asc_getUniqueValues()):this.errNoDuplicates,a.maxwidth=600;break;case Asc.c_oAscError.ID.FrmlMaxLength:a.msg=this.errorFrmlMaxLength,a.maxwidth=600;break;case Asc.c_oAscError.ID.MoveSlicerError:a.msg=this.errorMoveSlicerError;break;case Asc.c_oAscError.ID.LockedEditView:a.msg=this.errorEditView;break;case Asc.c_oAscError.ID.ChangeFilteredRangeError:a.msg=this.errorChangeFilteredRange;break;case Asc.c_oAscError.ID.Password:a.msg=this.errorSetPassword;break;case Asc.c_oAscError.ID.PivotGroup:a.msg=this.errorPivotGroup;break;case Asc.c_oAscError.ID.PasteMultiSelectError:a.msg=this.errorPasteMultiSelect;break;case Asc.c_oAscError.ID.PivotWithoutUnderlyingData:a.msg=this.errorPivotWithoutUnderlying;break;case Asc.c_oAscError.ID.ChangeOnProtectedSheet:a.msg=this.errorChangeOnProtectedSheet;break;case Asc.c_oAscError.ID.SingleColumnOrRowError:a.msg=this.errorSingleColumnOrRowError;break;case Asc.c_oAscError.ID.LocationOrDataRangeError:a.msg=this.errorLocationOrDataRangeError;break;case Asc.c_oAscError.ID.PasswordIsNotCorrect:a.msg=this.errorPasswordIsNotCorrect;break;case Asc.c_oAscError.ID.UplDocumentSize:a.msg=this.uploadDocSizeMessage;break;case Asc.c_oAscError.ID.DeleteColumnContainsLockedCell:a.msg=this.errorDeleteColumnContainsLockedCell;break;case Asc.c_oAscError.ID.UplDocumentExt:a.msg=this.uploadDocExtMessage;break;case Asc.c_oAscError.ID.DeleteRowContainsLockedCell:a.msg=this.errorDeleteRowContainsLockedCell;break;case Asc.c_oAscError.ID.UplDocumentFileCount:a.msg=this.uploadDocFileCountMessage;break;case Asc.c_oAscError.ID.LoadingFontError:a.msg=this.errorLoadingFont;break;case Asc.c_oAscError.ID.FillAllRowsWarning:var l,c=o[0],h=o[1],d=(this.appOptions.lang||"en").replace("_","-").toLowerCase();try{l=c.toLocaleString(d)}catch(t){d="en",l=c.toLocaleString(d)}this.appOptions.isDesktopApp&&this.appOptions.isOffline?(a.msg=c>h?Common.Utils.String.format(this.textFormulaFilledAllRowsWithEmpty,l):Common.Utils.String.format(this.textFormulaFilledAllRows,l),a.buttons=[{caption:this.textFillOtherRows,primary:!0,value:"fillOther"},"close"]):(a.msg=c>=h?Common.Utils.String.format(this.textFormulaFilledFirstRowsOtherIsEmpty,l):Common.Utils.String.format(this.textFormulaFilledFirstRowsOtherHaveData,l,(h-c).toLocaleString(d)),a.buttons=["ok"]),a.maxwidth=400;break;case Asc.c_oAscError.ID.CannotUseCommandProtectedSheet:a.msg=this.errorCannotUseCommandProtectedSheet;break;case Asc.c_oAscError.ID.DirectUrl:a.msg=this.errorDirectUrl;break;case Asc.c_oAscError.ID.ConvertationOpenFormat:a.maxwidth=600,Common.Utils.InternalSettings.get("import-xml-start")?a.msg=this.errorConvertXml:a.msg="pdf"===o?this.errorInconsistentExtPdf.replace("%1",this.appOptions.spreadsheet.fileType||""):"docx"===o?this.errorInconsistentExtDocx.replace("%1",this.appOptions.spreadsheet.fileType||""):"xlsx"===o?this.errorInconsistentExtXlsx.replace("%1",this.appOptions.spreadsheet.fileType||""):"pptx"===o?this.errorInconsistentExtPptx.replace("%1",this.appOptions.spreadsheet.fileType||""):this.errorInconsistentExt;break;case Asc.c_oAscError.ID.ProtectedRangeByOtherUser:a.msg=this.errorProtectedRange;break;case Asc.c_oAscError.ID.TraceDependentsNoFormulas:a.msg=this.errorDependentsNoFormulas;break;case Asc.c_oAscError.ID.TracePrecedentsNoValidReference:a.msg=this.errorPrecedentsNoValidRef,a.maxwidth=600;break;case Asc.c_oAscError.ID.LockedCellGoalSeek:a.msg=this.errorLockedCellGoalSeek;break;case Asc.c_oAscError.ID.CircularReference:a.msg=this.errorCircularReference,a.maxwidth=600;break;case Asc.c_oAscError.ID.CannotSaveWatermark:a.maxwidth=600,a.msg=this.errorSaveWatermark;break;case Asc.c_oAscError.ID.CalculatedItemInPageField:a.msg=this.errorCalculatedItemInPageField;break;case Asc.c_oAscError.ID.NotUniqueFieldWithCalculated:a.msg=this.errorNotUniqueFieldWithCalculated;break;default:a.msg="string"==typeof t?t:this.errorDefaultMessage.replace("%1",t)}i==Asc.c_oAscError.Level.Critical?(Common.Gateway.reportError(t,a.msg),a.title=this.criticalErrorTitle,a.iconCls="error",a.closable=!1,this.appOptions.canRequestClose?(a.msg+="<br><br>"+this.criticalErrorExtTextClose,a.callback=function(t){"ok"==t&&(Common.Gateway.requestClose(),Common.Controllers.Desktop.requestClose())}):this.appOptions.canBackToFolder&&!this.appOptions.isDesktopApp&&"string"!=typeof t&&this.appOptions.customization.goback.url&&!1===this.appOptions.customization.goback.blank&&(a.msg+="<br><br>"+this.criticalErrorExtText,a.callback=function(t){"ok"==t&&Common.NotificationCenter.trigger("goback",!0)}),t!=Asc.c_oAscError.ID.DataEncrypted&&t!=Asc.c_oAscError.ID.ConvertationOpenLimitError||(this.api.asc_coAuthoringDisconnect(),Common.NotificationCenter.trigger("api:disconnect"))):(Common.Gateway.reportWarning(t,a.msg),a.title=a.title||this.notcriticalErrorTitle,a.iconCls=a.iconCls||"warn",a.buttons=a.buttons||["ok"],a.callback=_.bind((function(e){t==Asc.c_oAscError.ID.Warning&&"ok"==e&&this.appOptions.canDownload?(Common.UI.Menu.Manager.hideAll(),this.appOptions.isDesktopApp&&this.appOptions.isOffline?this.api.asc_DownloadAs():this._isDocReady?this.getApplication().getController("LeftMenu").leftMenu.showMenu("file:saveas"):this._needToSaveAsFile=!0):t==Asc.c_oAscError.ID.EditingError?(this.disableEditing(!0),Common.NotificationCenter.trigger("api:disconnect",!0)):t==Asc.c_oAscError.ID.DataValidate&&"ok"!==e?this.api.asc_closeCellEditor(!0):t==Asc.c_oAscError.ID.FillAllRowsWarning&&"fillOther"===e&&_.isFunction(n)&&n(),this.onEditComplete()}),this)),(!Common.Utils.ModalWindow.isVisible()||$(".asc-window.modal.alert[data-value="+t+"]").length<1)&&setTimeout((function(){Common.UI.alert(a).$window.attr("data-value",t)}),1),void 0!==t&&Common.component.Analytics.trackEvent("Internal Error",t.toString())}},onCoAuthoringDisconnect:function(){this.getApplication().getController("Viewport").getView("Viewport").setMode({isDisconnected:!0}),this.getApplication().getController("Viewport").getView("Common.Views.Header").setCanRename(!1),this.appOptions.canRename=!1,this._state.isDisconnected=!0},showTips:function(t,e){var i=this;function o(t){i.tipTimeout&&clearTimeout(i.tipTimeout),setTimeout(n,300)}function n(){var n=t.shift();n&&(e&&e.hideCloseTip||(n+="\n"+i.textCloseTip),i.tooltip.setTitle(n),i.tooltip.show(),i.tipTimeout&&clearTimeout(i.tipTimeout),e&&e.timeout&&(i.tipTimeout=setTimeout((function(){i.tooltip.hide(),o()}),e.timeout)))}t.length&&("object"!=_typeof(t)&&(t=[t]),this.tooltip||(this.tooltip=new Common.UI.Tooltip({owner:this.getApplication().getController("Toolbar").getView("Toolbar"),hideonclick:!0,placement:"bottom",cls:"main-info",offset:30}),this.tooltip.on("tooltip:hideonclick",o)),n())},updateWindowTitle:function(t,e){if(this._state.isDocModified!==t||e){if(this.headerView){var i=this.defaultTitleText;if(_.isEmpty(this.headerView.getDocumentCaption())||(i=this.headerView.getDocumentCaption()+" - "+i),t)clearTimeout(this._state.timerCaption),_.isUndefined(i)||(i="* "+i,this.headerView.setDocumentCaption(this.headerView.getDocumentCaption(),!0));else if(this._state.fastCoauth&&this._state.usersCount>1){var o=this;this._state.timerCaption=setTimeout((function(){o.headerView.setDocumentCaption(o.headerView.getDocumentCaption(),!1)}),500)}else this.headerView.setDocumentCaption(this.headerView.getDocumentCaption(),!1);window.document.title!=i&&(window.document.title=i)}this._isDocReady&&this._state.isDocModified!==t&&Common.Gateway.setDocumentModified(t),t&&(!this._state.fastCoauth||this._state.usersCount<2)&&this.getApplication().getController("Statusbar").setStatusCaption("",!0),this._state.isDocModified=t}},onDocumentChanged:function(){},onDocumentModifiedChanged:function(t){this.updateWindowTitle(t),this._state.isDocModified!==t&&this._isDocReady&&Common.Gateway.setDocumentModified(t),this.api&&this.disableSaveButton(this.api.asc_isDocumentCanSave())},onDocumentCanSaveChanged:function(t){this.disableSaveButton(t)},disableSaveButton:function(t){if(this.toolbarView&&this.toolbarView.btnCollabChanges){var e=this.appOptions.forcesave||this.appOptions.canSaveDocumentToBinary,i=!!this.toolbarView.btnCollabChanges.rendered&&this.toolbarView.btnCollabChanges.cmpEl.hasClass("notify"),o=!t&&!i&&!e||this._state.isDisconnected||this._state.fastCoauth&&this._state.usersCount>1&&!e;this.toolbarView.lockToolbar(Common.enumLock.cantSave,o,{array:[this.toolbarView.btnSave]})}},onBeforeUnload:function(){if(Common.localStorage.save(),!1!==this.permissions.edit&&"view"!==this.editorConfig.mode&&"editdiagram"!==this.editorConfig.mode&&"editmerge"!==this.editorConfig.mode&&"editole"!==this.editorConfig.mode&&this.api.asc_isDocumentModified()){var t=this;return this.api.asc_stopSaving(),this._state.unloadTimer=1e3,this.continueSavingTimer=window.setTimeout((function(){t.api.asc_continueSaving(),t._state.unloadTimer=0}),500),this.leavePageText}this._state.unloadTimer=1e4},onUnload:function(){this.continueSavingTimer&&clearTimeout(this.continueSavingTimer)},onBeforeUnloadView:function(){Common.localStorage.save(),this._state.unloadTimer=1e4},hidePreloader:function(){var t;this._state.customizationDone||(this._state.customizationDone=!0,this.appOptions.customization&&(this.appOptions.isDesktopApp?this.appOptions.customization.about=!1:this.appOptions.canBrandingExt||(this.appOptions.customization.about=!0)),Common.Utils.applyCustomization(this.appOptions.customization,i),this.appOptions.canBrandingExt&&(Common.Utils.applyCustomization(this.appOptions.customization,o),Common.UI.LayoutManager.applyCustomization(),this.appOptions.customization&&"object"==_typeof(this.appOptions.customization)&&(void 0!==this.appOptions.customization.leftMenu&&console.log("Obsolete: The 'leftMenu' parameter of the 'customization' section is deprecated. Please use 'leftMenu' parameter in the 'customization.layout' section instead."),void 0!==this.appOptions.customization.rightMenu&&console.log("Obsolete: The 'rightMenu' parameter of the 'customization' section is deprecated. Please use 'rightMenu' parameter in the 'customization.layout' section instead."),void 0!==this.appOptions.customization.statusBar&&console.log("Obsolete: The 'statusBar' parameter of the 'customization' section is deprecated. Please use 'statusBar' parameter in the 'customization.layout' section instead."),void 0!==this.appOptions.customization.toolbar&&console.log("Obsolete: The 'toolbar' parameter of the 'customization' section is deprecated. Please use 'toolbar' parameter in the 'customization.layout' section instead.")),t=this.getApplication().getController("Common.Controllers.Plugins").applyUICustomization())),this.stackLongActions.pop({id:-254,type:Asc.c_oAscAsyncActionType.BlockInteraction}),Common.NotificationCenter.trigger("layout:changed","main"),(t||new Promise((function(t,e){t()}))).then((function(){$("#loading-mask").hide().remove(),Common.Controllers.Desktop.process("preloader:hide")}))},onDownloadUrl:function(t,e){this._state.isFromGatewayDownloadAs&&Common.Gateway.downloadAs(t,e),this._state.isFromGatewayDownloadAs=!1},onDownloadCancel:function(){this._state.isFromGatewayDownloadAs=!1},onUpdateVersion:function(t){console.log("Obsolete: The 'onOutdatedVersion' event is deprecated. Please use 'onRequestRefreshFile' event and 'refreshFile' method instead.");var i=this;i.needToUpdateVersion=!0,i.onLongActionEnd(Asc.c_oAscAsyncActionType.BlockInteraction,e),Common.UI.TooltipManager.showTip({step:"updateVersionReload",text:this.errorUpdateVersion,header:this.titleUpdateVersion,target:"#toolbar",maxwidth:"none",closable:!1,automove:!0,noHighlight:!0,callback:function(){_.defer((function(){Common.Gateway.updateVersion(),t&&t.call(i),i.editorConfig&&i.editorConfig.canUpdateVersion&&i.onLongActionBegin(Asc.c_oAscAsyncActionType.BlockInteraction,e)}))}}),this.disableEditing(!0,"not-loaded"),Common.NotificationCenter.trigger("api:disconnect")},onServerVersion:function(t){if(this.changeServerVersion)return!0;var e=this.getApplication().getController("LeftMenu").leftMenu.getMenu("about").txtVersionNum.match(/^(\d+.\d+.\d+)/);return!(window.compareVersions||e&&e[1]===t||(this.changeServerVersion=!0,Common.UI.warning({title:this.titleServerVersion,msg:this.errorServerVersion,callback:function(){_.defer((function(){Common.Gateway.updateVersion()}))}}),this._isDocReady&&(this.disableEditing(!0),Common.NotificationCenter.trigger("api:disconnect")),0))},onAdvancedOptions:function(t,i,o,n){if(!this._state.openDlg){var s=this;t==Asc.c_oAscAdvancedOptionsID.CSV?s._state.openDlg=new Common.Views.OpenDialog({title:Common.Views.OpenDialog.prototype.txtTitle.replace("%1","CSV"),closable:2==o,type:Common.Utils.importTextType.CSV,preview:i.asc_getData(),codepages:i.asc_getCodePages(),settings:i.asc_getRecommendedSettings(),api:s.api,handler:function(e,i){s.isShowOpenDialog=!1,"ok"==e&&s&&s.api&&(2==o?(n&&n.asc_setAdvancedOptions(i.textOptions),s.api.asc_DownloadAs(n)):s.api.asc_setAdvancedOptions(t,i.textOptions),s.loadMask&&s.loadMask.show()),s._state.openDlg=null}}):t==Asc.c_oAscAdvancedOptionsID.DRM&&(s._state.openDlg=new Common.Views.OpenDialog({title:Common.Views.OpenDialog.prototype.txtTitleProtected,closeFile:s.appOptions.canRequestClose,type:Common.Utils.importTextType.DRM,warning:!(s.appOptions.isDesktopApp&&s.appOptions.isOffline)&&"string"==typeof i,warningMsg:i,validatePwd:!!s._state.isDRM,handler:function(e,i){s.isShowOpenDialog=!1,"ok"==e?s&&s.api&&(s.api.asc_setAdvancedOptions(t,i.drmOptions),s.loadMask&&s.loadMask.show()):(Common.Gateway.requestClose(),Common.Controllers.Desktop.requestClose()),s._state.openDlg=null}}),s._state.isDRM=!0),s._state.openDlg&&(this.isShowOpenDialog=!0,this.loadMask&&this.loadMask.hide(),this.onLongActionEnd(Asc.c_oAscAsyncActionType.BlockInteraction,e),s._state.openDlg.show()),s._state.requireUserAction&&(Common.Gateway.userActionRequired(),s._state.requireUserAction=!1)}},onActiveSheetChanged:function(t){this.appOptions.isEditMailMerge||this.appOptions.isEditDiagram||!window.editor_elements_prepared||(this.application.getController("Statusbar").selectTab(t),this.appOptions.isEditOle||!this.appOptions.canViewComments||this.dontCloseDummyComment||Common.NotificationCenter.trigger("comments:updatefilter",["doc","sheet"+this.api.asc_getWorksheetId(t)],!1))},onConfirmAction:function(t,e,i){var o=this;switch(t){case Asc.c_oAscConfirm.ConfirmReplaceRange:case Asc.c_oAscConfirm.ConfirmReplaceFormulaInTable:Common.UI.warning({title:this.notcriticalErrorTitle,msg:t==Asc.c_oAscConfirm.ConfirmReplaceRange?this.confirmMoveCellRange:this.confirmReplaceFormulaInTable,buttons:["yes","no"],primary:"yes",callback:_.bind((function(t){e&&e("yes"===t),"yes"==t&&o.onEditComplete(o.application.getController("DocumentHolder").getView("DocumentHolder"))}),this)});break;case Asc.c_oAscConfirm.ConfirmPutMergeRange:Common.UI.warning({closable:!1,title:this.notcriticalErrorTitle,msg:this.confirmPutMergeRange,buttons:["ok"],primary:"ok",callback:_.bind((function(t){e&&e(),o.onEditComplete(o.application.getController("DocumentHolder").getView("DocumentHolder"))}),this)});break;case Asc.c_oAscConfirm.ConfirmChangeProtectRange:new Common.Views.OpenDialog({title:this.txtUnlockRange,closable:!0,type:Common.Utils.importTextType.DRM,warning:!0,warningMsg:this.txtUnlockRangeWarning,txtOpenFile:this.txtUnlockRangeDescription,validatePwd:!1,handler:function(t,n){o.api&&e&&("ok"==t?o.api.asc_checkProtectedRangesPassword(n.drmOptions.asc_getPassword(),i,(function(t){e(t,!1)})):e(!1,!0)),o.onEditComplete(o.application.getController("DocumentHolder").getView("DocumentHolder"))}}).show();break;case Asc.c_oAscConfirm.ConfirmAddCellWatches:Common.UI.warning({title:this.notcriticalErrorTitle,msg:i>Asc.c_nAscMaxAddCellWatchesCount?Common.Utils.String.format(this.confirmAddCellWatchesMax,Asc.c_nAscMaxAddCellWatchesCount):Common.Utils.String.format(this.confirmAddCellWatches,i),buttons:["yes","no"],primary:"yes",callback:_.bind((function(t){e&&e("yes"===t)}),this)});break;case Asc.c_oAscConfirm.ConfirmMaxChangesSize:Common.UI.warning({title:this.notcriticalErrorTitle,msg:this.confirmMaxChangesSize,buttons:[{value:"ok",caption:this.textUndo,primary:!0},{value:"cancel",caption:this.textContinue}],maxwidth:600,callback:_.bind((function(t){e&&e("ok"===t),o.onEditComplete(o.application.getController("DocumentHolder").getView("DocumentHolder"))}),this)});break;case Asc.c_oAscConfirm.ConfirmReplaceHeaderFooterPicture:Common.UI.warning({title:this.notcriticalErrorTitle,msg:this.confirmReplaceHFPicture,buttons:[{value:"ok",caption:this.textReplace,primary:!0},{value:"cancel",caption:this.textKeep}],maxwidth:600,callback:_.bind((function(t){e&&e("ok"===t)}),this)})}},checkProtectedRange:function(t,e,i){var o=!(!this.api.asc_isProtectedSheet()||!this.api.asc_checkLockedCells())&&this.api.asc_checkProtectedRange();if(null!==o)if(o){var n=this,s=new Common.Views.OpenDialog({title:this.txtUnlockRange,closable:!0,type:Common.Utils.importTextType.DRM,warning:!0,warningMsg:this.txtUnlockRangeWarning,txtOpenFile:this.txtUnlockRangeDescription,validatePwd:!1,handler:function(o,s){"ok"==o&&n.api&&n.api.asc_checkActiveCellPassword(s.drmOptions.asc_getPassword(),(function(o){o?t&&setTimeout((function(){t.apply(e,i)}),1):Common.UI.warning({msg:n.errorWrongPassword,callback:function(){Common.NotificationCenter.trigger("edit:complete",n.toolbar)}})})),Common.NotificationCenter.trigger("edit:complete",n.toolbar)}});s.show()}else t&&setTimeout((function(){t.apply(e,i)}),1);else this.onError(Asc.c_oAscError.ID.ChangeOnProtectedSheet,Asc.c_oAscError.Level.NoCritical)},initNames:function(){this.shapeGroupNames=[this.txtBasicShapes,this.txtFiguredArrows,this.txtMath,this.txtCharts,this.txtStarsRibbons,this.txtCallouts,this.txtButtons,this.txtRectangles,this.txtLines]},fillAutoShapes:function(t,e){if(!_.isEmpty(e)&&!_.isEmpty(t)&&e.length==t.length){var i=this,o=[],n=this.getCollection("ShapeGroups"),s={};n.reset(),_.each(t,(function(t,n){var a=new Backbone.Collection([],{model:SSE.Models.ShapeModel}),r=[],l=e[n].length>18?7:6,c=35*Math.ceil(e[n].length/l)+3,h=30*l;_.each(e[n],(function(t,e){var o=i["txtShape_"+t.Type];r.push({data:{shapeType:t.Type},tip:o||i.textShape+" "+(e+1),allowSelected:!0,selected:!1}),o&&(s[t.Type]=o)})),a.add(r),o.push({groupName:i.shapeGroupNames[n],groupStore:a,groupWidth:h,groupHeight:c})})),n.add(o),setTimeout((function(){i.getApplication().getController("Toolbar").onApiAutoShapes()}),50),this.api.asc_setShapeNames(s)}},fillTextArt:function(t){var e=[],i=this.getCollection("Common.Collections.TextArt");!t&&i.length>0&&(t=this.api.asc_getTextArtPreviews()),_.isEmpty(t)||(_.each(t,(function(t,i){e.push({imageUrl:t,data:i,allowSelected:!0,selected:!1})})),i.reset(e))},fillCondFormatIcons:function(t){if(!_.isEmpty(t)){var e=[],i=this.getCollection("ConditionalFormatIcons");_.each(t,(function(t,i){e.push({icon:t,index:i})})),i.reset(e)}},fillCondFormatIconsPresets:function(t){if(!_.isEmpty(t)){var e=[],i=this.getCollection("ConditionalFormatIconsPresets");_.each(t,(function(t,i){e.push({icons:t,data:i})})),i.reset(e)}},updateThemeColors:function(){var t=this;!t.appOptions.isEditOle&&setTimeout((function(){t.getApplication().getController("RightMenu").UpdateThemeColors()}),50),setTimeout((function(){t.getApplication().getController("Toolbar").updateThemeColors()}),50),setTimeout((function(){t.getApplication().getController("Statusbar").updateThemeColors()}),50)},onSendThemeColors:function(t,e){if(Common.Utils.ThemeColor.setColors(t,e),window.styles_loaded&&(this.appOptions.isEditMailMerge||this.appOptions.isEditDiagram||this.updateThemeColors(),!this.appOptions.isEditMailMerge&&!this.appOptions.isEditDiagram&&!this.appOptions.isEditOle)){var i=this;setTimeout((function(){i.fillTextArt()}),1)}},loadLanguages:function(t){this.languages=t,window.styles_loaded&&this.setLanguages()},setLanguages:function(){var t=Common.Controllers.Desktop.systemLangs()||{},e=[],i=this;for(var o in t)t.hasOwnProperty(o)&&e.push(o);t=e,e=[],t.forEach((function(t){var o=Common.util.LanguageInfo.getLocalLanguageCode(t);o&&(o=i.languages.indexOf(o.toString())<0?null:t),o||(o=(o=Common.util.LanguageInfo.getDefaultLanguageCode(t))&&i.languages.indexOf(o.toString())>-1?o:null)&&(o=Common.util.LanguageInfo.getLocalLanguageName(parseInt(o))[0]),o||(o=_.find(i.languages,(function(e){return 0===Common.util.LanguageInfo.getLocalLanguageName(parseInt(e))[0].indexOf(t.toLowerCase())})))&&(o=Common.util.LanguageInfo.getLocalLanguageName(parseInt(o))[0]),o&&e.push(o)})),t=_.uniq(e);var n="app-settings-recent-langs",s=Math.max(5,t.length+3);Common.Utils.InternalSettings.set(n+"-count",s),Common.Utils.InternalSettings.set(n+"-offset",t.length),e=(e=Common.localStorage.getItem(n))?e.split(";"):[],(e=_.union(t,e)).splice(s),Common.localStorage.setItem(n,e.join(";")),this.getApplication().getController("Spellcheck").setLanguages(this.languages)},onInternalCommand:function(t){if(t)switch(t.command){case"setChartData":this.setChartData(t.data);break;case"getChartData":this.getChartData();break;case"clearChartData":this.clearChartData();break;case"setMergeData":this.setMergeData(t.data);break;case"getMergeData":this.getMergeData();break;case"setOleData":this.setOleData(t.data);break;case"getOleData":this.getOleData();break;case"setAppDisabled":void 0!==this.isAppDisabled||t.data||(Common.NotificationCenter.trigger("layout:changed","main"),this.loadMask&&this.loadMask.isVisible()&&this.loadMask.updatePosition()),this.isAppDisabled=t.data;break;case"reshow":Common.NotificationCenter.trigger("external:reshow");break;case"queryClose":Common.Utils.ModalWindow.isVisible()?Common.Gateway.internalMessage("canClose",{answer:!1}):(this.isFrameClosed=!0,this.api.asc_closeCellEditor(),this.appOptions.isEditOle&&Common.NotificationCenter.trigger("oleedit:close"),Common.UI.Menu.Manager.hideAll(),Common.Gateway.internalMessage("canClose",{mr:t.data.mr,answer:!0}));break;case"window:drag":this.isDiagramDrag=t.data;break;case"window:resize":this.isDiagramResize=t.data;break;case"processmouse":this.onProcessMouse(t.data);break;case"theme:change":document.documentElement.className=document.documentElement.className.replace(/theme-\w+\s?/,t.data),this.api.asc_setSkin("theme-dark"==t.data?"flatDark":"flat");break;case"generalToFrameData":this.api.asc_getInformationBetweenFrameAndGeneralEditor(t.data);break;case"wopi:saveAsComplete":this.onExternalMessage({msg:this.txtSaveCopyAsComplete})}},setChartData:function(t){"object"===_typeof(t)&&this.api&&(this.api.asc_addChartDrawingObject(t),this.isFrameClosed=!1,this.lastFrameError&&(this.onError(this.lastFrameError.id,this.lastFrameError.level,this.lastFrameError.errData,this.lastFrameError.callback),this.lastFrameError=void 0))},getChartData:function(){if(this.api){var t=this.api.asc_getWordChartObject();"object"===_typeof(t)&&Common.Gateway.internalMessage("chartData",{data:t})}},clearChartData:function(){this.api&&this.api.asc_closeCellEditor()},setOleData:function(t){"object"!==_typeof(t)&&"empty"!==t||!this.api||(this.api.asc_addTableOleObjectInOleEditor("object"===_typeof(t)?t:void 0),this.isFrameClosed=!1,this.lastFrameError&&(this.onError(this.lastFrameError.id,this.lastFrameError.level,this.lastFrameError.errData,this.lastFrameError.callback),this.lastFrameError=void 0))},getOleData:function(){if(this.api){var t=this.api.asc_getBinaryInfoOleObject();"object"===_typeof(t)&&Common.Gateway.internalMessage("oleData",{data:t})}},onOleEditorReady:function(){Common.Gateway.internalMessage("oleEditorReady",{})},setMergeData:function(t){"object"===_typeof(t)&&this.api&&(this.api.asc_setData(t),this.isFrameClosed=!1,this.lastFrameError&&(this.onError(this.lastFrameError.id,this.lastFrameError.level,this.lastFrameError.errData,this.lastFrameError.callback),this.lastFrameError=void 0))},getMergeData:function(){if(this.api){var t=this.api.asc_getData();"object"===_typeof(t)&&Common.Gateway.internalMessage("mergeData",{data:t})}},onSendFromFrameToGeneralEditor:function(t){Common.Gateway.internalMessage("frameToGeneralData",t)},unitsChanged:function(t){var e=Common.localStorage.getItem("sse-settings-unit");e=null!==e?parseInt(e):Common.Utils.Metric.getDefaultMetric(),Common.Utils.Metric.setCurrentMetric(e),Common.Utils.InternalSettings.set("sse-settings-unit",e),this.appOptions.isEdit&&(this.getApplication().getController("RightMenu").updateMetricUnit(),this.getApplication().getController("Toolbar").getView("Toolbar").updateMetricUnit()),this.getApplication().getController("Print").getView("PrintWithPreview").updateMetricUnit()},_compareActionStrong:function(t,e){return t.id===e.id&&t.type===e.type},_compareActionWeak:function(t,e){return t.type===e.type},onContextMenu:function(t){var e=t.target.getAttribute("data-can-copy"),i=t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement;if(i&&"false"===e||!i&&"true"!==e)return t.stopPropagation(),t.preventDefault(),!1},onNamedRangeLocked:function(){$(".asc-window.modal.alert:visible").length<1&&Common.UI.alert({msg:this.errorCreateDefName,title:this.notcriticalErrorTitle,iconCls:"warn",buttons:["ok"],callback:_.bind((function(t){this.onEditComplete()}),this)})},onProtectedRangeLocked:function(){$(".asc-window.modal.alert:visible").length<1&&Common.UI.alert({msg:this.errorCreateRange,title:this.notcriticalErrorTitle,iconCls:"warn",buttons:["ok"],callback:_.bind((function(t){this.onEditComplete()}),this)})},onTryUndoInFastCollaborative:function(){var t=Common.localStorage.getItem("sse-hide-try-undoredo");t&&1==parseInt(t)||Common.UI.info({width:500,msg:this.appOptions.canChangeCoAuthoring?this.textTryUndoRedo:this.textTryUndoRedoWarn,iconCls:"info",buttons:this.appOptions.canChangeCoAuthoring?[{value:"custom",caption:this.textStrict},"cancel"]:["ok"],primary:this.appOptions.canChangeCoAuthoring?"custom":"ok",dontshow:!0,callback:_.bind((function(t,e){e&&Common.localStorage.setItem("sse-hide-try-undoredo",1),"custom"==t&&(Common.localStorage.setItem("sse-settings-coauthmode",0),this.api.asc_SetFastCollaborative(!1),Common.Utils.InternalSettings.set("sse-settings-coauthmode",!1),this.getApplication().getController("Common.Controllers.ReviewChanges").applySettings(),this._state.fastCoauth=!1),this.onEditComplete()}),this)})},onAuthParticipantsChanged:function(t){var e=0;_.each(t,(function(t){t.asc_getView()||e++})),this._state.usersCount=e,this._state.fastCoauth&&this._state.usersCount>1&&this.api.asc_getCanUndo()&&Common.UI.TooltipManager.showTip("fastUndo")},onUserConnection:function(t){if(t&&this.appOptions.user.guest&&this.appOptions.canRenameAnonymous&&t.asc_getIdOriginal()==this.appOptions.user.id){var e=t.asc_getUserName();if(e&&e!==AscCommon.UserInfoParser.getCurrentName()){this._renameDialog&&this._renameDialog.close(),AscCommon.UserInfoParser.setCurrentName(e),this.headerView.setUserName(AscCommon.UserInfoParser.getParsedName(e));var i=e.lastIndexOf("("),o=e.lastIndexOf(")"),n=i>0&&i<o?e.substring(0,i-1):"";null!==Common.localStorage.getItem("guest-username")&&Common.localStorage.setItem("guest-username",n),Common.Utils.InternalSettings.set("guest-username",n)}}},applySettings:function(){if(this.appOptions.isEdit&&!this.appOptions.isOffline&&this.appOptions.canCoAuthoring){var t=Common.localStorage.getItem("sse-settings-coauthmode"),e=this._state.fastCoauth;this._state.fastCoauth=null===t||1==parseInt(t),this._state.fastCoauth&&!e&&this.synchronizeChanges(),this._state.fastCoauth&&this._state.usersCount>1&&this.api.asc_getCanUndo()&&Common.UI.TooltipManager.showTip("fastUndo")}this.appOptions.canForcesave&&(this.appOptions.forcesave=Common.localStorage.getBool("sse-settings-forcesave",this.appOptions.canForcesave),Common.Utils.InternalSettings.set("sse-settings-forcesave",this.appOptions.forcesave),this.api.asc_setIsForceSaveOnUserSave(this.appOptions.forcesave))},onDocumentName:function(t){this.headerView.setDocumentCaption(t),this.updateWindowTitle(this.api.asc_isDocumentModified(),!0)},onMeta:function(t){var e=this.getApplication(),i=e.getController("LeftMenu").getView("LeftMenu").getMenu("file");if(e.getController("Viewport").getView("Common.Views.Header").setDocumentCaption(t.title),this.updateWindowTitle(this.api.asc_isDocumentModified(),!0),this.appOptions.spreadsheet.title=t.title,i.loadDocument({doc:this.appOptions.spreadsheet}),i.panels&&i.panels.info&&i.panels.info.updateInfo(this.appOptions.spreadsheet),e.getController("Common.Controllers.ReviewChanges").loadDocument({doc:this.appOptions.spreadsheet}),Common.Gateway.metaChange(t),this.appOptions.wopi){var o=t.title.lastIndexOf(".");Common.Gateway.requestRename(o>0?t.title.substring(0,o):t.title)}},onPrint:function(){this.appOptions.canPrint&&!Common.Utils.ModalWindow.isVisible()&&Common.NotificationCenter.trigger("file:print",this)},onPrintUrl:function(t){if(this.iframePrint&&(this.iframePrint.parentNode.removeChild(this.iframePrint),this.iframePrint=null),!this.iframePrint){var e=this;this.iframePrint=document.createElement("iframe"),this.iframePrint.id="id-print-frame",this.iframePrint.style.display="none",this.iframePrint.style.visibility="hidden",this.iframePrint.style.position="fixed",this.iframePrint.style.right="0",this.iframePrint.style.bottom="0",document.body.appendChild(this.iframePrint),this.iframePrint.onload=function(){try{e.iframePrint.contentWindow.focus(),e.iframePrint.contentWindow.print(),e.iframePrint.contentWindow.blur(),window.focus()}catch(i){var t=new Asc.asc_CDownloadOptions(Asc.c_oAscFileType.PDF);t.asc_setAdvancedOptions(e.getApplication().getController("Print").getPrintParams()),e.api.asc_DownloadAs(t)}}}t&&(this.iframePrint.src=t)},onPrintQuick:function(){if(this.appOptions.canQuickPrint){var t=Common.localStorage.getBool("sse-hide-quick-print-warning"),e=this,i=function(){var t=new Asc.asc_CAdjustPrint;t.asc_setNativeOptions({quickPrint:!0});var i=new Asc.asc_CDownloadOptions;i.asc_setAdvancedOptions(t),e.api.asc_Print(i),Common.component.Analytics.trackEvent("Print")};t?i.call(this):Common.UI.warning({msg:this.textTryQuickPrint,buttons:["yes","no"],primary:"yes",dontshow:!0,maxwidth:500,callback:function(t,e){e&&Common.localStorage.setBool("sse-hide-quick-print-warning",!0),"yes"===t&&setTimeout(i,1)}})}},warningDocumentIsLocked:function(){var t=this;Common.Utils.warningDocumentIsLocked({disablefunc:function(e){t.disableEditing(e,"reconnect")}})},onRunAutostartMacroses:function(){var t=this;if(!this.editorConfig.customization||!1!==this.editorConfig.customization.macros){var e=Common.Utils.InternalSettings.get("sse-macros-mode");1==e?this.api.asc_runAutostartMacroses():0===e&&Common.UI.warning({msg:this.textHasMacros+"<br>",buttons:["yes","no"],primary:"yes",dontshow:!0,textDontShow:this.textRemember,callback:function(e,i){i&&(Common.Utils.InternalSettings.set("sse-macros-mode","yes"==e?1:2),Common.localStorage.setItem("sse-macros-mode","yes"==e?1:2)),"yes"==e&&setTimeout((function(){t.api.asc_runAutostartMacroses()}),1)}})}},onMacrosPermissionRequest:function(t,e){if(t&&e){if(this.stackMacrosRequests.push({url:t,callback:e}),this.stackMacrosRequests.length>1)return}else{if(!(this.stackMacrosRequests.length>0))return;t=this.stackMacrosRequests[0].url,e=this.stackMacrosRequests[0].callback}var i=this,o=Common.Utils.InternalSettings.get("sse-allow-macros-request");o>0?(e&&e(1===o),this.stackMacrosRequests.shift(),this.onMacrosPermissionRequest()):Common.UI.warning({msg:this.textRequestMacros.replace("%1",t),buttons:["yes","no"],primary:"yes",dontshow:!0,textDontShow:this.textRememberMacros,maxwidth:600,callback:function(t,o){o&&(Common.Utils.InternalSettings.set("sse-allow-macros-request","yes"==t?1:2),Common.localStorage.setItem("sse-allow-macros-request","yes"==t?1:2)),setTimeout((function(){e&&e("yes"==t),i.stackMacrosRequests.shift(),i.onMacrosPermissionRequest()}),1)}})},loadAutoCorrectSettings:function(){var t=this,e=Common.localStorage.getItem("sse-settings-math-correct-add");Common.Utils.InternalSettings.set("sse-settings-math-correct-add",e);var i=e?JSON.parse(e):[];e=Common.localStorage.getItem("sse-settings-math-correct-rem"),Common.Utils.InternalSettings.set("sse-settings-math-correct-rem",e);var o=e?JSON.parse(e):[];e=Common.localStorage.getBool("sse-settings-math-correct-replace-type",!0),Common.Utils.InternalSettings.set("sse-settings-math-correct-replace-type",e),t.api.asc_refreshOnStartAutoCorrectMathSymbols(o,i,e),e=Common.localStorage.getItem("sse-settings-rec-functions-add"),Common.Utils.InternalSettings.set("sse-settings-rec-functions-add",e),i=e?JSON.parse(e):[],e=Common.localStorage.getItem("sse-settings-rec-functions-rem"),Common.Utils.InternalSettings.set("sse-settings-rec-functions-rem",e),o=e?JSON.parse(e):[],t.api.asc_refreshOnStartAutoCorrectMathFunctions(o,i),e=Common.localStorage.getBool("sse-settings-autoformat-new-rows",!0),Common.Utils.InternalSettings.set("sse-settings-autoformat-new-rows",e),t.api.asc_setIncludeNewRowColTable(e),e=Common.localStorage.getBool("sse-settings-autoformat-hyperlink",!0),Common.Utils.InternalSettings.set("sse-settings-autoformat-hyperlink",e),t.api.asc_SetAutoCorrectHyperlinks(e)},showRenameUserDialog:function(){if(!this._renameDialog){var t=this;this._renameDialog=new Common.Views.UserNameDialog({label:this.textRenameLabel,error:this.textRenameError,value:Common.Utils.InternalSettings.get("guest-username")||"",check:Common.Utils.InternalSettings.get("save-guest-username")||!1,validation:function(e){return e.length<128||t.textLongName},repaintcallback:function(){this.setPosition(Common.Utils.innerWidth()-this.options.width-15,30)},handler:function(e,i){if("ok"==e){var o=i.input?i.input+" ("+t.textGuest+")":t.textAnonymous,n=new Asc.asc_CUserInfo;n.put_FullName(o);var s=new Asc.asc_CDocInfo;s.put_UserInfo(n),t.api.asc_changeDocInfo(s),i.checkbox?Common.localStorage.setItem("guest-username",i.input):Common.localStorage.removeItem("guest-username"),Common.Utils.InternalSettings.set("guest-username",i.input),Common.Utils.InternalSettings.set("save-guest-username",i.checkbox)}}}),this._renameDialog.on("close",(function(){t._renameDialog=void 0})),this._renameDialog.show(Common.Utils.innerWidth()-this._renameDialog.options.width-15,30)}},onRefreshHistory:function(t){if(this.appOptions.canUseHistory)if(this.loadMask&&this.loadMask.hide(),t.data.error||!t.data.history)(e=this.getApplication().getCollection("Common.Collections.HistoryVersions"))&&e.size()>0&&e.each((function(t){t.set("canRestore",!1)})),Common.UI.alert({title:this.notcriticalErrorTitle,msg:t.data.error?t.data.error:this.txtErrorLoadHistory,iconCls:"warn",buttons:["ok"],callback:_.bind((function(t){this.onEditComplete()}),this)});else{this.api.asc_coAuthoringDisconnect(),this.headerView.setCanRename(!1),this.headerView.getButton("users")&&this.headerView.getButton("users").hide(),this.headerView.getButton("share")&&this.headerView.getButton("share").setVisible(!1),this.getApplication().getController("LeftMenu").getView("LeftMenu").showHistory(),this.disableEditing(!0),this._renameDialog&&this._renameDialog.close();var e,i=t.data.history,o=null,n=[];if(e=this.getApplication().getCollection("Common.Collections.HistoryVersions")){for(var s,a=[],r=-1,l=-1,c=[],h="",d=this.getApplication().getCollection("Common.Collections.HistoryUsers"),m=null,p=i.length-1,u=0;p>=0;p--,u++)if(void 0!==(s=i[p]).versionGroup&&null!==s.versionGroup||(s.versionGroup=s.version),s){if(s.user||(s.user={}),h=p>0&&i[p-1]?i[p-1].key:s.key+"0",!(m=d.findUser(s.user.id))){var g=Common.UI.ExternalUsers.getColor(s.user.id||s.user.name||this.textAnonymous,!0);m=new Common.Models.User({id:s.user.id,username:s.user.name,colorval:g,color:this.generateUserColor(g)}),s.user.id&&d.add(m)}var f=Common.UI.ExternalUsers.getImage(s.user.id);if(void 0===f&&n.push(s.user.id),a.push(new Common.Models.HistoryVersion({version:s.versionGroup,revision:s.version,userid:s.user.id,username:s.user.name,usercolor:m.get("color"),initials:Common.Utils.getUserInitials(AscCommon.UserInfoParser.getParsedName(s.user.name||this.textAnonymous)),avatar:f,created:s.created,docId:s.key,markedAsVersion:r!==s.versionGroup,selected:t.data.currentVersion==s.version,canRestore:this.appOptions.canHistoryRestore&&p<i.length-1,isExpanded:!0,serverVersion:s.serverVersion,fileType:"xslx",index:u})),t.data.currentVersion==s.version&&(o=a[a.length-1]),r=s.versionGroup,l!==s.version){for(l=s.version,c.reverse(),C=0;C<c.length;C++)a[a.length-C-2].set("arrColors",c);c=[]}c.push(m.get("colorval"));var b,C,v=s.changes;if(v&&v.length>0){if(a[a.length-1].set("docIdPrev",h),!_.isEmpty(s.serverVersion)&&s.serverVersion==this.appOptions.buildVersion)for(a[a.length-1].set("changeid",v.length-1),a[a.length-1].set("hasSubItems",v.length>1),a[a.length-1].set("documentSha256",v[v.length-1].documentSha256),C=v.length-2;C>=0;C--,u++)b=v[C],(m=d.findUser(b.user.id))||(g=Common.UI.ExternalUsers.getColor(b.user.id||b.user.name||this.textAnonymous,!0),m=new Common.Models.User({id:b.user.id,username:b.user.name,colorval:g,color:this.generateUserColor(g)}),b.user.id&&d.add(m)),void 0===(f=Common.UI.ExternalUsers.getImage(b.user.id))&&n.push(b.user.id),a.push(new Common.Models.HistoryVersion({version:s.versionGroup,revision:s.version,changeid:C,userid:b.user.id,username:b.user.name,usercolor:m.get("color"),initials:Common.Utils.getUserInitials(AscCommon.UserInfoParser.getParsedName(b.user.name||this.textAnonymous)),avatar:f,created:b.created,docId:s.key,docIdPrev:h,selected:!1,canRestore:this.appOptions.canHistoryRestore&&this.appOptions.canDownload,isRevision:!1,isVisible:!0,serverVersion:s.serverVersion,documentSha256:b.documentSha256,fileType:"xslx",hasParent:!0,index:u,level:1})),c.push(m.get("colorval"))}else 0==p&&1==i.length&&a[a.length-1].set("docId",s.key+"1")}if(c.length>0){for(c.reverse(),C=0;C<c.length;C++)a[a.length-C-1].set("arrColors",c);c=[]}e.reset(a),null===o&&e.size()>0&&(o=e.at(0)).set("selected",!0),o&&this.getApplication().getController("Common.Controllers.History").onSelectRevision(null,null,o),n.length&&Common.UI.ExternalUsers.get("info",n)}}},DisableVersionHistory:function(){this.editorConfig.canUseHistory=!1,this.appOptions.canUseHistory=!1},generateUserColor:function(t){return"#"+("000000"+t.toString(16)).substr(-6)},onGrabFocus:function(){this.getApplication().getController("DocumentHolder").getView().focus()},onLanguageLoaded:function(){return!!Common.Locale.getCurrentLanguage()||(Common.UI.warning({msg:this.errorLang,buttons:[],closable:!1}),!1)},onCollaborativeChanges:function(){this._state.hasCollaborativeChanges||(this._state.hasCollaborativeChanges=!0,this.appOptions.isEdit&&this.getApplication().getController("Statusbar").setStatusCaption(this.textNeedSynchronize,!0))},synchronizeChanges:function(){this.toolbarView&&this.toolbarView.synchronizeChanges(),this._state.hasCollaborativeChanges=!1},onConvertEquationToMath:function(t){var e,i=this,o=this.textConvertEquation+'<br><br><a id="id-equation-convert-help" style="cursor: pointer;">'+this.textLearnMore+"</a>";(e=Common.UI.warning({width:500,msg:o,buttons:["yes","cancel"],primary:"yes",dontshow:!0,textDontShow:this.textApplyAll,callback:_.bind((function(e,i){"yes"==e&&this.api.asc_ConvertEquationToMath(t,i),this.onEditComplete()}),this)})).$window.find("#id-equation-convert-help").on("click",(function(t){e&&e.close(),i.getApplication().getController("LeftMenu").getView("LeftMenu").showMenu("file:help","UsageInstructions/InsertEquation.htm#convertequation")}))},onRequestRefreshFile:function(){Common.Gateway.requestRefreshFile()},onRefreshFile:function(t){if(t){var e=new Asc.asc_CDocInfo;t.document&&(e.put_Id(t.document.key),e.put_Url(t.document.url),e.put_Title(t.document.title),t.document.title&&(this.headerView&&this.headerView.setDocumentCaption(t.document.title),this.updateWindowTitle(!0),this.appOptions.spreadsheet.title=t.document.title),t.document.referenceData&&e.put_ReferenceData(t.document.referenceData)),t.editorConfig&&e.put_CallbackUrl(t.editorConfig.callbackUrl),t.token&&e.put_Token(t.token);var i=new Asc.asc_CUserInfo;i.put_Id(this.appOptions.user.id),i.put_FullName(this.appOptions.user.fullname),i.put_IsAnonymousUser(!!this.appOptions.user.anonymous),e.put_UserInfo(i);var o=$.extend({},this.appOptions.spreadsheet.options,this.editorConfig.actionLink||{});e.put_Options(o),e.put_Format(this.appOptions.spreadsheet.fileType),e.put_Lang(this.editorConfig.lang),e.put_Mode(this.editorConfig.mode),e.put_Permissions(this.permissions),e.put_DirectUrl(t.document&&t.document.directUrl?t.document.directUrl:this.appOptions.spreadsheet.directUrl),e.put_VKey(t.document&&t.document.vkey?t.document.vkey:this.appOptions.spreadsheet.vkey),e.put_EncryptedInfo(t.editorConfig&&t.editorConfig.encryptionKeys?t.editorConfig.encryptionKeys:this.editorConfig.encryptionKeys);var n=!this.editorConfig.customization||!1!==this.editorConfig.customization.macros;e.asc_putIsEnabledMacroses(!!n),n=!this.editorConfig.customization||!1!==this.editorConfig.customization.plugins,e.asc_putIsEnabledPlugins(!!n),this.editorConfig.customization&&(void 0!==this.editorConfig.customization.showVerticalScroll&&null!==this.editorConfig.customization.showVerticalScroll&&e.asc_putShowVerticalScroll(this.editorConfig.customization.showVerticalScroll),void 0!==this.editorConfig.customization.showHorizontalScroll&&null!==this.editorConfig.customization.showHorizontalScroll&&e.asc_putShowHorizontalScroll(this.editorConfig.customization.showHorizontalScroll));var s=this.editorConfig.coEditing&&"object"==_typeof(this.editorConfig.coEditing)?"view"===this.editorConfig.mode&&!1!==this.editorConfig.coEditing.change?"fast":this.editorConfig.coEditing.mode||"fast":"fast";e.put_CoEditingMode(s),this.api.asc_refreshFile(e)}},onSaveDocumentBinary:function(t){Common.Gateway.saveDocument(t)},loadBinary:function(t){t&&this.api.asc_openDocumentFromBytes(new Uint8Array(t))},errorLang:"The interface language is not loaded.<br>Please contact your Document Server administrator."}),SSE.Controllers.Main||{}))})),define("spreadsheeteditor/main/app/controller/Print",["core"],(function(){"use strict";SSE.Controllers.Print=Backbone.Controller.extend(_.extend({views:["MainSettingsPrint","PrintWithPreview"],initialize:function(){var t=Common.localStorage.getItem("sse-print-settings-range");t=null!==t?parseInt(t):Asc.c_oAscPrintType.ActiveSheets,this._currentPrintType=t,this.adjPrintParams=new Asc.asc_CAdjustPrint,this.adjPrintParams.asc_setPrintType(t),this._state={firstPrintPage:0,isPrintPreviewOpenedOnce:!1,isPrinterInfoLoad:!1,currentPrinter:null,printersList:[]},this._changedProps=null,this._originalPageSettings=null,this._margins=[],this._navigationPreview={pageCount:!1,currentPage:0},this._isPreviewVisible=!1,this.isZoomedToPage=!0,this.addListeners({PrintWithPreview:{show:_.bind(this.onShowMainSettingsPrint,this),"render:after":_.bind(this.onAfterRender,this),changerange:_.bind(this.onChangeRange,this,!1),openheader:_.bind(this.onOpenHeaderSettings,this)},PrintSettings:{changerange:_.bind(this.onChangeRange,this,!0)}}),Common.NotificationCenter.on("print",_.bind(this.openPrintSettings,this,"print")),Common.NotificationCenter.on("download:settings",_.bind(this.openPrintSettings,this,"download")),Common.NotificationCenter.on("export:to",_.bind(this.openPrintSettings,this,"export")),Common.NotificationCenter.on("script:loaded",_.bind(this.onPostLoadComplete,this))},onLaunch:function(){},onPostLoadComplete:function(){this.views=this.getApplication().getClasseRefs("view",["PrintWithPreview"]),this.printSettings=this.createView("PrintWithPreview"),this.setMode(this.mode)},onAfterRender:function(t){var e=this;this.printSettings.menu.on("menu:hide",_.bind(this.onHidePrintMenu,this)),this.printSettings.cmbSheet.on("selected",_.bind((function(t,e){this.comboSheetsChange(this.printSettings,t,e),this._isPreviewVisible&&(this.notUpdateSheetSettings=!0,this.updatePrintRenderContainerSize(),this.api.asc_drawPrintPreview(void 0,e.value),this.printSettings.printScroller&&this.printSettings.printScroller.update())}),this)),this.printSettings.btnPrintSystemDialog.on("click",_.bind(this.querySavePrintSettings,this,"print",!0)),this.printSettings.btnsSave.forEach((function(t){t.on("click",_.bind(e.querySavePrintSettings,e,"save",!1))})),this.printSettings.btnsPrint.forEach((function(t){t.on("click",_.bind(e.querySavePrintSettings,e,"print",!1))})),this.mode.isDesktopApp&&this.printSettings.btnsPrintPDF.forEach((function(t){t.on("click",_.bind(e.querySavePrintSettings,e,"print-pdf",!1))})),this.printSettings.btnPrevPage.on("click",_.bind(this.onChangePreviewPage,this,!1)),this.printSettings.btnNextPage.on("click",_.bind(this.onChangePreviewPage,this,!0)),this.printSettings.btnZoomToPage.on("click",_.bind(this.onClickZoomToPageButton,this)),this.printSettings.btnZoomToPage.updateHint(this.txtZoomToPage),this.printSettings.txtNumberPage.on({"keypress:after":_.bind(this.onKeypressPageNumber,this),"keyup:after":_.bind(this.onKeyupPageNumber,this)}),this.printSettings.txtNumberPage.cmpEl.find("input").on("blur",_.bind(this.onBlurPageNumber,this)),this.printSettings.chIgnorePrintArea.on("change",_.bind(this.updatePreview,this,!0)),this.fillComponents(this.printSettings),this.registerControlEvents(this.printSettings),Common.NotificationCenter.on("window:resize",_.bind((function(){this._isPreviewVisible&&(this.notUpdateSheetSettings=!0,this.updatePrintRenderContainerSize(),this.api.asc_drawPrintPreview(this._navigationPreview.currentPage),this.printSettings.printScroller&&this.printSettings.printScroller.update())}),this)),Common.NotificationCenter.on("margins:update",_.bind(this.onUpdateLastCustomMargins,this));var i=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";this.printSettings.$previewBox.on(i,_.bind(this.onPreviewWheel,this))},setMode:function(t){this.mode=t,this.printSettings&&this.printSettings.setMode(t)},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onSheetsChanged",_.bind(this.updateSheetsInfo,this)),this.api.asc_registerCallback("asc_onPrintPreviewSheetChanged",_.bind(this.onApiChangePreviewSheet,this)),this.api.asc_registerCallback("asc_onPrintPreviewPageChanged",_.bind(this.onApiChangePreviewPage,this)),this.api.asc_registerCallback("asc_onPrintPreviewSheetDataChanged",_.bind(this.onApiPreviewSheetDataChanged,this)),this},updateSheetsInfo:function(){this.printSettings&&this.printSettings.isVisible()?this.updateSettings(this.printSettings):this.isFillSheets=!1},resetSheets:function(t){for(var e=this.api.asc_getWorksheetsCount(),i=-1,o=[],n=t.cmbRange.getSelectedRecord(),s=n&&n.value,a=SSE.getController("Statusbar").getSelectTabs();++i<e;)this.api.asc_isWorksheetHidden(i)||(n&&s!==Asc.c_oAscPrintType.ActiveSheets||-1!==a.indexOf(i))&&(o.push({displayValue:this.api.asc_getWorksheetName(i),value:i}),this._changedProps[i]||(this._changedProps[i]=this.api.asc_getPageOptions(i,!0,!0)));t.cmbSheet.store.reset(o)},updateSettings:function(t){this.resetSheets(t);var e=t.cmbSheet.store.findWhere({value:t.cmbSheet.getValue()})||t.cmbSheet.store.findWhere({value:this.api.asc_getActiveWorksheetIndex()});e&&(t.cmbSheet.setValue(e.get("value")),t.updateActiveSheet&&t.updateActiveSheet(e.get("displayValue")))},comboSheetsChange:function(t,e,i){var o=i.value;this.fillPageOptions(t,this._changedProps[o]?this._changedProps[o]:this.api.asc_getPageOptions(o,!0),o)},fillPageOptions:function(t,e,i){var o=e.asc_getPageSetup();this._originalPageSettings=o;var n=t.cmbPaperOrientation.store.findWhere({value:o.asc_getOrientation()});n&&t.cmbPaperOrientation.setValue(n.get("value"));var s=o.asc_getWidth(),a=o.asc_getHeight();t.setOriginalPageSize(s,a);var r=t.cmbPaperSize.store;n=null;for(var l=0;l<r.length;l++){var c=r.at(l),h=c.get("size"),d=h[0],m=h[1];if(Math.abs(d-s)<.1&&Math.abs(m-a)<.1){n=c;break}}n?t.cmbPaperSize.setValue(n.get("value")):"panel-print"===t.$el.prop("id")?t.cmbPaperSize.setValue(void 0,[this.txtCustom,parseFloat(Common.Utils.Metric.fnRecalcFromMM(s).toFixed(2)),parseFloat(Common.Utils.Metric.fnRecalcFromMM(a).toFixed(2)),Common.Utils.Metric.getCurrentMetricName()]):t.cmbPaperSize.setValue(this.txtCustom+" ("+parseFloat(Common.Utils.Metric.fnRecalcFromMM(s).toFixed(2))+Common.Utils.Metric.getCurrentMetricName()+" x "+parseFloat(Common.Utils.Metric.fnRecalcFromMM(a).toFixed(2))+Common.Utils.Metric.getCurrentMetricName()+")"),this.fitWidth=o.asc_getFitToWidth(),this.fitHeight=o.asc_getFitToHeight(),this.fitScale=o.asc_getScale(),this.setScaling(t,this.fitWidth,this.fitHeight,this.fitScale),(n=t.cmbPaperOrientation.store.findWhere({value:o.asc_getOrientation()}))&&t.cmbPaperOrientation.setValue(n.get("value")),t.spnFirstPage&&(p=o.asc_getFirstPageNumber(),t.spnFirstPage.setValue(p||1,!0)),o=e.asc_getPageMargins(),this._margins[i]=o,this.setMargins(t,o),t.chPrintGrid.setValue(e.asc_getGridLines(),!0),t.chPrintRows.setValue(e.asc_getHeadings(),!0);var p=e.asc_getPrintTitlesHeight();t.txtRangeTop.setValue(p||""),this._noApply=!0,t.txtRangeTop.checkValidate(),this._noApply=!1,t.dataRangeTop=p,p=e.asc_getPrintTitlesWidth(),t.txtRangeLeft.setValue(p||""),this._noApply=!0,t.txtRangeLeft.checkValidate(),this._noApply=!1,t.dataRangeLeft=p,p=this.api.asc_getActiveWorksheetIndex()==i,"select"==t.btnPresetsTop.menu.items[0].value&&(t.btnPresetsTop.menu.items[0].setVisible(p),t.txtRangeTop.setBtnDisabled&&t.txtRangeTop.setBtnDisabled(!p)),"select"==t.btnPresetsLeft.menu.items[0].value&&(t.btnPresetsLeft.menu.items[0].setVisible(p),t.txtRangeLeft.setBtnDisabled&&t.txtRangeLeft.setBtnDisabled(!p)),t.btnPresetsTop.menu.items["frozen"==t.btnPresetsTop.menu.items[0].value?0:1].setDisabled(!this.api.asc_getPrintTitlesRange(Asc.c_oAscPrintTitlesRangeType.frozen,!1,i)),t.btnPresetsLeft.menu.items["frozen"==t.btnPresetsLeft.menu.items[0].value?0:1].setDisabled(!this.api.asc_getPrintTitlesRange(Asc.c_oAscPrintTitlesRangeType.frozen,!0,i))},fillPrintOptions:function(t,e){var i=e?this.printSettingsDlg:this.printSettings;i.setRange(t.asc_getPrintType()),i.setIgnorePrintArea(!!t.asc_getIgnorePrintArea()),this.onChangeRange(e)},onChangeRange:function(t){var e=t?this.printSettingsDlg:this.printSettings,i=e.getRange();this.resetSheets(e);var o=e.cmbSheet.store,n=i!==Asc.c_oAscPrintType.EntireWorkbook?o.findWhere({value:this.api.asc_getActiveWorksheetIndex()}):o.at(0);n&&(e.cmbSheet.setValue(n.get("value")),this.comboSheetsChange(e,e.cmbSheet,n.toJSON())),e.cmbSheet.setDisabled(i===Asc.c_oAscPrintType.Selection||i===Asc.c_oAscPrintType.ActiveSheets&&e.cmbSheet.store.length<2),e.chIgnorePrintArea.setDisabled(i==Asc.c_oAscPrintType.Selection),t||this.updatePreview(!0)},getPageOptions:function(t,e){var i=this._changedProps[e]?this._changedProps[e]:new Asc.asc_CPageOptions;i.asc_setGridLines("checked"===t.chPrintGrid.getValue()),i.asc_setHeadings("checked"===t.chPrintRows.getValue());var o=this._changedProps[e]?this._changedProps[e].asc_getPageSetup():new Asc.asc_CPageSetup;o.asc_setOrientation("-"==t.cmbPaperOrientation.getValue()?void 0:t.cmbPaperOrientation.getValue());var n=t.cmbPaperSize.getSelectedRecord().size,s=n[0],a=n[1];o.asc_setWidth(s||(this._originalPageSettings?this._originalPageSettings.asc_getWidth():void 0)),o.asc_setHeight(a||(this._originalPageSettings?this._originalPageSettings.asc_getHeight():void 0));var r=t.cmbLayout.getValue();if(4!==r){var l=1==r||2==r?1:0,c=1==r||3==r?1:0;o.asc_setFitToWidth(l),o.asc_setFitToHeight(c),!l&&!c&&o.asc_setScale(100),this.setScaling(t,l,c,100)}else o.asc_setFitToWidth(this.fitWidth),o.asc_setFitToHeight(this.fitHeight),o.asc_setScale(this.fitScale);t.spnFirstPage&&o.asc_setFirstPageNumber(t.spnFirstPage.getNumberValue()),this._changedProps[e]||i.asc_setPageSetup(o),o=this._changedProps[e]?this._changedProps[e].asc_getPageMargins():new Asc.asc_CPageMargins;var h=t.cmbPaperMargins.getSelectedRecord();h&&h.size?(r=h.size,o.asc_setTop(r[0]),o.asc_setLeft(r[1]),o.asc_setBottom(r[2]),o.asc_setRight(r[3])):(o.asc_setTop(this._margins[e].asc_getTop()),o.asc_setLeft(this._margins[e].asc_getLeft()),o.asc_setBottom(this._margins[e].asc_getBottom()),o.asc_setRight(this._margins[e].asc_getRight())),this._changedProps[e]||i.asc_setPageMargins(o);var d=this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PrintTitles,t.txtRangeTop.getValue(),!1)!==Asc.c_oAscError.ID.DataRangeError;return i.asc_setPrintTitlesHeight(d?t.txtRangeTop.getValue():t.dataRangeTop),d=this.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PrintTitles,t.txtRangeLeft.getValue(),!1)!==Asc.c_oAscError.ID.DataRangeError,i.asc_setPrintTitlesWidth(d?t.txtRangeLeft.getValue():t.dataRangeLeft),i},savePageOptions:function(t){this.api.asc_savePagePrintOptions(this._changedProps),Common.NotificationCenter.trigger("page:settings")},onShowMainSettingsPrint:function(){this._changedProps=[],this.printSettings.$previewBox.removeClass("hidden"),this.onUpdateLastCustomMargins(this._lastMargins,this.printSettings),this.isFillSheets?this.resetSheets(this.printSettings):(this.isFillSheets=!0,this.updateSettings(this.printSettings)),this.adjPrintParams.asc_setPageOptionsMap(this._changedProps),this.fillPrintOptions(this.adjPrintParams,!1),this.adjPrintParams.asc_setActiveSheetsArray(this.printSettings.getRange()===Asc.c_oAscPrintType.ActiveSheets?SSE.getController("Statusbar").getSelectTabs():null);var t=new Asc.asc_CDownloadOptions(null,Common.Utils.isChrome||Common.Utils.isOpera||Common.Utils.isGecko&&Common.Utils.firefoxVersion>86);t.asc_setAdvancedOptions(this.adjPrintParams);var e=this.api.asc_initPrintPreview("print-preview",t);this.printSettings.$previewBox.toggleClass("hidden",!e),this.printSettings.$previewEmpty.toggleClass("hidden",!!e),e&&(this.updateNavigationButtons(0,e),this.printSettings.txtNumberPage.checkValidate()),this._isPreviewVisible=!0,e&&this.updatePreview(),this._state.isPrinterInfoLoad&&!this._state.isPrintPreviewOpenedOnce&&(this._state.isPrintPreviewOpenedOnce=!0,this.printSettings.updateCmbPrinter(this._state.currentPrinter,this._state.printersList))},openPrintSettings:function(t,e,i,o,n){this.printSettingsDlg&&this.printSettingsDlg.isVisible()?o&&Common.NotificationCenter.trigger("download:cancel"):this.api&&(Common.UI.Menu.Manager.hideAll(),this.asUrl=o,this.downloadFormat=i,this.downloadWopiPath=n,this.printSettingsDlg=new SSE.Views.PrintSettings({type:t,handler:_.bind(this.resultPrintSettings,this),afterrender:_.bind((function(){this._changedProps=[],this.onUpdateLastCustomMargins(this._lastMargins,this.printSettingsDlg),this.updateSettings(this.printSettingsDlg),this.printSettingsDlg.cmbSheet.on("selected",_.bind(this.comboSheetsChange,this,this.printSettingsDlg)),this.fillComponents(this.printSettingsDlg,!0),this.fillPrintOptions(this.adjPrintParams,!0),this.registerControlEvents(this.printSettingsDlg)}),this)}),this.printSettingsDlg.show())},findPagePreset:function(t,e,i){for(var o=e<i?e:i,n=e<i?i:e,s=t.cmbPaperSize.store,a=null,r=0;r<s.length-1;r++){var l=s.at(r),c=l.get("size"),h=c[0],d=c[1];if(Math.abs(h-o)<.1&&Math.abs(d-n)<.1){a=l;break}}return a?a.get("caption"):void 0},resultPrintSettings:function(t,e){var i=SSE.getController("Toolbar").getView("Toolbar");if("ok"==t){this.savePageOptions(this.printSettingsDlg);var o=this.printSettingsDlg.getRange();this.adjPrintParams.asc_setPrintType(o),this.adjPrintParams.asc_setPageOptionsMap(this._changedProps),this.adjPrintParams.asc_setIgnorePrintArea(this.printSettingsDlg.getIgnorePrintArea()),this.adjPrintParams.asc_setActiveSheetsArray(o===Asc.c_oAscPrintType.ActiveSheets?SSE.getController("Statusbar").getSelectTabs():null);var n=this.printSettingsDlg.getPagesFrom(),s=this.printSettingsDlg.getPagesTo();if(n>s){var a=n;n=s,s=a}this.adjPrintParams.asc_setStartPageIndex(n>0?n-1:null),this.adjPrintParams.asc_setEndPageIndex(s>0?s-1:null),Common.localStorage.setItem("sse-print-settings-range",o);var r,l=o===Asc.c_oAscPrintType.EntireWorkbook?0:this.api.asc_getActiveWorksheetIndex(),c=(this._changedProps[l]||this.api.asc_getPageOptions(l)).asc_getPageSetup(),h=[c.asc_getWidth(),c.asc_getHeight()],d=c.asc_getOrientation();if(this.adjPrintParams.asc_setNativeOptions({paperSize:{w:h[0],h:h[1],preset:this.findPagePreset(this.printSettingsDlg,h[0],h[1])},paperOrientation:d?"landscape":"portrait"}),"print"==this.printSettingsDlg.type)(r=new Asc.asc_CDownloadOptions(null,Common.Utils.isChrome||Common.Utils.isOpera||Common.Utils.isGecko&&Common.Utils.firefoxVersion>86)).asc_setAdvancedOptions(this.adjPrintParams),this.api.asc_Print(r);else(r=new Asc.asc_CDownloadOptions(this.downloadFormat,this.asUrl)).asc_setAdvancedOptions(this.adjPrintParams),r.asc_setIsSaveAs(this.asUrl),this.downloadWopiPath&&r.asc_setWopiSaveAsPath(this.downloadWopiPath),this.api.asc_DownloadAs(r);Common.component.Analytics.trackEvent("print"==this.printSettingsDlg.type?"Print":"DownloadAs"),Common.component.Analytics.trackEvent("ToolBar","print"==this.printSettingsDlg.type?"Print":"DownloadAs"),Common.NotificationCenter.trigger("edit:complete",i)}else this.asUrl&&Common.NotificationCenter.trigger("download:cancel"),Common.NotificationCenter.trigger("edit:complete",i);this.printSettingsDlg=null},querySavePrintSettings:function(t,e){var i=SSE.getController("Toolbar").getView("Toolbar");this.savePageOptions(this.printSettings),this._isPrint="print"===t,this.printSettings.applySettings();var o=this.printSettings.getRange();this.adjPrintParams.asc_setPrintType(o),this.adjPrintParams.asc_setPageOptionsMap(this._changedProps),this.adjPrintParams.asc_setIgnorePrintArea(this.printSettings.getIgnorePrintArea()),this.adjPrintParams.asc_setActiveSheetsArray(o===Asc.c_oAscPrintType.ActiveSheets?SSE.getController("Statusbar").getSelectTabs():null);var n=this.printSettings.getPagesFrom(),s=this.printSettings.getPagesTo();if(n>s){var a=n;n=s,s=a}this.adjPrintParams.asc_setStartPageIndex(n>0?n-1:null),this.adjPrintParams.asc_setEndPageIndex(s>0?s-1:null),Common.localStorage.setItem("sse-print-settings-range",o);var r=o===Asc.c_oAscPrintType.EntireWorkbook?0:this.api.asc_getActiveWorksheetIndex(),l=(this._changedProps[r]||this.api.asc_getPageOptions(r)).asc_getPageSetup(),c=[l.asc_getWidth(),l.asc_getHeight()],h=l.asc_getOrientation(),d=this.printSettings.cmbPrinter?this.printSettings.cmbPrinter.getSelectedRecord():null;if(this.adjPrintParams.asc_setNativeOptions({usesystemdialog:e,printer:d?d.value:null,paperSize:{w:c[0],h:c[1],preset:this.findPagePreset(this.printSettings,c[0],c[1])},paperOrientation:h?"landscape":"portrait",copies:this.printSettings.spnCopies&&this.printSettings.spnCopies.getNumberValue()||1,sides:this.printSettings.cmbSides?this.printSettings.cmbSides.getValue():"one"}),"print"===t)(m=new Asc.asc_CDownloadOptions(null,Common.Utils.isChrome||Common.Utils.isOpera||Common.Utils.isGecko&&Common.Utils.firefoxVersion>86)).asc_setAdvancedOptions(this.adjPrintParams),this.api.asc_Print(m),this._isPrint=!1;else if("print-pdf"===t){var m;(m=new Asc.asc_CDownloadOptions(Asc.c_oAscFileType.PDF)).asc_setAdvancedOptions(this.adjPrintParams),this.api.asc_DownloadAs(m)}Common.NotificationCenter.trigger("edit:complete",i)},registerControlEvents:function(t){t.cmbPaperSize.on("selected",_.bind(this.propertyChange,this,t)),t.cmbPaperOrientation.on("selected",_.bind(this.propertyChange,this,t)),t.cmbLayout.on("selected",_.bind(this.propertyChange,this,t,"scale")),t.cmbPaperMargins.on("selected",_.bind(this.propertyChange,this,t,"margins")),t.chPrintGrid.on("change",_.bind(this.propertyChange,this,t)),t.chPrintRows.on("change",_.bind(this.propertyChange,this,t)),t.txtRangeTop.on("changed:after",_.bind(this.propertyChange,this,t)),t.txtRangeLeft.on("changed:after",_.bind(this.propertyChange,this,t)),t.txtRangeTop.on("button:click",_.bind(this.onPresetSelect,this,t,"top",t.btnPresetsTop.menu,{value:"select"})),t.txtRangeLeft.on("button:click",_.bind(this.onPresetSelect,this,t,"left",t.btnPresetsLeft.menu,{value:"select"})),t.btnPresetsTop.menu.on("item:click",_.bind(this.onPresetSelect,this,t,"top")),t.btnPresetsLeft.menu.on("item:click",_.bind(this.onPresetSelect,this,t,"left")),t.spnFirstPage&&t.spnFirstPage.on("change",_.bind(this.propertyChange,this,t))},propertyChange:function(t,e,i,o){var n=this,s=function(){if(n._changedProps){var e=t.cmbSheet.getValue();n._changedProps[e]=n.getPageOptions(t,e),n.updatePreview()}};if("scale"===e&&"customoptions"===o.value){var a=n._changedProps.length>0&&n._changedProps[t.cmbSheet.getValue()]?n._changedProps[t.cmbSheet.getValue()]:n.api.asc_getPageOptions(t.cmbSheet.getValue(),!0);(r=new SSE.Views.ScaleDialog({api:n.api,props:a,handler:function(e,i){if("ok"==e)n.api&&i&&(n.fitWidth=i.width,n.fitHeight=i.height,n.fitScale=i.scale,n.setScaling(t,n.fitWidth,n.fitHeight,n.fitScale),s());else{var o=a.asc_getPageSetup(),r=o.asc_getFitToWidth(),l=o.asc_getFitToHeight(),c=o.asc_getScale();n.setScaling(t,r,l,c)}Common.NotificationCenter.trigger("edit:complete")}})).show(),Common.NotificationCenter.trigger("edit:complete",this.toolbar)}else if("margins"===e&&-1===o.value){var r;a=n._changedProps.length>0&&n._changedProps[t.cmbSheet.getValue()]?n._changedProps[t.cmbSheet.getValue()]:n.api.asc_getPageOptions(t.cmbSheet.getValue(),!0);(r=new SSE.Views.PageMarginsDialog({api:n.api,handler:function(e,i){var o;if("ok"==i){var r=(o=e.getSettings()).margins;Common.localStorage.setItem("sse-pgmargins-top",r.asc_getTop()),Common.localStorage.setItem("sse-pgmargins-left",r.asc_getLeft()),Common.localStorage.setItem("sse-pgmargins-bottom",r.asc_getBottom()),Common.localStorage.setItem("sse-pgmargins-right",r.asc_getRight()),Common.NotificationCenter.trigger("margins:update",r,t),n.setMargins(t,r);var l=t.cmbSheet.getValue();n._margins[l]=r,n._changedProps&&n._changedProps[l]&&(n._changedProps[l].asc_setVerticalCentered(o.vertical),n._changedProps[l].asc_setHorizontalCentered(o.horizontal)),s(),Common.NotificationCenter.trigger("edit:complete")}else n.setMargins(t,a.asc_getPageMargins())}}).on("close",(function(){t.cmbPaperMargins.focus()}))).show(),r.setSettings(a)}else s()},getPrintParams:function(){return this.adjPrintParams},setScaling:function(t,e,i,o){var n;n=e||i||100!==o?1===e&&1===i?1:1!==e||i?e||1!==i?4:3:2:0,t.addCustomScale(4===n),t.cmbLayout.setValue(n,!0)},setMargins:function(t,e){if(e){for(var i=e.asc_getLeft(),o=e.asc_getTop(),n=e.asc_getRight(),s=e.asc_getBottom(),a=t.cmbPaperMargins.store,r=null,l=0;l<a.length-1;l++){var c=a.at(l),h=c.get("size");"object"==_typeof(h)&&Math.abs(h[0]-o)<.1&&Math.abs(h[1]-i)<.1&&Math.abs(h[2]-s)<.1&&Math.abs(h[3]-n)<.1&&(r=c)}r?t.cmbPaperMargins.setValue(r.get("value")):t.cmbPaperMargins.setValue(this.txtCustom)}},onUpdateLastCustomMargins:function(t,e){if(this._lastMargins=t,e){var i=t?t.asc_getTop():Common.localStorage.getItem("sse-pgmargins-top"),o=t?t.asc_getLeft():Common.localStorage.getItem("sse-pgmargins-left"),n=t?t.asc_getBottom():Common.localStorage.getItem("sse-pgmargins-bottom"),s=t?t.asc_getRight():Common.localStorage.getItem("sse-pgmargins-right");if(null!==i&&null!==o&&null!==n&&null!==s){var a=e.cmbPaperMargins.store.at(0);-2===a.get("value")?a.set("size",[parseFloat(i),parseFloat(o),parseFloat(n),parseFloat(s)]):e.cmbPaperMargins.store.unshift({value:-2,displayValue:e.txtMarginsLast,size:[parseFloat(i),parseFloat(o),parseFloat(n),parseFloat(s)]}),e.cmbPaperMargins.onResetItems()}}},setPrinterInfo:function(t,e){this._state.isPrinterInfoLoad=!0,this._state.currentPrinter=t,this._state.printersList=e,this.printSettings&&this.printSettings.isVisible()&&!this._state.isPrintPreviewOpenedOnce&&(this._state.isPrintPreviewOpenedOnce=!0,this.printSettings.updateCmbPrinter(this._state.currentPrinter,this._state.printersList))},fillComponents:function(t,e){var i=this;t.txtRangeTop.validation=function(t){return!!_.isEmpty(t)||(i.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PrintTitles,t,!1)!=Asc.c_oAscError.ID.DataRangeError||i.textInvalidRange)},e&&t.txtRangeTop.updateBtnHint(this.textSelectRange),t.txtRangeLeft.validation=function(t){return!!_.isEmpty(t)||(i.api.asc_checkDataRange(Asc.c_oAscSelectionDialogType.PrintTitles,t,!1)!=Asc.c_oAscError.ID.DataRangeError||i.textInvalidRange)},e&&t.txtRangeLeft.updateBtnHint(this.textSelectRange);var o=(e?[{caption:this.textSelectRange+"...",value:"select"}]:[]).concat([{caption:this.textFrozenRows,value:"frozen"},{caption:this.textFirstRow,value:"first"},{caption:"--"},{caption:this.textNoRepeat,value:"empty"}]);t.btnPresetsTop.setMenu(new Common.UI.Menu({style:"min-width: 100px;",maxHeight:200,additionalAlign:t.menuAddAlign,items:o})),o=(e?[{caption:this.textSelectRange+"...",value:"select"}]:[]).concat([{caption:this.textFrozenCols,value:"frozen"},{caption:this.textFirstCol,value:"first"},{caption:"--"},{caption:this.textNoRepeat,value:"empty"}]),t.btnPresetsLeft.setMenu(new Common.UI.Menu({style:"min-width: 100px;",maxHeight:200,additionalAlign:t.menuAddAlign,items:o}))},onPresetSelect:function(t,e,i,o){var n="top"==e?t.txtRangeTop:t.txtRangeLeft;if("select"==o.value){if(this.api){t.btnPresetsTop.menu.options.additionalAlign=t.menuAddAlign,t.btnPresetsLeft.menu.options.additionalAlign=t.menuAddAlign;var s=new SSE.Views.CellRangeDialog({handler:function(i,o){if("ok"==o){var s=i.getSettings();"top"==e?t.dataRangeTop=s:t.dataRangeLeft=s,n.setValue(s),n.checkValidate(),n._input.blur()}}}).on("close",(function(){t.show(),_.delay((function(){n.focus()}),1)})),a=Common.Utils.getOffset(t.$window);t.hide(),s.show(t.$window,a),s.setSettings({api:this.api,range:_.isEmpty(n.getValue())||1!=n.checkValidate()?"top"==e?t.dataRangeTop:t.dataRangeLeft:n.getValue(),type:Asc.c_oAscSelectionDialogType.PrintTitles})}}else{var r="";"frozen"==o.value?r=this.api.asc_getPrintTitlesRange(Asc.c_oAscPrintTitlesRangeType.frozen,"left"==e,t.cmbSheet.getValue()):"first"==o.value&&(r=this.api.asc_getPrintTitlesRange(Asc.c_oAscPrintTitlesRangeType.first,"left"==e,t.cmbSheet.getValue())),n.setValue(r),n.checkValidate(),n._input.blur(),"top"==e?t.dataRangeTop=r:t.dataRangeLeft=r}},onHidePrintMenu:function(){this._isPreviewVisible&&(this.api.asc_closePrintPreview(this._isPrint),this._isPreviewVisible=!1)},onChangePreviewPage:function(t){var e=this._navigationPreview.currentPage;t?(e++,e=Math.min(e,this._navigationPreview.pageCount-1)):(e--,e=Math.max(e,0)),this.api.asc_drawPrintPreview(e),this.updateNavigationButtons(e,this._navigationPreview.pageCount),this.updatePrintRenderContainerSize(!0)},onClickZoomToPageButton:function(t){this.isZoomedToPage=t.pressed,this.updatePreview()},updatePrintRenderContainerSize:function(t){var e=$("#print-preview");if(this.isZoomedToPage)e.css({width:"",height:""}),this.printSettings.printScroller.update({suppressScrollX:!0,suppressScrollY:!0});else{var i=this._changedProps[this.printSettings.cmbSheet.getValue()].asc_getPageSetup(),o=i.asc_getOrientation(),n=AscCommon.mm2pix(i.asc_getWidth()),s=AscCommon.mm2pix(i.asc_getHeight());e.css({width:"max(100%, {}px)".replace("{}",1===o?s:n),height:"max(100%, {}px)".replace("{}",1===o?n:s)}),this.printSettings.printScroller.update({suppressScrollX:!1,suppressScrollY:!1})}$("#print-preview-wrapper").css("display",this.isZoomedToPage?"":"flex"),this.printSettings.printScroller.scrollTop(0),t&&(this.api.asc_drawPrintPreview(this._navigationPreview.currentPage),this.printSettings.printScroller&&this.printSettings.printScroller.update())},onPreviewWheel:function(t){t.ctrlKey&&(t.preventDefault(),t.stopImmediatePropagation()),this.printSettings.txtRangeTop.cmpEl.find("input:focus").blur(),this.printSettings.txtRangeLeft.cmpEl.find("input:focus").blur();var e=(t.deltaY||t.detail&&-t.detail||t.wheelDelta)<0;this.onChangePreviewPage(e)},onKeypressPageNumber:function(t,e){if(e.keyCode===Common.UI.Keys.RETURN){var i=this.printSettings.$el.find("#print-number-page"),o=i.find("input[type=text]"),n=parseInt(o.val());if(!n||n>this._navigationPreview.pageCount||n<0)return o.select(),this.printSettings.txtNumberPage.setValue(this._navigationPreview.currentPage+1),this.printSettings.txtNumberPage.checkValidate(),!1;i.focus();var s=n-1;return this.api.asc_drawPrintPreview(s),this.updateNavigationButtons(s,this._navigationPreview.pageCount),this.updatePrintRenderContainerSize(!0),!1}},onKeyupPageNumber:function(t,e){if(e.keyCode===Common.UI.Keys.ESC)return this.printSettings.$el.find("#print-number-page").focus(),this.api.asc_enableKeyEvents(!0),!1},onBlurPageNumber:function(){this.printSettings.txtNumberPage.getValue()!=this._navigationPreview.currentPage+1&&(this.printSettings.txtNumberPage.setValue(this._navigationPreview.currentPage+1),this.printSettings.txtNumberPage.checkValidate())},updatePreview:function(t){if(this._isPreviewVisible){this.printSettings.$previewBox.removeClass("hidden");var e=new Asc.asc_CAdjustPrint,i=this.printSettings.getRange();e.asc_setPrintType(i),e.asc_setPageOptionsMap(this._changedProps),e.asc_setIgnorePrintArea(this.printSettings.getIgnorePrintArea()),e.asc_setActiveSheetsArray(i===Asc.c_oAscPrintType.ActiveSheets?SSE.getController("Statusbar").getSelectTabs():null);var o=this.printSettings.getPagesFrom(),n=this.printSettings.getPagesTo();if(o>n){var s=o;o=n,n=s}e.asc_setStartPageIndex(o>0?o-1:null),e.asc_setEndPageIndex(n>0?n-1:null);var a=new Asc.asc_CDownloadOptions(null,Common.Utils.isChrome||Common.Utils.isOpera||Common.Utils.isGecko&&Common.Utils.firefoxVersion>86);a.asc_setAdvancedOptions(e);var r,l=this.api.asc_updatePrintPreview(a);this.printSettings.$previewBox.toggleClass("hidden",!l),this.printSettings.$previewEmpty.toggleClass("hidden",!!l),this._currentPrintType!==i?(r=0,this._currentPrintType=i):r=this._navigationPreview.currentPage>l-1?Math.max(0,l-1):this._navigationPreview.currentPage,this.notUpdateSheetSettings=!t,this.updatePrintRenderContainerSize(),this.api.asc_drawPrintPreview(r),this.printSettings.printScroller&&this.printSettings.printScroller.update(),this.updateNavigationButtons(r,l)}},onApiChangePreviewSheet:function(t){var e=this.printSettings.cmbSheet.store.findWhere({value:t});e&&this.printSettings.updateActiveSheet(e.get("displayValue")),this.notUpdateSheetSettings?this.notUpdateSheetSettings=!1:e&&(this.printSettings.cmbSheet.setValue(e.get("value")),this.comboSheetsChange(this.printSettings,this.printSettings.cmbSheet,e.toJSON()))},updateNavigationButtons:function(t,e){this._navigationPreview.currentPage=t,this.printSettings.updateCurrentPage(t),this._navigationPreview.pageCount=e,this.printSettings.updateCountOfPages(e),this.disableNavButtons()},disableNavButtons:function(t){if(t)return this.printSettings.btnPrevPage.setDisabled(!0),void this.printSettings.btnNextPage.setDisabled(!0);var e=this._navigationPreview.currentPage,i=this._navigationPreview.pageCount;this.printSettings.btnPrevPage.setDisabled(e<1),this.printSettings.btnNextPage.setDisabled(e>i-2)},onOpenHeaderSettings:function(){var t=this._changedProps[this.printSettings.cmbSheet.getValue()].asc_getPageSetup();SSE.getController("Toolbar").onEditHeaderClick(t)},onApiChangePreviewPage:function(t){this._navigationPreview.currentPage!==t&&(this._navigationPreview.currentPage=t,this.updateNavigationButtons(t,this._navigationPreview.pageCount),this.disableNavButtons())},onApiPreviewSheetDataChanged:function(t){t?this.updatePreview():(this.notUpdateSheetSettings=!0,this.api.asc_drawPrintPreview(this._navigationPreview.currentPage),this.updateNavigationButtons(this._navigationPreview.currentPage,this._navigationPreview.pageCount),this.printSettings.printScroller&&this.printSettings.printScroller.update())},strAllSheets:"All Sheets",txtCustom:"Custom",textInvalidRange:"ERROR! Invalid cells range",textRepeat:"Repeat...",textNoRepeat:"Not repeat",textSelectRange:"Select range",textFrozenRows:"Frozen rows",textFrozenCols:"Frozen columns",textFirstRow:"First row",textFirstCol:"First column",txtZoomToPage:"Zoom to page"},SSE.Controllers.Print||{}))})),void 0===Common)var Common={};if(define("common/main/lib/component/TextareaField",[],(function(){"use strict";Common.UI.TextareaField=Common.UI.BaseView.extend({options:{id:null,cls:"",style:"",value:"",maxlength:void 0,placeHolder:"",spellcheck:!1,disabled:!1,resize:!1},template:_.template(['<div class="textarea-field" style="<%= style %>">',"<textarea ",'spellcheck="<%= spellcheck %>" ','class="form-control <%= cls %>" ','placeholder="<%= placeHolder %>" ',"<% if (dataHint) {%>",'data-hint="<%= dataHint %>" ',"<% } %>","<% if (dataHintDirection) {%>",'data-hint-direction="<%= dataHintDirection %>" ',"<% } %>","<% if (dataHintOffset) {%>",'data-hint-offset="<%= dataHintOffset %>" ',"<% } %>","></textarea>","</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=e.options.id||Common.UI.getId(),this.cls=e.options.cls,this.style=e.options.style,this.value=e.options.value,this.placeHolder=e.options.placeHolder,this.template=e.options.template||e.template,this.disabled=e.options.disabled,this.spellcheck=e.options.spellcheck,this.maxLength=e.options.maxLength,e.rendered=e.options.rendered||!1,e.options.el&&e.render()},render:function(t){var e=this;return e.rendered?this.cmpEl=this.$el:(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,placeHolder:this.placeHolder,spellcheck:this.spellcheck,dataHint:this.options.dataHint,dataHintDirection:this.options.dataHintDirection,dataHintOffset:this.options.dataHintOffset,scope:e})),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl)),e.rendered||(this.cmpEl,this._input=this.cmpEl.find("textarea").addBack().filter("textarea"),this._input.on("blur",_.bind(this.onInputChanged,this)),this._input.on("keydown",_.bind(this.onKeyDown,this)),this.maxLength&&this._input.attr("maxlength",this.maxLength),this.resize||this._input.css("resize","none"),this.disabled&&this.setDisabled(this.disabled)),e.rendered=!0,e.value&&e.setValue(e.value),this},_doChange:function(t,e){if(!e||!e.synthetic){var i=$(t.target).val(),o=this.value;this.trigger("changed:before",this,i,o,t),t.isDefaultPrevented()||(this.value=i,this.trigger("changed:after",this,i,o,t))}},onInputChanged:function(t,e){this._doChange(t,e)},onKeyDown:function(t){this.trigger("keydown:before",this,t),t.isDefaultPrevented()||(t.keyCode===Common.UI.Keys.RETURN&&t.stopPropagation(),t.keyCode==Common.UI.Keys.ESC&&this.setValue(this.value),t.keyCode==Common.UI.Keys.ESC&&this.trigger("inputleave",this))},setDisabled:function(t){t=!!t,this.disabled=t,$(this.el).toggleClass("disabled",t),t?this._input.attr("disabled",!0):this._input.removeAttr("disabled")},isDisabled:function(){return this.disabled},setValue:function(t){this.value=t,this.rendered&&this._input.val(t)},getValue:function(){return this.value},focus:function(){this._input.focus()}})})),define("spreadsheeteditor/main/app/view/DataTab",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout","common/main/lib/view/OpenDialog","common/main/lib/component/TextareaField"],(function(){"use strict";SSE.Views.DataTab=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;t.btnUngroup.menu.on("item:click",(function(e,i,o){t.fireEvent("data:ungroup",[i.value])})),t.btnUngroup.on("click",(function(e,i){t.fireEvent("data:ungroup")})),t.btnGroup.menu.on("item:click",(function(e,i,o){t.fireEvent("data:group",[i.value,i.checked])})),t.btnGroup.on("click",(function(e,i){t.fireEvent("data:group")})),t.btnGroup.menu.on("show:before",(function(e,i){t.fireEvent("data:groupsettings",[e])})),t.btnTextToColumns.on("click",(function(e,i){t.fireEvent("data:tocolumns")})),t.btnRemoveDuplicates.on("click",(function(e,i){t.fireEvent("data:remduplicates")})),t.btnDataValidation.on("click",(function(e,i){t.fireEvent("data:datavalidation")})),t.btnsSortDown.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("data:sort",[Asc.c_oAscSortOptions.Ascending])}))})),t.btnsSortUp.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("data:sort",[Asc.c_oAscSortOptions.Descending])}))})),t.btnsSetAutofilter.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("data:setfilter",[Asc.c_oAscSortOptions.Descending])}))})),t.btnsClearAutofilter.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("data:clearfilter",[Asc.c_oAscSortOptions.Descending])}))})),t.btnCustomSort.on("click",(function(e,i){t.fireEvent("data:sortcustom")})),t.btnExternalLinks.on("click",(function(e,i){t.fireEvent("data:externallinks")})),t.btnGoalSeek.on("click",(function(e,i){t.fireEvent("data:goalseek")})),t.btnDataFromText.menu?t.btnDataFromText.menu.on("item:click",(function(e,i,o){t.fireEvent("data:fromtext",[i.value])})):t.btnDataFromText.on("click",(function(e,i){t.fireEvent("data:fromtext",["file"])}))}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this),this.toolbar=t.toolbar,this.lockedControls=[];var e=this.toolbar.$el,i=Common.enumLock;this.btnDataFromText=new Common.UI.Button({parentEl:e.find("#slot-btn-data-from-text"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-import-data",caption:this.capDataFromText,menu:!0,action:"import-data",disabled:!0,lock:[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.sheetLock,i.wbLock,i.lostConnect,i.coAuth,i.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnDataFromText),this.btnGroup=new Common.UI.Button({parentEl:e.find("#slot-btn-group"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-cell-group",caption:this.capBtnGroup,split:!0,menu:!0,action:"cell-group",disabled:!0,lock:[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.sheetLock,i.lostConnect,i.coAuth,i.wsLock,i.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnGroup),this.btnUngroup=new Common.UI.Button({parentEl:e.find("#slot-btn-ungroup"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-cell-ungroup",caption:this.capBtnUngroup,split:!0,menu:!0,action:"cell-ungroup",disabled:!0,lock:[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.sheetLock,i.lostConnect,i.coAuth,i.wsLock,i.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnUngroup),this.btnTextToColumns=new Common.UI.Button({parentEl:e.find("#slot-btn-text-column"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-to-columns",caption:this.capBtnTextToCol,split:!1,disabled:!0,lock:[i.multiselect,i.multiselectCols,i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.lostConnect,i.coAuth,i.wsLock,i.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnTextToColumns),this.btnRemoveDuplicates=new Common.UI.Button({parentEl:e.find("#slot-btn-rem-duplicates"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-big-remove-duplicates",caption:this.capBtnTextRemDuplicates,disabled:!0,lock:[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.lostConnect,i.coAuth,i.ruleFilter,i.editPivot,i.cantModifyFilter,i.sheetLock,i.wsLock,i.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnRemoveDuplicates),this.btnDataValidation=new Common.UI.Button({parentEl:e.find("#slot-btn-data-validation"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-data-validation",caption:this.capBtnTextDataValidation,disabled:!0,lock:[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.lostConnect,i.coAuth,i.editPivot,i.cantModifyFilter,i.sheetLock,i.wsLock,i.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnDataValidation),this.btnCustomSort=new Common.UI.Button({parentEl:e.find("#slot-btn-custom-sort"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-custom-sort",caption:this.capBtnTextCustomSort,disabled:!0,lock:[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.lostConnect,i.coAuth,i.ruleFilter,i.cantModifyFilter,i.sheetLock,i.Sort,i.userProtected],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnCustomSort),this.btnExternalLinks=new Common.UI.Button({parentEl:e.find("#slot-btn-data-external-links"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-edit-links",caption:this.capDataExternalLinks,disabled:!0,lock:[i.editCell,i.sheetLock,i.wbLock,i.lostConnect,i.coAuth,i.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnExternalLinks),this.btnGoalSeek=new Common.UI.Button({parentEl:e.find("#slot-btn-goal-seek"),cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-goal-seek",caption:this.capGoalSeek,disabled:!0,lock:[i.editCell,i.lostConnect,i.coAuth],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnGoalSeek),this.btnsSortDown=Common.Utils.injectButtons(e.find(".slot-sortdesc"),"","toolbar__icon btn-sort-down","",[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.lostConnect,i.coAuth,i.ruleFilter,i.cantModifyFilter,i.sheetLock,i.cantSort,i.Sort,i.userProtected],void 0,void 0,void 0,"1","top",void 0,"D"),this.btnsSortUp=Common.Utils.injectButtons(e.find(".slot-sortasc"),"","toolbar__icon btn-sort-up","",[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.lostConnect,i.coAuth,i.ruleFilter,i.cantModifyFilter,i.sheetLock,i.cantSort,i.Sort,i.userProtected],void 0,void 0,void 0,"1","top",void 0,"U"),this.btnsSetAutofilter=Common.Utils.injectButtons(e.find(".slot-btn-setfilter"),"","toolbar__icon btn-autofilter","",[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.selSlicer,i.lostConnect,i.coAuth,i.ruleFilter,i.editPivot,i.cantModifyFilter,i.tableHasSlicer,i.wsLock,i.userProtected],!1,!1,!0,"1","bottom",void 0,"F"),this.btnsClearAutofilter=Common.Utils.injectButtons(e.find(".slot-btn-clear-filter"),"","toolbar__icon btn-clear-filter","",[i.editCell,i.selChart,i.selChartText,i.selShape,i.selShapeText,i.selImage,i.lostConnect,i.coAuth,i.ruleDelFilter,i.wsLock,i.userProtected],void 0,void 0,void 0,"1","bottom",void 0,"N"),Array.prototype.push.apply(this.lockedControls,this.btnsSortDown.concat(this.btnsSortUp,this.btnsSetAutofilter,this.btnsClearAutofilter)),Common.UI.LayoutManager.addControls(this.lockedControls),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return this},onAppReady:function(e){var i=this;new Promise((function(t,e){t()})).then((function(){i.btnUngroup.updateHint(i.tipUngroup);var e=new Common.UI.Menu({items:[{caption:i.textRows,value:"rows"},{caption:i.textColumns,value:"columns"},{caption:i.textClear,value:"clear"}]});i.btnUngroup.setMenu(e),i.btnGroup.updateHint(i.tipGroup),e=new Common.UI.Menu({items:[{caption:i.textGroupRows,value:"rows"},{caption:i.textGroupColumns,value:"columns"},{caption:"--"},{caption:i.textBelow,value:"below",checkable:!0},{caption:i.textRightOf,value:"right",checkable:!0}]}),i.btnGroup.setMenu(e),i.btnDataFromText.updateHint(i.tipDataFromText),i.btnDataFromText.menu&&i.btnDataFromText.setMenu(new Common.UI.Menu({items:[{caption:i.mniFromFile,value:"file"},{caption:i.mniFromUrl,value:"url"},{caption:"--"},{caption:i.mniFromXMLFile,value:"xml"}]})),i.toolbar.mode.isDesktopApp&&i.btnDataFromText.menu.items[1].setVisible(!1),i.btnTextToColumns.updateHint(i.tipToColumns),i.btnRemoveDuplicates.updateHint(i.tipRemDuplicates),i.btnDataValidation.updateHint(i.tipDataValidation),i.btnExternalLinks.updateHint(i.tipExternalLinks),i.btnGoalSeek.updateHint(i.tipGoalSeek),i.btnsSortDown.forEach((function(t){t.updateHint(i.toolbar.txtSortAZ)})),i.btnsSortUp.forEach((function(t){t.updateHint(i.toolbar.txtSortZA)})),i.btnsSetAutofilter.forEach((function(t){t.updateHint(i.toolbar.txtFilter+" (Ctrl+Shift+L)")})),i.btnsClearAutofilter.forEach((function(t){t.updateHint(i.toolbar.txtClearFilter)})),i.btnCustomSort.updateHint(i.tipCustomSort),t.call(i)}))},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButtons:function(t){return"sort-down"==t?this.btnsSortDown:"sort-up"==t?this.btnsSortUp:"sort-custom"==t?this.btnCustomSort:"set-filter"==t?this.btnsSetAutofilter:"clear-filter"==t?this.btnsClearAutofilter:"rem-duplicates"==t?this.btnRemoveDuplicates:"data-validation"==t?this.btnDataValidation:void 0===t?this.lockedControls:[]},SetDisabled:function(t){this.lockedControls&&this.lockedControls.forEach((function(e){e&&e.setDisabled(t)}),this)},capBtnGroup:"Group",capBtnUngroup:"Ungroup",textRows:"Ungroup rows",textColumns:"Ungroup columns",textGroupRows:"Group rows",textGroupColumns:"Group columns",textClear:"Clear outline",tipGroup:"Group range of cells",tipUngroup:"Ungroup range of cells",capBtnTextToCol:"Text to Columns",tipToColumns:"Separate cell text into columns",capBtnTextShow:"Show details",capBtnTextHide:"Hide details",textBelow:"Summary rows below detail",textRightOf:"Summary columns to right of detail",capBtnTextCustomSort:"Custom Sort",tipCustomSort:"Custom sort",capBtnTextRemDuplicates:"Remove Duplicates",tipRemDuplicates:"Remove duplicate rows from a sheet",capBtnTextDataValidation:"Data Validation",tipDataValidation:"Data validation",capDataFromText:"From Text/CSV",tipDataFromText:"Get data from file",mniFromFile:"Get Data from File",mniFromUrl:"Get Data from URL",capDataExternalLinks:"External Links",tipExternalLinks:"View other files this spreadsheet is linked to",mniFromXMLFile:"From Local XML",capGoalSeek:"Goal Seek",tipGoalSeek:"Find the right input for the value you want"}}(),SSE.Views.DataTab||{}))})),define("spreadsheeteditor/main/app/controller/DataTab",["core","spreadsheeteditor/main/app/view/DataTab"],(function(){"use strict";SSE.Controllers.DataTab=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["DataTab"],sdkViewName:"#id_main",initialize:function(){this._state={CSVOptions:new Asc.asc_CTextOptions(0,4,"")},this.externalData={stackRequests:[],stackResponse:[],callback:void 0,isUpdating:!1,linkStatus:{}},this.externalSource={externalRef:void 0}},onLaunch:function(){},setApi:function(t){return t&&(this.api=t,this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onSelectionChanged,this)),this.api.asc_registerCallback("asc_onWorksheetLocked",_.bind(this.onWorksheetLocked,this)),this.api.asc_registerCallback("asc_onChangeProtectWorkbook",_.bind(this.onChangeProtectWorkbook,this)),this.api.asc_registerCallback("asc_onGoalSeekUpdate",_.bind(this.onUpdateGoalSeekStatus,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("protect:wslock",_.bind(this.onChangeProtectSheet,this)),Common.NotificationCenter.on("document:ready",_.bind(this.onDocumentReady,this))),this},setConfig:function(t){this.toolbar=t.toolbar,this.view=this.createView("DataTab",{toolbar:this.toolbar.toolbar}),this.addListeners({DataTab:{"data:group":this.onGroup,"data:ungroup":this.onUngroup,"data:tocolumns":this.onTextToColumn,"data:show":this.onShowClick,"data:hide":this.onHideClick,"data:groupsettings":this.onGroupSettings,"data:sortcustom":this.onCustomSort,"data:remduplicates":this.onRemoveDuplicates,"data:datavalidation":this.onDataValidation,"data:fromtext":this.onDataFromText,"data:externallinks":this.onExternalLinks,"data:goalseek":this.onGoalSeek},Statusbar:{"sheet:changed":this.onApiSheetChanged}}),Common.NotificationCenter.on("data:remduplicates",_.bind(this.onRemoveDuplicates,this)),Common.NotificationCenter.on("data:sortcustom",_.bind(this.onCustomSort,this)),(this.toolbar.mode.canRequestReferenceData||this.toolbar.mode.isOffline)&&this.api&&(this.api.asc_registerCallback("asc_onNeedUpdateExternalReferenceOnOpen",_.bind(this.onNeedUpdateExternalReferenceOnOpen,this)),this.api.asc_registerCallback("asc_onStartUpdateExternalReference",_.bind(this.onStartUpdateExternalReference,this)),this.api.asc_registerCallback("asc_onUpdateExternalReference",_.bind(this.onUpdateExternalReference,this)),this.api.asc_registerCallback("asc_onErrorUpdateExternalReference",_.bind(this.onErrorUpdateExternalReference,this)),this.api.asc_registerCallback("asc_onNeedUpdateExternalReference",_.bind(this.onNeedUpdateExternalReference,this)),Common.Gateway.on("setreferencedata",_.bind(this.setReferenceData,this))),this.toolbar.mode.canRequestReferenceSource&&Common.Gateway.on("setreferencesource",_.bind(this.setReferenceSource,this))},SetDisabled:function(t){this.view&&this.view.SetDisabled(t)},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onCoAuthoringDisconnect:function(){this.SetDisabled(!0)},onSelectionChanged:function(t){if(this.toolbar.editMode&&this.view){var e=this.view;Common.Utils.lockControls(Common.enumLock.multiselectCols,t.asc_getSelectedColsCount()>1,{array:[e.btnTextToColumns]}),Common.Utils.lockControls(Common.enumLock.multiselect,t.asc_getMultiselect(),{array:[e.btnTextToColumns]}),Common.Utils.lockControls(Common.enumLock.userProtected,t.asc_getUserProtected(),{array:e.lockedControls})}},onUngroup:function(t){var e=this;if("rows"==t)void 0!==e.api.asc_checkAddGroup(!0)&&e.api.asc_ungroup(!0);else if("columns"==t)void 0!==e.api.asc_checkAddGroup(!0)&&e.api.asc_ungroup(!1);else if("clear"==t)e.api.asc_clearOutline();else{var i=e.api.asc_checkAddGroup(!0);null===i?new Common.Views.OptionsDialog({title:e.view.capBtnUngroup,items:[{caption:this.textRows,value:!0,checked:!0},{caption:this.textColumns,value:!1,checked:!1}],handler:function(t,i){"ok"==i&&e.api.asc_ungroup(t.getSettings()),Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}).show():void 0!==i&&e.api.asc_ungroup(i)}Common.NotificationCenter.trigger("edit:complete",e.toolbar)},onGroup:function(t,e){if("rows"==t)void 0!==this.api.asc_checkAddGroup()&&this.api.asc_group(!0);else if("columns"==t)void 0!==this.api.asc_checkAddGroup()&&this.api.asc_group(!1);else if("below"==t)this.api.asc_setGroupSummary(e,!1);else if("right"==t)this.api.asc_setGroupSummary(e,!0);else{var i=this,o=i.api.asc_checkAddGroup();null===o?new Common.Views.OptionsDialog({title:i.view.capBtnGroup,items:[{caption:this.textRows,value:!0,checked:!0},{caption:this.textColumns,value:!1,checked:!1}],handler:function(t,e){"ok"==e&&i.api.asc_group(t.getSettings()),Common.NotificationCenter.trigger("edit:complete",i.toolbar)}}).show():void 0!==o&&i.api.asc_group(o)}Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onGroupSettings:function(t){var e=this.api.asc_getGroupSummaryBelow();t.items[3].setChecked(!!e,!0),e=this.api.asc_getGroupSummaryRight(),t.items[4].setChecked(!!e,!0)},onTextToColumn:function(){this.api.asc_TextImport(this._state.CSVOptions.asc_getCodePage(),_.bind(this.onTextToColumnCallback,this),!1)},onTextToColumnCallback:function(t){if(t&&t.length){var e=this;new Common.Views.OpenDialog({title:e.textWizard,closable:!0,type:Common.Utils.importTextType.Columns,preview:!0,previewData:t,settings:e._state.CSVOptions,api:e.api,handler:function(t,i){"ok"==t&&e.api&&e.api.asc_TextToColumns(i.textOptions)}}).show()}},onDataFromText:function(t){var e=this;"file"===t?(this.api&&this.api.asc_TextFromFileOrUrl(this._state.CSVOptions,_.bind(this.onDataFromTextCallback,this)),Common.NotificationCenter.trigger("edit:complete",this.toolbar)):"url"===t?new Common.Views.ImageFromUrlDialog({label:e.txtUrlTitle,handler:function(t,i){if("ok"==t){if(e.api){var o=i.replace(/\s/g,"");_.isEmpty(o)?Common.UI.warning({msg:e.textEmptyUrl}):e.api.asc_TextFromFileOrUrl(e._state.CSVOptions,_.bind(e.onDataFromTextCallback,e),o)}Common.NotificationCenter.trigger("edit:complete",e.toolbar)}}}).show():"storage"===t||"xml"===t&&(Common.Utils.InternalSettings.set("import-xml-start",!0),this.api&&this.api.asc_ImportXmlStart(_.bind(this.onDataFromXMLCallback,this)))},onDataFromTextCallback:function(t){var e=this;new Common.Views.OpenDialog({title:e.txtImportWizard,closable:!0,type:Common.Utils.importTextType.Data,preview:t.asc_getData(),settings:t?t.asc_getRecommendedSettings():e._state.CSVOptions,codepages:t?t.asc_getCodePages():null,api:e.api,handler:function(t,i){"ok"==t&&e.api&&e.api.asc_TextToColumns(i.textOptions,i.data,i.range)}}).show()},onDataFromXMLCallback:function(t){if(setTimeout((function(){Common.Utils.InternalSettings.set("import-xml-start",!1)}),500),t){var e=this;new SSE.Views.ImportFromXmlDialog({api:e.api,handler:function(i,o){"ok"==i&&o&&(o.destination?e.api.asc_ImportXmlEnd(t,o.destination,e.api.asc_getWorksheetName(e.api.asc_getActiveWorksheetIndex())):e.api.asc_ImportXmlEnd(t,null,e.createSheetName())),Common.NotificationCenter.trigger("edit:complete",e)}}).show()}},createSheetName:function(){for(var t=[],e=this.api.asc_getWorksheetsCount();e--;)t.push(this.api.asc_getWorksheetName(e).toLowerCase());for(var i,o=0;++o<1e3&&(i=this.strSheet+o,!(t.indexOf(i.toLowerCase())<0)););return i},onShowClick:function(){this.api.asc_changeGroupDetails(!0)},onHideClick:function(){this.api.asc_changeGroupDetails(!1)},onCustomSort:function(){Common.NotificationCenter.trigger("protect:check",this.onCustomSortCallback,this)},onCustomSortCallback:function(){var t=this;if(this.api){var e=this.api.asc_sortCellsRangeExpand();switch(e){case Asc.c_oAscSelectionSortExpand.showExpandMessage:var i={width:500,title:this.toolbar.txtSorting,msg:this.toolbar.txtExpandSort,buttons:[{caption:this.toolbar.txtExpand,primary:!0,value:"expand"},{caption:this.toolbar.txtSortSelected,value:"sort"},"cancel"],callback:function(e){"expand"!=e&&"sort"!=e||setTimeout((function(){t.showCustomSort("expand"==e)}),1)}};Common.UI.alert(i);break;case Asc.c_oAscSelectionSortExpand.showLockMessage:i={width:500,title:this.toolbar.txtSorting,msg:this.toolbar.txtLockSort,buttons:["yes","no"],primary:"yes",callback:function(e){"yes"==e&&setTimeout((function(){t.showCustomSort(!1)}),1)}};Common.UI.alert(i);break;case Asc.c_oAscSelectionSortExpand.expandAndNotShowMessage:case Asc.c_oAscSelectionSortExpand.notExpandAndNotShowMessage:t.showCustomSort(e===Asc.c_oAscSelectionSortExpand.expandAndNotShowMessage)}}},showCustomSort:function(t){if(this.api.asc_getCellInfo().asc_getPivotTableInfo()){var e=this.api.asc_getPivotInfo();if(e){var i=new SSE.Views.SortFilterDialog({api:this.api}).on({close:function(){Common.NotificationCenter.trigger("edit:complete")}});i.setSettings({filter:e.asc_getFilter(),rowFilter:e.asc_getFilterRow(),colFilter:e.asc_getFilterCol()}),i.show()}}else{var o=this,n=o.api.asc_getSortProps(t);n&&new SSE.Views.SortDialog({props:n,api:o.api,handler:function(t,e){o&&o.api&&o.api.asc_setSortProps(e,"ok"!=t)}}).show()}},onRemoveDuplicates:function(){var t=this;if(this.api){var e=this.api.asc_sortCellsRangeExpand();if(e===Asc.c_oAscSelectionSortExpand.showExpandMessage){var i={width:500,title:this.txtRemDuplicates,msg:this.txtExpandRemDuplicates,buttons:[{caption:this.txtExpand,primary:!0,value:"expand"},{caption:this.txtRemSelected,value:"remove"},"cancel"],callback:function(e){"expand"!=e&&"remove"!=e||setTimeout((function(){t.showRemDuplicates("expand"==e)}),1)}};Common.UI.alert(i)}else e!==Asc.c_oAscSelectionSortExpand.showLockMessage&&t.showRemDuplicates(e===Asc.c_oAscSelectionSortExpand.expandAndNotShowMessage)}},showRemDuplicates:function(t){var e=this,i=e.api.asc_getRemoveDuplicates(t);i&&new SSE.Views.RemoveDuplicatesDialog({props:i,api:e.api,handler:function(t,i){e&&e.api&&e.api.asc_setRemoveDuplicates(i,"ok"!=t)}}).show()},onDataValidation:function(){var t=this;if(this.api){var e=this.api.asc_getDataValidationProps();if("object"!==_typeof(e)){var i={maxwidth:500,title:this.txtDataValidation,msg:e===Asc.c_oAscError.ID.MoreOneTypeDataValidate?this.txtRemoveDataValidation:this.txtExtendDataValidation,buttons:e===Asc.c_oAscError.ID.MoreOneTypeDataValidate?["ok","cancel"]:["yes","no","cancel"],primary:e===Asc.c_oAscError.ID.MoreOneTypeDataValidate?"ok":["yes","no"],callback:function(e){"yes"!=e&&"no"!=e&&"ok"!=e||setTimeout((function(){var i=t.api.asc_getDataValidationProps("ok"==e?null:"yes"==e);t.showDataValidation(i)}),1)}};Common.UI.alert(i)}else t.showDataValidation(e)}},showDataValidation:function(t){var e=this;t&&new SSE.Views.DataValidationDialog({title:this.txtDataValidation,props:t,api:e.api,handler:function(t,i){e&&e.api&&"ok"==t&&e.api.asc_setDataValidation(i)}}).show()},onExternalLinks:function(){var t=this;this.externalLinksDlg=new SSE.Views.ExternalLinksDlg({api:this.api,isUpdating:this.externalData.isUpdating,canRequestReferenceData:this.toolbar.mode.canRequestReferenceData||this.toolbar.mode.isOffline,canRequestOpen:this.toolbar.mode.canRequestOpen||this.toolbar.mode.isOffline,canRequestReferenceSource:this.toolbar.mode.canRequestReferenceSource||this.toolbar.mode.isOffline,isOffline:this.toolbar.mode.isOffline,handler:function(t){Common.NotificationCenter.trigger("edit:complete")}}),this.externalLinksDlg.on("close",(function(e){t.externalLinksDlg=null})),this.externalLinksDlg.on("change:source",(function(e,i){t.externalSource={externalRef:i},Common.Gateway.requestReferenceSource()})),this.externalLinksDlg.show()},onGoalSeek:function(){var t=this;new SSE.Views.GoalSeekDlg({api:t.api,handler:function(e,i){"ok"==e&&i&&t.api.asc_StartGoalSeek(i.formulaCell,i.expectedValue,i.changingCell),Common.NotificationCenter.trigger("edit:complete")}}).show()},onUpdateGoalSeekStatus:function(t,e,i,o){var n=this;this.GoalSeekStatusDlg||(this.GoalSeekStatusDlg=new SSE.Views.GoalSeekStatusDlg({api:n.api,handler:function(t){n.api.asc_CloseGoalClose("ok"==t),n.GoalSeekStatusDlg=void 0,Common.NotificationCenter.trigger("edit:complete")}}),this.GoalSeekStatusDlg.on("close",(function(){void 0!==n.GoalSeekStatusDlg&&(n.api.asc_CloseGoalClose(!1),n.GoalSeekStatusDlg=void 0)})),this.GoalSeekStatusDlg.show()),this.GoalSeekStatusDlg.setSettings({targetValue:t,currentValue:e,iteration:i,cellName:o})},onUpdateExternalReference:function(t,e){if(this.toolbar.mode.isEdit&&this.toolbar.editMode){var i=this;i.externalData={stackRequests:[],stackResponse:[],callback:void 0,isUpdating:!1,linkStatus:{}},t&&t.length>0&&t.forEach((function(t){var e;switch(t.asc_getType()){case Asc.c_oAscExternalReferenceType.link:e={link:t.asc_getData()};break;case Asc.c_oAscExternalReferenceType.path:e={path:t.asc_getData()};break;case Asc.c_oAscExternalReferenceType.referenceData:e={referenceData:t.asc_getData(),path:t.asc_getPath(),link:t.asc_getLink()}}e&&i.externalData.stackRequests.push({data:e,id:t.asc_getId(),isExternal:t.asc_isExternalLink()})})),i.externalData.callback=e,i.requestReferenceData()}},requestReferenceData:function(){if(this.externalData.stackRequests.length>0){var t=this.externalData.stackRequests.shift();this.externalData.linkStatus.id=t.id,this.externalData.linkStatus.isExternal=t.isExternal,Common.Gateway.requestReferenceData(t.data)}},setReferenceData:function(t){this.toolbar.mode.isEdit&&this.toolbar.editMode&&(t&&(this.externalData.stackResponse.push(t),this.externalData.linkStatus.result=this.externalData.linkStatus.isExternal?"":t.error||"",this.externalLinksDlg&&this.externalLinksDlg.setLinkStatus(this.externalData.linkStatus.id,this.externalData.linkStatus.result)),this.externalData.stackRequests.length>0?this.requestReferenceData():this.externalData.callback&&this.externalData.callback(this.externalData.stackResponse))},onStartUpdateExternalReference:function(t){this.externalData.isUpdating=t,this.externalLinksDlg&&this.externalLinksDlg.setIsUpdating(t)},onNeedUpdateExternalReferenceOnOpen:function(){var t=this.api.asc_getUpdateLinks();Common.UI.warning({msg:t?this.warnUpdateExternalAutoupdate:this.warnUpdateExternalData,buttons:[{value:"ok",caption:t?this.textContinue:this.textUpdate,primary:!0},{value:"cancel",caption:t?this.textTurnOff:this.textDontUpdate}],maxwidth:500,callback:_.bind((function(e){if("ok"===e){var i=this.api.asc_getExternalReferences();i&&i.length>0&&this.api.asc_updateExternalReferences(i)}t&&this.api.asc_setUpdateLinks("ok"===e,!0)}),this)})},onErrorUpdateExternalReference:function(t){this.externalLinksDlg&&this.externalLinksDlg.setLinkStatus(t,this.txtErrorExternalLink)},onNeedUpdateExternalReference:function(){Common.NotificationCenter.trigger("showmessage",{msg:this.textAddExternalData})},setReferenceSource:function(t){this.toolbar.mode.isEdit&&this.toolbar.editMode&&this.api.asc_changeExternalReference(this.externalSource.externalRef,t)},onWorksheetLocked:function(t,e){t==this.api.asc_getActiveWorksheetIndex()&&Common.Utils.lockControls(Common.enumLock.sheetLock,e,{array:this.view.btnsSortDown.concat(this.view.btnsSortUp,this.view.btnCustomSort,this.view.btnGroup,this.view.btnUngroup)})},onChangeProtectWorkbook:function(){Common.Utils.lockControls(Common.enumLock.wbLock,this.api.asc_isProtectedWorkbook(),{array:[this.view.btnDataFromText,this.view.btnExternalLinks]})},onApiSheetChanged:function(){if(this.toolbar.mode&&this.toolbar.mode.isEdit&&!this.toolbar.mode.isEditDiagram&&!this.toolbar.mode.isEditMailMerge&&!this.toolbar.mode.isEditOle){var t=this.api.asc_getActiveWorksheetIndex();this.onWorksheetLocked(t,this.api.asc_isWorksheetLockedOrDeleted(t))}},onChangeProtectSheet:function(t){if(!t){var e=this.getApplication().getController("WBProtection");t=e?e.getWSProps():null}t&&t.wsProps&&Common.Utils.lockControls(Common.enumLock.Sort,t.wsProps.Sort,{array:this.view.btnsSortDown.concat(this.view.btnsSortUp,this.view.btnCustomSort)})},onDocumentReady:function(){this.onChangeProtectSheet()},textWizard:"Text to Columns Wizard",txtRemDuplicates:"Remove Duplicates",txtExpandRemDuplicates:"The data next to the selection will not be removed. Do you want to expand the selection to include the adjacent data or continue with the currently selected cells only?",txtExpand:"Expand",txtRemSelected:"Remove in selected",textRows:"Rows",textColumns:"Columns",txtDataValidation:"Data Validation",txtExtendDataValidation:"The selection contains some cells without Data Validation settings.<br>Do you want to extend Data Validation to these cells?",txtRemoveDataValidation:"The selection contains more than one type of validation.<br>Erase current settings and continue?",textEmptyUrl:"You need to specify URL.",txtImportWizard:"Text Import Wizard",txtUrlTitle:"Paste a data URL",txtErrorExternalLink:"Error: updating is failed",strSheet:"Sheet",warnUpdateExternalData:"This workbook contains links to one or more external sources that could be unsafe.<br>If you trust the links, update them to get the latest data.",textUpdate:"Update",textDontUpdate:"Don't Update",textAddExternalData:"The link to an external source has been added. You can update such links in the Data tab.",warnUpdateExternalAutoupdate:"This workbook contains links that are updated automatically from external sources that could be unsafe.<br>If you trust the links, press 'Continue' to update.",textTurnOff:"Turn off auto update",textContinue:"Continue"},SSE.Controllers.DataTab||{}))})),define("spreadsheeteditor/main/app/view/ViewTab",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout"],(function(){"use strict";SSE.Views.ViewTab=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;t.appConfig.canFeatureViews&&t.appConfig.isEdit&&(t.btnCloseView.on("click",(function(e,i){t.fireEvent("viewtab:openview",[{name:"default",value:"default"}])})),t.btnCreateView.on("click",(function(e,i){t.fireEvent("viewtab:createview")}))),t.btnFreezePanes&&t.btnFreezePanes.menu&&"object"===_typeof(t.btnFreezePanes.menu)&&t.btnFreezePanes.menu.on("item:click",(function(e,i,o){"shadow"===i.value?t.fireEvent("viewtab:freezeshadow",[i.checked]):t.fireEvent("viewtab:freeze",[i.value])})),this.chFormula.on("change",(function(e,i){t.fireEvent("viewtab:formula",[0,"checked"==i])})),this.chHeadings&&this.chHeadings.on("change",(function(e,i){t.fireEvent("viewtab:headings",[1,"checked"==i])})),this.chGridlines&&this.chGridlines.on("change",(function(e,i){t.fireEvent("viewtab:gridlines",[2,"checked"==i])})),this.chZeros&&this.chZeros.on("change",(function(e,i){t.fireEvent("viewtab:zeros",[3,"checked"==i])})),this.chToolbar.on("change",(function(e,i){t.fireEvent("viewtab:showtoolbar",[e,"checked"!==i])})),this.chStatusbar.on("change",(function(e,i){t.fireEvent("statusbar:setcompact",[e,"checked"===i])})),this.cmbZoom.on("selected",(function(e,i){t.fireEvent("zoom:selected",[e,i])})).on("changed:before",(function(e,i){t.fireEvent("zoom:changedbefore",[!0,e,i])})).on("changed:after",(function(e,i){t.fireEvent("zoom:changedafter",[!1,e,i])})).on("combo:blur",(function(){t.fireEvent("editcomplete",t)})).on("combo:focusin",_.bind(this.onComboOpen,this,!1)).on("show:after",_.bind(this.onComboOpen,this,!0)),t.chLeftMenu.on("change",_.bind((function(e,i){t.fireEvent("leftmenu:hide",[t.chLeftMenu,"checked"===i])}),t)),t.chRightMenu.on("change",_.bind((function(e,i){t.fireEvent("rightmenu:hide",[t.chRightMenu,"checked"===i])}),t)),t.btnMacros&&t.btnMacros.on("click",(function(){t.fireEvent("macros:click")})),t.btnViewNormal&&t.btnViewNormal.on("click",(function(e,i){e.pressed&&t.fireEvent("viewtab:viewmode",[Asc.c_oAscESheetViewType.normal])})),t.btnViewPageBreak&&t.btnViewPageBreak.on("click",(function(e,i){e.pressed&&t.fireEvent("viewtab:viewmode",[Asc.c_oAscESheetViewType.pageBreakPreview])}))}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this),this.toolbar=t.toolbar,this.appConfig=t.mode,this.lockedControls=[];var e=this,i=Common.enumLock;e.appConfig.canFeatureViews&&e.appConfig.isEdit&&(this.btnSheetView=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-big-sheet-view",caption:e.capBtnSheetView,lock:[i.lostConnect,i.coAuth,i.editCell],menu:!0,action:"sheet-view",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnSheetView),this.btnCreateView=new Common.UI.Button({id:"id-toolbar-btn-createview",cls:"btn-toolbar",iconCls:"toolbar__icon btn-sheet-view-new",caption:this.textCreate,lock:[i.coAuth,i.lostConnect,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"big"}),this.lockedControls.push(this.btnCreateView),this.btnCloseView=new Common.UI.Button({id:"id-toolbar-btn-closeview",cls:"btn-toolbar",iconCls:"toolbar__icon btn-sheet-view-close",caption:this.textClose,lock:[i.sheetView,i.coAuth,i.lostConnect,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"big"}),this.lockedControls.push(this.btnCloseView)),e.appConfig.isEdit&&(this.btnFreezePanes=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-freeze-panes",caption:this.capBtnFreeze,menu:!0,action:"freeze-panes",lock:[i.sheetLock,i.lostConnect,i.coAuth,i.editCell],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnFreezePanes),this.chHeadings=new Common.UI.CheckBox({labelText:this.textHeadings,lock:[i.sheetLock,i.lostConnect,i.coAuth,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chHeadings),this.chGridlines=new Common.UI.CheckBox({labelText:this.textGridlines,lock:[i.sheetLock,i.lostConnect,i.coAuth,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chGridlines),this.chZeros=new Common.UI.CheckBox({labelText:this.textZeros,lock:[i.sheetLock,i.lostConnect,i.coAuth,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chZeros),this.btnViewNormal=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-normal-view",enableToggle:!0,allowDepress:!1,caption:this.txtViewNormal,lock:[i.sheetLock,i.lostConnect,i.coAuth,i.editCell],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnViewNormal),this.btnViewPageBreak=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-page-break-preview",enableToggle:!0,allowDepress:!1,caption:this.txtViewPageBreak,lock:[i.sheetLock,i.lostConnect,i.coAuth,i.editCell],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnViewPageBreak),this.btnMacros=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-macros",lock:[i.selRangeEdit,i.editFormula,i.lostConnect,i.disableOnStart],caption:this.textMacros,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnMacros)),this.cmbZoom=new Common.UI.ComboBox({cls:"input-group-nr",menuStyle:"min-width: 55px;",hint:e.tipFontSize,editable:!0,lock:[i.lostConnect,i.editCell],data:[{displayValue:"50%",value:50},{displayValue:"75%",value:75},{displayValue:"100%",value:100},{displayValue:"125%",value:125},{displayValue:"150%",value:150},{displayValue:"175%",value:175},{displayValue:"200%",value:200},{displayValue:"300%",value:300},{displayValue:"400%",value:400},{displayValue:"500%",value:500}],dataHint:"1",dataHintDirection:"top",dataHintOffset:"small"}),this.lockedControls.push(this.cmbZoom),this.btnInterfaceTheme=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-day",caption:this.textInterfaceTheme,menu:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small",action:"interface-theme"}),this.lockedControls.push(this.btnInterfaceTheme),this.chFormula=new Common.UI.CheckBox({labelText:this.textFormula,value:!Common.localStorage.getBool("sse-hidden-formula"),lock:[i.lostConnect,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chFormula),this.chStatusbar=new Common.UI.CheckBox({labelText:this.textCombineSheetAndStatusBars,value:Common.localStorage.getBool("sse-compact-statusbar",!0),lock:[i.lostConnect,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chStatusbar),this.chToolbar=new Common.UI.CheckBox({labelText:this.textAlwaysShowToolbar,value:!t.compactToolbar,lock:[i.lostConnect,i.editCell],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chToolbar),this.chRightMenu=new Common.UI.CheckBox({lock:[i.lostConnect],labelText:Common.UI.isRTL()?this.textLeftMenu:this.textRightMenu,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chRightMenu),this.chLeftMenu=new Common.UI.CheckBox({lock:[i.lostConnect],labelText:Common.UI.isRTL()?this.textRightMenu:this.textLeftMenu,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chLeftMenu),Common.UI.LayoutManager.addControls(this.lockedControls),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return t&&t.html(this.getPanel()),this},getPanel:function(){this.$el=$(_.template('<section class="panel" data-tab="view" role="tabpanel" aria-labelledby="view"><div class="group sheet-views"><span class="btn-slot text x-huge" id="slot-btn-sheet-view"></span></div><div class="group sheet-views small"><div class="elset"><span class="btn-slot text" id="slot-createview"></span></div><div class="elset"><span class="btn-slot text" id="slot-closeview"></span></div></div><div class="separator long sheet-views"></div><div class="group doc-preview"><span class="btn-slot text x-huge" id="slot-btn-view-normal"></span><span class="btn-slot text x-huge" id="slot-btn-view-pagebreak"></span></div><div class="separator long doc-preview"></div><div class="group small"><div class="elset" style="display: flex;"><span class="btn-slot" id="slot-field-zoom" style="flex-grow: 1;"></span></div><div class="elset" style="text-align: center;"><span class="btn-slot text font-size-normal" id="slot-lbl-zoom" style="text-align: center;margin-top: 4px;"></span></div></div><div class="separator long"></div><div class="group"><span class="btn-slot text x-huge" id="slot-btn-interface-theme"></span></div><div class="separator long separator-theme"></div><div class="group sheet-freeze"><span class="btn-slot text x-huge" id="slot-btn-freeze"></span></div><div class="separator long sheet-freeze"></div><div class="group small sheet-formula"><div class="elset"><span class="btn-slot text" id="slot-chk-formula"></span></div><div class="elset"><span class="btn-slot text" id="slot-chk-heading"></span></div></div><div class="group small sheet-gridlines"><div class="elset"><span class="btn-slot text" id="slot-chk-gridlines"></span></div><div class="elset"><span class="btn-slot text" id="slot-chk-zeros"></span></div></div><div class="separator long separator-formula"></div><div class="group small"><div class="elset"><span class="btn-slot text" id="slot-chk-toolbar"></span></div><div class="elset"><span class="btn-slot text" id="slot-chk-statusbar"></span></div></div><div class="group small"><div class="elset"><span class="btn-slot text" id="slot-chk-leftmenu"></span></div><div class="elset"><span class="btn-slot text" id="slot-chk-rightmenu"></span></div></div><div class="separator long"></div><div class="group"><span class="btn-slot text x-huge" id="slot-btn-macros"></span></div></section>')({}));var t=this.$el;return this.btnSheetView&&this.btnSheetView.render(t.find("#slot-btn-sheet-view")),this.btnCreateView&&this.btnCreateView.render(t.find("#slot-createview")),this.btnCloseView&&this.btnCloseView.render(t.find("#slot-closeview")),this.btnFreezePanes&&this.btnFreezePanes.render(t.find("#slot-btn-freeze")),this.cmbZoom.render(t.find("#slot-field-zoom")),this.cmbZoom.setValue(100),t.find("#slot-lbl-zoom").text(this.textZoom),this.btnInterfaceTheme.render(t.find("#slot-btn-interface-theme")),this.chFormula.render(t.find("#slot-chk-formula")),this.chStatusbar.render(t.find("#slot-chk-statusbar")),this.chToolbar.render(t.find("#slot-chk-toolbar")),this.chHeadings&&this.chHeadings.render(t.find("#slot-chk-heading")),this.chGridlines&&this.chGridlines.render(t.find("#slot-chk-gridlines")),this.chZeros&&this.chZeros.render(t.find("#slot-chk-zeros")),this.chLeftMenu.render(t.find("#slot-chk-leftmenu")),this.chRightMenu.render(t.find("#slot-chk-rightmenu")),this.btnMacros&&this.btnMacros.render(t.find("#slot-btn-macros")),this.btnViewNormal&&this.btnViewNormal.render(t.find("#slot-btn-view-normal")),this.btnViewPageBreak&&this.btnViewPageBreak.render(t.find("#slot-btn-view-pagebreak")),this.$el},onAppReady:function(e){var i=this;new Promise((function(t,e){t()})).then((function(){e.canFeatureViews&&i.appConfig.isEdit?(i.btnSheetView.updateHint(i.tipSheetView),i.setButtonMenu(i.btnSheetView),i.btnCreateView.updateHint(i.tipCreate),i.btnCloseView.updateHint(i.tipClose)):(i.toolbar&&i.toolbar.$el.find(".group.sheet-views").hide(),i.toolbar&&i.toolbar.$el.find(".separator.sheet-views").hide()),i.btnMacros&&i.btnMacros.updateHint(i.tipMacros),i.btnInterfaceTheme.updateHint(i.tipInterfaceTheme),e.isEdit?(i.btnFreezePanes.setMenu(new Common.UI.Menu({items:[{caption:i.toolbar&&i.toolbar.api&&i.toolbar.api.asc_getSheetViewSettings().asc_getIsFreezePane()?i.textUnFreeze:i.capBtnFreeze,value:void 0},{caption:i.textFreezeRow,value:Asc.c_oAscFrozenPaneAddType.firstRow},{caption:i.textFreezeCol,value:Asc.c_oAscFrozenPaneAddType.firstCol},{caption:"--"},{caption:i.textShowFrozenPanesShadow,value:"shadow",checkable:!0,checked:Common.localStorage.getBool("sse-freeze-shadow",!0)}]})),i.btnFreezePanes.updateHint(i.tipFreeze),i.btnViewNormal.updateHint(i.tipViewNormal),i.btnViewPageBreak.updateHint(i.tipViewPageBreak)):(i.toolbar&&i.toolbar.$el.find(".group.doc-preview").hide(),i.toolbar&&i.toolbar.$el.find(".separator.doc-preview").hide(),i.toolbar&&i.toolbar.$el.find(".group.sheet-freeze").hide(),i.toolbar&&i.toolbar.$el.find(".separator.sheet-freeze").hide(),i.toolbar&&i.toolbar.$el.find(".group.sheet-gridlines").hide(),i.toolbar.$el.find("#slot-btn-macros").closest(".group").prev().addBack().remove()),Common.UI.Themes.available()||(i.btnInterfaceTheme.$el.closest(".group").remove(),i.$el.find(".separator-theme").remove());var o=[];if((e.canBrandingExt&&e.customization&&!1===e.customization.statusBar||!Common.UI.LayoutManager.isElementVisible("statusBar"))&&(o.push(i.chStatusbar.$el.closest(".elset")),i.chStatusbar.$el.remove()),e.canBrandingExt&&e.customization&&!1===e.customization.leftMenu||!Common.UI.LayoutManager.isElementVisible("leftMenu")?(o.push(i.chLeftMenu.$el.closest(".elset")),i.chLeftMenu.$el.remove()):o.length>0&&(o.push(i.chLeftMenu.$el.closest(".elset")),o.shift().append(i.chLeftMenu.$el[0])),!e.isEdit||e.canBrandingExt&&e.customization&&!1===e.customization.rightMenu||!Common.UI.LayoutManager.isElementVisible("rightMenu")?(o.push(i.chRightMenu.$el.closest(".elset")),i.chRightMenu.$el.remove()):o.length>0&&(o.push(i.chRightMenu.$el.closest(".elset")),o.shift().append(i.chRightMenu.$el[0])),o.length>1&&o[o.length-1].closest(".group").remove(),Common.UI.Themes.available()){var n=function(){var t=this.btnInterfaceTheme;"object"==_typeof(t.menu)?t.menu.removeAll(!0):t.setMenu(new Common.UI.Menu);var e=Common.UI.Themes.currentThemeId()||Common.UI.Themes.defaultThemeId(),i=0;for(var o in Common.UI.Themes.map())t.menu.insertItem(i++,{value:o,caption:Common.UI.Themes.get(o).text,checked:o===e,checkable:!0,toggleGroup:"interface-theme"})};Common.NotificationCenter.on("uitheme:countchanged",n.bind(i)),n.call(i),i.btnInterfaceTheme.menu.getItemsLength(!0)&&i.btnInterfaceTheme.menu.on("item:click",_.bind((function(t,e){var i=e.value;Common.UI.Themes.setTheme(i)}),i))}var s=Common.UI.LayoutManager.getInitValue("leftMenu");s=void 0!==s&&!s,i.chLeftMenu.setValue(!Common.localStorage.getBool("sse-hidden-leftmenu",s)),s=void 0!==(s=Common.UI.LayoutManager.getInitValue("rightMenu"))&&!s,i.chRightMenu.setValue(!Common.localStorage.getBool("sse-hidden-rightmenu",s)),t.call(i),"view"===Common.Utils.InternalSettings.get("toolbar-active-tab")&&Common.NotificationCenter.trigger("tab:set-active","view")}))},setButtonMenu:function(t){var e=this,i=[{caption:e.textDefault,value:"default",checkable:!0,allowDepress:!1}];t.setMenu(new Common.UI.Menu({items:[{template:_.template('<div id="id-toolbar-sheet-view-menu-" style="display: flex;" class="open"></div>')},{caption:"--"},{caption:e.textManager,value:"manager"}]})),t.menu.items[2].on("click",(function(t,i){e.fireEvent("viewtab:manager")})),t.menu.on("show:after",(function(t,e){t._innerMenu.scroller.update({alwaysVisibleY:!0}),_.delay((function(){t._innerMenu&&t._innerMenu.cmpEl.focus()}),10)})).on("show:before",(function(t,i){e.fireEvent("viewtab:showview")}));var o=new Common.UI.Menu({maxHeight:300,cls:"internal-menu",items:i,outerMenu:{menu:t.menu,index:0}});o.render(t.menu.items[0].cmpEl.children(":first")),o.cmpEl.css({display:"block",position:"relative",left:0,top:0}),o.cmpEl.attr({tabindex:"-1"}),o.on("item:toggle",(function(t,i,o,n){o&&e.fireEvent("viewtab:openview",[{name:i.caption,value:i.value}])})),t.menu._innerMenu=o,t.menu.setInnerMenu([{menu:o,index:0}])},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButtons:function(t){return void 0===t?this.lockedControls:[]},SetDisabled:function(t){this.lockedControls&&this.lockedControls.forEach((function(e){e&&e.setDisabled(t)}),this)},onComboOpen:function(t,e,i,o){o&&o.fromKeyDown||_.delay((function(){var i=$("input",e.cmpEl).select();t?i.focus():e.isMenuOpen()||i.one("mouseup",(function(t){t.preventDefault()}))}),10)},capBtnSheetView:"Sheet View",capBtnFreeze:"Freeze Panes",textZoom:"Zoom",tipSheetView:"Sheet view",textDefault:"Default",textManager:"View manager",tipFreeze:"Freeze panes",tipCreate:"Create sheet view",tipClose:"Close sheet view",textCreate:"New",textClose:"Close",textFormula:"Formula bar",textHeadings:"Headings",textGridlines:"Gridlines",textFreezeRow:"Freeze Top Row",textFreezeCol:"Freeze First Column",textUnFreeze:"Unfreeze Panes",textZeros:"Show zeros",textCombineSheetAndStatusBars:"Combine sheet and status bars",textAlwaysShowToolbar:"Always show toolbar",textInterfaceTheme:"Interface theme",textShowFrozenPanesShadow:"Show frozen panes shadow",tipInterfaceTheme:"Interface theme",textLeftMenu:"Left panel",textRightMenu:"Right panel",txtViewNormal:"Normal",txtViewPageBreak:"Page Break Preview",tipViewNormal:"See your document in Normal view",tipViewPageBreak:"See where the page breaks will appear when your document is printed",textTabStyle:"Tab style",textFill:"Fill",textLine:"Line",textMacros:"Macros",tipMacros:"Macros"}}(),SSE.Views.ViewTab||{}))})),define("spreadsheeteditor/main/app/controller/ViewTab",["core","spreadsheeteditor/main/app/view/ViewTab"],(function(){"use strict";SSE.Controllers.ViewTab=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["ViewTab"],sdkViewName:"#id_main",initialize:function(){},onLaunch:function(){this._state={},Common.NotificationCenter.on("uitheme:changed",this.onThemeChanged.bind(this)),Common.NotificationCenter.on("tabstyle:changed",this.onTabStyleChange.bind(this))},setApi:function(t){return t&&(this.api=t,this.api.asc_registerCallback("asc_onZoomChanged",this.onApiZoomChange.bind(this)),this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onSelectionChanged,this)),this.api.asc_registerCallback("asc_onWorksheetLocked",_.bind(this.onWorksheetLocked,this)),this.api.asc_registerCallback("asc_onSheetsChanged",this.onApiSheetChanged.bind(this)),this.api.asc_registerCallback("asc_onUpdateSheetViewSettings",this.onApiSheetChanged.bind(this)),this.api.asc_registerCallback("asc_updateSheetViewType",this.onApiUpdateSheetViewType.bind(this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this))),this},setConfig:function(t){this.toolbar=t.toolbar;var e=t.mode;this.view=this.createView("ViewTab",{toolbar:this.toolbar.toolbar,mode:e,compactToolbar:this.toolbar.toolbar.isCompactView}),this.addListeners({ViewTab:{"zoom:selected":_.bind(this.onSelectedZoomValue,this),"zoom:changedbefore":_.bind(this.onZoomChanged,this),"zoom:changedafter":_.bind(this.onZoomChanged,this),"viewtab:freeze":this.onFreeze,"viewtab:freezeshadow":this.onFreezeShadow,"viewtab:formula":this.onViewSettings,"viewtab:headings":this.onViewSettings,"viewtab:gridlines":this.onViewSettings,"viewtab:zeros":this.onViewSettings,"viewtab:zoom":this.onZoom,"viewtab:showview":this.onShowView,"viewtab:openview":this.onOpenView,"viewtab:createview":this.onCreateView,"viewtab:manager":this.onOpenManager,"viewtab:viewmode":this.onPreviewMode,"macros:click":this.onClickMacros},Statusbar:{"sheet:changed":this.onApiSheetChanged.bind(this),"view:compact":_.bind((function(t,e){this.view.chStatusbar.setValue(e,!0)}),this)},Toolbar:{"view:compact":_.bind((function(t,e){this.view.chToolbar.setValue(!e,!0)}),this)},LeftMenu:{"view:hide":_.bind((function(t,e){this.view.chLeftMenu.setValue(!e,!0)}),this)},RightMenu:{"view:hide":_.bind((function(t,e){this.view.chRightMenu.setValue(!e,!0)}),this)}}),Common.NotificationCenter.on("layout:changed",_.bind(this.onLayoutChanged,this))},SetDisabled:function(t){this.view&&this.view.SetDisabled(t)},createToolbarPanel:function(){return this.view.getPanel()},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onCoAuthoringDisconnect:function(){this.SetDisabled(!0)},onSelectionChanged:function(t){this.toolbar.editMode&&this.view&&Common.Utils.lockControls(Common.enumLock.sheetView,this.api.asc_getActiveNamedSheetView&&!this.api.asc_getActiveNamedSheetView(this.api.asc_getActiveWorksheetIndex()),{array:[this.view.btnCloseView]})},onFreeze:function(t){this.api&&this.api.asc_freezePane(t),Common.NotificationCenter.trigger("edit:complete",this.view)},onFreezeShadow:function(t){this.api.asc_setFrozenPaneBorderType(t?Asc.c_oAscFrozenPaneBorderType.shadow:Asc.c_oAscFrozenPaneBorderType.line),Common.localStorage.setBool("sse-freeze-shadow",t),Common.NotificationCenter.trigger("edit:complete",this.view)},applyZoom:function(t){var e=Math.max(10,Math.min(500,t));this._state.zoomValue===e&&this.view.cmbZoom.setValue(this._state.zoomValue,this._state.zoomValue+"%"),this.api.asc_setZoom(e/100),Common.NotificationCenter.trigger("edit:complete",this.view)},onSelectedZoomValue:function(t,e){this.applyZoom(e.value)},onZoomChanged:function(t,e,i,o){var n=parseFloat(i.value);(void 0===this._state.zoomValue&&(this._state.zoomValue=100),t)?new RegExp("^\\s*(\\d*(\\.|,)?\\d+)\\s*(%)?\\s*$").exec(i.value)||(this.view.cmbZoom.setValue(this._state.zoomValue,this._state.zoomValue+"%"),Common.NotificationCenter.trigger("edit:complete",this.view)):this._state.zoomValue===n||isNaN(n)?i.value!==this._state.zoomValue+"%"&&this.view.cmbZoom.setValue(this._state.zoomValue,this._state.zoomValue+"%"):this.applyZoom(n)},onViewSettings:function(t,e){if(this.api)switch(t){case 1:this.api.asc_setDisplayHeadings(e);break;case 2:this.api.asc_setDisplayGridlines(e);break;case 3:this.api.asc_setShowZeros(e)}Common.NotificationCenter.trigger("edit:complete",this.view)},onShowView:function(){var t=this.api.asc_getNamedSheetViews(),e=this.view.btnSheetView.menu._innerMenu,i=!1;e.removeItems(1,e.items.length-1),_.each(t,(function(t,o){e.addItem(new Common.UI.MenuItem({caption:t.asc_getName(),checkable:!0,allowDepress:!1,checked:t.asc_getIsActive(),template:_.template(['<a id="<%= id %>" style="<%= style %>" tabindex="-1" type="menuitem">',"<%= Common.Utils.String.htmlEncode(caption) %>","</a>"].join(""))})),t.asc_getIsActive()&&(i=!0)})),e.items[0].setChecked(!i,!0)},onOpenView:function(t){this.api&&this.api.asc_setActiveNamedSheetView("default"==t.value?null:t.name)},onCreateView:function(t){this.api&&this.api.asc_addNamedSheetView(null,!0)},onOpenManager:function(t){var e=this;new SSE.Views.ViewManagerDlg({api:this.api,handler:function(t,i){"ok"==t&&i&&e.api&&e.api.asc_setActiveNamedSheetView(i),Common.NotificationCenter.trigger("edit:complete",e.view)},views:this.api.asc_getNamedSheetViews()}).on("close",(function(t){})).show()},onWorksheetLocked:function(t,e){t==this.api.asc_getActiveWorksheetIndex()&&Common.Utils.lockControls(Common.enumLock.sheetLock,e,{array:[this.view.chHeadings,this.view.chGridlines,this.view.btnFreezePanes,this.view.chZeros,this.view.btnViewNormal,this.view.btnViewPageBreak]})},onApiSheetChanged:function(){if(this.toolbar.mode&&this.toolbar.mode.isEdit&&!this.toolbar.mode.isEditDiagram&&!this.toolbar.mode.isEditMailMerge&&!this.toolbar.mode.isEditOle){var t=this.api.asc_getSheetViewSettings();this.view.chHeadings.setValue(!!t.asc_getShowRowColHeaders(),!0),this.view.chGridlines.setValue(!!t.asc_getShowGridLines(),!0),this.view.btnFreezePanes.menu&&"object"===_typeof(this.view.btnFreezePanes.menu)&&this.view.btnFreezePanes.menu.items&&this.view.btnFreezePanes.menu.items[0].setCaption(t.asc_getIsFreezePane()?this.view.textUnFreeze:this.view.capBtnFreeze),this.view.chZeros.setValue(!!t.asc_getShowZeros(),!0);var e=this.api.asc_getActiveWorksheetIndex();this.onWorksheetLocked(e,this.api.asc_isWorksheetLockedOrDeleted(e)),this.onApiUpdateSheetViewType(e)}},onLayoutChanged:function(t){"celleditor"==t&&arguments[1]&&this.view.chFormula.setValue("showed"==arguments[1],!0)},onApiZoomChange:function(t,e){var i=Math.floor(100*(t+.005));this.view.cmbZoom.setValue(i,i+"%"),this._state.zoomValue=i},onThemeChanged:function(){if(this.view&&Common.UI.Themes.available()&&this.view.btnInterfaceTheme.menu&&"object"===_typeof(this.view.btnInterfaceTheme.menu)){var t=Common.UI.Themes.currentThemeId()||Common.UI.Themes.defaultThemeId(),e=_.findWhere(this.view.btnInterfaceTheme.menu.getItems(!0),{value:t});e&&(this.view.btnInterfaceTheme.menu.clearAll(!0),e.setChecked(!0,!0))}},onTabStyleChange:function(){this.view&&this.view.menuTabStyle&&_.each(this.view.menuTabStyle.items,(function(t){t.setChecked(Common.Utils.InternalSettings.get("settings-tab-style")===t.value,!0)}))},onPreviewMode:function(t){this.api&&this.api.asc_SetSheetViewType(t)},onClickMacros:function(){Common.UI.TooltipManager.closeTip("asyncFunction"),new Common.Views.MacrosDialog({api:this.api}).show()},onApiUpdateSheetViewType:function(t){if(this.view&&this.api&&t===this.api.asc_getActiveWorksheetIndex()){var e=this.api.asc_GetSheetViewType(t);this.view.btnViewPageBreak&&this.view.btnViewPageBreak.toggle(e===Asc.c_oAscESheetViewType.pageBreakPreview,!0),this.view.btnViewNormal&&this.view.btnViewNormal.toggle(e===Asc.c_oAscESheetViewType.normal,!0)}}},SSE.Controllers.ViewTab||{}))})),define("text!common/main/lib/template/SearchPanel.template",[],(function(){return'<div id="search-box" class="layout-ct vbox search-panel" role="search">\n    <div id="search-header">\n        <label id="search-adv-title" role="heading"></label>\n        <div id="search-btn-close" class="float-right"></div>\n    </div>\n    <div id="search-container">\n    <div id="search-adv-settings">\n        <table cols="1" role="presentation">\n            <tbody>\n                <tr>\n                    <td class="padding-small"><div id="search-adv-text"></div></td>\n                </tr>\n                <tr class="edit-setting">\n                    <td class="padding-large"><div id="search-adv-replace-text"></div></td>\n                </tr>\n                <tr>\n                    <td class="padding-large">\n                        <label id="search-adv-results-number" style="display: inline-block;">\n                            <%= scope.textSearchResults %>\n                        </label>\n                        <div class="search-nav-btns float-right">\n                            <div id="search-adv-back"></div>\n                            <div id="search-adv-next"></div>\n                        </div>\n                    </td>\n                </tr>\n                <tr class="edit-setting">\n                    <td class="padding-large">\n                       <button type="button" class="btn btn-text-default" id="search-adv-replace" data-hint="1" data-hint-direction="bottom" data-hint-offset="big"><%= scope.textReplace %></button>\n                       <button type="button" class="btn btn-text-default" id="search-adv-replace-all" data-hint="1" data-hint-direction="bottom" data-hint-offset="big"><%= scope.textReplaceAll %></button>\n                    </td>\n                </tr>\n                <tr class="search-options-block">\n                    <td class="padding-large">\n                        <div id="open-search-options" data-hint="1" data-hint-direction="left" data-hint-offset="0, -15">\n                            <div class="search-options-caret img-commonctrl"></div>\n                            <div class="search-options-txt"><%= scope.textSearchOptions %></div>\n                        </div>\n                        <div id="search-options">\n                            <label class="input-label"><%= scope.textWithin %></label>\n                            <div id="search-adv-cmb-within"></div>\n                            <div id="search-adv-select-range"></div>\n                            <label class="input-label"><%= scope.textSearch %></label>\n                            <div id="search-adv-cmb-search"></div>\n                            <label class="input-label"><%= scope.textLookIn %></label>\n                            <div id="search-adv-cmb-look-in"></div>\n                        </div>\n                    </td>\n                </tr>\n                <tr>\n                    <td class="padding-small"><div id="search-adv-case-sensitive"></div></td>\n                </tr>\n                \x3c!---<tr>\n                    <td class="padding-small"><div id="search-adv-use-regexp"></div></td>\n                </tr>--\x3e\n                <tr>\n                    <td class="padding-large"><div id="search-adv-match-word"></div></td>\n                </tr>\n            </tbody>\n        </table>\n    </div>\n    <div id="search-results" class="ps-container oo">\n    </div>\n    </div>\n</div>'})),void 0===Common)var Common={};if(define("common/main/lib/component/InputField",["common/main/lib/component/BaseView","common/main/lib/component/Tooltip","common/main/lib/component/Button"],(function(){"use strict";Common.UI.InputField=Common.UI.BaseView.extend({options:{id:null,cls:"",style:"",value:"",type:"text",name:"",validation:null,allowBlank:!0,placeHolder:"",blankError:null,spellcheck:!1,maskExp:"",validateOnChange:!1,validateOnBlur:!0,disabled:!1,editable:!0,hideErrorOnInput:!1},template:_.template(['<div class="input-field" style="<%= style %>">',"<input ",'type="<%= type %>" ','name="<%= name %>" ','spellcheck="<%= spellcheck %>" ','class="form-control <%= cls %>" ','placeholder="<%= placeHolder %>" ','data-hint="<%= dataHint %>"','data-hint-direction="<%= dataHintDirection %>"','data-hint-offset="<%= dataHintOffset %>"',">",'<span class="input-error"></span>',"</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;this.id=e.options.id||Common.UI.getId(),this.cls=e.options.cls,this.style=e.options.style,this.value=e.options.value,this.type=e.options.type,this.name=e.options.name,this.validation=e.options.validation,this.allowBlank=e.options.allowBlank,this.placeHolder=e.options.placeHolder,this.template=e.options.template||e.template,this.editable=e.options.editable,this.disabled=e.options.disabled,this.spellcheck=e.options.spellcheck,this.blankError=e.options.blankError||e.txtEmpty,this.validateOnChange=e.options.validateOnChange,this.validateOnBlur=e.options.validateOnBlur,this.maxLength=e.options.maxLength,this.hideErrorOnInput=e.options.hideErrorOnInput,e.rendered=e.options.rendered||!1,e.options.el&&e.render()},render:function(t){var e=this;if(e.rendered?this.cmpEl=this.$el:(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,value:this.value,type:this.type,name:this.name,placeHolder:this.placeHolder,spellcheck:this.spellcheck,dataHint:this.options.dataHint,dataHintDirection:this.options.dataHintDirection,dataHintOffset:this.options.dataHintOffset,scope:e})),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl)),!e.rendered){var i=this.cmpEl;if(this._input=this.cmpEl.find("input").addBack().filter("input").first(),this.editable&&(this._input.on("blur",_.bind(this.onInputChanged,this)),this._input.on("keypress",_.bind(this.onKeyPress,this)),this._input.on("keydown",_.bind(this.onKeyDown,this)),this._input.on("keyup",_.bind(this.onKeyUp,this)),this.validateOnChange&&this._input.on("input",_.bind(this.onInputChanging,this)),this.maxLength&&this._input.attr("maxlength",this.maxLength)),this.setEditable(this.editable),this.disabled&&this.setDisabled(this.disabled),this._input.closest(".asc-window").length>0)var o=function(){var t=i.find(".input-error").data("bs.tooltip");t&&t.tip().remove(),Common.NotificationCenter.off({"modal:close":o})};Common.NotificationCenter.on({"modal:close":o});var n=this.options.ariaLabel?this.options.ariaLabel:this.placeHolder;n&&this._input.attr("aria-label",n)}return e.rendered=!0,e.value&&e.setValue(e.value),this},_doChange:function(t,e){if(!e||!e.synthetic){var i=$(t.target).val(),o=this.value;this.trigger("changed:before",this,i,o,t),t.isDefaultPrevented()||(this.value=i,this.validateOnBlur&&this.checkValidate(),this.trigger("changed:after",this,i,o,t))}},onInputChanged:function(t,e){this._doChange(t,e)},onInputChanging:function(t,e){var i=$(t.target).val(),o=this.value;t.isDefaultPrevented()||(this.value=i,this.validateOnBlur&&this.checkValidate(),this.trigger("changing",this,i,o,t))},onKeyPress:function(t){if(this.trigger("keypress:before",this,t),!t.isDefaultPrevented()){if(this.options.maskExp&&!_.isEmpty(this.options.maskExp.source)){var e=String.fromCharCode(t.which);this.options.maskExp.test(e)||t.ctrlKey||t.keyCode===Common.UI.Keys.RETURN||(t.preventDefault(),t.stopPropagation())}this.trigger("keypress:after",this,t)}},onKeyDown:function(t){this.trigger("keydown:before",this,t),t.isDefaultPrevented()||(t.keyCode===Common.UI.Keys.RETURN&&this._doChange(t),t.keyCode==Common.UI.Keys.ESC&&this.setValue(this.value),t.keyCode!=Common.UI.Keys.RETURN&&t.keyCode!=Common.UI.Keys.ESC||this.trigger("inputleave",this))},onKeyUp:function(t){this.trigger("keyup:before",this,t),t.isDefaultPrevented()||this.trigger("keyup:after",this,t)},setEditable:function(t){var e=this._input;this.editable=t,t&&e?(e.removeAttr("readonly"),e.removeAttr("data-can-copy")):(e.attr("readonly","readonly"),e.attr("data-can-copy",!1))},isEditable:function(){return this.editable},setDisabled:function(t){t=!!t,this.disabled=t,$(this.el).toggleClass("disabled",t),this._input&&(t?this._input.attr("disabled",!0):this._input.removeAttr("disabled"))},isDisabled:function(){return this.disabled},setValue:function(t){this.value=t,this.rendered&&this._input.val(t)},getValue:function(){return this.value},focus:function(){this._input&&this._input.focus()},checkValidate:function(){var t=this,e=[];if(!t.allowBlank&&_.isEmpty(t.value)&&e.push(t.blankError),_.isFunction(t.validation)){var i=t.validation.call(t,t.value);!0!==i&&(e=_.flatten(e.concat(i)))}if(!_.isEmpty(e)){if(t.cmpEl.hasClass("error"))return(o=t.cmpEl.find(".input-error").data("bs.tooltip"))&&(o.options.title=e.join("\n"),o.setContent()),e;t.cmpEl.addClass("error");var o,n=t.cmpEl.find(".input-error"),s=n.closest(".asc-window");return(o=n.data("bs.tooltip"))&&o.tip().remove(),n.attr("data-toggle","tooltip"),n.removeData("bs.tooltip"),n.tooltip({title:e.join("\n"),placement:"cursor"}),s.length>0&&n.data("bs.tooltip").tip().css("z-index",parseInt(s.css("z-index"))+10),t.hideErrorOnInput&&t._input.one("input",(function(){t.showError()})),e}return t.cmpEl.removeClass("error"),!0},showError:function(t,e){var i=this;if(_.isEmpty(t))i.cmpEl.removeClass("error"),i.cmpEl.removeClass("warning");else{i.cmpEl.addClass(e?"warning":"error");var o=i.cmpEl.find(".input-error"),n=o.closest(".asc-window"),s=o.data("bs.tooltip");s&&s.tip().remove(),o.attr("data-toggle","tooltip"),o.removeData("bs.tooltip"),o.tooltip({title:t.join("\n"),placement:"cursor"}),n.length>0&&o.data("bs.tooltip").tip().css("z-index",parseInt(n.css("z-index"))+10),i.hideErrorOnInput&&i._input.one("input",(function(){i.showError()}))}},showWarning:function(t){this.showError(t,!0)},txtEmpty:"This field is required"}),Common.UI.InputFieldBtn=Common.UI.InputField.extend({options:{id:null,cls:"",style:"",value:"",type:"text",name:"",validation:null,allowBlank:!0,placeHolder:"",blankError:null,spellcheck:!1,maskExp:"",validateOnChange:!1,validateOnBlur:!0,disabled:!1,editable:!0,iconCls:"toolbar__icon btn-select-range",btnHint:""},template:_.template(['<div class="input-field input-field-btn" style="<%= style %>">',"<input ","type=<%= type %> ",'name="<%= name %>" ','spellcheck="<%= spellcheck %>" ','class="form-control <%= cls %>" ','placeholder="<%= placeHolder %>" ','value="<%= value %>"','data-hint="<%= dataHint %>"','data-hint-offset="<%= dataHintOffset %>"','data-hint-direction="<%= dataHintDirection %>"',">",'<span class="input-error"></span>','<div class="select-button"></div>',"</div>"].join("")),render:function(t){var e=this;if(e.rendered?this.cmpEl=this.$el:(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,value:this.value,type:this.type,name:this.name,placeHolder:this.placeHolder,spellcheck:this.spellcheck,scope:e,dataHint:this.options.dataHint,dataHintOffset:this.options.dataHintOffset,dataHintDirection:this.options.dataHintDirection})),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl)),!e.rendered){var i=this.cmpEl;if(this._button=new Common.UI.Button({cls:"btn-toolbar",iconCls:this.options.iconCls,hint:this.options.btnHint||"",menu:this.options.menu}),this._button.render(this.cmpEl.find(".select-button")),this._button.on("click",_.bind(this.onButtonClick,this)),this._input=this.cmpEl.find("input").addBack().filter("input"),this.editable&&(this._input.on("blur",_.bind(this.onInputChanged,this)),this._input.on("keypress",_.bind(this.onKeyPress,this)),this._input.on("keydown",_.bind(this.onKeyDown,this)),this._input.on("keyup",_.bind(this.onKeyUp,this)),this.validateOnChange&&this._input.on("input",_.bind(this.onInputChanging,this)),this.maxLength&&this._input.attr("maxlength",this.maxLength)),this.setEditable(this.editable),this.disabled&&this.setDisabled(this.disabled),this._input.closest(".asc-window").length>0)var o=function(){var t=i.find(".input-error").data("bs.tooltip");t&&t.tip().remove(),Common.NotificationCenter.off({"modal:close":o})};Common.NotificationCenter.on({"modal:close":o});var n=this.options.ariaLabel?this.options.ariaLabel:this.placeHolder;n&&this._input.attr("aria-label",n)}return e.rendered=!0,e.value&&e.setValue(e.value),this},onButtonClick:function(t,e){this.trigger("button:click",this,e)},setDisabled:function(t){t=!!t,this.disabled=t,$(this.el).toggleClass("disabled",t),t?this._input.attr("disabled",!0):this._input.removeAttr("disabled"),this._button.setDisabled(t)},setBtnDisabled:function(t){this._button.setDisabled(t)},updateBtnHint:function(t){this.options.hint=t,this.rendered&&this._button.updateHint(this.options.hint)}}),Common.UI.InputFieldBtnPassword=Common.UI.InputFieldBtn.extend(_.extend({options:{id:null,cls:"",style:"",value:"",name:"",type:"password",validation:null,allowBlank:!0,placeHolder:"",blankError:null,spellcheck:!1,maskExp:"",validateOnChange:!1,validateOnBlur:!0,disabled:!1,editable:!0,showCls:"toolbar__icon btn-sheet-view",hideCls:"toolbar__icon btn-hide-password",btnHint:"",repeatInput:null,showPwdOnClick:!0},initialize:function(t){(t=t||{}).btnHint=t.btnHint||(t.showPwdOnClick?this.textHintShowPwd:this.textHintHold),t.iconCls=t.showCls||this.options.showCls,Common.UI.InputFieldBtn.prototype.initialize.call(this,t),this.hidePwd=!0,this.repeatInput=this.options.repeatInput},render:function(t){return Common.UI.InputFieldBtn.prototype.render.call(this,t),this._btnElm=this._button.$el,this.options.showPwdOnClick?this._button.on("click",_.bind(this.passwordClick,this)):this._btnElm.on("mousedown",_.bind(this.passwordShow,this)),this},passwordClick:function(t){this.hidePwd?(this.passwordShow(t),this.hidePwd=!1):(this.passwordHide(t),this.hidePwd=!0);var e=this,i=e._input[0].selectionStart,o=e._input[0].selectionEnd;setTimeout((function(){e.focus(),e._input[0].selectionStart=i,e._input[0].selectionEnd=o}),1)},passwordShow:function(t){this.disabled||(this._button.setIconCls(this.options.hideCls),this.type="text",this._input.attr("type",this.type),this.repeatInput&&(this.repeatInput.type=this.type,this.repeatInput._input.attr("type",this.type)),this.options.showPwdOnClick?this._button.updateHint(this.textHintHidePwd):(this._btnElm.on("mouseup",_.bind(this.passwordHide,this)),this._btnElm.on("mouseout",_.bind(this.passwordHide,this))))},passwordHide:function(t){if(this._button.setIconCls(this.options.showCls),this.type="password",this._input.attr("type",this.type),this.repeatInput&&(this.repeatInput.type=this.type,this.repeatInput._input.attr("type",this.type)),this.options.showPwdOnClick)this._button.updateHint(this.textHintShowPwd);else{this._btnElm.off("mouseup",this.passwordHide),this._btnElm.off("mouseout",this.passwordHide);var e=this,i=e._input[0].selectionStart,o=e._input[0].selectionEnd;setTimeout((function(){e.focus(),e._input[0].selectionStart=i,e._input[0].selectionEnd=o}),1)}},textHintShowPwd:"Show password",textHintHidePwd:"Hide password",textHintHold:"Press and hold to show password"},Common.UI.InputFieldBtnPassword||{})),Common.UI.InputFieldBtnCalendar=Common.UI.InputFieldBtn.extend({options:{id:null,cls:"",style:"",value:"",type:"text",name:"",validation:null,allowBlank:!0,placeHolder:"",blankError:null,spellcheck:!1,maskExp:"",validateOnChange:!1,validateOnBlur:!0,disabled:!1,editable:!0,iconCls:"toolbar__icon btn-date",btnHint:"",menu:!0},initialize:function(t){(t=t||{}).btnHint=t.btnHint||this.textDate,Common.UI.InputFieldBtn.prototype.initialize.call(this,t),this.dateValue=void 0},render:function(t){var e=this;Common.UI.InputFieldBtn.prototype.render.call(this,t);var i="id-"+Common.UI.getId()+"input-field-datetime",o=new Common.UI.Menu({menuAlign:"tr-br",style:"border: none; padding: 0;",items:[{template:_.template('<div id="'+i+'" style=""></div>'),stopPropagation:!0}]});$("button",this._button.cmpEl).addClass("no-caret"),this._button.setMenu(o),this._button.menu.on("show:after",(function(t){e.cmpCalendar||(e.cmpCalendar=new Common.UI.Calendar({el:e.cmpEl.find("#"+i),enableKeyEvents:!0,firstday:1}),e.cmpCalendar.on("date:click",(function(i,o){e.dateValue=o,e.trigger("date:click",e,o),t.hide()})),e.dateValue&&e.cmpCalendar.setDate(e.dateValue),t.alignPosition()),e.cmpCalendar.focus()})),this._input.on("input",(function(){e.dateValue=void 0}))},setDate:function(t){t&&t instanceof Date&&!isNaN(t)&&(this.cmpCalendar&&this.cmpCalendar.setDate(t),this.dateValue=t)},getDate:function(){return this.dateValue},textDate:"Select date"}),Common.UI.InputFieldFixed=Common.UI.InputField.extend({options:{id:null,cls:"",style:"",value:"",fixedValue:"",fixedWidth:"",fixedCls:"",type:"text",name:"",validation:null,allowBlank:!0,placeHolder:"",blankError:null,spellcheck:!1,maskExp:"",validateOnChange:!1,validateOnBlur:!0,disabled:!1,editable:!0,btnHint:""},template:_.template(['<div class="input-field input-field-fixed" style="<%= style %>">',"<input ","type=<%= type %> ",'name="<%= name %>" ','spellcheck="<%= spellcheck %>" ','class="form-control <%= cls %>" ','placeholder="<%= placeHolder %>" ','value="<%= value %>"','data-hint="<%= dataHint %>"','data-hint-offset="<%= dataHintOffset %>"','data-hint-direction="<%= dataHintDirection %>"',">",'<span class="input-error"></span>','<input class="fixed-text form-control" type="text" readonly="readonly"></div>'].join("")),initialize:function(t){this.fixedValue=t.fixedValue,this.fixedWidth=t.fixedWidth||"calc(50% + 4px)",this.fixedCls=t.fixedCls||"",Common.UI.InputField.prototype.initialize.call(this,t)},render:function(t){return Common.UI.InputField.prototype.render.call(this,t),this._input.css({"padding-left":Common.UI.isRTL()?this.fixedWidth:0,"padding-right":Common.UI.isRTL()?0:this.fixedWidth}),this.cmpEl.find("input.fixed-text").css({width:this.fixedWidth}).addClass(this.fixedCls),this.fixedValue&&this.setFixedValue(this.fixedValue),this},setFixedValue:function(t){this.fixedValue=t,this.rendered&&this.cmpEl.find("input.fixed-text").addBack().filter("input.fixed-text").val(t)},setDisabled:function(t){if(t=!!t,this.disabled=t,$(this.el).toggleClass("disabled",t),this.cmpEl){var e=this.cmpEl.find("input").addBack().filter("input");t?e.attr("disabled",!0):e.removeAttr("disabled")}}})})),define("common/main/lib/view/SearchPanel",["text!common/main/lib/template/SearchPanel.template","common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout","common/main/lib/component/InputField"],(function(t){"use strict";Common.Views.SearchPanel=Common.UI.BaseView.extend(_.extend({el:"#left-panel-search",template:_.template(t),initialize:function(t){_.extend(this,t),Common.UI.BaseView.prototype.initialize.call(this,arguments),this.mode=!1,window.SSE&&(this.extendedOptions=Common.localStorage.getBool("sse-search-options-extended",!0))},render:function(t){var e=this;if(!this.rendered){if(t=t||this.el,$(t).html(this.template({scope:this})),this.$el=$(t),this.inputText=new Common.UI.InputField({el:$("#search-adv-text"),placeHolder:this.textFind,allowBlank:!0,validateOnBlur:!1,style:"width: 100%;",type:"search",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.inputText._input.on("input",_.bind((function(){this.fireEvent("search:input",[this.inputText._input.val()])}),this)).on("keydown",_.bind((function(t){this.fireEvent("search:keydown",[this.inputText._input.val(),t])}),this)),this.inputReplace=new Common.UI.InputField({el:$("#search-adv-replace-text"),placeHolder:this.textReplaceWith,allowBlank:!0,validateOnBlur:!1,style:"width: 100%;",dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.inputReplace._input.on("keydown",_.bind((function(t){t.keyCode!==Common.UI.Keys.RETURN||this.btnReplace.isDisabled()||this.onReplaceClick("replace")}),this)),this.btnBack=new Common.UI.Button({parentEl:$("#search-adv-back"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-arrow-up",hint:this.tipPreviousResult,dataHint:"1",dataHintDirection:"bottom"}),this.btnBack.on("click",_.bind(this.onBtnNextClick,this,"back")),this.btnNext=new Common.UI.Button({parentEl:$("#search-adv-next"),cls:"btn-toolbar",iconCls:"toolbar__icon btn-arrow-down",hint:this.tipNextResult,dataHint:"1",dataHintDirection:"bottom"}),this.btnNext.on("click",_.bind(this.onBtnNextClick,this,"next")),this.btnReplace=new Common.UI.Button({el:$("#search-adv-replace")}),this.btnReplace.on("click",_.bind(this.onReplaceClick,this,"replace")),this.btnReplaceAll=new Common.UI.Button({el:$("#search-adv-replace-all")}),this.btnReplaceAll.on("click",_.bind(this.onReplaceClick,this,"replaceall")),this.$reaultsNumber=$("#search-adv-results-number"),this.updateResultsNumber("no-results"),this.chCaseSensitive=new Common.UI.CheckBox({el:$("#search-adv-case-sensitive"),labelText:this.textCaseSensitive,value:!1,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}).on("change",(function(t){e.fireEvent("search:options",["case-sensitive","checked"===t.getValue()])})),this.chMatchWord=new Common.UI.CheckBox({el:$("#search-adv-match-word"),labelText:window.SSE?this.textItemEntireCell:this.textWholeWords,value:!1,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}).on("change",(function(t){e.fireEvent("search:options",["match-word","checked"===t.getValue()])})),this.buttonClose=new Common.UI.Button({parentEl:$("#search-btn-close",this.$el),cls:"btn-toolbar",iconCls:"toolbar__icon btn-close",hint:this.textCloseSearch,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"medium"}),this.buttonClose.on("click",_.bind(this.onClickClosePanel,this)),this.$resultsContainer=$("#search-results"),this.$resultsContainer.hide(),this.$searchContainer=$("#search-container"),this.$searchContainer.scroller=new Common.UI.Scroller({el:$("#search-container"),useKeyboard:!0,minScrollbarLength:40}),Common.NotificationCenter.on("search:updateresults",_.bind(this.disableNavButtons,this)),window.SSE){this.cmbWithin=new Common.UI.ComboBox({el:$("#search-adv-cmb-within"),menuStyle:"min-width: 100%;",style:"width: 219px;",editable:!1,cls:"input-group-nr",data:[{value:Asc.c_oAscSearchBy.Sheet,displayValue:this.textSheet},{value:Asc.c_oAscSearchBy.Workbook,displayValue:this.textWorkbook},{value:Asc.c_oAscSearchBy.Range,displayValue:this.textSpecificRange}],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}).on("selected",(function(t,i){e.fireEvent("search:options",["within",i.value])})),this.inputSelectRange=new Common.UI.InputFieldBtn({el:$("#search-adv-select-range"),placeHolder:this.textSelectDataRange,allowBlank:!0,validateOnChange:!0,validateOnBlur:!0,style:"width: 219px; margin-top: 8px",disabled:!0,dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}).on("keyup:after",(function(t,i){e.fireEvent("search:options",["range",t.getValue(),i.keyCode!==Common.UI.Keys.RETURN])})),this.inputSelectRange.$el.hide(),this.cmbSearch=new Common.UI.ComboBox({el:$("#search-adv-cmb-search"),menuStyle:"min-width: 100%;",style:"width: 219px;",editable:!1,cls:"input-group-nr",data:[{value:0,displayValue:this.textByRows},{value:1,displayValue:this.textByColumns}],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}).on("selected",(function(t,i){e.fireEvent("search:options",["search",!i.value])})),this.cmbLookIn=new Common.UI.ComboBox({el:$("#search-adv-cmb-look-in"),menuStyle:"min-width: 100%;",style:"width: 219px;",editable:!1,cls:"input-group-nr",data:[{value:0,displayValue:this.textFormulas},{value:1,displayValue:this.textValues}],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"big"}).on("selected",(function(t,i){e.fireEvent("search:options",["lookIn",!i.value])})),this.$searchOptionsBlock=$(".search-options-block"),this.$searchOptionsBlock.show(),$("#open-search-options").on("click",_.bind(this.expandSearchOptions,this)),this.extendedOptions||this.$searchOptionsBlock.addClass("no-expand"),this.cmbWithin.setValue(Asc.c_oAscSearchBy.Sheet),this.cmbSearch.setValue(0),this.cmbLookIn.setValue(0);var i='<div role="table" class="search-table" aria-label="'+this.textSearchResultsTable+'"><div role="rowgroup"><div role="row" class="header-items"><div role="columnheader" class="header-item">'+this.textSheet+'</div><div role="columnheader" class="header-item">'+this.textName+'</div><div role="columnheader" class="header-item">'+this.textCell+'</div><div role="columnheader" class="header-item">'+this.textValue+'</div><div role="columnheader" class="header-item">'+this.textFormula+'</div></div></div><div role="rowgroup" class="ps-container oo search-items"></div></div>',o=$(i).appendTo(this.$resultsContainer);this.$resultsContainer.scroller=new Common.UI.Scroller({el:o.find(".search-items"),includePadding:!0,useKeyboard:!0,minScrollbarLength:40,alwaysVisibleY:!0}),this.$resultsTable=this.$resultsContainer.find(".search-table")}else this.$resultsContainer.attr("role","list"),this.$resultsContainer.attr("aria-label",this.textSearchResultsTable),this.$resultsContainer.scroller=new Common.UI.Scroller({el:this.$resultsContainer,includePadding:!0,useKeyboard:!0,minScrollbarLength:40,alwaysVisibleY:!0});Common.NotificationCenter.on("window:resize",(function(){e.updateResultsContainerHeight()}))}return this.rendered=!0,this.trigger("render:after",this),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.fireEvent("show",this),this.updateResultsContainerHeight()},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.fireEvent("hide",this)},focus:function(t){var e=this,i="replace"===t?e.inputReplace.$el:"range"===t?e.inputSelectRange.$el:e.inputText.$el;setTimeout((function(){i.find("input").focus(),i.find("input").select()}),10)},getFocusElement:function(){return this.inputText.$el.find("input")},setSearchMode:function(t){this.mode!==t&&(this.$el.find(".edit-setting")["no-replace"!==t?"show":"hide"](),this.$el.find("#search-adv-title").text("no-replace"!==t?this.textFindAndReplace:this.textFind),this.mode=t)},ChangeSettings:function(t){},updateScrollers:function(){this.$resultsContainer.scroller.update({alwaysVisibleY:!0}),this.$searchContainer.scroller.update({alwaysVisibleY:!0}),setTimeout(_.bind((function(){this.$searchContainer.find("> .ps-scrollbar-y-rail").is(":visible")?this.$resultsContainer.find(".ps-scrollbar-y-rail").addClass("set-left"):this.$resultsContainer.find(".ps-scrollbar-y-rail").removeClass("set-left")}),this),100)},updateResultsContainerHeight:function(){this.$resultsContainer&&(this.$resultsContainer.outerHeight(Math.max($("#search-box").outerHeight()-$("#search-header").outerHeight()-$("#search-adv-settings").outerHeight(),112)),this.updateScrollers())},updateResultsNumber:function(t,e){var i;if(this.$resultsContainer&&"content-changed"!==t&&"replace-all"!==t&&"replace"!==t&&(e>300?this.showToManyResults():(this.$resultsContainer.find(".many-results").remove(),window.SSE&&this.$resultsTable.show())),i="no-results"===t?this.textNoSearchResults:"stop"===t?this.textSearchHasStopped:"content-changed"===t?this.textContentChanged+" "+Common.Utils.String.format(this.textSearchAgain,'<a class="search-again">',"</a>"):"replace-all"===t?Common.Utils.String.format(this.textItemsSuccessfullyReplaced,e):"replace"===t?Common.Utils.String.format(this.textPartOfItemsNotReplaced,e[0],e[1],e[2]):e?Common.Utils.String.format(this.textSearchResults,t+1,e):this.textNoMatches,"content-changed"===t){var o=this;this.$reaultsNumber.html(i),this.$reaultsNumber.find(".search-again").on("click",(function(){o.fireEvent("search:next",[o.inputText.getValue(),!0])}))}else this.$reaultsNumber.text(i);this.updateResultsContainerHeight(),!window.SSE&&this.disableReplaceButtons(!e)},showToManyResults:function(){window.SSE?(this.$resultsTable.hide(),this.$resultsTable.find(".search-items").empty(),this.$resultsContainer.find(".many-results").remove()):this.$resultsContainer.empty(),this.$resultsContainer.append('<div class="many-results">'+this.textTooManyResults+"</div>"),this.$resultsContainer.is(":visible")||this.$resultsContainer.show()},onClickClosePanel:function(){Common.NotificationCenter.trigger("leftmenu:change","hide"),this.fireEvent("hide",this)},onBtnNextClick:function(t){this.fireEvent("search:"+t,[this.inputText.getValue(),!0])},onReplaceClick:function(t){this.fireEvent("search:"+t,[this.inputText.getValue(),this.inputReplace.getValue()])},getSettings:function(){return{textsearch:this.inputText.getValue(),matchcase:this.chCaseSensitive.checked,matchword:this.chMatchWord.checked}},expandSearchOptions:function(){this.extendedOptions=!this.extendedOptions,this.$searchOptionsBlock[this.extendedOptions?"removeClass":"addClass"]("no-expand"),Common.localStorage.setBool("sse-search-options-extended",this.extendedOptions),this.updateResultsContainerHeight()},setFindText:function(t){this.inputText.setValue(t)},clearResultsNumber:function(){this.updateResultsNumber("no-results")},disableNavButtons:function(t,e){var i=""===this.inputText._input.val()&&!window.SSE||!e;this.btnBack.setDisabled(i),this.btnNext.setDisabled(i)},disableReplaceButtons:function(t){this.btnReplace.setDisabled(t),this.btnReplaceAll.setDisabled(t)},textFind:"Find",textFindAndReplace:"Find and replace",textCloseSearch:"Close search",textReplace:"Replace",textReplaceAll:"Replace All",textSearchResults:"Search results: {0}/{1}",textReplaceWith:"Replace with",textCaseSensitive:"Case sensitive",textMatchUsingRegExp:"Match using regular expressions",textWholeWords:"Whole words only",textWithin:"Within",textSelectDataRange:"Select Data range",textSearch:"Search",textLookIn:"Look in",textSheet:"Sheet",textWorkbook:"Workbook",textSpecificRange:"Specific range",textByRows:"By rows",textByColumns:"By columns",textFormulas:"Formulas",textValues:"Values",textSearchOptions:"Search options",textNoMatches:"No matches",textNoSearchResults:"No search results",textItemEntireCell:"Entire cell contents",textTooManyResults:"There are too many results to show here",tipPreviousResult:"Previous result",tipNextResult:"Next result",textName:"Name",textCell:"Cell",textValue:"Value",textFormula:"Formula",textSearchHasStopped:"Search has stopped",textContentChanged:"Document changed.",textSearchAgain:"{0}Perform new search{1} for accurate results.",textItemsSuccessfullyReplaced:"{0} items successfully replaced.",textPartOfItemsNotReplaced:"{0}/{1} items replaced. Remaining {2} items are locked by other users.",textSearchResultsTable:"Search results"},Common.Views.SearchPanel||{}))})),define("spreadsheeteditor/main/app/controller/Search",["core","common/main/lib/view/SearchPanel"],(function(){"use strict";SSE.Controllers.Search=Backbone.Controller.extend(_.extend({sdkViewName:"#id_main",views:["Common.Views.SearchPanel"],initialize:function(){this.addListeners({SearchBar:{"search:back":_.bind(this.onSearchNext,this,"back"),"search:next":_.bind(this.onSearchNext,this,"next"),"search:input":_.bind((function(t,e){!e||t?this._state.searchText!==t?this.onInputSearchChange(t):Common.NotificationCenter.trigger("search:updateresults",this._state.currentResult,this._state.resultsNumber):this._state.isResults&&(this._state.noSearchEmptyCells=!0,this.onQuerySearch())}),this),"search:keydown":_.bind(this.onSearchNext,this,"keydown"),show:_.bind(this.onSelectSearchingResults,this,!0),hide:_.bind(this.onSelectSearchingResults,this,!1)},"Common.Views.SearchPanel":{"search:back":_.bind(this.onSearchNext,this,"back"),"search:next":_.bind(this.onSearchNext,this,"next"),"search:replace":_.bind(this.onQueryReplace,this),"search:replaceall":_.bind(this.onQueryReplaceAll,this),"search:input":_.bind(this.onInputSearchChange,this),"search:options":_.bind(this.onChangeSearchOption,this),"search:keydown":_.bind(this.onSearchNext,this,"keydown"),show:_.bind(this.onShowPanel,this),hide:_.bind(this.onHidePanel,this)},LeftMenu:{"search:aftershow":_.bind(this.onShowAfterSearch,this)}})},onLaunch:function(){this._state={searchText:void 0,matchCase:!1,matchWord:!1,useRegExp:!1,withinSheet:Asc.c_oAscSearchBy.Sheet,searchByRows:!0,lookInFormulas:!0,isValidSelectedRange:!0,lastSelectedItem:void 0,isContentChanged:!1,isResults:!1,noSearchEmptyCells:!1,isReturnPressed:!1}},setMode:function(t){this.view=this.createView("Common.Views.SearchPanel",{mode:t}),this.view.on("render:after",_.bind(this.onAfterRender,this))},setApi:function(t){return t&&(this.api=t,this.api.asc_registerCallback("asc_onRenameCellTextEnd",_.bind(this.onRenameText,this)),this.api.asc_registerCallback("asc_onSetSearchCurrent",_.bind(this.onUpdateSearchCurrent,this)),this.api.asc_registerCallback("asc_onStartTextAroundSearch",_.bind(this.onStartTextAroundSearch,this)),this.api.asc_registerCallback("asc_onEndTextAroundSearch",_.bind(this.onEndTextAroundSearch,this)),this.api.asc_registerCallback("asc_onGetTextAroundSearchPack",_.bind(this.onApiGetTextAroundSearch,this)),this.api.asc_registerCallback("asc_onRemoveTextAroundSearch",_.bind(this.onApiRemoveTextAroundSearch,this)),this.api.asc_registerCallback("asc_onActiveSheetChanged",_.bind(this.onActiveSheetChanged,this)),this.api.asc_registerCallback("asc_onModifiedDocument",_.bind(this.onApiModifiedDocument,this)),this.api.asc_registerCallback("asc_onUpdateSearchElem",_.bind(this.onApiUpdateSearchElem,this))),this},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onAfterRender:function(){var t=this;this.view.inputSelectRange.validation=function(e){if(_.isEmpty(e))return!0;var i=t.api.asc_checkDataRange(void 0,e);return t._state.isValidSelectedRange=i!==Asc.c_oAscError.ID.DataRangeError,i!==Asc.c_oAscError.ID.DataRangeError||t.textInvalidRange},this.view.inputSelectRange.on("button:click",_.bind(this.onRangeSelect,this))},changeWithinSheet:function(t){this._state.withinSheet=t,this.view.inputSelectRange.setDisabled(t!==Asc.c_oAscSearchBy.Range),this.view.inputSelectRange.$el[t===Asc.c_oAscSearchBy.Range?"show":"hide"](),this.view.updateResultsContainerHeight()},onChangeSearchOption:function(t,e,i){var o=!0;switch(t){case"case-sensitive":this._state.matchCase=e;break;case"match-word":this._state.matchWord=e;break;case"regexp":this._state.useRegExp=e;break;case"within":this.changeWithinSheet(e),e===Asc.c_oAscSearchBy.Range&&(o=this._state.isValidSelectedRange&&!!this._state.selectedRange);break;case"range":this._state.selectedRange=e,o=!i;break;case"search":this._state.searchByRows=e;break;case"lookIn":this._state.lookInFormulas=e}o&&this.onQuerySearch()},onRangeSelect:function(){if(!this.rangeSelectDlg){var t=this;this.rangeSelectDlg=new SSE.Views.CellRangeDialog({handler:function(e,i){if("ok"==i){var o=e.getSettings();t.view.inputSelectRange.setValue(o),t.view.inputSelectRange.checkValidate(),t.onChangeSearchOption("range",o)}}}).on("close",(function(){t.rangeSelectDlg=void 0,_.delay((function(){t.view.inputSelectRange.focus()}),1)})),this.rangeSelectDlg.show(),this.rangeSelectDlg.setSettings({api:t.api,range:_.isEmpty(t.view.inputSelectRange.getValue())||1!=t.view.inputSelectRange.checkValidate()?t._state.selectedRange:t.view.inputSelectRange.getValue(),type:Asc.c_oAscSelectionDialogType.PrintTitles})}},onSearchNext:function(t,e,i){var o="keydown"===t&&i.keyCode===Common.UI.Keys.RETURN;(o||"keydown"!==t)&&(this._state.searchText=e,this.onQuerySearch(t)),this._state.isReturnPressed=o},onInputSearchChange:function(t){t||this._state.isReturnPressed||(this._state.noSearchEmptyCells=!0),this._state.isReturnPressed=!1;var e=this;this._state.searchText!==t&&(this._state.newSearchText=t,this._lastInputChange=new Date,void 0===this.searchTimer&&(this.searchTimer=setInterval((function(){new Date-e._lastInputChange<400||(e._state.searchText=e._state.newSearchText,e.onQuerySearch()||""!==e._state.newSearchText||(e.view.updateResultsNumber("no-results"),e.view.disableNavButtons(),Common.NotificationCenter.trigger("search:updateresults",void 0,0)))}),10)))},onQuerySearch:function(t,e){this.searchTimer&&clearInterval(this.searchTimer),this.searchTimer=void 0;var i=this;if(this._state.withinSheet!==Asc.c_oAscSearchBy.Range||this._state.isValidSelectedRange){this.hideResults(),this.api.asc_closeCellEditor();var o=new Asc.asc_CFindOptions;return o.asc_setFindWhat(this._state.searchText),o.asc_setScanForward("back"!=t),o.asc_setIsMatchCase(this._state.matchCase),o.asc_setIsWholeCell(this._state.matchWord),o.asc_setScanOnOnlySheet(this._state.withinSheet),this._state.withinSheet===Asc.c_oAscSearchBy.Range&&o.asc_setSpecificRange(this._state.selectedRange),o.asc_setScanByRows(this._state.searchByRows),o.asc_setLookIn(this._state.lookInFormulas?Asc.c_oAscFindLookIn.Formulas:Asc.c_oAscFindLookIn.Value),o.asc_setNeedRecalc(e),this._state.isContentChanged&&(o.asc_setLastSearchElem(this._state.lastSelectedItem?this._state.lastSelectedItem:o.asc_getLastSearchElem(!0)),this.view.disableReplaceButtons(!1),this._state.isContentChanged=!1,this.view.$el.is(":visible")||(this.resultItems=[])),o.asc_setNotSearchEmptyCells(this._state.noSearchEmptyCells),this.api.asc_findText(o)?(this._state.isResults=!0,this.view.$el.is(":visible")&&this.api.asc_StartTextAroundSearch(),!0):(this._state.isResults=!1,this._state.noSearchEmptyCells?(this.removeResultItems("no-results"),this._state.noSearchEmptyCells=!1):this.removeResultItems(),Common.NotificationCenter.trigger("search:updateresults"),!1)}Common.UI.warning({title:this.notcriticalErrorTitle,msg:this.textInvalidRange,buttons:["ok"],callback:function(){i.view.focus("range")}})},onQueryReplace:function(t,e){this.api.isReplaceAll=!1;var i=new Asc.asc_CFindOptions;i.asc_setFindWhat(t),i.asc_setReplaceWith(e),i.asc_setIsMatchCase(this._state.matchCase),i.asc_setIsWholeCell(this._state.matchWord),i.asc_setScanOnOnlySheet(this._state.withinSheet),this._state.withinSheet===Asc.c_oAscSearchBy.Range&&i.asc_setSpecificRange(this._state.selectedRange),i.asc_setScanByRows(this._state.searchByRows),i.asc_setLookIn(this._state.lookIn?Asc.c_oAscFindLookIn.Formulas:Asc.c_oAscFindLookIn.Value),i.asc_setIsReplaceAll(!1),this.api.asc_replaceText(i)},onQueryReplaceAll:function(t,e){this.api.isReplaceAll=!0;var i=new Asc.asc_CFindOptions;i.asc_setFindWhat(t),i.asc_setReplaceWith(e),i.asc_setIsMatchCase(this._state.matchCase),i.asc_setIsWholeCell(this._state.matchWord),i.asc_setScanOnOnlySheet(this._state.withinSheet),this._state.withinSheet===Asc.c_oAscSearchBy.Range&&i.asc_setSpecificRange(this._state.selectedRange),i.asc_setScanByRows(this._state.searchByRows),i.asc_setLookIn(this._state.lookIn?Asc.c_oAscFindLookIn.Formulas:Asc.c_oAscFindLookIn.Value),i.asc_setIsReplaceAll(!0),this.api.asc_replaceText(i)},onRenameText:function(t,e){this.api.isReplaceAll?t?(!(t-e)&&this.removeResultItems("replace-all"),!(t-e)||e>t?this.view.updateResultsNumber("replace-all",e):this.view.updateResultsNumber("replace",[e,t,t-e])):this.removeResultItems("replace-all",!0):this.onQuerySearch()},removeResultItems:function(t,e){this.resultItems=[],"replace-all"!==t&&this.view.updateResultsNumber(t,0),e||(this.hideResults(),this._state.currentResult=0,this._state.resultsNumber=0,this.view.disableNavButtons(),Common.NotificationCenter.trigger("search:updateresults",void 0,0))},onApiRemoveTextAroundSearch:function(t){if(this.resultItems&&(!this.resultItems||0!==this.resultItems.length)){var e=this;t.forEach((function(t){var i=_.findIndex(e.resultItems,{id:t});-1!==i&&(e.resultItems[i].$el.remove(),e.resultItems.splice(i,1))})),0===this.resultItems.length&&this.removeResultItems()}},onUpdateSearchCurrent:function(t,e){-1!==t&&(this._state.currentResult=t,this._state.resultsNumber=e,this.view&&(this.view.updateResultsNumber(t,e),this.view.disableNavButtons(t,e),this.resultItems&&this.resultItems.length>0&&(this.resultItems.forEach((function(t){t.selected=!1})),this.resultItems[t]&&(this._state.lastSelectedItem=this.resultItems[t].data,this.resultItems[t].selected=!0,$("#search-results").find(".item").removeClass("selected"),this.resultItems[t].$el.addClass("selected")))),Common.NotificationCenter.trigger("search:updateresults",t,e))},scrollToSelectedResult:function(t){var e=void 0!==t?t:_.findIndex(this.resultItems,{selected:!0});if(-1!==e){var i=this.resultItems[e].$el,o=i.outerHeight(),n=Common.Utils.getPosition(i).top,s=this.view.$resultsContainer.find(".search-items"),a=s.outerHeight(),r=s.scrollTop();n<0||0===r&&n>a?this.view.$resultsContainer.scroller.scrollTop(r+n-12):n+o>a&&this.view.$resultsContainer.scroller.scrollTop(r+o)}},onStartTextAroundSearch:function(){this.view&&(this._state.isStartedAddingResults=!0)},onEndTextAroundSearch:function(){this.view&&(this._state.isStartedAddingResults=!1,this.view.updateScrollers())},onApiGetTextAroundSearch:function(t){if(this.view&&this._state.isStartedAddingResults){if(t.length>300||!t.length)return;var e,i=this,o=i.view.$resultsContainer.find(".search-items");i.resultItems=[],t.forEach((function(t,n){var s=n===i._state.currentResult,a='<div role="row" class="item" style="width: 100%;"><div role="cell" class="sheet">'+(t[1]?Common.Utils.String.htmlEncode(t[1]):"")+'</div><div role="cell" class="name">'+(t[2]?Common.Utils.String.htmlEncode(t[2]):"")+'</div><div role="cell" class="cell">'+(t[3]?Common.Utils.String.htmlEncode(t[3]):"")+'</div><div role="cell" class="value">'+(t[4]?Common.Utils.String.htmlEncode(t[4]):"")+'</div><div role="cell" class="formula">'+(t[5]?Common.Utils.String.htmlEncode(t[5]):"")+"</div></div>",r=$(a).appendTo(o);s&&(r.addClass("selected"),i._state.lastSelectedItem=t,e=n);var l={id:t[0],$el:r,el:a,selected:s,data:t};i.resultItems.push(l),r.on("click",_.bind((function(e){if(i._state.isContentChanged)return i._state.lastSelectedItem=t,void i.onQuerySearch();var o=t[0];i.api.asc_SelectSearchElement(o)}),i)),i.addTooltips(r,t)})),this.view.$resultsContainer.show(),this.scrollToSelectedResult(e)}},addTooltips:function(t,e){var i=[t.find(".sheet"),t.find(".name"),t.find(".cell"),t.find(".value"),t.find(".formula")],o=[e[1],e[2],e[3],e[4],e[5]];i.forEach((function(t,e){t.data("bs.tooltip")&&t.removeData("bs.tooltip");var i=o[e];i&&(t.off("mouseenter"),t.one("mouseenter",(function(){t.attr("data-toggle","tooltip"),t.tooltip({title:i,placement:"cursor",zIndex:1e3}),t.mouseenter()})))}))},hideResults:function(){this.view&&(0===this.view.$resultsContainer.find(".many-results").length&&this.view.$resultsContainer.hide(),this.view.$resultsContainer.find(".search-items").empty())},onShowAfterSearch:function(t){var e=""===t,i=this.getApplication().getController("Viewport");i.isSearchBarVisible()&&i.searchBar.hide();var o=this.api.asc_getActiveRangeStr(Asc.referenceType.A,null,null,!0),n=!1;null!==o&&(this.changeWithinSheet(Asc.c_oAscSearchBy.Range),this._state.selectedRange=o,this.view.cmbWithin.setValue(Asc.c_oAscSearchBy.Range),this.view.inputSelectRange.setValue(o),n=!0);var s=this.api.asc_GetSelectedText(),a="string"==typeof t?t:s&&s.trim()||this._state.searchText;if(this.resultItems&&this.resultItems.length>0||!a&&this._state.isResults){if(!a&&!this.view.inputText.getValue())return this._state.noSearchEmptyCells=!0,void this.onQuerySearch();if(!n&&(!this._state.matchCase&&a&&a.toLowerCase()===this.view.inputText.getValue().toLowerCase()||this._state.matchCase&&a===this.view.inputText.getValue()))return}a?this.view.setFindText(a):e&&(this.view.setFindText(""),this._state.isResults||(this._state.searchText=void 0)),this.hideResults(),!n&&void 0!==this._state.searchText&&a&&a===this._state.searchText&&this._state.isResults?this.api.asc_StartTextAroundSearch():this._state.searchText?(this._state.searchText=a,this.onQuerySearch()):(this.resultItems=[],this.view.clearResultsNumber()),this.view.disableNavButtons(this._state.currentResult,this._state.resultsNumber)},onShowPanel:function(){if(this.onSelectSearchingResults(!0),this.resultItems&&this.resultItems.length>0&&!this._state.isStartedAddingResults){var t=this,e=this.view.$resultsContainer.find(".search-items");this.view.$resultsContainer.show(),this.resultItems.forEach((function(i){var o=$(i.el).appendTo(e);i.$el=o,i.selected&&o.addClass("selected"),o.on("click",(function(e){t.api.asc_SelectSearchElement(i.id),$("#search-results").find(".item").removeClass("selected"),$(e.currentTarget).addClass("selected")})),t.addTooltips(o,i.data)})),this.scrollToSelectedResult()}},onHidePanel:function(){this.hideResults(),this.onSelectSearchingResults(!1)},onSelectSearchingResults:function(t){!t&&this.getApplication().getController("LeftMenu").isSearchPanelVisible()||this._state.isHighlightedResults!==t&&(this.api.asc_selectSearchingResults(t),this._state.isHighlightedResults=t)},onApiModifiedDocument:function(){this._state.isContentChanged=!0,this.view.updateResultsNumber("content-changed"),this.view.disableReplaceButtons(!0)},onActiveSheetChanged:function(t){this._state.isHighlightedResults&&this._state.withinSheet===Asc.c_oAscSearchBy.Sheet&&this.onQuerySearch(void 0,!0)},getSearchText:function(){return this._state.searchText},getResultsNumber:function(){return[this._state.currentResult,this._state.resultsNumber]},onApiUpdateSearchElem:function(t){if(this.resultItems&&this.resultItems.length>0){var e=this;t.forEach((function(t){var i=_.findWhere(e.resultItems,{id:t[0]});i&&(i.data=t,i.el='<div class="item" style="width: 100%;"><div class="sheet">'+(t[1]?t[1]:"")+'</div><div class="name">'+(t[2]?t[2]:"")+'</div><div class="cell">'+(t[3]?t[3]:"")+'</div><div class="value">'+(t[4]?t[4]:"")+'</div><div class="formula">'+(t[5]?t[5]:"")+"</div></div>",e.view.$el.is(":visible")&&(i.$el.find(".sheet").text(t[1]?t[1]:""),i.$el.find(".name").text(t[2]?t[2]:""),i.$el.find(".cell").text(t[3]?t[3]:""),i.$el.find(".value").text(t[4]?t[4]:""),i.$el.find(".formula").text(t[5]?t[5]:""),e.addTooltips(i.$el,t)))}))}},textNoTextFound:"The data you have been searching for could not be found. Please adjust your search options.",textReplaceSuccess:"Search has been done. {0} occurrences have been replaced",textReplaceSkipped:"The replacement has been made. {0} occurrences were skipped.",textInvalidRange:"ERROR! Invalid cells range"},SSE.Controllers.Search||{}))})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Protection",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout","common/main/lib/component/Window"],(function(t){"use strict";Common.Views.Protection=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;t.appConfig.isPasswordSupport&&(this.btnsAddPwd.concat(this.btnsChangePwd).forEach((function(e){e.on("click",(function(e,i){t.fireEvent("protect:password",[e,"add"])}))})),this.btnsDelPwd.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("protect:password",[e,"delete"])}))})),this.btnPwd.on("click",(function(e,i){!e.pressed&&t.fireEvent("protect:password",[e,"delete"])})),this.btnPwd.menu.on("item:click",(function(e,i,o){t.fireEvent("protect:password",[e,i.value])}))),t.appConfig.isSignatureSupport&&(this.btnSignature.menu&&(this.btnSignature.menu.on("item:click",(function(e,i,o){t.fireEvent("protect:signature",[i.value,!1])})),this.btnSignature.menu.on("show:after",(function(e,i){if(t._state){var o=!!t._state.docProtection&&(t._state.docProtection.isReadOnly||t._state.docProtection.isFormsOnly||t._state.docProtection.isCommentsOnly);e.items&&e.items[1].setDisabled(o||t._state.disabled)}}))),this.btnsInvisibleSignature.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("protect:signature",["invisible"])}))}))),t._isSetEvents=!0}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.appConfig=t.mode,this.btnsInvisibleSignature=[],this.btnsAddPwd=[],this.btnsDelPwd=[],this.btnsChangePwd=[],this._state={disabled:!1,hasPassword:!1,disabledPassword:!1,invisibleSignDisabled:!1};var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:"",this.appConfig.isPasswordSupport&&(this.btnAddPwd=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-protect",caption:this.txtEncrypt,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.btnsAddPwd.push(this.btnAddPwd),this.btnPwd=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-protect",caption:this.txtEncrypt,split:!0,enableToggle:!0,menu:!0,visible:!1,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"})),this.appConfig.isSignatureSupport&&(this.btnSignature=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-signature",caption:this.txtSignature,menu:"pe-"!==this.appPrefix,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.btnSignature.menu||this.btnsInvisibleSignature.push(this.btnSignature)),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return this.boxSdk=$("#editor_sdk"),t&&t.html(this.getPanel()),this},onAppReady:function(e){var i=this;new Promise((function(t,e){t()})).then((function(){e.canProtect&&(e.isPasswordSupport&&(i.btnAddPwd.updateHint(i.hintAddPwd),i.btnPwd.updateHint([i.hintDelPwd,i.hintPwd]),i.btnPwd.setMenu(new Common.UI.Menu({items:[{caption:i.txtChangePwd,value:"add"},{caption:i.txtDeletePwd,value:"delete"}]}))),i.btnSignature&&(i.btnSignature.updateHint(i.btnSignature.menu?i.hintSignature:i.txtInvisibleSignature),i.btnSignature.menu&&i.btnSignature.setMenu(new Common.UI.Menu({items:[{caption:i.txtInvisibleSignature,value:"invisible"},{caption:i.txtSignatureLine,value:"visible",disabled:i._state.disabled}]}))),Common.NotificationCenter.trigger("tab:visible","protect",Common.UI.LayoutManager.isElementVisible("toolbar-protect"))),t.call(i)}))},getPanel:function(){return this.$el=$(_.template('<section id="protection-panel" class="panel" data-tab="protect" role="tabpanel" aria-labelledby="protect"><div class="group"><span id="slot-btn-add-password" class="btn-slot text x-huge"></span><span id="slot-btn-change-password" class="btn-slot text x-huge"></span><span id="slot-btn-signature" class="btn-slot text x-huge"></span></div></section>')({})),this.appConfig.canProtect&&(this.btnAddPwd&&this.btnAddPwd.render(this.$el.find("#slot-btn-add-password")),this.btnPwd&&this.btnPwd.render(this.$el.find("#slot-btn-change-password")),this.btnSignature&&this.btnSignature.render(this.$el.find("#slot-btn-signature"))),this.$el},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButton:function(t,e){var i=this;if("signature"==t){var o=new Common.UI.Button({cls:"btn-text-default auto",caption:this.txtInvisibleSignature,disabled:this._state.invisibleSignDisabled,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"medium"});return this.btnsInvisibleSignature.push(o),this._isSetEvents&&o.on("click",(function(t,e){i.fireEvent("protect:signature",["invisible"])})),o}if("add-password"==t){o=new Common.UI.Button({cls:"btn-text-default auto",caption:this.txtAddPwd,disabled:this._state.disabled||this._state.disabledPassword,visible:!this._state.hasPassword,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"medium"});return this.btnsAddPwd.push(o),this._isSetEvents&&o.on("click",(function(t,e){i.fireEvent("protect:password",[t,"add"])})),o}if("del-password"==t){o=new Common.UI.Button({cls:"btn-text-default auto",caption:this.txtDeletePwd,disabled:this._state.disabled||this._state.disabledPassword,visible:this._state.hasPassword,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"medium"});return this.btnsDelPwd.push(o),this._isSetEvents&&o.on("click",(function(t,e){i.fireEvent("protect:password",[t,"delete"])})),o}if("change-password"==t){o=new Common.UI.Button({cls:"btn-text-default auto",caption:this.txtChangePwd,disabled:this._state.disabled||this._state.disabledPassword,visible:this._state.hasPassword,dataHint:"2",dataHintDirection:"bottom",dataHintOffset:"medium"});return this.btnsChangePwd.push(o),this._isSetEvents&&o.on("click",(function(t,e){i.fireEvent("protect:password",[t,"add"])})),o}},SetDisabled:function(t,e){this._state.disabled=t,this._state.invisibleSignDisabled=t&&!e;var i=!!this._state.docProtection&&(this._state.docProtection.isReadOnly||this._state.docProtection.isFormsOnly||this._state.docProtection.isCommentsOnly);this.btnsInvisibleSignature&&this.btnsInvisibleSignature.forEach((function(i){i&&i.setDisabled(t&&!e)}),this),this.btnSignature&&this.btnSignature.menu&&(this.btnSignature.menu.items&&this.btnSignature.menu.items[1].setDisabled(t||i),this.btnSignature.setDisabled(t&&!e)),this.btnsAddPwd.concat(this.btnsDelPwd,this.btnsChangePwd).forEach((function(e){e&&e.setDisabled(t||this._state.disabledPassword)}),this)},onDocumentPassword:function(t,e){this._state.hasPassword=t,this._state.disabledPassword=!!e;var i=this._state.disabledPassword||this._state.disabled;this.btnsAddPwd&&this.btnsAddPwd.forEach((function(e){e&&(e.setVisible(!t),e.setDisabled(i))}),this),this.btnsDelPwd.concat(this.btnsChangePwd).forEach((function(e){e&&(e.setVisible(t),e.setDisabled(i))}),this),this.btnPwd.setVisible(t),this.btnPwd.toggle(t,!0)},txtEncrypt:"Encrypt",txtSignature:"Signature",hintAddPwd:"Encrypt with password",hintPwd:"Change or delete password",hintSignature:"Add digital signature or signature line",txtChangePwd:"Change password",txtDeletePwd:"Delete password",txtAddPwd:"Add password",txtInvisibleSignature:"Add digital signature",txtSignatureLine:"Add Signature line",hintDelPwd:"Delete password"}}(),Common.Views.Protection||{}))})),define("spreadsheeteditor/main/app/view/WBProtection",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout","common/main/lib/component/Window","common/main/lib/view/OpenDialog"],(function(t){"use strict";SSE.Views.WBProtection=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;this.btnProtectWB.on("click",(function(e,i){t.fireEvent("protect:workbook",[e.pressed])})),this.btnProtectSheet.on("click",(function(e,i){t.fireEvent("protect:sheet",[e.pressed])})),this.btnAllowRanges.on("click",(function(e,i){t.fireEvent("protect:allow-ranges")})),this.chLockedCell.on("change",(function(e,i){t.fireEvent("protect:lock-options",[0,i])})),this.chLockedShape.on("change",(function(e,i){t.fireEvent("protect:lock-options",[1,i])})),this.chLockedText.on("change",(function(e,i){t.fireEvent("protect:lock-options",[2,i])})),this.chHiddenFormula.on("change",(function(e,i){t.fireEvent("protect:lock-options",[3,i])})),this.btnProtectRange.on("click",(function(e,i){t.fireEvent("protect:range")})),t._isSetEvents=!0}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.appConfig=t.mode;var e=Common.enumLock;this.lockedControls=[],this._state={disabled:!1},this.btnProtectWB=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-protect-workbook",enableToggle:!0,caption:this.txtProtectWB,lock:[e.editCell,e.selRangeEdit,e.lostConnect,e.coAuth],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnProtectWB),this.btnProtectSheet=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-protect-sheet",enableToggle:!0,caption:this.txtProtectSheet,lock:[e.editCell,e.selRangeEdit,e.lostConnect,e.coAuth],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnProtectSheet),this.btnAllowRanges=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-allow-edit-ranges",caption:this.txtAllowRanges,lock:[e.editCell,e.selRangeEdit,e.lostConnect,e.coAuth,e.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnAllowRanges),this.chLockedCell=new Common.UI.CheckBox({labelText:this.txtLockedCell,lock:[e.editCell,e.selRangeEdit,e.selChart,e.selChartText,e.selShape,e.selShapeText,e.selImage,e.selSlicer,e.wsLock,e.wbLock,e.lostConnect,e.coAuth,e.userProtected],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chLockedCell),this.chLockedShape=new Common.UI.CheckBox({labelText:this.txtLockedShape,lock:[e.selRange,e.selRangeEdit,e.wbLock,e.lostConnect,e.coAuth,e.Objects,e.wsLockShape],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chLockedShape),this.chLockedText=new Common.UI.CheckBox({labelText:this.txtLockedText,lock:[e.selRange,e.selRangeEdit,e.selRangeEdit,e.selImage,e.selSlicer,e.wbLock,e.lostConnect,e.coAuth,e.Objects,e.wsLockText],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chLockedText),this.chHiddenFormula=new Common.UI.CheckBox({labelText:this.txtHiddenFormula,lock:[e.editCell,e.selRangeEdit,e.selChart,e.selChartText,e.selShape,e.selShapeText,e.selImage,e.selSlicer,e.wsLock,e.wbLock,e.lostConnect,e.coAuth,e.userProtected],dataHint:"1",dataHintDirection:"left",dataHintOffset:"small"}),this.lockedControls.push(this.chHiddenFormula),this.btnProtectRange=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-protect-range",caption:this.txtProtectRange,lock:[e.editCell,e.selRangeEdit,e.lostConnect,e.coAuth,e.wsLock],dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small",visible:!this.appConfig.isOffline}),this.lockedControls.push(this.btnProtectRange),Common.UI.LayoutManager.addControls(this.lockedControls),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return this},onAppReady:function(e){var i=this;new Promise((function(t,e){t()})).then((function(){i.btnProtectWB.updateHint(i.hintProtectWB),i.btnProtectSheet.updateHint(i.hintProtectSheet),i.btnAllowRanges.updateHint(i.hintAllowRanges),i.btnProtectRange.updateHint(i.hintProtectRange),e.isOffline&&i.btnProtectRange.cmpEl.parents(".group").hide().prev(".separator").hide(),t.call(i)}))},getPanel:function(){return this.$el=$(_.template('<div class="group"><span id="slot-btn-protect-wb" class="btn-slot text x-huge margin-right-2"></span><span id="slot-btn-protect-sheet" class="btn-slot text x-huge"></span></div><div class="separator long invisible"></div><div class="group small"><div class="elset"><span class="btn-slot text" id="slot-chk-locked-cell"></span></div><div class="elset"><span class="btn-slot text" id="slot-chk-hidden-formula"></span></div></div><div class="separator long invisible"></div><div class="group small"><div class="elset"><span class="btn-slot text" id="slot-chk-locked-shape"></span></div><div class="elset"><span class="btn-slot text" id="slot-chk-locked-text"></span></div></div><div class="separator long"></div><div class="group"><span id="slot-btn-protect-range" class="btn-slot text x-huge"></span></div>')({})),this.btnProtectWB.render(this.$el.find("#slot-btn-protect-wb")),this.btnProtectSheet.render(this.$el.find("#slot-btn-protect-sheet")),this.btnAllowRanges.render(this.$el.find("#slot-btn-allow-ranges")),this.chLockedCell.render(this.$el.find("#slot-chk-locked-cell")),this.chLockedShape.render(this.$el.find("#slot-chk-locked-shape")),this.chLockedText.render(this.$el.find("#slot-chk-locked-text")),this.chHiddenFormula.render(this.$el.find("#slot-chk-hidden-formula")),this.btnProtectRange.render(this.$el.find("#slot-btn-protect-range")),this.$el},getButtons:function(t){return void 0===t?this.lockedControls:[]},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},txtProtectWB:"Protect Workbook",txtProtectSheet:"Protect Sheet",txtAllowRanges:"Allow Edit Ranges",hintProtectWB:"Protect workbook",hintProtectSheet:"Protect sheet",hintAllowRanges:"Allow edit ranges",txtLockedCell:"Locked Cell",txtLockedShape:"Shape Locked",txtLockedText:"Lock Text",txtHiddenFormula:"Hidden Formulas",txtWBUnlockTitle:"Unprotect Workbook",txtWBUnlockDescription:"Enter a password to unprotect workbook",txtSheetUnlockTitle:"Unprotect Sheet",txtSheetUnlockDescription:"Enter a password to unprotect sheet",hintProtectRange:"Protect range",txtProtectRange:"Protect Range"}}(),SSE.Views.WBProtection||{}))})),define("spreadsheeteditor/main/app/controller/WBProtection",["core","common/main/lib/view/Protection","spreadsheeteditor/main/app/view/WBProtection"],(function(){"use strict";SSE.Controllers.WBProtection=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["WBProtection"],sdkViewName:"#id_main",initialize:function(){this.addListeners({WBProtection:{"protect:workbook":_.bind(this.onWorkbookClick,this),"protect:sheet":_.bind(this.onSheetClick,this),"protect:allow-ranges":_.bind(this.onAllowRangesClick,this),"protect:lock-options":_.bind(this.onLockOptionClick,this),"protect:range":_.bind(this.onProtectRangeClick,this)}})},onLaunch:function(){this._state={},this.wsLockOptions=["SelectLockedCells","SelectUnlockedCells","FormatCells","FormatColumns","FormatRows","InsertColumns","InsertRows","InsertHyperlinks","DeleteColumns","DeleteRows","Sort","AutoFilter","PivotTables","Objects","Scenarios"],Common.enumLock&&this.wsLockOptions.forEach((function(t){Common.enumLock[t]=t})),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),Common.NotificationCenter.on("protect:sheet",_.bind(this.onSheetClick,this))},setConfig:function(t,e){this.setApi(e),t&&(this.sdkViewName=t.sdkviewname||this.sdkViewName)},setApi:function(t){t&&(this.api=t,this.api.asc_registerCallback("asc_onChangeProtectWorkbook",_.bind(this.onChangeProtectWorkbook,this)),this.api.asc_registerCallback("asc_onChangeProtectWorksheet",_.bind(this.onChangeProtectSheet,this)),this.api.asc_registerCallback("asc_onActiveSheetChanged",_.bind(this.onActiveSheetChanged,this)),this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onApiSelectionChanged,this)))},setMode:function(t){return this.appConfig=t,this.appConfig.isEdit&&this.appConfig.canProtect&&(this.view=this.createView("WBProtection",{mode:t})),this},createToolbarPanel:function(){if(this.view)return this.view.getPanel()},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onWorkbookClick:function(t){if(this.view.btnProtectWB.toggle(!t,!0),t){var e=this,i=new SSE.Views.ProtectDialog({type:"workbook",handler:function(t,i){if(o=t,"ok"==t){var n=e.api.asc_getProtectedWorkbook();n.asc_setLockStructure(i),e.api.asc_setProtectedWorkbook(n)}Common.NotificationCenter.trigger("edit:complete")}}).on("close",(function(){"ok"!==o&&e.view.btnProtectWB.toggle(!1,!0)}));i.show()}else{var o,n=(e=this).api.asc_getProtectedWorkbook();if(n.asc_isPassword())(i=new Common.Views.OpenDialog({title:e.view.txtWBUnlockTitle,closable:!0,type:Common.Utils.importTextType.DRM,txtOpenFile:e.view.txtWBUnlockDescription,validatePwd:!1,handler:function(t,i){o=t,"ok"==t&&(e.api&&(n.asc_setLockStructure(i&&i.drmOptions?i.drmOptions.asc_getPassword():void 0),e.api.asc_setProtectedWorkbook(n)),Common.NotificationCenter.trigger("edit:complete"))}}).on("close",(function(){"ok"!==o&&e.view.btnProtectWB.toggle(!0,!0)}))).show();else n.asc_setLockStructure(),e.api.asc_setProtectedWorkbook(n)}},onSheetClick:function(t){if(this.view.btnProtectSheet.toggle(!t,!0),t){var e=(o=this).api.asc_getProtectedSheet(),i=new SSE.Views.ProtectDialog({type:"sheet",props:e,api:o.api,handler:function(t,e,i){n=t,"ok"==t&&(i.asc_setSheet(e),o.api.asc_setProtectedSheet(i)),Common.NotificationCenter.trigger("edit:complete")}}).on("close",(function(){"ok"!==n&&o.view.btnProtectSheet.toggle(!1,!0)}));i.show()}else{var o,n;if((e=(o=this).api.asc_getProtectedSheet()).asc_isPassword())(i=new Common.Views.OpenDialog({title:o.view.txtSheetUnlockTitle,closable:!0,type:Common.Utils.importTextType.DRM,txtOpenFile:o.view.txtSheetUnlockDescription,validatePwd:!1,handler:function(t,i){n=t,"ok"==t&&(o.api&&(e.asc_setSheet(i&&i.drmOptions?i.drmOptions.asc_getPassword():void 0),o.api.asc_setProtectedSheet(e)),Common.NotificationCenter.trigger("edit:complete"))}}).on("close",(function(){"ok"!==n&&o.view.btnProtectSheet.toggle(!0,!0)}))).show();else e.asc_setSheet(),o.api.asc_setProtectedSheet(e)}},onAllowRangesClick:function(){var t=this,e=t.api.asc_getProtectedRanges();new SSE.Views.ProtectRangesDlg({api:t.api,props:e,handler:function(e,i){"protect-sheet"==e?(t.api.asc_setProtectedRanges(i.arr,i.deletedArr),t.onSheetClick(!0)):"ok"==e&&t.api.asc_setProtectedRanges(i.arr,i.deletedArr),Common.NotificationCenter.trigger("edit:complete")}}).show()},onLockOptionClick:function(t,e){switch(t){case 0:this.api.asc_setCellLocked("checked"==e);break;case 1:(i=new Asc.asc_CImgProperty).asc_putProtectionLocked("checked"==e),this.api.asc_setGraphicObjectProps(i);break;case 2:var i;(i=new Asc.asc_CImgProperty).asc_putProtectionLockText("checked"==e),this.api.asc_setGraphicObjectProps(i);break;case 3:this.api.asc_setCellHiddenFormulas("checked"==e)}Common.NotificationCenter.trigger("edit:complete",this)},onProtectRangeClick:function(){var t=this;new SSE.Views.ProtectedRangesManagerDlg({api:t.api,canRequestUsers:t.appConfig.canRequestUsers,currentUser:t.appConfig.user,handler:function(t,e){Common.NotificationCenter.trigger("edit:complete")}}).show()},onAppReady:function(t){if(this.view){var e=this;new Promise((function(t){t()})).then((function(){e.view.btnProtectWB.toggle(e.api.asc_isProtectedWorkbook(),!0);var t=e.getWSProps();t&&(e.view.btnProtectSheet.toggle(t.wsLock,!0),Common.Utils.lockControls(Common.enumLock.Objects,t.wsProps.Objects,{array:[e.view.chLockedText,e.view.chLockedShape]}),Common.Utils.lockControls(Common.enumLock.wsLock,t.wsLock,{array:[e.view.btnAllowRanges]}))}))}},onChangeProtectWorkbook:function(){this.view&&this.view.btnProtectWB.toggle(this.api.asc_isProtectedWorkbook(),!0)},onChangeProtectSheet:function(){var t=this.getWSProps(!0);this.view&&t&&(this.view.btnProtectSheet.toggle(t.wsLock,!0),Common.Utils.lockControls(Common.enumLock.Objects,t.wsProps.Objects,{array:[this.view.chLockedText,this.view.chLockedShape]}),Common.Utils.lockControls(Common.enumLock.wsLock,t.wsLock,{array:[this.view.btnAllowRanges]})),Common.NotificationCenter.trigger("protect:wslock",t)},onActiveSheetChanged:function(){this.onChangeProtectSheet()},getWSProps:function(t){if(this.appConfig&&(this.appConfig.isEdit||this.appConfig.isRestrictedEdit)){if(t||!this._state.protection){var e=!!this.api.asc_isProtectedSheet(),i=[];if(e){i=[];var o=this.api.asc_getProtectedSheet();o&&this.wsLockOptions.forEach((function(t){i[t]=!!o["asc_get"+t]&&o["asc_get"+t]()}))}else this.wsLockOptions.forEach((function(t){i[t]=!1}));this._state.protection={wsLock:e,wsProps:i}}return this._state.protection}},onApiSelectionChanged:function(t){if(this.view&&t&&!($(".asc-window.enable-key-events:visible").length>0)){var e=t.asc_getSelectionType(),i=e===Asc.c_oAscSelectionType.RangeCells||e===Asc.c_oAscSelectionType.RangeCol||e===Asc.c_oAscSelectionType.RangeRow||e===Asc.c_oAscSelectionType.RangeMax;Common.Utils.lockControls(Common.enumLock.selRange,i,{array:[this.view.chLockedText,this.view.chLockedShape]});var o=t.asc_getXfs();if(this.view.chLockedCell.setValue(!!o.asc_getLocked(),!0),this.view.chHiddenFormula.setValue(!!o.asc_getHidden(),!0),e===Asc.c_oAscSelectionType.RangeSlicer||e===Asc.c_oAscSelectionType.RangeImage||e===Asc.c_oAscSelectionType.RangeShape||e===Asc.c_oAscSelectionType.RangeShapeText||e===Asc.c_oAscSelectionType.RangeChart||e===Asc.c_oAscSelectionType.RangeChartText)for(var n=this.api.asc_getGraphicObjectProps(),s=0;s<n.length;s++)if(n[s].asc_getObjectType()==Asc.c_oAscTypeSelectElement.Image){var a=n[s].asc_getObjectValue(),r=a.asc_getProtectionLockText(),l=a.asc_getProtectionLocked();this.view.chLockedText.setValue(void 0!==r?!!r:"indeterminate",!0),this.view.chLockedShape.setValue(void 0!==l?!!l:"indeterminate",!0),Common.Utils.lockControls(Common.enumLock.wsLockText,null===r,{array:[this.view.chLockedText]}),Common.Utils.lockControls(Common.enumLock.wsLockShape,null===l,{array:[this.view.chLockedShape]});break}Common.Utils.lockControls(Common.enumLock.userProtected,!!t.asc_getUserProtected(),{array:[this.view.chLockedCell,this.view.chHiddenFormula]})}}},SSE.Controllers.WBProtection||{}))})),define("spreadsheeteditor/main/app/controller/Offline",["spreadsheeteditor/main/app/controller/Main"],(function(){"use strict";var t=SSE.Controllers.Main.prototype.loadDocument;return SSE.Controllers.Main.prototype.loadDocument=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(i){var o,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.call(this,i),!window.isOffline){e.next=15;break}if(this.api.onLicense({type:"license",license:{}}),this.api.onAuth({type:"auth",result:1,licenseType:3}),!i.doc.url){e.next=11;break}return o=i.doc.url,e.next=8,AscCommon.x2t.convertToBin(o,i.doc.title,i.doc.fileType);case 8:n=e.sent,e.next=12;break;case 11:n={binary:"XLSY;v2;6160;BwaAAgAAB6ACAAACrgIAAAM5BAAABFoEAAAArQQAAAoMGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEbAAAA+gMAAAAADAANAA4ADwD7AAcAAAD6EgAAAAD7AgkAAAD6+wACAAAA+vuHAQAAAB4AAAABGQAAAAAAAAAAAQAAAAACAAAAAAQAAAAABQAAAAAEIAAAAAULAAAAAAYAAAACAQAAABEFCwAAAAAGAAAAAgEAAAAIBi8AAAAHKgAAAAEGAwAAAAIBAQQGDgAAAEMAYQBsAGkAYgByAGkACQEBBgUAAAAAAAAmQA4dAAAAAxgAAAAGBAAAAAAHBAAAAAAIBAAAAAAJBAAAAAACIwAAAAMeAAAABgQAAAAABwQAAAAACAQAAAAACQQAAAAADAQAAAAADygAAAAQIwAAAAAEAAAAAAAAAAQMAAAATgBvAHIAbQBhAGwABQQAAAAAAAAACgAAAAAMTgAAAAAiAAAAVABhAGIAbABlAFMAdAB5AGwAZQBNAGUAZABpAHUAbQAyAAEiAAAAUABpAHYAbwB0AFMAdAB5AGwAZQBMAGkAZwBoAHQAMQA2ABE3AAAAADIAAAD6ABEAAABTAGwAaQBjAGUAcgBTAHQAeQBsAGUATABpAGcAaAB0ADEA+wAEAAAAAAAAAB0AAAAAAAAAAAEFAAAAAgAAAAAPCQAAAAAEAAAAv1MCAE8AAAAASgAAAAEYAAAAAAYMAAAAUwBoAGUAZQB0ADEAAQQBAAAAFhQAAAAXDwAAAAoBAAAAAQ4EAAAAAAAAAAsKAAAAAQUAAAAAAAAuQAkAAAAAWxMAAAVWEwAAFFETAAD6AAwAAABPAGYAZgBpAGMAZQAgAFQAaABlAG0AZQD7ACQTAAAAHQEAAPoACgAAAE4AZQB3ACAATwBmAGYAaQBjAGUA+wANAAAAAQgAAAD6AFsBmwLV+wENAAAAAQgAAAD6AO0BfQIx+wINAAAAAQgAAAD6AKUBpQKl+wMNAAAAAQgAAAD6AP8BwAIA+wQNAAAAAQgAAAD6AEQBcgLE+wUNAAAAAQgAAAD6AHABrQJH+wgmAAAABCEAAAD6AAoAAAB3AGkAbgBkAG8AdwBUAGUAeAB0AAEAAgADAPsJDQAAAAEIAAAA+gBEAVQCavsKDQAAAAEIAAAA+gCVAU8CcvsLDQAAAAEIAAAA+gAFAWMCwfsMHgAAAAQZAAAA+gAGAAAAdwBpAG4AZABvAHcAAf8C/wP/+w0NAAAAAQgAAAD6AOcB5gLm+wEzCwAA+gAGAAAATwBmAGYAaQBjAGUA+wCwBQAAAE4AAAD6ARQAAAAwADIAMABGADAAMwAwADIAMAAyADAAMgAwADQAMAAzADAAMgAwADQAAw0AAABDAGEAbABpAGIAcgBpACAATABpAGcAaAB0APsBEQAAAPoDBQAAAEEAcgBpAGEAbAD7AhEAAAD6AwUAAABBAHIAaQBhAGwA+wMsBQAAHgAAAAAkAAAA+gAEAAAASgBwAGEAbgABCAAAAC3/M/8gADD/tDC3MMMwrzD7AB4AAAD6AAQAAABIAGEAbgBnAAEFAAAA0blAxyAA4KwVtfsAGAAAAPoABAAAAEgAYQBuAHMAAQIAAACLW1NP+wAcAAAA+gAEAAAASABhAG4AdAABBAAAALBlMH0OZtSa+wAyAAAA+gAEAAAAQQByAGEAYgABDwAAAFQAaQBtAGUAcwAgAE4AZQB3ACAAUgBvAG0AYQBuAPsAMgAAAPoABAAAAEgAZQBiAHIAAQ8AAABUAGkAbQBlAHMAIABOAGUAdwAgAFIAbwBtAGEAbgD7ACAAAAD6AAQAAABUAGgAYQBpAAEGAAAAVABhAGgAbwBtAGEA+wAeAAAA+gAEAAAARQB0AGgAaQABBQAAAE4AeQBhAGwAYQD7ACAAAAD6AAQAAABCAGUAbgBnAAEGAAAAVgByAGkAbgBkAGEA+wAgAAAA+gAEAAAARwB1AGoAcgABBgAAAFMAaAByAHUAdABpAPsAJgAAAPoABAAAAEsAaABtAHIAAQkAAABNAG8AbwBsAEIAbwByAGEAbgD7AB4AAAD6AAQAAABLAG4AZABhAAEFAAAAVAB1AG4AZwBhAPsAHgAAAPoABAAAAEcAdQByAHUAAQUAAABSAGEAYQB2AGkA+wAkAAAA+gAEAAAAQwBhAG4AcwABCAAAAEUAdQBwAGgAZQBtAGkAYQD7ADwAAAD6AAQAAABDAGgAZQByAAEUAAAAUABsAGEAbgB0AGEAZwBlAG4AZQB0ACAAQwBoAGUAcgBvAGsAZQBlAPsAOAAAAPoABAAAAFkAaQBpAGkAARIAAABNAGkAYwByAG8AcwBvAGYAdAAgAFkAaQAgAEIAYQBpAHQAaQD7ADgAAAD6AAQAAABUAGkAYgB0AAESAAAATQBpAGMAcgBvAHMAbwBmAHQAIABIAGkAbQBhAGwAYQB5AGEA+wAiAAAA+gAEAAAAVABoAGEAYQABBwAAAE0AVgAgAEIAbwBsAGkA+wAgAAAA+gAEAAAARABlAHYAYQABBgAAAE0AYQBuAGcAYQBsAPsAIgAAAPoABAAAAFQAZQBsAHUAAQcAAABHAGEAdQB0AGEAbQBpAPsAHgAAAPoABAAAAFQAYQBtAGwAAQUAAABMAGEAdABoAGEA+wA2AAAA+gAEAAAAUwB5AHIAYwABEQAAAEUAcwB0AHIAYQBuAGcAZQBsAG8AIABFAGQAZQBzAHMAYQD7ACIAAAD6AAQAAABPAHIAeQBhAAEHAAAASwBhAGwAaQBuAGcAYQD7ACIAAAD6AAQAAABNAGwAeQBtAAEHAAAASwBhAHIAdABpAGsAYQD7ACYAAAD6AAQAAABMAGEAbwBvAAEJAAAARABvAGsAQwBoAGEAbQBwAGEA+wAsAAAA+gAEAAAAUwBpAG4AaAABDAAAAEkAcwBrAG8AbwBsAGEAIABQAG8AdABhAPsAMgAAAPoABAAAAE0AbwBuAGcAAQ8AAABNAG8AbgBnAG8AbABpAGEAbgAgAEIAYQBpAHQAaQD7ADIAAAD6AAQAAABWAGkAZQB0AAEPAAAAVABpAG0AZQBzACAATgBlAHcAIABSAG8AbQBhAG4A+wA0AAAA+gAEAAAAVQBpAGcAaAABEAAAAE0AaQBjAHIAbwBzAG8AZgB0ACAAVQBpAGcAaAB1AHIA+wAiAAAA+gAEAAAARwBlAG8AcgABBwAAAFMAeQBsAGYAYQBlAG4A+wFmBQAAAEIAAAD6ARQAAAAwADIAMABGADAANQAwADIAMAAyADAAMgAwADQAMAAzADAAMgAwADQAAwcAAABDAGEAbABpAGIAcgBpAPsBEQAAAPoDBQAAAEEAcgBpAGEAbAD7AhEAAAD6AwUAAABBAHIAaQBhAGwA+wPuBAAAHgAAAAAkAAAA+gAEAAAASgBwAGEAbgABCAAAAC3/M/8gADD/tDC3MMMwrzD7AB4AAAD6AAQAAABIAGEAbgBnAAEFAAAA0blAxyAA4KwVtfsAGAAAAPoABAAAAEgAYQBuAHMAAQIAAACLW1NP+wAcAAAA+gAEAAAASABhAG4AdAABBAAAALBlMH0OZtSa+wAeAAAA+gAEAAAAQQByAGEAYgABBQAAAEEAcgBpAGEAbAD7AB4AAAD6AAQAAABIAGUAYgByAAEFAAAAQQByAGkAYQBsAPsAIAAAAPoABAAAAFQAaABhAGkAAQYAAABUAGEAaABvAG0AYQD7AB4AAAD6AAQAAABFAHQAaABpAAEFAAAATgB5AGEAbABhAPsAIAAAAPoABAAAAEIAZQBuAGcAAQYAAABWAHIAaQBuAGQAYQD7ACAAAAD6AAQAAABHAHUAagByAAEGAAAAUwBoAHIAdQB0AGkA+wAkAAAA+gAEAAAASwBoAG0AcgABCAAAAEQAYQB1AG4AUABlAG4AaAD7AB4AAAD6AAQAAABLAG4AZABhAAEFAAAAVAB1AG4AZwBhAPsAHgAAAPoABAAAAEcAdQByAHUAAQUAAABSAGEAYQB2AGkA+wAkAAAA+gAEAAAAQwBhAG4AcwABCAAAAEUAdQBwAGgAZQBtAGkAYQD7ADwAAAD6AAQAAABDAGgAZQByAAEUAAAAUABsAGEAbgB0AGEAZwBlAG4AZQB0ACAAQwBoAGUAcgBvAGsAZQBlAPsAOAAAAPoABAAAAFkAaQBpAGkAARIAAABNAGkAYwByAG8AcwBvAGYAdAAgAFkAaQAgAEIAYQBpAHQAaQD7ADgAAAD6AAQAAABUAGkAYgB0AAESAAAATQBpAGMAcgBvAHMAbwBmAHQAIABIAGkAbQBhAGwAYQB5AGEA+wAiAAAA+gAEAAAAVABoAGEAYQABBwAAAE0AVgAgAEIAbwBsAGkA+wAgAAAA+gAEAAAARABlAHYAYQABBgAAAE0AYQBuAGcAYQBsAPsAIgAAAPoABAAAAFQAZQBsAHUAAQcAAABHAGEAdQB0AGEAbQBpAPsAHgAAAPoABAAAAFQAYQBtAGwAAQUAAABMAGEAdABoAGEA+wA2AAAA+gAEAAAAUwB5AHIAYwABEQAAAEUAcwB0AHIAYQBuAGcAZQBsAG8AIABFAGQAZQBzAHMAYQD7ACIAAAD6AAQAAABPAHIAeQBhAAEHAAAASwBhAGwAaQBuAGcAYQD7ACIAAAD6AAQAAABNAGwAeQBtAAEHAAAASwBhAHIAdABpAGsAYQD7ACYAAAD6AAQAAABMAGEAbwBvAAEJAAAARABvAGsAQwBoAGEAbQBwAGEA+wAsAAAA+gAEAAAAUwBpAG4AaAABDAAAAEkAcwBrAG8AbwBsAGEAIABQAG8AdABhAPsAMgAAAPoABAAAAE0AbwBuAGcAAQ8AAABNAG8AbgBnAG8AbABpAGEAbgAgAEIAYQBpAHQAaQD7AB4AAAD6AAQAAABWAGkAZQB0AAEFAAAAQQByAGkAYQBsAPsANAAAAPoABAAAAFUAaQBnAGgAARAAAABNAGkAYwByAG8AcwBvAGYAdAAgAFUAaQBnAGgAdQByAPsAIgAAAPoABAAAAEcAZQBvAHIAAQcAAABTAHkAbABmAGEAZQBuAPsCxQYAAPoABgAAAE8AZgBmAGkAYwBlAPsAdgMAAAMAAAAAEwAAAAMOAAAAAAkAAAADBAAAAPoADvsApgEAAAShAQAA+gEB+wCKAQAAAwAAAAB9AAAA+gAAAAAA+wBxAAAAA2wAAAD6AA77AGMAAAADAAAAARwAAAD6AAgAAABhADoAbAB1AG0ATQBvAGQAAbCtAQD7ARwAAAD6AAgAAABhADoAcwBhAHQATQBvAGQAASiaAQD7ARgAAAD6AAYAAABhADoAdABpAG4AdAABuAUBAPsAfQAAAPoAUMMAAPsAcQAAAANsAAAA+gAO+wBjAAAAAwAAAAEcAAAA+gAIAAAAYQA6AGwAdQBtAE0AbwBkAAEomgEA+wEcAAAA+gAIAAAAYQA6AHMAYQB0AE0AbwBkAAFYkgEA+wEYAAAA+gAGAAAAYQA6AHQAaQBuAHQAASgdAQD7AH0AAAD6AKCGAQD7AHEAAAADbAAAAPoADvsAYwAAAAMAAAABHAAAAPoACAAAAGEAOgBsAHUAbQBNAG8AZAABKJoBAPsBHAAAAPoACAAAAGEAOgBzAGEAdABNAG8AZAAByKkBAPsBGAAAAPoABgAAAGEAOgB0AGkAbgB0AAFoPAEA+wEJAAAA+gDAZVIAAQD7AKoBAAAEpQEAAPoBAfsAjgEAAAMAAAAAfQAAAPoAAAAAAPsAcQAAAANsAAAA+gAO+wBjAAAAAwAAAAEcAAAA+gAIAAAAYQA6AHMAYQB0AE0AbwBkAAFYkgEA+wEcAAAA+gAIAAAAYQA6AGwAdQBtAE0AbwBkAAFwjgEA+wEYAAAA+gAGAAAAYQA6AHQAaQBuAHQAATBvAQD7AH8AAAD6AFDDAAD7AHMAAAADbgAAAPoADvsAZQAAAAMAAAABHAAAAPoACAAAAGEAOgBzAGEAdABNAG8AZAABsK0BAPsBHAAAAPoACAAAAGEAOgBsAHUAbQBNAG8AZAABoIYBAPsBGgAAAPoABwAAAGEAOgBzAGgAYQBkAGUAAaCGAQD7AH8AAAD6AKCGAQD7AHMAAAADbgAAAPoADvsAZQAAAAMAAAABHAAAAPoACAAAAGEAOgBsAHUAbQBNAG8AZAABuIIBAPsBHAAAAPoACAAAAGEAOgBzAGEAdABNAG8AZAABwNQBAPsBGgAAAPoABwAAAGEAOgBzAGgAYQBkAGUAAbAwAQD7AQkAAAD6AMBlUgABAPsB0AAAAAMAAAAAPwAAAPoAAAEAAgEDzhgAAPsAEwAAAAMOAAAAAAkAAAADBAAAAPoADvsBBAAAAPoABvsCDAAAAPoAAwAAAAEANQwA+wA/AAAA+gAAAQACAQOcMQAA+wATAAAAAw4AAAAACQAAAAMEAAAA+gAO+wEEAAAA+gAG+wIMAAAA+gADAAAAAQA1DAD7AD8AAAD6AAABAAIBA2pKAAD7ABMAAAADDgAAAAAJAAAAAwQAAAD6AA77AQQAAAD6AAb7AgwAAAD6AAMAAAABADUMAPsCEwAAAAMAAAAAAAAAAAAAAAAAAAAAAAADRQIAAAMAAAAAEwAAAAMOAAAAAAkAAAADBAAAAPoADvsAWgAAAANVAAAAAFAAAAADSwAAAPoADvsAQgAAAAIAAAABGAAAAPoABgAAAGEAOgB0AGkAbgB0AAEYcwEA+wEcAAAA+gAIAAAAYQA6AHMAYQB0AE0AbwBkAAEQmAIA+wDFAQAABMABAAD6AQH7AKkBAAADAAAAAJwAAAD6AAAAAAD7AJAAAAADiwAAAPoADvsAggAAAAQAAAABGAAAAPoABgAAAGEAOgB0AGkAbgB0AAFIawEA+wEcAAAA+gAIAAAAYQA6AHMAYQB0AE0AbwBkAAHwSQIA+wEaAAAA+gAHAAAAYQA6AHMAaABhAGQAZQAB0H4BAPsBHAAAAPoACAAAAGEAOgBsAHUAbQBNAG8AZAABcI4BAPsAnAAAAPoAUMMAAPsAkAAAAAOLAAAA+gAO+wCCAAAABAAAAAEYAAAA+gAGAAAAYQA6AHQAaQBuAHQAAdB+AQD7ARwAAAD6AAgAAABhADoAcwBhAHQATQBvAGQAAdD7AQD7ARoAAAD6AAcAAABhADoAcwBoAGEAZABlAAGQXwEA+wEcAAAA+gAIAAAAYQA6AGwAdQBtAE0AbwBkAAFYkgEA+wBeAAAA+gCghgEA+wBSAAAAA00AAAD6AA77AEQAAAACAAAAARoAAAD6AAcAAABhADoAcwBoAGEAZABlAAEY9gAA+wEcAAAA+gAIAAAAYQA6AHMAYQB0AE0AbwBkAAHA1AEA+wEJAAAA+gDAZVIAAQD7BAQAAAAAAAAAAAAAAA=="};case 12:this.api.asc_setLocalRestrictions(Asc.c_oAscLocalRestrictionType.None),this.api.onEndLoadFile({bSerFormat:!0,data:n.binary}),AscCommon.g_oDocumentUrls.init(n.media);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),!0})),void 0===Common)var Common={};if(define("common/main/lib/component/TreeView",["common/main/lib/component/DataView"],(function(){"use strict";Common.UI.TreeViewModel=Common.UI.DataViewModel.extend({defaults:function(){return{id:Common.UI.getId(),name:"",isNotHeader:!1,hasSubItems:!1,hasParent:!1,isEmptyItem:!1,isExpanded:!0,isVisible:!0,selected:!1,allowSelected:!0,disabled:!1,getTipFromName:!0,level:0,index:0}}}),Common.UI.TreeViewStore=Backbone.Collection.extend({model:Common.UI.TreeViewModel,expandSubItems:function(t){var e=this,i=function(t,o,n){for(var s=t+1;s<e.length;s++){var a=e.at(s),r=a.get("level");if(!(r>n))return s-1;o&&a.set("isVisible",!0),a.get("hasSubItems")&&(s=i(s,a.get("isExpanded"),r))}};t.set("isExpanded",!0),i(t.get("index"),!0,t.get("level"))},collapseSubItems:function(t){for(var e=t.get("level"),i=t.get("index")+1;i<this.length;i++){var o=this.at(i);if(!(o.get("level")>e))break;o.set("isVisible",!1)}return i-1},expandAll:function(){this.each((function(t){t.set("isExpanded",!0),t.set("isVisible",!0)}))},collapseAll:function(){for(var t=0;t<this.length;t++){var e=this.at(t);e.get("isNotHeader")||(e.set("isExpanded",!1),t=this.collapseSubItems(e))}},expandToLevel:function(t){for(var e=this,i=function(o,n){var s=e.at(o);s.set("isExpanded",!1);for(var a=o+1;a<e.length;a++){var r=e.at(a),l=r.get("level");if(!(l>n))return a-1;l<=t&&s.set("isExpanded",!0),r.set("isVisible",l<=t),r.get("hasSubItems")&&(a=i(a,l))}},o=0;o<this.length;o++){var n=this.at(o);(n.get("level")<=t||!n.get("hasParent"))&&(n.set("isVisible",!0),n.get("isNotHeader")||(o=i(o,n.get("level"))))}}}),Common.UI.TreeView=Common.UI.DataView.extend({options:{handleSelect:!0,showLast:!0,allowScrollbar:!0,scrollAlwaysVisible:!0,emptyItemText:"",keyMoveDirection:"both",role:"tree",roleItem:"treeitem"},template:_.template(['<div class="treeview inner" style="<%= style %>" role="<%= options.role %>"></div>'].join("")),initialize:function(t){t.store=t.store||new Common.UI.TreeViewStore,t.emptyItemText=t.emptyItemText||"",t.itemTemplate=t.itemTemplate||(Common.UI.isRTL()?_.template(['<div id="<%= id %>" class="tree-item <% if (!isVisible) { %>hidden<% } %>" style="display: block;padding-right: <%= level*16 + 24 %>px;">',"<% if (hasSubItems) { %>",'<div class="tree-caret img-commonctrl <% if (!isExpanded) { %>up<% } %>" style="margin-right: <%= level*16 %>px;"></div>',"<% } %>","<% if (isNotHeader) { %>",'<div class="name not-header"><%= Common.Utils.String.htmlEncode(name) %></div>',"<% } else if (isEmptyItem) { %>",'<div class="name empty">'+t.emptyItemText+"</div>","<% } else { %>",'<div class="name"><%= Common.Utils.String.htmlEncode(name) %></div>',"<% } %>","</div>"].join("")):_.template(['<div id="<%= id %>" class="tree-item <% if (!isVisible) { %>hidden<% } %>" style="display: block;padding-left: <%= level*16 + 24 %>px;">',"<% if (hasSubItems) { %>",'<div class="tree-caret img-commonctrl <% if (!isExpanded) { %>up<% } %>" style="margin-left: <%= level*16 %>px;"></div>',"<% } %>","<% if (isNotHeader) { %>",'<div class="name not-header"><%= Common.Utils.String.htmlEncode(name) %></div>',"<% } else if (isEmptyItem) { %>",'<div class="name empty">'+t.emptyItemText+"</div>","<% } else { %>",'<div class="name"><%= Common.Utils.String.htmlEncode(name) %></div>',"<% } %>","</div>"].join(""))),Common.UI.DataView.prototype.initialize.call(this,t)},onAddItem:function(t,e,i){var o=new Common.UI.DataViewItem({template:this.itemTemplate,model:t,role:this.options.roleItem,tabindex:this.itemTabindex});if(o){var n=(this.$el||$(this.el)).find(".inner").addBack().filter(".inner");if(n){if(this.dataViewItems.length<1&&n.find(".empty-text").remove(),i&&"number"==typeof i.at){var s=i.at,a=n.find("> div");s>0?$(a.get(s-1)).after(o.render().el):a.length>0?$(a[s]).before(o.render().el):n.append(o.render().el),this.dataViewItems=this.dataViewItems.slice(0,s).concat(o).concat(this.dataViewItems.slice(s))}else n.append(o.render().el),this.dataViewItems.push(o);this.updateTip(o),this.listenTo(o,"change",this.onChangeItem),this.listenTo(o,"remove",this.onRemoveItem),this.listenTo(o,"click",this.onClickItem),this.listenTo(o,"dblclick",this.onDblClickItem),this.listenTo(o,"select",this.onSelectItem),this.listenTo(o,"contextmenu",this.onContextMenuItem),t.get("hasSubItems")&&o.$el.attr("aria-expanded",t.get("isExpanded")),o.$el.attr("aria-level",t.get("level")+1),this.isSuspendEvents||this.trigger("item:add",this,o,t)}}},onChangeItem:function(t,e){e.get("hasSubItems")&&t.$el.attr("aria-expanded",e.get("isExpanded")),Common.UI.DataView.prototype.onChangeItem.call(this,t,e)},onClickItem:function(t,e,i){var o=$(i.target);if(o&&(o.hasClass("tree-caret")||o.hasClass("btn-tree-caret"))){var n=t.$el.data("bs.tooltip");n&&n.tip().remove();var s=!e.get("isExpanded");e.set("isExpanded",s),this.store[s?"expandSubItems":"collapseSubItems"](e),this.scroller.update({minScrollbarLength:this.minScrollbarLength,alwaysVisibleY:this.scrollAlwaysVisible}),this.trigger("item:expand",e,s,!s)}else Common.UI.DataView.prototype.onClickItem.call(this,t,e,i)},expandAll:function(){this.store.expandAll(),this.scroller.update({minScrollbarLength:this.minScrollbarLength,alwaysVisibleY:this.scrollAlwaysVisible})},collapseAll:function(){this.store.collapseAll(),this.scroller.update({minScrollbarLength:this.minScrollbarLength,alwaysVisibleY:this.scrollAlwaysVisible})},expandToLevel:function(t){this.store.expandToLevel(t),this.scroller.update({minScrollbarLength:this.minScrollbarLength,alwaysVisibleY:this.scrollAlwaysVisible})},expandRecord:function(t){if(t){var e=t.get("isExpanded");t.set("isExpanded",!0),this.store.expandSubItems(t),this.scroller.update({minScrollbarLength:this.minScrollbarLength,alwaysVisibleY:this.scrollAlwaysVisible}),this.trigger("item:expand",t,!0,e)}},collapseRecord:function(t){if(t){var e=t.get("isExpanded");t.set("isExpanded",!1),this.store.collapseSubItems(t),this.scroller.update({minScrollbarLength:this.minScrollbarLength,alwaysVisibleY:this.scrollAlwaysVisible}),this.trigger("item:expand",t,!1,e)}},onKeyDown:function(t,e){if(!this.disabled)if(void 0===e&&(e=t),_.indexOf(this.moveKeys,e.keyCode)>-1||e.keyCode==Common.UI.Keys.RETURN){e.preventDefault(),e.stopPropagation();var i=this.getSelectedRec();if(null===this.lastSelectedRec&&(this.lastSelectedRec=i),e.keyCode==Common.UI.Keys.RETURN)this.lastSelectedRec=null,this.selectedBeforeHideRec&&(i=this.selectedBeforeHideRec),this.trigger("item:click",this,this,i,t),this.trigger("item:select",this,this,i,t),this.trigger("entervalue",this,i,t),this.parentMenu&&this.parentMenu.hide();else{var o=_.indexOf(this.store.models,i);if(o<0)if(e.keyCode==Common.UI.Keys.LEFT){var n=$(t.target).closest(".dropdown-submenu.over");n.length>0?(n.removeClass("over"),n.find("> a").focus()):o=0}else o=0;else if("both"==this.options.keyMoveDirection){var s=i.get("hasSubItems"),a=(i.get("hasParent"),i.get("isExpanded"));if(e.keyCode==Common.UI.Keys.LEFT)s&&a&&this.collapseRecord(i);else if(e.keyCode==Common.UI.Keys.RIGHT)s&&!a&&this.expandRecord(i);else if(e.keyCode==Common.UI.Keys.DOWN){for(var r=o+1;r<this.store.length;r++)if(this.store.at(r).get("isVisible")){o=r;break}}else if(e.keyCode==Common.UI.Keys.UP)for(r=o-1;r>=0;r--)if(this.store.at(r).get("isVisible")){o=r;break}}else o=e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.LEFT?Math.max(0,o-1):Math.min(this.store.length-1,o+1);void 0!==o&&o>=0&&(i=this.store.at(o)),i&&(this._fromKeyDown=!0,this.selectRecord(i),this._fromKeyDown=!1,this.scrollToRecord(i),$("#"+i.get("id")).parent().focus())}}else this.trigger("item:keydown",this,i,t)},focus:function(){this.cmpEl&&this.cmpEl.find(".treeview").focus()},updateTip:function(t){var e=t.model,i=e.get("name"),o=this;e.get("getTipFromName")&&e.set("tip",i.length>37-2*e.get("level")?i:"");var n=t.$el||$(t.el),s=n.data("bs.tooltip");s?s.updateTitle(e.get("tip")):e.get("tip")&&"tooltip"!==n.attr("data-toggle")&&(n.attr("data-toggle","tooltip"),this.delayRenderTips?n.one("mouseenter",(function(){n.tooltip({title:e.get("tip"),placement:"cursor",zIndex:o.tipZIndex}),n.mouseenter()})):n.tooltip({title:e.get("tip"),placement:"cursor",zIndex:o.tipZIndex}))}})})),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/HistoryVersion",["underscore","backbone","common/main/lib/component/TreeView"],(function(t,e){"use strict";Common.Models.HistoryVersion=Common.UI.TreeViewModel.extend({defaults:function(){return t.extend({version:0,revision:0,changeid:void 0,userid:void 0,username:"Guest",usercolor:"#ff0000",created:void 0,id:Common.UI.getId(),url:"",urlDiff:"",urlGetTime:"",docId:"",docIdPrev:"",token:"",arrColors:[],markedAsVersion:!1,canRestore:!1,serverVersion:0,fileType:"docx",documentSha256:void 0},Common.UI.TreeViewModel.prototype.defaults()||{})}})})),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/HistoryVersions",["underscore","backbone","common/main/lib/model/HistoryVersion","common/main/lib/component/TreeView"],(function(t,e){"use strict";Common.Collections.HistoryVersions=Common.UI.TreeViewStore.extend(t.extend({model:Common.Models.HistoryVersion,findRevision:function(t){return this.findWhere({revision:t})},findRevisions:function(t){return this.where({revision:t})},hasChanges:function(){return!!this.findWhere({hasParent:!0})},hasCollapsed:function(){return!!this.findWhere({hasSubItems:!0,isExpanded:!1})}},Common.UI.TreeViewStore||{}))})),define("common/main/lib/controller/History",["core","common/main/lib/collection/HistoryVersions","common/main/lib/view/History"],(function(){"use strict";Common.Controllers.History=Backbone.Controller.extend(_.extend({models:[],collections:["Common.Collections.HistoryVersions"],views:["Common.Views.History"],initialize:function(){this.currentChangeId=-1,this.currentArrColors=[],this.currentDocId="",this.currentDocIdPrev="",this.currentRev=0,this.currentServerVersion=0,this.currentUserId="",this.currentUserName="",this.currentUserColor="",this.currentDateCreated="",this.currentDocumentSha256=void 0},events:{},onLaunch:function(){this.panelHistory=this.createView("Common.Views.History",{storeHistory:this.getApplication().getCollection("Common.Collections.HistoryVersions")}),this.panelHistory.storeHistory.on("reset",_.bind(this.onResetStore,this)),this.panelHistory.on("render:after",_.bind(this.onAfterRender,this)),Common.Gateway.on("sethistorydata",_.bind(this.onSetHistoryData,this)),Common.NotificationCenter.on("mentions:setusers",_.bind(this.avatarsUpdate,this))},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onDownloadUrl",_.bind(this.onDownloadUrl,this)),this.api.asc_registerCallback("asc_onExpiredToken",_.bind(this.onExpiredToken,this)),this},setMode:function(t){this.mode=t,t.canHistoryClose||(this.panelHistory.$el.find("#history-header").hide(),this.panelHistory.$el.find("#history-list").css("padding-top",0))},onAfterRender:function(t){t.viewHistoryList.on("item:click",_.bind(this.onSelectRevision,this)),t.btnBackToDocument.on("click",_.bind(this.onClickBackToDocument,this)),t.btnExpand.on("click",_.bind(this.onClickExpand,this)),t.buttonMenu.menu.on("show:before",_.bind(this.onShowBeforeButtonMenu,this)),t.buttonMenu.menu.on("item:toggle",_.bind(this.onItemToggleButtonMenu,this))},onResetStore:function(){var t=this.panelHistory.storeHistory.hasChanges();this.panelHistory.btnExpand.setDisabled(!t),this.panelHistory.chHighlightDeleted||this.panelHistory.buttonMenu.setVisible(t)},onDownloadUrl:function(t,e){void 0!==this.isFromSelectRevision&&Common.Gateway.requestRestore(this.isFromSelectRevision,t,e),this.isFromSelectRevision=void 0},onSelectRevision:function(t,e,i,o){if(o){var n=$(o.target);if(n&&n.hasClass("revision-restore")){if(i.get("hasParent")){this.isFromSelectRevision=i.get("revision");var s=Asc.c_oAscFileType[(i.get("fileType")||"").toUpperCase()]||Asc.c_oAscFileType.DOCX;this.api.asc_DownloadAs(new Asc.asc_CDownloadOptions(s,!0))}else Common.Gateway.requestRestore(i.get("revision"),void 0,i.get("fileType"));return}}!t&&i&&this.panelHistory.viewHistoryList.scrollToRecord(i);var a=i.get("url"),r=i.get("revision"),l=new Date;if(this.currentChangeId=i.get("changeid"),this.currentArrColors=i.get("arrColors"),this.currentDocId=i.get("docId"),this.currentDocIdPrev=i.get("docIdPrev"),this.currentRev=r,this.currentServerVersion=i.get("serverVersion"),this.currentUserId=i.get("userid"),this.currentUserName=i.get("username"),this.currentUserColor=i.get("usercolor"),this.currentDateCreated=i.get("created"),this.currentDocumentSha256=i.get("documentSha256"),_.isEmpty(a)||l-i.get("urlGetTime")>3e5){var c=this;c.timerId||(c.timerId=setTimeout((function(){c.timerId=0}),3e4),_.delay((function(){Common.Gateway.requestHistoryData(r)}),10))}else{var h=this.getApplication().getController("Common.Controllers.Comments");h&&(h.onApiHideComment(),h.clearCollections());var d=i.get("urlDiff"),m=i.get("token"),p=new Asc.asc_CVersionHistory;p.asc_setDocId(_.isEmpty(d)?this.currentDocId:this.currentDocIdPrev),p.asc_setUrl(a),p.asc_setUrlChanges(d),p.asc_setCurrentChangeId(this.currentChangeId),p.asc_setArrColors(this.currentArrColors),p.asc_setToken(m),p.asc_setIsRequested(!1),p.asc_setServerVersion(this.currentServerVersion),p.asc_SetUserId(this.currentUserId),p.asc_SetUserName(this.currentUserName),p.asc_SetUserColor(this.currentUserColor),p.asc_SetDateOfRevision(this.currentDateCreated),p.asc_setDocumentSha256(this.currentDocumentSha256),this.api.asc_showRevision(p);var u=this.getApplication().getController("Common.Controllers.ReviewChanges");u&&u.onApiShowChange()}},onSetHistoryData:function(t){if(this.mode.canUseHistory)if(this.timerId&&(clearTimeout(this.timerId),this.timerId=0),!t.data||t.data.error){var e={title:this.notcriticalErrorTitle,msg:t.data&&t.data.error?t.data.error:this.txtErrorLoadHistory,iconCls:"warn",buttons:["ok"]};Common.UI.alert(e)}else{var i=this.getApplication().getController("Common.Controllers.Comments");i&&(i.onApiHideComment(),i.clearCollections());var o=t.data,n=this.getApplication().getCollection("Common.Collections.HistoryVersions");if(n&&null!==o){var s,a=n.findRevisions(o.version),r=new Date,l=t.data.previous&&void 0!==this.currentChangeId?t.data.changesUrl:null,c=!_.isEmpty(l)&&t.data.previous?t.data.previous.url:t.data.url,h=!_.isEmpty(l)&&t.data.previous?t.data.previous.fileType:t.data.fileType,d=t.data.key?t.data.key:this.currentDocId,m=t.data.previous&&t.data.previous.key?t.data.previous.key:this.currentDocIdPrev,p=t.data.token;if(a&&a.length>0)for(var u=0;u<a.length;u++)(s=a[u]).set("url",c,{silent:!0}),s.set("urlDiff",l,{silent:!0}),s.set("urlGetTime",r,{silent:!0}),t.data.key&&(s.set("docId",d,{silent:!0}),s.set("docIdPrev",m,{silent:!0})),s.set("token",p,{silent:!0}),h&&s.set("fileType",h,{silent:!0});var g=new Asc.asc_CVersionHistory;g.asc_setUrl(c),g.asc_setUrlChanges(l),g.asc_setDocId(_.isEmpty(l)?d:m),g.asc_setCurrentChangeId(this.currentChangeId),g.asc_setArrColors(this.currentArrColors),g.asc_setToken(p),g.asc_setIsRequested(!0),g.asc_setServerVersion(this.currentServerVersion),g.asc_SetUserId(this.currentUserId),g.asc_SetUserName(this.currentUserName),g.asc_SetUserColor(this.currentUserColor),g.asc_SetDateOfRevision(this.currentDateCreated),g.asc_setDocumentSha256(this.currentDocumentSha256),this.api.asc_showRevision(g),this.currentRev=o.version;var f=this.getApplication().getController("Common.Controllers.ReviewChanges");f&&f.onApiShowChange()}}},onExpiredToken:function(){var t=this;_.delay((function(){Common.Gateway.requestHistoryData(t.currentRev)}),10)},onClickBackToDocument:function(){Common.Gateway.requestHistoryClose()},onClickExpand:function(){var t=this.panelHistory.storeHistory.hasCollapsed();t?this.panelHistory.viewHistoryList.expandAll():this.panelHistory.viewHistoryList.collapseAll(),this.panelHistory.btnExpand.setCaption(t?this.panelHistory.textHideAll:this.panelHistory.textShowAll)},onShowBeforeButtonMenu:function(){this.api&&this.panelHistory.chHighlightDeleted&&this.panelHistory.chHighlightDeleted.setChecked(this.api.asc_isShowedDeletedTextInVersionHistory(),!0)},onItemToggleButtonMenu:function(t,e,i){this.api&&"highlight"==e.value&&(i?this.api.asc_showDeletedTextInVersionHistory():this.api.asc_hideDeletedTextInVersionHistory())},avatarsUpdate:function(t,e){"info"===t&&e&&e.length>0&&this.panelHistory.storeHistory.each((function(t){var i=_.findWhere(e,{id:t.get("userid")});i&&void 0!==i.image&&i.image!==t.get("avatar")&&t.set("avatar",i.image)}))},onHashError:function(){if(this.panelHistory&&this.panelHistory.storeHistory){var t=this.panelHistory.storeHistory;t.remove(t.where({revision:this.currentRev,level:1}));var e=t.findWhere({revision:this.currentRev});e&&this.panelHistory.viewHistoryList&&(e.set("hasSubItems",!1),e.set("changeid",void 0),e.set("documentSha256",void 0),e.set("url",""),this.panelHistory.viewHistoryList.selectRecord(e),this.onSelectRevision(null,null,e)),console.log("Received changes that are incompatible with the file version")}}},Common.Controllers.History||{}))})),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/Comment",["underscore","backbone","common/main/lib/component/BaseView"],(function(t,e){"use strict";Common.Models.Comment=e.Model.extend({defaults:{uid:0,guid:"",userid:0,username:"Guest",parsedName:"Guest",parsedGroups:void 0,usercolor:null,date:void 0,quote:"",comment:"",resolved:!1,lock:!1,lockuserid:"",unattached:!1,userdata:"",position:-1,id:Common.UI.getId(),time:0,showReply:!1,showReplyInPopover:!1,editText:!1,editTextInPopover:!1,last:void 0,replys:[],hideAddReply:!1,scope:null,hide:!1,filtered:!1,hint:!1,fullInfoInHint:!1,dummy:void 0,editable:!0,removable:!0}}),Common.Models.Reply=e.Model.extend({defaults:{time:0,userid:0,username:"Guest",parsedName:"Guest",usercolor:null,reply:"",date:void 0,userdata:"",id:Common.UI.getId(),editText:!1,editTextInPopover:!1,scope:null,editable:!0,removable:!0,hide:!1}})})),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/Comments",["underscore","backbone","common/main/lib/model/Comment"],(function(t,e){"use strict";Common.Collections.Comments=e.Collection.extend({model:Common.Models.Comment,groups:null,clearEditing:function(){this.each((function(t){t.set("editText",!1),t.set("editTextInPopover",!1),t.set("showReply",!1),t.set("showReplyInPopover",!1),t.set("hideAddReply",!1)}))},getCommentsReplysCount:function(t){var e=0;return this.each((function(i){i.get("userid")==t&&e++;var o=i.get("replys");o&&o.length>0&&o.forEach((function(i){i.get("userid")==t&&e++}))})),e}})})),define("text!common/main/lib/template/CommentsPopover.template",[],(function(){return'<% if (!hide) { %>\r\n<div id="<%=id%>" class="user-comment-item">\r\n\r\n    \x3c!-- comment block --\x3e\r\n\r\n    <div class="user-info">\r\n        <div class="color" \r\n            <% if (avatar) { %>\r\n                style="background-image: url(<%=avatar%>); <% if (usercolor!==null) { %> border-color:<%=usercolor%>; border-style:solid;<% }%>" \r\n            <% } else { %>\r\n                style="background-color: <% if (usercolor!==null) { %> <%=usercolor%> <% } else { %> #cfcfcf <% }%>;" \r\n            <% } %>\r\n        ><% if (!avatar) { %><%-initials%><% } %></div>\r\n        <div class="user-info-text">\r\n            <div class="user-name"><%= scope.getEncodedName(parsedName) %></div>\r\n            <div class="user-date"><%=date%></div>\r\n        </div>\r\n    </div>\r\n    <% if (!editTextInPopover || (hint && !fullInfoInHint) || scope.viewmode) { %>\r\n        <div oo_editor_input="true" tabindex="-1" class="user-message user-select"><%=scope.pickLink(comment)%></div>\r\n    <% } else { %>\r\n        <div class="inner-edit-ct">\r\n            <textarea class="msg-reply user-select" maxlength="maxCommLength" spellcheck="false" <% if (!!dummy) { %> placeholder="textMentionComment"<% } %> aria-label="textComment"><%=comment%></textarea>\r\n            <% if (hideAddReply) { %>\r\n                <button class="btn normal dlg-btn primary btn-inner-edit" id="id-comments-change-popover">textAdd</button>\r\n            <% } else { %>\r\n                <button class="btn normal dlg-btn primary btn-inner-edit" id="id-comments-change-popover">textEdit</button>\r\n            <% } %>\r\n            <button class="btn normal dlg-btn btn-inner-close">textCancel</button>\r\n        </div>\r\n    <% } %>\r\n\r\n    \x3c!-- replys elements --\x3e\r\n\r\n    <% var add_arrow = true; %>\r\n    <% if (replys.length) { %>\r\n        <% _.each(replys, function (item) { %>\r\n            <% if (!item.get("hide")) { %>\r\n            <% if (add_arrow) { add_arrow = false; %>\r\n                <div class="reply-arrow img-commonctrl"></div>\r\n            <% } %>\r\n            <div class="reply-item-ct">\r\n                <div class="user-info">\r\n                    <div class="color"\r\n                            <% if (item.get("avatar")) { %>\r\n                                style="background-image: url(<%=item.get(\'avatar\')%>); <% if (item.get(\'usercolor\')!==null) { %> border-color:<%=item.get(\'usercolor\')%>; border-style:solid;<% }%>" \r\n                            <% } else { %>\r\n                                style="background-color: <% if (item.get(\'usercolor\')!==null) { %> <%=item.get(\'usercolor\')%> <% } else { %> #cfcfcf <% }%>;" \r\n                            <% } %>\r\n                    ><% if (!item.get("avatar")) { %><%-item.get("initials")%><% } %></div>\r\n                    <div class="user-info-text">\r\n                        <div class="user-name"><%= scope.getEncodedName(item.get("parsedName")) %></div>\r\n                        <div class="user-date"><%=item.get("date")%></div>\r\n                    </div>\r\n                </div>\r\n                <% if (!item.get("editTextInPopover")) { %>\r\n                    <div oo_editor_input="true" tabindex="-1" class="user-message user-select"><%=scope.pickLink(item.get("reply"))%></div>\r\n                    <% if ((fullInfoInHint || !hint) && !scope.viewmode) { %>\r\n                        <div class="btns-reply-ct">\r\n                            <% if (item.get("editable")) { %>\r\n                                <div class="btn-edit-common img-commonctrl" data-value="<%=item.get("id")%>"></div>\r\n                            <%}%>\r\n                            <% if (item.get("removable")) { %>\r\n                               <div class="btn-delete img-commonctrl" data-value="<%=item.get("id")%>"></div>\r\n                            <%}%>\r\n                        </div>\r\n                    <%}%>\r\n                <% } else { %>\r\n                    <div class="inner-edit-ct">\r\n                        <textarea class="msg-reply textarea-fix user-select" maxlength="maxCommLength" spellcheck="false" aria-label="textReply"><%=item.get("reply")%></textarea>\r\n                        <button class="btn normal dlg-btn primary btn-inner-edit btn-fix" id="id-comments-change-popover">textEdit</button>\r\n                        <button class="btn normal dlg-btn btn-inner-close">textClose</button>\r\n                    </div>\r\n                <% } %>\r\n            </div>\r\n            <% } %>\r\n        <% }); %>\r\n    <% } %>\r\n\r\n    \x3c!-- add reply button --\x3e\r\n\r\n    <% if (!showReplyInPopover && !hideAddReply && (fullInfoInHint || !hint) && !scope.viewmode) { %>\r\n        <% if (replys.length && !add_arrow) { %>\r\n            <label class="user-reply with-reply" role="presentation" tabindex="-1">textAddReply</label>\r\n        <% } else { %>\r\n            <label class="user-reply" role="presentation" tabindex="-1">textAddReply</label>\r\n        <% } %>\r\n    <% } %>\r\n\r\n    \x3c!-- edit buttons --\x3e\r\n\r\n    <% if (!editTextInPopover && !lock) { %>\r\n        <div class="edit-ct">\r\n            <% if ((fullInfoInHint || !hint) && !scope.viewmode) { %>\r\n                <% if (editable) { %>\r\n                    <div class="btn-edit-common img-commonctrl"></div>\r\n                <% } %>\r\n                <% if (removable) { %>\r\n                    <div class="btn-delete img-commonctrl"></div>\r\n                <% } %>\r\n            <% } %>\r\n            <% if (editable && (fullInfoInHint || !hint) && !scope.viewmode) { %>\r\n                <div class="btn-resolve <% if (resolved) print(\'img-commonctrl comment-resolved\') %>" data-toggle="tooltip"></div>\r\n            <% } else if ((fullInfoInHint || !hint) && (!editable || scope.viewmode) && resolved) { %>\r\n                <div class="icon-resolve i-comment-resolved img-commonctrl" data-toggle="tooltip"></div>\r\n            <% } %>\r\n        </div>\r\n    <% } %>\r\n\r\n    \x3c!-- reply --\x3e\r\n\r\n    <% if (showReplyInPopover) { %>\r\n        <div class="reply-ct">\r\n            <textarea class="msg-reply user-select" placeholder="textMentionReply" maxlength="maxCommLength" spellcheck="false" aria-label="textReply"></textarea>\r\n            <button class="btn normal dlg-btn primary btn-reply" id="id-comments-change-popover">textReply</button>\r\n            <button class="btn normal dlg-btn btn-close">textClose</button>\r\n        </div>\r\n    <% } %>\r\n\r\n    \x3c!-- locked user --\x3e\r\n\r\n    <% if (lock) { %>\r\n        <div class="lock-area" style="cursor: default;"></div>\r\n        <div class="lock-author" style="cursor: default;"><%=lockuserid%></div>\r\n    <% } %>\r\n\r\n</div>\r\n<% } %>'})),define("text!common/main/lib/template/ReviewChangesPopover.template",[],(function(){return'<div id="<%=id%>" class="user-comment-item">\r\n\r\n    <div class="user-info">\r\n        <div class="color"\r\n            <% if (avatar) { %>\r\n                style="background-image: url(<%=avatar%>); <% if (usercolor!==null) { %> border-color:<%=usercolor%>; border-style:solid;<% }%>" \r\n            <% } else { %>\r\n                style="background-color: <% if (usercolor!==null) { %> <%=usercolor%> <% } else { %> #cfcfcf <% }%>;" \r\n            <% } %>\r\n        ><% if (!avatar) { %><%-initials%><% } %></div>\r\n        <div class="user-info-text">\r\n            <div class="user-name"><%= scope.getUserName(username) %></div>\r\n            <div class="user-date"><%=date%></div>\r\n        </div>\r\n    </div>\r\n    <div class="user-message limit-height"><%=changetext%></div>\r\n    <div class="edit-ct">\r\n        <% if (goto) { %>\r\n        <div class="btn-goto img-commonctrl"></div>\r\n        <% } %>\r\n        <% if (!hint) { %>\r\n            <% if (scope.appConfig.isReviewOnly || docProtection.isReviewOnly) { %>\r\n                <% if (editable) { %>\r\n                <div class="btn-delete img-commonctrl"></div>\r\n                <% } %>\r\n            <% } else if (editable) { %>\r\n            <div class="btn-accept"></div>\r\n            <div class="btn-reject tool "></div>\r\n            <% } %>\r\n        <% } %>\r\n    </div>\r\n    <% if (!hint && lock) { %>\r\n    <div class="lock-area" style="cursor: default;"></div>\r\n    <div class="lock-author" style="cursor: default;"><%-lockuser%></div>\r\n    <% } %>\r\n</div>'})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/ReviewPopover",["text!common/main/lib/template/CommentsPopover.template","text!common/main/lib/template/ReviewChangesPopover.template","common/main/lib/util/utils","common/main/lib/component/Button","common/main/lib/component/ComboBox","common/main/lib/component/DataView","common/main/lib/component/Layout","common/main/lib/component/Window"],(function(t,e){"use strict";function i(t,e){var i,o,n=t;for(i in e)void 0!==i&&(o=e[i],n=n.replace(new RegExp(i,"g"),o));return n}Common.Views.ReviewPopover=Common.UI.Window.extend(_.extend({initialize:function(t){var e={};return _.extend(e,{closable:!1,width:265,height:120,header:!1,modal:!1,automove:!1,alias:"Common.Views.ReviewPopover"},t),this.template=t.template||['<div class="box">','<div id="id-popover" class="comments-popover" style="overflow-y: hidden;position: relative;">','<div id="id-review-popover"></div>','<div id="id-comments-popover"></div>',"</div>",'<div id="id-comments-arrow" class="comments-arrow"></div>',"</div>"].join(""),this.commentsStore=t.commentsStore,this.reviewStore=t.reviewStore,this.canRequestUsers=t.canRequestUsers,this.canRequestSendNotify=t.canRequestSendNotify,this.mentionShare=t.mentionShare,this.api=t.api,this._state={commentsVisible:!1,reviewVisible:!1,arrowCls:"left"},this.isDocEditor=!!window.DE,e.tpl=_.template(this.template)(e),this.arrow={margin:20,width:10,height:30},this.sdkBounds={width:0,height:0,outerWidth:0,outerHeight:0,padding:10,paddingTop:20},Common.UI.Window.prototype.initialize.call(this,e),this.canRequestUsers&&Common.NotificationCenter.on("mentions:setusers",_.bind(this.onEmailListMenuCallback,this)),this},render:function(o,n){Common.UI.Window.prototype.render.call(this);var s=this,a=this.$window;a.css({height:"",minHeight:"",overflow:"hidden",position:"absolute",zIndex:"990"});var r=a.find(".body");r&&r.css("position","relative");var l,c=Common.UI.DataView.extend((l=s,{options:{handleSelect:!1,allowScrollbar:!1,template:_.template('<div class="dataview-ct inner" style="overflow-y: visible;"></div>')},getTextBox:function(){var t=$(this.el).find("textarea");return t&&t.length?t:void 0},setFocusToTextBox:function(t){var e=$(this.el).find("textarea");if(t)e.blur();else if(e&&e.length){var i=e.val();e.focus(),e.val(""),e.val(i)}},getActiveTextBoxVal:function(){var t=$(this.el).find("textarea");return t&&t.length?t.val().trim():""},disableTextBoxButton:function(t){var e=$(t.siblings("#id-comments-change-popover")[0]);t.val().trim().length>0?(e.removeAttr("disabled"),e.removeClass("disabled")):(e.attr("disabled",!0),e.addClass("disabled"))},autoHeightTextBox:function(){var t=this,e=this.$el.find("textarea"),i=null,o=55,n=0,a=0,r=0;function c(){a=l.scroller.getScrollTop(),i.scrollHeight>i.clientHeight?i.clientHeight+2<parseInt($(i).css("max-height"))&&(e.css({height:i.scrollHeight+n+"px"}),l.calculateSizeOfContent()):i.clientHeight>=o&&(e.css({height:o+"px"}),i.scrollHeight>i.clientHeight&&(r=Math.max(i.scrollHeight+n,o),e.css({height:r+"px"})),l.calculateSizeOfContent(),l.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),l.calculateSizeOfContent()),l.scroller.scrollTop(a),l.autoScrollToEditButtons()}e&&e.length&&l.scroller&&(i=e.get(0),t.disableTextBoxButton(e),i&&(n=.25*parseInt(e.css("lineHeight"),10),c(),e.bind("input propertychange",(function(e){c(),t.disableTextBoxButton($(e.target))})))),this.textBox=e},clearTextBoxBind:function(){this.textBox&&(this.textBox.unbind("input propertychange"),this.textBox=void 0)}}));if(c)if(this.commentsView)this.commentsView.render($("#id-comments-popover")),this.commentsView.onResetItems();else{this.commentsView=new c({el:$("#id-comments-popover"),itemTemplate:_.template(i(t,{textAddReply:s.textAddReply,textMentionReply:s.canRequestSendNotify?s.mentionShare?s.textMention:s.textMentionNotify:s.textAddReply,textAdd:s.textAdd,textCancel:s.textCancel,textEdit:s.textEdit,textReply:s.textReply,textClose:s.textClose,textComment:s.textComment,maxCommLength:Asc.c_oAscMaxCellOrCommentLength,textMentionComment:s.canRequestSendNotify?s.mentionShare?s.textMention:s.textMentionNotify:s.textEnterComment}))});var h=function(t,e,i){e.tipsArray&&e.tipsArray.forEach((function(t){t.remove()}));var o=[],n=$(e.el).find(".btn-resolve:not(.comment-resolved)");n.tooltip({title:s.textResolve,placement:"cursor"}),n.each((function(t,e){o.push($(e).data("bs.tooltip").tip())})),(n=$(e.el).find(".comment-resolved")).tooltip({title:s.textOpenAgain,placement:"cursor"}),n.each((function(t,e){o.push($(e).data("bs.tooltip").tip())})),(n=$(e.el).find(".i-comment-resolved")).tooltip({title:s.textViewResolved,placement:"cursor"}),n.each((function(t,e){o.push($(e).data("bs.tooltip").tip())})),(n=$(e.el).find(".btn-edit-common")).tooltip({title:s.txtEditTip,placement:"cursor"}),n.each((function(t,e){o.push($(e).data("bs.tooltip").tip())})),(n=$(e.el).find(".btn-delete")).tooltip({title:s.txtDeleteTip,placement:"cursor"}),n.each((function(t,e){o.push($(e).data("bs.tooltip").tip())})),e.tipsArray=o,this.autoHeightTextBox()};this.commentsView.on("item:add",h),this.commentsView.on("item:remove",h),this.commentsView.on("item:change",h),this.commentsView.cmpEl.on("mouseover",(function(){s._isMouseOver=!0})).on("mouseout",(function(){s._isMouseOver=!1})),this.commentsView.setStore(s.commentsStore),this.commentsView.onResetItems(),this.commentsView.on("item:click",(function(t,e,i,o){var n,a,r,l,c,h;function d(){s.update()}if(n=$(o.target)){if(a=i.get("editTextInPopover"),r=i.get("showReplyInPopover"),h=i.get("hideAddReply"),l=i.get("uid"),c=n.attr("data-value"),i.get("hint")&&(s.fireEvent("comment:disableHint",[i]),!i.get("fullInfoInHint")))return;if(n.hasClass("btn-edit-common"))(u=n.data("bs.tooltip"))&&(u.dontShow=!0),_.isUndefined(c)?a||(s.fireEvent("comment:closeEditing"),i.set("editTextInPopover",!0),s.fireEvent("comment:show",[l]),this.autoHeightTextBox(),s.calculateSizeOfContent(),s.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),s.calculateSizeOfContent(),d(),s.hookTextBox(),s.autoScrollToEditButtons(),this.setFocusToTextBox()):(s.fireEvent("comment:closeEditing",[l]),s.fireEvent("comment:editReply",[l,c,!0]),this.replyId=c,this.autoHeightTextBox(),s.calculateSizeOfContent(),s.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),s.calculateSizeOfContent(),d(),s.hookTextBox(),s.autoScrollToEditButtons(),this.setFocusToTextBox());else if(n.hasClass("btn-delete")){(u=n.data("bs.tooltip"))&&(u.dontShow=!0),_.isUndefined(c)?s.fireEvent("comment:remove",[l]):(s.fireEvent("comment:removeReply",[l,c]),s.calculateSizeOfContent(),s.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),s.calculateSizeOfContent()),s.fireEvent("comment:closeEditing"),d()}else if(n.hasClass("user-reply"))s.fireEvent("comment:closeEditing"),i.set("showReplyInPopover",!0),s.calculateSizeOfContent(),s.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),s.calculateSizeOfContent(),d(),this.autoHeightTextBox(),s.hookTextBox(),s.autoScrollToEditButtons(),this.setFocusToTextBox();else if(n.hasClass("btn-reply",!1))r&&(this.clearTextBoxBind(),s.fireEvent("comment:addReply",[l,this.getActiveTextBoxVal()]),s.fireEvent("comment:closeEditing"),s.calculateSizeOfContent(),d());else if(n.hasClass("btn-close",!1))s.fireEvent("comment:closeEditing",[l]),s.calculateSizeOfContent(),s.fireEvent("comment:show",[l]),d();else if(n.hasClass("btn-inner-edit",!1)){if(i.get("dummy")){var m=this.getActiveTextBoxVal();if(s.clearDummyText(),m.length>0)s.fireEvent("comment:addDummyComment",[m]);else{var p=s.$window.find("textarea:not(.user-message)");p&&p.length&&setTimeout((function(){p.focus()}),10)}return}this.clearTextBoxBind(),_.isUndefined(this.replyId)?a&&(s.fireEvent("comment:change",[l,this.getActiveTextBoxVal()]),s.fireEvent("comment:closeEditing"),s.calculateSizeOfContent()):(s.fireEvent("comment:changeReply",[l,this.replyId,this.getActiveTextBoxVal()]),this.replyId=void 0,s.fireEvent("comment:closeEditing")),d()}else if(n.hasClass("btn-inner-close",!1)){if(i.get("dummy"))return s.clearDummyText(),void s.hide();h&&this.getActiveTextBoxVal().length>0?(s.saveText(),i.set("hideAddReply",!1),this.getTextBox().val(s.textVal),this.autoHeightTextBox()):(this.clearTextBoxBind(),s.fireEvent("comment:closeEditing",[l])),this.replyId=void 0,s.calculateSizeOfContent(),s.setLeftTop(s.arrowPosX,s.arrowPosY,s.leftX),s.calculateSizeOfContent(),d()}else if(n.hasClass("btn-resolve")){var u;(u=n.data("bs.tooltip"))&&(u.dontShow=!0),s.fireEvent("comment:resolve",[l]),d()}}})),this.emailMenu=new Common.UI.Menu({maxHeight:200,cyclic:!1,cls:"font-size-medium",items:[]}).on("render:after",(function(t){this.scroller=new Common.UI.Scroller({el:$(this.el).find(".dropdown-menu "),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:40,alwaysVisibleY:!0})})).on("show:after",(function(){this.scroller.update({alwaysVisibleY:!0}),s.$window.css({zIndex:"1001"})})).on("hide:after",(function(){s.$window.css({zIndex:"990"})})),s.on({show:function(){s.commentsView.autoHeightTextBox(),s.$window.find("textarea").keydown((function(t){t.keyCode==Common.UI.Keys.ESC&&s.hide(!0)}))},"animate:before":function(){var t=s.$window.find("textarea");t&&t.length&&(t.focus(),s.commentsView.disableTextBoxButton(t))}})}var d=Common.UI.DataView.extend({options:{handleSelect:!1,scrollable:!0,template:_.template('<div class="dataview-ct inner" style="overflow-y: visible;"></div>')}});if(d)if(this.reviewChangesView)this.reviewChangesView.render($("#id-review-popover")),this.reviewChangesView.onResetItems();else{this.reviewChangesView=new d({el:$("#id-review-popover"),itemTemplate:_.template(e)});h=function(t,e,i){e.tipsArray&&e.tipsArray.forEach((function(t){t.remove()}));var o=[],n=$(e.el).find(".btn-goto");n.tooltip({title:s.textFollowMove,placement:"cursor"}),n.each((function(t,e){o.push($(e).data("bs.tooltip").tip())})),(n=$(e.el).find(".btn-accept")).tooltip({title:s.txtAccept,placement:"cursor"}),n.each((function(t,e){o.push($(e).data("bs.tooltip").tip())})),(n=$(e.el).find(".btn-reject")).tooltip({title:s.txtReject,placement:"cursor"}),n.each((function(t,e){o.push($(e).data("bs.tooltip").tip())})),e.tipsArray=o};this.reviewChangesView.on("item:add",h),this.reviewChangesView.on("item:remove",h),this.reviewChangesView.on("item:change",h),this.reviewChangesView.on("item:click",(function(t,e,i,o){var n=$(o.target);if(n)if(n.hasClass("btn-accept"))(a=n.data("bs.tooltip"))&&(a.dontShow=!0),s.fireEvent("reviewchange:accept",[i.get("changedata")]);else if(n.hasClass("btn-reject")){(a=n.data("bs.tooltip"))&&(a.dontShow=!0),s.fireEvent("reviewchange:reject",[i.get("changedata")])}else if(n.hasClass("btn-delete"))s.fireEvent("reviewchange:delete",[i.get("changedata")]);else if(n.hasClass("btn-goto")){var a;(a=n.data("bs.tooltip"))&&(a.dontShow=!0),s.fireEvent("reviewchange:goto",[i.get("changedata")])}})),this.reviewChangesView.setStore(s.reviewStore),this.reviewChangesView.onResetItems()}_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:a.find("#id-popover"),minScrollbarLength:40,wheelSpeed:10,alwaysVisibleY:!0}))},showComments:function(t,e,i,o){this.options.animate=t;var n=this.commentsView.getTextBox();e&&this.textVal&&n&&n.val(this.textVal),o&&o.length&&n&&n.val(o),this.show(t),this.hookTextBox(),this._state.commentsVisible=!0},showReview:function(t,e,i){this.show(t),this._state.reviewVisible=!0},show:function(t,e,i,o){this.options.animate=t,Common.UI.Window.prototype.show.call(this),this.scroller&&this.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})},hideComments:function(){this.handlerHide&&this.handlerHide(),this.hideTips(),this._state.commentsVisible=!1,this._state.reviewVisible?this.calculateSizeOfContent():this.hide()},hideReview:function(){this.handlerHide&&this.handlerHide(),this.hideTips(),this._state.reviewVisible=!1,this._state.commentsVisible?this.calculateSizeOfContent():this.hide()},hide:function(){this.handlerHide&&this.handlerHide.apply(this,arguments),this.hideTips(),Common.UI.Window.prototype.hide.call(this),_.isUndefined(this.e)||this.e.keyCode!=Common.UI.Keys.ESC||(this.e.preventDefault(),this.e.stopImmediatePropagation(),this.e=void 0)},update:function(t){this.commentsView&&t&&this.commentsView.onResetItems(),this.scroller&&this.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})},isVisible:function(){return this.$window&&this.$window.is(":visible")},setLeftTop:function(t,e,i,o,n){if(this.$window||this.render(),o&&(t=this.arrowPosX,e=this.arrowPosY,i=this.leftX),!_.isUndefined(t)||!_.isUndefined(e)){this.arrowPosX=t,this.arrowPosY=e,this.leftX=i;var s=$("#id-popover"),a=$("#id-comments-arrow"),r=$("#editor_sdk"),l=null,c=0,h="",d=0,m="",p=0,u="",g=0,f="",b=0,C=0,v=0,w=0,A=0,y=0;if(s&&a&&r&&r.get(0)&&(l=Common.Utils.getBoundingClientRect(r.get(0)))){if(c=l.height-2*this.sdkBounds.padding,this.$window.css({maxHeight:c+"px"}),this.sdkBounds.width=this.sdkBounds.outerWidth=l.width,this.sdkBounds.height=this.sdkBounds.outerHeight=l.height,!_.isUndefined(t)){var S=!_.isUndefined(i),x=S?t<i:Common.UI.isRTL();if(S&&x){var k=t;t=i,i=k}((h=$("#id_vertical_scroll")).length||(h=$("#ws-v-scrollbar")).length)&&(d="none"!==h.css("display")?h.width():0),this.sdkBounds.width-=d,(m=$("#id_panel_left")).length&&(p="none"!==m.css("display")?m.width():0),(u=$("#id_panel_thumbnails")).length&&(g="none"!==u.css("display")?u.width():0,this.sdkBounds.width-=g),x?this.isDocEditor?(C=Math.max(0+p+25,0+this.sdkBounds.width-this.$window.outerWidth()-t+7),C=Math.min(0+this.sdkBounds.width-this.$window.outerWidth()-25,C)):(C=Math.max(0+p,0+t-this.$window.outerWidth()-this.arrow.width-25),C=Math.min(0+this.sdkBounds.width-this.$window.outerWidth()-25,C)):(C=Math.min(0+t+this.arrow.width,0+this.sdkBounds.width-this.$window.outerWidth()-25),C=Math.max(0+p+this.arrow.width,C)),this._state.arrowCls=S&&Common.UI.isRTL()?"right":"left",a.removeClass("right top bottom").addClass(this._state.arrowCls),a.css({left:""}),S&&(v=this.$window.outerWidth())&&(t+v>this.sdkBounds.width-this.arrow.width+5&&i>v||x&&0+i>v+this.arrow.width?(C=0+i-v-this.arrow.width,this._state.arrowCls=Common.UI.isRTL()?"left":"right",a.removeClass("left right").addClass(this._state.arrowCls)):C=0+t+this.arrow.width),this.$window.css("left",C+"px")}if(!_.isUndefined(e)){y=0,(f=$("#id_panel_top")).length?(b="none"!==f.css("display")?f.height():0,y+=this.sdkBounds.paddingTop):(f=$("#ws-h-scrollbar")).length&&(b="none"!==f.css("display")?f.height():0),this.sdkBounds.height-=b,w=this.$window.outerHeight(),A=Math.min(0+c-w,this.arrowPosY+0-this.arrow.height),A=Math.max(A,y);var T=0;Math.ceil(c)<=Math.ceil(w)?T=Math.min(T,c-(b+this.arrow.margin+this.arrow.height)):(T=Math.max(this.arrow.margin,this.arrowPosY-(c-w)-this.arrow.height),T=Math.min(T,w-this.arrow.margin-this.arrow.height)),a.css({top:T+"px"}),this.$window.css("top",A+"px")}}n&&!this.isOverCursor()||this.calculateSizeOfContent()}},calculateSizeOfContent:function(t){if(!t||this.$window.is(":visible")){this.$window.css({overflow:"hidden"});var e=$("#id-comments-arrow"),i=$("#id-popover"),o=null,n=null,s=null,a=0,r="",l=0,c=0,h=0,d=0,m=0,p=0,u=0;if(i&&e&&i.get(0)){var g=this.scroller.getScrollTop();if(i.css({height:"100%"}),(o=Common.Utils.getBoundingClientRect(i.get(0)))&&(n=$("#editor_sdk"))&&n.get(0)&&(s=Common.Utils.getBoundingClientRect(n.get(0)))){a=s.height-2*this.sdkBounds.padding,u=0,d=this.$window.outerHeight(),(r=$("#id_panel_top")).length?(l="none"!==r.css("display")?r.height():0,u+=this.sdkBounds.paddingTop):(r=$("#ws-h-scrollbar")).length&&(l="none"!==r.css("display")?r.height():0),m=Math.max(i.outerHeight(),this.$window.outerHeight());var f=this.isOverCursor();if(f){var b=parseInt(this.$window.css("left"))-this.arrow.width,C=f[1][1]+l+this.arrow.width,v=f[0][1]+l-this.arrow.width,_=!1;if(C+m>0+a){var w=0+a-C;if(v-m<0){var A=v-0;w<.9*A?(this.$window.css({maxHeight:A+"px",top:"0px"}),i.css({height:A-3+"px"})):(this.$window.css({maxHeight:w+"px",top:C+"px"}),_=!0,i.css({height:w-3+"px"}))}else this.$window.css("top",v-m+"px")}else _=!0,this.$window.css("top",C+"px");b-=this.arrow.height,this.$window.css("left",b+"px"),h=f[_?1:0][0],h=Math.max(0,h-b-this.arrow.height/2),h=Math.min(h,this.$window.outerWidth()-this.arrow.height),e.css({top:"",left:h+"px"}),e.toggleClass("top",_),e.toggleClass("bottom",!_),e.removeClass("left right")}else Math.ceil(a)<=Math.ceil(m)?(this.$window.css({maxHeight:a-l+"px",top:0+l+"px"}),i.css({height:a-l-3+"px"}),c=Math.min(c,a-(l+this.arrow.margin+this.arrow.height)),e.css({top:c+"px",left:""}),e.removeClass("top bottom right left"),e.addClass(this._state.arrowCls),this.scroller.scrollTop(g)):((m=d)>0&&(o.top+m>a+0||0===o.height)&&(p=Math.min(0+a-m,this.arrowPosY+0-this.arrow.height),p=Math.max(p,u),this.$window.css({top:p+"px"})),c=Math.max(this.arrow.margin,this.arrowPosY-(a-m)-this.arrow.height),c=Math.min(c,m-this.arrow.margin-this.arrow.height),e.css({top:c+"px",left:""}),e.removeClass("top bottom right left"),e.addClass(this._state.arrowCls))}}this.$window.css({overflow:""}),this.scroller&&this.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})}},isOverCursor:function(){if(this.api.asc_GetSelectionBounds){var t=this.api.asc_GetSelectionBounds(),e=Math.abs(t[0][0]-t[1][0])<.1&&Math.abs(t[0][1]-t[1][1])<.1&&Math.abs(t[2][0]-t[3][0])<.1&&Math.abs(t[2][1]-t[3][1])<.1,i=$("#id_panel_left"),o=0;i.length&&(o="none"!==i.css("display")?i.width():0);var n=t[0][0]+o,s=t[0][1],a=t[e?2:1][0]+o,r=t[e?2:1][1],l=parseInt(this.$window.css("left"))-this.arrow.width,c=this.$window.outerWidth()+this.arrow.width,h=parseInt(this.$window.css("top")),d=this.$window.outerHeight();if(n>l&&n<l+c&&s>h&&s<h+d||a>l&&a<l+c&&r>h&&r<h+d)return[s<r?[n,s]:[a,r],s>r?[n,s]:[a,r]]}},saveText:function(t){this.commentsView&&this.commentsView.cmpEl.find(".lock-area").length<1&&(this.textVal=void 0,t?this.commentsView.clearTextBoxBind():this.textVal=this.commentsView.getActiveTextBoxVal())},loadText:function(){if(this.textVal&&this.commentsView){var t=this.commentsView.getTextBox();t&&t.val(this.textVal)}},getEditText:function(){if(this.commentsView)return this.commentsView.getActiveTextBoxVal()},saveDummyText:function(){this.commentsView&&this.commentsView.cmpEl.find(".lock-area").length<1&&(this.textDummyVal=this.commentsView.getActiveTextBoxVal())},clearDummyText:function(){if(this.commentsView&&this.commentsView.cmpEl.find(".lock-area").length<1){this.textDummyVal=void 0;var t=this.commentsView.getTextBox();t&&t.val(""),this.commentsView.clearTextBoxBind()}},getDummyText:function(){return this.textDummyVal||""},hookTextBox:function(){var t=this,e=this.commentsView.getTextBox();e&&e.keydown((function(e){if(!e.ctrlKey&&!e.metaKey||e.altKey||e.keyCode!==Common.UI.Keys.RETURN){if(e.keyCode===Common.UI.Keys.TAB){var i,o,n;n=this.selectionStart,o=this.selectionEnd,(i=$(this)).val(i.val().substring(0,n)+"\t"+i.val().substring(o)),this.selectionStart=this.selectionEnd=n+1,e.preventDefault()}}else{var s=$("#id-comments-change-popover");s&&s.length&&s.click(),e.stopImmediatePropagation()}t.e=e})),this.canRequestUsers&&(e&&e.keydown((function(e){e.keyCode==Common.UI.Keys.SPACE||e.keyCode===Common.UI.Keys.TAB||e.keyCode==Common.UI.Keys.HOME||e.keyCode==Common.UI.Keys.END||e.keyCode==Common.UI.Keys.RIGHT||e.keyCode==Common.UI.Keys.LEFT||e.keyCode==Common.UI.Keys.UP?t.onEmailListMenu():e.keyCode==Common.UI.Keys.DOWN&&t.emailMenu&&t.emailMenu.rendered&&t.emailMenu.isVisible()&&(_.delay((function(){var e=t.emailMenu.cmpEl.find("li:not(.divider):first");(e=e.find("a")).focus()}),10),e.preventDefault()),t.e=e})),e&&e.on("input",(function(e){clearTimeout(t._state.timerEmailList);for(var i=$(this),o=this.selectionStart,n=i.val(),s=0,a=n.length-1,r=o-1;r>=0;r--)if(32==n.charCodeAt(r)||13==n.charCodeAt(r)||10==n.charCodeAt(r)||9==n.charCodeAt(r)){s=r+1;break}for(r=o;r<=a;r++)if(32==n.charCodeAt(r)||13==n.charCodeAt(r)||10==n.charCodeAt(r)||9==n.charCodeAt(r)){a=r-1;break}var l=n.substring(s,a+1),c=l.match(/^(?:[@]|[+](?!1))(\S*)/);c&&c.length>1?(l=c[1],t._state.timerEmailList=setTimeout((function(){t.onEmailListMenu(l,s,a)}),300)):t.onEmailListMenu()})))},hideTips:function(){this.commentsView&&_.each(this.commentsView.dataViewItems,(function(t){t.tipsArray&&t.tipsArray.forEach((function(t){t.hide()}))}),this),this.reviewChangesView&&_.each(this.reviewChangesView.dataViewItems,(function(t){t.tipsArray&&t.tipsArray.forEach((function(t){t.hide()}))}),this),this.emailMenu&&this.emailMenu.rendered&&this.emailMenu.cmpEl.css("display","none")},isCommentsViewMouseOver:function(){return this._isMouseOver},setReviewStore:function(t){this.reviewStore=t,this.reviewChangesView&&this.reviewChangesView.setStore(this.reviewStore)},setCommentsStore:function(t){this.commentsStore=t,this.commentsView&&this.commentsView.setStore(this.commentsStore)},getPopover:function(t){return this.popover||(this.popover=new Common.Views.ReviewPopover(t)),this.popover},autoScrollToEditButtons:function(){var t=$("#id-comments-change-popover"),e=null,i=Common.Utils.getBoundingClientRect(this.$window[0]),o=0;t.length&&(e=Common.Utils.getBoundingClientRect(t.get(0)))&&i&&(o=i.bottom-(e.bottom+7))<0&&this.scroller.scrollTop(this.scroller.getScrollTop()-o)},onEmailListMenu:function(t,e,i){if(clearTimeout(this._state.timerEmailList),"string"==typeof t){this._state.emailSearch={str:t,left:e,right:i,from:0,count:100,total:void 0,requestNext:void 0};var o=this._state.emailSearch;Common.UI.ExternalUsers.get("mention",void 0,o.from,o.count,o.str)}else this._state.emailSearch=null,this.emailMenu.rendered&&this.emailMenu.cmpEl.css("display","none")},onEmailListMenuNext:function(){var t=this._state.emailSearch;t&&void 0!==t.total&&t.from+t.count<t.total&&(t.from+=t.count,Common.UI.ExternalUsers.get("mention",void 0,t.from,t.count,t.str))},onEmailListMenuCallback:function(t,e,i){if(!(!this._state.emailSearch||e.length<1||t&&"mention"!==t)){var o=this,n=o.emailMenu,s=this._state.emailSearch.str,a=this._state.emailSearch.left,r=this._state.emailSearch.right,l=this._state.emailSearch.from,c=void 0===i;this._state.emailSearch.total=i,c&&(this._state.emailSearch=null);var h=o.$window.find(Common.Utils.String.format("#menu-container-{0}",n.id)),d=this.commentsView.getTextBox(),m=d?d[0]:null,p=m?[m.offsetLeft,m.offsetTop+m.clientHeight+3]:[0,0];if(n.rendered||(h.length<1&&(h=$(Common.Utils.String.format('<div id="menu-container-{0}" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',n.id)),o.$window.append(h)),n.render(h),n.cmpEl.css("min-width",m?m.clientWidth:220),n.cmpEl.attr({tabindex:"-1"}),n.on("hide:after",(function(){setTimeout((function(){var t=o.commentsView.getTextBox();t&&t.focus()}),10)})),!c&&n.scroller.cmpEl.on("scroll",(function(t){o._state.emailSearch&&o._state.emailSearch.requestNext>0&&o._state.emailSearch.requestNext<$(t.target).scrollTop()&&(o._state.emailSearch.requestNext=-1,o.onEmailListMenuNext())}))),c||0===l)for(var u=0;u<n.items.length;u++)n.removeItem(n.items[u]),u--;if(e.length>0){c&&(s=s.toLowerCase()).length>0&&(e=_.filter(e,(function(t){if(t.email&&0===t.email.toLowerCase().indexOf(s))return!0;for(var e=t.name?t.name.toLowerCase().split(" "):[],i=!1,o=0;o<e.length;o++)if(0===e[o].indexOf(s)){i=!0;break}return i})));var g=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div style="overflow: hidden; text-overflow: ellipsis; max-width: 195px;"><%= Common.Utils.String.htmlEncode(caption) %></div><div style="overflow: hidden; text-overflow: ellipsis; max-width: 195px; color: #909090;"><%= Common.Utils.String.htmlEncode(options.value) %></div></a>'),f=!1;_.each(e,(function(t,e){if(f&&!t.hasAccess&&(f=!1,n.addItem(new Common.UI.MenuItem({caption:"--"}))),t.email&&t.name){var i=new Common.UI.MenuItem({caption:t.name,value:t.email,template:g}).on("click",(function(t,e){o.insertEmailToTextbox(t.options.value,a,r)}));n.addItem(i),t.hasAccess&&(f=!0)}}))}n.items.length>0?(h.css({left:p[0],top:p[1]}),n.menuAlignEl=d,n.show(),n.cmpEl.css("display",""),n.alignPosition("bl-tl",-5),n.scroller.update({alwaysVisibleY:!0}),c||(0===l&&n.scroller.scrollTop(0),o._state.emailSearch.requestNext=n.items.length<o._state.emailSearch.total?(1-10/n.items.length)*n.cmpEl.get(0).scrollHeight:-1)):n.rendered&&n.cmpEl.css("display","none")}},insertEmailToTextbox:function(t,e,i){var o=this.commentsView.getTextBox();if(o){var n=o.val();o.val(n.substring(0,e)+"+"+t+" "+n.substring(i+1,n.length)),setTimeout((function(){o[0].selectionStart=o[0].selectionEnd=e+t.length+2}),10)}},textAddReply:"Add Reply",textAdd:"Add",textCancel:"Cancel",textEdit:"Edit",textReply:"Reply",textClose:"Close",textResolve:"Resolve",textOpenAgain:"Open Again",textFollowMove:"Follow Move",textMention:"+mention will provide access to the document and send an email",textMentionNotify:"+mention will notify the user via email",textEnterComment:"Enter your comment here",textViewResolved:"You have not permission for reopen comment",txtAccept:"Accept",txtReject:"Reject",txtEditTip:"Edit",txtDeleteTip:"Delete",textComment:"Comment"},Common.Views.ReviewPopover||{}))})),void 0===Common)var Common={};if(Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/Comments",["core","common/main/lib/model/Comment","common/main/lib/collection/Comments","common/main/lib/view/Comments","common/main/lib/view/ReviewPopover"],(function(){"use strict";function t(){return void 0!==Asc.asc_CCommentDataWord?new Asc.asc_CCommentDataWord(null):new Asc.asc_CCommentData(null)}Common.Controllers.Comments=Backbone.Controller.extend(_.extend({models:[],collections:["Common.Collections.Comments"],views:["Common.Views.Comments","Common.Views.ReviewPopover"],sdkViewName:"#id_main",subEditStrings:{},filter:void 0,hintmode:!1,fullInfoHintMode:!1,viewmode:!1,isSelectedComment:!1,uids:[],oldUids:[],isDummyComment:!1,initialize:function(){this.addListeners({"Common.Views.Comments":{"comment:add":_.bind(this.onCreateComment,this),"comment:change":_.bind(this.onChangeComment,this),"comment:remove":_.bind(this.onRemoveComment,this),"comment:resolve":_.bind(this.onResolveComment,this),"comment:show":_.bind(this.onShowComment,this),"comment:addReply":_.bind(this.onAddReplyComment,this),"comment:changeReply":_.bind(this.onChangeReplyComment,this),"comment:removeReply":_.bind(this.onRemoveReplyComment,this),"comment:editReply":_.bind(this.onShowEditReplyComment,this),"comment:closeEditing":_.bind(this.closeEditing,this),"comment:sort":_.bind(this.setComparator,this),"comment:filtergroups":_.bind(this.setFilterGroups,this)},"Common.Views.ReviewPopover":{"comment:change":_.bind(this.onChangeComment,this),"comment:remove":_.bind(this.onRemoveComment,this),"comment:resolve":_.bind(this.onResolveComment,this),"comment:show":_.bind(this.onShowComment,this),"comment:addReply":_.bind(this.onAddReplyComment,this),"comment:changeReply":_.bind(this.onChangeReplyComment,this),"comment:removeReply":_.bind(this.onRemoveReplyComment,this),"comment:editReply":_.bind(this.onShowEditReplyComment,this),"comment:closeEditing":_.bind(this.closeEditing,this),"comment:disableHint":_.bind(this.disableHint,this),"comment:addDummyComment":_.bind(this.onAddDummyComment,this)},"Common.Views.ReviewChanges":{"comment:removeComments":_.bind(this.onRemoveComments,this),"comment:resolveComments":_.bind(this.onResolveComments,this)}}),Common.NotificationCenter.on("comments:updatefilter",_.bind(this.onUpdateFilter,this)),Common.NotificationCenter.on("app:comment:add",_.bind(this.onAppAddComment,this)),Common.NotificationCenter.on("layout:changed",function(t){Common.Utils.asyncCall((function(t){"toolbar"!=t&&"status"!=t||!this.view.$el.is(":visible")||this.onAfterShow()}),this,t)}.bind(this)),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},onLaunch:function(){var t=Common.localStorage.getKeysFilter();this.appPrefix=t&&t.length?t.split(",")[0]:"",this._state={disableEditing:!1,docProtection:{isReadOnly:!1,isReviewOnly:!1,isFormsOnly:!1,isCommentsOnly:!1}},this.collection=this.getApplication().getCollection("Common.Collections.Comments"),this.setComparator(),this.popoverComments=new Common.Collections.Comments,this.popoverComments&&(this.popoverComments.comparator=function(t){return null===t.get("time")?(new Date).getTime():t.get("time")}),this.groupCollection=[],this.userGroups=[],this.view=this.createView("Common.Views.Comments",{store:this.collection}),this.view.render(),this.userCollection=this.getApplication().getCollection("Common.Collections.Users"),this.userCollection.on("reset",_.bind(this.onUpdateUsers,this)),this.userCollection.on("add",_.bind(this.onUpdateUsers,this)),Common.NotificationCenter.on("mentions:setusers",this.avatarsUpdate.bind(this)),this.bindViewEvents(this.view,this.events)},setConfig:function(t,e){this.setApi(e),t&&(this.currentUserId=t.config.user.id,this.sdkViewName=t.sdkviewname||this.sdkViewName,this.hintmode=t.hintmode||!1,this.fullInfoHintMode=t.fullInfoHintMode||!1,this.viewmode=t.viewmode||!1)},setApi:function(t){t&&(this.api=t,this.api.asc_registerCallback("asc_onAddComment",_.bind(this.onApiAddComment,this)),this.api.asc_registerCallback("asc_onAddComments",_.bind(this.onApiAddComments,this)),this.api.asc_registerCallback("asc_onRemoveComment",_.bind(this.onApiRemoveComment,this)),this.api.asc_registerCallback("asc_onChangeComments",_.bind(this.onChangeComments,this)),this.api.asc_registerCallback("asc_onRemoveComments",_.bind(this.onApiRemoveComments,this)),this.api.asc_registerCallback("asc_onChangeCommentData",_.bind(this.onApiChangeCommentData,this)),this.api.asc_registerCallback("asc_onLockComment",_.bind(this.onApiLockComment,this)),this.api.asc_registerCallback("asc_onUnLockComment",_.bind(this.onApiUnLockComment,this)),this.api.asc_registerCallback("asc_onShowComment",_.bind(this.onApiShowComment,this)),this.api.asc_registerCallback("asc_onHideComment",_.bind(this.onApiHideComment,this)),this.api.asc_registerCallback("asc_onUpdateCommentPosition",_.bind(this.onApiUpdateCommentPosition,this)),this.api.asc_registerCallback("asc_onDocumentPlaceChanged",_.bind(this.onDocumentPlaceChanged,this)),this.api.asc_registerCallback("asc_onDeleteComment",_.bind(this.onDeleteComment,this)),this.api.asc_registerCallback("asc_onChangeCommentLogicalPosition",_.bind(this.onApiChangeCommentLogicalPosition,this)))},setMode:function(t){return this.mode=t,this.isModeChanged=!0,this.view.viewmode=!this.mode.canComments,this.view.changeLayout(t),this},setComparator:function(t){if(this.collection){var e=void 0!==t;if(void 0===t&&(t=Common.localStorage.getItem(this.appPrefix+"comments-sort")||"date-desc"),Common.localStorage.setItem(this.appPrefix+"comments-sort",t),Common.Utils.InternalSettings.set(this.appPrefix+"comments-sort",t),"position-asc"==t||"position-desc"==t){var i="position-asc"==t?1:-1;this.collection.comparator=function(t){return i*t.get("position")}}else if("author-asc"==t||"author-desc"==t){i="author-asc"==t?1:-1;this.collection.comparator=function(t,e){var o=t.get("parsedName").toLowerCase(),n=e.get("parsedName").toLowerCase();return o==n?0:o<n?-i:i}}else{i="date-asc"==t?1:-1;this.collection.comparator=function(t){return null===t.get("time")?(new Date).getTime():i*t.get("time")}}e&&this.updateComments(!0)}},getComparator:function(){return Common.Utils.InternalSettings.get(this.appPrefix+"comments-sort")||"date"},onCreateComment:function(e,i,o,n,s){if(this.api&&i&&i.length>0){var a=t();a&&(this.showPopover=!0,this.editPopover=!!o,this.hidereply=n,this.isSelectedComment=!1,this.uids=[],a.asc_putText(i),a.asc_putTime(this.utcDateToString(new Date)),a.asc_putOnlyOfficeTime(this.ooDateToString(new Date)),a.asc_putUserId(this.currentUserId),a.asc_putUserName(AscCommon.UserInfoParser.getCurrentName()),a.asc_putSolved(!1),_.isUndefined(a.asc_putDocumentFlag)||a.asc_putDocumentFlag(s),this.api.asc_addComment(a),this.view.showEditContainer(!1))}this.view.txtComment.focus()},onRemoveComment:function(t){this.api&&t&&this.api.asc_removeComment(t)},onRemoveComments:function(t){this.api&&this.api.asc_RemoveAllComments("my"==t||!this.mode.canDeleteComments,"current"==t)},onResolveComments:function(t){this.api&&this.api.asc_ResolveAllComments("my"==t||!this.mode.canEditComments,"current"==t)},onResolveComment:function(t){var e=this,i=null,o=e.findComment(t);if(_.isUndefined(t)&&(t=o.get("uid")),o){var n=e.buildComment(o);return!!n&&(n.asc_putSolved(!o.get("resolved")),(i=o.get("replys"))&&i.length&&i.forEach((function(t){var i=e.buildReplyComment(t);i&&n.asc_addReply(i)})),e.api.asc_changeComment(t,n),!0)}return!1},onShowComment:function(t,e,i){var o=this.findComment(t);if(o)if(null!==o.get("quote")){if(this.api){if(this.hintmode){if(this.animate=!0,o.get("unattached")&&this.getPopover())return void this.getPopover().hideComments()}else if(this.popoverComments.findWhere({uid:t})&&!this.getPopover().isVisible())return this.getPopover().showComments(!0),void this.api.asc_selectComment(t);!_.isUndefined(e)&&this.hintmode&&(this.isSelectedComment=e),i&&0===_.difference(this.uids,[t]).length&&0===_.difference([t],this.uids).length||(this.api.asc_selectComment(t),this._dontScrollToComment=!0,this.api.asc_showComment(t,!1))}}else this.hintmode&&this.api.asc_selectComment(t),this.getPopover()&&this.getPopover().hideComments(),this.isSelectedComment=!1,this.uids=[]},onChangeComment:function(t,e){if(e&&e.length>0){var i=this,o=null,n=i.findComment(t),s="";if(n){var a=i.buildComment(n);if(!a)return!1;a.asc_putText(e),a.asc_putUserId(i.currentUserId),a.asc_putUserName(AscCommon.UserInfoParser.getCurrentName()),s=n.get("comment"),n.set("editTextInPopover",!1),(o=i.findPopupComment(t))&&o.set("editTextInPopover",!1),i.subEditStrings[t]&&delete i.subEditStrings[t],i.subEditStrings[t+"-R"]&&delete i.subEditStrings[t+"-R"];var r=n.get("replys");return r&&r.length&&r.forEach((function(t){var e=i.buildReplyComment(t);e&&a.asc_addReply(e)})),i.api.asc_changeComment(t,a),i.mode&&i.mode.canRequestSendNotify&&i.view.pickEMail(a.asc_getGuid(),e,s),!0}}return!1},onChangeReplyComment:function(e,i,o){if(o&&o.length>0){var n=this,s=null,a=n.findComment(e),r="";if(a){var l=n.buildComment(a);if(!l)return!1;var c=a.get("replys");return c&&c.length&&c.forEach((function(e){(s=t())&&(e.get("id")!==i||_.isUndefined(o)?(s.asc_putText(e.get("reply")),s.asc_putUserId(e.get("userid")),s.asc_putUserName(e.get("username"))):(r=e.get("reply"),s.asc_putText(o),s.asc_putUserId(n.currentUserId),s.asc_putUserName(AscCommon.UserInfoParser.getCurrentName())),s.asc_putTime(e.get("time")?n.utcDateToString(new Date(e.get("time"))):""),s.asc_putOnlyOfficeTime(e.get("time")?n.ooDateToString(new Date(e.get("time"))):""),s.asc_putUserData(e.get("userdata")),l.asc_addReply(s))})),n.api.asc_changeComment(e,l),n.mode&&n.mode.canRequestSendNotify&&n.view.pickEMail(l.asc_getGuid(),o,r),!0}}return!1},onAddReplyComment:function(e,i){if(i.length>0){var o=this,n=null,s=o.findComment(e);if(s){(n=s.get("uid"))&&(o.subEditStrings[n]&&delete o.subEditStrings[n],o.subEditStrings[n+"-R"]&&delete o.subEditStrings[n+"-R"],s.set("showReplyInPopover",!1));var a=o.buildComment(s);if(!a)return!1;var r=s.get("replys");r&&r.length&&r.forEach((function(t){var e=o.buildReplyComment(t);e&&a.asc_addReply(e)}));var l=t();if(l)return l.asc_putText(i),l.asc_putTime(o.utcDateToString(new Date)),l.asc_putOnlyOfficeTime(o.ooDateToString(new Date)),l.asc_putUserId(o.currentUserId),l.asc_putUserName(AscCommon.UserInfoParser.getCurrentName()),a.asc_addReply(l),o.api.asc_changeComment(e,a),o.mode&&o.mode.canRequestSendNotify&&o.view.pickEMail(a.asc_getGuid(),i),!0}}return!1},onRemoveReplyComment:function(t,e){if(!_.isUndefined(t)&&!_.isUndefined(e)){var i=this,o=i.findComment(t);if(o){var n=i.buildComment(o);if(!n)return!1;var s=o.get("replys");return s&&s.length&&s.forEach((function(t){if(t.get("id")!==e){var o=i.buildReplyComment(t);o&&n.asc_addReply(o)}})),i.api.asc_changeComment(t,n),!0}}return!1},onShowEditReplyComment:function(t,e,i){var o,n,s,a;if(!_.isUndefined(t)&&!_.isUndefined(e))if(i){if((n=this.popoverComments.findWhere({uid:t}))&&(s=n.get("replys"),a=_.clone(n.get("replys"))))for(o=0;o<a.length;++o)if(e===a[o].get("id"))return a[o].set("editTextInPopover",!0),s.length=0,n.set("replys",a),!0}else if((n=this.collection.findWhere({uid:t}))&&(s=n.get("replys"),a=_.clone(n.get("replys"))))for(o=0;o<a.length;++o)if(e===a[o].get("id"))return a[o].set("editText",!0),s.length=0,n.set("replys",a),!0;return!1},onUpdateFilter:function(t,e){if(t){this.view.isVisible()||(this.view.needUpdateFilter=t,e=!0),this.filter=t;var i=this,o=[];if(this.filter.forEach((function(t){i.groupCollection[t]||(i.groupCollection[t]=new Backbone.Collection([],{model:Common.Models.Comment})),o=o.concat(i.groupCollection[t].models)})),this.collection.reset(o),this.collection.groups=this.filter,!e){this.getPopover()&&this.getPopover().hide(),this.view.needUpdateFilter=!1;for(var n=!0,s=this.collection.length-1;s>=0;--s){var a=this.collection.at(s);!n||a.get("hide")||a.get("filtered")?a.get("last")&&a.set("last",!1,{silent:!0}):(a.set("last",!0,{silent:!0}),n=!1)}this.view.render(),this.view.update()}}},onAppAddComment:function(t,e){this.api.can_AddQuotedComment&&!1===this.api.can_AddQuotedComment()||e||this.addDummyComment()},addCommentToGroupCollection:function(t){var e=t.get("groupName");this.groupCollection[e]||(this.groupCollection[e]=new Backbone.Collection([],{model:Common.Models.Comment})),this.groupCollection[e].push(t)},onApiAddComment:function(t,e){var i={},o=this.readSDKComment(t,e,i);o&&(o.get("groupName")?(this.addCommentToGroupCollection(o),_.indexOf(this.collection.groups,o.get("groupName"))>-1&&this.collection.push(o)):this.collection.push(o),this.updateComments(!0,"position-asc"===this.getComparator()||"position-desc"===this.getComparator()),this.showPopover&&(null!==e.asc_getQuoteText()&&(this.api.asc_selectComment(t),this._dontScrollToComment=!0,this.api.asc_showComment(t,!0)),this.showPopover=void 0,this.editPopover=!1),i.arrIds&&i.arrIds.length&&Common.UI.ExternalUsers.get("info",i.arrIds))},onApiAddComments:function(t){for(var e={},i=0;i<t.length;++i){var o=this.readSDKComment(t[i].asc_getId(),t[i],e);o.get("groupName")?this.addCommentToGroupCollection(o):this.collection.push(o)}this.updateComments(!0,"position-asc"===this.getComparator()||"position-desc"===this.getComparator()),e.arrIds&&e.arrIds.length&&Common.UI.ExternalUsers.get("info",e.arrIds)},onApiRemoveComment:function(t,e){for(var i in this.groupCollection){var o=this.groupCollection[i];if(n=o.findWhere({uid:t})){o.remove(n);break}}var n;this.collection.length&&((n=this.collection.findWhere({uid:t}))&&(this.collection.remove(n),e||this.updateComments(!0)),this.popoverComments.length&&(n=this.popoverComments.findWhere({uid:t}))&&(this.popoverComments.remove(n),0===this.popoverComments.length&&this.getPopover()&&this.getPopover().hideComments()))},onChangeComments:function(t){for(var e=0;e<t.length;++e)this.onApiChangeCommentData(t[e].Comment.Id,t[e].Comment,!0);this.updateComments(!0)},onApiRemoveComments:function(t){for(var e=0;e<t.length;++e)this.onApiRemoveComment(t[e],!0);this.updateComments(!0)},onApiChangeCommentData:function(t,e,i){var o=this,n=0,s=null,a=null,r=0,l=null,c=this.findComment(t)||this.findCommentInGroup(t);if(c){o=this,s=e.asc_getOnlyOfficeTime()?new Date(this.stringOOToLocalDate(e.asc_getOnlyOfficeTime())):""==e.asc_getTime()?null:new Date(this.stringUtcToLocalDate(e.asc_getTime()));var h=e.asc_getUserId(),d=this.userCollection.findOriginalUser(h),m=Common.UI.ExternalUsers.getImage(h),p=[];void 0===m&&p.push(h);var u=!AscCommon.UserInfoParser.canViewComment(e.asc_getUserName()),g=("author-asc"==this.getComparator()||"author-desc"==this.getComparator())&&e.asc_getUserName()!==c.get("username")||u!==c.get("hide");if(c.set("comment",e.asc_getText()),c.set("userid",h),c.set("username",e.asc_getUserName()),c.set("initials",Common.Utils.getUserInitials(AscCommon.UserInfoParser.getParsedName(e.asc_getUserName()))),c.set("parsedName",AscCommon.UserInfoParser.getParsedName(e.asc_getUserName())),c.set("parsedGroups",AscCommon.UserInfoParser.getParsedGroups(e.asc_getUserName())),c.set("usercolor",d?d.get("color"):Common.UI.ExternalUsers.getColor(h||e.asc_getUserName())),c.set("avatar",m),c.set("resolved",e.asc_getSolved()),c.set("quote",e.asc_getQuoteText()),c.set("userdata",e.asc_getUserData()),c.set("time",s?s.getTime():null),c.set("date",s?o.dateToLocaleTimeString(s):null),c.set("editable",(o.mode.canEditComments||h==o.currentUserId)&&AscCommon.UserInfoParser.canEditComment(e.asc_getUserName())),c.set("removable",(o.mode.canDeleteComments||h==o.currentUserId)&&AscCommon.UserInfoParser.canDeleteComment(e.asc_getUserName())),c.set("hide",u),!c.get("hide")){var f=c.get("parsedGroups");o.fillUserGroups(f);var b=Common.Utils.InternalSettings.get(o.appPrefix+"comments-filtergroups"),C=!!b&&-1!==b&&(!f||f.length<1||f.indexOf(b)<0);c.set("filtered",C)}for((a=_.clone(c.get("replys"))).length=0,r=e.asc_getRepliesCount(),n=0;n<r;++n)l=e.asc_getReply(n).asc_getOnlyOfficeTime()?new Date(this.stringOOToLocalDate(e.asc_getReply(n).asc_getOnlyOfficeTime())):""==e.asc_getReply(n).asc_getTime()?null:new Date(this.stringUtcToLocalDate(e.asc_getReply(n).asc_getTime())),h=e.asc_getReply(n).asc_getUserId(),d=this.userCollection.findOriginalUser(h),void 0===(m=Common.UI.ExternalUsers.getImage(h))&&p.push(h),a.push(new Common.Models.Reply({id:Common.UI.getId(),userid:h,username:e.asc_getReply(n).asc_getUserName(),initials:Common.Utils.getUserInitials(AscCommon.UserInfoParser.getParsedName(e.asc_getReply(n).asc_getUserName())),parsedName:AscCommon.UserInfoParser.getParsedName(e.asc_getReply(n).asc_getUserName()),usercolor:d?d.get("color"):Common.UI.ExternalUsers.getColor(h||e.asc_getReply(n).asc_getUserName()),avatar:m,date:l?o.dateToLocaleTimeString(l):null,reply:e.asc_getReply(n).asc_getText(),userdata:e.asc_getReply(n).asc_getUserData(),time:l?l.getTime():null,editText:!1,editTextInPopover:!1,showReplyInPopover:!1,scope:o.view,editable:(o.mode.canEditComments||h==o.currentUserId)&&AscCommon.UserInfoParser.canEditComment(e.asc_getReply(n).asc_getUserName()),removable:(o.mode.canDeleteComments||h==o.currentUserId)&&AscCommon.UserInfoParser.canDeleteComment(e.asc_getReply(n).asc_getUserName())}));c.set("replys",a),this.popoverComments.findWhere({hide:!1})||this.getPopover()&&this.getPopover().hideComments(),i||this.updateComments(g,!g),p.length&&Common.UI.ExternalUsers.get("info",p)}},onApiLockComment:function(t,e){var i=this.findComment(t)||this.findCommentInGroup(t),o=null;i&&this.userCollection&&(o=this.userCollection.findUser(e))&&(this.getPopover()&&this.getPopover().saveText(),this.view.saveText(),i.set("lock",!0),i.set("lockuserid",this.view.getUserName(o.get("username"))))},onApiUnLockComment:function(t){var e=this.findComment(t)||this.findCommentInGroup(t);e&&(e.set("lock",!1),this.getPopover()&&this.getPopover().loadText(),this.view.loadText())},onApiShowComment:function(t,e,i,o,n,s){var a=s,r=0===_.difference(this.uids,t).length&&0===_.difference(t,this.uids).length;if(!(s&&this.isSelectedComment&&r)||this.isModeChanged){var l=this.getPopover();if(l){if(this.clearDummyComment(),this.isSelectedComment&&r&&!this.isModeChanged)return void(this.api&&(l.commentsView&&l.commentsView.setFocusToTextBox(!0),this.api.asc_enableKeyEvents(!0)));var c=0,h="",d="",m=null,p="",u=!0,g=[];for(c=0;c<t.length;++c)h=t[c],d=t[c]+"-R",(m=this.findComment(h))&&(!this.subEditStrings[h]||!m.get("fullInfoInHint")&&s?!this.subEditStrings[d]||!m.get("fullInfoInHint")&&s||(m.set("showReplyInPopover",!0),p=this.subEditStrings[d]):(m.set("editTextInPopover",!0),p=this.subEditStrings[h]),m.set("hint",!_.isUndefined(s)&&s),!s&&this.hintmode&&(r&&(u=!1),this.oldUids.length&&0===_.difference(this.oldUids,t).length&&0===_.difference(t,this.oldUids).length&&(u=!1,this.oldUids=[]),!r||a||this.isModeChanged||this.api.asc_selectComment(m.get("uid"))),this.animate&&(u=this.animate,this.animate=!1),this.isSelectedComment=!a||!this.hintmode,this.uids=_.clone(t),g.push(m),this._dontScrollToComment||this.view.commentsView.scrollToRecord(m),this._dontScrollToComment=!1);this.popoverComments.reset(g),this.popoverComments.findWhere({hide:!1})?(!l.isVisible()||r&&!this.isModeChanged||l.hide(),l.setLeftTop(e,i,o),l.showComments(u,!1,!0,p)):l.hideComments()}this.isModeChanged=!1}},onApiHideComment:function(t){var e=this;if(this.getPopover()){if(this.isSelectedComment&&t)return;if(t&&this.getPopover().isCommentsViewMouseOver())return;this.popoverComments.each((function(t){t.get("editTextInPopover")&&(e.subEditStrings[t.get("uid")]=e.getPopover().getEditText()),t.get("showReplyInPopover")&&(e.subEditStrings[t.get("uid")+"-R"]=e.getPopover().getEditText())})),this.getPopover().saveText(!0),this.getPopover().hideComments(),this.collection.clearEditing(),this.popoverComments.clearEditing(),this.oldUids=_.clone(this.uids),this.isSelectedComment=!1,this.uids=[],this.popoverComments.reset()}},onApiUpdateCommentPosition:function(t,e,i,o){var n,s=!1,a=null,r=void 0,l="",c="";if(this.getPopover())if(this.getPopover().saveText(),this.getPopover().hideTips(),i<0||this.getPopover().sdkBounds.outerHeight<i||!_.isUndefined(o)&&this.getPopover().sdkBounds.width<o)this.getPopover().hide();else{if(this.isModeChanged&&this.onApiShowComment(t,e,i,o),0===this.popoverComments.length){var h=[];for(n=0;n<t.length;++n)l=t[n],c=t[n]+"-R",(a=this.findComment(l))&&(this.subEditStrings[l]?(a.set("editTextInPopover",!0),r=this.subEditStrings[l]):this.subEditStrings[c]&&(a.set("showReplyInPopover",!0),r=this.subEditStrings[c]),h.push(a));this.popoverComments.reset(h),this.popoverComments.findWhere({hide:!1})?(s=!0,this.getPopover().showComments(s,void 0,void 0,r)):this.getPopover().hideComments()}else!this.getPopover().isVisible()&&this.popoverComments.findWhere({hide:!1})&&this.getPopover().showComments(!1,void 0,void 0,r);this.getPopover().setLeftTop(e,i,o,void 0,!0)}},onDocumentPlaceChanged:function(){if(this.isDummyComment&&this.getPopover()&&this.getPopover().isVisible()){var t=this.api.asc_getAnchorPosition();t&&this.getPopover().setLeftTop(t.asc_getX()+t.asc_getWidth(),t.asc_getY(),this.hintmode?t.asc_getX():void 0)}},onDeleteComment:function(t,e){this.api&&this.api.asc_RemoveAllComments(!this.mode.canDeleteComments,!0)},onApiChangeCommentLogicalPosition:function(t){for(var e in t)if(t.hasOwnProperty(e)){var i=this.findComment(e)||this.findCommentInGroup(e);i&&i.set("position",t[e])}("position-asc"===this.getComparator()||"position-desc"===this.getComparator())&&this.updateComments(!0)},updateComments:function(t,e,i){var o=this;o.updateCommentsTime=new Date,o.disableSort=!!e,void 0===o.timerUpdateComments&&(o.timerUpdateComments=setInterval((function(){new Date-o.updateCommentsTime>100&&(clearInterval(o.timerUpdateComments),o.timerUpdateComments=void 0,o.updateCommentsView(t,o.disableSort,i))}),25))},updateCommentsView:function(t,e,i){if(t&&!this.view.isVisible())return this.view.needRender=t,void this.onUpdateFilter(this.filter,!0);var o,n=!0;if(e||this.collection.sort(),t){for(this.onUpdateFilter(this.filter,!0),o=this.collection.length-1;o>=0;--o){var s=this.collection.at(o);!n||s.get("hide")||s.get("filtered")?s.get("last")&&s.set("last",!1,{silent:!0}):(s.set("last",!0,{silent:!0}),n=!1)}this.view.render(),this.view.needRender=!1}this.view.update(),i&&this.view.loadText()},findComment:function(t){return this.collection.findWhere({uid:t})},findPopupComment:function(t){return this.popoverComments.findWhere({id:t})},findCommentInGroup:function(t){for(var e in this.groupCollection){var i=this.groupCollection[e].findWhere({uid:t});if(i)return i}},closeEditing:function(t){if(!_.isUndefined(t)){var e=this.findPopupComment(t);e&&(e.set("editTextInPopover",!1),e.set("showReplyInPopover",!1)),this.subEditStrings[t]&&delete this.subEditStrings[t],this.subEditStrings[t+"-R"]&&delete this.subEditStrings[t+"-R"]}this.collection.clearEditing(),this.collection.each((function(t){var e=_.clone(t.get("replys"));t.get("replys").length=0,e.forEach((function(t){t.get("editText")&&t.set("editText",!1),t.get("editTextInPopover")&&t.set("editTextInPopover",!1)})),t.set("replys",e)})),this.view.showEditContainer(!1),this.view.update()},disableHint:function(t){t&&this.mode.canComments&&(t.set("hint",!1),this.api.asc_showComment(t.get("uid"),!1),this.isSelectedComment=!0)},blockPopover:function(t){this.isSelectedComment=t,t&&this.getPopover().isVisible()&&this.getPopover().hide()},getPopover:function(){return _.isUndefined(this.popover)&&(this.popover=Common.Views.ReviewPopover.prototype.getPopover({commentsStore:this.popoverComments,renderTo:this.sdkViewName,canRequestUsers:this.mode?this.mode.canRequestUsers:void 0,canRequestSendNotify:this.mode?this.mode.canRequestSendNotify:void 0,mentionShare:!this.mode||this.mode.mentionShare,api:this.api}),this.popover.setCommentsStore(this.popoverComments)),this.popover},onUpdateUsers:function(){var t=this.userCollection,e=!1,i=function(e,o,n){var s=o?o.get("color"):Common.UI.ExternalUsers.getColor(e.get("userid")||e.get("username")),a=!1;return s!==e.get("usercolor")&&(a=!0,e.set("usercolor",s,{silent:!0})),o&&void 0!==o.image&&o.image!==e.get("avatar")&&(a=!0,e.set("avatar",o.image,{silent:!0})),n&&(e.get("replys").forEach((function(e){var o=i(e,t.findOriginalUser(e.get("userid")),!1);a=o||a})),a&&e.trigger("change")),a};for(var o in this.groupCollection)e=!0,this.groupCollection[o].each((function(e){i(e,t.findOriginalUser(e.get("userid")),!0)}));!e&&this.collection.each((function(e){i(e,t.findOriginalUser(e.get("userid")),!0)}))},avatarsUpdate:function(t,e){if("info"===t){var i=!1,o=function(t,i){var n=_.findWhere(e,{id:t.get("userid")}),s=!1;if(n&&void 0!==n.image){var a=n.image;a!==t.get("avatar")&&(s=!0,t.set("avatar",a,{silent:!0}))}return i&&(t.get("replys").forEach((function(t){var e=o(t,!1);s=e||s})),s&&t.trigger("change")),s};for(var n in this.groupCollection)i=!0,this.groupCollection[n].each((function(t){o(t,!0)}));!i&&this.collection.each((function(t){o(t,!0)}))}},readSDKComment:function(t,e,i){i&&!i.arrIds&&(i.arrIds=[]);var o=e.asc_getOnlyOfficeTime()?new Date(this.stringOOToLocalDate(e.asc_getOnlyOfficeTime())):""==e.asc_getTime()?null:new Date(this.stringUtcToLocalDate(e.asc_getTime())),n=e.asc_getUserId(),s=this.userCollection.findOriginalUser(n),a=t.substr(0,t.lastIndexOf("_")+1).match(/^(doc|sheet[0-9_]+)_/),r=Common.UI.ExternalUsers.getImage(n);void 0===r&&i.arrIds.push(n);var l=new Common.Models.Comment({uid:t,guid:e.asc_getGuid(),userid:n,username:e.asc_getUserName(),initials:Common.Utils.getUserInitials(AscCommon.UserInfoParser.getParsedName(e.asc_getUserName())),parsedName:AscCommon.UserInfoParser.getParsedName(e.asc_getUserName()),parsedGroups:AscCommon.UserInfoParser.getParsedGroups(e.asc_getUserName()),usercolor:s?s.get("color"):Common.UI.ExternalUsers.getColor(n||e.asc_getUserName()),avatar:r,date:o?this.dateToLocaleTimeString(o):null,quote:e.asc_getQuoteText(),comment:e.asc_getText(),resolved:e.asc_getSolved(),unattached:!_.isUndefined(e.asc_getDocumentFlag)&&e.asc_getDocumentFlag(),userdata:e.asc_getUserData(),id:Common.UI.getId(),time:o?o.getTime():null,showReply:!1,editText:!1,last:void 0,editTextInPopover:!!this.editPopover,showReplyInPopover:!1,hideAddReply:_.isUndefined(this.hidereply)?!!this.showPopover:this.hidereply,scope:this.view,editable:(this.mode.canEditComments||n==this.currentUserId)&&AscCommon.UserInfoParser.canEditComment(e.asc_getUserName()),removable:(this.mode.canDeleteComments||n==this.currentUserId)&&AscCommon.UserInfoParser.canDeleteComment(e.asc_getUserName()),hide:!AscCommon.UserInfoParser.canViewComment(e.asc_getUserName()),hint:!this.mode.canComments,fullInfoInHint:this.fullInfoHintMode,groupName:a&&a.length>1?a[1]:null});if(l){if(!l.get("hide")){var c=l.get("parsedGroups");this.fillUserGroups(c);var h=Common.Utils.InternalSettings.get(this.appPrefix+"comments-filtergroups"),d=!!h&&-1!==h&&(!c||c.length<1||c.indexOf(h)<0);l.set("filtered",d)}var m=this.readSDKReplies(e,i);m.length&&l.set("replys",m)}return l},readSDKReplies:function(t,e){e&&!e.arrIds&&(e.arrIds=[]);var i=0,o=[],n=null,s=t.asc_getRepliesCount();if(s)for(i=0;i<s;++i){n=t.asc_getReply(i).asc_getOnlyOfficeTime()?new Date(this.stringOOToLocalDate(t.asc_getReply(i).asc_getOnlyOfficeTime())):""==t.asc_getReply(i).asc_getTime()?null:new Date(this.stringUtcToLocalDate(t.asc_getReply(i).asc_getTime()));var a=t.asc_getReply(i).asc_getUserId(),r=this.userCollection.findOriginalUser(a),l=Common.UI.ExternalUsers.getImage(a);void 0===l&&e&&e.arrIds.push(a),o.push(new Common.Models.Reply({id:Common.UI.getId(),userid:a,username:t.asc_getReply(i).asc_getUserName(),initials:Common.Utils.getUserInitials(AscCommon.UserInfoParser.getParsedName(t.asc_getReply(i).asc_getUserName())),parsedName:AscCommon.UserInfoParser.getParsedName(t.asc_getReply(i).asc_getUserName()),usercolor:r?r.get("color"):Common.UI.ExternalUsers.getColor(a||t.asc_getReply(i).asc_getUserName()),avatar:l,date:n?this.dateToLocaleTimeString(n):null,reply:t.asc_getReply(i).asc_getText(),userdata:t.asc_getReply(i).asc_getUserData(),time:n?n.getTime():null,editText:!1,editTextInPopover:!1,showReplyInPopover:!1,scope:this.view,editable:(this.mode.canEditComments||a==this.currentUserId)&&AscCommon.UserInfoParser.canEditComment(t.asc_getReply(i).asc_getUserName()),removable:(this.mode.canDeleteComments||a==this.currentUserId)&&AscCommon.UserInfoParser.canDeleteComment(t.asc_getReply(i).asc_getUserName())}))}return o},addDummyComment:function(){if(this.api){var t=this,e=null,i=new Date,o=this.getPopover();if(o){if(this.popoverComments.length){if(this.isDummyComment)return void _.delay((function(){o.commentsView.setFocusToTextBox()}),200);this.closeEditing()}var n=this.userCollection.findOriginalUser(this.currentUserId),s=new Common.Models.Comment({id:-1,time:i.getTime(),date:this.dateToLocaleTimeString(i),userid:this.currentUserId,username:AscCommon.UserInfoParser.getCurrentName(),avatar:Common.UI.ExternalUsers.getImage(this.currentUserId),initials:Common.Utils.getUserInitials(AscCommon.UserInfoParser.getParsedName(AscCommon.UserInfoParser.getCurrentName())),parsedName:AscCommon.UserInfoParser.getParsedName(AscCommon.UserInfoParser.getCurrentName()),usercolor:n?n.get("color"):Common.UI.ExternalUsers.getColor(this.currentUserId),editTextInPopover:!0,showReplyInPopover:!1,hideAddReply:!0,scope:this.view,dummy:!0});this.popoverComments.reset(),this.popoverComments.push(s),this.uids=[],this.isSelectedComment=!0,this.isDummyComment=!0,_.isUndefined(this.api.asc_SetDocumentPlaceChangedEnabled)||t.api.asc_SetDocumentPlaceChangedEnabled(!0),o.handlerHide=function(){},o.isVisible()&&o.hide(),o.handlerHide=function(e){t.clearDummyComment(e)},(e=this.api.asc_getAnchorPosition())&&(o.setLeftTop(e.asc_getX()+e.asc_getWidth(),e.asc_getY(),this.hintmode?e.asc_getX():void 0),Common.NotificationCenter.trigger("comments:showdummy"),o.showComments(!0,!1,!0,o.getDummyText()))}}},onAddDummyComment:function(e){if(this.api&&e&&e.length>0){var i=t();i&&(this.showPopover=!0,this.editPopover=!1,this.hidereply=!1,this.isSelectedComment=!1,this.uids=[],this.popoverComments.reset(),this.getPopover().isVisible()&&this.getPopover().hideComments(),this.isDummyComment=!1,i.asc_putText(e),i.asc_putTime(this.utcDateToString(new Date)),i.asc_putOnlyOfficeTime(this.ooDateToString(new Date)),i.asc_putUserId(this.currentUserId),i.asc_putUserName(AscCommon.UserInfoParser.getCurrentName()),i.asc_putSolved(!1),_.isUndefined(i.asc_putDocumentFlag)||i.asc_putDocumentFlag(!1),this.api.asc_addComment(i),this.view.showEditContainer(!1),this.mode&&this.mode.canRequestSendNotify&&this.view.pickEMail(i.asc_getGuid(),e),Common.NotificationCenter.trigger("comments:tryshowcomments"),_.isUndefined(this.api.asc_SetDocumentPlaceChangedEnabled)||this.api.asc_SetDocumentPlaceChangedEnabled(!1))}},clearDummyComment:function(t){if(this.isDummyComment){this.isDummyComment=!1,this.showPopover=!0,this.editPopover=!1,this.hidereply=!1,this.isSelectedComment=!1,this.uids=[];var e=this.getPopover();e&&(t&&e.clearDummyText(),e.saveDummyText(),e.handlerHide=function(){},e.isVisible()&&e.hideComments()),this.popoverComments.reset(),_.isUndefined(this.api.asc_SetDocumentPlaceChangedEnabled)||this.api.asc_SetDocumentPlaceChangedEnabled(!1),Common.NotificationCenter.trigger("comments:cleardummy")}},onEditComments:function(t){if(this.api){var e=0,i=null,o=this.api.asc_getAnchorPosition();if(o){for(this.isSelectedComment=!0,this.popoverComments.reset(),e=0;e<t.length;++e)(i=this.findComment(t[e].asc_getId()))&&(i.set("editTextInPopover",this.mode.canEditComments&&AscCommon.UserInfoParser.canEditComment(i.username)),i.set("hint",!1),this.popoverComments.push(i));this.getPopover()&&this.popoverComments.length>0&&this.popoverComments.findWhere({hide:!1})&&(this.getPopover().isVisible()&&this.getPopover().hide(),this.getPopover().setLeftTop(o.asc_getX()+o.asc_getWidth(),o.asc_getY(),this.hintmode?o.asc_getX():void 0),this.getPopover().showComments(!0,!1,!0))}}},onAfterShow:function(){if(this.view&&this.api){var t=$(".new-comment-ct",this.view.el);t&&t.length&&"none"!==t.css("display")&&this.view.txtComment.focus(),this.view.needRender?this.updateComments(!0):this.view.needUpdateFilter&&this.onUpdateFilter(this.view.needUpdateFilter),this.view.update()}},onBeforeHide:function(){this.view&&this.view.showEditContainer(!1)},timeZoneOffsetInMs:6e4*(new Date).getTimezoneOffset(),stringOOToLocalDate:function(t){return"string"==typeof t?parseInt(t):0},ooDateToString:function(t){return"[object Date]"===Object.prototype.toString.call(t)?t.getTime().toString():""},stringUtcToLocalDate:function(t){return"string"==typeof t?parseInt(t)+this.timeZoneOffsetInMs:0},utcDateToString:function(t){return"[object Date]"===Object.prototype.toString.call(t)?(t.getTime()-this.timeZoneOffsetInMs).toString():""},dateToLocaleTimeString:function(t){var e=(this.mode&&this.mode.lang||"en").replace("_","-").toLowerCase();try{return e=="ar-SA".toLowerCase()&&(e+="-u-nu-latn-ca-gregory"),t.toLocaleString(e,{dateStyle:"short",timeStyle:"short"})}catch(i){return e="en",t.toLocaleString(e,{dateStyle:"short",timeStyle:"short"})}return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()+" "+function(t){var e=t.getHours(),i=t.getMinutes(),o=e>=12?"pm":"am";return(e=(e%=12)||12)+":"+(i=i<10?"0"+i:i)+" "+o}(t)},buildComment:function(e){var i=t();return i?(i.asc_putText(e.get("comment")),i.asc_putQuoteText(e.get("quote")),i.asc_putTime(e.get("time")?this.utcDateToString(new Date(e.get("time"))):""),i.asc_putOnlyOfficeTime(e.get("time")?this.ooDateToString(new Date(e.get("time"))):""),i.asc_putUserId(e.get("userid")),i.asc_putUserName(e.get("username")),i.asc_putSolved(e.get("resolved")),i.asc_putGuid(e.get("guid")),i.asc_putUserData(e.get("userdata")),_.isUndefined(i.asc_putDocumentFlag)||i.asc_putDocumentFlag(e.get("unattached")),i):null},buildReplyComment:function(e){var i=t();return i?(i.asc_putText(e.get("reply")),i.asc_putTime(e.get("time")?this.utcDateToString(new Date(e.get("time"))):""),i.asc_putOnlyOfficeTime(e.get("time")?this.ooDateToString(new Date(e.get("time"))):""),i.asc_putUserId(e.get("userid")),i.asc_putUserName(e.get("username")),i.asc_putUserData(e.get("userdata")),i):null},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},setPreviewMode:function(t){this._state.disableEditing=t,this.updatePreviewMode()},updatePreviewMode:function(){var t=this._state.docProtection,e=this._state.disableEditing||t.isReadOnly||t.isFormsOnly;this.viewmode!==e&&(this.viewmode=e,e&&(this.prevcanComments=this.mode.canComments),this.mode.canComments=!e&&this.prevcanComments,this.closeEditing(),this.setMode(this.mode),this.updateComments(!0),this.getPopover()&&(e?this.getPopover().hide():this.getPopover().update(!0)))},clearCollections:function(){this.collection.reset(),this.groupCollection=[]},fillUserGroups:function(t){if(this.mode.canUseCommentPermissions){var e=AscCommon.UserInfoParser.getCommentPermissions("view");t&&t.length>0&&(e&&(t=_.intersection(t,e)),t=_.uniq(this.userGroups.concat(t)));var i=this.view;if(i&&i.buttonSort&&_.difference(t,this.userGroups).length>0){this.userGroups=t,i.hasFilters=this.userGroups.length>0,i.buttonSort.updateHint(this.mode.canComments&&!this.mode.compatibleFeatures?i.hasFilters?i.textSortFilterMore:i.textSortMore:i.hasFilters?i.textSortFilter:i.textSort);var o=i.buttonSort.menu;o.items[o.items.length-3].setVisible(i.hasFilters),o.items[o.items.length-4].setVisible(i.hasFilters),(o=o.items[o.items.length-3].menu).removeAll();var n=Common.Utils.InternalSettings.get(this.appPrefix+"comments-filtergroups");o.addItem(new Common.UI.MenuItem({checkable:!0,checked:-1===n||void 0===n,toggleGroup:"filtercomments",caption:i.textAll,value:-1})),this.userGroups.forEach((function(t){o.addItem(new Common.UI.MenuItem({checkable:!0,checked:n===t,toggleGroup:"filtercomments",caption:t,value:t}))}))}}},setFilterGroups:function(t){Common.Utils.InternalSettings.set(this.appPrefix+"comments-filtergroups",t);var e,i=!0;for(e=this.collection.length-1;e>=0;--e){var o=this.collection.at(e);if(!o.get("hide")){var n=o.get("parsedGroups");o.set("filtered",!!t&&-1!==t&&(!n||n.length<1||n.indexOf(t)<0),{silent:!0})}!i||o.get("hide")||o.get("filtered")?o.get("last")&&o.set("last",!1,{silent:!0}):(o.set("last",!0,{silent:!0}),i=!1)}this.updateComments(!0)},onAppReady:function(t){var e=this;new Promise((function(t,e){t()})).then((function(){e.onChangeProtectDocument(),Common.NotificationCenter.on("protect:doclock",_.bind(e.onChangeProtectDocument,e))}))},onChangeProtectDocument:function(t){if(!t){var e=this.getApplication().getController("DocProtection");t=e?e.getDocProps():null}t&&(this._state.docProtection=t,this.updatePreviewMode())}},Common.Controllers.Comments||{}))})),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/User",["underscore","backbone","common/main/lib/component/BaseView"],(function(t,e){"use strict";Common.Models.User=e.Model.extend({defaults:function(){return{iid:Common.UI.getId(),id:void 0,idOriginal:void 0,username:"Guest",color:"#fff",colorval:null,online:!1,view:!1,hidden:!1}}})})),define("common/main/lib/collection/Users",["backbone","common/main/lib/model/User"],(function(t){"use strict";Common.Collections=Common.Collections||{},Common.Collections.Users=t.Collection.extend({model:Common.Models.User,getOnlineCount:function(){var t=0;return this.each((function(e){e.get("online")&&++t})),t},getEditingCount:function(){return this.filter((function(t){return t.get("online")&&!t.get("view")})).length},getVisibleEditingCount:function(){return this.filter((function(t){return t.get("online")&&!t.get("view")&&!t.get("hidden")})).length},getEditingOriginalCount:function(){return this.chain().filter((function(t){return t.get("online")&&!t.get("view")})).groupBy((function(t){return t.get("idOriginal")})).size().value()},getVisibleEditingOriginalCount:function(){return this.chain().filter((function(t){return t.get("online")&&!t.get("view")&&!t.get("hidden")})).groupBy((function(t){return t.get("idOriginal")})).size().value()},findUser:function(t){return this.findWhere({id:t})},findOriginalUser:function(t){return this.findWhere({idOriginal:t})},findOriginalUsers:function(t){return this.where({idOriginal:t})}}),Common.Collections.HistoryUsers=t.Collection.extend({model:Common.Models.User,findUser:function(t){return this.findWhere({id:t})}})})),define("common/main/lib/model/ChatMessage",["backbone"],(function(t){"use strict";Common.Models=Common.Models||{},Common.Models.ChatMessage=t.Model.extend({defaults:{type:0,userid:null,username:"",message:""}})})),define("common/main/lib/collection/ChatMessages",["backbone","common/main/lib/model/ChatMessage"],(function(t){"use strict";!Common.Collections&&(Common.Collections={}),Common.Collections.ChatMessages=t.Collection.extend({model:Common.Models.ChatMessage})})),define("common/main/lib/controller/Chat",["core","common/main/lib/collection/Users","common/main/lib/collection/ChatMessages","common/main/lib/view/Chat"],(function(){"use strict";Common.Controllers.Chat=Backbone.Controller.extend(_.extend({models:[],collections:["Common.Collections.Users","Common.Collections.ChatMessages"],views:["Common.Views.Chat"],initialize:function(){this.addListeners({"Common.Views.Chat":{"message:add":_.bind(this.onSendMessage,this)}});var t=this;Common.NotificationCenter.on("layout:changed",(function(e){Common.Utils.asyncCall((function(e){"toolbar"!=e&&"status"!=e||!t.panelChat.$el.is(":visible")||(t.panelChat.updateLayout(!0),t.panelChat.setupAutoSizingTextBox())}),this,e)}))},events:{},onLaunch:function(){this.panelChat=this.createView("Common.Views.Chat",{storeUsers:this.getApplication().getCollection("Common.Collections.Users"),storeMessages:this.getApplication().getCollection("Common.Collections.ChatMessages")}),this.panelChat.on("render:after",_.bind(this.onAfterRender,this))},onAfterRender:function(t){this.getApplication().getController("Viewport").getView("Viewport").hlayout.on("layout:resizedrag",_.bind((function(){t&&t.updateScrolls()}),this))},setMode:function(t){return this.mode=t,this.currentUserId=t.user.id,this.api&&(this.mode.canCoAuthoring&&this.mode.canChat&&this.api.asc_registerCallback("asc_onCoAuthoringChatReceiveMessage",_.bind(this.onReceiveMessage,this)),this.mode.isEditDiagram||this.mode.isEditMailMerge||this.mode.isEditOle||(Common.NotificationCenter.on("mentions:setusers",_.bind(this.avatarsUpdate,this)),this.api.asc_registerCallback("asc_onAuthParticipantsChanged",_.bind(this.onUsersChanged,this)),this.api.asc_registerCallback("asc_onConnectionStateChanged",_.bind(this.onUserConnection,this)),this.api.asc_coAuthoringGetUsers()),this.mode.canCoAuthoring&&this.mode.canChat&&this.api.asc_coAuthoringChatGetMessages()),this},setApi:function(t){return this.api=t,this},onUsersChanged:function(t,e){if(!this.mode.canLicense||!this.mode.canCoAuthoring){var i=0;for(n in t)void 0!==n&&i++;if(i>1&&null==this._isCoAuthoringStopped)return this._isCoAuthoringStopped=!0,this.api.asc_coAuthoringDisconnect(),void Common.NotificationCenter.trigger("api:disconnect")}var o=this.getApplication().getCollection("Common.Collections.Users");if(o){var n,s,a=[],r=[];for(n in t)if(void 0!==n&&(s=t[n])){var l=Common.UI.ExternalUsers.getImage(s.asc_getIdOriginal()),c=new Common.Models.User({id:s.asc_getId(),idOriginal:s.asc_getIdOriginal(),username:s.asc_getUserName(),parsedName:AscCommon.UserInfoParser.getParsedName(s.asc_getUserName()),initials:Common.Utils.getUserInitials(AscCommon.UserInfoParser.getParsedName(s.asc_getUserName())),online:!0,color:s.asc_getColor(),avatar:l,view:s.asc_getView(),hidden:!(s.asc_getIdOriginal()===this.currentUserId||AscCommon.UserInfoParser.isUserVisible(s.asc_getUserName()))});a[s.asc_getId()==e?"unshift":"push"](c),void 0===l&&r.push(s.asc_getIdOriginal())}o.reset(a),r.length&&Common.UI.ExternalUsers.get("info",r)}},onUserConnection:function(t){var e=this.getApplication().getCollection("Common.Collections.Users");if(e){var i=e.findUser(t.asc_getId()),o=Common.UI.ExternalUsers.getImage(t.asc_getIdOriginal());i?(i.set({online:t.asc_getState()}),i.set({username:t.asc_getUserName()}),i.set({parsedName:AscCommon.UserInfoParser.getParsedName(t.asc_getUserName())}),i.set({initials:Common.Utils.getUserInitials(t.asc_getUserName())}),i.set({avatar:o})):e.add(new Common.Models.User({id:t.asc_getId(),idOriginal:t.asc_getIdOriginal(),username:t.asc_getUserName(),parsedName:AscCommon.UserInfoParser.getParsedName(t.asc_getUserName()),initials:Common.Utils.getUserInitials(AscCommon.UserInfoParser.getParsedName(t.asc_getUserName())),online:t.asc_getState(),color:t.asc_getColor(),avatar:o,view:t.asc_getView(),hidden:!(t.asc_getIdOriginal()===this.currentUserId||AscCommon.UserInfoParser.isUserVisible(t.asc_getUserName()))})),void 0===o&&Common.UI.ExternalUsers.get("info",[t.asc_getIdOriginal()])}},avatarsUpdate:function(t,e){if("info"===t){var i=this.getApplication().getCollection("Common.Collections.Users"),o=this.getApplication().getCollection("Common.Collections.ChatMessages"),n=!1;e&&e.length>0&&_.each(e,(function(t){i&&i.findOriginalUsers(t.id).forEach((function(e){e.set({avatar:t.image})})),o&&o.where({userid:t.id}).forEach((function(e){void 0!==t.image&&t.image!==e.get("avatar")&&(n=!0,e.set("avatar",t.image,{silent:!0}))}))})),n&&this.panelChat&&this.panelChat.renderMessages()}},onReceiveMessage:function(t,e){var i=this.getApplication().getCollection("Common.Collections.ChatMessages");if(i){var o=[];t.forEach((function(t){o.push(new Common.Models.ChatMessage({userid:t.useridoriginal,message:t.message,username:t.username,parsedName:AscCommon.UserInfoParser.getParsedName(t.username)}))})),i[i.size()<1||e?"reset":"add"](o)}},onSendMessage:function(t,e){if(e.length>0){var i=this;(function(t,e){for(var i=[];t;){if(t.length<e){i.push(t);break}i.push(t.substr(0,e)),t=t.substr(e)}return i})(e,2048).forEach((function(t){i.api.asc_coAuthoringChatSendMessage(t)}))}},notcriticalErrorTitle:"Warning"},Common.Controllers.Chat||{}))})),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/Plugin",["underscore","backbone","common/main/lib/component/BaseView"],(function(t,e){"use strict";Common.Models.PluginVariation=e.Model.extend({defaults:function(){return{description:"",url:"",index:0,icons:void 0,isSystem:!1,isViewer:!1,isDisplayedInViewer:!0,EditorsSupport:["word","cell","slide"],isVisual:!1,isCustomWindow:!1,isModal:!0,isInsideMode:!1,isCanDocked:!1,initDataType:0,initData:"",isUpdateOleOnResize:!1,buttons:[],size:[800,600],initOnSelectionChanged:!1,visible:!0}}}),Common.Models.Plugin=e.Model.extend({defaults:function(){return{id:Common.UI.getId(),name:"",baseUrl:"",guid:Common.UI.getId(),variations:[],currentVariation:0,pluginObj:void 0,allowSelected:!1,selected:!1,visible:!0,groupName:"",groupRank:0}}})})),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/Plugins",["underscore","backbone","common/main/lib/model/Plugin"],(function(t,e){"use strict";Common.Collections.Plugins=e.Collection.extend({model:Common.Models.Plugin,hasVisible:function(){return!!this.findWhere({visible:!0})}})})),void 0===Common)var Common={};if(define("common/main/lib/component/Switcher",["common/main/lib/component/BaseView","underscore"],(function(t,e){"use strict";Common.UI.Switcher=Common.UI.BaseView.extend({options:{hint:!1,width:30,thumbWidth:12,value:!1},disabled:!1,template:e.template(['<div class="switcher">','<div class="thumb"></div>',"</div>"].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var e=this;e.hint=e.options.hint,e.width=e.options.width,e.thumbWidth=e.options.thumbWidth,e.delta=(e.width-e.thumbWidth-2)/2,e.disabled=e.options.disabled,e.options.el&&e.render(),this.setValue(e.options.value)},render:function(t){var e=this;e.rendered?this.cmpEl=this.$el:(this.cmpEl=$(this.template({})),t?(this.setElement(t,!1),t.html(this.cmpEl)):this.$el.html(this.cmpEl),this.options.hint&&(this.cmpEl.attr("data-toggle","tooltip"),this.cmpEl.tooltip({title:"string"==typeof this.options.hint?this.options.hint:this.options.hint[0],placement:this.options.hintAnchor||"cursor"}))),this.thumb=this.cmpEl.find(".thumb"),this.cmpEl.width(e.width),this.thumb.width(e.thumbWidth);var i=function(t){if(!e.disabled){t.preventDefault(),t.stopPropagation(),$(document).off("mouseup.switcher",i),$(document).off("mousemove.switcher",o);var n=Math.round(t.pageX*Common.Utils.zoom()-e._dragstart);e.value=e.value?n>-e.delta:n>e.delta,e.cmpEl.toggleClass("on",e.value),e.thumb.css({left:"",right:""}),e.lastValue!==e.value&&e.trigger("change",e,e.value),e._dragstart=void 0}},o=function(t){if(!e.disabled&&void 0!==e._dragstart){t.preventDefault(),t.stopPropagation();var i=Math.round(t.pageX*Common.Utils.zoom()-e._dragstart);e.value?e.thumb.css({right:i<1?Math.min(e.width-e.thumbWidth-4,-i):0,left:"auto"}):e.thumb.css({left:i>-1?Math.min(e.width-e.thumbWidth-4,i):0,right:"auto"}),e._isMouseMove||(e._isMouseMove=Math.abs(i)>0)}};if(!e.rendered){var n=e.cmpEl;n.on("mousedown",".thumb",(function(t){e.disabled||(e._dragstart=t.pageX*Common.Utils.zoom(),e._isMouseMove=!1,e.lastValue=e.value,$(document).on("mouseup.switcher",i),$(document).on("mousemove.switcher",o))})),n.on("click",(function(t){if(e.disabled||e._isMouseMove)e._isMouseMove=!1;else{if(e.options.hint){var i=e.cmpEl.data("bs.tooltip");i&&(void 0===i.dontShow&&(i.dontShow=!0),i.hide())}e.value=!e.value,e.cmpEl.toggleClass("on",e.value),e.trigger("change",e,e.value)}}))}return e.disabled&&e.setDisabled(!(e.disabled=!1)),e.rendered=!0,this},setThumbPosition:function(t){var e=this.value?t<-this.delta:t>this.delta;this.thumb.css(e?{right:0,left:"auto"}:{left:0,right:"auto"})},setValue:function(t){this.value=!0===t,this.cmpEl.toggleClass("on",this.value)},getValue:function(){return this.value},setDisabled:function(t){if(t!==this.disabled){if((t||!Common.Utils.isGecko)&&this.options.hint){var e=this.cmpEl.data("bs.tooltip");e&&(t&&e.hide(),!Common.Utils.isGecko&&(e.enabled=!t))}this.cmpEl.toggleClass("disabled",t)}this.disabled=t},isDisabled:function(){return this.disabled},updateHint:function(t,e){if(this.options.hint=t,this.rendered&&(this.cmpEl.data("bs.tooltip")&&this.cmpEl.removeData("bs.tooltip"),this.cmpEl.tooltip({html:!!e,title:"string"==typeof t?t:t[0],placement:this.options.hintAnchor||"cursor"}),this.disabled||!Common.Utils.isGecko)){var i=this.cmpEl.data("bs.tooltip");i&&(this.disabled&&i.hide(),!Common.Utils.isGecko&&(i.enabled=!this.disabled))}}})})),define("common/main/lib/controller/Plugins",["core","common/main/lib/collection/Plugins","common/main/lib/view/Plugins","common/main/lib/component/Switcher"],(function(){"use strict";Common.Controllers.Plugins=Backbone.Controller.extend(_.extend({models:[],appOptions:{},configPlugins:{autostart:[]},serverPlugins:{autostart:[]},collections:["Common.Collections.Plugins"],views:["Common.Views.Plugins"],initialize:function(){var t=this;this.addListeners({Toolbar:{"render:before":function(e){var i=t.getApplication().getController("Main").appOptions;if(!i.isEditMailMerge&&!i.isEditDiagram&&!i.isEditOle){var o={action:"plugins",caption:t.viewPlugins.groupCaption,dataHintTitle:"E",layoutname:"toolbar-plugins"};t.$toolbarPanelPlugins=t.viewPlugins.getPanel(),t.toolbar=e,e.addTab(o,t.$toolbarPanelPlugins,Common.UI.LayoutManager.lastTabIdx)}},"tab:active":this.onActiveTab},"Common.Views.Plugins":{"plugin:select":function(e,i,o,n){!this.viewPlugins.pluginPanels[e]||this.viewPlugins.pluginPanels[e]&&i>0?!o||i>0?t.api.asc_pluginRun(e,i,""):t.api.asc_pluginStop(e):n?t.onToolClose(this.viewPlugins.pluginPanels[e]):t.openUIPlugin(e)}},LeftMenu:{"plugins:showpanel":function(e){t.viewPlugins.showPluginPanel(!0,e)},"plugins:hidepanel":function(e){t.viewPlugins.showPluginPanel(!1,e)}},RightMenu:{"plugins:showpanel":function(e){t.viewPlugins.showPluginPanel(!0,e)},"plugins:hidepanel":function(e){t.viewPlugins.showPluginPanel(!1,e)}}})},onLaunch:function(){var t=this.getApplication().getCollection("Common.Collections.Plugins");this.viewPlugins=this.createView("Common.Views.Plugins",{storePlugins:t}),t.on({add:this.onAddPlugin.bind(this),reset:this.onResetPlugins.bind(this)}),this.autostart=[],this.pluginsWinToShow=[],this.startOnPostLoad=!1,this.customPluginsDlg=[],this.newInstalledBackgroundPlugins=[],this.customButtonsArr=[],Common.Gateway.on("init",this.loadConfig.bind(this)),Common.NotificationCenter.on("app:face",this.onAppShowed.bind(this)),Common.NotificationCenter.on("uitheme:changed",this.updatePluginsButtons.bind(this)),Common.NotificationCenter.on("window:resize",this.updatePluginsButtons.bind(this)),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),Common.NotificationCenter.on("doc:mode-changed",this.onChangeDocMode.bind(this)),Common.NotificationCenter.on("modal:close",this.onModalClose.bind(this)),Common.NotificationCenter.on("script:loaded",this.onPostLoadComplete.bind(this))},loadConfig:function(t){var e=this;e.configPlugins.config=t.config.plugins,e.editor=window.PDFE?"pdf":window.DE?"word":window.PE?"slide":window.VE?"diagram":"cell",e.isPDFEditor=!!window.PDFE},loadPlugins:function(){if(this.configPlugins.plugins=this.serverPlugins.plugins=void 0,this.configPlugins.config?(this.getPlugins(this.configPlugins.config.pluginsData).then((function(e){t.configPlugins.plugins=e,t.mergePlugins()})).catch((function(e){t.configPlugins.plugins=!1})),this.configPlugins.config.options&&this.api.setPluginsOptions(this.configPlugins.config.options)):this.configPlugins.plugins=!1,!Common.Controllers.Desktop.isActive()||!Common.Controllers.Desktop.isOffline()){var t=this;Common.Utils.loadConfig("../../../../plugins.json",(function(e){"error"!=e?(t.serverPlugins.config=e,t.getPlugins(t.serverPlugins.config.pluginsData).then((function(e){t.serverPlugins.plugins=e,t.mergePlugins()})).catch((function(e){t.serverPlugins.plugins=!1}))):t.serverPlugins.plugins=!1}))}},onAppShowed:function(t){},onAppReady:function(t){var e=this;new Promise((function(t,e){t()})).then((function(){e.onChangeProtectDocument(),Common.NotificationCenter.on("protect:doclock",_.bind(e.onChangeProtectDocument,e))}))},setApi:function(t){return this.api=t,this.appOptions.customization&&!1===this.appOptions.customization.plugins||(this.api.asc_registerCallback("asc_onPluginShow",_.bind(this.onPluginShow,this)),this.api.asc_registerCallback("asc_onPluginClose",_.bind(this.onPluginClose,this)),this.api.asc_registerCallback("asc_onPluginResize",_.bind(this.onPluginResize,this)),this.api.asc_registerCallback("asc_onPluginsReset",_.bind(this.resetPluginsList,this)),this.api.asc_registerCallback("asc_onPluginsInit",_.bind(this.onPluginsInit,this)),this.api.asc_registerCallback("asc_onPluginShowButton",_.bind(this.onPluginShowButton,this)),this.api.asc_registerCallback("asc_onPluginHideButton",_.bind(this.onPluginHideButton,this)),this.api.asc_registerCallback("asc_onPluginWindowShow",_.bind(this.onApiPluginWindowShow,this)),this.api.asc_registerCallback("asc_onPluginWindowClose",_.bind(this.onPluginWindowClose,this)),this.api.asc_registerCallback("asc_onPluginWindowResize",_.bind(this.onPluginWindowResize,this)),this.api.asc_registerCallback("asc_onPluginWindowActivate",_.bind(this.openUIPlugin,this)),this.loadPlugins()),this},setMode:function(t,e){return this.appOptions=t,this.api=e,this.customPluginsComplete=!this.appOptions.canBrandingExt,this.appOptions.canBrandingExt&&this.getAppCustomPlugins(this.configPlugins),this},onAfterRender:function(t,e,i){var o=this;i&&this.openUIPlugin(e),t.pluginClose.on("click",_.bind(this.onToolClose,this,t)),t.pluginHide&&t.pluginHide.on("click",_.bind(this.onToolHide,this,t)),Common.NotificationCenter.on({"layout:resizestart":function(e){t&&(t.enablePointerEvents&&t.enablePointerEvents(!1),o.api.asc_pluginEnableMouseEvents(!0))},"layout:resizestop":function(e){t&&(t.enablePointerEvents&&t.enablePointerEvents(!0),o.api.asc_pluginEnableMouseEvents(!1))}})},refreshPluginsList:function(){var t=this.getApplication().getCollection("Common.Collections.Plugins"),e=[];t.each((function(t){var i=new Asc.CPlugin;i.deserialize(t.get("original")),t.set("pluginObj",i),e.push(i)})),this.api.asc_pluginsRegister("",e),t.hasVisible()&&Common.NotificationCenter.trigger("tab:visible","plugins",Common.UI.LayoutManager.isElementVisible("toolbar-plugins")),Common.Gateway.pluginsReady()},onAddPlugin:function(t){var e=this;if(e.$toolbarPanelPlugins){var i=e.viewPlugins.createPluginButton(t);if(!i)return;var o=$("> .group",e.$toolbarPanelPlugins),n=$('<span class="btn-slot text x-huge"></span>').appendTo(o);i.render(n);var s=e.viewPlugins._state.docProtection;Common.Utils.lockControls(Common.enumLock.docLockView,s.isReadOnly,{array:i}),Common.Utils.lockControls(Common.enumLock.docLockForms,s.isFormsOnly,{array:i}),Common.Utils.lockControls(Common.enumLock.docLockComments,s.isCommentsOnly,{array:i})}},addBackgroundPluginsButton:function(t){t.appendTo(this.$toolbarPanelPlugins),t=$('<div class="group" style="'+(Common.UI.isRTL()?"padding-right: 0;":"padding-left: 0;")+'"></div>'),this.viewPlugins.backgroundBtn=this.viewPlugins.createBackgroundPluginsButton();var e=$('<span class="btn-slot text x-huge"></span>').appendTo(t);return this.viewPlugins.backgroundBtn.render(e),this.viewPlugins.backgroundBtn.hide(),t},turnOffBackgroundPlugin:function(t){var e;if(this.backgroundPluginsSwitchers)return this.backgroundPluginsSwitchers.forEach((function(i){i.options.pluginGuid===t&&(e=i)})),!!e&&(e.updateHint(this.viewPlugins.textStart),e.setValue(!1),!0)},onShowBeforeBackgroundPlugins:function(t){var e=this;e.clickInsideMenu=!1;var i=function(){for(var e=t.cmpEl.find(".dropdown-toggle.active"),i=0;i<e.length;i++){var o=e[i];$(o).parent().toggleClass("open",!1),$(o).trigger($.Event("hide.bs.dropdown"))}};this.backgroundPluginsSwitchers=[];var o=this.api.getUsedBackgroundPlugins();this.backgroundPlugins.forEach((function(n){var s=n.get("variations"),a=s[n.get("currentVariation")].get("icons"),r=e.viewPlugins.parseIcons(a),l=n.get("baseUrl")+r.normal,c=n.get("guid"),h=-1!==_.indexOf(o,c);n.set("parsedIcons",r);var d=new Common.UI.MenuItem({value:c,caption:n.get("name"),iconImg:l,template:_.template(['<div id="<%= id %>" class="menu-item" <% if(!_.isUndefined(options.stopPropagation)) { %> data-stopPropagation="true" <% } %> >','<img class="menu-item-icon" src="<%= options.iconImg %>">','<div class="plugin-caption"><%= caption %></div>','<div class="plugin-tools">','<div class="plugin-toggle"></div>','<div class="plugin-settings"></div>',"</span>","</a>"].join("")),stopPropagation:!0});t.addItem(d),n.set("backgroundPlugin",d);var m=new Common.UI.Switcher({el:d.$el.find(".plugin-toggle")[0],value:!!n.isSystem||h,disabled:!!n.isSystem,pluginGuid:c,hint:h?e.viewPlugins.textStop:e.viewPlugins.textStart});m.on("change",(function(t,i){m.updateHint(i?e.viewPlugins.textStop:e.viewPlugins.textStart),e.viewPlugins.fireEvent("plugin:select",[m.options.pluginGuid,0,!i])})),e.backgroundPluginsSwitchers.push(m);var p=[];if(_.each(s,(function(t,e){e>0&&t.get("visible")&&p.push({caption:t.get("description"),value:parseInt(t.get("index"))})})),p.length>0){var u=new Common.UI.Button({parentEl:d.$el.find(".plugin-settings"),cls:"btn-toolbar",iconCls:"menu__icon btn-more",menu:new Common.UI.Menu({menuAlign:"tl-bl",items:p,pluginGuid:c}),onlyIcon:!0,stopPropagation:!0,hint:e.viewPlugins.textSettings});u.menu.on("item:click",(function(t,i,o){Common.UI.Menu.Manager.hideAll(),e.viewPlugins.fireEvent("plugin:select",[t.options.pluginGuid,i.value,!1]),e.clickInsideMenu=!1})),u.menu.on("keydown:before",(function(t,e){e.keyCode==Common.UI.Keys.ESC&&(i(),_.delay((function(){u.cmpEl.closest(".btn-group.open").find("[data-toggle=dropdown]:first").focus()}),10))})),u.menu.cmpEl.find("li").on("mousedown",(function(){e.clickInsideMenu=!0})),u.cmpEl.on("mousedown",(function(){e.clickInsideMenu=!0})),u.on("click",(function(){var t=u.$el.find(".btn-group"),o=t.hasClass("open");o||i(),t.toggleClass("open",!o),$(u.menu.el).trigger($.Event(o?"hide.bs.dropdown":"show.bs.dropdown")),e.clickInsideMenu=!1}))}})),t.cmpEl.find("li").on("mousedown",(function(){e.clickInsideMenu||i()}))},onResetPlugins:function(t){var e=this;if(e.customButtonsArr.forEach((function(t){e.toolbar&&e.toolbar.addCustomControls({action:t.tab},void 0,[t.btn])})),e.customButtonsArr=[],e.appOptions.canPlugins=!t.isEmpty(),e.$toolbarPanelPlugins){e.backgroundPlugins=[],e.$toolbarPanelPlugins.empty(),e.toolbar&&e.toolbar.clearMoreButton("plugins");var i=$('<div class="group"></div>'),o=-1,n=0,s=!1;if(t.each((function(t){var a=t.get("groupRank");if(t.get("isBackgroundPlugin"))e.backgroundPlugins.push(t);else if(t.get("tab")){var r=t.get("tab"),l=e.viewPlugins.createPluginButton(t);l&&(l.options.separator=r.separator,e.toolbar&&e.toolbar.addCustomControls(r,[l]),e.customButtonsArr.push({tab:r.action,btn:l}))}else{0!==a&&2!==a||s||(i=e.addBackgroundPluginsButton(i),s=!0,o=1.5,n++);var c=e.viewPlugins.createPluginButton(t);if(c){a!==o&&o>-1&&n>0?(i.appendTo(e.$toolbarPanelPlugins),$('<div class="separator long"></div>').appendTo(e.$toolbarPanelPlugins),i=$('<div class="group"></div>'),n=0):n>0&&(i.appendTo(e.$toolbarPanelPlugins),$('<div class="separator long invisible"></div>').appendTo(e.$toolbarPanelPlugins),i=$('<div class="group" style="'+(Common.UI.isRTL()?"padding-right: 0;":"padding-left: 0;")+'"></div>'));var h=$('<span class="btn-slot text x-huge"></span>').appendTo(i);c.render(h),n++,o=a}1!==a||s||(i=e.addBackgroundPluginsButton(i),s=!0)}})),i.appendTo(e.$toolbarPanelPlugins),e.backgroundPlugins.length>0){e.viewPlugins.backgroundBtn.show();var a=function(t){e.onShowBeforeBackgroundPlugins(t),t.off("show:before",a)};e.viewPlugins.backgroundBtn.menu.on("show:before",a),e.viewPlugins.backgroundBtn.on("click",(function(){e.closeBackPluginsTip()}))}e.toolbar&&e.toolbar.isTabActive("plugins")&&e.toolbar.processPanelVisible(null,!0);var r=e.viewPlugins._state.docProtection;Common.Utils.lockControls(Common.enumLock.docLockView,r.isReadOnly,{array:e.viewPlugins.lockedControls}),Common.Utils.lockControls(Common.enumLock.docLockForms,r.isFormsOnly,{array:e.viewPlugins.lockedControls}),Common.Utils.lockControls(Common.enumLock.docLockComments,r.isCommentsOnly,{array:e.viewPlugins.lockedControls})}else console.error("toolbar panel isnot created")},updatePluginsButtons:function(){var t=this.getApplication().getCollection("Common.Collections.Plugins"),e=this,i=[],o=[];for(var n in t.each((function(t){e.viewPlugins.updatePluginIcons(t);var n=t.get("guid");e.viewPlugins.pluginPanels[n]&&t.get("parsedIcons")&&("right"===e.viewPlugins.pluginPanels[n].menu?o:i).push({guid:n,baseUrl:t.get("baseUrl"),parsedIcons:t.get("parsedIcons")})})),this.viewPlugins.customPluginPanels){var s=this.viewPlugins.customPluginPanels[n];if(s.icons)("right"===s.menu?o:i).push({guid:s.frameId,baseUrl:s.baseUrl,parsedIcons:this.viewPlugins.parseIcons(s.icons)})}i.length>0&&e.viewPlugins.fireEvent("pluginsleft:updateicons",[i]),o.length>0&&e.viewPlugins.fireEvent("pluginsright:updateicons",[o])},onSelectPlugin:function(t,e,i,o){var n=$(o.target);if(n&&n.hasClass("plugin-caret")){var s=this.viewPlugins.pluginMenu;if(s.isVisible())return void s.hide();var a,r=this,l=$(o.currentTarget),c=$(this.viewPlugins.el),h=l.offset(),d=c.offset();if(a=[h.left-d.left+l.width(),h.top-d.top+l.height()/2],null!=i){for(var m=0;m<s.items.length;m++)s.removeItem(s.items[m]),m--;s.removeAll();var p=i.get("variations");for(m=0;m<p.length;m++){var u=p[m],g=new Common.UI.MenuItem({caption:m>0?u.get("description"):r.viewPlugins.textStart,value:parseInt(u.get("index"))}).on("click",(function(t,e){r.api&&r.api.asc_pluginRun(i.get("guid"),t.value,"")}));s.addItem(g)}}var f=c.find("#menu-plugin-container");s.rendered||(f.length<1&&(f=$('<div id="menu-plugin-container" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>',s.id),c.append(f)),s.render(f),s.cmpEl.attr({tabindex:"-1"}),s.on({"show:after":function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!0)},"hide:after":function(t){t&&t.menuAlignEl&&t.menuAlignEl.toggleClass("over",!1)}})),f.css({left:a[0],top:a[1]}),s.menuAlignEl=l,s.setOffset(-20,-l.height()/2-3),s.show(),_.delay((function(){s.cmpEl.focus()}),10),o.stopPropagation(),o.preventDefault()}else this.api.asc_pluginRun(i.get("guid"),0,"")},addPluginToSideMenu:function(t,e,i,o,n,s){var a,r=t.get_Guid(),l=this.viewPlugins.storePlugins.findWhere({guid:r}),c=function(t){for(var e=t.toLowerCase().replace(/[^a-z0-9\-_:]/g,"-"),i=e,o=0;!($("#panel-plugins-"+i).length<1);)i=e+"-"+ ++o;return i}(t.get_Name("en")),h=l.get("variations")[l.get("currentVariation")].get("icons");l.set({menu:o}),h||(a="icon toolbar__icon btn-plugin-panel-default");var d=$('<div id="slot-btn-plugins'+c+'"></div>'),m=new Common.UI.ButtonCustom({cls:"btn-category plugin-buttons",hint:i,enableToggle:!0,toggleGroup:"right"===o?"tabpanelbtnsGroup":"leftMenuGroup",iconCls:a,iconsSet:this.viewPlugins.iconsStr2IconsObj(h),baseUrl:l.get("baseUrl"),onlyIcon:!0,value:r,type:"plugin"});m.render(d);var p=$('<div id="panel-plugins-'+c+'" class="plugin-panel content-box" style="height: 100%;"></div>');this.viewPlugins.fireEvent("right"===o?"plugins:addtoright":"plugins:addtoleft",[m,d,p]),this.viewPlugins.pluginPanels[r]=new Common.Views.PluginPanel({el:"#panel-plugins-"+c,menu:o,sideMenuButton:m,isCanDocked:!!e.get_IsCanDocked&&e.get_IsCanDocked()}),this.viewPlugins.pluginPanels[r].on("render:after",_.bind(this.onAfterRender,this,this.viewPlugins.pluginPanels[r],r,!0)),this.viewPlugins.pluginPanels[r].on("docked",_.bind((function(){this.onPluginClose(t),this.addPluginToWindow(t,e,i,o,n,s),this.savePluginDockedPosition(r,Asc.PluginType.Window)}),this)),this.viewPlugins.pluginPanels[t.get_Guid()].openInsideMode(i,s,n,t.get_Guid())||this.api.asc_pluginButtonClick(-1,t.get_Guid())},addPluginToWindow:function(t,e,i,o,n,s){var a=this,r=function(){var r=e.get_CustomWindow(),l=e.get_Buttons(),c=[],h=e.get_Size(),d=e.get_Modal();(!h||h.length<2)&&(h=[800,600]),_.isArray(l)&&_.each(l,(function(t,e){t.visible&&(c[e]={caption:t.text,value:e,primary:t.primary})}));var m=e.get_Help();a.pluginDlg=new Common.Views.PluginDlg({guid:t.get_Guid(),cls:r?"plain":"",header:!r,title:Common.Utils.String.htmlEncode(i),width:h[0],height:h[1],url:s,frameId:n,buttons:r?void 0:c,toolcallback:function(e){a.api.asc_pluginButtonClick(-1,t.get_Guid())},help:!!m,loader:t.get_Loader(),modal:void 0===d||d,isCanDocked:!!e.get_IsCanDocked&&e.get_IsCanDocked()}),a.pluginDlg.on({"render:after":function(e){e.getChild(".footer .dlg-btn").on("click",(function(e){a.api.asc_pluginButtonClick(parseInt(e.currentTarget.attributes.result.value),t.get_Guid())})),a.pluginContainer=a.pluginDlg.$window.find("#id-plugin-container")},close:function(t){a.pluginDlg=void 0},drag:function(t){a.api.asc_pluginEnableMouseEvents("start"==t[1]),t[0].enablePointerEvents("start"!==t[1])},resize:function(t){a.api.asc_pluginEnableMouseEvents("start"==t[1]),t[0].enablePointerEvents("start"!==t[1])},help:function(){m&&window.open(m,"_blank")},docked:function(){a.onPluginClose(t),a.addPluginToSideMenu(t,e,i,o,n,s),a.savePluginDockedPosition(t.get_Guid(),Asc.PluginType.Panel)},"header:click":function(e){a.api.asc_pluginButtonClick(e,t.get_Guid())}}),a.pluginDlg.show()};this.pluginDlg?(this.api.asc_pluginButtonClick(-1,this.pluginDlg.guid),setTimeout(r,10)):r()},closePluginInPanel:function(t){var e=this.viewPlugins.pluginPanels[t];if(e&&e.iframePlugin){e.closeInsideMode(t),this.viewPlugins.pluginPanels[t].$el.remove(),delete this.viewPlugins.pluginPanels[t];var i=this.viewPlugins.storePlugins.findWhere({guid:t});return this.viewPlugins.fireEvent("right"===i.get("menu")?"pluginsright:close":"pluginsleft:close",[t]),!0}return!1},savePluginDockedPosition:function(t,e){var i=Common.localStorage.getItem("plugins-docked-position")||"{}";(i=JSON.parse(i))[t]=e,Common.localStorage.setItem("plugins-docked-position",JSON.stringify(i))},getPluginDockedPosition:function(t){var e=Common.localStorage.getItem("plugins-docked-position")||"{}";return(e=JSON.parse(e))[t]},openUIPlugin:function(t){var e=this.viewPlugins.storePlugins.findWhere({guid:t}),i=e?e.get("menu"):this.viewPlugins.customPluginPanels[t]&&this.viewPlugins.customPluginPanels[t].menu;this.viewPlugins.fireEvent("right"===i?"pluginsright:open":"pluginsleft:open",[t])},onPluginShow:function(t,e,i,o){var n=t.get_Variations()[e];if(n.get_Visual()){var s=this.appOptions&&this.appOptions.lang?this.appOptions.lang.split(/[\-_]/)[0]:"en",a=n.get_Url(),r=t.get_Name(s),l=!!n.get_IsCanDocked&&n.get_IsCanDocked(),c=this.getPluginDockedPosition(t.get_Guid()),h=this.isPDFEditor?"left":n.get_Type()===Asc.PluginType.PanelRight?"right":"left",d=n.get_InsideMode();l&&(h=(d=c===Asc.PluginType.Panel||c===Asc.PluginType.PanelRight)?c===Asc.PluginType.PanelRight?"right":"left":h),!h&&(h="left"),a=(0==t.get_BaseUrl().length?a:t.get_BaseUrl())+a,o&&(a+=o),d?this.addPluginToSideMenu(t,n,r,h,i,a):this.addPluginToWindow(t,n,r,h,i,a),this.viewPlugins.openedPluginMode(t.get_Guid(),d)}else this.viewPlugins.openedPluginMode(t.get_Guid(),n.get_InsideMode())},onPluginClose:function(t){var e=!1,i=t.get_Guid();this.pluginDlg&&this.pluginDlg.guid===i?this.pluginDlg.close():this.closePluginInPanel(i)&&(e=!0);!this.turnOffBackgroundPlugin(i)&&this.viewPlugins.closedPluginMode(i,e),this.runAutoStartPlugins(),Common.UI.LayoutManager.clearCustomMenuItems(i),Common.UI.LayoutManager.clearCustomControls(i)},onPluginResize:function(t,e,i,o){if(this.pluginDlg){var n=e&&e.length>1&&i&&i.length>1&&(i[0]>e[0]||i[1]>e[1]||0==i[0]||0==i[1]);this.pluginDlg.setResizable(n,e,i),this.pluginDlg.setInnerSize(t[0],t[1]),o&&o.call()}},onToolClose:function(t){this.api.asc_pluginButtonClick(-1,t&&t._state.insidePlugin,t&&t.frameId)},onToolHide:function(t){t&&t.sideMenuButton&&t.sideMenuButton.click()},onPluginsInit:function(t,e){!(t instanceof Array)&&(t=t.pluginsData),this.parsePlugins(t,!1,!0,e)},onPluginShowButton:function(t,e){this.pluginDlg&&this.pluginDlg.showButton(t,e)},onPluginHideButton:function(t){this.pluginDlg&&this.pluginDlg.hideButton(t)},runAutoStartPlugins:function(){this.autostart&&this.autostart.length>0&&this.api.asc_pluginRun(this.autostart.shift(),0,"")},resetPluginsList:function(){this.getApplication().getCollection("Common.Collections.Plugins").reset()},applyUICustomization:function applyUICustomization(){var me=this;return new Promise((function(resolve,reject){var timer_sl=setInterval((function(){if(me.customPluginsComplete){clearInterval(timer_sl);try{me.configPlugins.UIplugins&&me.configPlugins.UIplugins.forEach((function(c){c.code&&eval(c.code)}))}catch(t){}resolve()}}),10)}))},parsePlugins:function(t,e,i,o){this.closeBackPluginsTip();var n=this,s=this.getApplication().getCollection("Common.Collections.Plugins"),a=n.appOptions.isEdit,r=n.editor,l=n.api?n.api.GetVersion():void 0;if(t instanceof Array){var c=[],h=[],d=n.appOptions.lang.split(/[\-_]/)[0];t.forEach((function(t){var e;if(i)!(e=c.find((function(e){return e.get("baseUrl")==t.baseUrl||e.get("guid")==t.guid})))&&(e=s.findWhere({baseUrl:t.baseUrl})),!e&&(e=s.findWhere({guid:t.guid}));else if(c.some((function(e){return e.get("baseUrl")==t.baseUrl||e.get("guid")==t.guid}))||s.findWhere({baseUrl:t.baseUrl})||s.findWhere({guid:t.guid}))return;var m,p=[],u=!1,g=!1,f=!1;if(t.variations&&t.variations.forEach((function(e,i){var o=Asc.PluginType.getType(e.type);m=!0===e.isSystem||Asc.PluginType.System===o;var n=(a||e.isViewer&&!1!==e.isDisplayedInViewer)&&_.contains(e.EditorsSupport,r)&&!m;if(n&&(u=!0),e.isViewer&&!1!==e.isDisplayedInViewer&&(g=!0),t.isUICustomizer)n&&h.push({url:t.baseUrl+e.url});else{var s=new Common.Models.PluginVariation(e),l=e.description;"object"==_typeof(e.descriptionLocale)&&(l=e.descriptionLocale[d]||e.descriptionLocale.en||l||""),_.each(e.buttons,(function(t,e){"object"==_typeof(t.textLocale)&&(t.text=t.textLocale[d]||t.textLocale.en||t.text||""),t.visible=a||!1!==t.isViewer}));var c="string"==typeof e.icons&&-1!==e.icons.indexOf("%")||!e.icons2?e.icons:e.icons2;c||(c=""),s.set({description:l,index:p.length,url:e.url,icons:c,buttons:e.buttons,visible:n,help:e.help}),p.push(s),0===i&&(f=!!e.type&&o===Asc.PluginType.Background)}})),p.length>0&&!t.isUICustomizer){var b=t.name;if("object"==_typeof(t.nameLocale)&&(b=t.nameLocale[d]||t.nameLocale.en||b||""),u&&(u=n.checkPluginVersion(l,t.minVersion)),"asc.{E6978D28-0441-4BD7-8346-82FAD68BCA3B}"===t.guid)return;var C={name:b,guid:t.guid,baseUrl:t.baseUrl,variations:p,currentVariation:0,visible:u,groupName:t.group?t.group.name:"",groupRank:t.group?t.group.rank:0,minVersion:t.minVersion,original:t,isDisplayedInViewer:g,isBackgroundPlugin:u&&f,isSystem:m,tab:t.tab?{action:t.tab.id,caption:("object"==_typeof(t.tab.text)?t.tab.text[d]||t.tab.text.en:t.tab.text)||"",separator:t.tab.separator}:void 0};e?e.set(C):c.push(new Common.Models.Plugin(C)),o&&!e&&C.isBackgroundPlugin&&n.newInstalledBackgroundPlugins.push({name:b,guid:t.guid})}})),!1!==e&&(n.configPlugins.UIplugins=h),!e&&s&&((c=s.models.concat(c)).sort((function(t,e){var i=t.get("groupRank"),o=e.get("groupRank");return i<o?0==i?1:-1:i>o?0==o?-1:1:0})),s.reset(c),this.appOptions.canPlugins=!s.isEmpty(),n.newInstalledBackgroundPlugins=_.filter(n.newInstalledBackgroundPlugins,(function(t){return!!s.findWhere({guid:t.guid})})))}else e||(this.appOptions.canPlugins=!1);e||this.getApplication().getController("LeftMenu").enablePlugins(),this.appOptions.canPlugins&&(this.refreshPluginsList(),this.startOnPostLoad=!Common.Controllers.LaunchController.isScriptLoaded(),!this.startOnPostLoad&&this.runAutoStartPlugins())},checkPluginVersion:function(t,e){if(t&&"develop"!==t&&e&&"string"==typeof e){var i=e.match(/^([0-9]+)(?:.([0-9]+))?(?:.([0-9]+))?$/),o=t.match(/^([0-9]+)(?:.([0-9]+))?(?:.([0-9]+))?$/);if(i&&i.length>1&&o&&o.length>1)for(var n=0;n<3;n++){var s=i[n+1]?parseInt(i[n+1]):0,a=o[n+1]?parseInt(o[n+1]):0;if(s>a)return!1;if(s<a)return!0}}return!0},getPlugins:function(t,e){if(!t||t.length<1)return Promise.resolve([]);e=e||function(t){return fetch(t).then((function(e){return e.ok?e.json():Promise.reject(t)})).then((function(e){return e.baseUrl=t.substring(0,t.lastIndexOf("config.json")),e}))};var i=[];return t.map(e).reduce((function(t,e){return t.then((function(){return e})).then((function(t){return i.push(t),Promise.resolve(t)})).catch((function(t){return Promise.resolve(t)}))}),Promise.resolve()).then((function(){return Promise.resolve(i)}))},mergePlugins:function(){if(void 0!==this.serverPlugins.plugins&&void 0!==this.configPlugins.plugins){var t=[],e=[],i=this.configPlugins,o=!1;if(i.plugins&&i.plugins.length>0&&(e=i.plugins),i&&i.config){var n=i.config.autostart||i.config.autoStartGuid;"string"==typeof n&&(n=[n]),o=!!i.config.autoStartGuid,t=n||[]}(i=this.serverPlugins).plugins&&i.plugins.length>0&&(e=e.concat(i.plugins)),i&&i.config&&("string"==typeof(n=i.config.autostart||i.config.autoStartGuid)&&(n=[n]),(o||i.config.autoStartGuid)&&console.warn("Obsolete: The autoStartGuid parameter is deprecated. Please check the documentation for new plugin connection configuration."),t=t.concat(n||[])),this.autostart=t,this.parsePlugins(e,!1)}},getAppCustomPlugins:function(t){var e=this,i=function(){e.customPluginsComplete=!0};t.config?this.getPlugins(t.config.UIpluginsData).then((function(o){e.parsePlugins(o,!0),e.getPlugins(t.UIplugins,(function(t){return fetch(t.url).then((function(t){return t.ok?t.text():Promise.reject()})).then((function(e){return t.code=e,e}))})).then(i,i)}),i):i()},onChangeProtectDocument:function(t){if(!t){var e=this.getApplication().getController("DocProtection");t=e?e.getDocProps():null}t&&this.viewPlugins&&(this.viewPlugins._state.docProtection=t,Common.Utils.lockControls(Common.enumLock.docLockView,t.isReadOnly,{array:this.viewPlugins.lockedControls}),Common.Utils.lockControls(Common.enumLock.docLockForms,t.isFormsOnly,{array:this.viewPlugins.lockedControls}),Common.Utils.lockControls(Common.enumLock.docLockComments,t.isCommentsOnly,{array:this.viewPlugins.lockedControls}))},onChangeDocMode:function(t){"view"===t&&this.pluginDlg&&this.api.asc_pluginButtonClick(-1,this.pluginDlg.guid)},onPluginWindowShow:function(t,e,i){var o=this,n=e.isCustomWindow,s=e.buttons,a=[],r=e.size,l=e.isModal,c=Asc.PluginType.getType(e.type),h=c===Asc.PluginType.Panel||c===Asc.PluginType.PanelRight;(!r||r.length<2)&&(r=[800,600]);var d=e.description;"object"==_typeof(e.descriptionLocale)&&(d=e.descriptionLocale[i]||e.descriptionLocale.en||d||""),_.isArray(s)&&_.each(s,(function(e,n){"object"==_typeof(e.textLocale)&&(e.text=e.textLocale[i]||e.textLocale.en||e.text||""),(o.appOptions.isEdit||!1!==e.isViewer)&&(a[n]={caption:e.text,value:n,primary:e.primary,frameId:t})}));var m=e.help;o.customPluginsDlg[t]=new Common.Views.PluginDlg({cls:n?"plain":"",header:!n,title:d,width:r[0],height:r[1],url:e.url,frameId:t,buttons:n?void 0:a,toolcallback:function(i){o.api.asc_pluginButtonClick(-1,e.guid,t)},help:!!m,isCanDocked:e.isCanDocked,modal:void 0===l||l}),o.customPluginsDlg[t].on({"render:after":function(i){i.getChild(".footer .dlg-btn").on("click",(function(i){o.api.asc_pluginButtonClick(parseInt(i.currentTarget.attributes.result.value),e.guid,t)})),o.customPluginsDlg[t].options.pluginContainer=o.customPluginsDlg[t].$window.find("#id-plugin-container")},close:function(e){o.customPluginsDlg[t]=void 0},drag:function(e){o.api.asc_pluginEnableMouseEvents("start"==e[1],t),e[0].enablePointerEvents("start"!==e[1])},resize:function(e){o.api.asc_pluginEnableMouseEvents("start"==e[1],t),e[0].enablePointerEvents("start"!==e[1])},help:function(){m&&window.open(m,"_blank")},docked:function(t){o.api.asc_pluginButtonDockChanged(h?e.type:"panel",e.guid,t,(function(){setTimeout((function(){o.customPluginsDlg[t].close(),o.onPluginPanelShow(t,e,i)}),0)}))},"header:click":function(i){o.api.asc_pluginButtonClick(i,e.guid,t)}}),o.customPluginsDlg[t].show()},onApiPluginWindowShow:function(t,e){if(Common.Controllers.LaunchController.isScriptLoaded()){if(e.isVisual){if(this.customPluginsDlg[t]||this.viewPlugins.customPluginPanels[t])return;var i=this.appOptions&&this.appOptions.lang?this.appOptions.lang.split(/[\-_]/)[0]:"en",o=Asc.PluginType.getType(e.type),n=!0===e.isSystem||Asc.PluginType.System===o,s=o===Asc.PluginType.Panel||o===Asc.PluginType.PanelRight,a=(this.appOptions.isEdit||e.isViewer&&!1!==e.isDisplayedInViewer)&&_.contains(e.EditorsSupport,this.editor)&&!n;a&&s?this.onPluginPanelShow(t,e,i):a&&!e.isInsideMode&&this.onPluginWindowShow(t,e,i)}if(this.pluginsWinToShow.length>0){var r=this.pluginsWinToShow.shift();r&&this.onApiPluginWindowShow(r.frameId,r.variation)}}else this.pluginsWinToShow.push({frameId:t,variation:e})},onPluginWindowClose:function(t){if(this.pluginsWinToShow.length>0&&(this.pluginsWinToShow=_.reject(this.pluginsWinToShow,(function(e){return e.frameId===t}))),this.customPluginsDlg[t])this.customPluginsDlg[t].close();else if(this.viewPlugins.customPluginPanels[t]){var e=this.viewPlugins.customPluginPanels[t];e&&e.iframePlugin&&(e.closeInsideMode(),e.$el.remove(),delete this.viewPlugins.customPluginPanels[t],this.viewPlugins.fireEvent("right"===e.menu?"pluginsright:close":"pluginsleft:close",[t]))}},onPluginWindowResize:function(t,e,i,o,n){if(this.customPluginsDlg[t]){var s=i&&i.length>1&&o&&o.length>1&&(o[0]>i[0]||o[1]>i[1]||0==o[0]||0==o[1]);this.customPluginsDlg[t].setResizable(s,i,o),this.customPluginsDlg[t].setInnerSize(e[0],e[1])}n&&n.call()},onPluginPanelShow:function(t,e,i){var o=e.guid,n=this.isPDFEditor?"left":"panelRight"==e.type?"right":"left";!n&&(n="left");var s=e.description;"object"==_typeof(e.descriptionLocale)&&(s=e.descriptionLocale[i]||e.descriptionLocale.en||s||"");var a,r=e.baseUrl||"",l=this.viewPlugins.storePlugins.findWhere({guid:o}),c=e.icons,h=!1!==e.isActivated;l&&(""===r&&(r=l.get("baseUrl")),c||(c=l.get("variations")[l.get("currentVariation")].get("icons")));c||(a="icon toolbar__icon btn-plugin-panel-default");var d=$('<div id="slot-btn-plugins-'+t+'"></div>'),m=new Common.UI.ButtonCustom({cls:"btn-category plugin-buttons",hint:s,enableToggle:!0,toggleGroup:"right"===n?"tabpanelbtnsGroup":"leftMenuGroup",iconCls:a,iconsSet:this.viewPlugins.iconsStr2IconsObj(c),baseUrl:r,onlyIcon:!0,value:t,type:"plugin"});m.render(d);var p=$('<div id="panel-plugins-'+t+'" class="plugin-panel content-box" style="height: 100%;"></div>');this.viewPlugins.fireEvent("right"===n?"plugins:addtoright":"plugins:addtoleft",[m,d,p]),this.viewPlugins.customPluginPanels[t]=new Common.Views.PluginPanel({el:"#panel-plugins-"+t,menu:n,frameId:t,baseUrl:r,icons:c,sideMenuButton:m,isCanDocked:e.isCanDocked}),this.viewPlugins.customPluginPanels[t].on("render:after",_.bind(this.onAfterRender,this,this.viewPlugins.customPluginPanels[t],t,h)),this.viewPlugins.customPluginPanels[t].on("docked",_.bind((function(t){var o=this;this.api.asc_pluginButtonDockChanged("window",e.guid,t,(function(){setTimeout(_.bind((function(){o.onPluginWindowClose(t),o.onPluginWindowShow(t,e,i)}),this),0)}))}),this)),this.viewPlugins.customPluginPanels[t].openInsideMode(s,e.url,t,o)||this.api.asc_pluginButtonClick(-1,o,t)},onModalClose:function(){var t=this.newInstalledBackgroundPlugins;if(t&&t.length>0&&this.viewPlugins.backgroundBtn&&this.viewPlugins.backgroundBtn.isVisible()){var e=t.length>1?this.textPluginsSuccessfullyInstalled:Common.Utils.String.format(this.textPluginSuccessfullyInstalled,t[0].name);this.backgroundPluginsTip&&this.backgroundPluginsTip.isVisible()&&this.backgroundPluginsTip.close(),this.backgroundPluginsTip=new Common.UI.SynchronizeTip({extCls:"colored",placement:"bottom",target:this.viewPlugins.backgroundBtn.$el,text:e,showLink:!0,textLink:t.length>1?this.textRunInstalledPlugins:this.textRunPlugin}),this.backgroundPluginsTip.on("dontshowclick",(function(){this.backgroundPluginsTip.close(),this.backgroundPluginsTip=void 0,this.newInstalledBackgroundPlugins.forEach(_.bind((function(t){this.api.asc_pluginRun(t.guid,0,"")}),this)),this.newInstalledBackgroundPlugins.length=0}),this),this.backgroundPluginsTip.on("closeclick",(function(){this.closeBackPluginsTip()}),this),this.backgroundPluginsTip.show()}},onActiveTab:function(t){"plugins"===t||this.closeBackPluginsTip()},closeBackPluginsTip:function(){this.backgroundPluginsTip&&(this.backgroundPluginsTip.close(),this.backgroundPluginsTip=void 0,this.newInstalledBackgroundPlugins&&(this.newInstalledBackgroundPlugins.length=0))},onPostLoadComplete:function(){if(this.pluginsWinToShow.length>0){var t=this.pluginsWinToShow.shift();t&&this.onApiPluginWindowShow(t.frameId,t.variation)}this.startOnPostLoad&&this.runAutoStartPlugins()},textRunPlugin:"Run plugin",textRunInstalledPlugins:"Run installed plugins",textPluginSuccessfullyInstalled:"<b>{0}</b> is successfully installed. You can access all background plugins here.",textPluginsSuccessfullyInstalled:"Plugins are successfully installed. You can access all background plugins here."},Common.Controllers.Plugins||{}))})),void 0===Common)var Common={};if(Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/ExternalOleEditor",["core"],(function(){"use strict";var t,e,i,o,n,s;Common.Controllers.ExternalOleEditor=Backbone.Controller.extend(_.extend((t="en",e=void 0,i="",o=null,n=!0,s=function(){Common.UI.HintManager.setInternalEditorLoading(!0),e&&(e.uiTheme=Common.localStorage.getItem("ui-theme-id","theme-light")),o=new DocsAPI.DocEditor("id-ole-editor-placeholder",{width:"100%",height:"100%",documentType:"cell",document:{url:"_chart_",permissions:{edit:!0,download:!1}},editorConfig:{mode:"editole",targetApp:i,lang:t,canCoAuthoring:!1,canBackToFolder:!1,canCreateNew:!1,customization:e,user:{id:"uid-"+Date.now()}},events:{onAppReady:function(){},onDocumentStateChange:function(){},onError:function(){},onInternalMessage:_.bind(this.onInternalMessage,this)}}),Common.Gateway.on("processmouse",_.bind(this.onProcessMouse,this))},{views:[],initialize:function(){this.addListeners({"Common.Views.ExternalOleEditor":{setoledata:_.bind(this.setOleData,this),drag:_.bind((function(t,e){o&&o.serviceCommand("window:drag","start"==e)}),this),resize:_.bind((function(t,e){o&&o.serviceCommand("window:resize","start"==e)}),this),"animate:before":_.bind((function(){this.isAppFirstOpened||o&&o.serviceCommand("reshow")}),this),show:_.bind((function(t){var e=this.oleEditorView.getHeight(),i=Common.Utils.innerHeight()-Common.Utils.InternalSettings.get("window-inactive-area-top");i<e&&this.oleEditorView.setHeight(i),o?(o.serviceCommand("setAppDisabled",!1),n&&this.oleEditorView._isExternalDocReady&&(n=!1,this.oleEditorView._oleData&&this.setOleData()),this.needDisableEditing&&this.oleEditorView._isExternalDocReady&&this.onOleEditingDisabled(),o.attachMouseEvents()):require(["api"],function(){s.apply(this)}.bind(this)),this.isExternalEditorVisible=!0,this.isHandlerCalled=!1}),this),hide:_.bind((function(t){o&&(o.detachMouseEvents(),this.isExternalEditorVisible=!1),Common.UI.HintManager.setInternalEditorLoading(!1)}),this)}}),Common.NotificationCenter.on("script:loaded",_.bind(this.onPostLoadComplete,this))},onLaunch:function(){},onPostLoadComplete:function(){this.views=this.getApplication().getClasseRefs("view",["Common.Views.ExternalOleEditor"]),this.oleEditorView=this.createView("Common.Views.ExternalOleEditor",{handler:this.handler.bind(this)})},setApi:function(t){return this.api=t,this.api.asc_registerCallback("asc_onCloseOleEditor",_.bind(this.onOleEditingDisabled,this)),this.api.asc_registerCallback("asc_sendFromGeneralToFrameEditor",_.bind(this.onSendFromGeneralToFrameEditor,this)),this},handler:function(t,e){this.isHandlerCalled||(this.isHandlerCalled=!0,this.oleEditorView._isExternalDocReady?o&&o.serviceCommand("queryClose",{mr:t}):(this.oleEditorView.hide(),this.isHandlerCalled=!1))},setOleData:function(){n||(o&&o.serviceCommand("setOleData",this.oleEditorView._oleData),this.oleEditorView._oleData=null)},loadConfig:function(o){o&&o.config&&(o.config.lang&&(t=o.config.lang),o.config.customization&&(e=o.config.customization),o.config.targetApp&&(i=o.config.targetApp))},onOleEditingDisabled:function(){this.oleEditorView.isVisible()&&this.oleEditorView._isExternalDocReady?(this.oleEditorView.setControlsDisabled(!0),Common.UI.alert({title:this.warningTitle,msg:this.warningText,iconCls:"warn",buttons:["ok"],callback:_.bind((function(t){this.oleEditorView.setControlsDisabled(!1),this.oleEditorView.hide()}),this)}),this.needDisableEditing=!1):this.needDisableEditing=!0},onInternalMessage:function(t){var e=t.data;if(this.oleEditorView)if("documentReady"==e.type)this.oleEditorView._isExternalDocReady=!0,this.isExternalEditorVisible&&(n=!1),this.oleEditorView._oleData&&this.setOleData(),this.needDisableEditing&&this.onOleEditingDisabled();else if("oleEditorReady"==e.type)void 0===this.needDisableEditing&&this.oleEditorView.setControlsDisabled(!1);else if("shortcut"==e.type)"escape"==e.data.key&&this.oleEditorView.hide();else if("canClose"==e.type)!0===e.data.answer&&(o&&(o.serviceCommand("setAppDisabled",!0),"ok"==e.data.mr&&o.serviceCommand("getOleData")),this.oleEditorView.hide()),this.isHandlerCalled=!1;else if("processMouse"==e.type){if("mouse:up"==e.data.event)this.oleEditorView.binding.dragStop(),this.oleEditorView.binding.resizeStop&&this.oleEditorView.binding.resizeStop();else if("mouse:move"==e.data.event){var i=parseInt(this.oleEditorView.$window.css("left"))+e.data.pagex,s=parseInt(this.oleEditorView.$window.css("top"))+e.data.pagey+34;this.oleEditorView.binding.drag({pageX:i,pageY:s}),this.oleEditorView.binding.resize&&this.oleEditorView.binding.resize({pageX:i,pageY:s})}}else if("resize"==e.type){var a=e.data.width,r=e.data.height;a>0&&r>0&&this.oleEditorView.setInnerSize(a,r)}else"frameToGeneralData"==e.type?this.api&&this.api.asc_getInformationBetweenFrameAndGeneralEditor(e.data):this.oleEditorView.fireEvent("internalmessage",this.oleEditorView,e)},onProcessMouse:function(t){"mouseup"==t.type&&this.isExternalEditorVisible&&o&&o.serviceCommand("processmouse",t)},onSendFromGeneralToFrameEditor:function(t){o&&o.serviceCommand("generalToFrameData",t)},warningTitle:"Warning",warningText:"The object is disabled because of editing by another user.",textClose:"Close",textAnonymous:"Anonymous"}),Common.Controllers.ExternalOleEditor||{}))})),void 0===Common)var Common={};if(Common.Models=Common.Models||{},define("common/main/lib/model/ReviewChange",["underscore","backbone","common/main/lib/component/BaseView"],(function(t,e){"use strict";Common.Models.ReviewChange=e.Model.extend({defaults:{uid:0,userid:0,username:"Guest",usercolor:null,date:void 0,changetext:"",lock:!1,lockuser:"",type:0,changedata:null,hint:!1,editable:!1,id:Common.UI.getId(),scope:null}})})),void 0===Common)var Common={};if(Common.Collections=Common.Collections||{},define("common/main/lib/collection/ReviewChanges",["underscore","backbone","common/main/lib/model/ReviewChange"],(function(t,e){"use strict";Common.Collections.ReviewChanges=e.Collection.extend({model:Common.Models.ReviewChange})})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/ReviewChanges",["common/main/lib/util/utils","common/main/lib/component/Button","common/main/lib/component/DataView","common/main/lib/component/Layout","common/main/lib/component/Window"],(function(){"use strict";Common.enumLock||(Common.enumLock={});var t={noSpellcheckLangs:"no-spellcheck-langs",isReviewOnly:"review-only",reviewChangelock:"review-change-lock",hasCoeditingUsers:"has-coediting-users",previewReviewMode:"preview-review-mode",viewFormMode:"view-form-mode",viewMode:"view-mode",hideComments:"hide-comments",cantShare:"cant-share",customLock:"custom-lock"};for(var e in t)t.hasOwnProperty(e)&&(Common.enumLock[e]=t[e]);Common.Views.ReviewChanges=Common.UI.BaseView.extend(_.extend(function(){function t(){var t=this;t.appConfig.canReview&&(this.btnAccept.on("click",(function(e){t.fireEvent("reviewchange:accept",[t.btnAccept,"current"])})),this.btnAccept.menu&&this.btnAccept.menu.on("item:click",(function(e,i,o){t.fireEvent("reviewchange:accept",[e,i])})),this.btnReject.on("click",(function(e){t.fireEvent("reviewchange:reject",[t.btnReject,"current"])})),this.btnReject.menu&&this.btnReject.menu.on("item:click",(function(e,i,o){t.fireEvent("reviewchange:reject",[e,i])})),t.appConfig.canFeatureComparison&&(this.btnCompare.on("click",(function(e){t.fireEvent("reviewchange:compare",["file"])})),this.btnCompare.menu.on("item:click",(function(e,i,o){t.fireEvent("reviewchange:compare",[i.value])})),this.btnCombine.on("click",(function(e){t.fireEvent("reviewchange:combine",["file"])})),this.btnCombine.menu.on("item:click",(function(e,i,o){t.fireEvent("reviewchange:combine",[i.value])}))),this.btnsTurnReview.forEach((function(e){e.on("click",(function(t,e){Common.NotificationCenter.trigger("reviewchanges:turn",t.pressed),Common.NotificationCenter.trigger("edit:complete")})),!t.appConfig.isReviewOnly&&e.menu.on("item:toggle",(function(e,i,o,n){o&&(2==i.value?Common.UI.warning({title:t.textWarnTrackChangesTitle,msg:t.textWarnTrackChanges,maxwidth:600,buttons:[{value:"enable",caption:t.textEnable},"cancel"],primary:"enable",callback:function(e){if("enable"==e)Common.NotificationCenter.trigger("reviewchanges:turn",0==i.value||2==i.value,i.value>1);else{var o=Common.Utils.InternalSettings.get(t.appPrefix+"track-changes");t.turnChanges(0==o||2==o,o>1)}Common.NotificationCenter.trigger("edit:complete")}}):Common.NotificationCenter.trigger("reviewchanges:turn",0==i.value||2==i.value,i.value>1))}))}))),this.appConfig.canViewReview&&(this.btnPrev.on("click",(function(e){t.fireEvent("reviewchange:preview",[t.btnPrev,"prev"])})),this.btnNext.on("click",(function(e){t.fireEvent("reviewchange:preview",[t.btnNext,"next"])})),this.btnReviewView&&this.btnReviewView.menu.on("item:click",(function(e,i,o){t.fireEvent("reviewchange:view",[e,i])}))),this.btnsSpelling.forEach((function(e){e.on("click",(function(e,i){Common.NotificationCenter.trigger("spelling:turn",e.pressed?"on":"off"),Common.NotificationCenter.trigger("edit:complete",t)}))})),this.btnsDocLang.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("lang:document",this)}))})),this.btnSharing&&this.btnSharing.on("click",(function(t,e){Common.NotificationCenter.trigger("collaboration:sharing")})),this.btnCoAuthMode&&this.btnCoAuthMode.menu.on("item:click",(function(e,i,o){t.fireEvent("collaboration:coauthmode",[e,i])})),this.btnHistory&&this.btnHistory.on("click",(function(t,e){Common.NotificationCenter.trigger("collaboration:history")})),this.btnChat&&this.btnChat.on("click",(function(e,i){t.fireEvent("collaboration:chat",[e.pressed])})),this.btnCommentRemove&&(this.btnCommentRemove.on("click",(function(e){t.fireEvent("comment:removeComments",["current"])})),this.btnCommentRemove.menu.on("item:click",(function(e,i,o){t.fireEvent("comment:removeComments",[i.value])}))),this.btnCommentResolve&&(this.btnCommentResolve.on("click",(function(e){t.fireEvent("comment:resolveComments",["current"])})),this.btnCommentResolve.menu.on("item:click",(function(e,i,o){t.fireEvent("comment:resolveComments",[i.value])}))),this.mnuMailRecepients&&this.mnuMailRecepients.on("item:click",(function(e,i,o){t.fireEvent("collaboration:mailmerge",[i.value])})),Common.NotificationCenter.on("protect:doclock",(function(e){t.fireEvent("protect:update")})),t.fireEvent("protect:update")}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.appConfig=t.mode,this.lockedControls=[];var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:"";var i=Common.enumLock;if(this.appConfig.canReview&&(this.btnAccept=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",caption:this.txtAccept,split:!this.appConfig.canUseReviewPermissions,iconCls:"toolbar__icon btn-review-save",lock:[i.reviewChangelock,i.isReviewOnly,i.previewReviewMode,i.viewFormMode,i.lostConnect,i.docLockView,i.docLockForms,i.docLockComments,i.docLockReview,i.viewMode],action:"review-accept",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnAccept),this.btnReject=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",caption:this.txtReject,split:!this.appConfig.canUseReviewPermissions,iconCls:"toolbar__icon btn-review-deny",lock:[i.reviewChangelock,i.isReviewOnly,i.previewReviewMode,i.viewFormMode,i.lostConnect,i.docLockView,i.docLockForms,i.docLockComments,i.docLockReview,i.viewMode],action:"review-reject",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnReject),this.appConfig.canFeatureComparison&&(this.btnCompare=new Common.UI.Button({cls:"btn-toolbar  x-huge icon-top",caption:this.txtCompare,split:!0,iconCls:"toolbar__icon btn-compare",lock:[i.hasCoeditingUsers,i.previewReviewMode,i.viewFormMode,i.lostConnect,i.docLockView,i.docLockForms,i.docLockComments,i.viewMode],action:"compare-document",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnCompare),this.btnCombine=new Common.UI.Button({cls:"btn-toolbar  x-huge icon-top",caption:this.txtCombine,split:!0,iconCls:"toolbar__icon btn-combine",lock:[i.hasCoeditingUsers,i.previewReviewMode,i.viewFormMode,i.lostConnect,i.docLockView,i.docLockForms,i.docLockComments,i.viewMode],action:"combine-document",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnCombine)),this.btnTurnOn=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-big-ic-review",lock:[i.previewReviewMode,i.viewFormMode,i.lostConnect,i.docLockView,i.docLockForms,i.docLockComments,i.docLockReview,i.viewMode],caption:this.txtTurnon,split:!this.appConfig.isReviewOnly,action:"track-changes",enableToggle:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.btnsTurnReview=[this.btnTurnOn],this.lockedControls.push(this.btnTurnOn)),this.appConfig.canViewReview&&(this.btnPrev=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-review-prev",lock:[i.previewReviewMode,i.viewFormMode,i.lostConnect,i.docLockView,i.docLockForms,i.docLockComments,i.viewMode,i.viewMode],caption:this.txtPrev,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnPrev),this.btnNext=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-review-next",lock:[i.previewReviewMode,i.viewFormMode,i.lostConnect,i.docLockView,i.docLockForms,i.docLockComments,i.viewMode,i.viewMode],caption:this.txtNext,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnNext),!(this.appConfig.isRestrictedEdit||this.appConfig.customization&&this.appConfig.customization.review&&this.appConfig.customization.review.hideReviewDisplay))){var o=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div><b><%= caption %></b></div><% if (options.description !== null) { %><label class="description"><%= options.description %></label><% } %></a>');this.btnReviewView=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-reviewview",lock:[i.viewFormMode,i.lostConnect,i.docLockView,i.docLockForms,i.docLockComments,i.viewMode],caption:this.txtView,menu:new Common.UI.Menu({cls:"ppm-toolbar",items:[{caption:this.txtMarkupCap,checkable:!0,toggleGroup:"menuReviewView",checked:!0,value:"markup",template:o,description:Common.Utils.String.format(this.txtMarkup,this.appConfig.isEdit||this.appConfig.isRestrictedEdit?"("+this.txtEditing+")":"")},{caption:this.txtMarkupSimpleCap,checkable:!0,toggleGroup:"menuReviewView",checked:!1,value:"simple",template:o,description:Common.Utils.String.format(this.txtMarkupSimple,this.appConfig.isEdit||this.appConfig.isRestrictedEdit?"("+this.txtEditing+")":"")},{caption:this.txtFinalCap,checkable:!0,toggleGroup:"menuReviewView",checked:!1,template:o,description:Common.Utils.String.format(this.txtFinal,this.appConfig.isEdit||this.appConfig.isRestrictedEdit?"("+this.txtPreview+")":""),value:"final"},{caption:this.txtOriginalCap,checkable:!0,toggleGroup:"menuReviewView",checked:!1,template:o,description:Common.Utils.String.format(this.txtOriginal,this.appConfig.isEdit||this.appConfig.isRestrictedEdit?"("+this.txtPreview+")":""),value:"original"}]}),action:"review-display-mode",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnReviewView)}(this.appConfig.sharingSettingsUrl&&this.appConfig.sharingSettingsUrl.length||this.appConfig.canRequestSharingSettings)&&!0!==this._readonlyRights&&(this.btnSharing=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-sharing",lock:[i.viewFormMode,i.cantShare,i.lostConnect],caption:this.txtSharing,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnSharing)),this.appConfig.isEdit&&!this.appConfig.isOffline&&this.appConfig.canCoAuthoring&&this.appConfig.canChangeCoAuthoring&&(this.btnCoAuthMode=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-coedit",lock:[i.viewFormMode,i.lostConnect,i.docLockView,i.viewMode],caption:this.txtCoAuthMode,menu:!0,action:"co-edit-mode",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnCoAuthMode)),this.btnsSpelling=[],this.btnsDocLang=[],this.appConfig.canUseHistory&&!this.appConfig.isDisconnected&&(this.btnHistory=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-history",lock:[i.lostConnect],caption:this.txtHistory,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnHistory)),this.appConfig.canCoAuthoring&&this.appConfig.canChat&&(this.btnChat=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-ic-chat",lock:[i.lostConnect],caption:this.txtChat,enableToggle:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnChat)),this.appConfig.canCoAuthoring&&this.appConfig.canComments&&(this.canComments=!0,this.btnCommentRemove=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",caption:this.txtCommentRemove,split:!0,iconCls:"toolbar__icon btn-rem-comment",lock:[i.previewReviewMode,i.viewFormMode,i.hideComments,i.Objects,i.lostConnect,i.docLockView,i.docLockForms,i.viewMode,i.slideMasterMode],action:"comment-remove",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnCommentRemove),this.btnCommentResolve=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",caption:this.txtCommentResolve,split:!0,iconCls:"toolbar__icon btn-resolve-all",lock:[i.previewReviewMode,i.viewFormMode,i.hideComments,i.Objects,i.lostConnect,i.docLockView,i.docLockForms,i.viewMode,i.slideMasterMode],action:"comment-resolve",dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small"}),this.lockedControls.push(this.btnCommentResolve)),this.appConfig.isEdit&&this.appConfig.canCoAuthoring&&this.appConfig.canUseMailMerge&&(this.btnMailRecepients=new Common.UI.Button({id:"id-toolbar-btn-mailrecepients",cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-mailmerge",lock:[i.mmergeLock,i.previewReviewMode,i.viewFormMode,i.lostConnect,i.docLockView,i.docLockForms,i.docLockComments,i.viewMode],caption:this.txtMailMerge,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small",menu:new Common.UI.Menu({items:[{caption:this.mniMMFromFile,value:"file"},{caption:this.mniMMFromUrl,value:"url"},{caption:this.mniMMFromStorage,value:"storage"}]}),action:"mail-merge"}),this.mnuMailRecepients=this.btnMailRecepients.menu,this.lockedControls.push(this.btnMailRecepients)),Common.UI.LayoutManager.addControls(this.lockedControls)},render:function(t){return this.boxSdk=$("#editor_sdk"),t&&t.html(this.getPanel()),this},onAppReady:function(e){var i=this;new Promise((function(t,e){t()})).then((function(){var o=_.template('<a id="<%= id %>" tabindex="-1" type="menuitem"><div><b><%= caption %></b></div><% if (options.description !== null) { %><label class="description"><%= options.description %></label><% } %></a>');if(e.canReview){var n=Common.Utils.InternalSettings.get(i.appPrefix+"track-changes");!e.isReviewOnly&&i.btnTurnOn.setMenu(new Common.UI.Menu({items:[{caption:i.txtOn,value:0,checkable:!0,checked:0==n,toggleGroup:"menuTurnReviewTlb"},{caption:i.txtOff,value:1,checkable:!0,checked:1==n,toggleGroup:"menuTurnReviewTlb"},{caption:i.txtOnGlobal,value:2,checkable:!0,checked:2==n,toggleGroup:"menuTurnReviewTlb"},{caption:i.txtOffGlobal,value:3,checkable:!0,checked:3==n,toggleGroup:"menuTurnReviewTlb"}]})),i.btnTurnOn.updateHint(i.tipReview),i.appConfig.canUseReviewPermissions||(i.btnAccept.setMenu(new Common.UI.Menu({items:[{caption:i.txtAcceptCurrent,value:"current"},{caption:i.txtAcceptAll,value:"all"}]})),i.btnReject.setMenu(new Common.UI.Menu({items:[{caption:i.txtRejectCurrent,value:"current"},{caption:i.txtRejectAll,value:"all"}]}))),i.btnAccept.updateHint([i.tipAcceptCurrent,i.txtAcceptChanges]),i.btnReject.updateHint([i.tipRejectCurrent,i.txtRejectChanges]),e.canFeatureComparison&&(i.btnCompare.setMenu(new Common.UI.Menu({items:[{caption:i.mniFromFile,value:"file"},{caption:i.mniFromUrl,value:"url"},{caption:i.mniFromStorage,value:"storage"},{caption:"--"},{caption:i.mniSettings,value:"settings"}]})),i.btnCompare.menu.items[2].setVisible(i.appConfig.canRequestSelectDocument||i.appConfig.canRequestCompareFile||i.appConfig.fileChoiceUrl&&i.appConfig.fileChoiceUrl.indexOf("{documentType}")>-1),i.btnCompare.menu.items[1].setDisabled(i.appConfig.disableNetworkFunctionality),i.btnCompare.menu.items[2].setDisabled(i.appConfig.disableNetworkFunctionality),i.btnCompare.updateHint(i.tipCompare),i.btnCombine.setMenu(new Common.UI.Menu({items:[{caption:i.mniFromFile,value:"file"},{caption:i.mniFromUrl,value:"url"},{caption:i.mniFromStorage,value:"storage"},{caption:"--"},{caption:i.mniSettings,value:"settings"}]})),i.btnCombine.menu.items[2].setVisible(i.appConfig.canRequestSelectDocument||i.appConfig.fileChoiceUrl&&i.appConfig.fileChoiceUrl.indexOf("{documentType}")>-1),i.btnCombine.menu.items[1].setDisabled(i.appConfig.disableNetworkFunctionality),i.btnCombine.menu.items[2].setDisabled(i.appConfig.disableNetworkFunctionality),i.btnCombine.updateHint(i.tipCombine)),Common.Utils.lockControls(Common.enumLock.isReviewOnly,e.isReviewOnly,{array:[i.btnAccept,i.btnReject]})}if(i.appConfig.canViewReview&&(i.btnPrev.updateHint(i.hintPrev),i.btnNext.updateHint(i.hintNext),i.btnReviewView&&i.btnReviewView.updateHint(i.tipReviewView)),i.btnSharing&&i.btnSharing.updateHint(i.tipSharing),i.btnHistory&&i.btnHistory.updateHint(i.tipHistory),i.btnChat&&i.btnChat.updateHint(i.txtChat+Common.Utils.String.platformKey("Alt+Q"," ("+(Common.Utils.isMac?Common.Utils.String.textCtrl+"+":"")+"{0})")),i.btnMailRecepients&&i.btnMailRecepients.updateHint(i.tipMailRecepients),i.btnCoAuthMode&&(i.btnCoAuthMode.setMenu(new Common.UI.Menu({cls:"ppm-toolbar",style:"max-width: 220px;",items:[{caption:i.strFast,checkable:!0,toggleGroup:"menuCoauthMode",checked:!0,template:o,description:i.strFastDesc,value:1},{caption:i.strStrict,checkable:!0,toggleGroup:"menuCoauthMode",checked:!1,template:o,description:i.strStrictDesc,value:0}]})),i.btnCoAuthMode.updateHint(i.tipCoAuthMode),i.turnCoAuthMode(Common.Utils.InternalSettings.get(i.appPrefix+"settings-coauthmode"))),i.btnCommentRemove){var s=[{caption:e.canDeleteComments?i.txtCommentRemCurrent:i.txtCommentRemMyCurrent,value:"current"},{caption:i.txtCommentRemMy,value:"my"}];e.canDeleteComments&&s.push({caption:i.txtCommentRemAll,value:"all"}),i.btnCommentRemove.setMenu(new Common.UI.Menu({items:s})),i.btnCommentRemove.updateHint([i.tipCommentRemCurrent,i.tipCommentRem])}if(i.btnCommentResolve){s=[{caption:e.canEditComments?i.txtCommentResolveCurrent:i.txtCommentResolveMyCurrent,value:"current"},{caption:i.txtCommentResolveMy,value:"my"}];e.canEditComments&&s.push({caption:i.txtCommentResolveAll,value:"all"}),i.btnCommentResolve.setMenu(new Common.UI.Menu({items:s})),i.btnCommentResolve.updateHint([i.tipCommentResolveCurrent,i.tipCommentResolve])}var a,r=i.btnSharing||i.btnCoAuthMode?".separator.sharing":i.$el.find(".separator.sharing"),l=i.btnCommentRemove||i.btnCommentResolve?".separator.comments":i.$el.find(".separator.comments"),c=e.canReview||e.canViewReview?".separator.review":i.$el.find(".separator.review"),h=e.canReview&&e.canFeatureComparison?".separator.compare":i.$el.find(".separator.compare"),d=i.btnChat?".separator.chat":i.$el.find(".separator.chat"),m=i.btnHistory?".separator.history":i.$el.find(".separator.history");"object"==_typeof(r)?r.hide().prev(".group").hide():a=r,"object"==_typeof(l)?l.hide().prev(".group").hide():a=l,"object"==_typeof(c)?c.hide().prevUntil(".separator.comments").hide():a=c,"object"==_typeof(h)?h.hide().prev(".group").hide():a=h,"object"==_typeof(d)?d.hide().prev(".group").hide():a=d,"object"==_typeof(m)?m.hide().prev(".group").hide():a=m,i.btnMailRecepients&&Common.UI.LayoutManager.isElementVisible("toolbar-collaboration-mailmerge")||!a||i.$el.find(a).hide();var p=(e.isEdit||e.canViewReview||i.canComments)&&Common.UI.LayoutManager.isElementVisible("toolbar-collaboration");Common.NotificationCenter.trigger("tab:visible","review",p),Common.Utils.InternalSettings.get("toolbar-active-tab")&&p&&(Common.Utils.InternalSettings.set("toolbar-active-tab",null),Common.NotificationCenter.trigger("tab:set-active","review")),t.call(i)}))},getPanel:function(){return this.$el=$(_.template('<section id="review-changes-panel" class="panel" data-tab="review" role="tabpanel" aria-labelledby="review"><div class="group no-group-mask review"><span id="slot-btn-sharing" class="btn-slot text x-huge"></span><span id="slot-btn-coauthmode" class="btn-slot text x-huge"></span></div><div class="separator long sharing"></div><div class="group"><span class="btn-slot text x-huge slot-comment"></span><span class="btn-slot text x-huge" id="slot-comment-remove"></span><span class="btn-slot text x-huge" id="slot-comment-resolve"></span></div><div class="separator long comments"></div><div class="group"><span id="btn-review-on" class="btn-slot text x-huge"></span></div><div class="group no-group-mask review" style="padding-left: 0;padding-right:0;"><span id="btn-review-view" class="btn-slot text x-huge"></span></div><div class="group move-changes" style="padding-left: 0;padding-right:0;"><span id="btn-change-prev" class="btn-slot text x-huge"></span><span id="btn-change-next" class="btn-slot text x-huge"></span><span id="btn-change-accept" class="btn-slot text x-huge"></span><span id="btn-change-reject" class="btn-slot text x-huge"></span></div><div class="separator long review"></div><div class="group"><span id="slot-btn-compare" class="btn-slot text x-huge"></span><span id="slot-btn-combine" class="btn-slot text x-huge"></span></div><div class="separator long compare"></div><div class="group no-group-mask review form-view"><span id="slot-btn-chat" class="btn-slot text x-huge"></span></div><div class="separator long chat"></div><div class="group no-group-mask review form-view"><span id="slot-btn-history" class="btn-slot text x-huge"></span></div><div class="separator long history"></div><div class="group"><span id="slot-btn-mailrecepients" class="btn-slot text x-huge" data-layout-name="toolbar-collaboration-mailmerge"></span></div></section>')({})),this.appConfig.canReview&&(this.btnAccept.render(this.$el.find("#btn-change-accept")),this.btnReject.render(this.$el.find("#btn-change-reject")),this.appConfig.canFeatureComparison&&this.btnCompare.render(this.$el.find("#slot-btn-compare")),this.appConfig.canFeatureComparison&&this.btnCombine.render(this.$el.find("#slot-btn-combine")),this.btnTurnOn.render(this.$el.find("#btn-review-on"))),this.btnPrev&&this.btnPrev.render(this.$el.find("#btn-change-prev")),this.btnNext&&this.btnNext.render(this.$el.find("#btn-change-next")),this.btnReviewView&&this.btnReviewView.render(this.$el.find("#btn-review-view")),this.btnSharing&&this.btnSharing.render(this.$el.find("#slot-btn-sharing")),this.btnCoAuthMode&&this.btnCoAuthMode.render(this.$el.find("#slot-btn-coauthmode")),this.btnHistory&&this.btnHistory.render(this.$el.find("#slot-btn-history")),this.btnChat&&this.btnChat.render(this.$el.find("#slot-btn-chat")),this.btnCommentRemove&&this.btnCommentRemove.render(this.$el.find("#slot-comment-remove")),this.btnCommentResolve&&this.btnCommentResolve.render(this.$el.find("#slot-comment-resolve")),this.btnMailRecepients&&this.btnMailRecepients.render(this.$el.find("#slot-btn-mailrecepients")),this.$el},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButton:function(t,e){if("turn"==t&&"statusbar"==e){var i=new Common.UI.Button({cls:"btn-toolbar",iconCls:"toolbar__icon btn-ic-review",lock:[Common.enumLock.viewMode,Common.enumLock.previewReviewMode,Common.enumLock.viewFormMode,Common.enumLock.lostConnect,Common.enumLock.docLockView,Common.enumLock.docLockForms,Common.enumLock.docLockComments,Common.enumLock.docLockReview],hintAnchor:"top",hint:this.tipReview,split:!this.appConfig.isReviewOnly,enableToggle:!0,menu:!this.appConfig.isReviewOnly&&new Common.UI.Menu({menuAlign:"bl-tl",style:"margin-top:-5px;",items:[{caption:this.txtOn,value:0,checkable:!0,toggleGroup:"menuTurnReviewStb"},{caption:this.txtOff,value:1,checkable:!0,toggleGroup:"menuTurnReviewStb"},{caption:this.txtOnGlobal,value:2,checkable:!0,toggleGroup:"menuTurnReviewStb"},{caption:this.txtOffGlobal,value:3,checkable:!0,toggleGroup:"menuTurnReviewStb"}]}),action:"track-changes",dataHint:"0",dataHintDirection:"top",dataHintOffset:"2, -16"});return this.btnsTurnReview.push(i),this.lockedControls.push(i),Common.UI.LayoutManager.addControls(i),i}return"spelling"==t?(i=new Common.UI.Button({cls:"btn-toolbar",iconCls:"toolbar__icon btn-ic-docspell",lock:[Common.enumLock.viewMode,Common.enumLock.viewFormMode,Common.enumLock.previewReviewMode,Common.enumLock.docLockView,Common.enumLock.docLockForms,Common.enumLock.docLockComments],hintAnchor:"top",hint:this.tipSetSpelling,enableToggle:!0,dataHint:"0",dataHintDirection:"top",dataHintOffset:"small",visible:Common.UI.FeaturesManager.canChange("spellcheck")}),this.btnsSpelling.push(i),this.lockedControls.push(i),Common.UI.LayoutManager.addControls(i),i):"doclang"==t&&"statusbar"==e?(i=new Common.UI.Button({cls:"btn-toolbar",iconCls:"toolbar__icon btn-ic-doclang",lock:[Common.enumLock.viewMode,Common.enumLock.previewReviewMode,Common.enumLock.viewFormMode,Common.enumLock.noSpellcheckLangs,Common.enumLock.lostConnect,Common.enumLock.docLockView,Common.enumLock.docLockForms,Common.enumLock.docLockComments],hintAnchor:"top",hint:this.tipSetDocLang,dataHint:"0",dataHintDirection:"top",dataHintOffset:"small"}),this.btnsDocLang.push(i),this.lockedControls.push(i),Common.UI.LayoutManager.addControls(i),Common.Utils.lockControls(Common.enumLock.noSpellcheckLangs,!0,{array:[i]}),i):void 0},getButtons:function(){return this.lockedControls},getUserName:function(t){return Common.Utils.String.htmlEncode(AscCommon.UserInfoParser.getParsedName(t))},turnChanges:function(t,e){this.btnsTurnReview.forEach((function(i){i&&i.pressed!=t&&i.toggle(t,!0),i.menu&&(i.menu.items[0].setChecked(t&&!e,!0),i.menu.items[1].setChecked(!t&&!e,!0),i.menu.items[2].setChecked(t&&!!e,!0),i.menu.items[3].setChecked(!t&&!!e,!0))}),this),Common.NotificationCenter.trigger("doc:mode-apply",t?"review":"edit",!1)},markChanges:function(t){this.btnsTurnReview.forEach((function(e){e&&$(".icon",e.cmpEl)[t?"addClass":"removeClass"]("btn-ic-changes")}),this)},turnSpelling:function(t){this.btnsSpelling&&this.btnsSpelling.forEach((function(e){e&&e.pressed!=t&&e.toggle(t,!0)}),this)},turnCoAuthMode:function(t){this.btnCoAuthMode&&(this.btnCoAuthMode.menu.items[0].setChecked(t,!0),this.btnCoAuthMode.menu.items[1].setChecked(!t,!0))},turnChat:function(t){this.btnChat&&this.btnChat.toggle(t,!0)},turnDisplayMode:function(t){this.btnReviewView&&(this.btnReviewView.menu.items[0].setChecked("markup"==t,!0),this.btnReviewView.menu.items[1].setChecked("simple"==t,!0),this.btnReviewView.menu.items[2].setChecked("final"==t,!0),this.btnReviewView.menu.items[3].setChecked("original"==t,!0))},onLostEditRights:function(){this._readonlyRights=!0},txtAccept:"Accept",txtAcceptCurrent:"Accept current Changes",txtAcceptAll:"Accept all Changes",txtReject:"Reject",txtRejectCurrent:"Reject current Changes",txtRejectAll:"Reject all Changes",hintNext:"To Next Change",hintPrev:"To Previous Change",txtPrev:"Previous",txtNext:"Next",txtTurnon:"Turn On",txtSpelling:"Spell checking",txtDocLang:"Language",tipSetDocLang:"Set Document Language",tipSetSpelling:"Spell checking",tipReview:"Review",txtAcceptChanges:"Accept Changes",txtRejectChanges:"Reject Changes",txtView:"Display Mode",txtMarkup:"Text with changes {0}",txtFinal:"All changes like accept {0}",txtOriginal:"Text without changes {0}",tipReviewView:"Select the way you want the changes to be displayed",tipAcceptCurrent:"Accept current changes",tipRejectCurrent:"Reject current changes",txtSharing:"Sharing",tipSharing:"Manage document access rights",txtCoAuthMode:"Co-editing Mode",tipCoAuthMode:"Set co-editing mode",strFast:"Fast",strStrict:"Strict",txtHistory:"Version History",tipHistory:"Show version history",txtChat:"Chat",txtMarkupCap:"Markup",txtFinalCap:"Final",txtOriginalCap:"Original",strFastDesc:"Real-time co-editing. All changes are saved automatically.",strStrictDesc:"Use the 'Save' button to sync the changes you and others make.",txtCompare:"Compare",tipCompare:"Compare current document with another one",txtCombine:"Combine",tipCombine:"Combine current document with another one",mniFromFile:"Document from File",mniFromUrl:"Document from URL",mniFromStorage:"Document from Storage",mniSettings:"Comparison Settings",txtCommentRemove:"Remove",tipCommentRemCurrent:"Remove current comments",tipCommentRem:"Remove comments",txtCommentRemCurrent:"Remove Current Comments",txtCommentRemMyCurrent:"Remove My Current Comments",txtCommentRemMy:"Remove My Comments",txtCommentRemAll:"Remove All Comments",txtCommentResolve:"Resolve",tipCommentResolveCurrent:"Resolve current comments",tipCommentResolve:"Resolve comments",txtCommentResolveCurrent:"Resolve Current Comments",txtCommentResolveMyCurrent:"Resolve My Current Comments",txtCommentResolveMy:"Resolve My Comments",txtCommentResolveAll:"Resolve All Comments",txtOnGlobal:"ON for me and everyone",txtOffGlobal:"OFF for me and everyone",txtOn:"ON for me",txtOff:"OFF for me",textWarnTrackChangesTitle:"Enable Track Changes for everyone?",textWarnTrackChanges:"Track Changes will be switched ON for all users with full access. The next time anyone opens the doc, Track Changes will remain enabled.",textEnable:"Enable",txtMarkupSimpleCap:"Simple Markup",txtMarkupSimple:"All changes {0}<br>Turn off balloons",txtEditing:"Editing",txtPreview:"Preview",txtMailMerge:"Mail Merge",mniMMFromFile:"From File",mniMMFromUrl:"From URL",mniMMFromStorage:"From Storage",tipMailRecepients:"Mail Merge"}}(),Common.Views.ReviewChanges||{})),Common.Views.ReviewChangesDialog=Common.UI.Window.extend(_.extend({options:{width:330,title:"Review Changes",modal:!1,cls:"review-changes modal-dlg",alias:"Common.Views.ReviewChangesDialog"},initialize:function(t){_.extend(this.options,{title:this.textTitle},t||{}),this.template=['<div class="box">','<div class="input-row">','<div id="id-review-button-prev" style=""></div>','<div id="id-review-button-next" style=""></div>','<div id="id-review-button-accept" style=""></div>','<div id="id-review-button-reject" style="margin-right: 0;"></div>',"</div>","</div>"].join(""),this.options.tpl=_.template(this.template)(this.options),this.popoverChanges=this.options.popoverChanges,this.mode=this.options.mode,this.docProtection=this.options.docProtection;var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:"",Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var t=Common.enumLock;this.btnPrev=new Common.UI.Button({cls:"dlg-btn iconic",iconCls:"img-commonctrl prev",hint:this.txtPrev,hintAnchor:"top"}),this.btnPrev.render(this.$window.find("#id-review-button-prev")),this.btnNext=new Common.UI.Button({cls:" dlg-btn iconic",iconCls:"img-commonctrl next",hint:this.txtNext,hintAnchor:"top"}),this.btnNext.render(this.$window.find("#id-review-button-next")),this.btnAccept=new Common.UI.Button({cls:"btn-toolbar",caption:this.txtAccept,split:!0,disabled:this.mode.isReviewOnly||this.docProtection.isReviewOnly||!!Common.Utils.InternalSettings.get(this.appPrefix+"accept-reject-lock"),lock:[t.reviewChangelock,t.isReviewOnly,t.previewReviewMode,t.viewFormMode,t.lostConnect,t.docLockView,t.docLockForms,t.docLockComments,t.docLockReview,t.viewMode],menu:!this.mode.canUseReviewPermissions&&new Common.UI.Menu({items:[this.mnuAcceptCurrent=new Common.UI.MenuItem({caption:this.txtAcceptCurrent,value:"current"}),this.mnuAcceptAll=new Common.UI.MenuItem({caption:this.txtAcceptAll,value:"all"})]})}),this.btnAccept.render(this.$window.find("#id-review-button-accept")),this.btnReject=new Common.UI.Button({cls:"btn-toolbar",caption:this.txtReject,split:!0,lock:[t.reviewChangelock,t.isReviewOnly,t.previewReviewMode,t.viewFormMode,t.lostConnect,t.docLockView,t.docLockForms,t.docLockComments,t.docLockReview,t.viewMode],menu:!this.mode.canUseReviewPermissions&&new Common.UI.Menu({items:[this.mnuRejectCurrent=new Common.UI.MenuItem({caption:this.txtRejectCurrent,value:"current"}),this.mnuRejectAll=new Common.UI.MenuItem({caption:this.txtRejectAll,value:"all"})]})}),this.btnReject.render(this.$window.find("#id-review-button-reject"));var e=[this.btnAccept,this.btnReject];Common.Utils.lockControls(Common.enumLock.isReviewOnly,this.mode.isReviewOnly,{array:e}),Common.Utils.lockControls(Common.enumLock.docLockView,this.docProtection.isReadOnly,{array:e}),Common.Utils.lockControls(Common.enumLock.docLockForms,this.docProtection.isFormsOnly,{array:e}),Common.Utils.lockControls(Common.enumLock.docLockReview,this.docProtection.isReviewOnly,{array:e}),Common.Utils.lockControls(Common.enumLock.docLockComments,this.docProtection.isCommentsOnly,{array:e}),Common.Utils.lockControls(Common.enumLock.reviewChangelock,!!Common.Utils.InternalSettings.get(this.appPrefix+"accept-reject-lock"),{array:e});var i=this;return this.btnPrev.on("click",(function(t){i.fireEvent("reviewchange:preview",[i.btnPrev,"prev"])})),this.btnNext.on("click",(function(t){i.fireEvent("reviewchange:preview",[i.btnNext,"next"])})),this.btnAccept.on("click",(function(t){i.fireEvent("reviewchange:accept",[i.btnAccept,"current"])})),this.btnAccept.menu&&this.btnAccept.menu.on("item:click",(function(t,e,o){i.fireEvent("reviewchange:accept",[t,e])})),this.btnReject.on("click",(function(t){i.fireEvent("reviewchange:reject",[i.btnReject,"current"])})),this.btnReject.menu&&this.btnReject.menu.on("item:click",(function(t,e,o){i.fireEvent("reviewchange:reject",[t,e])})),this},textTitle:"Review Changes",txtPrev:"To previous change",txtNext:"To next change",txtAccept:"Accept",txtAcceptCurrent:"Accept Current Change",txtAcceptAll:"Accept All Changes",txtReject:"Reject",txtRejectCurrent:"Reject Current Change",txtRejectAll:"Reject All Changes"},Common.Views.ReviewChangesDialog||{}))})),void 0===Common)var Common={};if(Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/ReviewChanges",["core","common/main/lib/model/ReviewChange","common/main/lib/collection/ReviewChanges","common/main/lib/view/ReviewChanges","common/main/lib/view/ReviewPopover"],(function(){"use strict";Common.Controllers.ReviewChanges=Backbone.Controller.extend(_.extend({models:[],collections:["Common.Collections.ReviewChanges"],views:["Common.Views.ReviewChanges","Common.Views.ReviewPopover"],sdkViewName:"#id_main",initialize:function(){this.addListeners({FileMenu:{"settings:apply":this.applySettings.bind(this)},LeftMenu:{"comments:show":_.bind(this.commentsShowHide,this,"show"),"comments:hide":_.bind(this.commentsShowHide,this,"hide")},"Common.Views.ReviewChanges":{"reviewchange:accept":_.bind(this.onAcceptClick,this),"reviewchange:reject":_.bind(this.onRejectClick,this),"reviewchange:delete":_.bind(this.onDeleteClick,this),"reviewchange:preview":_.bind(this.onBtnPreviewClick,this),"reviewchange:view":_.bind(this.onReviewViewClick,this),"reviewchange:compare":_.bind(this.onCompareClick,this),"reviewchange:combine":_.bind(this.onCombineClick,this),"lang:document":_.bind(this.onDocLanguage,this),"collaboration:coauthmode":_.bind(this.onCoAuthMode,this),"protect:update":_.bind(this.onChangeProtectDocument,this)},"Common.Views.ReviewChangesDialog":{"reviewchange:accept":_.bind(this.onAcceptClick,this),"reviewchange:reject":_.bind(this.onRejectClick,this),"reviewchange:preview":_.bind(this.onBtnPreviewClick,this)},"Common.Views.ReviewPopover":{"reviewchange:accept":_.bind(this.onAcceptClick,this),"reviewchange:reject":_.bind(this.onRejectClick,this),"reviewchange:delete":_.bind(this.onDeleteClick,this),"reviewchange:goto":_.bind(this.onGotoClick,this)},ViewTab:{"viewmode:change":_.bind(this.onChangeViewMode,this)}})},onLaunch:function(){this.collection=this.getApplication().getCollection("Common.Collections.ReviewChanges"),this.userCollection=this.getApplication().getCollection("Common.Collections.Users"),this.viewmode=!1;var t=Common.localStorage.getKeysFilter();this.appPrefix=t&&t.length?t.split(",")[0]:"",this._state={posx:-1e3,posy:-1e3,popoverVisible:!1,previewMode:!1,compareSettings:null,wsLock:!1,wsProps:[],displayMode:Asc.c_oAscDisplayModeInReview.Edit,disableEditing:!1,docProtection:{isReadOnly:!1,isReviewOnly:!1,isFormsOnly:!1,isCommentsOnly:!1},sdkchange:null},Common.NotificationCenter.on("reviewchanges:turn",this.onTurnPreview.bind(this)),Common.NotificationCenter.on("spelling:turn",this.onTurnSpelling.bind(this)),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("collaboration:sharing",this.changeAccessRights.bind(this)),Common.NotificationCenter.on("collaboration:sharingdeny",this.onLostEditRights.bind(this)),Common.NotificationCenter.on("protect:wslock",_.bind(this.onChangeProtectSheet,this)),Common.NotificationCenter.on("mentions:setusers",this.avatarsUpdate.bind(this)),this.userCollection.on({add:_.bind(this.onUpdateUsers,this),change:_.bind(this.onUpdateUsers,this),reset:_.bind(this.onUpdateUsers,this)})},setConfig:function(t,e){return this.setApi(e),t&&(this.currentUserId=t.config.user.id,this.sdkViewName=t.sdkviewname||this.sdkViewName),this},setApi:function(t){t&&(this.api=t,(this.appConfig.canReview||this.appConfig.canViewReview)&&(this.api.asc_registerCallback("asc_onShowRevisionsChange",_.bind(this.onApiShowChange,this)),this.api.asc_registerCallback("asc_onUpdateRevisionsChangesPosition",_.bind(this.onApiUpdateChangePosition,this)),this.api.asc_registerCallback("asc_onAuthParticipantsChanged",_.bind(this.onAuthParticipantsChanged,this)),this.api.asc_registerCallback("asc_onParticipantsChanged",_.bind(this.onAuthParticipantsChanged,this)),this.api.asc_registerCallback("asc_onChangeDisplayModeInReview",_.bind(this.onChangeDisplayModeInReview,this))),this.appConfig.canReview&&this.api.asc_registerCallback("asc_onOnTrackRevisionsChange",_.bind(this.onApiTrackRevisionsChange,this)),this.api.asc_registerCallback("asc_onAcceptChangesBeforeCompare",_.bind(this.onAcceptChangesBeforeCompare,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.Gateway.on("setrevisedfile",_.bind(this.setRevisedFile,this)),this.appConfig.canFeatureComparison&&(Common.NotificationCenter.on("storage:document-load",_.bind(this.openDocumentFromStorage,this)),Common.NotificationCenter.on("storage:document-insert",_.bind(this.insertDocumentFromStorage,this)),Common.Gateway.on("setrequesteddocument",_.bind(this.setRequestedDocument,this))))},setMode:function(t){return this.appConfig=t,this.popoverChanges=new Common.Collections.ReviewChanges,this.view=this.createView("Common.Views.ReviewChanges",{mode:t}),(this.appConfig.sharingSettingsUrl&&this.appConfig.sharingSettingsUrl.length||this.appConfig.canRequestSharingSettings)&&(Common.Gateway.on("showsharingsettings",_.bind(this.changeAccessRights,this)),Common.Gateway.on("setsharingsettings",_.bind(this.setSharingSettings,this))),this},loadDocument:function(t){this.document=t.doc},SetDisabled:function(t,e,i){this.dlgChanges&&this.dlgChanges.close(),e?(this.lockToolbar(Common.enumLock.previewReviewMode,t),this.dlgChanges&&Common.Utils.lockControls(Common.enumLock.previewReviewMode,t,{array:[this.dlgChanges.btnAccept,this.dlgChanges.btnReject]})):i?(this.lockToolbar(Common.enumLock.viewFormMode,t),this.dlgChanges&&Common.Utils.lockControls(Common.enumLock.viewFormMode,t,{array:[this.dlgChanges.btnAccept,this.dlgChanges.btnReject]})):this.lockToolbar(Common.enumLock.viewMode,t),this.setPreviewMode(t)},lockToolbar:function(t,e,i){this.view&&Common.Utils.lockControls(t,e,i,this.view.getButtons())},setPreviewMode:function(t){this._state.disableEditing=t,this.updatePreviewMode()},updatePreviewMode:function(){var t=this._state.disableEditing||this._state.docProtection.isReadOnly||this._state.docProtection.isFormsOnly||this._state.docProtection.isCommentsOnly;if(this.viewmode!==t){this.viewmode=t,t&&(this.prevcanReview=this.appConfig.canReview),this.appConfig.canReview=!t&&this.prevcanReview;var e=this;this.popoverChanges&&this.popoverChanges.each((function(t){t.set("hint",!e.appConfig.canReview)}))}},isSelectedChangesLocked:function(t,e){if(!t||t.length<1)return!0;if(e)return t[0].get("lock")||!t[0].get("editable");for(var i=0;i<t.length;i++){var o=t[i];if(o.get("lock")||!o.get("editable"))return!0}return!1},onApiShowChange:function(t,e){var i,o=!0;if(this._state.sdkchange=t,!this.appConfig.canReview||this.appConfig.isReviewOnly||this._state.docProtection.isReviewOnly||(t&&t.length>0&&(i=this.readSDKChange(t),o=this.isSelectedChangesLocked(i,e)),this._state.lock!==o&&(this.dlgChanges&&Common.Utils.lockControls(Common.enumLock.reviewChangelock,o,{array:[this.dlgChanges.btnAccept,this.dlgChanges.btnReject]}),this._state.lock=o,Common.Utils.InternalSettings.set(this.appPrefix+"accept-reject-lock",o))),this.getPopover())if(!this.appConfig.reviewHoverMode&&this._state.displayMode!==Asc.c_oAscDisplayModeInReview.Simple&&t&&t.length>0&&e){var n=t[0].get_X(),s=t[0].get_Y(),a=Math.abs(this._state.posx-n)>.001||Math.abs(this._state.posy-s)>.001||t.length!==this._state.changes_length,r=null!==t[0].get_LockUserId(),l=this.getUserName(t[0].get_LockUserId());this.getPopover().hideTips(),this.popoverChanges.reset(i||this.readSDKChange(t)),a&&(this.getPopover().isVisible()&&this.getPopover().hide(),this.getPopover().setLeftTop(n,s)),this.getPopover().showReview(a,r,l),this._state.posx=n,this._state.posy=s,this._state.changes_length=t.length,this._state.popoverVisible=!0}else this._state.popoverVisible&&(this._state.posx=this._state.posy=-1e3,this._state.changes_length=0,this._state.popoverVisible=!1,this.getPopover().hideTips(),this.popoverChanges.reset(),this.getPopover().hideReview())},onApiUpdateChangePosition:function(t,e){this.getPopover()&&(e<0||this.getPopover().sdkBounds.outerHeight<e?this.getPopover().hide():this.popoverChanges.length>0&&(this.getPopover().isVisible()||this.getPopover().show(!1),this.getPopover().setLeftTop(t,e)))},findChange:function(t,e){return _.isUndefined(t)?this.collection.findWhere({id:e}):this.collection.findWhere({uid:t})},getPopover:function(){return(this.appConfig.canReview||this.appConfig.canViewReview)&&_.isUndefined(this.popover)&&(this.popover=Common.Views.ReviewPopover.prototype.getPopover({reviewStore:this.popoverChanges,renderTo:this.sdkViewName,canRequestUsers:this.appConfig?this.appConfig.canRequestUsers:void 0,canRequestSendNotify:this.appConfig?this.appConfig.canRequestSendNotify:void 0,mentionShare:!this.appConfig||this.appConfig.mentionShare,api:this.api}),this.popover.setReviewStore(this.popoverChanges)),this.popover},readSDKChange:function(t){var e=this,i=[],o=[],n=Common.Utils.String.textComma+" ";return _.each(t,(function(t){var s="",a="",r=t.get_Value(),l=t.get_MoveType();switch(t.get_Type()){case Asc.c_oAscRevisionsChangeType.TextAdd:s=l==Asc.c_oAscRevisionsMove.NoMove?e.textInserted:e.textParaMoveTo,"object"==_typeof(r)?_.each(r,(function(t){if("string"==typeof t)s+=" "+Common.Utils.String.htmlEncode(t);else switch(t){case 0:s+=" &lt;"+e.textImage+"&gt;";break;case 1:s+=" &lt;"+e.textShape+"&gt;";break;case 2:s+=" &lt;"+e.textChart+"&gt;";break;case 3:s+=" &lt;"+e.textEquation+"&gt;"}})):"string"==typeof r&&(s+=" "+Common.Utils.String.htmlEncode(r));break;case Asc.c_oAscRevisionsChangeType.TextRem:s=l==Asc.c_oAscRevisionsMove.NoMove?e.textDeleted:t.is_MovedDown()?e.textParaMoveFromDown:e.textParaMoveFromUp,"object"==_typeof(r)?_.each(r,(function(t){if("string"==typeof t)s+=" "+Common.Utils.String.htmlEncode(t);else switch(t){case 0:s+=" &lt;"+e.textImage+"&gt;";break;case 1:s+=" &lt;"+e.textShape+"&gt;";break;case 2:s+=" &lt;"+e.textChart+"&gt;";break;case 3:s+=" &lt;"+e.textEquation+"&gt;"}})):"string"==typeof r&&(s+=" "+Common.Utils.String.htmlEncode(r));break;case Asc.c_oAscRevisionsChangeType.ParaAdd:s=e.textParaInserted;break;case Asc.c_oAscRevisionsChangeType.ParaRem:s=e.textParaDeleted;break;case Asc.c_oAscRevisionsChangeType.TextPr:s="<b>"+e.textFormatted,void 0!==r.Get_Bold()&&(a+=(r.Get_Bold()?"":e.textNot)+e.textBold+n),void 0!==r.Get_Italic()&&(a+=(r.Get_Italic()?"":e.textNot)+e.textItalic+n),void 0!==r.Get_Underline()&&(a+=(r.Get_Underline()?"":e.textNot)+e.textUnderline+n),void 0!==r.Get_Strikeout()&&(a+=(r.Get_Strikeout()?"":e.textNot)+e.textStrikeout+n),void 0!==r.Get_DStrikeout()&&(a+=(r.Get_DStrikeout()?"":e.textNot)+e.textDStrikeout+n),void 0!==r.Get_Caps()&&(a+=(r.Get_Caps()?"":e.textNot)+e.textCaps+n),void 0!==r.Get_SmallCaps()&&(a+=(r.Get_SmallCaps()?"":e.textNot)+e.textSmallCaps+n),void 0!==r.Get_VertAlign()&&(a+=(r.Get_VertAlign()===Asc.vertalign_SuperScript?e.textSuperScript:r.Get_VertAlign()===Asc.vertalign_SubScript?e.textSubScript:e.textBaseline)+n),void 0!==r.Get_Color()&&(a+=e.textColor+n),void 0!==r.Get_Highlight()&&(a+=e.textHighlight+n),void 0!==r.Get_Shd()&&(a+=e.textShd+n),void 0!==r.Get_FontFamily()&&(a+=r.Get_FontFamily()+n),void 0!==r.Get_FontSize()&&(a+=r.Get_FontSize()+n),void 0!==r.Get_Spacing()&&(a+=e.textSpacing+" "+Common.Utils.Metric.fnRecalcFromMM(r.Get_Spacing()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+n),void 0!==r.Get_Position()&&(a+=e.textPosition+" "+Common.Utils.Metric.fnRecalcFromMM(r.Get_Position()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+n),void 0!==r.Get_Lang()&&(a+=Common.util.LanguageInfo.getLocalLanguageName(r.Get_Lang())[1]+n),_.isEmpty(a)||(s+=": ",a=a.substring(0,a.length-2)),s+="</b>",s+=a;break;case Asc.c_oAscRevisionsChangeType.ParaPr:if(s="<b>"+e.textParaFormatted,r.Get_ContextualSpacing()&&(a+=(r.Get_ContextualSpacing()?e.textContextual:e.textNoContextual)+n),void 0!==r.Get_IndLeft()&&(a+=e.textIndentLeft+" "+Common.Utils.Metric.fnRecalcFromMM(r.Get_IndLeft()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+n),void 0!==r.Get_IndRight()&&(a+=e.textIndentRight+" "+Common.Utils.Metric.fnRecalcFromMM(r.Get_IndRight()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+n),void 0!==r.Get_IndFirstLine()&&(a+=e.textFirstLine+" "+Common.Utils.Metric.fnRecalcFromMM(r.Get_IndFirstLine()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+n),void 0!==r.Get_Jc())switch(r.Get_Jc()){case 0:a+=e.textRight+n;break;case 1:a+=e.textLeft+n;break;case 2:a+=e.textCenter+n;break;case 3:a+=e.textJustify+n}if(void 0!==r.Get_KeepLines()&&(a+=(r.Get_KeepLines()?e.textKeepLines:e.textNoKeepLines)+n),r.Get_KeepNext()&&(a+=(r.Get_KeepNext()?e.textKeepNext:e.textNoKeepNext)+n),r.Get_PageBreakBefore()&&(a+=(r.Get_PageBreakBefore()?e.textBreakBefore:e.textNoBreakBefore)+n),void 0!==r.Get_SpacingLineRule()&&void 0!==r.Get_SpacingLine()&&(a+=e.textLineSpacing,a+=(r.Get_SpacingLineRule()==c_paragraphLinerule.LINERULE_LEAST?e.textAtLeast:r.Get_SpacingLineRule()==c_paragraphLinerule.LINERULE_AUTO?e.textMultiple:e.textExact)+" ",a+=(r.Get_SpacingLineRule()==c_paragraphLinerule.LINERULE_AUTO?r.Get_SpacingLine():Common.Utils.Metric.fnRecalcFromMM(r.Get_SpacingLine()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName())+n),r.Get_SpacingBeforeAutoSpacing()?a+=e.textSpacingBefore+" "+e.textAuto+n:void 0!==r.Get_SpacingBefore()&&(a+=e.textSpacingBefore+" "+Common.Utils.Metric.fnRecalcFromMM(r.Get_SpacingBefore()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+n),r.Get_SpacingAfterAutoSpacing()?a+=e.textSpacingAfter+" "+e.textAuto+n:void 0!==r.Get_SpacingAfter()&&(a+=e.textSpacingAfter+" "+Common.Utils.Metric.fnRecalcFromMM(r.Get_SpacingAfter()).toFixed(2)+" "+Common.Utils.Metric.getCurrentMetricName()+n),r.Get_WidowControl()&&(a+=(r.Get_WidowControl()?e.textWidow:e.textNoWidow)+n),void 0!==r.Get_Tabs()&&(a+=e.textTabs+n),void 0!==r.Get_NumPr()&&(a+=e.textNum+n),void 0!==r.Get_PStyle()){var c=e.api.asc_GetStyleNameById(r.Get_PStyle());_.isEmpty(c)||(a+=c+n)}_.isEmpty(a)||(s+=": ",a=a.substring(0,a.length-2)),s+="</b>",s+=a;break;case Asc.c_oAscRevisionsChangeType.TablePr:s=e.textTableChanged;break;case Asc.c_oAscRevisionsChangeType.RowsAdd:s=e.textTableRowsAdd;break;case Asc.c_oAscRevisionsChangeType.RowsRem:s=e.textTableRowsDel}var h=""==t.get_DateTime()?new Date:new Date(t.get_DateTime()),d=e.userCollection.findOriginalUser(t.get_UserId()),m=e._state.docProtection.isReviewOnly,p=Common.UI.ExternalUsers.getImage(t.get_UserId()),u=new Common.Models.ReviewChange({uid:Common.UI.getId(),userid:t.get_UserId(),username:t.get_UserName(),usercolor:d?d.get("color"):Common.UI.ExternalUsers.getColor(t.get_UserId()||t.get_UserName()),initials:Common.Utils.getUserInitials(AscCommon.UserInfoParser.getParsedName(t.get_UserName())),avatar:p,date:e.dateToLocaleTimeString(h),changetext:s,id:Common.UI.getId(),lock:null!==t.get_LockUserId(),lockuser:e.getUserName(t.get_LockUserId()),type:t.get_Type(),changedata:t,scope:e.view,hint:!e.appConfig.canReview,docProtection:e._state.docProtection,goto:t.get_MoveType()==Asc.c_oAscRevisionsMove.MoveTo||t.get_MoveType()==Asc.c_oAscRevisionsMove.MoveFrom,editable:(e.appConfig.isReviewOnly||m)&&t.get_UserId()==e.currentUserId||!(e.appConfig.isReviewOnly||m)&&(!e.appConfig.canUseReviewPermissions||AscCommon.UserInfoParser.canEditReview(t.get_UserName()))});i.push(u),void 0===p&&o.push(t.get_UserId())})),o.length&&Common.UI.ExternalUsers.get("info",o),i},getUserName:function(t){if(this.userCollection&&null!==t){var e=this.userCollection.findUser(t);if(e)return AscCommon.UserInfoParser.getParsedName(e.get("username"))}return""},dateToLocaleTimeString:function(t){var e=(this.appConfig&&this.appConfig.lang||"en").replace("_","-").toLowerCase();try{return e=="ar-SA".toLowerCase()&&(e+="-u-nu-latn-ca-gregory"),t.toLocaleString(e,{dateStyle:"short",timeStyle:"short"})}catch(i){return e="en",t.toLocaleString(e,{dateStyle:"short",timeStyle:"short"})}return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()+" "+function(t){var e=t.getHours(),i=t.getMinutes(),o=e>=12?"pm":"am";return(e=(e%=12)||12)+":"+(i=i<10?"0"+i:i)+" "+o}(t)},onBtnPreviewClick:function(t,e){switch(e){case"prev":this.api.asc_GetPrevRevisionsChange();break;case"next":this.api.asc_GetNextRevisionsChange()}Common.NotificationCenter.trigger("edit:complete",this.view)},onAcceptClick:function(t,e,i){this.api&&(e?"all"===e.value?this.api.asc_AcceptAllChanges():this._state.lock?this.api.asc_GetNextRevisionsChange():this.api.asc_AcceptChangesBySelection(!0):this.api.asc_AcceptChanges(t)),Common.NotificationCenter.trigger("edit:complete",this.view)},onRejectClick:function(t,e,i){this.api&&(e?"all"===e.value?this.api.asc_RejectAllChanges():this._state.lock?this.api.asc_GetNextRevisionsChange():this.api.asc_RejectChangesBySelection(!0):this.api.asc_RejectChanges(t)),Common.NotificationCenter.trigger("edit:complete",this.view)},onDeleteClick:function(t){this.api&&this.api.asc_RejectChanges(t),Common.NotificationCenter.trigger("edit:complete",this.view)},onGotoClick:function(t){this.api&&this.api.asc_FollowRevisionMove(t),Common.NotificationCenter.trigger("edit:complete",this.view)},onTurnPreview:function(t,e,i){this.appConfig.isReviewOnly?this.view.turnChanges(!0):this.appConfig.canReview&&(t="off"!=t&&t,e?(this.api.asc_SetLocalTrackRevisions(null),this.api.asc_SetGlobalTrackRevisions(!!t)):this.api.asc_SetLocalTrackRevisions(!!t))},onApiTrackRevisionsChange:function(t,e,i){if(this.appConfig.isReviewOnly||this._state.docProtection.isReviewOnly)this.view.turnChanges(!0);else if(this.appConfig.canReview){var o=null===t,n=o?e:t;if(Common.Utils.InternalSettings.set(this.appPrefix+"track-changes",(n?0:1)+(o?2:0)),this.view.turnChanges(n,o),i&&this.userCollection){var s=this.userCollection.findOriginalUser(i);s&&Common.NotificationCenter.trigger("showmessage",{msg:Common.Utils.String.format(e?this.textOnGlobal:this.textOffGlobal,AscCommon.UserInfoParser.getParsedName(s.get("username")))},{timeout:5e3,hideCloseTip:!0})}}},onTurnSpelling:function(t,e){t="on"==t,this.view&&this.view.turnSpelling(t),Common.UI.FeaturesManager.canChange("spellcheck")&&!e&&(Common.localStorage.setItem(this.appPrefix+"settings-spellcheck",t?1:0),this.api.asc_setSpellCheck(t),Common.Utils.InternalSettings.set(this.appPrefix+"settings-spellcheck",t))},onReviewViewClick:function(t,e,i){this.turnDisplayMode(e.value),this.appConfig.isEdit||this.appConfig.isRestrictedEdit?"markup"!=e.value&&"simple"!=e.value||(Common.localStorage.setItem(this.appPrefix+"review-mode-editor",e.value),Common.Utils.InternalSettings.set(this.appPrefix+"review-mode-editor",e.value)):Common.localStorage.setItem(this.appPrefix+"review-mode",e.value),Common.NotificationCenter.trigger("edit:complete",this.view)},onCompareClick:function(t){if(this.api){var e=this;this._state.compareSettings||(this._state.compareSettings=new AscCommonWord.ComparisonOptions,this._state.compareSettings.putWords(!Common.localStorage.getBool("de-compare-char"))),"file"===t?(this.api&&setTimeout((function(){e.api.asc_CompareDocumentFile(e._state.compareSettings)}),1),Common.NotificationCenter.trigger("edit:complete",this.view)):"url"===t?new Common.Views.ImageFromUrlDialog({label:e.textUrl,handler:function(t,i){if("ok"==t){if(e.api){var o=i.replace(/ /g,"");_.isEmpty(o)||e.api.asc_CompareDocumentUrl(o,e._state.compareSettings)}Common.NotificationCenter.trigger("edit:complete",e.view)}}}).show():"storage"===t?Common.NotificationCenter.trigger("storage:document-load","compare"):"settings"===t&&e.onCompareSettings()}Common.NotificationCenter.trigger("edit:complete",this.view)},onCombineClick:function(t){if(this.api){var e=this;this._state.compareSettings||(this._state.compareSettings=new AscCommonWord.ComparisonOptions,this._state.compareSettings.putWords(!Common.localStorage.getBool("de-compare-char"))),"file"===t?(setTimeout((function(){e.api.asc_MergeDocumentFile(e._state.compareSettings)}),1),Common.NotificationCenter.trigger("edit:complete",this.view)):"url"===t?new Common.Views.ImageFromUrlDialog({label:e.textUrl,handler:function(t,i){if("ok"==t){if(e.api){var o=i.replace(/ /g,"");_.isEmpty(o)||e.api.asc_MergeDocumentUrl(o,e._state.compareSettings)}Common.NotificationCenter.trigger("edit:complete",e.view)}}}).show():"storage"===t?Common.NotificationCenter.trigger("storage:document-load","combine"):"settings"===t&&e.onCompareSettings()}Common.NotificationCenter.trigger("edit:complete",this.view)},onCompareSettings:function(){var t=this,e=!t._state.compareSettings||t._state.compareSettings.getWords();new Common.Views.OptionsDialog({title:t.textTitleComparison,items:[{caption:t.textChar,value:!1,checked:!1===e},{caption:t.textWord,value:!0,checked:!1!==e}],label:t.textShow,handler:function(e,i){"ok"==i&&(t._state.compareSettings=new AscCommonWord.ComparisonOptions,t._state.compareSettings.putWords(e.getSettings())),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}}).show()},setRevisedFile:function(t){t&&(t.c="compare"),this.setRequestedDocument(t)},onAcceptChangesBeforeCompare:function(t){Common.UI.warning({width:550,msg:this.textAcceptBeforeCompare,buttons:["yes","no"],primary:"yes",callback:function(e){_.defer((function(){t&&t("yes"==e)})),Common.NotificationCenter.trigger("edit:complete",this.view)}})},openDocumentFromStorage:function(t){var e=this;this.appConfig.canRequestSelectDocument?Common.Gateway.requestSelectDocument(t):this.appConfig.canRequestCompareFile?(console.log("Obsolete: The 'onRequestCompareFile' event is deprecated. Please use 'onRequestSelectDocument' event instead."),Common.Gateway.requestCompareFile()):new Common.Views.SelectFileDlg({fileChoiceUrl:this.appConfig.fileChoiceUrl.replace("{fileExt}","").replace("{documentType}","DocumentsOnly")}).on("selectfile",(function(i,o){o&&(o.c=t),e.setRequestedDocument(o)})).show()},setRequestedDocument:function(t){Common.NotificationCenter.trigger("storage:document-insert",t)},insertDocumentFromStorage:function(t){t&&t.url&&("compare"===t.c||"combine"===t.c||"insert-text"===t.c)&&(this._state.compareSettings||(this._state.compareSettings=new AscCommonWord.ComparisonOptions,this._state.compareSettings.putWords(!Common.localStorage.getBool("de-compare-char"))),"compare"===t.c&&this.api.asc_CompareDocumentUrl(t.url,this._state.compareSettings,t.token),"combine"===t.c&&this.api.asc_MergeDocumentUrl(t.url,this._state.compareSettings,t.token),"insert-text"===t.c&&this.api.asc_insertTextFromUrl(t.url,t.token))},turnDisplayMode:function(t){if(this.api){var e=Asc.c_oAscDisplayModeInReview.Edit;switch(t){case"final":e=Asc.c_oAscDisplayModeInReview.Final;break;case"original":e=Asc.c_oAscDisplayModeInReview.Original;break;case"simple":e=Asc.c_oAscDisplayModeInReview.Simple}this._state.displayMode=e,this.api.asc_SetDisplayModeInReview(e)}this.disableEditing("final"==t||"original"==t),this._state.previewMode="final"==t||"original"==t},onChangeDisplayModeInReview:function(t){this.disableEditing(t===Asc.c_oAscDisplayModeInReview.Final||t===Asc.c_oAscDisplayModeInReview.Original),this._state.displayMode=t;var e="markup";switch(t){case Asc.c_oAscDisplayModeInReview.Final:e="final";break;case Asc.c_oAscDisplayModeInReview.Original:e="original";break;case Asc.c_oAscDisplayModeInReview.Simple:e="simple"}this.view&&this.view.turnDisplayMode(e),this._state.previewMode=t===Asc.c_oAscDisplayModeInReview.Final||t===Asc.c_oAscDisplayModeInReview.Original},isPreviewChangesMode:function(){return this._state.previewMode},onCoAuthMode:function(t,e,i){if(Common.localStorage.setItem(this.appPrefix+"settings-coauthmode",e.value),Common.Utils.InternalSettings.set(this.appPrefix+"settings-coauthmode",e.value),this.api){if(this.api.asc_SetFastCollaborative(1==e.value),this.api.SetCollaborativeMarksShowType){var o=Common.localStorage.getItem(e.value?this.appPrefix+"settings-showchanges-fast":this.appPrefix+"settings-showchanges-strict");null!==o?this.api.SetCollaborativeMarksShowType("all"==o?Asc.c_oAscCollaborativeMarksShowType.All:"none"==o?Asc.c_oAscCollaborativeMarksShowType.None:Asc.c_oAscCollaborativeMarksShowType.LastChanges):this.api.SetCollaborativeMarksShowType(e.value?Asc.c_oAscCollaborativeMarksShowType.None:Asc.c_oAscCollaborativeMarksShowType.LastChanges)}null===(o=Common.localStorage.getItem(this.appPrefix+"settings-autosave"))&&this.appConfig.customization&&!1===this.appConfig.customization.autosave&&(o=0),o=e.value||null===o?1:parseInt(o),Common.localStorage.setItem(this.appPrefix+"settings-autosave",o),Common.Utils.InternalSettings.set(this.appPrefix+"settings-autosave",o),this.api.asc_setAutoSaveGap(o)}Common.NotificationCenter.trigger("edit:complete",this.view),this.view.fireEvent("settings:apply",[this])},disableEditing:function(t){Common.NotificationCenter.trigger("editing:disable",t,{viewMode:!1,reviewMode:!0,fillFormMode:!1,viewDocMode:!1,allowMerge:!1,allowSignature:!1,allowProtect:!1,rightMenu:{clear:t,disable:!0},statusBar:!0,leftMenu:{disable:!1,previewMode:!0},fileMenu:{protect:!0,info:!0},navigation:{disable:!1,previewMode:!0},comments:{disable:!1,previewMode:!0},chat:!1,review:!0,viewport:!1,documentHolder:{clear:!1,disable:!0},toolbar:!0,plugins:!0,protect:!0,header:{docmode:!0,search:!1},shortcuts:!1},"review")},createToolbarPanel:function(){return this.view.getPanel()},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onAppReady:function(t){var e=this;new Promise((function(t){t()})).then((function(){if(t.canReview){var i=e.appConfig.customization&&e.appConfig.customization.review?e.appConfig.customization.review.trackChanges:void 0;if(void 0===i&&(i=e.appConfig.customization?e.appConfig.customization.trackChanges:void 0),t.isReviewOnly||void 0!==i?e.api.asc_SetLocalTrackRevisions(t.isReviewOnly||!0===i):e.onApiTrackRevisionsChange(e.api.asc_GetLocalTrackRevisions(),e.api.asc_GetGlobalTrackRevisions()),e.api.asc_HaveRevisionsChanges()&&e.view.markChanges(!0),null===(s=Common.localStorage.getItem(e.appPrefix+"review-mode-editor"))&&(!(s=e.appConfig.customization&&e.appConfig.customization.review?e.appConfig.customization.review.reviewDisplay:void 0)&&(s=e.appConfig.customization?e.appConfig.customization.reviewDisplay:void 0),s=/^(original|final|markup|simple)$/i.test(s)?s.toLocaleLowerCase():"markup"),Common.Utils.InternalSettings.set(e.appPrefix+"review-mode-editor",s),e.turnDisplayMode(s),e.view.turnDisplayMode(s),"object"==_typeof(e.appConfig.customization)&&(e.appConfig.customization.review&&1==e.appConfig.customization.review.showReviewChanges||(!e.appConfig.customization.review||void 0===e.appConfig.customization.review.showReviewChanges)&&1==e.appConfig.customization.showReviewChanges)){e.dlgChanges=new Common.Views.ReviewChangesDialog({popoverChanges:e.popoverChanges,mode:e.appConfig,docProtection:e._state.docProtection});var o=$("#editor_sdk"),n=Common.Utils.getOffset(o);e.dlgChanges.show(Math.max(10,n.left+o.width()-300),Math.max(10,n.top+o.height()-150))}}else if(t.canViewReview){if(t.canViewReview=t.isEdit||e.api.asc_HaveRevisionsChanges(!0),t.canViewReview)null===(s=Common.localStorage.getItem(e.appPrefix+(t.isEdit||t.isRestrictedEdit?"review-mode-editor":"review-mode")))&&(!(s=e.appConfig.customization&&e.appConfig.customization.review?e.appConfig.customization.review.reviewDisplay:void 0)&&(s=e.appConfig.customization?e.appConfig.customization.reviewDisplay:void 0),s=/^(original|final|markup|simple)$/i.test(s)?s.toLocaleLowerCase():t.isEdit||t.isRestrictedEdit?"markup":"original"),e.turnDisplayMode(s),e.view.turnDisplayMode(s)}var s;e.view&&e.view.btnChat&&e.getApplication().getController("LeftMenu").leftMenu.btnChat.on("toggle",(function(t,i){i!==e.view.btnChat.pressed&&e.view.turnChat(i)})),e.onChangeProtectSheet(),e.view&&(e.lockToolbar(Common.enumLock.hideComments,!Common.localStorage.getBool(e.appPrefix+"settings-livecomment",!0),{array:[e.view.btnCommentRemove,e.view.btnCommentResolve]}),e.lockToolbar(Common.enumLock.Objects,!!e._state.wsProps.Objects,{array:[e.view.btnCommentRemove,e.view.btnCommentResolve]})),s=null===(s=Common.localStorage.getItem(e.appPrefix+"settings-review-hover-mode"))?!(!e.appConfig.customization||!e.appConfig.customization.review)&&!!e.appConfig.customization.review.hoverMode:!!parseInt(s),Common.Utils.InternalSettings.set(e.appPrefix+"settings-review-hover-mode",s),e.appConfig.reviewHoverMode=s,e.view&&e.view.btnMailRecepients&&(Common.Utils.lockControls(Common.enumLock.mmergeLock,!!e._state.mmdisable,{array:[e.view.btnMailRecepients]}),e.view.mnuMailRecepients.items[2].setVisible(e.appConfig.fileChoiceUrl||e.appConfig.canRequestSelectSpreadsheet||e.appConfig.canRequestMailMergeRecipients)),e.view&&e.view.onAppReady(t),e._state.sdkchange&&e.onApiShowChange(e._state.sdkchange,!0)}))},applySettings:function(t){this.view&&this.view.turnSpelling(Common.localStorage.getBool(this.appPrefix+"settings-spellcheck",!0)),this.view&&this.view.turnCoAuthMode(Common.localStorage.getBool(this.appPrefix+"settings-coauthmode",!0)),(this.appConfig.canReview||this.appConfig.canViewReview)&&this.appConfig.reviewHoverMode&&this.onApiShowChange()},synchronizeChanges:function(){this.appConfig&&this.appConfig.canReview&&this.view.markChanges(this.api.asc_HaveRevisionsChanges())},setLanguages:function(t){this.langs=t,this.lockToolbar(Common.enumLock.noSpellcheckLangs,this.langs.length<1,{array:this.view.btnsDocLang})},onDocLanguage:function(){var t=this;new Common.Views.LanguageDialog({languages:t.langs,current:t.api.asc_getDefaultLanguage(),handler:function(e,i){if("ok"==e){var o=_.findWhere(t.langs,{value:i});o&&t.api.asc_setDefaultLanguage(o.code)}}}).show()},onLostEditRights:function(){this._readonlyRights=!0,this.view&&this.view.onLostEditRights(),this.view&&this.lockToolbar(Common.enumLock.cantShare,!0,{array:[this.view.btnSharing]})},changeAccessRights:function(t,e,i){if(!this._docAccessDlg&&!this._readonlyRights)if(this.appConfig.canRequestSharingSettings)Common.Gateway.requestSharingSettings();else{var o=this;o._docAccessDlg=new Common.Views.DocumentAccessDialog({settingsurl:this.appConfig.sharingSettingsUrl}),o._docAccessDlg.on("accessrights",(function(t,e){o.setSharingSettings({sharingSettings:e})})).on("close",(function(t){o._docAccessDlg=void 0})),o._docAccessDlg.show()}},setSharingSettings:function(t){t&&(this.document.info.sharingSettings=t.sharingSettings,Common.NotificationCenter.trigger("collaboration:sharingupdate",t.sharingSettings),Common.NotificationCenter.trigger("mentions:clearusers","mention"),Common.NotificationCenter.trigger("mentions:clearusers","protect"))},onCoAuthoringDisconnect:function(){this.lockToolbar(Common.enumLock.lostConnect,!0),this.dlgChanges&&Common.Utils.lockControls(Common.enumLock.lostConnect,!0,{array:[this.dlgChanges.btnAccept,this.dlgChanges.btnReject]})},onUpdateUsers:function(){var t=this.userCollection;this.popoverChanges&&this.popoverChanges.each((function(e){var i=t.findOriginalUser(e.get("userid"));e.set("usercolor",i?i.get("color"):Common.UI.ExternalUsers.getColor(e.get("userid")||e.get("username"))),i&&i.get("avatar")&&e.set("avatar",i.get("avatar"))}))},avatarsUpdate:function(t,e){"info"===t&&this.popoverChanges&&this.popoverChanges.each((function(t){var i=_.findWhere(e,{id:t.get("userid")});i&&void 0!==i.image&&t.set("avatar",i.image)}))},onAuthParticipantsChanged:function(t){if(this.view&&this.view.btnCompare){var e=0;_.each(t,(function(t){t.asc_getView()||e++})),Common.Utils.lockControls(Common.enumLock.hasCoeditingUsers,e>1,{array:[this.view.btnCompare,this.view.btnCombine]})}},commentsShowHide:function(t){if(this.view){var e=Common.Utils.InternalSettings.get(this.appPrefix+"settings-livecomment");void 0!==e&&this.lockToolbar(Common.enumLock.hideComments,"show"!=t&&!e,{array:[this.view.btnCommentRemove,this.view.btnCommentResolve]})}},onChangeProtectSheet:function(t){if(!t){var e=this.getApplication().getController("WBProtection");t=e?e.getWSProps():null}this._state.wsProps=t?t.wsProps:[],this._state.wsLock=!!t&&t.wsLock,this.view&&this.lockToolbar(Common.enumLock.Objects,!!this._state.wsProps.Objects,{array:[this.view.btnCommentRemove,this.view.btnCommentResolve]})},onChangeProtectDocument:function(t){if(!t){var e=this.getApplication().getController("DocProtection");t=e?e.getDocProps():null}t&&(this._state.docProtection=t,this.lockToolbar(Common.enumLock.docLockView,t.isReadOnly),this.lockToolbar(Common.enumLock.docLockForms,t.isFormsOnly),this.lockToolbar(Common.enumLock.docLockReview,t.isReviewOnly),this.lockToolbar(Common.enumLock.docLockComments,t.isCommentsOnly),this.dlgChanges&&(Common.Utils.lockControls(Common.enumLock.docLockView,t.isReadOnly,{array:[this.dlgChanges.btnAccept,this.dlgChanges.btnReject]}),Common.Utils.lockControls(Common.enumLock.docLockForms,t.isFormsOnly,{array:[this.dlgChanges.btnAccept,this.dlgChanges.btnReject]}),Common.Utils.lockControls(Common.enumLock.docLockReview,t.isReviewOnly,{array:[this.dlgChanges.btnAccept,this.dlgChanges.btnReject]}),Common.Utils.lockControls(Common.enumLock.docLockComments,t.isCommentsOnly,{array:[this.dlgChanges.btnAccept,this.dlgChanges.btnReject]})),this.appConfig.isReviewOnly||(t.isReviewOnly?(this.api.asc_SetLocalTrackRevisions(!0),this.onApiShowChange()):this._state.prevReviewProtected&&(this.api.asc_SetLocalTrackRevisions(!1),this.onApiShowChange()),this._state.prevReviewProtected=t.isReviewOnly),this.updatePreviewMode())},DisableMailMerge:function(){this._state.mmdisable=!0,this.view&&this.view.btnMailRecepients&&Common.Utils.lockControls(Common.enumLock.mmergeLock,!0,{array:[this.view.btnMailRecepients]})},onChangeViewMode:function(t){this.lockToolbar(Common.enumLock.slideMasterMode,"master"===t)},textInserted:"<b>Inserted:</b>",textDeleted:"<b>Deleted:</b>",textParaInserted:"<b>Paragraph Inserted</b> ",textParaDeleted:"<b>Paragraph Deleted</b> ",textFormatted:"Formatted",textParaFormatted:"Paragraph Formatted",textNot:"Not ",textBold:"Bold",textItalic:"Italic",textStrikeout:"Strikeout",textUnderline:"Underline",textColor:"Font color",textBaseline:"Baseline",textSuperScript:"Superscript",textSubScript:"Subscript",textHighlight:"Highlight color",textSpacing:"Spacing",textDStrikeout:"Double strikeout",textCaps:"All caps",textSmallCaps:"Small caps",textPosition:"Position",textFontSize:"Font size",textShd:"Background color",textContextual:"Don't add interval between paragraphs of the same style",textNoContextual:"Add interval between paragraphs of the same style",textIndentLeft:"Indent left",textIndentRight:"Indent right",textFirstLine:"First line",textRight:"Align right",textLeft:"Align left",textCenter:"Align center",textJustify:"Align justify",textBreakBefore:"Page break before",textKeepNext:"Keep with next",textKeepLines:"Keep lines together",textNoBreakBefore:"No page break before",textNoKeepNext:"Don't keep with next",textNoKeepLines:"Don't keep lines together",textLineSpacing:"Line Spacing: ",textMultiple:"multiple",textAtLeast:"at least",textExact:"exactly",textSpacingBefore:"Spacing before",textSpacingAfter:"Spacing after",textAuto:"auto",textWidow:"Widow control",textNoWidow:"No widow control",textTabs:"Change tabs",textNum:"Change numbering",textEquation:"Equation",textImage:"Image",textChart:"Chart",textShape:"Shape",textTableChanged:"<b>Table Settings Changed</b>",textTableRowsAdd:"<b>Table Rows Added</b>",textTableRowsDel:"<b>Table Rows Deleted</b>",textParaMoveTo:"<b>Moved:</b>",textParaMoveFromUp:"<b>Moved Up:</b>",textParaMoveFromDown:"<b>Moved Down:</b>",textUrl:"Paste a document URL",textAcceptBeforeCompare:"In order to compare documents all the tracked changes in them will be considered to have been accepted. Do you want to continue?",textTitleComparison:"Comparison Settings",textShow:"Show changes at",textChar:"Character level",textWord:"Word level",textOnGlobal:"{0} enabled Track Changes for everyone.",textOffGlobal:"{0} disabled Track Changes for everyone.",textOn:"{0} is now using Track Changes.",textOff:"{0} is no longer using Track Changes."},Common.Controllers.ReviewChanges||{}))})),void 0===Common)var Common={};if(Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/Protection",["core","common/main/lib/view/Protection"],(function(){"use strict";Common.Controllers.Protection=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["Common.Views.Protection"],sdkViewName:"#id_main",initialize:function(){this.addListeners({"Common.Views.Protection":{"protect:password":_.bind(this.onPasswordClick,this),"protect:signature":_.bind(this.onSignatureClick,this)}})},onLaunch:function(){this._state={},Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this))},setConfig:function(t,e){this.setApi(e),t&&(this.sdkViewName=t.sdkviewname||this.sdkViewName)},setApi:function(t){t&&(this.api=t,this.appConfig.isPasswordSupport&&this.api.asc_registerCallback("asc_onDocumentPassword",_.bind(this.onDocumentPassword,this)),this.appConfig.isSignatureSupport&&(Common.NotificationCenter.on("protect:sign",_.bind(this.onSignatureRequest,this)),Common.NotificationCenter.on("protect:signature",_.bind(this.onSignatureClick,this)),this.api.asc_registerCallback("asc_onSignatureClick",_.bind(this.onSignatureSign,this)),this.api.asc_registerCallback("asc_onUpdateSignatures",_.bind(this.onApiUpdateSignatures,this))),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)))},setMode:function(t){return this.appConfig=t,this.view=this.createView("Common.Views.Protection",{mode:t}),this},onDocumentPassword:function(t,e){this.view&&this.view.onDocumentPassword(t,e)},SetDisabled:function(t,e){this.view&&this.view.SetDisabled(t,e)},onPasswordClick:function(t,e){switch(e){case"add":this.addPassword();break;case"delete":this.deletePassword()}Common.NotificationCenter.trigger("edit:complete",this.view)},onSignatureRequest:function(t){this.api.asc_RequestSign(t)},onSignatureClick:function(t,e,i){switch(t){case"invisible":this.onSignatureRequest("unvisibleAdd");break;case"visible":this.addVisibleSignature(e,i)}},createToolbarPanel:function(){return this.view.getPanel()},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onAppReady:function(t){var e=this;new Promise((function(t,e){t()})).then((function(){e.onChangeProtectDocument(),Common.NotificationCenter.on("protect:doclock",_.bind(e.onChangeProtectDocument,e))}))},onChangeProtectDocument:function(t){if(!t){var e=this.getApplication().getController("DocProtection");t=e?e.getDocProps():null}t&&this.view&&(this.view._state.docProtection=t)},addPassword:function(){var t=this;new Common.Views.PasswordDialog({api:t.api,handler:function(e,i){"ok"==e&&t.api.asc_setCurrentPassword(i),Common.NotificationCenter.trigger("edit:complete")}}).show()},deletePassword:function(){this.api.asc_resetPassword()},addInvisibleSignature:function(){var t=this;new Common.Views.SignDialog({api:t.api,signType:"invisible",handler:function(e,i){if("ok"==i){var o=e.getSettings();t.api.asc_Sign(o.certificateId)}Common.NotificationCenter.trigger("edit:complete")}}).show()},addVisibleSignature:function(t,e){var i=this,o=new Common.Views.SignSettingsDialog({type:t?"view":"edit",handler:function(e,o){t||"ok"!=o||i.api.asc_AddSignatureLine2(e.getSettings()),Common.NotificationCenter.trigger("edit:complete")}});o.show(),e&&o.setSettings(this.api.asc_getSignatureSetup(e))},signVisibleSignature:function(t,e,i){var o=this;if(_.isUndefined(o.fontStore)){o.fontStore=new Common.Collections.Fonts;var n=o.getApplication().getController("Toolbar").getView("Toolbar").cmbFontName.store.toJSON(),s=[];_.each(n,(function(t,e){t.cloneid||s.push(_.clone(t))})),o.fontStore.add(s)}new Common.Views.SignDialog({api:o.api,signType:"visible",fontStore:o.fontStore,signSize:{width:e||0,height:i||0},handler:function(e,i){if("ok"==i){var n=e.getSettings();o.api.asc_Sign(n.certificateId,t,n.images[0],n.images[1])}Common.NotificationCenter.trigger("edit:complete")}}).show()},onSignatureSign:function(t,e,i,o){o?this.signVisibleSignature(t,e,i):this.addInvisibleSignature()},onApiUpdateSignatures:function(t,e){this.SetDisabled(t&&t.length>0,!0)},onCoAuthoringDisconnect:function(){this.SetDisabled(!0)}},Common.Controllers.Protection||{}))})),void 0===Common)var Common={};if(Common.Views=Common.Views||{},define("common/main/lib/view/Draw",["common/main/lib/util/utils","common/main/lib/component/BaseView","common/main/lib/component/Layout","common/main/lib/component/Window","common/main/lib/component/UpDownPicker"],(function(t){"use strict";Common.Views.Draw=Common.UI.BaseView.extend(_.extend(function(){var t='<div class="group"><span id="slot-btn-draw-select" class="btn-slot text x-huge"></span><span id="slot-btn-draw-pen-0" class="btn-slot text x-huge emptycaption"></span><span id="slot-btn-draw-pen-1" class="btn-slot text x-huge emptycaption"></span><span id="slot-btn-draw-pen-2" class="btn-slot text x-huge emptycaption"></span><span id="slot-btn-draw-eraser" class="btn-slot text x-huge"></span></div>',e='<section id="draw-ink-panel" class="panel" data-tab="draw" role="tabpanel" aria-labelledby="draw">'+t+"</section>";function i(){var t=this;t.btnEraser.on("click",(function(e){t.fireEvent("draw:eraser",[e])})),t.btnsPen.forEach((function(e){e.on("click",(function(e,i){t.fireEvent("draw:pen",[e])})),e.on("color:select",(function(e,i){t.fireEvent("draw:color",[e,i])}))})),t.btnSelect.on("click",(function(e){t.fireEvent("draw:select",[e])})),t._isSetEvents=!0}return{options:{},initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t),this.appConfig=t.mode,this._state={disabled:!1},this.lockedControls=[],this.btnsPen=[],this.isPDFEditor=!!window.PDFE;var e=Common.localStorage.getKeysFilter();this.appPrefix=e&&e.length?e.split(",")[0]:"";var i=Common.enumLock,o=[{hint:this.txtPen,color:"3D8A44",opacity:100,size:{arr:[.25,.5,1,2,3.5],idx:2},iconCls:"btn-pen-tool",idx:0},{hint:this.txtPen,color:"D43230",opacity:100,size:{arr:[.25,.5,1,2,3.5],idx:2},iconCls:"btn-pen-tool",idx:1},{hint:this.txtHighlighter,color:"FFFC54",opacity:50,size:{arr:[2,4,6,8,10],idx:2},iconCls:"btn-highlighter-tool",idx:2,colors:["FFFC54","72F54A","74F9FD","EB51F7","A900F9","EF8B3A","7272FF","FF63A4","1DFF92","03DA18","249B01","C504D2","0633D1","FFF7A0","FF0303","FFFFFF","D3D3D4","969696","606060","000000"]}],n="de-"===this.appPrefix?[i.headerLock,i.previewReviewMode,i.viewFormMode,i.lostConnect,i.docLockViewIns,i.docLockForms,i.docLockCommentsIns,i.viewMode]:"pe-"===this.appPrefix?[i.slideDeleted,i.lostConnect,i.noSlides]:"pdfe-"===this.appPrefix?[i.pageDeleted,i.lostConnect]:[i.editCell,i.lostConnect,i.coAuth,i.Objects],s=this;o.forEach((function(t){var e=new Common.UI.ButtonColored({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon "+t.iconCls,caption:" ",menu:!0,split:!0,enableToggle:!0,allowDepress:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small",penOptions:t,lock:n});s.btnsPen.push(e),s.lockedControls.push(e)})),this.btnEraser=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-eraser",caption:this.txtEraser,enableToggle:!0,allowDepress:!0,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small",lock:n}),this.lockedControls.push(this.btnEraser),this.btnSelect=new Common.UI.Button({cls:"btn-toolbar x-huge icon-top",iconCls:"toolbar__icon btn-select",caption:this.txtSelect,dataHint:"1",dataHintDirection:"bottom",dataHintOffset:"small",lock:n,visible:!this.isPDFEditor}),this.lockedControls.push(this.btnSelect),Common.UI.LayoutManager.addControls(this.lockedControls),Common.NotificationCenter.on("app:ready",this.onAppReady.bind(this))},render:function(t){return this.boxSdk=$("#editor_sdk"),t&&t.html(this.getPanel()),this},updateButtonHint:function(t){var e=t.options.penOptions;t.updateHint(e.hint+": "+Common.Utils.ThemeColor.getTranslation(Common.Utils.ThemeColor.getRgbColor(e.color).asc_getName())+Common.Utils.String.textComma+" "+e.size.arr[e.size.idx]+" "+this.txtMM),t.sizePicker&&t.sizePicker.setValue(e.size.arr[e.size.idx]+" "+this.txtMM)},createPen:function(t){var e=t.options.penOptions,i=Common.UI.getId(),o=this;this.updateButtonHint(t),t.setMenu(new Common.UI.Menu({cls:"shifted-left",style:"min-width: 100px;",items:[{template:_.template('<div id="id-toolbar-menu-draw-pen-'+i+'" style="width: 174px; display: inline-block;" class="palette-large"></div>'),stopPropagation:!0},{id:i+"-color-new",template:_.template('<a tabindex="-1" type="menuitem" style="">'+t.textNewColor+"</a>")},{caption:"--"},{template:_.template('<div id="id-toolbar-draw-updownpicker-'+i+'" class="custom-scale" data-stopPropagation="true"></div>'),stopPropagation:!0}]}),!0),t.currentColor=e.color,t.setColor(t.currentColor);var n=new Common.UI.ThemeColorPalette({el:$("#id-toolbar-menu-draw-pen-"+i),colors:e.colors||["1755A0","D43230","F5C346","EA3368","12A489","552F8B","9D1F87","BB2765","479ED2","67C9FA","3D8A44","80CA3D","1C19B4","7F4B0F","FF7E07","FFFFFF","D3D3D4","879397","575757","000000"],value:t.currentColor,dynamiccolors:5,themecolors:0,effects:0,columns:5,outerMenu:{menu:t.menu,index:0,focusOnShow:!0},storageSuffix:"-draw"});t.setPicker(n),n.on("select",_.bind(t.onColorSelect,t)),t.menu.setInnerMenu([{menu:n,index:0}]),t.menu.cmpEl.find("#"+i+"-color-new").on("click",(function(){n.addNewColor(t.currentColor)}));var s=function(e){var n=new Common.UI.UpDownPicker({el:$("#id-toolbar-draw-updownpicker-"+i),caption:o.txtSize,minWidth:50});n.on("click",(function(e){o.fireEvent("draw:size",[t,e])})),n.setValue(t.options.penOptions.size.arr[t.options.penOptions.size.idx]+" "+o.txtMM),t.sizePicker=n,e.off("show:after",s)};t.menu.on("show:after",s)},onAppReady:function(t){var e=this;new Promise((function(t,e){t()})).then((function(){e.btnsPen.forEach((function(t){e.createPen(t)})),e.btnEraser.updateHint(e.hintEraser),e.btnSelect.updateHint(e.hintSelect),Common.NotificationCenter.trigger("tab:visible","draw",Common.UI.LayoutManager.isElementVisible("toolbar-draw")),i.call(e)}))},getPanel:function(i){this.$el=$(_.template(i?t:e)({}));var o=this;return this.btnsPen.forEach((function(t,e){t.render(o.$el.find("#slot-btn-draw-pen-"+e))})),this.btnEraser&&this.btnEraser.render(this.$el.find("#slot-btn-draw-eraser")),this.btnSelect&&this.btnSelect.render(this.$el.find("#slot-btn-draw-select")),this.$el},show:function(){Common.UI.BaseView.prototype.show.call(this),this.fireEvent("show",this)},getButtons:function(){return this.lockedControls},depressButtons:function(t){this.btnsPen.forEach((function(e){e!==t&&e.toggle(!1,!0)})),this.btnEraser!==t&&this.btnEraser.toggle(!1,!0)},SetDisabled:function(t){this._state.disabled=t},txtPen:"Pen",txtHighlighter:"Highlighter",txtEraser:"Eraser",hintEraser:"Eraser",txtSize:"Size",txtSelect:"Select",hintSelect:"Select",txtMM:"mm"}}(),Common.Views.Draw||{}))})),void 0===Common)var Common={};Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/Draw",["core","common/main/lib/view/Draw"],(function(){"use strict";Common.Controllers.Draw=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["Common.Views.Draw"],sdkViewName:"#id_main",initialize:function(){this.addListeners({"Common.Views.Draw":{"draw:select":_.bind(this.onSelect,this),"draw:eraser":_.bind(this.onEraser,this),"draw:pen":_.bind(this.onDrawPen,this),"draw:size":_.bind(this.onDrawSizeClick,this),"draw:color":_.bind(this.onDrawColorClick,this)}})},onLaunch:function(){this._state={},Common.NotificationCenter.on({"draw-tool:pen":this.startDraw.bind(this),"draw-tool:eraser":this.startEraser.bind(this),"draw-tool:select":this.stopDraw.bind(this),"draw-tool:erase-all":this.onEraseAllInksOnSlide.bind(this),"app:ready":this.onAppReady.bind(this),"api:disconnect":_.bind(this.onCoAuthoringDisconnect,this)})},setConfig:function(t,e){this.setApi(e),t&&(this.sdkViewName=t.sdkviewname||this.sdkViewName)},setApi:function(t){return t&&(this.api=t,this.api.asc_registerCallback("asc_onInkDrawerStop",_.bind(this.onInkDrawerStop,this)),this.api.asc_registerCallback("asc_onCoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this))),this},setMode:function(t){return this.appConfig=t,t.isEdit&&(this.view=this.createView("Common.Views.Draw",{mode:t})),this},SetDisabled:function(t){this.view&&this.view.SetDisabled(t)},onInkDrawerStop:function(){this.view&&this.view.depressButtons(),Common.NotificationCenter.trigger("draw:stop",this.view)},onSelect:function(t){this.api&&this.api.asc_StopInkDrawer(),Common.NotificationCenter.trigger("edit:complete",this.view)},startEraser:function(){this.api&&this.api.asc_StartInkEraser(),Common.NotificationCenter.trigger("draw:start",this.view)},onEraser:function(t){this.api&&(t.pressed?(this.view.depressButtons(t),this.startEraser()):this.api.asc_StopInkDrawer())},onEraseAllInksOnSlide:function(){this.api&&this.api.asc_EraseAllInksOnSlide()},startDraw:function(t){if(this.api){var e=new Asc.asc_CStroke;e.put_type(Asc.c_oAscStrokeType.STROKE_COLOR),e.put_color(Common.Utils.ThemeColor.getRgbColor(t.color)),e.asc_putPrstDash(Asc.c_oDashType.solid),e.put_width(t.size),e.put_transparent(2.55*t.opacity),this.api.asc_StartDrawInk(e,t.index),Common.NotificationCenter.trigger("draw:start",this.view)}},stopDraw:function(){this.api&&this.api.asc_StopInkDrawer(),Common.NotificationCenter.trigger("draw:stop",this.view)},onDrawPen:function(t){if(this.api)if(t.pressed){this.view.depressButtons(t);var e=_.clone(t.options.penOptions);e.size=e.size.arr[e.size.idx],e.index=e.idx,this.startDraw(e)}else this.api.asc_StopInkDrawer()},onDrawSizeClick:function(t,e){t.pressed||(t.toggle(!0,!0),this.view&&this.view.depressButtons(t));var i=t.options.penOptions;i.size.idx="up"===e?Math.min(i.size.idx+1,i.size.arr.length-1):Math.max(i.size.idx-1,0),this.view&&this.view.updateButtonHint(t),this.onDrawPen(t)},onDrawColorClick:function(t,e){t.pressed||(t.toggle(!0,!0),this.view&&this.view.depressButtons(t)),t.options.penOptions.color=e,this.view&&this.view.updateButtonHint(t),this.onDrawPen(t)},createToolbarPanel:function(t){return this.view?this.view.getPanel(t):null},getView:function(t){return!t&&this.view?this.view:Backbone.Controller.prototype.getView.call(this,t)},onAppReady:function(t){new Promise((function(t,e){t()})).then((function(){}))},onCoAuthoringDisconnect:function(){this.SetDisabled(!0)}},Common.Controllers.Draw||{}))})),require.config({baseUrl:"../../",paths:{jquery:"../vendor/jquery/jquery",underscore:"../vendor/underscore/underscore",backbone:"../vendor/backbone/backbone",text:"../vendor/requirejs-text/text",perfectscrollbar:"common/main/lib/mods/perfect-scrollbar",jmousewheel:"../vendor/perfect-scrollbar/src/jquery.mousewheel",xregexp:"../vendor/xregexp/xregexp-all-min",socketio:"../vendor/socketio/socket.io.min",allfonts:"../../sdkjs/common/AllFonts",sdk:"../../sdkjs/cell/sdk-all-min",api:"api/documents/api",core:"common/main/lib/core/application",notification:"common/main/lib/core/NotificationCenter",keymaster:"common/main/lib/core/keymaster",tip:"common/main/lib/util/Tip",localstorage:"common/main/lib/util/LocalStorage",analytics:"common/Analytics",gateway:"common/Gateway",locale:"common/locale",irregularstack:"common/IrregularStack",x2t:"../../sdkjs/common/wasm/x2t/x2t_helper"},shim:{backbone:{deps:["underscore","jquery"],exports:"Backbone"},perfectscrollbar:{deps:["jmousewheel"]},notification:{deps:["backbone"]},core:{deps:["backbone","notification","irregularstack"]},sdk:{deps:["jquery","allfonts","xregexp","socketio","x2t"]},gateway:{deps:["jquery"]},analytics:{deps:["jquery"]}}}),require(["sdk","backbone","underscore","core","analytics","gateway","locale"],(function(t,e,i,o){if(!e.History||!e.History.started){e.history.start(),window._=i;var n=new e.Application({nameSpace:"SSE",autoCreate:!1,controllers:["Viewport","DocumentHolder","CellEditor","FormulaDialog","Print","Toolbar","Statusbar","RightMenu","LeftMenu","Spellcheck","Main","PivotTable","DataTab","ViewTab","Search","WBProtection","Common.Controllers.Fonts","Common.Controllers.History","Common.Controllers.Chat","Common.Controllers.Comments","Common.Controllers.Draw","Common.Controllers.Plugins","Common.Controllers.ExternalOleEditor","Common.Controllers.ReviewChanges","Common.Controllers.Protection"]});Common.Locale.apply((function(){require(["common/main/lib/mods/dropdown","common/main/lib/mods/tooltip","common/main/lib/util/LocalStorage","common/main/lib/controller/Scaling","common/main/lib/controller/Themes","common/main/lib/controller/TabStyler","common/main/lib/controller/Desktop","spreadsheeteditor/main/app/controller/Viewport","spreadsheeteditor/main/app/controller/DocumentHolder","spreadsheeteditor/main/app/controller/CellEditor","spreadsheeteditor/main/app/controller/Toolbar","spreadsheeteditor/main/app/controller/Statusbar","spreadsheeteditor/main/app/controller/RightMenu","spreadsheeteditor/main/app/controller/LeftMenu","spreadsheeteditor/main/app/controller/Spellcheck","spreadsheeteditor/main/app/controller/Main","spreadsheeteditor/main/app/controller/Print","spreadsheeteditor/main/app/controller/PivotTable","spreadsheeteditor/main/app/controller/DataTab","spreadsheeteditor/main/app/controller/ViewTab","spreadsheeteditor/main/app/controller/Search","spreadsheeteditor/main/app/controller/WBProtection","spreadsheeteditor/main/app/controller/Offline","common/main/lib/util/utils","common/main/lib/controller/Fonts","common/main/lib/controller/History","common/main/lib/controller/Comments","common/main/lib/controller/Chat","common/main/lib/controller/Plugins","common/main/lib/controller/ExternalOleEditor","common/main/lib/controller/ReviewChanges","common/main/lib/controller/Protection","common/main/lib/controller/Draw"],(function(){n.postLaunchScripts=["spreadsheeteditor/main/code"],n.start()}))}))}}),(function(t){"timeout"==t.requireType&&!reqerr&&window.requireTimeourError&&(reqerr=window.requireTimeourError(),window.alert(reqerr),window.location.reload())})),define("../apps/spreadsheeteditor/main/app.js",(function(){}));